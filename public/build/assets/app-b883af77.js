var h4=Object.defineProperty;var d4=(t,e,r)=>e in t?h4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var ri=(t,e,r)=>(d4(t,typeof e!="symbol"?e+"":e,r),r);function RR(t,e){return function(){return t.apply(e,arguments)}}const{toString:f4}=Object.prototype,{getPrototypeOf:$E}=Object,Hx=(t=>e=>{const r=f4.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),ja=t=>(t=t.toLowerCase(),e=>Hx(e)===t),Gx=t=>e=>typeof e===t,{isArray:Mp}=Array,m_=Gx("undefined");function p4(t){return t!==null&&!m_(t)&&t.constructor!==null&&!m_(t.constructor)&&zo(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const LR=ja("ArrayBuffer");function m4(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&LR(t.buffer),e}const g4=Gx("string"),zo=Gx("function"),OR=Gx("number"),qx=t=>t!==null&&typeof t=="object",_4=t=>t===!0||t===!1,Lv=t=>{if(Hx(t)!=="object")return!1;const e=$E(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},y4=ja("Date"),v4=ja("File"),x4=ja("Blob"),b4=ja("FileList"),w4=t=>qx(t)&&zo(t.pipe),T4=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||zo(t.append)&&((e=Hx(t))==="formdata"||e==="object"&&zo(t.toString)&&t.toString()==="[object FormData]"))},E4=ja("URLSearchParams"),[S4,A4,M4,I4]=["ReadableStream","Request","Response","Headers"].map(ja),C4=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function j_(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let l,h;if(typeof t!="object"&&(t=[t]),Mp(t))for(l=0,h=t.length;l<h;l++)e.call(null,t[l],l,t);else{const _=r?Object.getOwnPropertyNames(t):Object.keys(t),y=_.length;let s;for(l=0;l<y;l++)s=_[l],e.call(null,t[s],s,t)}}function kR(t,e){e=e.toLowerCase();const r=Object.keys(t);let l=r.length,h;for(;l-- >0;)if(h=r[l],e===h.toLowerCase())return h;return null}const Zh=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),zR=t=>!m_(t)&&t!==Zh;function zT(){const{caseless:t}=zR(this)&&this||{},e={},r=(l,h)=>{const _=t&&kR(e,h)||h;Lv(e[_])&&Lv(l)?e[_]=zT(e[_],l):Lv(l)?e[_]=zT({},l):Mp(l)?e[_]=l.slice():e[_]=l};for(let l=0,h=arguments.length;l<h;l++)arguments[l]&&j_(arguments[l],r);return e}const P4=(t,e,r,{allOwnKeys:l}={})=>(j_(e,(h,_)=>{r&&zo(h)?t[_]=RR(h,r):t[_]=h},{allOwnKeys:l}),t),D4=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),R4=(t,e,r,l)=>{t.prototype=Object.create(e.prototype,l),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},L4=(t,e,r,l)=>{let h,_,y;const s={};if(e=e||{},t==null)return e;do{for(h=Object.getOwnPropertyNames(t),_=h.length;_-- >0;)y=h[_],(!l||l(y,t,e))&&!s[y]&&(e[y]=t[y],s[y]=!0);t=r!==!1&&$E(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},O4=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const l=t.indexOf(e,r);return l!==-1&&l===r},k4=t=>{if(!t)return null;if(Mp(t))return t;let e=t.length;if(!OR(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},z4=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&$E(Uint8Array)),F4=(t,e)=>{const l=(t&&t[Symbol.iterator]).call(t);let h;for(;(h=l.next())&&!h.done;){const _=h.value;e.call(t,_[0],_[1])}},B4=(t,e)=>{let r;const l=[];for(;(r=t.exec(e))!==null;)l.push(r);return l},N4=ja("HTMLFormElement"),V4=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,l,h){return l.toUpperCase()+h}),aC=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),U4=ja("RegExp"),FR=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),l={};j_(r,(h,_)=>{let y;(y=e(h,_,t))!==!1&&(l[_]=y||h)}),Object.defineProperties(t,l)},j4=t=>{FR(t,(e,r)=>{if(zo(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const l=t[r];if(zo(l)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},$4=(t,e)=>{const r={},l=h=>{h.forEach(_=>{r[_]=!0})};return Mp(t)?l(t):l(String(t).split(e)),r},H4=()=>{},G4=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function q4(t){return!!(t&&zo(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const W4=t=>{const e=new Array(10),r=(l,h)=>{if(qx(l)){if(e.indexOf(l)>=0)return;if(!("toJSON"in l)){e[h]=l;const _=Mp(l)?[]:{};return j_(l,(y,s)=>{const I=r(y,h+1);!m_(I)&&(_[s]=I)}),e[h]=void 0,_}}return l};return r(t,0)},Z4=ja("AsyncFunction"),X4=t=>t&&(qx(t)||zo(t))&&zo(t.then)&&zo(t.catch),BR=((t,e)=>t?setImmediate:e?((r,l)=>(Zh.addEventListener("message",({source:h,data:_})=>{h===Zh&&_===r&&l.length&&l.shift()()},!1),h=>{l.push(h),Zh.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",zo(Zh.postMessage)),Y4=typeof queueMicrotask<"u"?queueMicrotask.bind(Zh):typeof process<"u"&&process.nextTick||BR,It={isArray:Mp,isArrayBuffer:LR,isBuffer:p4,isFormData:T4,isArrayBufferView:m4,isString:g4,isNumber:OR,isBoolean:_4,isObject:qx,isPlainObject:Lv,isReadableStream:S4,isRequest:A4,isResponse:M4,isHeaders:I4,isUndefined:m_,isDate:y4,isFile:v4,isBlob:x4,isRegExp:U4,isFunction:zo,isStream:w4,isURLSearchParams:E4,isTypedArray:z4,isFileList:b4,forEach:j_,merge:zT,extend:P4,trim:C4,stripBOM:D4,inherits:R4,toFlatObject:L4,kindOf:Hx,kindOfTest:ja,endsWith:O4,toArray:k4,forEachEntry:F4,matchAll:B4,isHTMLForm:N4,hasOwnProperty:aC,hasOwnProp:aC,reduceDescriptors:FR,freezeMethods:j4,toObjectSet:$4,toCamelCase:V4,noop:H4,toFiniteNumber:G4,findKey:kR,global:Zh,isContextDefined:zR,isSpecCompliantForm:q4,toJSONObject:W4,isAsyncFn:Z4,isThenable:X4,setImmediate:BR,asap:Y4};function an(t,e,r,l,h){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),l&&(this.request=l),h&&(this.response=h,this.status=h.status?h.status:null)}It.inherits(an,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:It.toJSONObject(this.config),code:this.code,status:this.status}}});const NR=an.prototype,VR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{VR[t]={value:t}});Object.defineProperties(an,VR);Object.defineProperty(NR,"isAxiosError",{value:!0});an.from=(t,e,r,l,h,_)=>{const y=Object.create(NR);return It.toFlatObject(t,y,function(I){return I!==Error.prototype},s=>s!=="isAxiosError"),an.call(y,t.message,e,r,l,h),y.cause=t,y.name=t.name,_&&Object.assign(y,_),y};const K4=null;function FT(t){return It.isPlainObject(t)||It.isArray(t)}function UR(t){return It.endsWith(t,"[]")?t.slice(0,-2):t}function lC(t,e,r){return t?t.concat(e).map(function(h,_){return h=UR(h),!r&&_?"["+h+"]":h}).join(r?".":""):e}function J4(t){return It.isArray(t)&&!t.some(FT)}const Q4=It.toFlatObject(It,{},null,function(e){return/^is[A-Z]/.test(e)});function Wx(t,e,r){if(!It.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,r=It.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ne,de){return!It.isUndefined(de[ne])});const l=r.metaTokens,h=r.visitor||k,_=r.dots,y=r.indexes,I=(r.Blob||typeof Blob<"u"&&Blob)&&It.isSpecCompliantForm(e);if(!It.isFunction(h))throw new TypeError("visitor must be a function");function O(se){if(se===null)return"";if(It.isDate(se))return se.toISOString();if(!I&&It.isBlob(se))throw new an("Blob is not supported. Use a Buffer instead.");return It.isArrayBuffer(se)||It.isTypedArray(se)?I&&typeof Blob=="function"?new Blob([se]):Buffer.from(se):se}function k(se,ne,de){let me=se;if(se&&!de&&typeof se=="object"){if(It.endsWith(ne,"{}"))ne=l?ne:ne.slice(0,-2),se=JSON.stringify(se);else if(It.isArray(se)&&J4(se)||(It.isFileList(se)||It.endsWith(ne,"[]"))&&(me=It.toArray(se)))return ne=UR(ne),me.forEach(function(ge,fe){!(It.isUndefined(ge)||ge===null)&&e.append(y===!0?lC([ne],fe,_):y===null?ne:ne+"[]",O(ge))}),!1}return FT(se)?!0:(e.append(lC(de,ne,_),O(se)),!1)}const j=[],Z=Object.assign(Q4,{defaultVisitor:k,convertValue:O,isVisitable:FT});function Y(se,ne){if(!It.isUndefined(se)){if(j.indexOf(se)!==-1)throw Error("Circular reference detected in "+ne.join("."));j.push(se),It.forEach(se,function(me,Te){(!(It.isUndefined(me)||me===null)&&h.call(e,me,It.isString(Te)?Te.trim():Te,ne,Z))===!0&&Y(me,ne?ne.concat(Te):[Te])}),j.pop()}}if(!It.isObject(t))throw new TypeError("data must be an object");return Y(t),e}function cC(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(l){return e[l]})}function HE(t,e){this._pairs=[],t&&Wx(t,this,e)}const jR=HE.prototype;jR.append=function(e,r){this._pairs.push([e,r])};jR.toString=function(e){const r=e?function(l){return e.call(this,l,cC)}:cC;return this._pairs.map(function(h){return r(h[0])+"="+r(h[1])},"").join("&")};function e5(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $R(t,e,r){if(!e)return t;const l=r&&r.encode||e5;It.isFunction(r)&&(r={serialize:r});const h=r&&r.serialize;let _;if(h?_=h(e,r):_=It.isURLSearchParams(e)?e.toString():new HE(e,r).toString(l),_){const y=t.indexOf("#");y!==-1&&(t=t.slice(0,y)),t+=(t.indexOf("?")===-1?"?":"&")+_}return t}class t5{constructor(){this.handlers=[]}use(e,r,l){return this.handlers.push({fulfilled:e,rejected:r,synchronous:l?l.synchronous:!1,runWhen:l?l.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){It.forEach(this.handlers,function(l){l!==null&&e(l)})}}const uC=t5,HR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},i5=typeof URLSearchParams<"u"?URLSearchParams:HE,n5=typeof FormData<"u"?FormData:null,s5=typeof Blob<"u"?Blob:null,r5={isBrowser:!0,classes:{URLSearchParams:i5,FormData:n5,Blob:s5},protocols:["http","https","file","blob","url","data"]},GE=typeof window<"u"&&typeof document<"u",BT=typeof navigator=="object"&&navigator||void 0,o5=GE&&(!BT||["ReactNative","NativeScript","NS"].indexOf(BT.product)<0),a5=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),l5=GE&&window.location.href||"http://localhost",c5=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:GE,hasStandardBrowserEnv:o5,hasStandardBrowserWebWorkerEnv:a5,navigator:BT,origin:l5},Symbol.toStringTag,{value:"Module"})),Rr={...c5,...r5};function u5(t,e){return Wx(t,new Rr.classes.URLSearchParams,Object.assign({visitor:function(r,l,h,_){return Rr.isNode&&It.isBuffer(r)?(this.append(l,r.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},e))}function h5(t){return It.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function d5(t){const e={},r=Object.keys(t);let l;const h=r.length;let _;for(l=0;l<h;l++)_=r[l],e[_]=t[_];return e}function GR(t){function e(r,l,h,_){let y=r[_++];if(y==="__proto__")return!0;const s=Number.isFinite(+y),I=_>=r.length;return y=!y&&It.isArray(h)?h.length:y,I?(It.hasOwnProp(h,y)?h[y]=[h[y],l]:h[y]=l,!s):((!h[y]||!It.isObject(h[y]))&&(h[y]=[]),e(r,l,h[y],_)&&It.isArray(h[y])&&(h[y]=d5(h[y])),!s)}if(It.isFormData(t)&&It.isFunction(t.entries)){const r={};return It.forEachEntry(t,(l,h)=>{e(h5(l),h,r,0)}),r}return null}function f5(t,e,r){if(It.isString(t))try{return(e||JSON.parse)(t),It.trim(t)}catch(l){if(l.name!=="SyntaxError")throw l}return(r||JSON.stringify)(t)}const qE={transitional:HR,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const l=r.getContentType()||"",h=l.indexOf("application/json")>-1,_=It.isObject(e);if(_&&It.isHTMLForm(e)&&(e=new FormData(e)),It.isFormData(e))return h?JSON.stringify(GR(e)):e;if(It.isArrayBuffer(e)||It.isBuffer(e)||It.isStream(e)||It.isFile(e)||It.isBlob(e)||It.isReadableStream(e))return e;if(It.isArrayBufferView(e))return e.buffer;if(It.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(_){if(l.indexOf("application/x-www-form-urlencoded")>-1)return u5(e,this.formSerializer).toString();if((s=It.isFileList(e))||l.indexOf("multipart/form-data")>-1){const I=this.env&&this.env.FormData;return Wx(s?{"files[]":e}:e,I&&new I,this.formSerializer)}}return _||h?(r.setContentType("application/json",!1),f5(e)):e}],transformResponse:[function(e){const r=this.transitional||qE.transitional,l=r&&r.forcedJSONParsing,h=this.responseType==="json";if(It.isResponse(e)||It.isReadableStream(e))return e;if(e&&It.isString(e)&&(l&&!this.responseType||h)){const y=!(r&&r.silentJSONParsing)&&h;try{return JSON.parse(e)}catch(s){if(y)throw s.name==="SyntaxError"?an.from(s,an.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Rr.classes.FormData,Blob:Rr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};It.forEach(["delete","get","head","post","put","patch"],t=>{qE.headers[t]={}});const WE=qE,p5=It.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),m5=t=>{const e={};let r,l,h;return t&&t.split(`
`).forEach(function(y){h=y.indexOf(":"),r=y.substring(0,h).trim().toLowerCase(),l=y.substring(h+1).trim(),!(!r||e[r]&&p5[r])&&(r==="set-cookie"?e[r]?e[r].push(l):e[r]=[l]:e[r]=e[r]?e[r]+", "+l:l)}),e},hC=Symbol("internals");function Pg(t){return t&&String(t).trim().toLowerCase()}function Ov(t){return t===!1||t==null?t:It.isArray(t)?t.map(Ov):String(t)}function g5(t){const e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=r.exec(t);)e[l[1]]=l[2];return e}const _5=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Vw(t,e,r,l,h){if(It.isFunction(l))return l.call(this,e,r);if(h&&(e=r),!!It.isString(e)){if(It.isString(l))return e.indexOf(l)!==-1;if(It.isRegExp(l))return l.test(e)}}function y5(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,l)=>r.toUpperCase()+l)}function v5(t,e){const r=It.toCamelCase(" "+e);["get","set","has"].forEach(l=>{Object.defineProperty(t,l+r,{value:function(h,_,y){return this[l].call(this,e,h,_,y)},configurable:!0})})}class Zx{constructor(e){e&&this.set(e)}set(e,r,l){const h=this;function _(s,I,O){const k=Pg(I);if(!k)throw new Error("header name must be a non-empty string");const j=It.findKey(h,k);(!j||h[j]===void 0||O===!0||O===void 0&&h[j]!==!1)&&(h[j||I]=Ov(s))}const y=(s,I)=>It.forEach(s,(O,k)=>_(O,k,I));if(It.isPlainObject(e)||e instanceof this.constructor)y(e,r);else if(It.isString(e)&&(e=e.trim())&&!_5(e))y(m5(e),r);else if(It.isHeaders(e))for(const[s,I]of e.entries())_(I,s,l);else e!=null&&_(r,e,l);return this}get(e,r){if(e=Pg(e),e){const l=It.findKey(this,e);if(l){const h=this[l];if(!r)return h;if(r===!0)return g5(h);if(It.isFunction(r))return r.call(this,h,l);if(It.isRegExp(r))return r.exec(h);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=Pg(e),e){const l=It.findKey(this,e);return!!(l&&this[l]!==void 0&&(!r||Vw(this,this[l],l,r)))}return!1}delete(e,r){const l=this;let h=!1;function _(y){if(y=Pg(y),y){const s=It.findKey(l,y);s&&(!r||Vw(l,l[s],s,r))&&(delete l[s],h=!0)}}return It.isArray(e)?e.forEach(_):_(e),h}clear(e){const r=Object.keys(this);let l=r.length,h=!1;for(;l--;){const _=r[l];(!e||Vw(this,this[_],_,e,!0))&&(delete this[_],h=!0)}return h}normalize(e){const r=this,l={};return It.forEach(this,(h,_)=>{const y=It.findKey(l,_);if(y){r[y]=Ov(h),delete r[_];return}const s=e?y5(_):String(_).trim();s!==_&&delete r[_],r[s]=Ov(h),l[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const r=Object.create(null);return It.forEach(this,(l,h)=>{l!=null&&l!==!1&&(r[h]=e&&It.isArray(l)?l.join(", "):l)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){const l=new this(e);return r.forEach(h=>l.set(h)),l}static accessor(e){const l=(this[hC]=this[hC]={accessors:{}}).accessors,h=this.prototype;function _(y){const s=Pg(y);l[s]||(v5(h,y),l[s]=!0)}return It.isArray(e)?e.forEach(_):_(e),this}}Zx.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);It.reduceDescriptors(Zx.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(l){this[r]=l}}});It.freezeMethods(Zx);const Fa=Zx;function Uw(t,e){const r=this||WE,l=e||r,h=Fa.from(l.headers);let _=l.data;return It.forEach(t,function(s){_=s.call(r,_,h.normalize(),e?e.status:void 0)}),h.normalize(),_}function qR(t){return!!(t&&t.__CANCEL__)}function Ip(t,e,r){an.call(this,t??"canceled",an.ERR_CANCELED,e,r),this.name="CanceledError"}It.inherits(Ip,an,{__CANCEL__:!0});function WR(t,e,r){const l=r.config.validateStatus;!r.status||!l||l(r.status)?t(r):e(new an("Request failed with status code "+r.status,[an.ERR_BAD_REQUEST,an.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function x5(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function b5(t,e){t=t||10;const r=new Array(t),l=new Array(t);let h=0,_=0,y;return e=e!==void 0?e:1e3,function(I){const O=Date.now(),k=l[_];y||(y=O),r[h]=I,l[h]=O;let j=_,Z=0;for(;j!==h;)Z+=r[j++],j=j%t;if(h=(h+1)%t,h===_&&(_=(_+1)%t),O-y<e)return;const Y=k&&O-k;return Y?Math.round(Z*1e3/Y):void 0}}function w5(t,e){let r=0,l=1e3/e,h,_;const y=(O,k=Date.now())=>{r=k,h=null,_&&(clearTimeout(_),_=null),t.apply(null,O)};return[(...O)=>{const k=Date.now(),j=k-r;j>=l?y(O,k):(h=O,_||(_=setTimeout(()=>{_=null,y(h)},l-j)))},()=>h&&y(h)]}const nx=(t,e,r=3)=>{let l=0;const h=b5(50,250);return w5(_=>{const y=_.loaded,s=_.lengthComputable?_.total:void 0,I=y-l,O=h(I),k=y<=s;l=y;const j={loaded:y,total:s,progress:s?y/s:void 0,bytes:I,rate:O||void 0,estimated:O&&s&&k?(s-y)/O:void 0,event:_,lengthComputable:s!=null,[e?"download":"upload"]:!0};t(j)},r)},dC=(t,e)=>{const r=t!=null;return[l=>e[0]({lengthComputable:r,total:t,loaded:l}),e[1]]},fC=t=>(...e)=>It.asap(()=>t(...e)),T5=Rr.hasStandardBrowserEnv?((t,e)=>r=>(r=new URL(r,Rr.origin),t.protocol===r.protocol&&t.host===r.host&&(e||t.port===r.port)))(new URL(Rr.origin),Rr.navigator&&/(msie|trident)/i.test(Rr.navigator.userAgent)):()=>!0,E5=Rr.hasStandardBrowserEnv?{write(t,e,r,l,h,_){const y=[t+"="+encodeURIComponent(e)];It.isNumber(r)&&y.push("expires="+new Date(r).toGMTString()),It.isString(l)&&y.push("path="+l),It.isString(h)&&y.push("domain="+h),_===!0&&y.push("secure"),document.cookie=y.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function S5(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function A5(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function ZR(t,e,r){let l=!S5(e);return t&&l||r==!1?A5(t,e):e}const pC=t=>t instanceof Fa?{...t}:t;function ld(t,e){e=e||{};const r={};function l(O,k,j,Z){return It.isPlainObject(O)&&It.isPlainObject(k)?It.merge.call({caseless:Z},O,k):It.isPlainObject(k)?It.merge({},k):It.isArray(k)?k.slice():k}function h(O,k,j,Z){if(It.isUndefined(k)){if(!It.isUndefined(O))return l(void 0,O,j,Z)}else return l(O,k,j,Z)}function _(O,k){if(!It.isUndefined(k))return l(void 0,k)}function y(O,k){if(It.isUndefined(k)){if(!It.isUndefined(O))return l(void 0,O)}else return l(void 0,k)}function s(O,k,j){if(j in e)return l(O,k);if(j in t)return l(void 0,O)}const I={url:_,method:_,data:_,baseURL:y,transformRequest:y,transformResponse:y,paramsSerializer:y,timeout:y,timeoutMessage:y,withCredentials:y,withXSRFToken:y,adapter:y,responseType:y,xsrfCookieName:y,xsrfHeaderName:y,onUploadProgress:y,onDownloadProgress:y,decompress:y,maxContentLength:y,maxBodyLength:y,beforeRedirect:y,transport:y,httpAgent:y,httpsAgent:y,cancelToken:y,socketPath:y,responseEncoding:y,validateStatus:s,headers:(O,k,j)=>h(pC(O),pC(k),j,!0)};return It.forEach(Object.keys(Object.assign({},t,e)),function(k){const j=I[k]||h,Z=j(t[k],e[k],k);It.isUndefined(Z)&&j!==s||(r[k]=Z)}),r}const XR=t=>{const e=ld({},t);let{data:r,withXSRFToken:l,xsrfHeaderName:h,xsrfCookieName:_,headers:y,auth:s}=e;e.headers=y=Fa.from(y),e.url=$R(ZR(e.baseURL,e.url),t.params,t.paramsSerializer),s&&y.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let I;if(It.isFormData(r)){if(Rr.hasStandardBrowserEnv||Rr.hasStandardBrowserWebWorkerEnv)y.setContentType(void 0);else if((I=y.getContentType())!==!1){const[O,...k]=I?I.split(";").map(j=>j.trim()).filter(Boolean):[];y.setContentType([O||"multipart/form-data",...k].join("; "))}}if(Rr.hasStandardBrowserEnv&&(l&&It.isFunction(l)&&(l=l(e)),l||l!==!1&&T5(e.url))){const O=h&&_&&E5.read(_);O&&y.set(h,O)}return e},M5=typeof XMLHttpRequest<"u",I5=M5&&function(t){return new Promise(function(r,l){const h=XR(t);let _=h.data;const y=Fa.from(h.headers).normalize();let{responseType:s,onUploadProgress:I,onDownloadProgress:O}=h,k,j,Z,Y,se;function ne(){Y&&Y(),se&&se(),h.cancelToken&&h.cancelToken.unsubscribe(k),h.signal&&h.signal.removeEventListener("abort",k)}let de=new XMLHttpRequest;de.open(h.method.toUpperCase(),h.url,!0),de.timeout=h.timeout;function me(){if(!de)return;const ge=Fa.from("getAllResponseHeaders"in de&&de.getAllResponseHeaders()),Ae={data:!s||s==="text"||s==="json"?de.responseText:de.response,status:de.status,statusText:de.statusText,headers:ge,config:t,request:de};WR(function(ze){r(ze),ne()},function(ze){l(ze),ne()},Ae),de=null}"onloadend"in de?de.onloadend=me:de.onreadystatechange=function(){!de||de.readyState!==4||de.status===0&&!(de.responseURL&&de.responseURL.indexOf("file:")===0)||setTimeout(me)},de.onabort=function(){de&&(l(new an("Request aborted",an.ECONNABORTED,t,de)),de=null)},de.onerror=function(){l(new an("Network Error",an.ERR_NETWORK,t,de)),de=null},de.ontimeout=function(){let fe=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded";const Ae=h.transitional||HR;h.timeoutErrorMessage&&(fe=h.timeoutErrorMessage),l(new an(fe,Ae.clarifyTimeoutError?an.ETIMEDOUT:an.ECONNABORTED,t,de)),de=null},_===void 0&&y.setContentType(null),"setRequestHeader"in de&&It.forEach(y.toJSON(),function(fe,Ae){de.setRequestHeader(Ae,fe)}),It.isUndefined(h.withCredentials)||(de.withCredentials=!!h.withCredentials),s&&s!=="json"&&(de.responseType=h.responseType),O&&([Z,se]=nx(O,!0),de.addEventListener("progress",Z)),I&&de.upload&&([j,Y]=nx(I),de.upload.addEventListener("progress",j),de.upload.addEventListener("loadend",Y)),(h.cancelToken||h.signal)&&(k=ge=>{de&&(l(!ge||ge.type?new Ip(null,t,de):ge),de.abort(),de=null)},h.cancelToken&&h.cancelToken.subscribe(k),h.signal&&(h.signal.aborted?k():h.signal.addEventListener("abort",k)));const Te=x5(h.url);if(Te&&Rr.protocols.indexOf(Te)===-1){l(new an("Unsupported protocol "+Te+":",an.ERR_BAD_REQUEST,t));return}de.send(_||null)})},C5=(t,e)=>{const{length:r}=t=t?t.filter(Boolean):[];if(e||r){let l=new AbortController,h;const _=function(O){if(!h){h=!0,s();const k=O instanceof Error?O:this.reason;l.abort(k instanceof an?k:new Ip(k instanceof Error?k.message:k))}};let y=e&&setTimeout(()=>{y=null,_(new an(`timeout ${e} of ms exceeded`,an.ETIMEDOUT))},e);const s=()=>{t&&(y&&clearTimeout(y),y=null,t.forEach(O=>{O.unsubscribe?O.unsubscribe(_):O.removeEventListener("abort",_)}),t=null)};t.forEach(O=>O.addEventListener("abort",_));const{signal:I}=l;return I.unsubscribe=()=>It.asap(s),I}},P5=C5,D5=function*(t,e){let r=t.byteLength;if(!e||r<e){yield t;return}let l=0,h;for(;l<r;)h=l+e,yield t.slice(l,h),l=h},R5=async function*(t,e){for await(const r of L5(t))yield*D5(r,e)},L5=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:r,value:l}=await e.read();if(r)break;yield l}}finally{await e.cancel()}},mC=(t,e,r,l)=>{const h=R5(t,e);let _=0,y,s=I=>{y||(y=!0,l&&l(I))};return new ReadableStream({async pull(I){try{const{done:O,value:k}=await h.next();if(O){s(),I.close();return}let j=k.byteLength;if(r){let Z=_+=j;r(Z)}I.enqueue(new Uint8Array(k))}catch(O){throw s(O),O}},cancel(I){return s(I),h.return()}},{highWaterMark:2})},Xx=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",YR=Xx&&typeof ReadableStream=="function",O5=Xx&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),KR=(t,...e)=>{try{return!!t(...e)}catch{return!1}},k5=YR&&KR(()=>{let t=!1;const e=new Request(Rr.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),gC=64*1024,NT=YR&&KR(()=>It.isReadableStream(new Response("").body)),sx={stream:NT&&(t=>t.body)};Xx&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!sx[e]&&(sx[e]=It.isFunction(t[e])?r=>r[e]():(r,l)=>{throw new an(`Response type '${e}' is not supported`,an.ERR_NOT_SUPPORT,l)})})})(new Response);const z5=async t=>{if(t==null)return 0;if(It.isBlob(t))return t.size;if(It.isSpecCompliantForm(t))return(await new Request(Rr.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(It.isArrayBufferView(t)||It.isArrayBuffer(t))return t.byteLength;if(It.isURLSearchParams(t)&&(t=t+""),It.isString(t))return(await O5(t)).byteLength},F5=async(t,e)=>{const r=It.toFiniteNumber(t.getContentLength());return r??z5(e)},B5=Xx&&(async t=>{let{url:e,method:r,data:l,signal:h,cancelToken:_,timeout:y,onDownloadProgress:s,onUploadProgress:I,responseType:O,headers:k,withCredentials:j="same-origin",fetchOptions:Z}=XR(t);O=O?(O+"").toLowerCase():"text";let Y=P5([h,_&&_.toAbortSignal()],y),se;const ne=Y&&Y.unsubscribe&&(()=>{Y.unsubscribe()});let de;try{if(I&&k5&&r!=="get"&&r!=="head"&&(de=await F5(k,l))!==0){let Ae=new Request(e,{method:"POST",body:l,duplex:"half"}),Ge;if(It.isFormData(l)&&(Ge=Ae.headers.get("content-type"))&&k.setContentType(Ge),Ae.body){const[ze,Ke]=dC(de,nx(fC(I)));l=mC(Ae.body,gC,ze,Ke)}}It.isString(j)||(j=j?"include":"omit");const me="credentials"in Request.prototype;se=new Request(e,{...Z,signal:Y,method:r.toUpperCase(),headers:k.normalize().toJSON(),body:l,duplex:"half",credentials:me?j:void 0});let Te=await fetch(se);const ge=NT&&(O==="stream"||O==="response");if(NT&&(s||ge&&ne)){const Ae={};["status","statusText","headers"].forEach(Xe=>{Ae[Xe]=Te[Xe]});const Ge=It.toFiniteNumber(Te.headers.get("content-length")),[ze,Ke]=s&&dC(Ge,nx(fC(s),!0))||[];Te=new Response(mC(Te.body,gC,ze,()=>{Ke&&Ke(),ne&&ne()}),Ae)}O=O||"text";let fe=await sx[It.findKey(sx,O)||"text"](Te,t);return!ge&&ne&&ne(),await new Promise((Ae,Ge)=>{WR(Ae,Ge,{data:fe,headers:Fa.from(Te.headers),status:Te.status,statusText:Te.statusText,config:t,request:se})})}catch(me){throw ne&&ne(),me&&me.name==="TypeError"&&/fetch/i.test(me.message)?Object.assign(new an("Network Error",an.ERR_NETWORK,t,se),{cause:me.cause||me}):an.from(me,me&&me.code,t,se)}}),VT={http:K4,xhr:I5,fetch:B5};It.forEach(VT,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const _C=t=>`- ${t}`,N5=t=>It.isFunction(t)||t===null||t===!1,JR={getAdapter:t=>{t=It.isArray(t)?t:[t];const{length:e}=t;let r,l;const h={};for(let _=0;_<e;_++){r=t[_];let y;if(l=r,!N5(r)&&(l=VT[(y=String(r)).toLowerCase()],l===void 0))throw new an(`Unknown adapter '${y}'`);if(l)break;h[y||"#"+_]=l}if(!l){const _=Object.entries(h).map(([s,I])=>`adapter ${s} `+(I===!1?"is not supported by the environment":"is not available in the build"));let y=e?_.length>1?`since :
`+_.map(_C).join(`
`):" "+_C(_[0]):"as no adapter specified";throw new an("There is no suitable adapter to dispatch the request "+y,"ERR_NOT_SUPPORT")}return l},adapters:VT};function jw(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ip(null,t)}function yC(t){return jw(t),t.headers=Fa.from(t.headers),t.data=Uw.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),JR.getAdapter(t.adapter||WE.adapter)(t).then(function(l){return jw(t),l.data=Uw.call(t,t.transformResponse,l),l.headers=Fa.from(l.headers),l},function(l){return qR(l)||(jw(t),l&&l.response&&(l.response.data=Uw.call(t,t.transformResponse,l.response),l.response.headers=Fa.from(l.response.headers))),Promise.reject(l)})}const QR="1.8.2",Yx={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Yx[t]=function(l){return typeof l===t||"a"+(e<1?"n ":" ")+t}});const vC={};Yx.transitional=function(e,r,l){function h(_,y){return"[Axios v"+QR+"] Transitional option '"+_+"'"+y+(l?". "+l:"")}return(_,y,s)=>{if(e===!1)throw new an(h(y," has been removed"+(r?" in "+r:"")),an.ERR_DEPRECATED);return r&&!vC[y]&&(vC[y]=!0,console.warn(h(y," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(_,y,s):!0}};Yx.spelling=function(e){return(r,l)=>(console.warn(`${l} is likely a misspelling of ${e}`),!0)};function V5(t,e,r){if(typeof t!="object")throw new an("options must be an object",an.ERR_BAD_OPTION_VALUE);const l=Object.keys(t);let h=l.length;for(;h-- >0;){const _=l[h],y=e[_];if(y){const s=t[_],I=s===void 0||y(s,_,t);if(I!==!0)throw new an("option "+_+" must be "+I,an.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new an("Unknown option "+_,an.ERR_BAD_OPTION)}}const kv={assertOptions:V5,validators:Yx},al=kv.validators;class rx{constructor(e){this.defaults=e,this.interceptors={request:new uC,response:new uC}}async request(e,r){try{return await this._request(e,r)}catch(l){if(l instanceof Error){let h={};Error.captureStackTrace?Error.captureStackTrace(h):h=new Error;const _=h.stack?h.stack.replace(/^.+\n/,""):"";try{l.stack?_&&!String(l.stack).endsWith(_.replace(/^.+\n.+\n/,""))&&(l.stack+=`
`+_):l.stack=_}catch{}}throw l}}_request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=ld(this.defaults,r);const{transitional:l,paramsSerializer:h,headers:_}=r;l!==void 0&&kv.assertOptions(l,{silentJSONParsing:al.transitional(al.boolean),forcedJSONParsing:al.transitional(al.boolean),clarifyTimeoutError:al.transitional(al.boolean)},!1),h!=null&&(It.isFunction(h)?r.paramsSerializer={serialize:h}:kv.assertOptions(h,{encode:al.function,serialize:al.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),kv.assertOptions(r,{baseUrl:al.spelling("baseURL"),withXsrfToken:al.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let y=_&&It.merge(_.common,_[r.method]);_&&It.forEach(["delete","get","head","post","put","patch","common"],se=>{delete _[se]}),r.headers=Fa.concat(y,_);const s=[];let I=!0;this.interceptors.request.forEach(function(ne){typeof ne.runWhen=="function"&&ne.runWhen(r)===!1||(I=I&&ne.synchronous,s.unshift(ne.fulfilled,ne.rejected))});const O=[];this.interceptors.response.forEach(function(ne){O.push(ne.fulfilled,ne.rejected)});let k,j=0,Z;if(!I){const se=[yC.bind(this),void 0];for(se.unshift.apply(se,s),se.push.apply(se,O),Z=se.length,k=Promise.resolve(r);j<Z;)k=k.then(se[j++],se[j++]);return k}Z=s.length;let Y=r;for(j=0;j<Z;){const se=s[j++],ne=s[j++];try{Y=se(Y)}catch(de){ne.call(this,de);break}}try{k=yC.call(this,Y)}catch(se){return Promise.reject(se)}for(j=0,Z=O.length;j<Z;)k=k.then(O[j++],O[j++]);return k}getUri(e){e=ld(this.defaults,e);const r=ZR(e.baseURL,e.url,e.allowAbsoluteUrls);return $R(r,e.params,e.paramsSerializer)}}It.forEach(["delete","get","head","options"],function(e){rx.prototype[e]=function(r,l){return this.request(ld(l||{},{method:e,url:r,data:(l||{}).data}))}});It.forEach(["post","put","patch"],function(e){function r(l){return function(_,y,s){return this.request(ld(s||{},{method:e,headers:l?{"Content-Type":"multipart/form-data"}:{},url:_,data:y}))}}rx.prototype[e]=r(),rx.prototype[e+"Form"]=r(!0)});const zv=rx;class ZE{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(_){r=_});const l=this;this.promise.then(h=>{if(!l._listeners)return;let _=l._listeners.length;for(;_-- >0;)l._listeners[_](h);l._listeners=null}),this.promise.then=h=>{let _;const y=new Promise(s=>{l.subscribe(s),_=s}).then(h);return y.cancel=function(){l.unsubscribe(_)},y},e(function(_,y,s){l.reason||(l.reason=new Ip(_,y,s),r(l.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const e=new AbortController,r=l=>{e.abort(l)};return this.subscribe(r),e.signal.unsubscribe=()=>this.unsubscribe(r),e.signal}static source(){let e;return{token:new ZE(function(h){e=h}),cancel:e}}}const U5=ZE;function j5(t){return function(r){return t.apply(null,r)}}function $5(t){return It.isObject(t)&&t.isAxiosError===!0}const UT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(UT).forEach(([t,e])=>{UT[e]=t});const H5=UT;function eL(t){const e=new zv(t),r=RR(zv.prototype.request,e);return It.extend(r,zv.prototype,e,{allOwnKeys:!0}),It.extend(r,e,null,{allOwnKeys:!0}),r.create=function(h){return eL(ld(t,h))},r}const qs=eL(WE);qs.Axios=zv;qs.CanceledError=Ip;qs.CancelToken=U5;qs.isCancel=qR;qs.VERSION=QR;qs.toFormData=Wx;qs.AxiosError=an;qs.Cancel=qs.CanceledError;qs.all=function(e){return Promise.all(e)};qs.spread=j5;qs.isAxiosError=$5;qs.mergeConfig=ld;qs.AxiosHeaders=Fa;qs.formToJSON=t=>GR(It.isHTMLForm(t)?new FormData(t):t);qs.getAdapter=JR.getAdapter;qs.HttpStatusCode=H5;qs.default=qs;const Ug=qs;window.axios=Ug;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";window.axios.defaults.baseURL="/public/api/";var Qr="top",Bo="bottom",No="right",eo="left",Kx="auto",Cp=[Qr,Bo,No,eo],cd="start",rp="end",tL="clippingParents",XE="viewport",Hf="popper",iL="reference",jT=Cp.reduce(function(t,e){return t.concat([e+"-"+cd,e+"-"+rp])},[]),YE=[].concat(Cp,[Kx]).reduce(function(t,e){return t.concat([e,e+"-"+cd,e+"-"+rp])},[]),nL="beforeRead",sL="read",rL="afterRead",oL="beforeMain",aL="main",lL="afterMain",cL="beforeWrite",uL="write",hL="afterWrite",dL=[nL,sL,rL,oL,aL,lL,cL,uL,hL];function gl(t){return t?(t.nodeName||"").toLowerCase():null}function Vo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function ud(t){var e=Vo(t).Element;return t instanceof e||t instanceof Element}function na(t){var e=Vo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function KE(t){if(typeof ShadowRoot>"u")return!1;var e=Vo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function G5(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var l=e.styles[r]||{},h=e.attributes[r]||{},_=e.elements[r];!na(_)||!gl(_)||(Object.assign(_.style,l),Object.keys(h).forEach(function(y){var s=h[y];s===!1?_.removeAttribute(y):_.setAttribute(y,s===!0?"":s)}))})}function q5(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(l){var h=e.elements[l],_=e.attributes[l]||{},y=Object.keys(e.styles.hasOwnProperty(l)?e.styles[l]:r[l]),s=y.reduce(function(I,O){return I[O]="",I},{});!na(h)||!gl(h)||(Object.assign(h.style,s),Object.keys(_).forEach(function(I){h.removeAttribute(I)}))})}}const JE={name:"applyStyles",enabled:!0,phase:"write",fn:G5,effect:q5,requires:["computeStyles"]};function fl(t){return t.split("-")[0]}var ed=Math.max,ox=Math.min,op=Math.round;function $T(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function fL(){return!/^((?!chrome|android).)*safari/i.test($T())}function ap(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var l=t.getBoundingClientRect(),h=1,_=1;e&&na(t)&&(h=t.offsetWidth>0&&op(l.width)/t.offsetWidth||1,_=t.offsetHeight>0&&op(l.height)/t.offsetHeight||1);var y=ud(t)?Vo(t):window,s=y.visualViewport,I=!fL()&&r,O=(l.left+(I&&s?s.offsetLeft:0))/h,k=(l.top+(I&&s?s.offsetTop:0))/_,j=l.width/h,Z=l.height/_;return{width:j,height:Z,top:k,right:O+j,bottom:k+Z,left:O,x:O,y:k}}function QE(t){var e=ap(t),r=t.offsetWidth,l=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-l)<=1&&(l=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:l}}function pL(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&KE(r)){var l=e;do{if(l&&t.isSameNode(l))return!0;l=l.parentNode||l.host}while(l)}return!1}function nc(t){return Vo(t).getComputedStyle(t)}function W5(t){return["table","td","th"].indexOf(gl(t))>=0}function zu(t){return((ud(t)?t.ownerDocument:t.document)||window.document).documentElement}function Jx(t){return gl(t)==="html"?t:t.assignedSlot||t.parentNode||(KE(t)?t.host:null)||zu(t)}function xC(t){return!na(t)||nc(t).position==="fixed"?null:t.offsetParent}function Z5(t){var e=/firefox/i.test($T()),r=/Trident/i.test($T());if(r&&na(t)){var l=nc(t);if(l.position==="fixed")return null}var h=Jx(t);for(KE(h)&&(h=h.host);na(h)&&["html","body"].indexOf(gl(h))<0;){var _=nc(h);if(_.transform!=="none"||_.perspective!=="none"||_.contain==="paint"||["transform","perspective"].indexOf(_.willChange)!==-1||e&&_.willChange==="filter"||e&&_.filter&&_.filter!=="none")return h;h=h.parentNode}return null}function $_(t){for(var e=Vo(t),r=xC(t);r&&W5(r)&&nc(r).position==="static";)r=xC(r);return r&&(gl(r)==="html"||gl(r)==="body"&&nc(r).position==="static")?e:r||Z5(t)||e}function eS(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Kg(t,e,r){return ed(t,ox(e,r))}function X5(t,e,r){var l=Kg(t,e,r);return l>r?r:l}function mL(){return{top:0,right:0,bottom:0,left:0}}function gL(t){return Object.assign({},mL(),t)}function _L(t,e){return e.reduce(function(r,l){return r[l]=t,r},{})}var Y5=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,gL(typeof e!="number"?e:_L(e,Cp))};function K5(t){var e,r=t.state,l=t.name,h=t.options,_=r.elements.arrow,y=r.modifiersData.popperOffsets,s=fl(r.placement),I=eS(s),O=[eo,No].indexOf(s)>=0,k=O?"height":"width";if(!(!_||!y)){var j=Y5(h.padding,r),Z=QE(_),Y=I==="y"?Qr:eo,se=I==="y"?Bo:No,ne=r.rects.reference[k]+r.rects.reference[I]-y[I]-r.rects.popper[k],de=y[I]-r.rects.reference[I],me=$_(_),Te=me?I==="y"?me.clientHeight||0:me.clientWidth||0:0,ge=ne/2-de/2,fe=j[Y],Ae=Te-Z[k]-j[se],Ge=Te/2-Z[k]/2+ge,ze=Kg(fe,Ge,Ae),Ke=I;r.modifiersData[l]=(e={},e[Ke]=ze,e.centerOffset=ze-Ge,e)}}function J5(t){var e=t.state,r=t.options,l=r.element,h=l===void 0?"[data-popper-arrow]":l;h!=null&&(typeof h=="string"&&(h=e.elements.popper.querySelector(h),!h)||pL(e.elements.popper,h)&&(e.elements.arrow=h))}const yL={name:"arrow",enabled:!0,phase:"main",fn:K5,effect:J5,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function lp(t){return t.split("-")[1]}var Q5={top:"auto",right:"auto",bottom:"auto",left:"auto"};function eV(t,e){var r=t.x,l=t.y,h=e.devicePixelRatio||1;return{x:op(r*h)/h||0,y:op(l*h)/h||0}}function bC(t){var e,r=t.popper,l=t.popperRect,h=t.placement,_=t.variation,y=t.offsets,s=t.position,I=t.gpuAcceleration,O=t.adaptive,k=t.roundOffsets,j=t.isFixed,Z=y.x,Y=Z===void 0?0:Z,se=y.y,ne=se===void 0?0:se,de=typeof k=="function"?k({x:Y,y:ne}):{x:Y,y:ne};Y=de.x,ne=de.y;var me=y.hasOwnProperty("x"),Te=y.hasOwnProperty("y"),ge=eo,fe=Qr,Ae=window;if(O){var Ge=$_(r),ze="clientHeight",Ke="clientWidth";if(Ge===Vo(r)&&(Ge=zu(r),nc(Ge).position!=="static"&&s==="absolute"&&(ze="scrollHeight",Ke="scrollWidth")),Ge=Ge,h===Qr||(h===eo||h===No)&&_===rp){fe=Bo;var Xe=j&&Ge===Ae&&Ae.visualViewport?Ae.visualViewport.height:Ge[ze];ne-=Xe-l.height,ne*=I?1:-1}if(h===eo||(h===Qr||h===Bo)&&_===rp){ge=No;var Ue=j&&Ge===Ae&&Ae.visualViewport?Ae.visualViewport.width:Ge[Ke];Y-=Ue-l.width,Y*=I?1:-1}}var et=Object.assign({position:s},O&&Q5),lt=k===!0?eV({x:Y,y:ne},Vo(r)):{x:Y,y:ne};if(Y=lt.x,ne=lt.y,I){var Mt;return Object.assign({},et,(Mt={},Mt[fe]=Te?"0":"",Mt[ge]=me?"0":"",Mt.transform=(Ae.devicePixelRatio||1)<=1?"translate("+Y+"px, "+ne+"px)":"translate3d("+Y+"px, "+ne+"px, 0)",Mt))}return Object.assign({},et,(e={},e[fe]=Te?ne+"px":"",e[ge]=me?Y+"px":"",e.transform="",e))}function tV(t){var e=t.state,r=t.options,l=r.gpuAcceleration,h=l===void 0?!0:l,_=r.adaptive,y=_===void 0?!0:_,s=r.roundOffsets,I=s===void 0?!0:s,O={placement:fl(e.placement),variation:lp(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:h,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,bC(Object.assign({},O,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:y,roundOffsets:I})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,bC(Object.assign({},O,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:I})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const tS={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:tV,data:{}};var X0={passive:!0};function iV(t){var e=t.state,r=t.instance,l=t.options,h=l.scroll,_=h===void 0?!0:h,y=l.resize,s=y===void 0?!0:y,I=Vo(e.elements.popper),O=[].concat(e.scrollParents.reference,e.scrollParents.popper);return _&&O.forEach(function(k){k.addEventListener("scroll",r.update,X0)}),s&&I.addEventListener("resize",r.update,X0),function(){_&&O.forEach(function(k){k.removeEventListener("scroll",r.update,X0)}),s&&I.removeEventListener("resize",r.update,X0)}}const iS={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:iV,data:{}};var nV={left:"right",right:"left",bottom:"top",top:"bottom"};function Fv(t){return t.replace(/left|right|bottom|top/g,function(e){return nV[e]})}var sV={start:"end",end:"start"};function wC(t){return t.replace(/start|end/g,function(e){return sV[e]})}function nS(t){var e=Vo(t),r=e.pageXOffset,l=e.pageYOffset;return{scrollLeft:r,scrollTop:l}}function sS(t){return ap(zu(t)).left+nS(t).scrollLeft}function rV(t,e){var r=Vo(t),l=zu(t),h=r.visualViewport,_=l.clientWidth,y=l.clientHeight,s=0,I=0;if(h){_=h.width,y=h.height;var O=fL();(O||!O&&e==="fixed")&&(s=h.offsetLeft,I=h.offsetTop)}return{width:_,height:y,x:s+sS(t),y:I}}function oV(t){var e,r=zu(t),l=nS(t),h=(e=t.ownerDocument)==null?void 0:e.body,_=ed(r.scrollWidth,r.clientWidth,h?h.scrollWidth:0,h?h.clientWidth:0),y=ed(r.scrollHeight,r.clientHeight,h?h.scrollHeight:0,h?h.clientHeight:0),s=-l.scrollLeft+sS(t),I=-l.scrollTop;return nc(h||r).direction==="rtl"&&(s+=ed(r.clientWidth,h?h.clientWidth:0)-_),{width:_,height:y,x:s,y:I}}function rS(t){var e=nc(t),r=e.overflow,l=e.overflowX,h=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+h+l)}function vL(t){return["html","body","#document"].indexOf(gl(t))>=0?t.ownerDocument.body:na(t)&&rS(t)?t:vL(Jx(t))}function Jg(t,e){var r;e===void 0&&(e=[]);var l=vL(t),h=l===((r=t.ownerDocument)==null?void 0:r.body),_=Vo(l),y=h?[_].concat(_.visualViewport||[],rS(l)?l:[]):l,s=e.concat(y);return h?s:s.concat(Jg(Jx(y)))}function HT(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function aV(t,e){var r=ap(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function TC(t,e,r){return e===XE?HT(rV(t,r)):ud(e)?aV(e,r):HT(oV(zu(t)))}function lV(t){var e=Jg(Jx(t)),r=["absolute","fixed"].indexOf(nc(t).position)>=0,l=r&&na(t)?$_(t):t;return ud(l)?e.filter(function(h){return ud(h)&&pL(h,l)&&gl(h)!=="body"}):[]}function cV(t,e,r,l){var h=e==="clippingParents"?lV(t):[].concat(e),_=[].concat(h,[r]),y=_[0],s=_.reduce(function(I,O){var k=TC(t,O,l);return I.top=ed(k.top,I.top),I.right=ox(k.right,I.right),I.bottom=ox(k.bottom,I.bottom),I.left=ed(k.left,I.left),I},TC(t,y,l));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function xL(t){var e=t.reference,r=t.element,l=t.placement,h=l?fl(l):null,_=l?lp(l):null,y=e.x+e.width/2-r.width/2,s=e.y+e.height/2-r.height/2,I;switch(h){case Qr:I={x:y,y:e.y-r.height};break;case Bo:I={x:y,y:e.y+e.height};break;case No:I={x:e.x+e.width,y:s};break;case eo:I={x:e.x-r.width,y:s};break;default:I={x:e.x,y:e.y}}var O=h?eS(h):null;if(O!=null){var k=O==="y"?"height":"width";switch(_){case cd:I[O]=I[O]-(e[k]/2-r[k]/2);break;case rp:I[O]=I[O]+(e[k]/2-r[k]/2);break}}return I}function cp(t,e){e===void 0&&(e={});var r=e,l=r.placement,h=l===void 0?t.placement:l,_=r.strategy,y=_===void 0?t.strategy:_,s=r.boundary,I=s===void 0?tL:s,O=r.rootBoundary,k=O===void 0?XE:O,j=r.elementContext,Z=j===void 0?Hf:j,Y=r.altBoundary,se=Y===void 0?!1:Y,ne=r.padding,de=ne===void 0?0:ne,me=gL(typeof de!="number"?de:_L(de,Cp)),Te=Z===Hf?iL:Hf,ge=t.rects.popper,fe=t.elements[se?Te:Z],Ae=cV(ud(fe)?fe:fe.contextElement||zu(t.elements.popper),I,k,y),Ge=ap(t.elements.reference),ze=xL({reference:Ge,element:ge,strategy:"absolute",placement:h}),Ke=HT(Object.assign({},ge,ze)),Xe=Z===Hf?Ke:Ge,Ue={top:Ae.top-Xe.top+me.top,bottom:Xe.bottom-Ae.bottom+me.bottom,left:Ae.left-Xe.left+me.left,right:Xe.right-Ae.right+me.right},et=t.modifiersData.offset;if(Z===Hf&&et){var lt=et[h];Object.keys(Ue).forEach(function(Mt){var si=[No,Bo].indexOf(Mt)>=0?1:-1,bt=[Qr,Bo].indexOf(Mt)>=0?"y":"x";Ue[Mt]+=lt[bt]*si})}return Ue}function uV(t,e){e===void 0&&(e={});var r=e,l=r.placement,h=r.boundary,_=r.rootBoundary,y=r.padding,s=r.flipVariations,I=r.allowedAutoPlacements,O=I===void 0?YE:I,k=lp(l),j=k?s?jT:jT.filter(function(se){return lp(se)===k}):Cp,Z=j.filter(function(se){return O.indexOf(se)>=0});Z.length===0&&(Z=j);var Y=Z.reduce(function(se,ne){return se[ne]=cp(t,{placement:ne,boundary:h,rootBoundary:_,padding:y})[fl(ne)],se},{});return Object.keys(Y).sort(function(se,ne){return Y[se]-Y[ne]})}function hV(t){if(fl(t)===Kx)return[];var e=Fv(t);return[wC(t),e,wC(e)]}function dV(t){var e=t.state,r=t.options,l=t.name;if(!e.modifiersData[l]._skip){for(var h=r.mainAxis,_=h===void 0?!0:h,y=r.altAxis,s=y===void 0?!0:y,I=r.fallbackPlacements,O=r.padding,k=r.boundary,j=r.rootBoundary,Z=r.altBoundary,Y=r.flipVariations,se=Y===void 0?!0:Y,ne=r.allowedAutoPlacements,de=e.options.placement,me=fl(de),Te=me===de,ge=I||(Te||!se?[Fv(de)]:hV(de)),fe=[de].concat(ge).reduce(function(ys,is){return ys.concat(fl(is)===Kx?uV(e,{placement:is,boundary:k,rootBoundary:j,padding:O,flipVariations:se,allowedAutoPlacements:ne}):is)},[]),Ae=e.rects.reference,Ge=e.rects.popper,ze=new Map,Ke=!0,Xe=fe[0],Ue=0;Ue<fe.length;Ue++){var et=fe[Ue],lt=fl(et),Mt=lp(et)===cd,si=[Qr,Bo].indexOf(lt)>=0,bt=si?"width":"height",Rt=cp(e,{placement:et,boundary:k,rootBoundary:j,altBoundary:Z,padding:O}),Kt=si?Mt?No:eo:Mt?Bo:Qr;Ae[bt]>Ge[bt]&&(Kt=Fv(Kt));var ii=Fv(Kt),qt=[];if(_&&qt.push(Rt[lt]<=0),s&&qt.push(Rt[Kt]<=0,Rt[ii]<=0),qt.every(function(ys){return ys})){Xe=et,Ke=!1;break}ze.set(et,qt)}if(Ke)for(var gn=se?3:1,Hn=function(is){var Sn=fe.find(function(hs){var Ns=ze.get(hs);if(Ns)return Ns.slice(0,is).every(function(Fr){return Fr})});if(Sn)return Xe=Sn,"break"},Ln=gn;Ln>0;Ln--){var li=Hn(Ln);if(li==="break")break}e.placement!==Xe&&(e.modifiersData[l]._skip=!0,e.placement=Xe,e.reset=!0)}}const bL={name:"flip",enabled:!0,phase:"main",fn:dV,requiresIfExists:["offset"],data:{_skip:!1}};function EC(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function SC(t){return[Qr,No,Bo,eo].some(function(e){return t[e]>=0})}function fV(t){var e=t.state,r=t.name,l=e.rects.reference,h=e.rects.popper,_=e.modifiersData.preventOverflow,y=cp(e,{elementContext:"reference"}),s=cp(e,{altBoundary:!0}),I=EC(y,l),O=EC(s,h,_),k=SC(I),j=SC(O);e.modifiersData[r]={referenceClippingOffsets:I,popperEscapeOffsets:O,isReferenceHidden:k,hasPopperEscaped:j},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":k,"data-popper-escaped":j})}const wL={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:fV};function pV(t,e,r){var l=fl(t),h=[eo,Qr].indexOf(l)>=0?-1:1,_=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,y=_[0],s=_[1];return y=y||0,s=(s||0)*h,[eo,No].indexOf(l)>=0?{x:s,y}:{x:y,y:s}}function mV(t){var e=t.state,r=t.options,l=t.name,h=r.offset,_=h===void 0?[0,0]:h,y=YE.reduce(function(k,j){return k[j]=pV(j,e.rects,_),k},{}),s=y[e.placement],I=s.x,O=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=I,e.modifiersData.popperOffsets.y+=O),e.modifiersData[l]=y}const TL={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:mV};function gV(t){var e=t.state,r=t.name;e.modifiersData[r]=xL({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const oS={name:"popperOffsets",enabled:!0,phase:"read",fn:gV,data:{}};function _V(t){return t==="x"?"y":"x"}function yV(t){var e=t.state,r=t.options,l=t.name,h=r.mainAxis,_=h===void 0?!0:h,y=r.altAxis,s=y===void 0?!1:y,I=r.boundary,O=r.rootBoundary,k=r.altBoundary,j=r.padding,Z=r.tether,Y=Z===void 0?!0:Z,se=r.tetherOffset,ne=se===void 0?0:se,de=cp(e,{boundary:I,rootBoundary:O,padding:j,altBoundary:k}),me=fl(e.placement),Te=lp(e.placement),ge=!Te,fe=eS(me),Ae=_V(fe),Ge=e.modifiersData.popperOffsets,ze=e.rects.reference,Ke=e.rects.popper,Xe=typeof ne=="function"?ne(Object.assign({},e.rects,{placement:e.placement})):ne,Ue=typeof Xe=="number"?{mainAxis:Xe,altAxis:Xe}:Object.assign({mainAxis:0,altAxis:0},Xe),et=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,lt={x:0,y:0};if(Ge){if(_){var Mt,si=fe==="y"?Qr:eo,bt=fe==="y"?Bo:No,Rt=fe==="y"?"height":"width",Kt=Ge[fe],ii=Kt+de[si],qt=Kt-de[bt],gn=Y?-Ke[Rt]/2:0,Hn=Te===cd?ze[Rt]:Ke[Rt],Ln=Te===cd?-Ke[Rt]:-ze[Rt],li=e.elements.arrow,ys=Y&&li?QE(li):{width:0,height:0},is=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:mL(),Sn=is[si],hs=is[bt],Ns=Kg(0,ze[Rt],ys[Rt]),Fr=ge?ze[Rt]/2-gn-Ns-Sn-Ue.mainAxis:Hn-Ns-Sn-Ue.mainAxis,ce=ge?-ze[Rt]/2+gn+Ns+hs+Ue.mainAxis:Ln+Ns+hs+Ue.mainAxis,dr=e.elements.arrow&&$_(e.elements.arrow),vr=dr?fe==="y"?dr.clientTop||0:dr.clientLeft||0:0,Ze=(Mt=et==null?void 0:et[fe])!=null?Mt:0,Ie=Kt+Fr-Ze-vr,wt=Kt+ce-Ze,Vt=Kg(Y?ox(ii,Ie):ii,Kt,Y?ed(qt,wt):qt);Ge[fe]=Vt,lt[fe]=Vt-Kt}if(s){var Bt,yt=fe==="x"?Qr:eo,Xt=fe==="x"?Bo:No,Zt=Ge[Ae],Yt=Ae==="y"?"height":"width",Ut=Zt+de[yt],Ei=Zt-de[Xt],At=[Qr,eo].indexOf(me)!==-1,ci=(Bt=et==null?void 0:et[Ae])!=null?Bt:0,Ai=At?Ut:Zt-ze[Yt]-Ke[Yt]-ci+Ue.altAxis,Xi=At?Zt+ze[Yt]+Ke[Yt]-ci-Ue.altAxis:Ei,ji=Y&&At?X5(Ai,Zt,Xi):Kg(Y?Ai:Ut,Zt,Y?Xi:Ei);Ge[Ae]=ji,lt[Ae]=ji-Zt}e.modifiersData[l]=lt}}const EL={name:"preventOverflow",enabled:!0,phase:"main",fn:yV,requiresIfExists:["offset"]};function vV(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function xV(t){return t===Vo(t)||!na(t)?nS(t):vV(t)}function bV(t){var e=t.getBoundingClientRect(),r=op(e.width)/t.offsetWidth||1,l=op(e.height)/t.offsetHeight||1;return r!==1||l!==1}function wV(t,e,r){r===void 0&&(r=!1);var l=na(e),h=na(e)&&bV(e),_=zu(e),y=ap(t,h,r),s={scrollLeft:0,scrollTop:0},I={x:0,y:0};return(l||!l&&!r)&&((gl(e)!=="body"||rS(_))&&(s=xV(e)),na(e)?(I=ap(e,!0),I.x+=e.clientLeft,I.y+=e.clientTop):_&&(I.x=sS(_))),{x:y.left+s.scrollLeft-I.x,y:y.top+s.scrollTop-I.y,width:y.width,height:y.height}}function TV(t){var e=new Map,r=new Set,l=[];t.forEach(function(_){e.set(_.name,_)});function h(_){r.add(_.name);var y=[].concat(_.requires||[],_.requiresIfExists||[]);y.forEach(function(s){if(!r.has(s)){var I=e.get(s);I&&h(I)}}),l.push(_)}return t.forEach(function(_){r.has(_.name)||h(_)}),l}function EV(t){var e=TV(t);return dL.reduce(function(r,l){return r.concat(e.filter(function(h){return h.phase===l}))},[])}function SV(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function AV(t){var e=t.reduce(function(r,l){var h=r[l.name];return r[l.name]=h?Object.assign({},h,l,{options:Object.assign({},h.options,l.options),data:Object.assign({},h.data,l.data)}):l,r},{});return Object.keys(e).map(function(r){return e[r]})}var AC={placement:"bottom",modifiers:[],strategy:"absolute"};function MC(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(l){return!(l&&typeof l.getBoundingClientRect=="function")})}function Qx(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,l=r===void 0?[]:r,h=e.defaultOptions,_=h===void 0?AC:h;return function(s,I,O){O===void 0&&(O=_);var k={placement:"bottom",orderedModifiers:[],options:Object.assign({},AC,_),modifiersData:{},elements:{reference:s,popper:I},attributes:{},styles:{}},j=[],Z=!1,Y={state:k,setOptions:function(me){var Te=typeof me=="function"?me(k.options):me;ne(),k.options=Object.assign({},_,k.options,Te),k.scrollParents={reference:ud(s)?Jg(s):s.contextElement?Jg(s.contextElement):[],popper:Jg(I)};var ge=EV(AV([].concat(l,k.options.modifiers)));return k.orderedModifiers=ge.filter(function(fe){return fe.enabled}),se(),Y.update()},forceUpdate:function(){if(!Z){var me=k.elements,Te=me.reference,ge=me.popper;if(MC(Te,ge)){k.rects={reference:wV(Te,$_(ge),k.options.strategy==="fixed"),popper:QE(ge)},k.reset=!1,k.placement=k.options.placement,k.orderedModifiers.forEach(function(Ue){return k.modifiersData[Ue.name]=Object.assign({},Ue.data)});for(var fe=0;fe<k.orderedModifiers.length;fe++){if(k.reset===!0){k.reset=!1,fe=-1;continue}var Ae=k.orderedModifiers[fe],Ge=Ae.fn,ze=Ae.options,Ke=ze===void 0?{}:ze,Xe=Ae.name;typeof Ge=="function"&&(k=Ge({state:k,options:Ke,name:Xe,instance:Y})||k)}}}},update:SV(function(){return new Promise(function(de){Y.forceUpdate(),de(k)})}),destroy:function(){ne(),Z=!0}};if(!MC(s,I))return Y;Y.setOptions(O).then(function(de){!Z&&O.onFirstUpdate&&O.onFirstUpdate(de)});function se(){k.orderedModifiers.forEach(function(de){var me=de.name,Te=de.options,ge=Te===void 0?{}:Te,fe=de.effect;if(typeof fe=="function"){var Ae=fe({state:k,name:me,instance:Y,options:ge}),Ge=function(){};j.push(Ae||Ge)}})}function ne(){j.forEach(function(de){return de()}),j=[]}return Y}}var MV=Qx(),IV=[iS,oS,tS,JE],CV=Qx({defaultModifiers:IV}),PV=[iS,oS,tS,JE,TL,bL,EL,yL,wL],aS=Qx({defaultModifiers:PV});const SL=Object.freeze(Object.defineProperty({__proto__:null,afterMain:lL,afterRead:rL,afterWrite:hL,applyStyles:JE,arrow:yL,auto:Kx,basePlacements:Cp,beforeMain:oL,beforeRead:nL,beforeWrite:cL,bottom:Bo,clippingParents:tL,computeStyles:tS,createPopper:aS,createPopperBase:MV,createPopperLite:CV,detectOverflow:cp,end:rp,eventListeners:iS,flip:bL,hide:wL,left:eo,main:aL,modifierPhases:dL,offset:TL,placements:YE,popper:Hf,popperGenerator:Qx,popperOffsets:oS,preventOverflow:EL,read:sL,reference:iL,right:No,start:cd,top:Qr,variationPlacements:jT,viewport:XE,write:uL},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const lu=new Map,$w={set(t,e,r){lu.has(t)||lu.set(t,new Map);const l=lu.get(t);if(!l.has(e)&&l.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(l.keys())[0]}.`);return}l.set(e,r)},get(t,e){return lu.has(t)&&lu.get(t).get(e)||null},remove(t,e){if(!lu.has(t))return;const r=lu.get(t);r.delete(e),r.size===0&&lu.delete(t)}},DV=1e6,RV=1e3,GT="transitionend",AL=t=>(t&&window.CSS&&window.CSS.escape&&(t=t.replace(/#([^\s"#']+)/g,(e,r)=>`#${CSS.escape(r)}`)),t),LV=t=>t==null?`${t}`:Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase(),OV=t=>{do t+=Math.floor(Math.random()*DV);while(document.getElementById(t));return t},kV=t=>{if(!t)return 0;let{transitionDuration:e,transitionDelay:r}=window.getComputedStyle(t);const l=Number.parseFloat(e),h=Number.parseFloat(r);return!l&&!h?0:(e=e.split(",")[0],r=r.split(",")[0],(Number.parseFloat(e)+Number.parseFloat(r))*RV)},ML=t=>{t.dispatchEvent(new Event(GT))},Ql=t=>!t||typeof t!="object"?!1:(typeof t.jquery<"u"&&(t=t[0]),typeof t.nodeType<"u"),Iu=t=>Ql(t)?t.jquery?t[0]:t:typeof t=="string"&&t.length>0?document.querySelector(AL(t)):null,Pp=t=>{if(!Ql(t)||t.getClientRects().length===0)return!1;const e=getComputedStyle(t).getPropertyValue("visibility")==="visible",r=t.closest("details:not([open])");if(!r)return e;if(r!==t){const l=t.closest("summary");if(l&&l.parentNode!==r||l===null)return!1}return e},Cu=t=>!t||t.nodeType!==Node.ELEMENT_NODE||t.classList.contains("disabled")?!0:typeof t.disabled<"u"?t.disabled:t.hasAttribute("disabled")&&t.getAttribute("disabled")!=="false",IL=t=>{if(!document.documentElement.attachShadow)return null;if(typeof t.getRootNode=="function"){const e=t.getRootNode();return e instanceof ShadowRoot?e:null}return t instanceof ShadowRoot?t:t.parentNode?IL(t.parentNode):null},ax=()=>{},H_=t=>{t.offsetHeight},CL=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Hw=[],zV=t=>{document.readyState==="loading"?(Hw.length||document.addEventListener("DOMContentLoaded",()=>{for(const e of Hw)e()}),Hw.push(t)):t()},ra=()=>document.documentElement.dir==="rtl",la=t=>{zV(()=>{const e=CL();if(e){const r=t.NAME,l=e.fn[r];e.fn[r]=t.jQueryInterface,e.fn[r].Constructor=t,e.fn[r].noConflict=()=>(e.fn[r]=l,t.jQueryInterface)}})},go=(t,e=[],r=t)=>typeof t=="function"?t(...e):r,PL=(t,e,r=!0)=>{if(!r){go(t);return}const l=5,h=kV(e)+l;let _=!1;const y=({target:s})=>{s===e&&(_=!0,e.removeEventListener(GT,y),go(t))};e.addEventListener(GT,y),setTimeout(()=>{_||ML(e)},h)},lS=(t,e,r,l)=>{const h=t.length;let _=t.indexOf(e);return _===-1?!r&&l?t[h-1]:t[0]:(_+=r?1:-1,l&&(_=(_+h)%h),t[Math.max(0,Math.min(_,h-1))])},FV=/[^.]*(?=\..*)\.|.*/,BV=/\..*/,NV=/::\d+$/,Gw={};let IC=1;const DL={mouseenter:"mouseover",mouseleave:"mouseout"},VV=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function RL(t,e){return e&&`${e}::${IC++}`||t.uidEvent||IC++}function LL(t){const e=RL(t);return t.uidEvent=e,Gw[e]=Gw[e]||{},Gw[e]}function UV(t,e){return function r(l){return cS(l,{delegateTarget:t}),r.oneOff&&Wt.off(t,l.type,e),e.apply(t,[l])}}function jV(t,e,r){return function l(h){const _=t.querySelectorAll(e);for(let{target:y}=h;y&&y!==this;y=y.parentNode)for(const s of _)if(s===y)return cS(h,{delegateTarget:y}),l.oneOff&&Wt.off(t,h.type,e,r),r.apply(y,[h])}}function OL(t,e,r=null){return Object.values(t).find(l=>l.callable===e&&l.delegationSelector===r)}function kL(t,e,r){const l=typeof e=="string",h=l?r:e||r;let _=zL(t);return VV.has(_)||(_=t),[l,h,_]}function CC(t,e,r,l,h){if(typeof e!="string"||!t)return;let[_,y,s]=kL(e,r,l);e in DL&&(y=(se=>function(ne){if(!ne.relatedTarget||ne.relatedTarget!==ne.delegateTarget&&!ne.delegateTarget.contains(ne.relatedTarget))return se.call(this,ne)})(y));const I=LL(t),O=I[s]||(I[s]={}),k=OL(O,y,_?r:null);if(k){k.oneOff=k.oneOff&&h;return}const j=RL(y,e.replace(FV,"")),Z=_?jV(t,r,y):UV(t,y);Z.delegationSelector=_?r:null,Z.callable=y,Z.oneOff=h,Z.uidEvent=j,O[j]=Z,t.addEventListener(s,Z,_)}function qT(t,e,r,l,h){const _=OL(e[r],l,h);_&&(t.removeEventListener(r,_,!!h),delete e[r][_.uidEvent])}function $V(t,e,r,l){const h=e[r]||{};for(const[_,y]of Object.entries(h))_.includes(l)&&qT(t,e,r,y.callable,y.delegationSelector)}function zL(t){return t=t.replace(BV,""),DL[t]||t}const Wt={on(t,e,r,l){CC(t,e,r,l,!1)},one(t,e,r,l){CC(t,e,r,l,!0)},off(t,e,r,l){if(typeof e!="string"||!t)return;const[h,_,y]=kL(e,r,l),s=y!==e,I=LL(t),O=I[y]||{},k=e.startsWith(".");if(typeof _<"u"){if(!Object.keys(O).length)return;qT(t,I,y,_,h?r:null);return}if(k)for(const j of Object.keys(I))$V(t,I,j,e.slice(1));for(const[j,Z]of Object.entries(O)){const Y=j.replace(NV,"");(!s||e.includes(Y))&&qT(t,I,y,Z.callable,Z.delegationSelector)}},trigger(t,e,r){if(typeof e!="string"||!t)return null;const l=CL(),h=zL(e),_=e!==h;let y=null,s=!0,I=!0,O=!1;_&&l&&(y=l.Event(e,r),l(t).trigger(y),s=!y.isPropagationStopped(),I=!y.isImmediatePropagationStopped(),O=y.isDefaultPrevented());const k=cS(new Event(e,{bubbles:s,cancelable:!0}),r);return O&&k.preventDefault(),I&&t.dispatchEvent(k),k.defaultPrevented&&y&&y.preventDefault(),k}};function cS(t,e={}){for(const[r,l]of Object.entries(e))try{t[r]=l}catch{Object.defineProperty(t,r,{configurable:!0,get(){return l}})}return t}function PC(t){if(t==="true")return!0;if(t==="false")return!1;if(t===Number(t).toString())return Number(t);if(t===""||t==="null")return null;if(typeof t!="string")return t;try{return JSON.parse(decodeURIComponent(t))}catch{return t}}function qw(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}const ec={setDataAttribute(t,e,r){t.setAttribute(`data-bs-${qw(e)}`,r)},removeDataAttribute(t,e){t.removeAttribute(`data-bs-${qw(e)}`)},getDataAttributes(t){if(!t)return{};const e={},r=Object.keys(t.dataset).filter(l=>l.startsWith("bs")&&!l.startsWith("bsConfig"));for(const l of r){let h=l.replace(/^bs/,"");h=h.charAt(0).toLowerCase()+h.slice(1,h.length),e[h]=PC(t.dataset[l])}return e},getDataAttribute(t,e){return PC(t.getAttribute(`data-bs-${qw(e)}`))}};let G_=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,r){const l=Ql(r)?ec.getDataAttribute(r,"config"):{};return{...this.constructor.Default,...typeof l=="object"?l:{},...Ql(r)?ec.getDataAttributes(r):{},...typeof e=="object"?e:{}}}_typeCheckConfig(e,r=this.constructor.DefaultType){for(const[l,h]of Object.entries(r)){const _=e[l],y=Ql(_)?"element":LV(_);if(!new RegExp(h).test(y))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${l}" provided type "${y}" but expected type "${h}".`)}}};const HV="5.3.3";class $a extends G_{constructor(e,r){super(),e=Iu(e),e&&(this._element=e,this._config=this._getConfig(r),$w.set(this._element,this.constructor.DATA_KEY,this))}dispose(){$w.remove(this._element,this.constructor.DATA_KEY),Wt.off(this._element,this.constructor.EVENT_KEY);for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,r,l=!0){PL(e,r,l)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return $w.get(Iu(e),this.DATA_KEY)}static getOrCreateInstance(e,r={}){return this.getInstance(e)||new this(e,typeof r=="object"?r:null)}static get VERSION(){return HV}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}}const Ww=t=>{let e=t.getAttribute("data-bs-target");if(!e||e==="#"){let r=t.getAttribute("href");if(!r||!r.includes("#")&&!r.startsWith("."))return null;r.includes("#")&&!r.startsWith("#")&&(r=`#${r.split("#")[1]}`),e=r&&r!=="#"?r.trim():null}return e?e.split(",").map(r=>AL(r)).join(","):null},ki={find(t,e=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(e,t))},findOne(t,e=document.documentElement){return Element.prototype.querySelector.call(e,t)},children(t,e){return[].concat(...t.children).filter(r=>r.matches(e))},parents(t,e){const r=[];let l=t.parentNode.closest(e);for(;l;)r.push(l),l=l.parentNode.closest(e);return r},prev(t,e){let r=t.previousElementSibling;for(;r;){if(r.matches(e))return[r];r=r.previousElementSibling}return[]},next(t,e){let r=t.nextElementSibling;for(;r;){if(r.matches(e))return[r];r=r.nextElementSibling}return[]},focusableChildren(t){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(r=>`${r}:not([tabindex^="-"])`).join(",");return this.find(e,t).filter(r=>!Cu(r)&&Pp(r))},getSelectorFromElement(t){const e=Ww(t);return e&&ki.findOne(e)?e:null},getElementFromSelector(t){const e=Ww(t);return e?ki.findOne(e):null},getMultipleElementsFromSelector(t){const e=Ww(t);return e?ki.find(e):[]}},e1=(t,e="hide")=>{const r=`click.dismiss${t.EVENT_KEY}`,l=t.NAME;Wt.on(document,r,`[data-bs-dismiss="${l}"]`,function(h){if(["A","AREA"].includes(this.tagName)&&h.preventDefault(),Cu(this))return;const _=ki.getElementFromSelector(this)||this.closest(`.${l}`);t.getOrCreateInstance(_)[e]()})},GV="alert",qV="bs.alert",FL=`.${qV}`,WV=`close${FL}`,ZV=`closed${FL}`,XV="fade",YV="show";class t1 extends $a{static get NAME(){return GV}close(){if(Wt.trigger(this._element,WV).defaultPrevented)return;this._element.classList.remove(YV);const r=this._element.classList.contains(XV);this._queueCallback(()=>this._destroyElement(),this._element,r)}_destroyElement(){this._element.remove(),Wt.trigger(this._element,ZV),this.dispose()}static jQueryInterface(e){return this.each(function(){const r=t1.getOrCreateInstance(this);if(typeof e=="string"){if(r[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);r[e](this)}})}}e1(t1,"close");la(t1);const KV="button",JV="bs.button",QV=`.${JV}`,eU=".data-api",tU="active",DC='[data-bs-toggle="button"]',iU=`click${QV}${eU}`;class i1 extends $a{static get NAME(){return KV}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(tU))}static jQueryInterface(e){return this.each(function(){const r=i1.getOrCreateInstance(this);e==="toggle"&&r[e]()})}}Wt.on(document,iU,DC,t=>{t.preventDefault();const e=t.target.closest(DC);i1.getOrCreateInstance(e).toggle()});la(i1);const nU="swipe",Dp=".bs.swipe",sU=`touchstart${Dp}`,rU=`touchmove${Dp}`,oU=`touchend${Dp}`,aU=`pointerdown${Dp}`,lU=`pointerup${Dp}`,cU="touch",uU="pen",hU="pointer-event",dU=40,fU={endCallback:null,leftCallback:null,rightCallback:null},pU={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class lx extends G_{constructor(e,r){super(),this._element=e,!(!e||!lx.isSupported())&&(this._config=this._getConfig(r),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return fU}static get DefaultType(){return pU}static get NAME(){return nU}dispose(){Wt.off(this._element,Dp)}_start(e){if(!this._supportPointerEvents){this._deltaX=e.touches[0].clientX;return}this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX)}_end(e){this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX-this._deltaX),this._handleSwipe(),go(this._config.endCallback)}_move(e){this._deltaX=e.touches&&e.touches.length>1?0:e.touches[0].clientX-this._deltaX}_handleSwipe(){const e=Math.abs(this._deltaX);if(e<=dU)return;const r=e/this._deltaX;this._deltaX=0,r&&go(r>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Wt.on(this._element,aU,e=>this._start(e)),Wt.on(this._element,lU,e=>this._end(e)),this._element.classList.add(hU)):(Wt.on(this._element,sU,e=>this._start(e)),Wt.on(this._element,rU,e=>this._move(e)),Wt.on(this._element,oU,e=>this._end(e)))}_eventIsPointerPenTouch(e){return this._supportPointerEvents&&(e.pointerType===uU||e.pointerType===cU)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const mU="carousel",gU="bs.carousel",Fu=`.${gU}`,BL=".data-api",_U="ArrowLeft",yU="ArrowRight",vU=500,Dg="next",Ff="prev",Gf="left",Bv="right",xU=`slide${Fu}`,Zw=`slid${Fu}`,bU=`keydown${Fu}`,wU=`mouseenter${Fu}`,TU=`mouseleave${Fu}`,EU=`dragstart${Fu}`,SU=`load${Fu}${BL}`,AU=`click${Fu}${BL}`,NL="carousel",Y0="active",MU="slide",IU="carousel-item-end",CU="carousel-item-start",PU="carousel-item-next",DU="carousel-item-prev",VL=".active",UL=".carousel-item",RU=VL+UL,LU=".carousel-item img",OU=".carousel-indicators",kU="[data-bs-slide], [data-bs-slide-to]",zU='[data-bs-ride="carousel"]',FU={[_U]:Bv,[yU]:Gf},BU={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},NU={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class q_ extends $a{constructor(e,r){super(e,r),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=ki.findOne(OU,this._element),this._addEventListeners(),this._config.ride===NL&&this.cycle()}static get Default(){return BU}static get DefaultType(){return NU}static get NAME(){return mU}next(){this._slide(Dg)}nextWhenVisible(){!document.hidden&&Pp(this._element)&&this.next()}prev(){this._slide(Ff)}pause(){this._isSliding&&ML(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){Wt.one(this._element,Zw,()=>this.cycle());return}this.cycle()}}to(e){const r=this._getItems();if(e>r.length-1||e<0)return;if(this._isSliding){Wt.one(this._element,Zw,()=>this.to(e));return}const l=this._getItemIndex(this._getActive());if(l===e)return;const h=e>l?Dg:Ff;this._slide(h,r[e])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(e){return e.defaultInterval=e.interval,e}_addEventListeners(){this._config.keyboard&&Wt.on(this._element,bU,e=>this._keydown(e)),this._config.pause==="hover"&&(Wt.on(this._element,wU,()=>this.pause()),Wt.on(this._element,TU,()=>this._maybeEnableCycle())),this._config.touch&&lx.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const l of ki.find(LU,this._element))Wt.on(l,EU,h=>h.preventDefault());const r={leftCallback:()=>this._slide(this._directionToOrder(Gf)),rightCallback:()=>this._slide(this._directionToOrder(Bv)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),vU+this._config.interval))}};this._swipeHelper=new lx(this._element,r)}_keydown(e){if(/input|textarea/i.test(e.target.tagName))return;const r=FU[e.key];r&&(e.preventDefault(),this._slide(this._directionToOrder(r)))}_getItemIndex(e){return this._getItems().indexOf(e)}_setActiveIndicatorElement(e){if(!this._indicatorsElement)return;const r=ki.findOne(VL,this._indicatorsElement);r.classList.remove(Y0),r.removeAttribute("aria-current");const l=ki.findOne(`[data-bs-slide-to="${e}"]`,this._indicatorsElement);l&&(l.classList.add(Y0),l.setAttribute("aria-current","true"))}_updateInterval(){const e=this._activeElement||this._getActive();if(!e)return;const r=Number.parseInt(e.getAttribute("data-bs-interval"),10);this._config.interval=r||this._config.defaultInterval}_slide(e,r=null){if(this._isSliding)return;const l=this._getActive(),h=e===Dg,_=r||lS(this._getItems(),l,h,this._config.wrap);if(_===l)return;const y=this._getItemIndex(_),s=Y=>Wt.trigger(this._element,Y,{relatedTarget:_,direction:this._orderToDirection(e),from:this._getItemIndex(l),to:y});if(s(xU).defaultPrevented||!l||!_)return;const O=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(y),this._activeElement=_;const k=h?CU:IU,j=h?PU:DU;_.classList.add(j),H_(_),l.classList.add(k),_.classList.add(k);const Z=()=>{_.classList.remove(k,j),_.classList.add(Y0),l.classList.remove(Y0,j,k),this._isSliding=!1,s(Zw)};this._queueCallback(Z,l,this._isAnimated()),O&&this.cycle()}_isAnimated(){return this._element.classList.contains(MU)}_getActive(){return ki.findOne(RU,this._element)}_getItems(){return ki.find(UL,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(e){return ra()?e===Gf?Ff:Dg:e===Gf?Dg:Ff}_orderToDirection(e){return ra()?e===Ff?Gf:Bv:e===Ff?Bv:Gf}static jQueryInterface(e){return this.each(function(){const r=q_.getOrCreateInstance(this,e);if(typeof e=="number"){r.to(e);return}if(typeof e=="string"){if(r[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);r[e]()}})}}Wt.on(document,AU,kU,function(t){const e=ki.getElementFromSelector(this);if(!e||!e.classList.contains(NL))return;t.preventDefault();const r=q_.getOrCreateInstance(e),l=this.getAttribute("data-bs-slide-to");if(l){r.to(l),r._maybeEnableCycle();return}if(ec.getDataAttribute(this,"slide")==="next"){r.next(),r._maybeEnableCycle();return}r.prev(),r._maybeEnableCycle()});Wt.on(window,SU,()=>{const t=ki.find(zU);for(const e of t)q_.getOrCreateInstance(e)});la(q_);const VU="collapse",UU="bs.collapse",W_=`.${UU}`,jU=".data-api",$U=`show${W_}`,HU=`shown${W_}`,GU=`hide${W_}`,qU=`hidden${W_}`,WU=`click${W_}${jU}`,Xw="show",Xf="collapse",K0="collapsing",ZU="collapsed",XU=`:scope .${Xf} .${Xf}`,YU="collapse-horizontal",KU="width",JU="height",QU=".collapse.show, .collapse.collapsing",WT='[data-bs-toggle="collapse"]',e6={parent:null,toggle:!0},t6={parent:"(null|element)",toggle:"boolean"};class g_ extends $a{constructor(e,r){super(e,r),this._isTransitioning=!1,this._triggerArray=[];const l=ki.find(WT);for(const h of l){const _=ki.getSelectorFromElement(h),y=ki.find(_).filter(s=>s===this._element);_!==null&&y.length&&this._triggerArray.push(h)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return e6}static get DefaultType(){return t6}static get NAME(){return VU}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let e=[];if(this._config.parent&&(e=this._getFirstLevelChildren(QU).filter(s=>s!==this._element).map(s=>g_.getOrCreateInstance(s,{toggle:!1}))),e.length&&e[0]._isTransitioning||Wt.trigger(this._element,$U).defaultPrevented)return;for(const s of e)s.hide();const l=this._getDimension();this._element.classList.remove(Xf),this._element.classList.add(K0),this._element.style[l]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const h=()=>{this._isTransitioning=!1,this._element.classList.remove(K0),this._element.classList.add(Xf,Xw),this._element.style[l]="",Wt.trigger(this._element,HU)},y=`scroll${l[0].toUpperCase()+l.slice(1)}`;this._queueCallback(h,this._element,!0),this._element.style[l]=`${this._element[y]}px`}hide(){if(this._isTransitioning||!this._isShown()||Wt.trigger(this._element,GU).defaultPrevented)return;const r=this._getDimension();this._element.style[r]=`${this._element.getBoundingClientRect()[r]}px`,H_(this._element),this._element.classList.add(K0),this._element.classList.remove(Xf,Xw);for(const h of this._triggerArray){const _=ki.getElementFromSelector(h);_&&!this._isShown(_)&&this._addAriaAndCollapsedClass([h],!1)}this._isTransitioning=!0;const l=()=>{this._isTransitioning=!1,this._element.classList.remove(K0),this._element.classList.add(Xf),Wt.trigger(this._element,qU)};this._element.style[r]="",this._queueCallback(l,this._element,!0)}_isShown(e=this._element){return e.classList.contains(Xw)}_configAfterMerge(e){return e.toggle=!!e.toggle,e.parent=Iu(e.parent),e}_getDimension(){return this._element.classList.contains(YU)?KU:JU}_initializeChildren(){if(!this._config.parent)return;const e=this._getFirstLevelChildren(WT);for(const r of e){const l=ki.getElementFromSelector(r);l&&this._addAriaAndCollapsedClass([r],this._isShown(l))}}_getFirstLevelChildren(e){const r=ki.find(XU,this._config.parent);return ki.find(e,this._config.parent).filter(l=>!r.includes(l))}_addAriaAndCollapsedClass(e,r){if(e.length)for(const l of e)l.classList.toggle(ZU,!r),l.setAttribute("aria-expanded",r)}static jQueryInterface(e){const r={};return typeof e=="string"&&/show|hide/.test(e)&&(r.toggle=!1),this.each(function(){const l=g_.getOrCreateInstance(this,r);if(typeof e=="string"){if(typeof l[e]>"u")throw new TypeError(`No method named "${e}"`);l[e]()}})}}Wt.on(document,WU,WT,function(t){(t.target.tagName==="A"||t.delegateTarget&&t.delegateTarget.tagName==="A")&&t.preventDefault();for(const e of ki.getMultipleElementsFromSelector(this))g_.getOrCreateInstance(e,{toggle:!1}).toggle()});la(g_);const RC="dropdown",i6="bs.dropdown",gd=`.${i6}`,uS=".data-api",n6="Escape",LC="Tab",s6="ArrowUp",OC="ArrowDown",r6=2,o6=`hide${gd}`,a6=`hidden${gd}`,l6=`show${gd}`,c6=`shown${gd}`,jL=`click${gd}${uS}`,$L=`keydown${gd}${uS}`,u6=`keyup${gd}${uS}`,qf="show",h6="dropup",d6="dropend",f6="dropstart",p6="dropup-center",m6="dropdown-center",Xh='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',g6=`${Xh}.${qf}`,Nv=".dropdown-menu",_6=".navbar",y6=".navbar-nav",v6=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",x6=ra()?"top-end":"top-start",b6=ra()?"top-start":"top-end",w6=ra()?"bottom-end":"bottom-start",T6=ra()?"bottom-start":"bottom-end",E6=ra()?"left-start":"right-start",S6=ra()?"right-start":"left-start",A6="top",M6="bottom",I6={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},C6={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class pl extends $a{constructor(e,r){super(e,r),this._popper=null,this._parent=this._element.parentNode,this._menu=ki.next(this._element,Nv)[0]||ki.prev(this._element,Nv)[0]||ki.findOne(Nv,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return I6}static get DefaultType(){return C6}static get NAME(){return RC}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Cu(this._element)||this._isShown())return;const e={relatedTarget:this._element};if(!Wt.trigger(this._element,l6,e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(y6))for(const l of[].concat(...document.body.children))Wt.on(l,"mouseover",ax);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(qf),this._element.classList.add(qf),Wt.trigger(this._element,c6,e)}}hide(){if(Cu(this._element)||!this._isShown())return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!Wt.trigger(this._element,o6,e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const l of[].concat(...document.body.children))Wt.off(l,"mouseover",ax);this._popper&&this._popper.destroy(),this._menu.classList.remove(qf),this._element.classList.remove(qf),this._element.setAttribute("aria-expanded","false"),ec.removeDataAttribute(this._menu,"popper"),Wt.trigger(this._element,a6,e)}}_getConfig(e){if(e=super._getConfig(e),typeof e.reference=="object"&&!Ql(e.reference)&&typeof e.reference.getBoundingClientRect!="function")throw new TypeError(`${RC.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(){if(typeof SL>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let e=this._element;this._config.reference==="parent"?e=this._parent:Ql(this._config.reference)?e=Iu(this._config.reference):typeof this._config.reference=="object"&&(e=this._config.reference);const r=this._getPopperConfig();this._popper=aS(e,this._menu,r)}_isShown(){return this._menu.classList.contains(qf)}_getPlacement(){const e=this._parent;if(e.classList.contains(d6))return E6;if(e.classList.contains(f6))return S6;if(e.classList.contains(p6))return A6;if(e.classList.contains(m6))return M6;const r=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return e.classList.contains(h6)?r?b6:x6:r?T6:w6}_detectNavbar(){return this._element.closest(_6)!==null}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(r=>Number.parseInt(r,10)):typeof e=="function"?r=>e(r,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(ec.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,...go(this._config.popperConfig,[e])}}_selectMenuItem({key:e,target:r}){const l=ki.find(v6,this._menu).filter(h=>Pp(h));l.length&&lS(l,r,e===OC,!l.includes(r)).focus()}static jQueryInterface(e){return this.each(function(){const r=pl.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof r[e]>"u")throw new TypeError(`No method named "${e}"`);r[e]()}})}static clearMenus(e){if(e.button===r6||e.type==="keyup"&&e.key!==LC)return;const r=ki.find(g6);for(const l of r){const h=pl.getInstance(l);if(!h||h._config.autoClose===!1)continue;const _=e.composedPath(),y=_.includes(h._menu);if(_.includes(h._element)||h._config.autoClose==="inside"&&!y||h._config.autoClose==="outside"&&y||h._menu.contains(e.target)&&(e.type==="keyup"&&e.key===LC||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const s={relatedTarget:h._element};e.type==="click"&&(s.clickEvent=e),h._completeHide(s)}}static dataApiKeydownHandler(e){const r=/input|textarea/i.test(e.target.tagName),l=e.key===n6,h=[s6,OC].includes(e.key);if(!h&&!l||r&&!l)return;e.preventDefault();const _=this.matches(Xh)?this:ki.prev(this,Xh)[0]||ki.next(this,Xh)[0]||ki.findOne(Xh,e.delegateTarget.parentNode),y=pl.getOrCreateInstance(_);if(h){e.stopPropagation(),y.show(),y._selectMenuItem(e);return}y._isShown()&&(e.stopPropagation(),y.hide(),_.focus())}}Wt.on(document,$L,Xh,pl.dataApiKeydownHandler);Wt.on(document,$L,Nv,pl.dataApiKeydownHandler);Wt.on(document,jL,pl.clearMenus);Wt.on(document,u6,pl.clearMenus);Wt.on(document,jL,Xh,function(t){t.preventDefault(),pl.getOrCreateInstance(this).toggle()});la(pl);const HL="backdrop",P6="fade",kC="show",zC=`mousedown.bs.${HL}`,D6={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},R6={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class GL extends G_{constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}static get Default(){return D6}static get DefaultType(){return R6}static get NAME(){return HL}show(e){if(!this._config.isVisible){go(e);return}this._append();const r=this._getElement();this._config.isAnimated&&H_(r),r.classList.add(kC),this._emulateAnimation(()=>{go(e)})}hide(e){if(!this._config.isVisible){go(e);return}this._getElement().classList.remove(kC),this._emulateAnimation(()=>{this.dispose(),go(e)})}dispose(){this._isAppended&&(Wt.off(this._element,zC),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add(P6),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=Iu(e.rootElement),e}_append(){if(this._isAppended)return;const e=this._getElement();this._config.rootElement.append(e),Wt.on(e,zC,()=>{go(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(e){PL(e,this._getElement(),this._config.isAnimated)}}const L6="focustrap",O6="bs.focustrap",cx=`.${O6}`,k6=`focusin${cx}`,z6=`keydown.tab${cx}`,F6="Tab",B6="forward",FC="backward",N6={autofocus:!0,trapElement:null},V6={autofocus:"boolean",trapElement:"element"};class qL extends G_{constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return N6}static get DefaultType(){return V6}static get NAME(){return L6}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Wt.off(document,cx),Wt.on(document,k6,e=>this._handleFocusin(e)),Wt.on(document,z6,e=>this._handleKeydown(e)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Wt.off(document,cx))}_handleFocusin(e){const{trapElement:r}=this._config;if(e.target===document||e.target===r||r.contains(e.target))return;const l=ki.focusableChildren(r);l.length===0?r.focus():this._lastTabNavDirection===FC?l[l.length-1].focus():l[0].focus()}_handleKeydown(e){e.key===F6&&(this._lastTabNavDirection=e.shiftKey?FC:B6)}}const BC=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",NC=".sticky-top",J0="padding-right",VC="margin-right";class ZT{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,J0,r=>r+e),this._setElementAttributes(BC,J0,r=>r+e),this._setElementAttributes(NC,VC,r=>r-e)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,J0),this._resetElementAttributes(BC,J0),this._resetElementAttributes(NC,VC)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,r,l){const h=this.getWidth(),_=y=>{if(y!==this._element&&window.innerWidth>y.clientWidth+h)return;this._saveInitialAttribute(y,r);const s=window.getComputedStyle(y).getPropertyValue(r);y.style.setProperty(r,`${l(Number.parseFloat(s))}px`)};this._applyManipulationCallback(e,_)}_saveInitialAttribute(e,r){const l=e.style.getPropertyValue(r);l&&ec.setDataAttribute(e,r,l)}_resetElementAttributes(e,r){const l=h=>{const _=ec.getDataAttribute(h,r);if(_===null){h.style.removeProperty(r);return}ec.removeDataAttribute(h,r),h.style.setProperty(r,_)};this._applyManipulationCallback(e,l)}_applyManipulationCallback(e,r){if(Ql(e)){r(e);return}for(const l of ki.find(e,this._element))r(l)}}const U6="modal",j6="bs.modal",oa=`.${j6}`,$6=".data-api",H6="Escape",G6=`hide${oa}`,q6=`hidePrevented${oa}`,WL=`hidden${oa}`,ZL=`show${oa}`,W6=`shown${oa}`,Z6=`resize${oa}`,X6=`click.dismiss${oa}`,Y6=`mousedown.dismiss${oa}`,K6=`keydown.dismiss${oa}`,J6=`click${oa}${$6}`,UC="modal-open",Q6="fade",jC="show",Yw="modal-static",ej=".modal.show",tj=".modal-dialog",ij=".modal-body",nj='[data-bs-toggle="modal"]',sj={backdrop:!0,focus:!0,keyboard:!0},rj={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class tc extends $a{constructor(e,r){super(e,r),this._dialog=ki.findOne(tj,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new ZT,this._addEventListeners()}static get Default(){return sj}static get DefaultType(){return rj}static get NAME(){return U6}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||this._isTransitioning||Wt.trigger(this._element,ZL,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(UC),this._adjustDialog(),this._backdrop.show(()=>this._showElement(e)))}hide(){!this._isShown||this._isTransitioning||Wt.trigger(this._element,G6).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(jC),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){Wt.off(window,oa),Wt.off(this._dialog,oa),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new GL({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new qL({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const r=ki.findOne(ij,this._dialog);r&&(r.scrollTop=0),H_(this._element),this._element.classList.add(jC);const l=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Wt.trigger(this._element,W6,{relatedTarget:e})};this._queueCallback(l,this._dialog,this._isAnimated())}_addEventListeners(){Wt.on(this._element,K6,e=>{if(e.key===H6){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),Wt.on(window,Z6,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Wt.on(this._element,Y6,e=>{Wt.one(this._element,X6,r=>{if(!(this._element!==e.target||this._element!==r.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(UC),this._resetAdjustments(),this._scrollBar.reset(),Wt.trigger(this._element,WL)})}_isAnimated(){return this._element.classList.contains(Q6)}_triggerBackdropTransition(){if(Wt.trigger(this._element,q6).defaultPrevented)return;const r=this._element.scrollHeight>document.documentElement.clientHeight,l=this._element.style.overflowY;l==="hidden"||this._element.classList.contains(Yw)||(r||(this._element.style.overflowY="hidden"),this._element.classList.add(Yw),this._queueCallback(()=>{this._element.classList.remove(Yw),this._queueCallback(()=>{this._element.style.overflowY=l},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,r=this._scrollBar.getWidth(),l=r>0;if(l&&!e){const h=ra()?"paddingLeft":"paddingRight";this._element.style[h]=`${r}px`}if(!l&&e){const h=ra()?"paddingRight":"paddingLeft";this._element.style[h]=`${r}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,r){return this.each(function(){const l=tc.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof l[e]>"u")throw new TypeError(`No method named "${e}"`);l[e](r)}})}}Wt.on(document,J6,nj,function(t){const e=ki.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&t.preventDefault(),Wt.one(e,ZL,h=>{h.defaultPrevented||Wt.one(e,WL,()=>{Pp(this)&&this.focus()})});const r=ki.findOne(ej);r&&tc.getInstance(r).hide(),tc.getOrCreateInstance(e).toggle(this)});e1(tc);la(tc);const oj="offcanvas",aj="bs.offcanvas",oc=`.${aj}`,XL=".data-api",lj=`load${oc}${XL}`,cj="Escape",$C="show",HC="showing",GC="hiding",uj="offcanvas-backdrop",YL=".offcanvas.show",hj=`show${oc}`,dj=`shown${oc}`,fj=`hide${oc}`,qC=`hidePrevented${oc}`,KL=`hidden${oc}`,pj=`resize${oc}`,mj=`click${oc}${XL}`,gj=`keydown.dismiss${oc}`,_j='[data-bs-toggle="offcanvas"]',yj={backdrop:!0,keyboard:!0,scroll:!1},vj={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Pu extends $a{constructor(e,r){super(e,r),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return yj}static get DefaultType(){return vj}static get NAME(){return oj}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||Wt.trigger(this._element,hj,{relatedTarget:e}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new ZT().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(HC);const l=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add($C),this._element.classList.remove(HC),Wt.trigger(this._element,dj,{relatedTarget:e})};this._queueCallback(l,this._element,!0)}hide(){if(!this._isShown||Wt.trigger(this._element,fj).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(GC),this._backdrop.hide();const r=()=>{this._element.classList.remove($C,GC),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new ZT().reset(),Wt.trigger(this._element,KL)};this._queueCallback(r,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const e=()=>{if(this._config.backdrop==="static"){Wt.trigger(this._element,qC);return}this.hide()},r=!!this._config.backdrop;return new GL({className:uj,isVisible:r,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:r?e:null})}_initializeFocusTrap(){return new qL({trapElement:this._element})}_addEventListeners(){Wt.on(this._element,gj,e=>{if(e.key===cj){if(this._config.keyboard){this.hide();return}Wt.trigger(this._element,qC)}})}static jQueryInterface(e){return this.each(function(){const r=Pu.getOrCreateInstance(this,e);if(typeof e=="string"){if(r[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);r[e](this)}})}}Wt.on(document,mj,_j,function(t){const e=ki.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&t.preventDefault(),Cu(this))return;Wt.one(e,KL,()=>{Pp(this)&&this.focus()});const r=ki.findOne(YL);r&&r!==e&&Pu.getInstance(r).hide(),Pu.getOrCreateInstance(e).toggle(this)});Wt.on(window,lj,()=>{for(const t of ki.find(YL))Pu.getOrCreateInstance(t).show()});Wt.on(window,pj,()=>{for(const t of ki.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(t).position!=="fixed"&&Pu.getOrCreateInstance(t).hide()});e1(Pu);la(Pu);const xj=/^aria-[\w-]*$/i,JL={"*":["class","dir","id","lang","role",xj],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},bj=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),wj=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Tj=(t,e)=>{const r=t.nodeName.toLowerCase();return e.includes(r)?bj.has(r)?!!wj.test(t.nodeValue):!0:e.filter(l=>l instanceof RegExp).some(l=>l.test(r))};function Ej(t,e,r){if(!t.length)return t;if(r&&typeof r=="function")return r(t);const h=new window.DOMParser().parseFromString(t,"text/html"),_=[].concat(...h.body.querySelectorAll("*"));for(const y of _){const s=y.nodeName.toLowerCase();if(!Object.keys(e).includes(s)){y.remove();continue}const I=[].concat(...y.attributes),O=[].concat(e["*"]||[],e[s]||[]);for(const k of I)Tj(k,O)||y.removeAttribute(k.nodeName)}return h.body.innerHTML}const Sj="TemplateFactory",Aj={allowList:JL,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Mj={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Ij={entry:"(string|element|function|null)",selector:"(string|element)"};class Cj extends G_{constructor(e){super(),this._config=this._getConfig(e)}static get Default(){return Aj}static get DefaultType(){return Mj}static get NAME(){return Sj}getContent(){return Object.values(this._config.content).map(e=>this._resolvePossibleFunction(e)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content={...this._config.content,...e},this}toHtml(){const e=document.createElement("div");e.innerHTML=this._maybeSanitize(this._config.template);for(const[h,_]of Object.entries(this._config.content))this._setContent(e,_,h);const r=e.children[0],l=this._resolvePossibleFunction(this._config.extraClass);return l&&r.classList.add(...l.split(" ")),r}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[r,l]of Object.entries(e))super._typeCheckConfig({selector:r,entry:l},Ij)}_setContent(e,r,l){const h=ki.findOne(l,e);if(h){if(r=this._resolvePossibleFunction(r),!r){h.remove();return}if(Ql(r)){this._putElementInTemplate(Iu(r),h);return}if(this._config.html){h.innerHTML=this._maybeSanitize(r);return}h.textContent=r}}_maybeSanitize(e){return this._config.sanitize?Ej(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return go(e,[this])}_putElementInTemplate(e,r){if(this._config.html){r.innerHTML="",r.append(e);return}r.textContent=e.textContent}}const Pj="tooltip",Dj=new Set(["sanitize","allowList","sanitizeFn"]),Kw="fade",Rj="modal",Q0="show",Lj=".tooltip-inner",WC=`.${Rj}`,ZC="hide.bs.modal",Rg="hover",Jw="focus",Oj="click",kj="manual",zj="hide",Fj="hidden",Bj="show",Nj="shown",Vj="inserted",Uj="click",jj="focusin",$j="focusout",Hj="mouseenter",Gj="mouseleave",qj={AUTO:"auto",TOP:"top",RIGHT:ra()?"left":"right",BOTTOM:"bottom",LEFT:ra()?"right":"left"},Wj={allowList:JL,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Zj={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};let n1=class QL extends $a{constructor(e,r){if(typeof SL>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e,r),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Wj}static get DefaultType(){return Zj}static get NAME(){return Pj}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),Wt.off(this._element.closest(WC),ZC,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const e=Wt.trigger(this._element,this.constructor.eventName(Bj)),l=(IL(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(e.defaultPrevented||!l)return;this._disposePopper();const h=this._getTipElement();this._element.setAttribute("aria-describedby",h.getAttribute("id"));const{container:_}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(_.append(h),Wt.trigger(this._element,this.constructor.eventName(Vj))),this._popper=this._createPopper(h),h.classList.add(Q0),"ontouchstart"in document.documentElement)for(const s of[].concat(...document.body.children))Wt.on(s,"mouseover",ax);const y=()=>{Wt.trigger(this._element,this.constructor.eventName(Nj)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(y,this.tip,this._isAnimated())}hide(){if(!this._isShown()||Wt.trigger(this._element,this.constructor.eventName(zj)).defaultPrevented)return;if(this._getTipElement().classList.remove(Q0),"ontouchstart"in document.documentElement)for(const h of[].concat(...document.body.children))Wt.off(h,"mouseover",ax);this._activeTrigger[Oj]=!1,this._activeTrigger[Jw]=!1,this._activeTrigger[Rg]=!1,this._isHovered=null;const l=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Wt.trigger(this._element,this.constructor.eventName(Fj)))};this._queueCallback(l,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const r=this._getTemplateFactory(e).toHtml();if(!r)return null;r.classList.remove(Kw,Q0),r.classList.add(`bs-${this.constructor.NAME}-auto`);const l=OV(this.constructor.NAME).toString();return r.setAttribute("id",l),this._isAnimated()&&r.classList.add(Kw),r}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new Cj({...this._config,content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[Lj]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Kw)}_isShown(){return this.tip&&this.tip.classList.contains(Q0)}_createPopper(e){const r=go(this._config.placement,[this,e,this._element]),l=qj[r.toUpperCase()];return aS(this._element,e,this._getPopperConfig(l))}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(r=>Number.parseInt(r,10)):typeof e=="function"?r=>e(r,this._element):e}_resolvePossibleFunction(e){return go(e,[this._element])}_getPopperConfig(e){const r={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:l=>{this._getTipElement().setAttribute("data-popper-placement",l.state.placement)}}]};return{...r,...go(this._config.popperConfig,[r])}}_setListeners(){const e=this._config.trigger.split(" ");for(const r of e)if(r==="click")Wt.on(this._element,this.constructor.eventName(Uj),this._config.selector,l=>{this._initializeOnDelegatedTarget(l).toggle()});else if(r!==kj){const l=r===Rg?this.constructor.eventName(Hj):this.constructor.eventName(jj),h=r===Rg?this.constructor.eventName(Gj):this.constructor.eventName($j);Wt.on(this._element,l,this._config.selector,_=>{const y=this._initializeOnDelegatedTarget(_);y._activeTrigger[_.type==="focusin"?Jw:Rg]=!0,y._enter()}),Wt.on(this._element,h,this._config.selector,_=>{const y=this._initializeOnDelegatedTarget(_);y._activeTrigger[_.type==="focusout"?Jw:Rg]=y._element.contains(_.relatedTarget),y._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Wt.on(this._element.closest(WC),ZC,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title");e&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(e,r){clearTimeout(this._timeout),this._timeout=setTimeout(e,r)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const r=ec.getDataAttributes(this._element);for(const l of Object.keys(r))Dj.has(l)&&delete r[l];return e={...r,...typeof e=="object"&&e?e:{}},e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=e.container===!1?document.body:Iu(e.container),typeof e.delay=="number"&&(e.delay={show:e.delay,hide:e.delay}),typeof e.title=="number"&&(e.title=e.title.toString()),typeof e.content=="number"&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={};for(const[r,l]of Object.entries(this._config))this.constructor.Default[r]!==l&&(e[r]=l);return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each(function(){const r=QL.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof r[e]>"u")throw new TypeError(`No method named "${e}"`);r[e]()}})}};la(n1);const Xj="popover",Yj=".popover-header",Kj=".popover-body",Jj={...n1.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Qj={...n1.DefaultType,content:"(null|string|element|function)"};class hS extends n1{static get Default(){return Jj}static get DefaultType(){return Qj}static get NAME(){return Xj}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Yj]:this._getTitle(),[Kj]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each(function(){const r=hS.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof r[e]>"u")throw new TypeError(`No method named "${e}"`);r[e]()}})}}la(hS);const e8="scrollspy",t8="bs.scrollspy",dS=`.${t8}`,i8=".data-api",n8=`activate${dS}`,XC=`click${dS}`,s8=`load${dS}${i8}`,r8="dropdown-item",Bf="active",o8='[data-bs-spy="scroll"]',Qw="[href]",a8=".nav, .list-group",YC=".nav-link",l8=".nav-item",c8=".list-group-item",u8=`${YC}, ${l8} > ${YC}, ${c8}`,h8=".dropdown",d8=".dropdown-toggle",f8={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},p8={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class s1 extends $a{constructor(e,r){super(e,r),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return f8}static get DefaultType(){return p8}static get NAME(){return e8}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const e of this._observableSections.values())this._observer.observe(e)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(e){return e.target=Iu(e.target)||document.body,e.rootMargin=e.offset?`${e.offset}px 0px -30%`:e.rootMargin,typeof e.threshold=="string"&&(e.threshold=e.threshold.split(",").map(r=>Number.parseFloat(r))),e}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Wt.off(this._config.target,XC),Wt.on(this._config.target,XC,Qw,e=>{const r=this._observableSections.get(e.target.hash);if(r){e.preventDefault();const l=this._rootElement||window,h=r.offsetTop-this._element.offsetTop;if(l.scrollTo){l.scrollTo({top:h,behavior:"smooth"});return}l.scrollTop=h}}))}_getNewObserver(){const e={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(r=>this._observerCallback(r),e)}_observerCallback(e){const r=y=>this._targetLinks.get(`#${y.target.id}`),l=y=>{this._previousScrollData.visibleEntryTop=y.target.offsetTop,this._process(r(y))},h=(this._rootElement||document.documentElement).scrollTop,_=h>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=h;for(const y of e){if(!y.isIntersecting){this._activeTarget=null,this._clearActiveClass(r(y));continue}const s=y.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(_&&s){if(l(y),!h)return;continue}!_&&!s&&l(y)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const e=ki.find(Qw,this._config.target);for(const r of e){if(!r.hash||Cu(r))continue;const l=ki.findOne(decodeURI(r.hash),this._element);Pp(l)&&(this._targetLinks.set(decodeURI(r.hash),r),this._observableSections.set(r.hash,l))}}_process(e){this._activeTarget!==e&&(this._clearActiveClass(this._config.target),this._activeTarget=e,e.classList.add(Bf),this._activateParents(e),Wt.trigger(this._element,n8,{relatedTarget:e}))}_activateParents(e){if(e.classList.contains(r8)){ki.findOne(d8,e.closest(h8)).classList.add(Bf);return}for(const r of ki.parents(e,a8))for(const l of ki.prev(r,u8))l.classList.add(Bf)}_clearActiveClass(e){e.classList.remove(Bf);const r=ki.find(`${Qw}.${Bf}`,e);for(const l of r)l.classList.remove(Bf)}static jQueryInterface(e){return this.each(function(){const r=s1.getOrCreateInstance(this,e);if(typeof e=="string"){if(r[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);r[e]()}})}}Wt.on(window,s8,()=>{for(const t of ki.find(o8))s1.getOrCreateInstance(t)});la(s1);const m8="tab",g8="bs.tab",_d=`.${g8}`,_8=`hide${_d}`,y8=`hidden${_d}`,v8=`show${_d}`,x8=`shown${_d}`,b8=`click${_d}`,w8=`keydown${_d}`,T8=`load${_d}`,E8="ArrowLeft",KC="ArrowRight",S8="ArrowUp",JC="ArrowDown",eT="Home",QC="End",Yh="active",eP="fade",tT="show",A8="dropdown",eO=".dropdown-toggle",M8=".dropdown-menu",iT=`:not(${eO})`,I8='.list-group, .nav, [role="tablist"]',C8=".nav-item, .list-group-item",P8=`.nav-link${iT}, .list-group-item${iT}, [role="tab"]${iT}`,tO='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',nT=`${P8}, ${tO}`,D8=`.${Yh}[data-bs-toggle="tab"], .${Yh}[data-bs-toggle="pill"], .${Yh}[data-bs-toggle="list"]`;class up extends $a{constructor(e){super(e),this._parent=this._element.closest(I8),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Wt.on(this._element,w8,r=>this._keydown(r)))}static get NAME(){return m8}show(){const e=this._element;if(this._elemIsActive(e))return;const r=this._getActiveElem(),l=r?Wt.trigger(r,_8,{relatedTarget:e}):null;Wt.trigger(e,v8,{relatedTarget:r}).defaultPrevented||l&&l.defaultPrevented||(this._deactivate(r,e),this._activate(e,r))}_activate(e,r){if(!e)return;e.classList.add(Yh),this._activate(ki.getElementFromSelector(e));const l=()=>{if(e.getAttribute("role")!=="tab"){e.classList.add(tT);return}e.removeAttribute("tabindex"),e.setAttribute("aria-selected",!0),this._toggleDropDown(e,!0),Wt.trigger(e,x8,{relatedTarget:r})};this._queueCallback(l,e,e.classList.contains(eP))}_deactivate(e,r){if(!e)return;e.classList.remove(Yh),e.blur(),this._deactivate(ki.getElementFromSelector(e));const l=()=>{if(e.getAttribute("role")!=="tab"){e.classList.remove(tT);return}e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1"),this._toggleDropDown(e,!1),Wt.trigger(e,y8,{relatedTarget:r})};this._queueCallback(l,e,e.classList.contains(eP))}_keydown(e){if(![E8,KC,S8,JC,eT,QC].includes(e.key))return;e.stopPropagation(),e.preventDefault();const r=this._getChildren().filter(h=>!Cu(h));let l;if([eT,QC].includes(e.key))l=r[e.key===eT?0:r.length-1];else{const h=[KC,JC].includes(e.key);l=lS(r,e.target,h,!0)}l&&(l.focus({preventScroll:!0}),up.getOrCreateInstance(l).show())}_getChildren(){return ki.find(nT,this._parent)}_getActiveElem(){return this._getChildren().find(e=>this._elemIsActive(e))||null}_setInitialAttributes(e,r){this._setAttributeIfNotExists(e,"role","tablist");for(const l of r)this._setInitialAttributesOnChild(l)}_setInitialAttributesOnChild(e){e=this._getInnerElement(e);const r=this._elemIsActive(e),l=this._getOuterElement(e);e.setAttribute("aria-selected",r),l!==e&&this._setAttributeIfNotExists(l,"role","presentation"),r||e.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(e,"role","tab"),this._setInitialAttributesOnTargetPanel(e)}_setInitialAttributesOnTargetPanel(e){const r=ki.getElementFromSelector(e);r&&(this._setAttributeIfNotExists(r,"role","tabpanel"),e.id&&this._setAttributeIfNotExists(r,"aria-labelledby",`${e.id}`))}_toggleDropDown(e,r){const l=this._getOuterElement(e);if(!l.classList.contains(A8))return;const h=(_,y)=>{const s=ki.findOne(_,l);s&&s.classList.toggle(y,r)};h(eO,Yh),h(M8,tT),l.setAttribute("aria-expanded",r)}_setAttributeIfNotExists(e,r,l){e.hasAttribute(r)||e.setAttribute(r,l)}_elemIsActive(e){return e.classList.contains(Yh)}_getInnerElement(e){return e.matches(nT)?e:ki.findOne(nT,e)}_getOuterElement(e){return e.closest(C8)||e}static jQueryInterface(e){return this.each(function(){const r=up.getOrCreateInstance(this);if(typeof e=="string"){if(r[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);r[e]()}})}}Wt.on(document,b8,tO,function(t){["A","AREA"].includes(this.tagName)&&t.preventDefault(),!Cu(this)&&up.getOrCreateInstance(this).show()});Wt.on(window,T8,()=>{for(const t of ki.find(D8))up.getOrCreateInstance(t)});la(up);const R8="toast",L8="bs.toast",Bu=`.${L8}`,O8=`mouseover${Bu}`,k8=`mouseout${Bu}`,z8=`focusin${Bu}`,F8=`focusout${Bu}`,B8=`hide${Bu}`,N8=`hidden${Bu}`,V8=`show${Bu}`,U8=`shown${Bu}`,j8="fade",tP="hide",ev="show",tv="showing",$8={animation:"boolean",autohide:"boolean",delay:"number"},H8={animation:!0,autohide:!0,delay:5e3};class r1 extends $a{constructor(e,r){super(e,r),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return H8}static get DefaultType(){return $8}static get NAME(){return R8}show(){if(Wt.trigger(this._element,V8).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(j8);const r=()=>{this._element.classList.remove(tv),Wt.trigger(this._element,U8),this._maybeScheduleHide()};this._element.classList.remove(tP),H_(this._element),this._element.classList.add(ev,tv),this._queueCallback(r,this._element,this._config.animation)}hide(){if(!this.isShown()||Wt.trigger(this._element,B8).defaultPrevented)return;const r=()=>{this._element.classList.add(tP),this._element.classList.remove(tv,ev),Wt.trigger(this._element,N8)};this._element.classList.add(tv),this._queueCallback(r,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(ev),super.dispose()}isShown(){return this._element.classList.contains(ev)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(e,r){switch(e.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=r;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=r;break}}if(r){this._clearTimeout();return}const l=e.relatedTarget;this._element===l||this._element.contains(l)||this._maybeScheduleHide()}_setListeners(){Wt.on(this._element,O8,e=>this._onInteraction(e,!0)),Wt.on(this._element,k8,e=>this._onInteraction(e,!1)),Wt.on(this._element,z8,e=>this._onInteraction(e,!0)),Wt.on(this._element,F8,e=>this._onInteraction(e,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each(function(){const r=r1.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof r[e]>"u")throw new TypeError(`No method named "${e}"`);r[e](this)}})}}e1(r1);la(r1);/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Uo(t){const e=Object.create(null);for(const r of t.split(","))e[r]=1;return r=>r in e}const xn={},Kf=[],hr=()=>{},jg=()=>!1,yd=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),fS=t=>t.startsWith("onUpdate:"),wn=Object.assign,pS=(t,e)=>{const r=t.indexOf(e);r>-1&&t.splice(r,1)},G8=Object.prototype.hasOwnProperty,Fn=(t,e)=>G8.call(t,e),yi=Array.isArray,Jf=t=>Rp(t)==="[object Map]",vd=t=>Rp(t)==="[object Set]",iP=t=>Rp(t)==="[object Date]",q8=t=>Rp(t)==="[object RegExp]",Bi=t=>typeof t=="function",sn=t=>typeof t=="string",xo=t=>typeof t=="symbol",$n=t=>t!==null&&typeof t=="object",mS=t=>($n(t)||Bi(t))&&Bi(t.then)&&Bi(t.catch),iO=Object.prototype.toString,Rp=t=>iO.call(t),W8=t=>Rp(t).slice(8,-1),o1=t=>Rp(t)==="[object Object]",gS=t=>sn(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,wu=Uo(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Z8=Uo("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo"),a1=t=>{const e=Object.create(null);return r=>e[r]||(e[r]=t(r))},X8=/-(\w)/g,cs=a1(t=>t.replace(X8,(e,r)=>r?r.toUpperCase():"")),Y8=/\B([A-Z])/g,_o=a1(t=>t.replace(Y8,"-$1").toLowerCase()),xd=a1(t=>t.charAt(0).toUpperCase()+t.slice(1)),Qf=a1(t=>t?`on${xd(t)}`:""),Kr=(t,e)=>!Object.is(t,e),ep=(t,...e)=>{for(let r=0;r<t.length;r++)t[r](...e)},nO=(t,e,r,l=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:l,value:r})},ux=t=>{const e=parseFloat(t);return isNaN(e)?t:e},hx=t=>{const e=sn(t)?Number(t):NaN;return isNaN(e)?t:e};let nP;const l1=()=>nP||(nP=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function K8(t,e){return t+JSON.stringify(e,(r,l)=>typeof l=="function"?l.toString():l)}const J8="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol",Q8=Uo(J8);function Z_(t){if(yi(t)){const e={};for(let r=0;r<t.length;r++){const l=t[r],h=sn(l)?sO(l):Z_(l);if(h)for(const _ in h)e[_]=h[_]}return e}else if(sn(t)||$n(t))return t}const e$=/;(?![^(]*\))/g,t$=/:([^]+)/,i$=/\/\*[^]*?\*\//g;function sO(t){const e={};return t.replace(i$,"").split(e$).forEach(r=>{if(r){const l=r.split(t$);l.length>1&&(e[l[0].trim()]=l[1].trim())}}),e}function X_(t){let e="";if(sn(t))e=t;else if(yi(t))for(let r=0;r<t.length;r++){const l=X_(t[r]);l&&(e+=l+" ")}else if($n(t))for(const r in t)t[r]&&(e+=r+" ");return e.trim()}function n$(t){if(!t)return null;let{class:e,style:r}=t;return e&&!sn(e)&&(t.class=X_(e)),r&&(t.style=Z_(r)),t}const s$="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",r$="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistantLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",o$="annotation,annotation-xml,maction,maligngroup,malignmark,math,menclose,merror,mfenced,mfrac,mfraction,mglyph,mi,mlabeledtr,mlongdiv,mmultiscripts,mn,mo,mover,mpadded,mphantom,mprescripts,mroot,mrow,ms,mscarries,mscarry,msgroup,msline,mspace,msqrt,msrow,mstack,mstyle,msub,msubsup,msup,mtable,mtd,mtext,mtr,munder,munderover,none,semantics",a$="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",l$=Uo(s$),c$=Uo(r$),u$=Uo(o$),h$=Uo(a$),d$="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",f$=Uo(d$);function rO(t){return!!t||t===""}function p$(t,e){if(t.length!==e.length)return!1;let r=!0;for(let l=0;r&&l<t.length;l++)r=Du(t[l],e[l]);return r}function Du(t,e){if(t===e)return!0;let r=iP(t),l=iP(e);if(r||l)return r&&l?t.getTime()===e.getTime():!1;if(r=xo(t),l=xo(e),r||l)return t===e;if(r=yi(t),l=yi(e),r||l)return r&&l?p$(t,e):!1;if(r=$n(t),l=$n(e),r||l){if(!r||!l)return!1;const h=Object.keys(t).length,_=Object.keys(e).length;if(h!==_)return!1;for(const y in t){const s=t.hasOwnProperty(y),I=e.hasOwnProperty(y);if(s&&!I||!s&&I||!Du(t[y],e[y]))return!1}}return String(t)===String(e)}function c1(t,e){return t.findIndex(r=>Du(r,e))}const oO=t=>!!(t&&t.__v_isRef===!0),Is=t=>sn(t)?t:t==null?"":yi(t)||$n(t)&&(t.toString===iO||!Bi(t.toString))?oO(t)?Is(t.value):JSON.stringify(t,aO,2):String(t),aO=(t,e)=>oO(e)?aO(t,e.value):Jf(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((r,[l,h],_)=>(r[sT(l,_)+" =>"]=h,r),{})}:vd(e)?{[`Set(${e.size})`]:[...e.values()].map(r=>sT(r))}:xo(e)?sT(e):$n(e)&&!yi(e)&&!o1(e)?String(e):e,sT=(t,e="")=>{var r;return xo(t)?`Symbol(${(r=t.description)!=null?r:e})`:t};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Yr;class _S{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Yr,!e&&Yr&&(this.index=(Yr.scopes||(Yr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,r;if(this.scopes)for(e=0,r=this.scopes.length;e<r;e++)this.scopes[e].pause();for(e=0,r=this.effects.length;e<r;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,r;if(this.scopes)for(e=0,r=this.scopes.length;e<r;e++)this.scopes[e].resume();for(e=0,r=this.effects.length;e<r;e++)this.effects[e].resume()}}run(e){if(this._active){const r=Yr;try{return Yr=this,e()}finally{Yr=r}}}on(){Yr=this}off(){Yr=this.parent}stop(e){if(this._active){this._active=!1;let r,l;for(r=0,l=this.effects.length;r<l;r++)this.effects[r].stop();for(this.effects.length=0,r=0,l=this.cleanups.length;r<l;r++)this.cleanups[r]();if(this.cleanups.length=0,this.scopes){for(r=0,l=this.scopes.length;r<l;r++)this.scopes[r].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const h=this.parent.scopes.pop();h&&h!==this&&(this.parent.scopes[this.index]=h,h.index=this.index)}this.parent=void 0}}}function m$(t){return new _S(t)}function lO(){return Yr}function g$(t,e=!1){Yr&&Yr.cleanups.push(t)}let es;const rT=new WeakSet;class __{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Yr&&Yr.active&&Yr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,rT.has(this)&&(rT.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||uO(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,sP(this),hO(this);const e=es,r=Ba;es=this,Ba=!0;try{return this.fn()}finally{dO(this),es=e,Ba=r,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)xS(e);this.deps=this.depsTail=void 0,sP(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?rT.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){XT(this)&&this.run()}get dirty(){return XT(this)}}let cO=0,Qg,e_;function uO(t,e=!1){if(t.flags|=8,e){t.next=e_,e_=t;return}t.next=Qg,Qg=t}function yS(){cO++}function vS(){if(--cO>0)return;if(e_){let e=e_;for(e_=void 0;e;){const r=e.next;e.next=void 0,e.flags&=-9,e=r}}let t;for(;Qg;){let e=Qg;for(Qg=void 0;e;){const r=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(l){t||(t=l)}e=r}}if(t)throw t}function hO(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function dO(t){let e,r=t.depsTail,l=r;for(;l;){const h=l.prevDep;l.version===-1?(l===r&&(r=h),xS(l),_$(l)):e=l,l.dep.activeLink=l.prevActiveLink,l.prevActiveLink=void 0,l=h}t.deps=e,t.depsTail=r}function XT(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(fO(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function fO(t){if(t.flags&4&&!(t.flags&16)||(t.flags&=-17,t.globalVersion===y_))return;t.globalVersion=y_;const e=t.dep;if(t.flags|=2,e.version>0&&!t.isSSR&&t.deps&&!XT(t)){t.flags&=-3;return}const r=es,l=Ba;es=t,Ba=!0;try{hO(t);const h=t.fn(t._value);(e.version===0||Kr(h,t._value))&&(t._value=h,e.version++)}catch(h){throw e.version++,h}finally{es=r,Ba=l,dO(t),t.flags&=-3}}function xS(t,e=!1){const{dep:r,prevSub:l,nextSub:h}=t;if(l&&(l.nextSub=h,t.prevSub=void 0),h&&(h.prevSub=l,t.nextSub=void 0),r.subs===t&&(r.subs=l,!l&&r.computed)){r.computed.flags&=-5;for(let _=r.computed.deps;_;_=_.nextDep)xS(_,!0)}!e&&!--r.sc&&r.map&&r.map.delete(r.key)}function _$(t){const{prevDep:e,nextDep:r}=t;e&&(e.nextDep=r,t.prevDep=void 0),r&&(r.prevDep=e,t.nextDep=void 0)}function y$(t,e){t.effect instanceof __&&(t=t.effect.fn);const r=new __(t);e&&wn(r,e);try{r.run()}catch(h){throw r.stop(),h}const l=r.run.bind(r);return l.effect=r,l}function v$(t){t.effect.stop()}let Ba=!0;const pO=[];function Nu(){pO.push(Ba),Ba=!1}function Vu(){const t=pO.pop();Ba=t===void 0?!0:t}function sP(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const r=es;es=void 0;try{e()}finally{es=r}}}let y_=0;class x${constructor(e,r){this.sub=e,this.dep=r,this.version=r.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class u1{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!es||!Ba||es===this.computed)return;let r=this.activeLink;if(r===void 0||r.sub!==es)r=this.activeLink=new x$(es,this),es.deps?(r.prevDep=es.depsTail,es.depsTail.nextDep=r,es.depsTail=r):es.deps=es.depsTail=r,mO(r);else if(r.version===-1&&(r.version=this.version,r.nextDep)){const l=r.nextDep;l.prevDep=r.prevDep,r.prevDep&&(r.prevDep.nextDep=l),r.prevDep=es.depsTail,r.nextDep=void 0,es.depsTail.nextDep=r,es.depsTail=r,es.deps===r&&(es.deps=l)}return r}trigger(e){this.version++,y_++,this.notify(e)}notify(e){yS();try{for(let r=this.subs;r;r=r.prevSub)r.sub.notify()&&r.sub.dep.notify()}finally{vS()}}}function mO(t){if(t.dep.sc++,t.sub.flags&4){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let l=e.deps;l;l=l.nextDep)mO(l)}const r=t.dep.subs;r!==t&&(t.prevSub=r,r&&(r.nextSub=t)),t.dep.subs=t}}const dx=new WeakMap,td=Symbol(""),YT=Symbol(""),v_=Symbol("");function Pr(t,e,r){if(Ba&&es){let l=dx.get(t);l||dx.set(t,l=new Map);let h=l.get(r);h||(l.set(r,h=new u1),h.map=l,h.key=r),h.track()}}function ql(t,e,r,l,h,_){const y=dx.get(t);if(!y){y_++;return}const s=I=>{I&&I.trigger()};if(yS(),e==="clear")y.forEach(s);else{const I=yi(t),O=I&&gS(r);if(I&&r==="length"){const k=Number(l);y.forEach((j,Z)=>{(Z==="length"||Z===v_||!xo(Z)&&Z>=k)&&s(j)})}else switch((r!==void 0||y.has(void 0))&&s(y.get(r)),O&&s(y.get(v_)),e){case"add":I?O&&s(y.get("length")):(s(y.get(td)),Jf(t)&&s(y.get(YT)));break;case"delete":I||(s(y.get(td)),Jf(t)&&s(y.get(YT)));break;case"set":Jf(t)&&s(y.get(td));break}}vS()}function b$(t,e){const r=dx.get(t);return r&&r.get(e)}function Nf(t){const e=Dn(t);return e===t?e:(Pr(e,"iterate",v_),Fo(t)?e:e.map(Dr))}function h1(t){return Pr(t=Dn(t),"iterate",v_),t}const w$={__proto__:null,[Symbol.iterator](){return oT(this,Symbol.iterator,Dr)},concat(...t){return Nf(this).concat(...t.map(e=>yi(e)?Nf(e):e))},entries(){return oT(this,"entries",t=>(t[1]=Dr(t[1]),t))},every(t,e){return Fl(this,"every",t,e,void 0,arguments)},filter(t,e){return Fl(this,"filter",t,e,r=>r.map(Dr),arguments)},find(t,e){return Fl(this,"find",t,e,Dr,arguments)},findIndex(t,e){return Fl(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return Fl(this,"findLast",t,e,Dr,arguments)},findLastIndex(t,e){return Fl(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return Fl(this,"forEach",t,e,void 0,arguments)},includes(...t){return aT(this,"includes",t)},indexOf(...t){return aT(this,"indexOf",t)},join(t){return Nf(this).join(t)},lastIndexOf(...t){return aT(this,"lastIndexOf",t)},map(t,e){return Fl(this,"map",t,e,void 0,arguments)},pop(){return Lg(this,"pop")},push(...t){return Lg(this,"push",t)},reduce(t,...e){return rP(this,"reduce",t,e)},reduceRight(t,...e){return rP(this,"reduceRight",t,e)},shift(){return Lg(this,"shift")},some(t,e){return Fl(this,"some",t,e,void 0,arguments)},splice(...t){return Lg(this,"splice",t)},toReversed(){return Nf(this).toReversed()},toSorted(t){return Nf(this).toSorted(t)},toSpliced(...t){return Nf(this).toSpliced(...t)},unshift(...t){return Lg(this,"unshift",t)},values(){return oT(this,"values",Dr)}};function oT(t,e,r){const l=h1(t),h=l[e]();return l!==t&&!Fo(t)&&(h._next=h.next,h.next=()=>{const _=h._next();return _.value&&(_.value=r(_.value)),_}),h}const T$=Array.prototype;function Fl(t,e,r,l,h,_){const y=h1(t),s=y!==t&&!Fo(t),I=y[e];if(I!==T$[e]){const j=I.apply(t,_);return s?Dr(j):j}let O=r;y!==t&&(s?O=function(j,Z){return r.call(this,Dr(j),Z,t)}:r.length>2&&(O=function(j,Z){return r.call(this,j,Z,t)}));const k=I.call(y,O,l);return s&&h?h(k):k}function rP(t,e,r,l){const h=h1(t);let _=r;return h!==t&&(Fo(t)?r.length>3&&(_=function(y,s,I){return r.call(this,y,s,I,t)}):_=function(y,s,I){return r.call(this,y,Dr(s),I,t)}),h[e](_,...l)}function aT(t,e,r){const l=Dn(t);Pr(l,"iterate",v_);const h=l[e](...r);return(h===-1||h===!1)&&m1(r[0])?(r[0]=Dn(r[0]),l[e](...r)):h}function Lg(t,e,r=[]){Nu(),yS();const l=Dn(t)[e].apply(t,r);return vS(),Vu(),l}const E$=Uo("__proto__,__v_isRef,__isVue"),gO=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(xo));function S$(t){xo(t)||(t=String(t));const e=Dn(this);return Pr(e,"has",t),e.hasOwnProperty(t)}class _O{constructor(e=!1,r=!1){this._isReadonly=e,this._isShallow=r}get(e,r,l){if(r==="__v_skip")return e.__v_skip;const h=this._isReadonly,_=this._isShallow;if(r==="__v_isReactive")return!h;if(r==="__v_isReadonly")return h;if(r==="__v_isShallow")return _;if(r==="__v_raw")return l===(h?_?TO:wO:_?bO:xO).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(l)?e:void 0;const y=yi(e);if(!h){let I;if(y&&(I=w$[r]))return I;if(r==="hasOwnProperty")return S$}const s=Reflect.get(e,r,rr(e)?e:l);return(xo(r)?gO.has(r):E$(r))||(h||Pr(e,"get",r),_)?s:rr(s)?y&&gS(r)?s:s.value:$n(s)?h?bS(s):f1(s):s}}class yO extends _O{constructor(e=!1){super(!1,e)}set(e,r,l,h){let _=e[r];if(!this._isShallow){const I=Ru(_);if(!Fo(l)&&!Ru(l)&&(_=Dn(_),l=Dn(l)),!yi(e)&&rr(_)&&!rr(l))return I?!1:(_.value=l,!0)}const y=yi(e)&&gS(r)?Number(r)<e.length:Fn(e,r),s=Reflect.set(e,r,l,rr(e)?e:h);return e===Dn(h)&&(y?Kr(l,_)&&ql(e,"set",r,l):ql(e,"add",r,l)),s}deleteProperty(e,r){const l=Fn(e,r);e[r];const h=Reflect.deleteProperty(e,r);return h&&l&&ql(e,"delete",r,void 0),h}has(e,r){const l=Reflect.has(e,r);return(!xo(r)||!gO.has(r))&&Pr(e,"has",r),l}ownKeys(e){return Pr(e,"iterate",yi(e)?"length":td),Reflect.ownKeys(e)}}class vO extends _O{constructor(e=!1){super(!0,e)}set(e,r){return!0}deleteProperty(e,r){return!0}}const A$=new yO,M$=new vO,I$=new yO(!0),C$=new vO(!0),KT=t=>t,iv=t=>Reflect.getPrototypeOf(t);function P$(t,e,r){return function(...l){const h=this.__v_raw,_=Dn(h),y=Jf(_),s=t==="entries"||t===Symbol.iterator&&y,I=t==="keys"&&y,O=h[t](...l),k=r?KT:e?JT:Dr;return!e&&Pr(_,"iterate",I?YT:td),{next(){const{value:j,done:Z}=O.next();return Z?{value:j,done:Z}:{value:s?[k(j[0]),k(j[1])]:k(j),done:Z}},[Symbol.iterator](){return this}}}}function nv(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function D$(t,e){const r={get(h){const _=this.__v_raw,y=Dn(_),s=Dn(h);t||(Kr(h,s)&&Pr(y,"get",h),Pr(y,"get",s));const{has:I}=iv(y),O=e?KT:t?JT:Dr;if(I.call(y,h))return O(_.get(h));if(I.call(y,s))return O(_.get(s));_!==y&&_.get(h)},get size(){const h=this.__v_raw;return!t&&Pr(Dn(h),"iterate",td),Reflect.get(h,"size",h)},has(h){const _=this.__v_raw,y=Dn(_),s=Dn(h);return t||(Kr(h,s)&&Pr(y,"has",h),Pr(y,"has",s)),h===s?_.has(h):_.has(h)||_.has(s)},forEach(h,_){const y=this,s=y.__v_raw,I=Dn(s),O=e?KT:t?JT:Dr;return!t&&Pr(I,"iterate",td),s.forEach((k,j)=>h.call(_,O(k),O(j),y))}};return wn(r,t?{add:nv("add"),set:nv("set"),delete:nv("delete"),clear:nv("clear")}:{add(h){!e&&!Fo(h)&&!Ru(h)&&(h=Dn(h));const _=Dn(this);return iv(_).has.call(_,h)||(_.add(h),ql(_,"add",h,h)),this},set(h,_){!e&&!Fo(_)&&!Ru(_)&&(_=Dn(_));const y=Dn(this),{has:s,get:I}=iv(y);let O=s.call(y,h);O||(h=Dn(h),O=s.call(y,h));const k=I.call(y,h);return y.set(h,_),O?Kr(_,k)&&ql(y,"set",h,_):ql(y,"add",h,_),this},delete(h){const _=Dn(this),{has:y,get:s}=iv(_);let I=y.call(_,h);I||(h=Dn(h),I=y.call(_,h)),s&&s.call(_,h);const O=_.delete(h);return I&&ql(_,"delete",h,void 0),O},clear(){const h=Dn(this),_=h.size!==0,y=h.clear();return _&&ql(h,"clear",void 0,void 0),y}}),["keys","values","entries",Symbol.iterator].forEach(h=>{r[h]=P$(h,t,e)}),r}function d1(t,e){const r=D$(t,e);return(l,h,_)=>h==="__v_isReactive"?!t:h==="__v_isReadonly"?t:h==="__v_raw"?l:Reflect.get(Fn(r,h)&&h in l?r:l,h,_)}const R$={get:d1(!1,!1)},L$={get:d1(!1,!0)},O$={get:d1(!0,!1)},k$={get:d1(!0,!0)},xO=new WeakMap,bO=new WeakMap,wO=new WeakMap,TO=new WeakMap;function z$(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function F$(t){return t.__v_skip||!Object.isExtensible(t)?0:z$(W8(t))}function f1(t){return Ru(t)?t:p1(t,!1,A$,R$,xO)}function EO(t){return p1(t,!1,I$,L$,bO)}function bS(t){return p1(t,!0,M$,O$,wO)}function B$(t){return p1(t,!0,C$,k$,TO)}function p1(t,e,r,l,h){if(!$n(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const _=h.get(t);if(_)return _;const y=F$(t);if(y===0)return t;const s=new Proxy(t,y===2?l:r);return h.set(t,s),s}function Tu(t){return Ru(t)?Tu(t.__v_raw):!!(t&&t.__v_isReactive)}function Ru(t){return!!(t&&t.__v_isReadonly)}function Fo(t){return!!(t&&t.__v_isShallow)}function m1(t){return t?!!t.__v_raw:!1}function Dn(t){const e=t&&t.__v_raw;return e?Dn(e):t}function SO(t){return!Fn(t,"__v_skip")&&Object.isExtensible(t)&&nO(t,"__v_skip",!0),t}const Dr=t=>$n(t)?f1(t):t,JT=t=>$n(t)?bS(t):t;function rr(t){return t?t.__v_isRef===!0:!1}function t_(t){return MO(t,!1)}function AO(t){return MO(t,!0)}function MO(t,e){return rr(t)?t:new N$(t,e)}class N${constructor(e,r){this.dep=new u1,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=r?e:Dn(e),this._value=r?e:Dr(e),this.__v_isShallow=r}get value(){return this.dep.track(),this._value}set value(e){const r=this._rawValue,l=this.__v_isShallow||Fo(e)||Ru(e);e=l?e:Dn(e),Kr(e,r)&&(this._rawValue=e,this._value=l?e:Dr(e),this.dep.trigger())}}function V$(t){t.dep&&t.dep.trigger()}function g1(t){return rr(t)?t.value:t}function U$(t){return Bi(t)?t():g1(t)}const j$={get:(t,e,r)=>e==="__v_raw"?t:g1(Reflect.get(t,e,r)),set:(t,e,r,l)=>{const h=t[e];return rr(h)&&!rr(r)?(h.value=r,!0):Reflect.set(t,e,r,l)}};function wS(t){return Tu(t)?t:new Proxy(t,j$)}class $${constructor(e){this.__v_isRef=!0,this._value=void 0;const r=this.dep=new u1,{get:l,set:h}=e(r.track.bind(r),r.trigger.bind(r));this._get=l,this._set=h}get value(){return this._value=this._get()}set value(e){this._set(e)}}function IO(t){return new $$(t)}function H$(t){const e=yi(t)?new Array(t.length):{};for(const r in t)e[r]=CO(t,r);return e}class G${constructor(e,r,l){this._object=e,this._key=r,this._defaultValue=l,this.__v_isRef=!0,this._value=void 0}get value(){const e=this._object[this._key];return this._value=e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return b$(Dn(this._object),this._key)}}class q${constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function W$(t,e,r){return rr(t)?t:Bi(t)?new q$(t):$n(t)&&arguments.length>1?CO(t,e,r):t_(t)}function CO(t,e,r){const l=t[e];return rr(l)?l:new G$(t,e,r)}class Z${constructor(e,r,l){this.fn=e,this.setter=r,this._value=void 0,this.dep=new u1(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=y_-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!r,this.isSSR=l}notify(){if(this.flags|=16,!(this.flags&8)&&es!==this)return uO(this,!0),!0}get value(){const e=this.dep.track();return fO(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function X$(t,e,r=!1){let l,h;return Bi(t)?l=t:(l=t.get,h=t.set),new Z$(l,h,r)}const Y$={GET:"get",HAS:"has",ITERATE:"iterate"},K$={SET:"set",ADD:"add",DELETE:"delete",CLEAR:"clear"},sv={},fx=new WeakMap;let du;function J$(){return du}function PO(t,e=!1,r=du){if(r){let l=fx.get(r);l||fx.set(r,l=[]),l.push(t)}}function Q$(t,e,r=xn){const{immediate:l,deep:h,once:_,scheduler:y,augmentJob:s,call:I}=r,O=fe=>h?fe:Fo(fe)||h===!1||h===0?Wl(fe,1):Wl(fe);let k,j,Z,Y,se=!1,ne=!1;if(rr(t)?(j=()=>t.value,se=Fo(t)):Tu(t)?(j=()=>O(t),se=!0):yi(t)?(ne=!0,se=t.some(fe=>Tu(fe)||Fo(fe)),j=()=>t.map(fe=>{if(rr(fe))return fe.value;if(Tu(fe))return O(fe);if(Bi(fe))return I?I(fe,2):fe()})):Bi(t)?e?j=I?()=>I(t,2):t:j=()=>{if(Z){Nu();try{Z()}finally{Vu()}}const fe=du;du=k;try{return I?I(t,3,[Y]):t(Y)}finally{du=fe}}:j=hr,e&&h){const fe=j,Ae=h===!0?1/0:h;j=()=>Wl(fe(),Ae)}const de=lO(),me=()=>{k.stop(),de&&de.active&&pS(de.effects,k)};if(_&&e){const fe=e;e=(...Ae)=>{fe(...Ae),me()}}let Te=ne?new Array(t.length).fill(sv):sv;const ge=fe=>{if(!(!(k.flags&1)||!k.dirty&&!fe))if(e){const Ae=k.run();if(h||se||(ne?Ae.some((Ge,ze)=>Kr(Ge,Te[ze])):Kr(Ae,Te))){Z&&Z();const Ge=du;du=k;try{const ze=[Ae,Te===sv?void 0:ne&&Te[0]===sv?[]:Te,Y];I?I(e,3,ze):e(...ze),Te=Ae}finally{du=Ge}}}else k.run()};return s&&s(ge),k=new __(j),k.scheduler=y?()=>y(ge,!1):ge,Y=fe=>PO(fe,!1,k),Z=k.onStop=()=>{const fe=fx.get(k);if(fe){if(I)I(fe,4);else for(const Ae of fe)Ae();fx.delete(k)}},e?l?ge(!0):Te=k.run():y?y(ge.bind(null,!0),!0):k.run(),me.pause=k.pause.bind(k),me.resume=k.resume.bind(k),me.stop=me,me}function Wl(t,e=1/0,r){if(e<=0||!$n(t)||t.__v_skip||(r=r||new Set,r.has(t)))return t;if(r.add(t),e--,rr(t))Wl(t.value,e,r);else if(yi(t))for(let l=0;l<t.length;l++)Wl(t[l],e,r);else if(vd(t)||Jf(t))t.forEach(l=>{Wl(l,e,r)});else if(o1(t)){for(const l in t)Wl(t[l],e,r);for(const l of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,l)&&Wl(t[l],e,r)}return t}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const DO=[];function eH(t){DO.push(t)}function tH(){DO.pop()}function iH(t,e){}const nH={SETUP_FUNCTION:0,0:"SETUP_FUNCTION",RENDER_FUNCTION:1,1:"RENDER_FUNCTION",NATIVE_EVENT_HANDLER:5,5:"NATIVE_EVENT_HANDLER",COMPONENT_EVENT_HANDLER:6,6:"COMPONENT_EVENT_HANDLER",VNODE_HOOK:7,7:"VNODE_HOOK",DIRECTIVE_HOOK:8,8:"DIRECTIVE_HOOK",TRANSITION_HOOK:9,9:"TRANSITION_HOOK",APP_ERROR_HANDLER:10,10:"APP_ERROR_HANDLER",APP_WARN_HANDLER:11,11:"APP_WARN_HANDLER",FUNCTION_REF:12,12:"FUNCTION_REF",ASYNC_COMPONENT_LOADER:13,13:"ASYNC_COMPONENT_LOADER",SCHEDULER:14,14:"SCHEDULER",COMPONENT_UPDATE:15,15:"COMPONENT_UPDATE",APP_UNMOUNT_CLEANUP:16,16:"APP_UNMOUNT_CLEANUP"},sH={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush",15:"component update",16:"app unmount cleanup function"};function Lp(t,e,r,l){try{return l?t(...l):t()}catch(h){bd(h,e,r)}}function aa(t,e,r,l){if(Bi(t)){const h=Lp(t,e,r,l);return h&&mS(h)&&h.catch(_=>{bd(_,e,r)}),h}if(yi(t)){const h=[];for(let _=0;_<t.length;_++)h.push(aa(t[_],e,r,l));return h}}function bd(t,e,r,l=!0){const h=e?e.vnode:null,{errorHandler:_,throwUnhandledErrorInProduction:y}=e&&e.appContext.config||xn;if(e){let s=e.parent;const I=e.proxy,O=`https://vuejs.org/error-reference/#runtime-${r}`;for(;s;){const k=s.ec;if(k){for(let j=0;j<k.length;j++)if(k[j](t,I,O)===!1)return}s=s.parent}if(_){Nu(),Lp(_,null,10,[t,I,O]),Vu();return}}rH(t,r,h,l,y)}function rH(t,e,r,l=!0,h=!1){if(h)throw t;console.error(t)}const Jr=[];let ul=-1;const tp=[];let fu=null,Wf=0;const RO=Promise.resolve();let px=null;function _1(t){const e=px||RO;return t?e.then(this?t.bind(this):t):e}function oH(t){let e=ul+1,r=Jr.length;for(;e<r;){const l=e+r>>>1,h=Jr[l],_=b_(h);_<t||_===t&&h.flags&2?e=l+1:r=l}return e}function TS(t){if(!(t.flags&1)){const e=b_(t),r=Jr[Jr.length-1];!r||!(t.flags&2)&&e>=b_(r)?Jr.push(t):Jr.splice(oH(e),0,t),t.flags|=1,LO()}}function LO(){px||(px=RO.then(OO))}function x_(t){yi(t)?tp.push(...t):fu&&t.id===-1?fu.splice(Wf+1,0,t):t.flags&1||(tp.push(t),t.flags|=1),LO()}function oP(t,e,r=ul+1){for(;r<Jr.length;r++){const l=Jr[r];if(l&&l.flags&2){if(t&&l.id!==t.uid)continue;Jr.splice(r,1),r--,l.flags&4&&(l.flags&=-2),l(),l.flags&4||(l.flags&=-2)}}}function mx(t){if(tp.length){const e=[...new Set(tp)].sort((r,l)=>b_(r)-b_(l));if(tp.length=0,fu){fu.push(...e);return}for(fu=e,Wf=0;Wf<fu.length;Wf++){const r=fu[Wf];r.flags&4&&(r.flags&=-2),r.flags&8||r(),r.flags&=-2}fu=null,Wf=0}}const b_=t=>t.id==null?t.flags&2?-1:1/0:t.id;function OO(t){const e=hr;try{for(ul=0;ul<Jr.length;ul++){const r=Jr[ul];r&&!(r.flags&8)&&(r.flags&4&&(r.flags&=-2),Lp(r,r.i,r.i?15:14),r.flags&4||(r.flags&=-2))}}finally{for(;ul<Jr.length;ul++){const r=Jr[ul];r&&(r.flags&=-2)}ul=-1,Jr.length=0,mx(),px=null,(Jr.length||tp.length)&&OO()}}let Zf,rv=[];function kO(t,e){var r,l;Zf=t,Zf?(Zf.enabled=!0,rv.forEach(({event:h,args:_})=>Zf.emit(h,..._)),rv=[]):typeof window<"u"&&window.HTMLElement&&!((l=(r=window.navigator)==null?void 0:r.userAgent)!=null&&l.includes("jsdom"))?((e.__VUE_DEVTOOLS_HOOK_REPLAY__=e.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(_=>{kO(_,e)}),setTimeout(()=>{Zf||(e.__VUE_DEVTOOLS_HOOK_REPLAY__=null,rv=[])},3e3)):rv=[]}let nr=null,y1=null;function w_(t){const e=nr;return nr=t,y1=t&&t.type.__scopeId||null,e}function aH(t){y1=t}function lH(){y1=null}const cH=t=>ES;function ES(t,e=nr,r){if(!e||t._n)return t;const l=(...h)=>{l._d&&oE(-1);const _=w_(e);let y;try{y=t(...h)}finally{w_(_),l._d&&oE(1)}return y};return l._n=!0,l._c=!0,l._d=!0,l}function ka(t,e){if(nr===null)return t;const r=Q_(nr),l=t.dirs||(t.dirs=[]);for(let h=0;h<e.length;h++){let[_,y,s,I=xn]=e[h];_&&(Bi(_)&&(_={mounted:_,updated:_}),_.deep&&Wl(y),l.push({dir:_,instance:r,value:y,oldValue:void 0,arg:s,modifiers:I}))}return t}function dl(t,e,r,l){const h=t.dirs,_=e&&e.dirs;for(let y=0;y<h.length;y++){const s=h[y];_&&(s.oldValue=_[y].value);let I=s.dir[l];I&&(Nu(),aa(I,r,8,[t.el,s,t,e]),Vu())}}const zO=Symbol("_vte"),FO=t=>t.__isTeleport,i_=t=>t&&(t.disabled||t.disabled===""),aP=t=>t&&(t.defer||t.defer===""),lP=t=>typeof SVGElement<"u"&&t instanceof SVGElement,cP=t=>typeof MathMLElement=="function"&&t instanceof MathMLElement,QT=(t,e)=>{const r=t&&t.to;return sn(r)?e?e(r):null:r},BO={name:"Teleport",__isTeleport:!0,process(t,e,r,l,h,_,y,s,I,O){const{mc:k,pc:j,pbc:Z,o:{insert:Y,querySelector:se,createText:ne,createComment:de}}=O,me=i_(e.props);let{shapeFlag:Te,children:ge,dynamicChildren:fe}=e;if(t==null){const Ae=e.el=ne(""),Ge=e.anchor=ne("");Y(Ae,r,l),Y(Ge,r,l);const ze=(Xe,Ue)=>{Te&16&&(h&&h.isCE&&(h.ce._teleportTarget=Xe),k(ge,Xe,Ue,h,_,y,s,I))},Ke=()=>{const Xe=e.target=QT(e.props,se),Ue=NO(Xe,e,ne,Y);Xe&&(y!=="svg"&&lP(Xe)?y="svg":y!=="mathml"&&cP(Xe)&&(y="mathml"),me||(ze(Xe,Ue),Vv(e,!1)))};me&&(ze(r,Ge),Vv(e,!0)),aP(e.props)?er(()=>{Ke(),e.el.__isMounted=!0},_):Ke()}else{if(aP(e.props)&&!t.el.__isMounted){er(()=>{BO.process(t,e,r,l,h,_,y,s,I,O),delete t.el.__isMounted},_);return}e.el=t.el,e.targetStart=t.targetStart;const Ae=e.anchor=t.anchor,Ge=e.target=t.target,ze=e.targetAnchor=t.targetAnchor,Ke=i_(t.props),Xe=Ke?r:Ge,Ue=Ke?Ae:ze;if(y==="svg"||lP(Ge)?y="svg":(y==="mathml"||cP(Ge))&&(y="mathml"),fe?(Z(t.dynamicChildren,fe,Xe,h,_,y,s),kS(t,e,!0)):I||j(t,e,Xe,Ue,h,_,y,s,!1),me)Ke?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):ov(e,r,Ae,O,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const et=e.target=QT(e.props,se);et&&ov(e,et,null,O,0)}else Ke&&ov(e,Ge,ze,O,1);Vv(e,me)}},remove(t,e,r,{um:l,o:{remove:h}},_){const{shapeFlag:y,children:s,anchor:I,targetStart:O,targetAnchor:k,target:j,props:Z}=t;if(j&&(h(O),h(k)),_&&h(I),y&16){const Y=_||!i_(Z);for(let se=0;se<s.length;se++){const ne=s[se];l(ne,e,r,Y,!!ne.dynamicChildren)}}},move:ov,hydrate:uH};function ov(t,e,r,{o:{insert:l},m:h},_=2){_===0&&l(t.targetAnchor,e,r);const{el:y,anchor:s,shapeFlag:I,children:O,props:k}=t,j=_===2;if(j&&l(y,e,r),(!j||i_(k))&&I&16)for(let Z=0;Z<O.length;Z++)h(O[Z],e,r,2);j&&l(s,e,r)}function uH(t,e,r,l,h,_,{o:{nextSibling:y,parentNode:s,querySelector:I,insert:O,createText:k}},j){const Z=e.target=QT(e.props,I);if(Z){const Y=i_(e.props),se=Z._lpa||Z.firstChild;if(e.shapeFlag&16)if(Y)e.anchor=j(y(t),e,s(t),r,l,h,_),e.targetStart=se,e.targetAnchor=se&&y(se);else{e.anchor=y(t);let ne=se;for(;ne;){if(ne&&ne.nodeType===8){if(ne.data==="teleport start anchor")e.targetStart=ne;else if(ne.data==="teleport anchor"){e.targetAnchor=ne,Z._lpa=e.targetAnchor&&y(e.targetAnchor);break}}ne=y(ne)}e.targetAnchor||NO(Z,e,k,O),j(se&&y(se),e,Z,r,l,h,_)}Vv(e,Y)}return e.anchor&&y(e.anchor)}const hH=BO;function Vv(t,e){const r=t.ctx;if(r&&r.ut){let l,h;for(e?(l=t.el,h=t.anchor):(l=t.targetStart,h=t.targetAnchor);l&&l!==h;)l.nodeType===1&&l.setAttribute("data-v-owner",r.uid),l=l.nextSibling;r.ut()}}function NO(t,e,r,l){const h=e.targetStart=r(""),_=e.targetAnchor=r("");return h[zO]=_,t&&(l(h,t),l(_,t)),_}const pu=Symbol("_leaveCb"),av=Symbol("_enterCb");function SS(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return K_(()=>{t.isMounted=!0}),w1(()=>{t.isUnmounting=!0}),t}const Qo=[Function,Array],AS={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Qo,onEnter:Qo,onAfterEnter:Qo,onEnterCancelled:Qo,onBeforeLeave:Qo,onLeave:Qo,onAfterLeave:Qo,onLeaveCancelled:Qo,onBeforeAppear:Qo,onAppear:Qo,onAfterAppear:Qo,onAppearCancelled:Qo},VO=t=>{const e=t.subTree;return e.component?VO(e.component):e},dH={name:"BaseTransition",props:AS,setup(t,{slots:e}){const r=ca(),l=SS();return()=>{const h=e.default&&v1(e.default(),!0);if(!h||!h.length)return;const _=UO(h),y=Dn(t),{mode:s}=y;if(l.isLeaving)return lT(_);const I=uP(_);if(!I)return lT(_);let O=hp(I,y,l,r,j=>O=j);I.type!==Gs&&sc(I,O);let k=r.subTree&&uP(r.subTree);if(k&&k.type!==Gs&&!Oa(I,k)&&VO(r).type!==Gs){let j=hp(k,y,l,r);if(sc(k,j),s==="out-in"&&I.type!==Gs)return l.isLeaving=!0,j.afterLeave=()=>{l.isLeaving=!1,r.job.flags&8||r.update(),delete j.afterLeave,k=void 0},lT(_);s==="in-out"&&I.type!==Gs?j.delayLeave=(Z,Y,se)=>{const ne=$O(l,k);ne[String(k.key)]=k,Z[pu]=()=>{Y(),Z[pu]=void 0,delete O.delayedLeave,k=void 0},O.delayedLeave=()=>{se(),delete O.delayedLeave,k=void 0}}:k=void 0}else k&&(k=void 0);return _}}};function UO(t){let e=t[0];if(t.length>1){for(const r of t)if(r.type!==Gs){e=r;break}}return e}const jO=dH;function $O(t,e){const{leavingVNodes:r}=t;let l=r.get(e.type);return l||(l=Object.create(null),r.set(e.type,l)),l}function hp(t,e,r,l,h){const{appear:_,mode:y,persisted:s=!1,onBeforeEnter:I,onEnter:O,onAfterEnter:k,onEnterCancelled:j,onBeforeLeave:Z,onLeave:Y,onAfterLeave:se,onLeaveCancelled:ne,onBeforeAppear:de,onAppear:me,onAfterAppear:Te,onAppearCancelled:ge}=e,fe=String(t.key),Ae=$O(r,t),Ge=(Xe,Ue)=>{Xe&&aa(Xe,l,9,Ue)},ze=(Xe,Ue)=>{const et=Ue[1];Ge(Xe,Ue),yi(Xe)?Xe.every(lt=>lt.length<=1)&&et():Xe.length<=1&&et()},Ke={mode:y,persisted:s,beforeEnter(Xe){let Ue=I;if(!r.isMounted)if(_)Ue=de||I;else return;Xe[pu]&&Xe[pu](!0);const et=Ae[fe];et&&Oa(t,et)&&et.el[pu]&&et.el[pu](),Ge(Ue,[Xe])},enter(Xe){let Ue=O,et=k,lt=j;if(!r.isMounted)if(_)Ue=me||O,et=Te||k,lt=ge||j;else return;let Mt=!1;const si=Xe[av]=bt=>{Mt||(Mt=!0,bt?Ge(lt,[Xe]):Ge(et,[Xe]),Ke.delayedLeave&&Ke.delayedLeave(),Xe[av]=void 0)};Ue?ze(Ue,[Xe,si]):si()},leave(Xe,Ue){const et=String(t.key);if(Xe[av]&&Xe[av](!0),r.isUnmounting)return Ue();Ge(Z,[Xe]);let lt=!1;const Mt=Xe[pu]=si=>{lt||(lt=!0,Ue(),si?Ge(ne,[Xe]):Ge(se,[Xe]),Xe[pu]=void 0,Ae[et]===t&&delete Ae[et])};Ae[et]=t,Y?ze(Y,[Xe,Mt]):Mt()},clone(Xe){const Ue=hp(Xe,e,r,l,h);return h&&h(Ue),Ue}};return Ke}function lT(t){if(Y_(t))return t=_l(t),t.children=null,t}function uP(t){if(!Y_(t))return FO(t.type)&&t.children?UO(t.children):t;const{shapeFlag:e,children:r}=t;if(r){if(e&16)return r[0];if(e&32&&Bi(r.default))return r.default()}}function sc(t,e){t.shapeFlag&6&&t.component?(t.transition=e,sc(t.component.subTree,e)):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function v1(t,e=!1,r){let l=[],h=0;for(let _=0;_<t.length;_++){let y=t[_];const s=r==null?y.key:String(r)+String(y.key!=null?y.key:_);y.type===os?(y.patchFlag&128&&h++,l=l.concat(v1(y.children,e,s))):(e||y.type!==Gs)&&l.push(s!=null?_l(y,{key:s}):y)}if(h>1)for(let _=0;_<l.length;_++)l[_].patchFlag=-2;return l}/*! #__NO_SIDE_EFFECTS__ */function MS(t,e){return Bi(t)?(()=>wn({name:t.name},e,{setup:t}))():t}function fH(){const t=ca();return t?(t.appContext.config.idPrefix||"v")+"-"+t.ids[0]+t.ids[1]++:""}function IS(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}function pH(t){const e=ca(),r=AO(null);if(e){const h=e.refs===xn?e.refs={}:e.refs;Object.defineProperty(h,t,{enumerable:!0,get:()=>r.value,set:_=>r.value=_})}return r}function T_(t,e,r,l,h=!1){if(yi(t)){t.forEach((se,ne)=>T_(se,e&&(yi(e)?e[ne]:e),r,l,h));return}if(Eu(l)&&!h){l.shapeFlag&512&&l.type.__asyncResolved&&l.component.subTree.component&&T_(t,e,r,l.component.subTree);return}const _=l.shapeFlag&4?Q_(l.component):l.el,y=h?null:_,{i:s,r:I}=t,O=e&&e.r,k=s.refs===xn?s.refs={}:s.refs,j=s.setupState,Z=Dn(j),Y=j===xn?()=>!1:se=>Fn(Z,se);if(O!=null&&O!==I&&(sn(O)?(k[O]=null,Y(O)&&(j[O]=null)):rr(O)&&(O.value=null)),Bi(I))Lp(I,s,12,[y,k]);else{const se=sn(I),ne=rr(I);if(se||ne){const de=()=>{if(t.f){const me=se?Y(I)?j[I]:k[I]:I.value;h?yi(me)&&pS(me,_):yi(me)?me.includes(_)||me.push(_):se?(k[I]=[_],Y(I)&&(j[I]=k[I])):(I.value=[_],t.k&&(k[t.k]=I.value))}else se?(k[I]=y,Y(I)&&(j[I]=y)):ne&&(I.value=y,t.k&&(k[t.k]=y))};y?(de.id=-1,er(de,r)):de()}}}let hP=!1;const Vf=()=>{hP||(console.error("Hydration completed but contains mismatches."),hP=!0)},mH=t=>t.namespaceURI.includes("svg")&&t.tagName!=="foreignObject",gH=t=>t.namespaceURI.includes("MathML"),lv=t=>{if(t.nodeType===1){if(mH(t))return"svg";if(gH(t))return"mathml"}},Yf=t=>t.nodeType===8;function _H(t){const{mt:e,p:r,o:{patchProp:l,createText:h,nextSibling:_,parentNode:y,remove:s,insert:I,createComment:O}}=t,k=(ge,fe)=>{if(!fe.hasChildNodes()){r(null,ge,fe),mx(),fe._vnode=ge;return}j(fe.firstChild,ge,null,null,null),mx(),fe._vnode=ge},j=(ge,fe,Ae,Ge,ze,Ke=!1)=>{Ke=Ke||!!fe.dynamicChildren;const Xe=Yf(ge)&&ge.data==="[",Ue=()=>ne(ge,fe,Ae,Ge,ze,Xe),{type:et,ref:lt,shapeFlag:Mt,patchFlag:si}=fe;let bt=ge.nodeType;fe.el=ge,si===-2&&(Ke=!1,fe.dynamicChildren=null);let Rt=null;switch(et){case Su:bt!==3?fe.children===""?(I(fe.el=h(""),y(ge),ge),Rt=ge):Rt=Ue():(ge.data!==fe.children&&(Vf(),ge.data=fe.children),Rt=_(ge));break;case Gs:Te(ge)?(Rt=_(ge),me(fe.el=ge.content.firstChild,ge,Ae)):bt!==8||Xe?Rt=Ue():Rt=_(ge);break;case nd:if(Xe&&(ge=_(ge),bt=ge.nodeType),bt===1||bt===3){Rt=ge;const Kt=!fe.children.length;for(let ii=0;ii<fe.staticCount;ii++)Kt&&(fe.children+=Rt.nodeType===1?Rt.outerHTML:Rt.data),ii===fe.staticCount-1&&(fe.anchor=Rt),Rt=_(Rt);return Xe?_(Rt):Rt}else Ue();break;case os:Xe?Rt=se(ge,fe,Ae,Ge,ze,Ke):Rt=Ue();break;default:if(Mt&1)(bt!==1||fe.type.toLowerCase()!==ge.tagName.toLowerCase())&&!Te(ge)?Rt=Ue():Rt=Z(ge,fe,Ae,Ge,ze,Ke);else if(Mt&6){fe.slotScopeIds=ze;const Kt=y(ge);if(Xe?Rt=de(ge):Yf(ge)&&ge.data==="teleport start"?Rt=de(ge,ge.data,"teleport end"):Rt=_(ge),e(fe,Kt,null,Ae,Ge,lv(Kt),Ke),Eu(fe)&&!fe.type.__asyncResolved){let ii;Xe?(ii=Yn(os),ii.anchor=Rt?Rt.previousSibling:Kt.lastChild):ii=ge.nodeType===3?Ro(""):Yn("div"),ii.el=ge,fe.component.subTree=ii}}else Mt&64?bt!==8?Rt=Ue():Rt=fe.type.hydrate(ge,fe,Ae,Ge,ze,Ke,t,Y):Mt&128&&(Rt=fe.type.hydrate(ge,fe,Ae,Ge,lv(y(ge)),ze,Ke,t,j))}return lt!=null&&T_(lt,null,Ge,fe),Rt},Z=(ge,fe,Ae,Ge,ze,Ke)=>{Ke=Ke||!!fe.dynamicChildren;const{type:Xe,props:Ue,patchFlag:et,shapeFlag:lt,dirs:Mt,transition:si}=fe,bt=Xe==="input"||Xe==="option";if(bt||et!==-1){Mt&&dl(fe,null,Ae,"created");let Rt=!1;if(Te(ge)){Rt=m3(null,si)&&Ae&&Ae.vnode.props&&Ae.vnode.props.appear;const ii=ge.content.firstChild;Rt&&si.beforeEnter(ii),me(ii,ge,Ae),fe.el=ge=ii}if(lt&16&&!(Ue&&(Ue.innerHTML||Ue.textContent))){let ii=Y(ge.firstChild,fe,ge,Ae,Ge,ze,Ke);for(;ii;){cv(ge,1)||Vf();const qt=ii;ii=ii.nextSibling,s(qt)}}else if(lt&8){let ii=fe.children;ii[0]===`
`&&(ge.tagName==="PRE"||ge.tagName==="TEXTAREA")&&(ii=ii.slice(1)),ge.textContent!==ii&&(cv(ge,0)||Vf(),ge.textContent=fe.children)}if(Ue){if(bt||!Ke||et&48){const ii=ge.tagName.includes("-");for(const qt in Ue)(bt&&(qt.endsWith("value")||qt==="indeterminate")||yd(qt)&&!wu(qt)||qt[0]==="."||ii)&&l(ge,qt,null,Ue[qt],void 0,Ae)}else if(Ue.onClick)l(ge,"onClick",null,Ue.onClick,void 0,Ae);else if(et&4&&Tu(Ue.style))for(const ii in Ue.style)Ue.style[ii]}let Kt;(Kt=Ue&&Ue.onVnodeBeforeMount)&&po(Kt,Ae,fe),Mt&&dl(fe,null,Ae,"beforeMount"),((Kt=Ue&&Ue.onVnodeMounted)||Mt||Rt)&&E3(()=>{Kt&&po(Kt,Ae,fe),Rt&&si.enter(ge),Mt&&dl(fe,null,Ae,"mounted")},Ge)}return ge.nextSibling},Y=(ge,fe,Ae,Ge,ze,Ke,Xe)=>{Xe=Xe||!!fe.dynamicChildren;const Ue=fe.children,et=Ue.length;for(let lt=0;lt<et;lt++){const Mt=Xe?Ue[lt]:Ue[lt]=mo(Ue[lt]),si=Mt.type===Su;ge?(si&&!Xe&&lt+1<et&&mo(Ue[lt+1]).type===Su&&(I(h(ge.data.slice(Mt.children.length)),Ae,_(ge)),ge.data=Mt.children),ge=j(ge,Mt,Ge,ze,Ke,Xe)):si&&!Mt.children?I(Mt.el=h(""),Ae):(cv(Ae,1)||Vf(),r(null,Mt,Ae,null,Ge,ze,lv(Ae),Ke))}return ge},se=(ge,fe,Ae,Ge,ze,Ke)=>{const{slotScopeIds:Xe}=fe;Xe&&(ze=ze?ze.concat(Xe):Xe);const Ue=y(ge),et=Y(_(ge),fe,Ue,Ae,Ge,ze,Ke);return et&&Yf(et)&&et.data==="]"?_(fe.anchor=et):(Vf(),I(fe.anchor=O("]"),Ue,et),et)},ne=(ge,fe,Ae,Ge,ze,Ke)=>{if(cv(ge.parentElement,1)||Vf(),fe.el=null,Ke){const et=de(ge);for(;;){const lt=_(ge);if(lt&&lt!==et)s(lt);else break}}const Xe=_(ge),Ue=y(ge);return s(ge),r(null,fe,Ue,Xe,Ae,Ge,lv(Ue),ze),Ae&&(Ae.vnode.el=fe.el,S1(Ae,fe.el)),Xe},de=(ge,fe="[",Ae="]")=>{let Ge=0;for(;ge;)if(ge=_(ge),ge&&Yf(ge)&&(ge.data===fe&&Ge++,ge.data===Ae)){if(Ge===0)return _(ge);Ge--}return ge},me=(ge,fe,Ae)=>{const Ge=fe.parentNode;Ge&&Ge.replaceChild(ge,fe);let ze=Ae;for(;ze;)ze.vnode.el===fe&&(ze.vnode.el=ze.subTree.el=ge),ze=ze.parent},Te=ge=>ge.nodeType===1&&ge.tagName==="TEMPLATE";return[k,j]}const dP="data-allow-mismatch",yH={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function cv(t,e){if(e===0||e===1)for(;t&&!t.hasAttribute(dP);)t=t.parentElement;const r=t&&t.getAttribute(dP);if(r==null)return!1;if(r==="")return!0;{const l=r.split(",");return e===0&&l.includes("children")?!0:r.split(",").includes(yH[e])}}const vH=l1().requestIdleCallback||(t=>setTimeout(t,1)),xH=l1().cancelIdleCallback||(t=>clearTimeout(t)),bH=(t=1e4)=>e=>{const r=vH(e,{timeout:t});return()=>xH(r)};function wH(t){const{top:e,left:r,bottom:l,right:h}=t.getBoundingClientRect(),{innerHeight:_,innerWidth:y}=window;return(e>0&&e<_||l>0&&l<_)&&(r>0&&r<y||h>0&&h<y)}const TH=t=>(e,r)=>{const l=new IntersectionObserver(h=>{for(const _ of h)if(_.isIntersecting){l.disconnect(),e();break}},t);return r(h=>{if(h instanceof Element){if(wH(h))return e(),l.disconnect(),!1;l.observe(h)}}),()=>l.disconnect()},EH=t=>e=>{if(t){const r=matchMedia(t);if(r.matches)e();else return r.addEventListener("change",e,{once:!0}),()=>r.removeEventListener("change",e)}},SH=(t=[])=>(e,r)=>{sn(t)&&(t=[t]);let l=!1;const h=y=>{l||(l=!0,_(),e(),y.target.dispatchEvent(new y.constructor(y.type,y)))},_=()=>{r(y=>{for(const s of t)y.removeEventListener(s,h)})};return r(y=>{for(const s of t)y.addEventListener(s,h,{once:!0})}),_};function AH(t,e){if(Yf(t)&&t.data==="["){let r=1,l=t.nextSibling;for(;l;){if(l.nodeType===1){if(e(l)===!1)break}else if(Yf(l))if(l.data==="]"){if(--r===0)break}else l.data==="["&&r++;l=l.nextSibling}}else e(t)}const Eu=t=>!!t.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function MH(t){Bi(t)&&(t={loader:t});const{loader:e,loadingComponent:r,errorComponent:l,delay:h=200,hydrate:_,timeout:y,suspensible:s=!0,onError:I}=t;let O=null,k,j=0;const Z=()=>(j++,O=null,Y()),Y=()=>{let se;return O||(se=O=e().catch(ne=>{if(ne=ne instanceof Error?ne:new Error(String(ne)),I)return new Promise((de,me)=>{I(ne,()=>de(Z()),()=>me(ne),j+1)});throw ne}).then(ne=>se!==O&&O?O:(ne&&(ne.__esModule||ne[Symbol.toStringTag]==="Module")&&(ne=ne.default),k=ne,ne)))};return MS({name:"AsyncComponentWrapper",__asyncLoader:Y,__asyncHydrate(se,ne,de){const me=_?()=>{const Te=_(de,ge=>AH(se,ge));Te&&(ne.bum||(ne.bum=[])).push(Te)}:de;k?me():Y().then(()=>!ne.isUnmounted&&me())},get __asyncResolved(){return k},setup(){const se=ir;if(IS(se),k)return()=>cT(k,se);const ne=ge=>{O=null,bd(ge,se,13,!l)};if(s&&se.suspense||fp)return Y().then(ge=>()=>cT(ge,se)).catch(ge=>(ne(ge),()=>l?Yn(l,{error:ge}):null));const de=t_(!1),me=t_(),Te=t_(!!h);return h&&setTimeout(()=>{Te.value=!1},h),y!=null&&setTimeout(()=>{if(!de.value&&!me.value){const ge=new Error(`Async component timed out after ${y}ms.`);ne(ge),me.value=ge}},y),Y().then(()=>{de.value=!0,se.parent&&Y_(se.parent.vnode)&&se.parent.update()}).catch(ge=>{ne(ge),me.value=ge}),()=>{if(de.value&&k)return cT(k,se);if(me.value&&l)return Yn(l,{error:me.value});if(r&&!Te.value)return Yn(r)}}})}function cT(t,e){const{ref:r,props:l,children:h,ce:_}=e.vnode,y=Yn(t,l,h);return y.ref=r,y.ce=_,delete e.vnode.ce,y}const Y_=t=>t.type.__isKeepAlive,IH={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(t,{slots:e}){const r=ca(),l=r.ctx;if(!l.renderer)return()=>{const Te=e.default&&e.default();return Te&&Te.length===1?Te[0]:Te};const h=new Map,_=new Set;let y=null;const s=r.suspense,{renderer:{p:I,m:O,um:k,o:{createElement:j}}}=l,Z=j("div");l.activate=(Te,ge,fe,Ae,Ge)=>{const ze=Te.component;O(Te,ge,fe,0,s),I(ze.vnode,Te,ge,fe,ze,s,Ae,Te.slotScopeIds,Ge),er(()=>{ze.isDeactivated=!1,ze.a&&ep(ze.a);const Ke=Te.props&&Te.props.onVnodeMounted;Ke&&po(Ke,ze.parent,Te)},s)},l.deactivate=Te=>{const ge=Te.component;yx(ge.m),yx(ge.a),O(Te,Z,null,1,s),er(()=>{ge.da&&ep(ge.da);const fe=Te.props&&Te.props.onVnodeUnmounted;fe&&po(fe,ge.parent,Te),ge.isDeactivated=!0},s)};function Y(Te){uT(Te),k(Te,r,s,!0)}function se(Te){h.forEach((ge,fe)=>{const Ae=hE(ge.type);Ae&&!Te(Ae)&&ne(fe)})}function ne(Te){const ge=h.get(Te);ge&&(!y||!Oa(ge,y))?Y(ge):y&&uT(y),h.delete(Te),_.delete(Te)}ip(()=>[t.include,t.exclude],([Te,ge])=>{Te&&se(fe=>$g(Te,fe)),ge&&se(fe=>!$g(ge,fe))},{flush:"post",deep:!0});let de=null;const me=()=>{de!=null&&(vx(r.subTree.type)?er(()=>{h.set(de,uv(r.subTree))},r.subTree.suspense):h.set(de,uv(r.subTree)))};return K_(me),b1(me),w1(()=>{h.forEach(Te=>{const{subTree:ge,suspense:fe}=r,Ae=uv(ge);if(Te.type===Ae.type&&Te.key===Ae.key){uT(Ae);const Ge=Ae.component.da;Ge&&er(Ge,fe);return}Y(Te)})}),()=>{if(de=null,!e.default)return y=null;const Te=e.default(),ge=Te[0];if(Te.length>1)return y=null,Te;if(!rc(ge)||!(ge.shapeFlag&4)&&!(ge.shapeFlag&128))return y=null,ge;let fe=uv(ge);if(fe.type===Gs)return y=null,fe;const Ae=fe.type,Ge=hE(Eu(fe)?fe.type.__asyncResolved||{}:Ae),{include:ze,exclude:Ke,max:Xe}=t;if(ze&&(!Ge||!$g(ze,Ge))||Ke&&Ge&&$g(Ke,Ge))return fe.shapeFlag&=-257,y=fe,ge;const Ue=fe.key==null?Ae:fe.key,et=h.get(Ue);return fe.el&&(fe=_l(fe),ge.shapeFlag&128&&(ge.ssContent=fe)),de=Ue,et?(fe.el=et.el,fe.component=et.component,fe.transition&&sc(fe,fe.transition),fe.shapeFlag|=512,_.delete(Ue),_.add(Ue)):(_.add(Ue),Xe&&_.size>parseInt(Xe,10)&&ne(_.values().next().value)),fe.shapeFlag|=256,y=fe,vx(ge.type)?ge:fe}}},CH=IH;function $g(t,e){return yi(t)?t.some(r=>$g(r,e)):sn(t)?t.split(",").includes(e):q8(t)?(t.lastIndex=0,t.test(e)):!1}function HO(t,e){qO(t,"a",e)}function GO(t,e){qO(t,"da",e)}function qO(t,e,r=ir){const l=t.__wdc||(t.__wdc=()=>{let h=r;for(;h;){if(h.isDeactivated)return;h=h.parent}return t()});if(x1(e,l,r),r){let h=r.parent;for(;h&&h.parent;)Y_(h.parent.vnode)&&PH(l,e,r,h),h=h.parent}}function PH(t,e,r,l){const h=x1(e,t,l,!0);T1(()=>{pS(l[e],h)},r)}function uT(t){t.shapeFlag&=-257,t.shapeFlag&=-513}function uv(t){return t.shapeFlag&128?t.ssContent:t}function x1(t,e,r=ir,l=!1){if(r){const h=r[t]||(r[t]=[]),_=e.__weh||(e.__weh=(...y)=>{Nu();const s=dd(r),I=aa(e,r,t,y);return s(),Vu(),I});return l?h.unshift(_):h.push(_),_}}const ac=t=>(e,r=ir)=>{(!fp||t==="sp")&&x1(t,(...l)=>e(...l),r)},WO=ac("bm"),K_=ac("m"),CS=ac("bu"),b1=ac("u"),w1=ac("bum"),T1=ac("um"),ZO=ac("sp"),XO=ac("rtg"),YO=ac("rtc");function KO(t,e=ir){x1("ec",t,e)}const PS="components",DH="directives";function gx(t,e){return DS(PS,t,!0,e)||t}const JO=Symbol.for("v-ndc");function RH(t){return sn(t)?DS(PS,t,!1)||t:t||JO}function LH(t){return DS(DH,t)}function DS(t,e,r=!0,l=!1){const h=nr||ir;if(h){const _=h.type;if(t===PS){const s=hE(_,!1);if(s&&(s===e||s===cs(e)||s===xd(cs(e))))return _}const y=fP(h[t]||_[t],e)||fP(h.appContext[t],e);return!y&&l?_:y}}function fP(t,e){return t&&(t[e]||t[cs(e)]||t[xd(cs(e))])}function dp(t,e,r,l){let h;const _=r&&r[l],y=yi(t);if(y||sn(t)){const s=y&&Tu(t);let I=!1;s&&(I=!Fo(t),t=h1(t)),h=new Array(t.length);for(let O=0,k=t.length;O<k;O++)h[O]=e(I?Dr(t[O]):t[O],O,void 0,_&&_[O])}else if(typeof t=="number"){h=new Array(t);for(let s=0;s<t;s++)h[s]=e(s+1,s,void 0,_&&_[s])}else if($n(t))if(t[Symbol.iterator])h=Array.from(t,(s,I)=>e(s,I,void 0,_&&_[I]));else{const s=Object.keys(t);h=new Array(s.length);for(let I=0,O=s.length;I<O;I++){const k=s[I];h[I]=e(t[k],k,I,_&&_[I])}}else h=[];return r&&(r[l]=h),h}function OH(t,e){for(let r=0;r<e.length;r++){const l=e[r];if(yi(l))for(let h=0;h<l.length;h++)t[l[h].name]=l[h].fn;else l&&(t[l.name]=l.key?(...h)=>{const _=l.fn(...h);return _&&(_.key=l.key),_}:l.fn)}return t}function kH(t,e,r={},l,h){if(nr.ce||nr.parent&&Eu(nr.parent)&&nr.parent.ce)return e!=="default"&&(r.name=e),Fi(),A_(os,null,[Yn("slot",r,l&&l())],64);let _=t[e];_&&_._c&&(_._d=!1),Fi();const y=_&&RS(_(r)),s=r.key||y&&y.key,I=A_(os,{key:(s&&!xo(s)?s:`_${e}`)+(!y&&l?"_fb":"")},y||(l?l():[]),y&&t._===1?64:-2);return!h&&I.scopeId&&(I.slotScopeIds=[I.scopeId+"-s"]),_&&_._c&&(_._d=!0),I}function RS(t){return t.some(e=>rc(e)?!(e.type===Gs||e.type===os&&!RS(e.children)):!0)?t:null}function zH(t,e){const r={};for(const l in t)r[e&&/[A-Z]/.test(l)?`on:${l}`:Qf(l)]=t[l];return r}const eE=t=>t?D3(t)?Q_(t):eE(t.parent):null,n_=wn(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>eE(t.parent),$root:t=>eE(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>LS(t),$forceUpdate:t=>t.f||(t.f=()=>{TS(t.update)}),$nextTick:t=>t.n||(t.n=_1.bind(t.proxy)),$watch:t=>pG.bind(t)}),hT=(t,e)=>t!==xn&&!t.__isScriptSetup&&Fn(t,e),tE={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:r,setupState:l,data:h,props:_,accessCache:y,type:s,appContext:I}=t;let O;if(e[0]!=="$"){const Y=y[e];if(Y!==void 0)switch(Y){case 1:return l[e];case 2:return h[e];case 4:return r[e];case 3:return _[e]}else{if(hT(l,e))return y[e]=1,l[e];if(h!==xn&&Fn(h,e))return y[e]=2,h[e];if((O=t.propsOptions[0])&&Fn(O,e))return y[e]=3,_[e];if(r!==xn&&Fn(r,e))return y[e]=4,r[e];iE&&(y[e]=0)}}const k=n_[e];let j,Z;if(k)return e==="$attrs"&&Pr(t.attrs,"get",""),k(t);if((j=s.__cssModules)&&(j=j[e]))return j;if(r!==xn&&Fn(r,e))return y[e]=4,r[e];if(Z=I.config.globalProperties,Fn(Z,e))return Z[e]},set({_:t},e,r){const{data:l,setupState:h,ctx:_}=t;return hT(h,e)?(h[e]=r,!0):l!==xn&&Fn(l,e)?(l[e]=r,!0):Fn(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(_[e]=r,!0)},has({_:{data:t,setupState:e,accessCache:r,ctx:l,appContext:h,propsOptions:_}},y){let s;return!!r[y]||t!==xn&&Fn(t,y)||hT(e,y)||(s=_[0])&&Fn(s,y)||Fn(l,y)||Fn(n_,y)||Fn(h.config.globalProperties,y)},defineProperty(t,e,r){return r.get!=null?t._.accessCache[e]=0:Fn(r,"value")&&this.set(t,e,r.value,null),Reflect.defineProperty(t,e,r)}},FH=wn({},tE,{get(t,e){if(e!==Symbol.unscopables)return tE.get(t,e,t)},has(t,e){return e[0]!=="_"&&!Q8(e)}});function BH(){return null}function NH(){return null}function VH(t){}function UH(t){}function jH(){return null}function $H(){}function HH(t,e){return null}function GH(){return QO().slots}function qH(){return QO().attrs}function QO(){const t=ca();return t.setupContext||(t.setupContext=k3(t))}function E_(t){return yi(t)?t.reduce((e,r)=>(e[r]=null,e),{}):t}function WH(t,e){const r=E_(t);for(const l in e){if(l.startsWith("__skip"))continue;let h=r[l];h?yi(h)||Bi(h)?h=r[l]={type:h,default:e[l]}:h.default=e[l]:h===null&&(h=r[l]={default:e[l]}),h&&e[`__skip_${l}`]&&(h.skipFactory=!0)}return r}function ZH(t,e){return!t||!e?t||e:yi(t)&&yi(e)?t.concat(e):wn({},E_(t),E_(e))}function XH(t,e){const r={};for(const l in t)e.includes(l)||Object.defineProperty(r,l,{enumerable:!0,get:()=>t[l]});return r}function YH(t){const e=ca();let r=t();return lE(),mS(r)&&(r=r.catch(l=>{throw dd(e),l})),[r,()=>dd(e)]}let iE=!0;function KH(t){const e=LS(t),r=t.proxy,l=t.ctx;iE=!1,e.beforeCreate&&pP(e.beforeCreate,t,"bc");const{data:h,computed:_,methods:y,watch:s,provide:I,inject:O,created:k,beforeMount:j,mounted:Z,beforeUpdate:Y,updated:se,activated:ne,deactivated:de,beforeDestroy:me,beforeUnmount:Te,destroyed:ge,unmounted:fe,render:Ae,renderTracked:Ge,renderTriggered:ze,errorCaptured:Ke,serverPrefetch:Xe,expose:Ue,inheritAttrs:et,components:lt,directives:Mt,filters:si}=e;if(O&&JH(O,l,null),y)for(const Kt in y){const ii=y[Kt];Bi(ii)&&(l[Kt]=ii.bind(r))}if(h){const Kt=h.call(r,r);$n(Kt)&&(t.data=f1(Kt))}if(iE=!0,_)for(const Kt in _){const ii=_[Kt],qt=Bi(ii)?ii.bind(r,r):Bi(ii.get)?ii.get.bind(r,r):hr,gn=!Bi(ii)&&Bi(ii.set)?ii.set.bind(r):hr,Hn=z3({get:qt,set:gn});Object.defineProperty(l,Kt,{enumerable:!0,configurable:!0,get:()=>Hn.value,set:Ln=>Hn.value=Ln})}if(s)for(const Kt in s)e3(s[Kt],l,r,Kt);if(I){const Kt=Bi(I)?I.call(r):I;Reflect.ownKeys(Kt).forEach(ii=>{i3(ii,Kt[ii])})}k&&pP(k,t,"c");function Rt(Kt,ii){yi(ii)?ii.forEach(qt=>Kt(qt.bind(r))):ii&&Kt(ii.bind(r))}if(Rt(WO,j),Rt(K_,Z),Rt(CS,Y),Rt(b1,se),Rt(HO,ne),Rt(GO,de),Rt(KO,Ke),Rt(YO,Ge),Rt(XO,ze),Rt(w1,Te),Rt(T1,fe),Rt(ZO,Xe),yi(Ue))if(Ue.length){const Kt=t.exposed||(t.exposed={});Ue.forEach(ii=>{Object.defineProperty(Kt,ii,{get:()=>r[ii],set:qt=>r[ii]=qt})})}else t.exposed||(t.exposed={});Ae&&t.render===hr&&(t.render=Ae),et!=null&&(t.inheritAttrs=et),lt&&(t.components=lt),Mt&&(t.directives=Mt),Xe&&IS(t)}function JH(t,e,r=hr){yi(t)&&(t=nE(t));for(const l in t){const h=t[l];let _;$n(h)?"default"in h?_=s_(h.from||l,h.default,!0):_=s_(h.from||l):_=s_(h),rr(_)?Object.defineProperty(e,l,{enumerable:!0,configurable:!0,get:()=>_.value,set:y=>_.value=y}):e[l]=_}}function pP(t,e,r){aa(yi(t)?t.map(l=>l.bind(e.proxy)):t.bind(e.proxy),e,r)}function e3(t,e,r,l){let h=l.includes(".")?x3(r,l):()=>r[l];if(sn(t)){const _=e[t];Bi(_)&&ip(h,_)}else if(Bi(t))ip(h,t.bind(r));else if($n(t))if(yi(t))t.forEach(_=>e3(_,e,r,l));else{const _=Bi(t.handler)?t.handler.bind(r):e[t.handler];Bi(_)&&ip(h,_,t)}}function LS(t){const e=t.type,{mixins:r,extends:l}=e,{mixins:h,optionsCache:_,config:{optionMergeStrategies:y}}=t.appContext,s=_.get(e);let I;return s?I=s:!h.length&&!r&&!l?I=e:(I={},h.length&&h.forEach(O=>_x(I,O,y,!0)),_x(I,e,y)),$n(e)&&_.set(e,I),I}function _x(t,e,r,l=!1){const{mixins:h,extends:_}=e;_&&_x(t,_,r,!0),h&&h.forEach(y=>_x(t,y,r,!0));for(const y in e)if(!(l&&y==="expose")){const s=QH[y]||r&&r[y];t[y]=s?s(t[y],e[y]):e[y]}return t}const QH={data:mP,props:gP,emits:gP,methods:Hg,computed:Hg,beforeCreate:Xr,created:Xr,beforeMount:Xr,mounted:Xr,beforeUpdate:Xr,updated:Xr,beforeDestroy:Xr,beforeUnmount:Xr,destroyed:Xr,unmounted:Xr,activated:Xr,deactivated:Xr,errorCaptured:Xr,serverPrefetch:Xr,components:Hg,directives:Hg,watch:tG,provide:mP,inject:eG};function mP(t,e){return e?t?function(){return wn(Bi(t)?t.call(this,this):t,Bi(e)?e.call(this,this):e)}:e:t}function eG(t,e){return Hg(nE(t),nE(e))}function nE(t){if(yi(t)){const e={};for(let r=0;r<t.length;r++)e[t[r]]=t[r];return e}return t}function Xr(t,e){return t?[...new Set([].concat(t,e))]:e}function Hg(t,e){return t?wn(Object.create(null),t,e):e}function gP(t,e){return t?yi(t)&&yi(e)?[...new Set([...t,...e])]:wn(Object.create(null),E_(t),E_(e??{})):e}function tG(t,e){if(!t)return e;if(!e)return t;const r=wn(Object.create(null),t);for(const l in e)r[l]=Xr(t[l],e[l]);return r}function t3(){return{app:null,config:{isNativeTag:jg,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let iG=0;function nG(t,e){return function(l,h=null){Bi(l)||(l=wn({},l)),h!=null&&!$n(h)&&(h=null);const _=t3(),y=new WeakSet,s=[];let I=!1;const O=_.app={_uid:iG++,_component:l,_props:h,_container:null,_context:_,_instance:null,version:N3,get config(){return _.config},set config(k){},use(k,...j){return y.has(k)||(k&&Bi(k.install)?(y.add(k),k.install(O,...j)):Bi(k)&&(y.add(k),k(O,...j))),O},mixin(k){return _.mixins.includes(k)||_.mixins.push(k),O},component(k,j){return j?(_.components[k]=j,O):_.components[k]},directive(k,j){return j?(_.directives[k]=j,O):_.directives[k]},mount(k,j,Z){if(!I){const Y=O._ceVNode||Yn(l,h);return Y.appContext=_,Z===!0?Z="svg":Z===!1&&(Z=void 0),j&&e?e(Y,k):t(Y,k,Z),I=!0,O._container=k,k.__vue_app__=O,Q_(Y.component)}},onUnmount(k){s.push(k)},unmount(){I&&(aa(s,O._instance,16),t(null,O._container),delete O._container.__vue_app__)},provide(k,j){return _.provides[k]=j,O},runWithContext(k){const j=id;id=O;try{return k()}finally{id=j}}};return O}}let id=null;function i3(t,e){if(ir){let r=ir.provides;const l=ir.parent&&ir.parent.provides;l===r&&(r=ir.provides=Object.create(l)),r[t]=e}}function s_(t,e,r=!1){const l=ir||nr;if(l||id){const h=id?id._context.provides:l?l.parent==null?l.vnode.appContext&&l.vnode.appContext.provides:l.parent.provides:void 0;if(h&&t in h)return h[t];if(arguments.length>1)return r&&Bi(e)?e.call(l&&l.proxy):e}}function sG(){return!!(ir||nr||id)}const n3={},s3=()=>Object.create(n3),r3=t=>Object.getPrototypeOf(t)===n3;function rG(t,e,r,l=!1){const h={},_=s3();t.propsDefaults=Object.create(null),o3(t,e,h,_);for(const y in t.propsOptions[0])y in h||(h[y]=void 0);r?t.props=l?h:EO(h):t.type.props?t.props=h:t.props=_,t.attrs=_}function oG(t,e,r,l){const{props:h,attrs:_,vnode:{patchFlag:y}}=t,s=Dn(h),[I]=t.propsOptions;let O=!1;if((l||y>0)&&!(y&16)){if(y&8){const k=t.vnode.dynamicProps;for(let j=0;j<k.length;j++){let Z=k[j];if(E1(t.emitsOptions,Z))continue;const Y=e[Z];if(I)if(Fn(_,Z))Y!==_[Z]&&(_[Z]=Y,O=!0);else{const se=cs(Z);h[se]=sE(I,s,se,Y,t,!1)}else Y!==_[Z]&&(_[Z]=Y,O=!0)}}}else{o3(t,e,h,_)&&(O=!0);let k;for(const j in s)(!e||!Fn(e,j)&&((k=_o(j))===j||!Fn(e,k)))&&(I?r&&(r[j]!==void 0||r[k]!==void 0)&&(h[j]=sE(I,s,j,void 0,t,!0)):delete h[j]);if(_!==s)for(const j in _)(!e||!Fn(e,j))&&(delete _[j],O=!0)}O&&ql(t.attrs,"set","")}function o3(t,e,r,l){const[h,_]=t.propsOptions;let y=!1,s;if(e)for(let I in e){if(wu(I))continue;const O=e[I];let k;h&&Fn(h,k=cs(I))?!_||!_.includes(k)?r[k]=O:(s||(s={}))[k]=O:E1(t.emitsOptions,I)||(!(I in l)||O!==l[I])&&(l[I]=O,y=!0)}if(_){const I=Dn(r),O=s||xn;for(let k=0;k<_.length;k++){const j=_[k];r[j]=sE(h,I,j,O[j],t,!Fn(O,j))}}return y}function sE(t,e,r,l,h,_){const y=t[r];if(y!=null){const s=Fn(y,"default");if(s&&l===void 0){const I=y.default;if(y.type!==Function&&!y.skipFactory&&Bi(I)){const{propsDefaults:O}=h;if(r in O)l=O[r];else{const k=dd(h);l=O[r]=I.call(null,e),k()}}else l=I;h.ce&&h.ce._setProp(r,l)}y[0]&&(_&&!s?l=!1:y[1]&&(l===""||l===_o(r))&&(l=!0))}return l}const aG=new WeakMap;function a3(t,e,r=!1){const l=r?aG:e.propsCache,h=l.get(t);if(h)return h;const _=t.props,y={},s=[];let I=!1;if(!Bi(t)){const k=j=>{I=!0;const[Z,Y]=a3(j,e,!0);wn(y,Z),Y&&s.push(...Y)};!r&&e.mixins.length&&e.mixins.forEach(k),t.extends&&k(t.extends),t.mixins&&t.mixins.forEach(k)}if(!_&&!I)return $n(t)&&l.set(t,Kf),Kf;if(yi(_))for(let k=0;k<_.length;k++){const j=cs(_[k]);_P(j)&&(y[j]=xn)}else if(_)for(const k in _){const j=cs(k);if(_P(j)){const Z=_[k],Y=y[j]=yi(Z)||Bi(Z)?{type:Z}:wn({},Z),se=Y.type;let ne=!1,de=!0;if(yi(se))for(let me=0;me<se.length;++me){const Te=se[me],ge=Bi(Te)&&Te.name;if(ge==="Boolean"){ne=!0;break}else ge==="String"&&(de=!1)}else ne=Bi(se)&&se.name==="Boolean";Y[0]=ne,Y[1]=de,(ne||Fn(Y,"default"))&&s.push(j)}}const O=[y,s];return $n(t)&&l.set(t,O),O}function _P(t){return t[0]!=="$"&&!wu(t)}const l3=t=>t[0]==="_"||t==="$stable",OS=t=>yi(t)?t.map(mo):[mo(t)],lG=(t,e,r)=>{if(e._n)return e;const l=ES((...h)=>OS(e(...h)),r);return l._c=!1,l},c3=(t,e,r)=>{const l=t._ctx;for(const h in t){if(l3(h))continue;const _=t[h];if(Bi(_))e[h]=lG(h,_,l);else if(_!=null){const y=OS(_);e[h]=()=>y}}},u3=(t,e)=>{const r=OS(e);t.slots.default=()=>r},h3=(t,e,r)=>{for(const l in e)(r||l!=="_")&&(t[l]=e[l])},cG=(t,e,r)=>{const l=t.slots=s3();if(t.vnode.shapeFlag&32){const h=e._;h?(h3(l,e,r),r&&nO(l,"_",h,!0)):c3(e,l)}else e&&u3(t,e)},uG=(t,e,r)=>{const{vnode:l,slots:h}=t;let _=!0,y=xn;if(l.shapeFlag&32){const s=e._;s?r&&s===1?_=!1:h3(h,e,r):(_=!e.$stable,c3(e,h)),y=e}else e&&(u3(t,e),y={default:1});if(_)for(const s in h)!l3(s)&&y[s]==null&&delete h[s]},er=E3;function d3(t){return p3(t)}function f3(t){return p3(t,_H)}function p3(t,e){const r=l1();r.__VUE__=!0;const{insert:l,remove:h,patchProp:_,createElement:y,createText:s,createComment:I,setText:O,setElementText:k,parentNode:j,nextSibling:Z,setScopeId:Y=hr,insertStaticContent:se}=t,ne=(Ze,Ie,wt,Vt=null,Bt=null,yt=null,Xt=void 0,Zt=null,Yt=!!Ie.dynamicChildren)=>{if(Ze===Ie)return;Ze&&!Oa(Ze,Ie)&&(Vt=hs(Ze),Ln(Ze,Bt,yt,!0),Ze=null),Ie.patchFlag===-2&&(Yt=!1,Ie.dynamicChildren=null);const{type:Ut,ref:Ei,shapeFlag:At}=Ie;switch(Ut){case Su:de(Ze,Ie,wt,Vt);break;case Gs:me(Ze,Ie,wt,Vt);break;case nd:Ze==null&&Te(Ie,wt,Vt,Xt);break;case os:lt(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt);break;default:At&1?Ae(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt):At&6?Mt(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt):(At&64||At&128)&&Ut.process(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt,ce)}Ei!=null&&Bt&&T_(Ei,Ze&&Ze.ref,yt,Ie||Ze,!Ie)},de=(Ze,Ie,wt,Vt)=>{if(Ze==null)l(Ie.el=s(Ie.children),wt,Vt);else{const Bt=Ie.el=Ze.el;Ie.children!==Ze.children&&O(Bt,Ie.children)}},me=(Ze,Ie,wt,Vt)=>{Ze==null?l(Ie.el=I(Ie.children||""),wt,Vt):Ie.el=Ze.el},Te=(Ze,Ie,wt,Vt)=>{[Ze.el,Ze.anchor]=se(Ze.children,Ie,wt,Vt,Ze.el,Ze.anchor)},ge=({el:Ze,anchor:Ie},wt,Vt)=>{let Bt;for(;Ze&&Ze!==Ie;)Bt=Z(Ze),l(Ze,wt,Vt),Ze=Bt;l(Ie,wt,Vt)},fe=({el:Ze,anchor:Ie})=>{let wt;for(;Ze&&Ze!==Ie;)wt=Z(Ze),h(Ze),Ze=wt;h(Ie)},Ae=(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt)=>{Ie.type==="svg"?Xt="svg":Ie.type==="math"&&(Xt="mathml"),Ze==null?Ge(Ie,wt,Vt,Bt,yt,Xt,Zt,Yt):Xe(Ze,Ie,Bt,yt,Xt,Zt,Yt)},Ge=(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt)=>{let Yt,Ut;const{props:Ei,shapeFlag:At,transition:ci,dirs:Ai}=Ze;if(Yt=Ze.el=y(Ze.type,yt,Ei&&Ei.is,Ei),At&8?k(Yt,Ze.children):At&16&&Ke(Ze.children,Yt,null,Vt,Bt,dT(Ze,yt),Xt,Zt),Ai&&dl(Ze,null,Vt,"created"),ze(Yt,Ze,Ze.scopeId,Xt,Vt),Ei){for(const ji in Ei)ji!=="value"&&!wu(ji)&&_(Yt,ji,null,Ei[ji],yt,Vt);"value"in Ei&&_(Yt,"value",null,Ei.value,yt),(Ut=Ei.onVnodeBeforeMount)&&po(Ut,Vt,Ze)}Ai&&dl(Ze,null,Vt,"beforeMount");const Xi=m3(Bt,ci);Xi&&ci.beforeEnter(Yt),l(Yt,Ie,wt),((Ut=Ei&&Ei.onVnodeMounted)||Xi||Ai)&&er(()=>{Ut&&po(Ut,Vt,Ze),Xi&&ci.enter(Yt),Ai&&dl(Ze,null,Vt,"mounted")},Bt)},ze=(Ze,Ie,wt,Vt,Bt)=>{if(wt&&Y(Ze,wt),Vt)for(let yt=0;yt<Vt.length;yt++)Y(Ze,Vt[yt]);if(Bt){let yt=Bt.subTree;if(Ie===yt||vx(yt.type)&&(yt.ssContent===Ie||yt.ssFallback===Ie)){const Xt=Bt.vnode;ze(Ze,Xt,Xt.scopeId,Xt.slotScopeIds,Bt.parent)}}},Ke=(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt=0)=>{for(let Ut=Yt;Ut<Ze.length;Ut++){const Ei=Ze[Ut]=Zt?mu(Ze[Ut]):mo(Ze[Ut]);ne(null,Ei,Ie,wt,Vt,Bt,yt,Xt,Zt)}},Xe=(Ze,Ie,wt,Vt,Bt,yt,Xt)=>{const Zt=Ie.el=Ze.el;let{patchFlag:Yt,dynamicChildren:Ut,dirs:Ei}=Ie;Yt|=Ze.patchFlag&16;const At=Ze.props||xn,ci=Ie.props||xn;let Ai;if(wt&&Nh(wt,!1),(Ai=ci.onVnodeBeforeUpdate)&&po(Ai,wt,Ie,Ze),Ei&&dl(Ie,Ze,wt,"beforeUpdate"),wt&&Nh(wt,!0),(At.innerHTML&&ci.innerHTML==null||At.textContent&&ci.textContent==null)&&k(Zt,""),Ut?Ue(Ze.dynamicChildren,Ut,Zt,wt,Vt,dT(Ie,Bt),yt):Xt||ii(Ze,Ie,Zt,null,wt,Vt,dT(Ie,Bt),yt,!1),Yt>0){if(Yt&16)et(Zt,At,ci,wt,Bt);else if(Yt&2&&At.class!==ci.class&&_(Zt,"class",null,ci.class,Bt),Yt&4&&_(Zt,"style",At.style,ci.style,Bt),Yt&8){const Xi=Ie.dynamicProps;for(let ji=0;ji<Xi.length;ji++){const un=Xi[ji],Kn=At[un],ds=ci[un];(ds!==Kn||un==="value")&&_(Zt,un,Kn,ds,Bt,wt)}}Yt&1&&Ze.children!==Ie.children&&k(Zt,Ie.children)}else!Xt&&Ut==null&&et(Zt,At,ci,wt,Bt);((Ai=ci.onVnodeUpdated)||Ei)&&er(()=>{Ai&&po(Ai,wt,Ie,Ze),Ei&&dl(Ie,Ze,wt,"updated")},Vt)},Ue=(Ze,Ie,wt,Vt,Bt,yt,Xt)=>{for(let Zt=0;Zt<Ie.length;Zt++){const Yt=Ze[Zt],Ut=Ie[Zt],Ei=Yt.el&&(Yt.type===os||!Oa(Yt,Ut)||Yt.shapeFlag&70)?j(Yt.el):wt;ne(Yt,Ut,Ei,null,Vt,Bt,yt,Xt,!0)}},et=(Ze,Ie,wt,Vt,Bt)=>{if(Ie!==wt){if(Ie!==xn)for(const yt in Ie)!wu(yt)&&!(yt in wt)&&_(Ze,yt,Ie[yt],null,Bt,Vt);for(const yt in wt){if(wu(yt))continue;const Xt=wt[yt],Zt=Ie[yt];Xt!==Zt&&yt!=="value"&&_(Ze,yt,Zt,Xt,Bt,Vt)}"value"in wt&&_(Ze,"value",Ie.value,wt.value,Bt)}},lt=(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt)=>{const Ut=Ie.el=Ze?Ze.el:s(""),Ei=Ie.anchor=Ze?Ze.anchor:s("");let{patchFlag:At,dynamicChildren:ci,slotScopeIds:Ai}=Ie;Ai&&(Zt=Zt?Zt.concat(Ai):Ai),Ze==null?(l(Ut,wt,Vt),l(Ei,wt,Vt),Ke(Ie.children||[],wt,Ei,Bt,yt,Xt,Zt,Yt)):At>0&&At&64&&ci&&Ze.dynamicChildren?(Ue(Ze.dynamicChildren,ci,wt,Bt,yt,Xt,Zt),(Ie.key!=null||Bt&&Ie===Bt.subTree)&&kS(Ze,Ie,!0)):ii(Ze,Ie,wt,Ei,Bt,yt,Xt,Zt,Yt)},Mt=(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt)=>{Ie.slotScopeIds=Zt,Ze==null?Ie.shapeFlag&512?Bt.ctx.activate(Ie,wt,Vt,Xt,Yt):si(Ie,wt,Vt,Bt,yt,Xt,Yt):bt(Ze,Ie,Yt)},si=(Ze,Ie,wt,Vt,Bt,yt,Xt)=>{const Zt=Ze.component=P3(Ze,Vt,Bt);if(Y_(Ze)&&(Zt.ctx.renderer=ce),R3(Zt,!1,Xt),Zt.asyncDep){if(Bt&&Bt.registerDep(Zt,Rt,Xt),!Ze.el){const Yt=Zt.subTree=Yn(Gs);me(null,Yt,Ie,wt)}}else Rt(Zt,Ze,Ie,wt,Bt,yt,Xt)},bt=(Ze,Ie,wt)=>{const Vt=Ie.component=Ze.component;if(xG(Ze,Ie,wt))if(Vt.asyncDep&&!Vt.asyncResolved){Kt(Vt,Ie,wt);return}else Vt.next=Ie,Vt.update();else Ie.el=Ze.el,Vt.vnode=Ie},Rt=(Ze,Ie,wt,Vt,Bt,yt,Xt)=>{const Zt=()=>{if(Ze.isMounted){let{next:At,bu:ci,u:Ai,parent:Xi,vnode:ji}=Ze;{const vs=g3(Ze);if(vs){At&&(At.el=ji.el,Kt(Ze,At,Xt)),vs.asyncDep.then(()=>{Ze.isUnmounted||Zt()});return}}let un=At,Kn;Nh(Ze,!1),At?(At.el=ji.el,Kt(Ze,At,Xt)):At=ji,ci&&ep(ci),(Kn=At.props&&At.props.onVnodeBeforeUpdate)&&po(Kn,Xi,At,ji),Nh(Ze,!0);const ds=Uv(Ze),Ws=Ze.subTree;Ze.subTree=ds,ne(Ws,ds,j(Ws.el),hs(Ws),Ze,Bt,yt),At.el=ds.el,un===null&&S1(Ze,ds.el),Ai&&er(Ai,Bt),(Kn=At.props&&At.props.onVnodeUpdated)&&er(()=>po(Kn,Xi,At,ji),Bt)}else{let At;const{el:ci,props:Ai}=Ie,{bm:Xi,m:ji,parent:un,root:Kn,type:ds}=Ze,Ws=Eu(Ie);if(Nh(Ze,!1),Xi&&ep(Xi),!Ws&&(At=Ai&&Ai.onVnodeBeforeMount)&&po(At,un,Ie),Nh(Ze,!0),ci&&vr){const vs=()=>{Ze.subTree=Uv(Ze),vr(ci,Ze.subTree,Ze,Bt,null)};Ws&&ds.__asyncHydrate?ds.__asyncHydrate(ci,Ze,vs):vs()}else{Kn.ce&&Kn.ce._injectChildStyle(ds);const vs=Ze.subTree=Uv(Ze);ne(null,vs,wt,Vt,Ze,Bt,yt),Ie.el=vs.el}if(ji&&er(ji,Bt),!Ws&&(At=Ai&&Ai.onVnodeMounted)){const vs=Ie;er(()=>po(At,un,vs),Bt)}(Ie.shapeFlag&256||un&&Eu(un.vnode)&&un.vnode.shapeFlag&256)&&Ze.a&&er(Ze.a,Bt),Ze.isMounted=!0,Ie=wt=Vt=null}};Ze.scope.on();const Yt=Ze.effect=new __(Zt);Ze.scope.off();const Ut=Ze.update=Yt.run.bind(Yt),Ei=Ze.job=Yt.runIfDirty.bind(Yt);Ei.i=Ze,Ei.id=Ze.uid,Yt.scheduler=()=>TS(Ei),Nh(Ze,!0),Ut()},Kt=(Ze,Ie,wt)=>{Ie.component=Ze;const Vt=Ze.vnode.props;Ze.vnode=Ie,Ze.next=null,oG(Ze,Ie.props,Vt,wt),uG(Ze,Ie.children,wt),Nu(),oP(Ze),Vu()},ii=(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt=!1)=>{const Ut=Ze&&Ze.children,Ei=Ze?Ze.shapeFlag:0,At=Ie.children,{patchFlag:ci,shapeFlag:Ai}=Ie;if(ci>0){if(ci&128){gn(Ut,At,wt,Vt,Bt,yt,Xt,Zt,Yt);return}else if(ci&256){qt(Ut,At,wt,Vt,Bt,yt,Xt,Zt,Yt);return}}Ai&8?(Ei&16&&Sn(Ut,Bt,yt),At!==Ut&&k(wt,At)):Ei&16?Ai&16?gn(Ut,At,wt,Vt,Bt,yt,Xt,Zt,Yt):Sn(Ut,Bt,yt,!0):(Ei&8&&k(wt,""),Ai&16&&Ke(At,wt,Vt,Bt,yt,Xt,Zt,Yt))},qt=(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt)=>{Ze=Ze||Kf,Ie=Ie||Kf;const Ut=Ze.length,Ei=Ie.length,At=Math.min(Ut,Ei);let ci;for(ci=0;ci<At;ci++){const Ai=Ie[ci]=Yt?mu(Ie[ci]):mo(Ie[ci]);ne(Ze[ci],Ai,wt,null,Bt,yt,Xt,Zt,Yt)}Ut>Ei?Sn(Ze,Bt,yt,!0,!1,At):Ke(Ie,wt,Vt,Bt,yt,Xt,Zt,Yt,At)},gn=(Ze,Ie,wt,Vt,Bt,yt,Xt,Zt,Yt)=>{let Ut=0;const Ei=Ie.length;let At=Ze.length-1,ci=Ei-1;for(;Ut<=At&&Ut<=ci;){const Ai=Ze[Ut],Xi=Ie[Ut]=Yt?mu(Ie[Ut]):mo(Ie[Ut]);if(Oa(Ai,Xi))ne(Ai,Xi,wt,null,Bt,yt,Xt,Zt,Yt);else break;Ut++}for(;Ut<=At&&Ut<=ci;){const Ai=Ze[At],Xi=Ie[ci]=Yt?mu(Ie[ci]):mo(Ie[ci]);if(Oa(Ai,Xi))ne(Ai,Xi,wt,null,Bt,yt,Xt,Zt,Yt);else break;At--,ci--}if(Ut>At){if(Ut<=ci){const Ai=ci+1,Xi=Ai<Ei?Ie[Ai].el:Vt;for(;Ut<=ci;)ne(null,Ie[Ut]=Yt?mu(Ie[Ut]):mo(Ie[Ut]),wt,Xi,Bt,yt,Xt,Zt,Yt),Ut++}}else if(Ut>ci)for(;Ut<=At;)Ln(Ze[Ut],Bt,yt,!0),Ut++;else{const Ai=Ut,Xi=Ut,ji=new Map;for(Ut=Xi;Ut<=ci;Ut++){const Ts=Ie[Ut]=Yt?mu(Ie[Ut]):mo(Ie[Ut]);Ts.key!=null&&ji.set(Ts.key,Ut)}let un,Kn=0;const ds=ci-Xi+1;let Ws=!1,vs=0;const Br=new Array(ds);for(Ut=0;Ut<ds;Ut++)Br[Ut]=0;for(Ut=Ai;Ut<=At;Ut++){const Ts=Ze[Ut];if(Kn>=ds){Ln(Ts,Bt,yt,!0);continue}let on;if(Ts.key!=null)on=ji.get(Ts.key);else for(un=Xi;un<=ci;un++)if(Br[un-Xi]===0&&Oa(Ts,Ie[un])){on=un;break}on===void 0?Ln(Ts,Bt,yt,!0):(Br[on-Xi]=Ut+1,on>=vs?vs=on:Ws=!0,ne(Ts,Ie[on],wt,null,Bt,yt,Xt,Zt,Yt),Kn++)}const or=Ws?hG(Br):Kf;for(un=or.length-1,Ut=ds-1;Ut>=0;Ut--){const Ts=Xi+Ut,on=Ie[Ts],rn=Ts+1<Ei?Ie[Ts+1].el:Vt;Br[Ut]===0?ne(null,on,wt,rn,Bt,yt,Xt,Zt,Yt):Ws&&(un<0||Ut!==or[un]?Hn(on,wt,rn,2):un--)}}},Hn=(Ze,Ie,wt,Vt,Bt=null)=>{const{el:yt,type:Xt,transition:Zt,children:Yt,shapeFlag:Ut}=Ze;if(Ut&6){Hn(Ze.component.subTree,Ie,wt,Vt);return}if(Ut&128){Ze.suspense.move(Ie,wt,Vt);return}if(Ut&64){Xt.move(Ze,Ie,wt,ce);return}if(Xt===os){l(yt,Ie,wt);for(let At=0;At<Yt.length;At++)Hn(Yt[At],Ie,wt,Vt);l(Ze.anchor,Ie,wt);return}if(Xt===nd){ge(Ze,Ie,wt);return}if(Vt!==2&&Ut&1&&Zt)if(Vt===0)Zt.beforeEnter(yt),l(yt,Ie,wt),er(()=>Zt.enter(yt),Bt);else{const{leave:At,delayLeave:ci,afterLeave:Ai}=Zt,Xi=()=>l(yt,Ie,wt),ji=()=>{At(yt,()=>{Xi(),Ai&&Ai()})};ci?ci(yt,Xi,ji):ji()}else l(yt,Ie,wt)},Ln=(Ze,Ie,wt,Vt=!1,Bt=!1)=>{const{type:yt,props:Xt,ref:Zt,children:Yt,dynamicChildren:Ut,shapeFlag:Ei,patchFlag:At,dirs:ci,cacheIndex:Ai}=Ze;if(At===-2&&(Bt=!1),Zt!=null&&T_(Zt,null,wt,Ze,!0),Ai!=null&&(Ie.renderCache[Ai]=void 0),Ei&256){Ie.ctx.deactivate(Ze);return}const Xi=Ei&1&&ci,ji=!Eu(Ze);let un;if(ji&&(un=Xt&&Xt.onVnodeBeforeUnmount)&&po(un,Ie,Ze),Ei&6)is(Ze.component,wt,Vt);else{if(Ei&128){Ze.suspense.unmount(wt,Vt);return}Xi&&dl(Ze,null,Ie,"beforeUnmount"),Ei&64?Ze.type.remove(Ze,Ie,wt,ce,Vt):Ut&&!Ut.hasOnce&&(yt!==os||At>0&&At&64)?Sn(Ut,Ie,wt,!1,!0):(yt===os&&At&384||!Bt&&Ei&16)&&Sn(Yt,Ie,wt),Vt&&li(Ze)}(ji&&(un=Xt&&Xt.onVnodeUnmounted)||Xi)&&er(()=>{un&&po(un,Ie,Ze),Xi&&dl(Ze,null,Ie,"unmounted")},wt)},li=Ze=>{const{type:Ie,el:wt,anchor:Vt,transition:Bt}=Ze;if(Ie===os){ys(wt,Vt);return}if(Ie===nd){fe(Ze);return}const yt=()=>{h(wt),Bt&&!Bt.persisted&&Bt.afterLeave&&Bt.afterLeave()};if(Ze.shapeFlag&1&&Bt&&!Bt.persisted){const{leave:Xt,delayLeave:Zt}=Bt,Yt=()=>Xt(wt,yt);Zt?Zt(Ze.el,yt,Yt):Yt()}else yt()},ys=(Ze,Ie)=>{let wt;for(;Ze!==Ie;)wt=Z(Ze),h(Ze),Ze=wt;h(Ie)},is=(Ze,Ie,wt)=>{const{bum:Vt,scope:Bt,job:yt,subTree:Xt,um:Zt,m:Yt,a:Ut}=Ze;yx(Yt),yx(Ut),Vt&&ep(Vt),Bt.stop(),yt&&(yt.flags|=8,Ln(Xt,Ze,Ie,wt)),Zt&&er(Zt,Ie),er(()=>{Ze.isUnmounted=!0},Ie),Ie&&Ie.pendingBranch&&!Ie.isUnmounted&&Ze.asyncDep&&!Ze.asyncResolved&&Ze.suspenseId===Ie.pendingId&&(Ie.deps--,Ie.deps===0&&Ie.resolve())},Sn=(Ze,Ie,wt,Vt=!1,Bt=!1,yt=0)=>{for(let Xt=yt;Xt<Ze.length;Xt++)Ln(Ze[Xt],Ie,wt,Vt,Bt)},hs=Ze=>{if(Ze.shapeFlag&6)return hs(Ze.component.subTree);if(Ze.shapeFlag&128)return Ze.suspense.next();const Ie=Z(Ze.anchor||Ze.el),wt=Ie&&Ie[zO];return wt?Z(wt):Ie};let Ns=!1;const Fr=(Ze,Ie,wt)=>{Ze==null?Ie._vnode&&Ln(Ie._vnode,null,null,!0):ne(Ie._vnode||null,Ze,Ie,null,null,null,wt),Ie._vnode=Ze,Ns||(Ns=!0,oP(),mx(),Ns=!1)},ce={p:ne,um:Ln,m:Hn,r:li,mt:si,mc:Ke,pc:ii,pbc:Ue,n:hs,o:t};let dr,vr;return e&&([dr,vr]=e(ce)),{render:Fr,hydrate:dr,createApp:nG(Fr,dr)}}function dT({type:t,props:e},r){return r==="svg"&&t==="foreignObject"||r==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:r}function Nh({effect:t,job:e},r){r?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function m3(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function kS(t,e,r=!1){const l=t.children,h=e.children;if(yi(l)&&yi(h))for(let _=0;_<l.length;_++){const y=l[_];let s=h[_];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=h[_]=mu(h[_]),s.el=y.el),!r&&s.patchFlag!==-2&&kS(y,s)),s.type===Su&&(s.el=y.el)}}function hG(t){const e=t.slice(),r=[0];let l,h,_,y,s;const I=t.length;for(l=0;l<I;l++){const O=t[l];if(O!==0){if(h=r[r.length-1],t[h]<O){e[l]=h,r.push(l);continue}for(_=0,y=r.length-1;_<y;)s=_+y>>1,t[r[s]]<O?_=s+1:y=s;O<t[r[_]]&&(_>0&&(e[l]=r[_-1]),r[_]=l)}}for(_=r.length,y=r[_-1];_-- >0;)r[_]=y,y=e[y];return r}function g3(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:g3(e)}function yx(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const _3=Symbol.for("v-scx"),y3=()=>s_(_3);function dG(t,e){return J_(t,null,e)}function fG(t,e){return J_(t,null,{flush:"post"})}function v3(t,e){return J_(t,null,{flush:"sync"})}function ip(t,e,r){return J_(t,e,r)}function J_(t,e,r=xn){const{immediate:l,deep:h,flush:_,once:y}=r,s=wn({},r),I=e&&l||!e&&_!=="post";let O;if(fp){if(_==="sync"){const Y=y3();O=Y.__watcherHandles||(Y.__watcherHandles=[])}else if(!I){const Y=()=>{};return Y.stop=hr,Y.resume=hr,Y.pause=hr,Y}}const k=ir;s.call=(Y,se,ne)=>aa(Y,k,se,ne);let j=!1;_==="post"?s.scheduler=Y=>{er(Y,k&&k.suspense)}:_!=="sync"&&(j=!0,s.scheduler=(Y,se)=>{se?Y():TS(Y)}),s.augmentJob=Y=>{e&&(Y.flags|=4),j&&(Y.flags|=2,k&&(Y.id=k.uid,Y.i=k))};const Z=Q$(t,e,s);return fp&&(O?O.push(Z):I&&Z()),Z}function pG(t,e,r){const l=this.proxy,h=sn(t)?t.includes(".")?x3(l,t):()=>l[t]:t.bind(l,l);let _;Bi(e)?_=e:(_=e.handler,r=e);const y=dd(this),s=J_(h,_.bind(l),r);return y(),s}function x3(t,e){const r=e.split(".");return()=>{let l=t;for(let h=0;h<r.length&&l;h++)l=l[r[h]];return l}}function mG(t,e,r=xn){const l=ca(),h=cs(e),_=_o(e),y=b3(t,h),s=IO((I,O)=>{let k,j=xn,Z;return v3(()=>{const Y=t[h];Kr(k,Y)&&(k=Y,O())}),{get(){return I(),r.get?r.get(k):k},set(Y){const se=r.set?r.set(Y):Y;if(!Kr(se,k)&&!(j!==xn&&Kr(Y,j)))return;const ne=l.vnode.props;ne&&(e in ne||h in ne||_ in ne)&&(`onUpdate:${e}`in ne||`onUpdate:${h}`in ne||`onUpdate:${_}`in ne)||(k=Y,O()),l.emit(`update:${e}`,se),Kr(Y,se)&&Kr(Y,j)&&!Kr(se,Z)&&O(),j=Y,Z=se}}});return s[Symbol.iterator]=()=>{let I=0;return{next(){return I<2?{value:I++?y||xn:s,done:!1}:{done:!0}}}},s}const b3=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${cs(e)}Modifiers`]||t[`${_o(e)}Modifiers`];function gG(t,e,...r){if(t.isUnmounted)return;const l=t.vnode.props||xn;let h=r;const _=e.startsWith("update:"),y=_&&b3(l,e.slice(7));y&&(y.trim&&(h=r.map(k=>sn(k)?k.trim():k)),y.number&&(h=r.map(ux)));let s,I=l[s=Qf(e)]||l[s=Qf(cs(e))];!I&&_&&(I=l[s=Qf(_o(e))]),I&&aa(I,t,6,h);const O=l[s+"Once"];if(O){if(!t.emitted)t.emitted={};else if(t.emitted[s])return;t.emitted[s]=!0,aa(O,t,6,h)}}function w3(t,e,r=!1){const l=e.emitsCache,h=l.get(t);if(h!==void 0)return h;const _=t.emits;let y={},s=!1;if(!Bi(t)){const I=O=>{const k=w3(O,e,!0);k&&(s=!0,wn(y,k))};!r&&e.mixins.length&&e.mixins.forEach(I),t.extends&&I(t.extends),t.mixins&&t.mixins.forEach(I)}return!_&&!s?($n(t)&&l.set(t,null),null):(yi(_)?_.forEach(I=>y[I]=null):wn(y,_),$n(t)&&l.set(t,y),y)}function E1(t,e){return!t||!yd(e)?!1:(e=e.slice(2).replace(/Once$/,""),Fn(t,e[0].toLowerCase()+e.slice(1))||Fn(t,_o(e))||Fn(t,e))}function Uv(t){const{type:e,vnode:r,proxy:l,withProxy:h,propsOptions:[_],slots:y,attrs:s,emit:I,render:O,renderCache:k,props:j,data:Z,setupState:Y,ctx:se,inheritAttrs:ne}=t,de=w_(t);let me,Te;try{if(r.shapeFlag&4){const fe=h||l,Ae=fe;me=mo(O.call(Ae,fe,k,j,Y,Z,se)),Te=s}else{const fe=e;me=mo(fe.length>1?fe(j,{attrs:s,slots:y,emit:I}):fe(j,null)),Te=e.props?s:yG(s)}}catch(fe){r_.length=0,bd(fe,t,1),me=Yn(Gs)}let ge=me;if(Te&&ne!==!1){const fe=Object.keys(Te),{shapeFlag:Ae}=ge;fe.length&&Ae&7&&(_&&fe.some(fS)&&(Te=vG(Te,_)),ge=_l(ge,Te,!1,!0))}return r.dirs&&(ge=_l(ge,null,!1,!0),ge.dirs=ge.dirs?ge.dirs.concat(r.dirs):r.dirs),r.transition&&sc(ge,r.transition),me=ge,w_(de),me}function _G(t,e=!0){let r;for(let l=0;l<t.length;l++){const h=t[l];if(rc(h)){if(h.type!==Gs||h.children==="v-if"){if(r)return;r=h}}else return}return r}const yG=t=>{let e;for(const r in t)(r==="class"||r==="style"||yd(r))&&((e||(e={}))[r]=t[r]);return e},vG=(t,e)=>{const r={};for(const l in t)(!fS(l)||!(l.slice(9)in e))&&(r[l]=t[l]);return r};function xG(t,e,r){const{props:l,children:h,component:_}=t,{props:y,children:s,patchFlag:I}=e,O=_.emitsOptions;if(e.dirs||e.transition)return!0;if(r&&I>=0){if(I&1024)return!0;if(I&16)return l?yP(l,y,O):!!y;if(I&8){const k=e.dynamicProps;for(let j=0;j<k.length;j++){const Z=k[j];if(y[Z]!==l[Z]&&!E1(O,Z))return!0}}}else return(h||s)&&(!s||!s.$stable)?!0:l===y?!1:l?y?yP(l,y,O):!0:!!y;return!1}function yP(t,e,r){const l=Object.keys(e);if(l.length!==Object.keys(t).length)return!0;for(let h=0;h<l.length;h++){const _=l[h];if(e[_]!==t[_]&&!E1(r,_))return!0}return!1}function S1({vnode:t,parent:e},r){for(;e;){const l=e.subTree;if(l.suspense&&l.suspense.activeBranch===t&&(l.el=t.el),l===t)(t=e.vnode).el=r,e=e.parent;else break}}const vx=t=>t.__isSuspense;let rE=0;const bG={name:"Suspense",__isSuspense:!0,process(t,e,r,l,h,_,y,s,I,O){if(t==null)TG(e,r,l,h,_,y,s,I,O);else{if(_&&_.deps>0&&!t.suspense.isInFallback){e.suspense=t.suspense,e.suspense.vnode=e,e.el=t.el;return}EG(t,e,r,l,h,y,s,I,O)}},hydrate:SG,normalize:AG},wG=bG;function S_(t,e){const r=t.props&&t.props[e];Bi(r)&&r()}function TG(t,e,r,l,h,_,y,s,I){const{p:O,o:{createElement:k}}=I,j=k("div"),Z=t.suspense=T3(t,h,l,e,j,r,_,y,s,I);O(null,Z.pendingBranch=t.ssContent,j,null,l,Z,_,y),Z.deps>0?(S_(t,"onPending"),S_(t,"onFallback"),O(null,t.ssFallback,e,r,l,null,_,y),np(Z,t.ssFallback)):Z.resolve(!1,!0)}function EG(t,e,r,l,h,_,y,s,{p:I,um:O,o:{createElement:k}}){const j=e.suspense=t.suspense;j.vnode=e,e.el=t.el;const Z=e.ssContent,Y=e.ssFallback,{activeBranch:se,pendingBranch:ne,isInFallback:de,isHydrating:me}=j;if(ne)j.pendingBranch=Z,Oa(Z,ne)?(I(ne,Z,j.hiddenContainer,null,h,j,_,y,s),j.deps<=0?j.resolve():de&&(me||(I(se,Y,r,l,h,null,_,y,s),np(j,Y)))):(j.pendingId=rE++,me?(j.isHydrating=!1,j.activeBranch=ne):O(ne,h,j),j.deps=0,j.effects.length=0,j.hiddenContainer=k("div"),de?(I(null,Z,j.hiddenContainer,null,h,j,_,y,s),j.deps<=0?j.resolve():(I(se,Y,r,l,h,null,_,y,s),np(j,Y))):se&&Oa(Z,se)?(I(se,Z,r,l,h,j,_,y,s),j.resolve(!0)):(I(null,Z,j.hiddenContainer,null,h,j,_,y,s),j.deps<=0&&j.resolve()));else if(se&&Oa(Z,se))I(se,Z,r,l,h,j,_,y,s),np(j,Z);else if(S_(e,"onPending"),j.pendingBranch=Z,Z.shapeFlag&512?j.pendingId=Z.component.suspenseId:j.pendingId=rE++,I(null,Z,j.hiddenContainer,null,h,j,_,y,s),j.deps<=0)j.resolve();else{const{timeout:Te,pendingId:ge}=j;Te>0?setTimeout(()=>{j.pendingId===ge&&j.fallback(Y)},Te):Te===0&&j.fallback(Y)}}function T3(t,e,r,l,h,_,y,s,I,O,k=!1){const{p:j,m:Z,um:Y,n:se,o:{parentNode:ne,remove:de}}=O;let me;const Te=MG(t);Te&&e&&e.pendingBranch&&(me=e.pendingId,e.deps++);const ge=t.props?hx(t.props.timeout):void 0,fe=_,Ae={vnode:t,parent:e,parentComponent:r,namespace:y,container:l,hiddenContainer:h,deps:0,pendingId:rE++,timeout:typeof ge=="number"?ge:-1,activeBranch:null,pendingBranch:null,isInFallback:!k,isHydrating:k,isUnmounted:!1,effects:[],resolve(Ge=!1,ze=!1){const{vnode:Ke,activeBranch:Xe,pendingBranch:Ue,pendingId:et,effects:lt,parentComponent:Mt,container:si}=Ae;let bt=!1;Ae.isHydrating?Ae.isHydrating=!1:Ge||(bt=Xe&&Ue.transition&&Ue.transition.mode==="out-in",bt&&(Xe.transition.afterLeave=()=>{et===Ae.pendingId&&(Z(Ue,si,_===fe?se(Xe):_,0),x_(lt))}),Xe&&(ne(Xe.el)===si&&(_=se(Xe)),Y(Xe,Mt,Ae,!0)),bt||Z(Ue,si,_,0)),np(Ae,Ue),Ae.pendingBranch=null,Ae.isInFallback=!1;let Rt=Ae.parent,Kt=!1;for(;Rt;){if(Rt.pendingBranch){Rt.effects.push(...lt),Kt=!0;break}Rt=Rt.parent}!Kt&&!bt&&x_(lt),Ae.effects=[],Te&&e&&e.pendingBranch&&me===e.pendingId&&(e.deps--,e.deps===0&&!ze&&e.resolve()),S_(Ke,"onResolve")},fallback(Ge){if(!Ae.pendingBranch)return;const{vnode:ze,activeBranch:Ke,parentComponent:Xe,container:Ue,namespace:et}=Ae;S_(ze,"onFallback");const lt=se(Ke),Mt=()=>{Ae.isInFallback&&(j(null,Ge,Ue,lt,Xe,null,et,s,I),np(Ae,Ge))},si=Ge.transition&&Ge.transition.mode==="out-in";si&&(Ke.transition.afterLeave=Mt),Ae.isInFallback=!0,Y(Ke,Xe,null,!0),si||Mt()},move(Ge,ze,Ke){Ae.activeBranch&&Z(Ae.activeBranch,Ge,ze,Ke),Ae.container=Ge},next(){return Ae.activeBranch&&se(Ae.activeBranch)},registerDep(Ge,ze,Ke){const Xe=!!Ae.pendingBranch;Xe&&Ae.deps++;const Ue=Ge.vnode.el;Ge.asyncDep.catch(et=>{bd(et,Ge,0)}).then(et=>{if(Ge.isUnmounted||Ae.isUnmounted||Ae.pendingId!==Ge.suspenseId)return;Ge.asyncResolved=!0;const{vnode:lt}=Ge;cE(Ge,et,!1),Ue&&(lt.el=Ue);const Mt=!Ue&&Ge.subTree.el;ze(Ge,lt,ne(Ue||Ge.subTree.el),Ue?null:se(Ge.subTree),Ae,y,Ke),Mt&&de(Mt),S1(Ge,lt.el),Xe&&--Ae.deps===0&&Ae.resolve()})},unmount(Ge,ze){Ae.isUnmounted=!0,Ae.activeBranch&&Y(Ae.activeBranch,r,Ge,ze),Ae.pendingBranch&&Y(Ae.pendingBranch,r,Ge,ze)}};return Ae}function SG(t,e,r,l,h,_,y,s,I){const O=e.suspense=T3(e,l,r,t.parentNode,document.createElement("div"),null,h,_,y,s,!0),k=I(t,O.pendingBranch=e.ssContent,r,O,_,y);return O.deps===0&&O.resolve(!1,!0),k}function AG(t){const{shapeFlag:e,children:r}=t,l=e&32;t.ssContent=vP(l?r.default:r),t.ssFallback=l?vP(r.fallback):Yn(Gs)}function vP(t){let e;if(Bi(t)){const r=hd&&t._c;r&&(t._d=!1,Fi()),t=t(),r&&(t._d=!0,e=Lr,S3())}return yi(t)&&(t=_G(t)),t=mo(t),e&&!t.dynamicChildren&&(t.dynamicChildren=e.filter(r=>r!==t)),t}function E3(t,e){e&&e.pendingBranch?yi(t)?e.effects.push(...t):e.effects.push(t):x_(t)}function np(t,e){t.activeBranch=e;const{vnode:r,parentComponent:l}=t;let h=e.el;for(;!h&&e.component;)e=e.component.subTree,h=e.el;r.el=h,l&&l.subTree===r&&(l.vnode.el=h,S1(l,h))}function MG(t){const e=t.props&&t.props.suspensible;return e!=null&&e!==!1}const os=Symbol.for("v-fgt"),Su=Symbol.for("v-txt"),Gs=Symbol.for("v-cmt"),nd=Symbol.for("v-stc"),r_=[];let Lr=null;function Fi(t=!1){r_.push(Lr=t?null:[])}function S3(){r_.pop(),Lr=r_[r_.length-1]||null}let hd=1;function oE(t,e=!1){hd+=t,t<0&&Lr&&e&&(Lr.hasOnce=!0)}function A3(t){return t.dynamicChildren=hd>0?Lr||Kf:null,S3(),hd>0&&Lr&&Lr.push(t),t}function tn(t,e,r,l,h,_){return A3(gt(t,e,r,l,h,_,!0))}function A_(t,e,r,l,h){return A3(Yn(t,e,r,l,h,!0))}function rc(t){return t?t.__v_isVNode===!0:!1}function Oa(t,e){return t.type===e.type&&t.key===e.key}function IG(t){}const M3=({key:t})=>t??null,jv=({ref:t,ref_key:e,ref_for:r})=>(typeof t=="number"&&(t=""+t),t!=null?sn(t)||rr(t)||Bi(t)?{i:nr,r:t,k:e,f:!!r}:t:null);function gt(t,e=null,r=null,l=0,h=null,_=t===os?0:1,y=!1,s=!1){const I={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&M3(e),ref:e&&jv(e),scopeId:y1,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:_,patchFlag:l,dynamicProps:h,dynamicChildren:null,appContext:null,ctx:nr};return s?(zS(I,r),_&128&&t.normalize(I)):r&&(I.shapeFlag|=sn(r)?8:16),hd>0&&!y&&Lr&&(I.patchFlag>0||_&6)&&I.patchFlag!==32&&Lr.push(I),I}const Yn=CG;function CG(t,e=null,r=null,l=0,h=null,_=!1){if((!t||t===JO)&&(t=Gs),rc(t)){const s=_l(t,e,!0);return r&&zS(s,r),hd>0&&!_&&Lr&&(s.shapeFlag&6?Lr[Lr.indexOf(t)]=s:Lr.push(s)),s.patchFlag=-2,s}if(kG(t)&&(t=t.__vccOpts),e){e=I3(e);let{class:s,style:I}=e;s&&!sn(s)&&(e.class=X_(s)),$n(I)&&(m1(I)&&!yi(I)&&(I=wn({},I)),e.style=Z_(I))}const y=sn(t)?1:vx(t)?128:FO(t)?64:$n(t)?4:Bi(t)?2:0;return gt(t,e,r,l,h,y,_,!0)}function I3(t){return t?m1(t)||r3(t)?wn({},t):t:null}function _l(t,e,r=!1,l=!1){const{props:h,ref:_,patchFlag:y,children:s,transition:I}=t,O=e?C3(h||{},e):h,k={__v_isVNode:!0,__v_skip:!0,type:t.type,props:O,key:O&&M3(O),ref:e&&e.ref?r&&_?yi(_)?_.concat(jv(e)):[_,jv(e)]:jv(e):_,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:s,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==os?y===-1?16:y|16:y,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:I,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&_l(t.ssContent),ssFallback:t.ssFallback&&_l(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return I&&l&&sc(k,I.clone(k)),k}function Ro(t=" ",e=0){return Yn(Su,null,t,e)}function A1(t,e){const r=Yn(nd,null,t);return r.staticCount=e,r}function Zl(t="",e=!1){return e?(Fi(),A_(Gs,null,t)):Yn(Gs,null,t)}function mo(t){return t==null||typeof t=="boolean"?Yn(Gs):yi(t)?Yn(os,null,t.slice()):rc(t)?mu(t):Yn(Su,null,String(t))}function mu(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:_l(t)}function zS(t,e){let r=0;const{shapeFlag:l}=t;if(e==null)e=null;else if(yi(e))r=16;else if(typeof e=="object")if(l&65){const h=e.default;h&&(h._c&&(h._d=!1),zS(t,h()),h._c&&(h._d=!0));return}else{r=32;const h=e._;!h&&!r3(e)?e._ctx=nr:h===3&&nr&&(nr.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Bi(e)?(e={default:e,_ctx:nr},r=32):(e=String(e),l&64?(r=16,e=[Ro(e)]):r=8);t.children=e,t.shapeFlag|=r}function C3(...t){const e={};for(let r=0;r<t.length;r++){const l=t[r];for(const h in l)if(h==="class")e.class!==l.class&&(e.class=X_([e.class,l.class]));else if(h==="style")e.style=Z_([e.style,l.style]);else if(yd(h)){const _=e[h],y=l[h];y&&_!==y&&!(yi(_)&&_.includes(y))&&(e[h]=_?[].concat(_,y):y)}else h!==""&&(e[h]=l[h])}return e}function po(t,e,r,l=null){aa(t,e,7,[r,l])}const PG=t3();let DG=0;function P3(t,e,r){const l=t.type,h=(e?e.appContext:t.appContext)||PG,_={uid:DG++,vnode:t,type:l,parent:e,appContext:h,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new _S(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(h.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:a3(l,h),emitsOptions:w3(l,h),emit:null,emitted:null,propsDefaults:xn,inheritAttrs:l.inheritAttrs,ctx:xn,data:xn,props:xn,attrs:xn,slots:xn,refs:xn,setupState:xn,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return _.ctx={_},_.root=e?e.root:_,_.emit=gG.bind(null,_),t.ce&&t.ce(_),_}let ir=null;const ca=()=>ir||nr;let xx,aE;{const t=l1(),e=(r,l)=>{let h;return(h=t[r])||(h=t[r]=[]),h.push(l),_=>{h.length>1?h.forEach(y=>y(_)):h[0](_)}};xx=e("__VUE_INSTANCE_SETTERS__",r=>ir=r),aE=e("__VUE_SSR_SETTERS__",r=>fp=r)}const dd=t=>{const e=ir;return xx(t),t.scope.on(),()=>{t.scope.off(),xx(e)}},lE=()=>{ir&&ir.scope.off(),xx(null)};function D3(t){return t.vnode.shapeFlag&4}let fp=!1;function R3(t,e=!1,r=!1){e&&aE(e);const{props:l,children:h}=t.vnode,_=D3(t);rG(t,l,_,e),cG(t,h,r);const y=_?RG(t,e):void 0;return e&&aE(!1),y}function RG(t,e){const r=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,tE);const{setup:l}=r;if(l){Nu();const h=t.setupContext=l.length>1?k3(t):null,_=dd(t),y=Lp(l,t,0,[t.props,h]),s=mS(y);if(Vu(),_(),(s||t.sp)&&!Eu(t)&&IS(t),s){if(y.then(lE,lE),e)return y.then(I=>{cE(t,I,e)}).catch(I=>{bd(I,t,0)});t.asyncDep=y}else cE(t,y,e)}else O3(t,e)}function cE(t,e,r){Bi(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:$n(e)&&(t.setupState=wS(e)),O3(t,r)}let bx,uE;function L3(t){bx=t,uE=e=>{e.render._rc&&(e.withProxy=new Proxy(e.ctx,FH))}}const LG=()=>!bx;function O3(t,e,r){const l=t.type;if(!t.render){if(!e&&bx&&!l.render){const h=l.template||LS(t).template;if(h){const{isCustomElement:_,compilerOptions:y}=t.appContext.config,{delimiters:s,compilerOptions:I}=l,O=wn(wn({isCustomElement:_,delimiters:s},y),I);l.render=bx(h,O)}}t.render=l.render||hr,uE&&uE(t)}{const h=dd(t);Nu();try{KH(t)}finally{Vu(),h()}}}const OG={get(t,e){return Pr(t,"get",""),t[e]}};function k3(t){const e=r=>{t.exposed=r||{}};return{attrs:new Proxy(t.attrs,OG),slots:t.slots,emit:t.emit,expose:e}}function Q_(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(wS(SO(t.exposed)),{get(e,r){if(r in e)return e[r];if(r in n_)return n_[r](t)},has(e,r){return r in e||r in n_}})):t.proxy}function hE(t,e=!0){return Bi(t)?t.displayName||t.name:t.name||e&&t.__name}function kG(t){return Bi(t)&&"__vccOpts"in t}const z3=(t,e)=>X$(t,e,fp);function F3(t,e,r){const l=arguments.length;return l===2?$n(e)&&!yi(e)?rc(e)?Yn(t,null,[e]):Yn(t,e):Yn(t,null,e):(l>3?r=Array.prototype.slice.call(arguments,2):l===3&&rc(r)&&(r=[r]),Yn(t,e,r))}function zG(){}function FG(t,e,r,l){const h=r[l];if(h&&B3(h,t))return h;const _=e();return _.memo=t.slice(),_.cacheIndex=l,r[l]=_}function B3(t,e){const r=t.memo;if(r.length!=e.length)return!1;for(let l=0;l<r.length;l++)if(Kr(r[l],e[l]))return!1;return hd>0&&Lr&&Lr.push(t),!0}const N3="3.5.13",BG=hr,NG=sH,VG=Zf,UG=kO,jG={createComponentInstance:P3,setupComponent:R3,renderComponentRoot:Uv,setCurrentRenderingInstance:w_,isVNode:rc,normalizeVNode:mo,getComponentPublicInstance:Q_,ensureValidVNode:RS,pushWarningContext:eH,popWarningContext:tH},$G=jG,HG=null,GG=null,qG=null;/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let dE;const xP=typeof window<"u"&&window.trustedTypes;if(xP)try{dE=xP.createPolicy("vue",{createHTML:t=>t})}catch{}const V3=dE?t=>dE.createHTML(t):t=>t,WG="http://www.w3.org/2000/svg",ZG="http://www.w3.org/1998/Math/MathML",$l=typeof document<"u"?document:null,bP=$l&&$l.createElement("template"),XG={insert:(t,e,r)=>{e.insertBefore(t,r||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,r,l)=>{const h=e==="svg"?$l.createElementNS(WG,t):e==="mathml"?$l.createElementNS(ZG,t):r?$l.createElement(t,{is:r}):$l.createElement(t);return t==="select"&&l&&l.multiple!=null&&h.setAttribute("multiple",l.multiple),h},createText:t=>$l.createTextNode(t),createComment:t=>$l.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>$l.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,r,l,h,_){const y=r?r.previousSibling:e.lastChild;if(h&&(h===_||h.nextSibling))for(;e.insertBefore(h.cloneNode(!0),r),!(h===_||!(h=h.nextSibling)););else{bP.innerHTML=V3(l==="svg"?`<svg>${t}</svg>`:l==="mathml"?`<math>${t}</math>`:t);const s=bP.content;if(l==="svg"||l==="mathml"){const I=s.firstChild;for(;I.firstChild;)s.appendChild(I.firstChild);s.removeChild(I)}e.insertBefore(s,r)}return[y?y.nextSibling:e.firstChild,r?r.previousSibling:e.lastChild]}},cu="transition",Og="animation",pp=Symbol("_vtc"),U3={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},j3=wn({},AS,U3),YG=t=>(t.displayName="Transition",t.props=j3,t),KG=YG((t,{slots:e})=>F3(jO,$3(t),e)),Vh=(t,e=[])=>{yi(t)?t.forEach(r=>r(...e)):t&&t(...e)},wP=t=>t?yi(t)?t.some(e=>e.length>1):t.length>1:!1;function $3(t){const e={};for(const lt in t)lt in U3||(e[lt]=t[lt]);if(t.css===!1)return e;const{name:r="v",type:l,duration:h,enterFromClass:_=`${r}-enter-from`,enterActiveClass:y=`${r}-enter-active`,enterToClass:s=`${r}-enter-to`,appearFromClass:I=_,appearActiveClass:O=y,appearToClass:k=s,leaveFromClass:j=`${r}-leave-from`,leaveActiveClass:Z=`${r}-leave-active`,leaveToClass:Y=`${r}-leave-to`}=t,se=JG(h),ne=se&&se[0],de=se&&se[1],{onBeforeEnter:me,onEnter:Te,onEnterCancelled:ge,onLeave:fe,onLeaveCancelled:Ae,onBeforeAppear:Ge=me,onAppear:ze=Te,onAppearCancelled:Ke=ge}=e,Xe=(lt,Mt,si,bt)=>{lt._enterCancelled=bt,hu(lt,Mt?k:s),hu(lt,Mt?O:y),si&&si()},Ue=(lt,Mt)=>{lt._isLeaving=!1,hu(lt,j),hu(lt,Y),hu(lt,Z),Mt&&Mt()},et=lt=>(Mt,si)=>{const bt=lt?ze:Te,Rt=()=>Xe(Mt,lt,si);Vh(bt,[Mt,Rt]),TP(()=>{hu(Mt,lt?I:_),ll(Mt,lt?k:s),wP(bt)||EP(Mt,l,ne,Rt)})};return wn(e,{onBeforeEnter(lt){Vh(me,[lt]),ll(lt,_),ll(lt,y)},onBeforeAppear(lt){Vh(Ge,[lt]),ll(lt,I),ll(lt,O)},onEnter:et(!1),onAppear:et(!0),onLeave(lt,Mt){lt._isLeaving=!0;const si=()=>Ue(lt,Mt);ll(lt,j),lt._enterCancelled?(ll(lt,Z),fE()):(fE(),ll(lt,Z)),TP(()=>{lt._isLeaving&&(hu(lt,j),ll(lt,Y),wP(fe)||EP(lt,l,de,si))}),Vh(fe,[lt,si])},onEnterCancelled(lt){Xe(lt,!1,void 0,!0),Vh(ge,[lt])},onAppearCancelled(lt){Xe(lt,!0,void 0,!0),Vh(Ke,[lt])},onLeaveCancelled(lt){Ue(lt),Vh(Ae,[lt])}})}function JG(t){if(t==null)return null;if($n(t))return[fT(t.enter),fT(t.leave)];{const e=fT(t);return[e,e]}}function fT(t){return hx(t)}function ll(t,e){e.split(/\s+/).forEach(r=>r&&t.classList.add(r)),(t[pp]||(t[pp]=new Set)).add(e)}function hu(t,e){e.split(/\s+/).forEach(l=>l&&t.classList.remove(l));const r=t[pp];r&&(r.delete(e),r.size||(t[pp]=void 0))}function TP(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let QG=0;function EP(t,e,r,l){const h=t._endId=++QG,_=()=>{h===t._endId&&l()};if(r!=null)return setTimeout(_,r);const{type:y,timeout:s,propCount:I}=H3(t,e);if(!y)return l();const O=y+"end";let k=0;const j=()=>{t.removeEventListener(O,Z),_()},Z=Y=>{Y.target===t&&++k>=I&&j()};setTimeout(()=>{k<I&&j()},s+1),t.addEventListener(O,Z)}function H3(t,e){const r=window.getComputedStyle(t),l=se=>(r[se]||"").split(", "),h=l(`${cu}Delay`),_=l(`${cu}Duration`),y=SP(h,_),s=l(`${Og}Delay`),I=l(`${Og}Duration`),O=SP(s,I);let k=null,j=0,Z=0;e===cu?y>0&&(k=cu,j=y,Z=_.length):e===Og?O>0&&(k=Og,j=O,Z=I.length):(j=Math.max(y,O),k=j>0?y>O?cu:Og:null,Z=k?k===cu?_.length:I.length:0);const Y=k===cu&&/\b(transform|all)(,|$)/.test(l(`${cu}Property`).toString());return{type:k,timeout:j,propCount:Z,hasTransform:Y}}function SP(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((r,l)=>AP(r)+AP(t[l])))}function AP(t){return t==="auto"?0:Number(t.slice(0,-1).replace(",","."))*1e3}function fE(){return document.body.offsetHeight}function eq(t,e,r){const l=t[pp];l&&(e=(e?[e,...l]:[...l]).join(" ")),e==null?t.removeAttribute("class"):r?t.setAttribute("class",e):t.className=e}const wx=Symbol("_vod"),G3=Symbol("_vsh"),q3={beforeMount(t,{value:e},{transition:r}){t[wx]=t.style.display==="none"?"":t.style.display,r&&e?r.beforeEnter(t):kg(t,e)},mounted(t,{value:e},{transition:r}){r&&e&&r.enter(t)},updated(t,{value:e,oldValue:r},{transition:l}){!e!=!r&&(l?e?(l.beforeEnter(t),kg(t,!0),l.enter(t)):l.leave(t,()=>{kg(t,!1)}):kg(t,e))},beforeUnmount(t,{value:e}){kg(t,e)}};function kg(t,e){t.style.display=e?t[wx]:"none",t[G3]=!e}function tq(){q3.getSSRProps=({value:t})=>{if(!t)return{style:{display:"none"}}}}const W3=Symbol("");function iq(t){const e=ca();if(!e)return;const r=e.ut=(h=t(e.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${e.uid}"]`)).forEach(_=>Tx(_,h))},l=()=>{const h=t(e.proxy);e.ce?Tx(e.ce,h):pE(e.subTree,h),r(h)};CS(()=>{x_(l)}),K_(()=>{ip(l,hr,{flush:"post"});const h=new MutationObserver(l);h.observe(e.subTree.el.parentNode,{childList:!0}),T1(()=>h.disconnect())})}function pE(t,e){if(t.shapeFlag&128){const r=t.suspense;t=r.activeBranch,r.pendingBranch&&!r.isHydrating&&r.effects.push(()=>{pE(r.activeBranch,e)})}for(;t.component;)t=t.component.subTree;if(t.shapeFlag&1&&t.el)Tx(t.el,e);else if(t.type===os)t.children.forEach(r=>pE(r,e));else if(t.type===nd){let{el:r,anchor:l}=t;for(;r&&(Tx(r,e),r!==l);)r=r.nextSibling}}function Tx(t,e){if(t.nodeType===1){const r=t.style;let l="";for(const h in e)r.setProperty(`--${h}`,e[h]),l+=`--${h}: ${e[h]};`;r[W3]=l}}const nq=/(^|;)\s*display\s*:/;function sq(t,e,r){const l=t.style,h=sn(r);let _=!1;if(r&&!h){if(e)if(sn(e))for(const y of e.split(";")){const s=y.slice(0,y.indexOf(":")).trim();r[s]==null&&$v(l,s,"")}else for(const y in e)r[y]==null&&$v(l,y,"");for(const y in r)y==="display"&&(_=!0),$v(l,y,r[y])}else if(h){if(e!==r){const y=l[W3];y&&(r+=";"+y),l.cssText=r,_=nq.test(r)}}else e&&t.removeAttribute("style");wx in t&&(t[wx]=_?l.display:"",t[G3]&&(l.display="none"))}const MP=/\s*!important$/;function $v(t,e,r){if(yi(r))r.forEach(l=>$v(t,e,l));else if(r==null&&(r=""),e.startsWith("--"))t.setProperty(e,r);else{const l=rq(t,e);MP.test(r)?t.setProperty(_o(l),r.replace(MP,""),"important"):t[l]=r}}const IP=["Webkit","Moz","ms"],pT={};function rq(t,e){const r=pT[e];if(r)return r;let l=cs(e);if(l!=="filter"&&l in t)return pT[e]=l;l=xd(l);for(let h=0;h<IP.length;h++){const _=IP[h]+l;if(_ in t)return pT[e]=_}return e}const CP="http://www.w3.org/1999/xlink";function PP(t,e,r,l,h,_=f$(e)){l&&e.startsWith("xlink:")?r==null?t.removeAttributeNS(CP,e.slice(6,e.length)):t.setAttributeNS(CP,e,r):r==null||_&&!rO(r)?t.removeAttribute(e):t.setAttribute(e,_?"":xo(r)?String(r):r)}function DP(t,e,r,l,h){if(e==="innerHTML"||e==="textContent"){r!=null&&(t[e]=e==="innerHTML"?V3(r):r);return}const _=t.tagName;if(e==="value"&&_!=="PROGRESS"&&!_.includes("-")){const s=_==="OPTION"?t.getAttribute("value")||"":t.value,I=r==null?t.type==="checkbox"?"on":"":String(r);(s!==I||!("_value"in t))&&(t.value=I),r==null&&t.removeAttribute(e),t._value=r;return}let y=!1;if(r===""||r==null){const s=typeof t[e];s==="boolean"?r=rO(r):r==null&&s==="string"?(r="",y=!0):s==="number"&&(r=0,y=!0)}try{t[e]=r}catch{}y&&t.removeAttribute(h||e)}function Xl(t,e,r,l){t.addEventListener(e,r,l)}function oq(t,e,r,l){t.removeEventListener(e,r,l)}const RP=Symbol("_vei");function aq(t,e,r,l,h=null){const _=t[RP]||(t[RP]={}),y=_[e];if(l&&y)y.value=l;else{const[s,I]=lq(e);if(l){const O=_[e]=hq(l,h);Xl(t,s,O,I)}else y&&(oq(t,s,y,I),_[e]=void 0)}}const LP=/(?:Once|Passive|Capture)$/;function lq(t){let e;if(LP.test(t)){e={};let l;for(;l=t.match(LP);)t=t.slice(0,t.length-l[0].length),e[l[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):_o(t.slice(2)),e]}let mT=0;const cq=Promise.resolve(),uq=()=>mT||(cq.then(()=>mT=0),mT=Date.now());function hq(t,e){const r=l=>{if(!l._vts)l._vts=Date.now();else if(l._vts<=r.attached)return;aa(dq(l,r.value),e,5,[l])};return r.value=t,r.attached=uq(),r}function dq(t,e){if(yi(e)){const r=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{r.call(t),t._stopped=!0},e.map(l=>h=>!h._stopped&&l&&l(h))}else return e}const OP=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,fq=(t,e,r,l,h,_)=>{const y=h==="svg";e==="class"?eq(t,l,y):e==="style"?sq(t,r,l):yd(e)?fS(e)||aq(t,e,r,l,_):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):pq(t,e,l,y))?(DP(t,e,l),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&PP(t,e,l,y,_,e!=="value")):t._isVueCE&&(/[A-Z]/.test(e)||!sn(l))?DP(t,cs(e),l,_,e):(e==="true-value"?t._trueValue=l:e==="false-value"&&(t._falseValue=l),PP(t,e,l,y))};function pq(t,e,r,l){if(l)return!!(e==="innerHTML"||e==="textContent"||e in t&&OP(e)&&Bi(r));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const h=t.tagName;if(h==="IMG"||h==="VIDEO"||h==="CANVAS"||h==="SOURCE")return!1}return OP(e)&&sn(r)?!1:e in t}const kP={};/*! #__NO_SIDE_EFFECTS__ */function Z3(t,e,r){const l=MS(t,e);o1(l)&&wn(l,e);class h extends M1{constructor(y){super(l,y,r)}}return h.def=l,h}/*! #__NO_SIDE_EFFECTS__ */const mq=(t,e)=>Z3(t,e,ok),gq=typeof HTMLElement<"u"?HTMLElement:class{};class M1 extends gq{constructor(e,r={},l=Sx){super(),this._def=e,this._props=r,this._createApp=l,this._isVueCE=!0,this._instance=null,this._app=null,this._nonce=this._def.nonce,this._connected=!1,this._resolved=!1,this._numberProps=null,this._styleChildren=new WeakSet,this._ob=null,this.shadowRoot&&l!==Sx?this._root=this.shadowRoot:e.shadowRoot!==!1?(this.attachShadow({mode:"open"}),this._root=this.shadowRoot):this._root=this,this._def.__asyncLoader||this._resolveProps(this._def)}connectedCallback(){if(!this.isConnected)return;this.shadowRoot||this._parseSlots(),this._connected=!0;let e=this;for(;e=e&&(e.parentNode||e.host);)if(e instanceof M1){this._parent=e;break}this._instance||(this._resolved?(this._setParent(),this._update()):e&&e._pendingResolve?this._pendingResolve=e._pendingResolve.then(()=>{this._pendingResolve=void 0,this._resolveDef()}):this._resolveDef())}_setParent(e=this._parent){e&&(this._instance.parent=e._instance,this._instance.provides=e._instance.provides)}disconnectedCallback(){this._connected=!1,_1(()=>{this._connected||(this._ob&&(this._ob.disconnect(),this._ob=null),this._app&&this._app.unmount(),this._instance&&(this._instance.ce=void 0),this._app=this._instance=null)})}_resolveDef(){if(this._pendingResolve)return;for(let l=0;l<this.attributes.length;l++)this._setAttr(this.attributes[l].name);this._ob=new MutationObserver(l=>{for(const h of l)this._setAttr(h.attributeName)}),this._ob.observe(this,{attributes:!0});const e=(l,h=!1)=>{this._resolved=!0,this._pendingResolve=void 0;const{props:_,styles:y}=l;let s;if(_&&!yi(_))for(const I in _){const O=_[I];(O===Number||O&&O.type===Number)&&(I in this._props&&(this._props[I]=hx(this._props[I])),(s||(s=Object.create(null)))[cs(I)]=!0)}this._numberProps=s,h&&this._resolveProps(l),this.shadowRoot&&this._applyStyles(y),this._mount(l)},r=this._def.__asyncLoader;r?this._pendingResolve=r().then(l=>e(this._def=l,!0)):e(this._def)}_mount(e){this._app=this._createApp(e),e.configureApp&&e.configureApp(this._app),this._app._ceVNode=this._createVNode(),this._app.mount(this._root);const r=this._instance&&this._instance.exposed;if(r)for(const l in r)Fn(this,l)||Object.defineProperty(this,l,{get:()=>g1(r[l])})}_resolveProps(e){const{props:r}=e,l=yi(r)?r:Object.keys(r||{});for(const h of Object.keys(this))h[0]!=="_"&&l.includes(h)&&this._setProp(h,this[h]);for(const h of l.map(cs))Object.defineProperty(this,h,{get(){return this._getProp(h)},set(_){this._setProp(h,_,!0,!0)}})}_setAttr(e){if(e.startsWith("data-v-"))return;const r=this.hasAttribute(e);let l=r?this.getAttribute(e):kP;const h=cs(e);r&&this._numberProps&&this._numberProps[h]&&(l=hx(l)),this._setProp(h,l,!1,!0)}_getProp(e){return this._props[e]}_setProp(e,r,l=!0,h=!1){if(r!==this._props[e]&&(r===kP?delete this._props[e]:(this._props[e]=r,e==="key"&&this._app&&(this._app._ceVNode.key=r)),h&&this._instance&&this._update(),l)){const _=this._ob;_&&_.disconnect(),r===!0?this.setAttribute(_o(e),""):typeof r=="string"||typeof r=="number"?this.setAttribute(_o(e),r+""):r||this.removeAttribute(_o(e)),_&&_.observe(this,{attributes:!0})}}_update(){rk(this._createVNode(),this._root)}_createVNode(){const e={};this.shadowRoot||(e.onVnodeMounted=e.onVnodeUpdated=this._renderSlots.bind(this));const r=Yn(this._def,wn(e,this._props));return this._instance||(r.ce=l=>{this._instance=l,l.ce=this,l.isCE=!0;const h=(_,y)=>{this.dispatchEvent(new CustomEvent(_,o1(y[0])?wn({detail:y},y[0]):{detail:y}))};l.emit=(_,...y)=>{h(_,y),_o(_)!==_&&h(_o(_),y)},this._setParent()}),r}_applyStyles(e,r){if(!e)return;if(r){if(r===this._def||this._styleChildren.has(r))return;this._styleChildren.add(r)}const l=this._nonce;for(let h=e.length-1;h>=0;h--){const _=document.createElement("style");l&&_.setAttribute("nonce",l),_.textContent=e[h],this.shadowRoot.prepend(_)}}_parseSlots(){const e=this._slots={};let r;for(;r=this.firstChild;){const l=r.nodeType===1&&r.getAttribute("slot")||"default";(e[l]||(e[l]=[])).push(r),this.removeChild(r)}}_renderSlots(){const e=(this._teleportTarget||this).querySelectorAll("slot"),r=this._instance.type.__scopeId;for(let l=0;l<e.length;l++){const h=e[l],_=h.getAttribute("name")||"default",y=this._slots[_],s=h.parentNode;if(y)for(const I of y){if(r&&I.nodeType===1){const O=r+"-s",k=document.createTreeWalker(I,1);I.setAttribute(O,"");let j;for(;j=k.nextNode();)j.setAttribute(O,"")}s.insertBefore(I,h)}else for(;h.firstChild;)s.insertBefore(h.firstChild,h);s.removeChild(h)}}_injectChildStyle(e){this._applyStyles(e.styles,e)}_removeChildStyle(e){}}function X3(t){const e=ca(),r=e&&e.ce;return r||null}function _q(){const t=X3();return t&&t.shadowRoot}function yq(t="$style"){{const e=ca();if(!e)return xn;const r=e.type.__cssModules;if(!r)return xn;const l=r[t];return l||xn}}const Y3=new WeakMap,K3=new WeakMap,Ex=Symbol("_moveCb"),zP=Symbol("_enterCb"),vq=t=>(delete t.props.mode,t),xq=vq({name:"TransitionGroup",props:wn({},j3,{tag:String,moveClass:String}),setup(t,{slots:e}){const r=ca(),l=SS();let h,_;return b1(()=>{if(!h.length)return;const y=t.moveClass||`${t.name||"v"}-move`;if(!Sq(h[0].el,r.vnode.el,y))return;h.forEach(wq),h.forEach(Tq);const s=h.filter(Eq);fE(),s.forEach(I=>{const O=I.el,k=O.style;ll(O,y),k.transform=k.webkitTransform=k.transitionDuration="";const j=O[Ex]=Z=>{Z&&Z.target!==O||(!Z||/transform$/.test(Z.propertyName))&&(O.removeEventListener("transitionend",j),O[Ex]=null,hu(O,y))};O.addEventListener("transitionend",j)})}),()=>{const y=Dn(t),s=$3(y);let I=y.tag||os;if(h=[],_)for(let O=0;O<_.length;O++){const k=_[O];k.el&&k.el instanceof Element&&(h.push(k),sc(k,hp(k,s,l,r)),Y3.set(k,k.el.getBoundingClientRect()))}_=e.default?v1(e.default()):[];for(let O=0;O<_.length;O++){const k=_[O];k.key!=null&&sc(k,hp(k,s,l,r))}return Yn(I,null,_)}}}),bq=xq;function wq(t){const e=t.el;e[Ex]&&e[Ex](),e[zP]&&e[zP]()}function Tq(t){K3.set(t,t.el.getBoundingClientRect())}function Eq(t){const e=Y3.get(t),r=K3.get(t),l=e.left-r.left,h=e.top-r.top;if(l||h){const _=t.el.style;return _.transform=_.webkitTransform=`translate(${l}px,${h}px)`,_.transitionDuration="0s",t}}function Sq(t,e,r){const l=t.cloneNode(),h=t[pp];h&&h.forEach(s=>{s.split(/\s+/).forEach(I=>I&&l.classList.remove(I))}),r.split(/\s+/).forEach(s=>s&&l.classList.add(s)),l.style.display="none";const _=e.nodeType===1?e:e.parentNode;_.appendChild(l);const{hasTransform:y}=H3(l);return _.removeChild(l),y}const Lu=t=>{const e=t.props["onUpdate:modelValue"]||!1;return yi(e)?r=>ep(e,r):e};function Aq(t){t.target.composing=!0}function FP(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const sa=Symbol("_assign"),Na={created(t,{modifiers:{lazy:e,trim:r,number:l}},h){t[sa]=Lu(h);const _=l||h.props&&h.props.type==="number";Xl(t,e?"change":"input",y=>{if(y.target.composing)return;let s=t.value;r&&(s=s.trim()),_&&(s=ux(s)),t[sa](s)}),r&&Xl(t,"change",()=>{t.value=t.value.trim()}),e||(Xl(t,"compositionstart",Aq),Xl(t,"compositionend",FP),Xl(t,"change",FP))},mounted(t,{value:e}){t.value=e??""},beforeUpdate(t,{value:e,oldValue:r,modifiers:{lazy:l,trim:h,number:_}},y){if(t[sa]=Lu(y),t.composing)return;const s=(_||t.type==="number")&&!/^0\d/.test(t.value)?ux(t.value):t.value,I=e??"";s!==I&&(document.activeElement===t&&t.type!=="range"&&(l&&e===r||h&&t.value.trim()===I)||(t.value=I))}},FS={deep:!0,created(t,e,r){t[sa]=Lu(r),Xl(t,"change",()=>{const l=t._modelValue,h=mp(t),_=t.checked,y=t[sa];if(yi(l)){const s=c1(l,h),I=s!==-1;if(_&&!I)y(l.concat(h));else if(!_&&I){const O=[...l];O.splice(s,1),y(O)}}else if(vd(l)){const s=new Set(l);_?s.add(h):s.delete(h),y(s)}else y(J3(t,_))})},mounted:BP,beforeUpdate(t,e,r){t[sa]=Lu(r),BP(t,e,r)}};function BP(t,{value:e,oldValue:r},l){t._modelValue=e;let h;if(yi(e))h=c1(e,l.props.value)>-1;else if(vd(e))h=e.has(l.props.value);else{if(e===r)return;h=Du(e,J3(t,!0))}t.checked!==h&&(t.checked=h)}const BS={created(t,{value:e},r){t.checked=Du(e,r.props.value),t[sa]=Lu(r),Xl(t,"change",()=>{t[sa](mp(t))})},beforeUpdate(t,{value:e,oldValue:r},l){t[sa]=Lu(l),e!==r&&(t.checked=Du(e,l.props.value))}},o_={deep:!0,created(t,{value:e,modifiers:{number:r}},l){const h=vd(e);Xl(t,"change",()=>{const _=Array.prototype.filter.call(t.options,y=>y.selected).map(y=>r?ux(mp(y)):mp(y));t[sa](t.multiple?h?new Set(_):_:_[0]),t._assigning=!0,_1(()=>{t._assigning=!1})}),t[sa]=Lu(l)},mounted(t,{value:e}){NP(t,e)},beforeUpdate(t,e,r){t[sa]=Lu(r)},updated(t,{value:e}){t._assigning||NP(t,e)}};function NP(t,e){const r=t.multiple,l=yi(e);if(!(r&&!l&&!vd(e))){for(let h=0,_=t.options.length;h<_;h++){const y=t.options[h],s=mp(y);if(r)if(l){const I=typeof s;I==="string"||I==="number"?y.selected=e.some(O=>String(O)===String(s)):y.selected=c1(e,s)>-1}else y.selected=e.has(s);else if(Du(mp(y),e)){t.selectedIndex!==h&&(t.selectedIndex=h);return}}!r&&t.selectedIndex!==-1&&(t.selectedIndex=-1)}}function mp(t){return"_value"in t?t._value:t.value}function J3(t,e){const r=e?"_trueValue":"_falseValue";return r in t?t[r]:e}const Q3={created(t,e,r){hv(t,e,r,null,"created")},mounted(t,e,r){hv(t,e,r,null,"mounted")},beforeUpdate(t,e,r,l){hv(t,e,r,l,"beforeUpdate")},updated(t,e,r,l){hv(t,e,r,l,"updated")}};function ek(t,e){switch(t){case"SELECT":return o_;case"TEXTAREA":return Na;default:switch(e){case"checkbox":return FS;case"radio":return BS;default:return Na}}}function hv(t,e,r,l,h){const y=ek(t.tagName,r.props&&r.props.type)[h];y&&y(t,e,r,l)}function Mq(){Na.getSSRProps=({value:t})=>({value:t}),BS.getSSRProps=({value:t},e)=>{if(e.props&&Du(e.props.value,t))return{checked:!0}},FS.getSSRProps=({value:t},e)=>{if(yi(t)){if(e.props&&c1(t,e.props.value)>-1)return{checked:!0}}else if(vd(t)){if(e.props&&t.has(e.props.value))return{checked:!0}}else if(t)return{checked:!0}},Q3.getSSRProps=(t,e)=>{if(typeof e.type!="string")return;const r=ek(e.type.toUpperCase(),e.props&&e.props.type);if(r.getSSRProps)return r.getSSRProps(t,e)}}const Iq=["ctrl","shift","alt","meta"],Cq={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>Iq.some(r=>t[`${r}Key`]&&!e.includes(r))},tk=(t,e)=>{const r=t._withMods||(t._withMods={}),l=e.join(".");return r[l]||(r[l]=(h,..._)=>{for(let y=0;y<e.length;y++){const s=Cq[e[y]];if(s&&s(h,e))return}return t(h,..._)})},Pq={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Dq=(t,e)=>{const r=t._withKeys||(t._withKeys={}),l=e.join(".");return r[l]||(r[l]=h=>{if(!("key"in h))return;const _=_o(h.key);if(e.some(y=>y===_||Pq[y]===_))return t(h)})},ik=wn({patchProp:fq},XG);let a_,VP=!1;function nk(){return a_||(a_=d3(ik))}function sk(){return a_=VP?a_:f3(ik),VP=!0,a_}const rk=(...t)=>{nk().render(...t)},Rq=(...t)=>{sk().hydrate(...t)},Sx=(...t)=>{const e=nk().createApp(...t),{mount:r}=e;return e.mount=l=>{const h=lk(l);if(!h)return;const _=e._component;!Bi(_)&&!_.render&&!_.template&&(_.template=h.innerHTML),h.nodeType===1&&(h.textContent="");const y=r(h,!1,ak(h));return h instanceof Element&&(h.removeAttribute("v-cloak"),h.setAttribute("data-v-app","")),y},e},ok=(...t)=>{const e=sk().createApp(...t),{mount:r}=e;return e.mount=l=>{const h=lk(l);if(h)return r(h,!0,ak(h))},e};function ak(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function lk(t){return sn(t)?document.querySelector(t):t}let UP=!1;const Lq=()=>{UP||(UP=!0,Mq(),tq())},Oq=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:jO,BaseTransitionPropsValidators:AS,Comment:Gs,DeprecationTypes:qG,EffectScope:_S,ErrorCodes:nH,ErrorTypeStrings:NG,Fragment:os,KeepAlive:CH,ReactiveEffect:__,Static:nd,Suspense:wG,Teleport:hH,Text:Su,TrackOpTypes:Y$,Transition:KG,TransitionGroup:bq,TriggerOpTypes:K$,VueElement:M1,assertNumber:iH,callWithAsyncErrorHandling:aa,callWithErrorHandling:Lp,camelize:cs,capitalize:xd,cloneVNode:_l,compatUtils:GG,computed:z3,createApp:Sx,createBlock:A_,createCommentVNode:Zl,createElementBlock:tn,createElementVNode:gt,createHydrationRenderer:f3,createPropsRestProxy:XH,createRenderer:d3,createSSRApp:ok,createSlots:OH,createStaticVNode:A1,createTextVNode:Ro,createVNode:Yn,customRef:IO,defineAsyncComponent:MH,defineComponent:MS,defineCustomElement:Z3,defineEmits:NH,defineExpose:VH,defineModel:$H,defineOptions:UH,defineProps:BH,defineSSRCustomElement:mq,defineSlots:jH,devtools:VG,effect:y$,effectScope:m$,getCurrentInstance:ca,getCurrentScope:lO,getCurrentWatcher:J$,getTransitionRawChildren:v1,guardReactiveProps:I3,h:F3,handleError:bd,hasInjectionContext:sG,hydrate:Rq,hydrateOnIdle:bH,hydrateOnInteraction:SH,hydrateOnMediaQuery:EH,hydrateOnVisible:TH,initCustomFormatter:zG,initDirectivesForSSR:Lq,inject:s_,isMemoSame:B3,isProxy:m1,isReactive:Tu,isReadonly:Ru,isRef:rr,isRuntimeOnly:LG,isShallow:Fo,isVNode:rc,markRaw:SO,mergeDefaults:WH,mergeModels:ZH,mergeProps:C3,nextTick:_1,normalizeClass:X_,normalizeProps:n$,normalizeStyle:Z_,onActivated:HO,onBeforeMount:WO,onBeforeUnmount:w1,onBeforeUpdate:CS,onDeactivated:GO,onErrorCaptured:KO,onMounted:K_,onRenderTracked:YO,onRenderTriggered:XO,onScopeDispose:g$,onServerPrefetch:ZO,onUnmounted:T1,onUpdated:b1,onWatcherCleanup:PO,openBlock:Fi,popScopeId:lH,provide:i3,proxyRefs:wS,pushScopeId:aH,queuePostFlushCb:x_,reactive:f1,readonly:bS,ref:t_,registerRuntimeCompiler:L3,render:rk,renderList:dp,renderSlot:kH,resolveComponent:gx,resolveDirective:LH,resolveDynamicComponent:RH,resolveFilter:HG,resolveTransitionHooks:hp,setBlockTracking:oE,setDevtoolsHook:UG,setTransitionHooks:sc,shallowReactive:EO,shallowReadonly:B$,shallowRef:AO,ssrContextKey:_3,ssrUtils:$G,stop:v$,toDisplayString:Is,toHandlerKey:Qf,toHandlers:zH,toRaw:Dn,toRef:W$,toRefs:H$,toValue:U$,transformVNodeArgs:IG,triggerRef:V$,unref:g1,useAttrs:qH,useCssModule:yq,useCssVars:iq,useHost:X3,useId:fH,useModel:mG,useSSRContext:y3,useShadowRoot:_q,useSlots:GH,useTemplateRef:pH,useTransitionState:SS,vModelCheckbox:FS,vModelDynamic:Q3,vModelRadio:BS,vModelSelect:o_,vModelText:Na,vShow:q3,version:N3,warn:BG,watch:ip,watchEffect:dG,watchPostEffect:fG,watchSyncEffect:v3,withAsyncContext:YH,withCtx:ES,withDefaults:HH,withDirectives:ka,withKeys:Dq,withMemo:FG,withModifiers:tk,withScopeId:cH},Symbol.toStringTag,{value:"Module"}));/**
* @vue/compiler-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const M_=Symbol(""),l_=Symbol(""),NS=Symbol(""),Ax=Symbol(""),ck=Symbol(""),fd=Symbol(""),uk=Symbol(""),hk=Symbol(""),VS=Symbol(""),US=Symbol(""),ey=Symbol(""),jS=Symbol(""),dk=Symbol(""),$S=Symbol(""),HS=Symbol(""),GS=Symbol(""),qS=Symbol(""),WS=Symbol(""),ZS=Symbol(""),fk=Symbol(""),pk=Symbol(""),I1=Symbol(""),Mx=Symbol(""),XS=Symbol(""),YS=Symbol(""),I_=Symbol(""),ty=Symbol(""),KS=Symbol(""),mE=Symbol(""),kq=Symbol(""),gE=Symbol(""),Ix=Symbol(""),zq=Symbol(""),Fq=Symbol(""),JS=Symbol(""),Bq=Symbol(""),Nq=Symbol(""),QS=Symbol(""),mk=Symbol(""),gp={[M_]:"Fragment",[l_]:"Teleport",[NS]:"Suspense",[Ax]:"KeepAlive",[ck]:"BaseTransition",[fd]:"openBlock",[uk]:"createBlock",[hk]:"createElementBlock",[VS]:"createVNode",[US]:"createElementVNode",[ey]:"createCommentVNode",[jS]:"createTextVNode",[dk]:"createStaticVNode",[$S]:"resolveComponent",[HS]:"resolveDynamicComponent",[GS]:"resolveDirective",[qS]:"resolveFilter",[WS]:"withDirectives",[ZS]:"renderList",[fk]:"renderSlot",[pk]:"createSlots",[I1]:"toDisplayString",[Mx]:"mergeProps",[XS]:"normalizeClass",[YS]:"normalizeStyle",[I_]:"normalizeProps",[ty]:"guardReactiveProps",[KS]:"toHandlers",[mE]:"camelize",[kq]:"capitalize",[gE]:"toHandlerKey",[Ix]:"setBlockTracking",[zq]:"pushScopeId",[Fq]:"popScopeId",[JS]:"withCtx",[Bq]:"unref",[Nq]:"isRef",[QS]:"withMemo",[mk]:"isMemoSame"};function Vq(t){Object.getOwnPropertySymbols(t).forEach(e=>{gp[e]=t[e]})}const jo={start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0},source:""};function Uq(t,e=""){return{type:0,source:e,children:t,helpers:new Set,components:[],directives:[],hoists:[],imports:[],cached:[],temps:0,codegenNode:void 0,loc:jo}}function C_(t,e,r,l,h,_,y,s=!1,I=!1,O=!1,k=jo){return t&&(s?(t.helper(fd),t.helper(vp(t.inSSR,O))):t.helper(yp(t.inSSR,O)),y&&t.helper(WS)),{type:13,tag:e,props:r,children:l,patchFlag:h,dynamicProps:_,directives:y,isBlock:s,disableTracking:I,isComponent:O,loc:k}}function sd(t,e=jo){return{type:17,loc:e,elements:t}}function ia(t,e=jo){return{type:15,loc:e,properties:t}}function Fs(t,e){return{type:16,loc:jo,key:sn(t)?cn(t,!0):t,value:e}}function cn(t,e=!1,r=jo,l=0){return{type:4,loc:r,content:t,isStatic:e,constType:e?3:l}}function Va(t,e=jo){return{type:8,loc:e,children:t}}function tr(t,e=[],r=jo){return{type:14,loc:r,callee:t,arguments:e}}function _p(t,e=void 0,r=!1,l=!1,h=jo){return{type:18,params:t,returns:e,newline:r,isSlot:l,loc:h}}function _E(t,e,r,l=!0){return{type:19,test:t,consequent:e,alternate:r,newline:l,loc:jo}}function jq(t,e,r=!1,l=!1){return{type:20,index:t,value:e,needPauseTracking:r,inVOnce:l,needArraySpread:!1,loc:jo}}function $q(t){return{type:21,body:t,loc:jo}}function yp(t,e){return t||e?VS:US}function vp(t,e){return t||e?uk:hk}function e2(t,{helper:e,removeHelper:r,inSSR:l}){t.isBlock||(t.isBlock=!0,r(yp(l,t.isComponent)),e(fd),e(vp(l,t.isComponent)))}const jP=new Uint8Array([123,123]),$P=new Uint8Array([125,125]);function HP(t){return t>=97&&t<=122||t>=65&&t<=90}function Lo(t){return t===32||t===10||t===9||t===12||t===13}function uu(t){return t===47||t===62||Lo(t)}function Cx(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}const Mr={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class Hq{constructor(e,r){this.stack=e,this.cbs=r,this.state=1,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=1,this.inRCDATA=!1,this.inXML=!1,this.inVPre=!1,this.newlines=[],this.mode=0,this.delimiterOpen=jP,this.delimiterClose=$P,this.delimiterIndex=-1,this.currentSequence=void 0,this.sequenceIndex=0}get inSFCRoot(){return this.mode===2&&this.stack.length===0}reset(){this.state=1,this.mode=0,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=1,this.inRCDATA=!1,this.currentSequence=void 0,this.newlines.length=0,this.delimiterOpen=jP,this.delimiterClose=$P}getPos(e){let r=1,l=e+1;for(let h=this.newlines.length-1;h>=0;h--){const _=this.newlines[h];if(e>_){r=h+2,l=e-_;break}}return{column:l,line:r,offset:e}}peek(){return this.buffer.charCodeAt(this.index+1)}stateText(e){e===60?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=5,this.sectionStart=this.index):!this.inVPre&&e===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(e))}stateInterpolationOpen(e){if(e===this.delimiterOpen[this.delimiterIndex])if(this.delimiterIndex===this.delimiterOpen.length-1){const r=this.index+1-this.delimiterOpen.length;r>this.sectionStart&&this.cbs.ontext(this.sectionStart,r),this.state=3,this.sectionStart=r}else this.delimiterIndex++;else this.inRCDATA?(this.state=32,this.stateInRCDATA(e)):(this.state=1,this.stateText(e))}stateInterpolation(e){e===this.delimiterClose[0]&&(this.state=4,this.delimiterIndex=0,this.stateInterpolationClose(e))}stateInterpolationClose(e){e===this.delimiterClose[this.delimiterIndex]?this.delimiterIndex===this.delimiterClose.length-1?(this.cbs.oninterpolation(this.sectionStart,this.index+1),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):this.delimiterIndex++:(this.state=3,this.stateInterpolation(e))}stateSpecialStartSequence(e){const r=this.sequenceIndex===this.currentSequence.length;if(!(r?uu(e):(e|32)===this.currentSequence[this.sequenceIndex]))this.inRCDATA=!1;else if(!r){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=6,this.stateInTagName(e)}stateInRCDATA(e){if(this.sequenceIndex===this.currentSequence.length){if(e===62||Lo(e)){const r=this.index-this.currentSequence.length;if(this.sectionStart<r){const l=this.index;this.index=r,this.cbs.ontext(this.sectionStart,r),this.index=l}this.sectionStart=r+2,this.stateInClosingTagName(e),this.inRCDATA=!1;return}this.sequenceIndex=0}(e|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Mr.TitleEnd||this.currentSequence===Mr.TextareaEnd&&!this.inSFCRoot?!this.inVPre&&e===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(e)):this.fastForwardTo(60)&&(this.sequenceIndex=1):this.sequenceIndex=+(e===60)}stateCDATASequence(e){e===Mr.Cdata[this.sequenceIndex]?++this.sequenceIndex===Mr.Cdata.length&&(this.state=28,this.currentSequence=Mr.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=23,this.stateInDeclaration(e))}fastForwardTo(e){for(;++this.index<this.buffer.length;){const r=this.buffer.charCodeAt(this.index);if(r===10&&this.newlines.push(this.index),r===e)return!0}return this.index=this.buffer.length-1,!1}stateInCommentLike(e){e===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Mr.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index-2):this.cbs.oncomment(this.sectionStart,this.index-2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=1):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):e!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}startSpecial(e,r){this.enterRCDATA(e,r),this.state=31}enterRCDATA(e,r){this.inRCDATA=!0,this.currentSequence=e,this.sequenceIndex=r}stateBeforeTagName(e){e===33?(this.state=22,this.sectionStart=this.index+1):e===63?(this.state=24,this.sectionStart=this.index+1):HP(e)?(this.sectionStart=this.index,this.mode===0?this.state=6:this.inSFCRoot?this.state=34:this.inXML?this.state=6:e===116?this.state=30:this.state=e===115?29:6):e===47?this.state=8:(this.state=1,this.stateText(e))}stateInTagName(e){uu(e)&&this.handleTagName(e)}stateInSFCRootTagName(e){if(uu(e)){const r=this.buffer.slice(this.sectionStart,this.index);r!=="template"&&this.enterRCDATA(Cx("</"+r),0),this.handleTagName(e)}}handleTagName(e){this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(e)}stateBeforeClosingTagName(e){Lo(e)||(e===62?(this.state=1,this.sectionStart=this.index+1):(this.state=HP(e)?9:27,this.sectionStart=this.index))}stateInClosingTagName(e){(e===62||Lo(e))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=10,this.stateAfterClosingTagName(e))}stateAfterClosingTagName(e){e===62&&(this.state=1,this.sectionStart=this.index+1)}stateBeforeAttrName(e){e===62?(this.cbs.onopentagend(this.index),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):e===47?this.state=7:e===60&&this.peek()===47?(this.cbs.onopentagend(this.index),this.state=5,this.sectionStart=this.index):Lo(e)||this.handleAttrStart(e)}handleAttrStart(e){e===118&&this.peek()===45?(this.state=13,this.sectionStart=this.index):e===46||e===58||e===64||e===35?(this.cbs.ondirname(this.index,this.index+1),this.state=14,this.sectionStart=this.index+1):(this.state=12,this.sectionStart=this.index)}stateInSelfClosingTag(e){e===62?(this.cbs.onselfclosingtag(this.index),this.state=1,this.sectionStart=this.index+1,this.inRCDATA=!1):Lo(e)||(this.state=11,this.stateBeforeAttrName(e))}stateInAttrName(e){(e===61||uu(e))&&(this.cbs.onattribname(this.sectionStart,this.index),this.handleAttrNameEnd(e))}stateInDirName(e){e===61||uu(e)?(this.cbs.ondirname(this.sectionStart,this.index),this.handleAttrNameEnd(e)):e===58?(this.cbs.ondirname(this.sectionStart,this.index),this.state=14,this.sectionStart=this.index+1):e===46&&(this.cbs.ondirname(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDirArg(e){e===61||uu(e)?(this.cbs.ondirarg(this.sectionStart,this.index),this.handleAttrNameEnd(e)):e===91?this.state=15:e===46&&(this.cbs.ondirarg(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDynamicDirArg(e){e===93?this.state=14:(e===61||uu(e))&&(this.cbs.ondirarg(this.sectionStart,this.index+1),this.handleAttrNameEnd(e))}stateInDirModifier(e){e===61||uu(e)?(this.cbs.ondirmodifier(this.sectionStart,this.index),this.handleAttrNameEnd(e)):e===46&&(this.cbs.ondirmodifier(this.sectionStart,this.index),this.sectionStart=this.index+1)}handleAttrNameEnd(e){this.sectionStart=this.index,this.state=17,this.cbs.onattribnameend(this.index),this.stateAfterAttrName(e)}stateAfterAttrName(e){e===61?this.state=18:e===47||e===62?(this.cbs.onattribend(0,this.sectionStart),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(e)):Lo(e)||(this.cbs.onattribend(0,this.sectionStart),this.handleAttrStart(e))}stateBeforeAttrValue(e){e===34?(this.state=19,this.sectionStart=this.index+1):e===39?(this.state=20,this.sectionStart=this.index+1):Lo(e)||(this.sectionStart=this.index,this.state=21,this.stateInAttrValueNoQuotes(e))}handleInAttrValue(e,r){(e===r||this.fastForwardTo(r))&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(r===34?3:2,this.index+1),this.state=11)}stateInAttrValueDoubleQuotes(e){this.handleInAttrValue(e,34)}stateInAttrValueSingleQuotes(e){this.handleInAttrValue(e,39)}stateInAttrValueNoQuotes(e){Lo(e)||e===62?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(1,this.index),this.state=11,this.stateBeforeAttrName(e)):(e===39||e===60||e===61||e===96)&&this.cbs.onerr(18,this.index)}stateBeforeDeclaration(e){e===91?(this.state=26,this.sequenceIndex=0):this.state=e===45?25:23}stateInDeclaration(e){(e===62||this.fastForwardTo(62))&&(this.state=1,this.sectionStart=this.index+1)}stateInProcessingInstruction(e){(e===62||this.fastForwardTo(62))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeComment(e){e===45?(this.state=28,this.currentSequence=Mr.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=23}stateInSpecialComment(e){(e===62||this.fastForwardTo(62))&&(this.cbs.oncomment(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeSpecialS(e){e===Mr.ScriptEnd[3]?this.startSpecial(Mr.ScriptEnd,4):e===Mr.StyleEnd[3]?this.startSpecial(Mr.StyleEnd,4):(this.state=6,this.stateInTagName(e))}stateBeforeSpecialT(e){e===Mr.TitleEnd[3]?this.startSpecial(Mr.TitleEnd,4):e===Mr.TextareaEnd[3]?this.startSpecial(Mr.TextareaEnd,4):(this.state=6,this.stateInTagName(e))}startEntity(){}stateInEntity(){}parse(e){for(this.buffer=e;this.index<this.buffer.length;){const r=this.buffer.charCodeAt(this.index);switch(r===10&&this.newlines.push(this.index),this.state){case 1:{this.stateText(r);break}case 2:{this.stateInterpolationOpen(r);break}case 3:{this.stateInterpolation(r);break}case 4:{this.stateInterpolationClose(r);break}case 31:{this.stateSpecialStartSequence(r);break}case 32:{this.stateInRCDATA(r);break}case 26:{this.stateCDATASequence(r);break}case 19:{this.stateInAttrValueDoubleQuotes(r);break}case 12:{this.stateInAttrName(r);break}case 13:{this.stateInDirName(r);break}case 14:{this.stateInDirArg(r);break}case 15:{this.stateInDynamicDirArg(r);break}case 16:{this.stateInDirModifier(r);break}case 28:{this.stateInCommentLike(r);break}case 27:{this.stateInSpecialComment(r);break}case 11:{this.stateBeforeAttrName(r);break}case 6:{this.stateInTagName(r);break}case 34:{this.stateInSFCRootTagName(r);break}case 9:{this.stateInClosingTagName(r);break}case 5:{this.stateBeforeTagName(r);break}case 17:{this.stateAfterAttrName(r);break}case 20:{this.stateInAttrValueSingleQuotes(r);break}case 18:{this.stateBeforeAttrValue(r);break}case 8:{this.stateBeforeClosingTagName(r);break}case 10:{this.stateAfterClosingTagName(r);break}case 29:{this.stateBeforeSpecialS(r);break}case 30:{this.stateBeforeSpecialT(r);break}case 21:{this.stateInAttrValueNoQuotes(r);break}case 7:{this.stateInSelfClosingTag(r);break}case 23:{this.stateInDeclaration(r);break}case 22:{this.stateBeforeDeclaration(r);break}case 25:{this.stateBeforeComment(r);break}case 24:{this.stateInProcessingInstruction(r);break}case 33:{this.stateInEntity();break}}this.index++}this.cleanup(),this.finish()}cleanup(){this.sectionStart!==this.index&&(this.state===1||this.state===32&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===19||this.state===20||this.state===21)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}finish(){this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const e=this.buffer.length;this.sectionStart>=e||(this.state===28?this.currentSequence===Mr.CdataEnd?this.cbs.oncdata(this.sectionStart,e):this.cbs.oncomment(this.sectionStart,e):this.state===6||this.state===11||this.state===18||this.state===17||this.state===12||this.state===13||this.state===14||this.state===15||this.state===16||this.state===20||this.state===19||this.state===21||this.state===9||this.cbs.ontext(this.sectionStart,e))}emitCodePoint(e,r){}}function GP(t,{compatConfig:e}){const r=e&&e[t];return t==="MODE"?r||3:r}function rd(t,e){const r=GP("MODE",e),l=GP(t,e);return r===3?l===!0:l!==!1}function P_(t,e,r,...l){return rd(t,e)}function t2(t){throw t}function gk(t){}function gs(t,e,r,l){const h=`https://vuejs.org/error-reference/#compiler-${t}`,_=new SyntaxError(String(h));return _.code=t,_.loc=e,_}const vo=t=>t.type===4&&t.isStatic;function _k(t){switch(t){case"Teleport":case"teleport":return l_;case"Suspense":case"suspense":return NS;case"KeepAlive":case"keep-alive":return Ax;case"BaseTransition":case"base-transition":return ck}}const Gq=/^\d|[^\$\w\xA0-\uFFFF]/,i2=t=>!Gq.test(t),qq=/[A-Za-z_$\xA0-\uFFFF]/,Wq=/[\.\?\w$\xA0-\uFFFF]/,Zq=/\s+[.[]\s*|\s*[.[]\s+/g,yk=t=>t.type===4?t.content:t.loc.source,Xq=t=>{const e=yk(t).trim().replace(Zq,s=>s.trim());let r=0,l=[],h=0,_=0,y=null;for(let s=0;s<e.length;s++){const I=e.charAt(s);switch(r){case 0:if(I==="[")l.push(r),r=1,h++;else if(I==="(")l.push(r),r=2,_++;else if(!(s===0?qq:Wq).test(I))return!1;break;case 1:I==="'"||I==='"'||I==="`"?(l.push(r),r=3,y=I):I==="["?h++:I==="]"&&(--h||(r=l.pop()));break;case 2:if(I==="'"||I==='"'||I==="`")l.push(r),r=3,y=I;else if(I==="(")_++;else if(I===")"){if(s===e.length-1)return!1;--_||(r=l.pop())}break;case 3:I===y&&(r=l.pop(),y=null);break}}return!h&&!_},vk=Xq,Yq=/^\s*(async\s*)?(\([^)]*?\)|[\w$_]+)\s*(:[^=]+)?=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,Kq=t=>Yq.test(yk(t)),Jq=Kq;function ta(t,e,r=!1){for(let l=0;l<t.props.length;l++){const h=t.props[l];if(h.type===7&&(r||h.exp)&&(sn(e)?h.name===e:e.test(h.name)))return h}}function C1(t,e,r=!1,l=!1){for(let h=0;h<t.props.length;h++){const _=t.props[h];if(_.type===6){if(r)continue;if(_.name===e&&(_.value||l))return _}else if(_.name==="bind"&&(_.exp||l)&&Kh(_.arg,e))return _}}function Kh(t,e){return!!(t&&vo(t)&&t.content===e)}function Qq(t){return t.props.some(e=>e.type===7&&e.name==="bind"&&(!e.arg||e.arg.type!==4||!e.arg.isStatic))}function gT(t){return t.type===5||t.type===2}function eW(t){return t.type===7&&t.name==="slot"}function Px(t){return t.type===1&&t.tagType===3}function Dx(t){return t.type===1&&t.tagType===2}const tW=new Set([I_,ty]);function xk(t,e=[]){if(t&&!sn(t)&&t.type===14){const r=t.callee;if(!sn(r)&&tW.has(r))return xk(t.arguments[0],e.concat(t))}return[t,e]}function Rx(t,e,r){let l,h=t.type===13?t.props:t.arguments[2],_=[],y;if(h&&!sn(h)&&h.type===14){const s=xk(h);h=s[0],_=s[1],y=_[_.length-1]}if(h==null||sn(h))l=ia([e]);else if(h.type===14){const s=h.arguments[0];!sn(s)&&s.type===15?qP(e,s)||s.properties.unshift(e):h.callee===KS?l=tr(r.helper(Mx),[ia([e]),h]):h.arguments.unshift(ia([e])),!l&&(l=h)}else h.type===15?(qP(e,h)||h.properties.unshift(e),l=h):(l=tr(r.helper(Mx),[ia([e]),h]),y&&y.callee===ty&&(y=_[_.length-2]));t.type===13?y?y.arguments[0]=l:t.props=l:y?y.arguments[0]=l:t.arguments[2]=l}function qP(t,e){let r=!1;if(t.key.type===4){const l=t.key.content;r=e.properties.some(h=>h.key.type===4&&h.key.content===l)}return r}function D_(t,e){return`_${e}_${t.replace(/[^\w]/g,(r,l)=>r==="-"?"_":t.charCodeAt(l).toString())}`}function iW(t){return t.type===14&&t.callee===QS?t.arguments[1].returns:t}const nW=/([\s\S]*?)\s+(?:in|of)\s+(\S[\s\S]*)/,bk={parseMode:"base",ns:0,delimiters:["{{","}}"],getNamespace:()=>0,isVoidTag:jg,isPreTag:jg,isIgnoreNewlineTag:jg,isCustomElement:jg,onError:t2,onWarn:gk,comments:!1,prefixIdentifiers:!1};let Bn=bk,R_=null,ic="",Cr=null,Pn=null,fo="",Vl=-1,Gh=-1,n2=0,gu=!1,yE=null;const ms=[],Cs=new Hq(ms,{onerr:Bl,ontext(t,e){dv(yr(t,e),t,e)},ontextentity(t,e,r){dv(t,e,r)},oninterpolation(t,e){if(gu)return dv(yr(t,e),t,e);let r=t+Cs.delimiterOpen.length,l=e-Cs.delimiterClose.length;for(;Lo(ic.charCodeAt(r));)r++;for(;Lo(ic.charCodeAt(l-1));)l--;let h=yr(r,l);h.includes("&")&&(h=Bn.decodeEntities(h,!1)),vE({type:5,content:Gv(h,!1,zs(r,l)),loc:zs(t,e)})},onopentagname(t,e){const r=yr(t,e);Cr={type:1,tag:r,ns:Bn.getNamespace(r,ms[0],Bn.ns),tagType:0,props:[],children:[],loc:zs(t-1,e),codegenNode:void 0}},onopentagend(t){ZP(t)},onclosetag(t,e){const r=yr(t,e);if(!Bn.isVoidTag(r)){let l=!1;for(let h=0;h<ms.length;h++)if(ms[h].tag.toLowerCase()===r.toLowerCase()){l=!0,h>0&&Bl(24,ms[0].loc.start.offset);for(let y=0;y<=h;y++){const s=ms.shift();Hv(s,e,y<h)}break}l||Bl(23,wk(t,60))}},onselfclosingtag(t){const e=Cr.tag;Cr.isSelfClosing=!0,ZP(t),ms[0]&&ms[0].tag===e&&Hv(ms.shift(),t)},onattribname(t,e){Pn={type:6,name:yr(t,e),nameLoc:zs(t,e),value:void 0,loc:zs(t)}},ondirname(t,e){const r=yr(t,e),l=r==="."||r===":"?"bind":r==="@"?"on":r==="#"?"slot":r.slice(2);if(!gu&&l===""&&Bl(26,t),gu||l==="")Pn={type:6,name:r,nameLoc:zs(t,e),value:void 0,loc:zs(t)};else if(Pn={type:7,name:l,rawName:r,exp:void 0,arg:void 0,modifiers:r==="."?[cn("prop")]:[],loc:zs(t)},l==="pre"){gu=Cs.inVPre=!0,yE=Cr;const h=Cr.props;for(let _=0;_<h.length;_++)h[_].type===7&&(h[_]=pW(h[_]))}},ondirarg(t,e){if(t===e)return;const r=yr(t,e);if(gu)Pn.name+=r,Jh(Pn.nameLoc,e);else{const l=r[0]!=="[";Pn.arg=Gv(l?r:r.slice(1,-1),l,zs(t,e),l?3:0)}},ondirmodifier(t,e){const r=yr(t,e);if(gu)Pn.name+="."+r,Jh(Pn.nameLoc,e);else if(Pn.name==="slot"){const l=Pn.arg;l&&(l.content+="."+r,Jh(l.loc,e))}else{const l=cn(r,!0,zs(t,e));Pn.modifiers.push(l)}},onattribdata(t,e){fo+=yr(t,e),Vl<0&&(Vl=t),Gh=e},onattribentity(t,e,r){fo+=t,Vl<0&&(Vl=e),Gh=r},onattribnameend(t){const e=Pn.loc.start.offset,r=yr(e,t);Pn.type===7&&(Pn.rawName=r),Cr.props.some(l=>(l.type===7?l.rawName:l.name)===r)&&Bl(2,e)},onattribend(t,e){if(Cr&&Pn){if(Jh(Pn.loc,e),t!==0)if(fo.includes("&")&&(fo=Bn.decodeEntities(fo,!0)),Pn.type===6)Pn.name==="class"&&(fo=Ek(fo).trim()),t===1&&!fo&&Bl(13,e),Pn.value={type:2,content:fo,loc:t===1?zs(Vl,Gh):zs(Vl-1,Gh+1)},Cs.inSFCRoot&&Cr.tag==="template"&&Pn.name==="lang"&&fo&&fo!=="html"&&Cs.enterRCDATA(Cx("</template"),0);else{let r=0;Pn.exp=Gv(fo,!1,zs(Vl,Gh),0,r),Pn.name==="for"&&(Pn.forParseResult=rW(Pn.exp));let l=-1;Pn.name==="bind"&&(l=Pn.modifiers.findIndex(h=>h.content==="sync"))>-1&&P_("COMPILER_V_BIND_SYNC",Bn,Pn.loc,Pn.rawName)&&(Pn.name="model",Pn.modifiers.splice(l,1))}(Pn.type!==7||Pn.name!=="pre")&&Cr.props.push(Pn)}fo="",Vl=Gh=-1},oncomment(t,e){Bn.comments&&vE({type:3,content:yr(t,e),loc:zs(t-4,e+3)})},onend(){const t=ic.length;for(let e=0;e<ms.length;e++)Hv(ms[e],t-1),Bl(24,ms[e].loc.start.offset)},oncdata(t,e){ms[0].ns!==0?dv(yr(t,e),t,e):Bl(1,t-9)},onprocessinginstruction(t){(ms[0]?ms[0].ns:Bn.ns)===0&&Bl(21,t-1)}}),WP=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,sW=/^\(|\)$/g;function rW(t){const e=t.loc,r=t.content,l=r.match(nW);if(!l)return;const[,h,_]=l,y=(j,Z,Y=!1)=>{const se=e.start.offset+Z,ne=se+j.length;return Gv(j,!1,zs(se,ne),0,Y?1:0)},s={source:y(_.trim(),r.indexOf(_,h.length)),value:void 0,key:void 0,index:void 0,finalized:!1};let I=h.trim().replace(sW,"").trim();const O=h.indexOf(I),k=I.match(WP);if(k){I=I.replace(WP,"").trim();const j=k[1].trim();let Z;if(j&&(Z=r.indexOf(j,O+I.length),s.key=y(j,Z,!0)),k[2]){const Y=k[2].trim();Y&&(s.index=y(Y,r.indexOf(Y,s.key?Z+j.length:O+I.length),!0))}}return I&&(s.value=y(I,O,!0)),s}function yr(t,e){return ic.slice(t,e)}function ZP(t){Cs.inSFCRoot&&(Cr.innerLoc=zs(t+1,t+1)),vE(Cr);const{tag:e,ns:r}=Cr;r===0&&Bn.isPreTag(e)&&n2++,Bn.isVoidTag(e)?Hv(Cr,t):(ms.unshift(Cr),(r===1||r===2)&&(Cs.inXML=!0)),Cr=null}function dv(t,e,r){{const _=ms[0]&&ms[0].tag;_!=="script"&&_!=="style"&&t.includes("&")&&(t=Bn.decodeEntities(t,!1))}const l=ms[0]||R_,h=l.children[l.children.length-1];h&&h.type===2?(h.content+=t,Jh(h.loc,r)):l.children.push({type:2,content:t,loc:zs(e,r)})}function Hv(t,e,r=!1){r?Jh(t.loc,wk(e,60)):Jh(t.loc,oW(e,62)+1),Cs.inSFCRoot&&(t.children.length?t.innerLoc.end=wn({},t.children[t.children.length-1].loc.end):t.innerLoc.end=wn({},t.innerLoc.start),t.innerLoc.source=yr(t.innerLoc.start.offset,t.innerLoc.end.offset));const{tag:l,ns:h,children:_}=t;if(gu||(l==="slot"?t.tagType=2:XP(t)?t.tagType=3:lW(t)&&(t.tagType=1)),Cs.inRCDATA||(t.children=Tk(_)),h===0&&Bn.isIgnoreNewlineTag(l)){const y=_[0];y&&y.type===2&&(y.content=y.content.replace(/^\r?\n/,""))}h===0&&Bn.isPreTag(l)&&n2--,yE===t&&(gu=Cs.inVPre=!1,yE=null),Cs.inXML&&(ms[0]?ms[0].ns:Bn.ns)===0&&(Cs.inXML=!1);{const y=t.props;if(!Cs.inSFCRoot&&rd("COMPILER_NATIVE_TEMPLATE",Bn)&&t.tag==="template"&&!XP(t)){const I=ms[0]||R_,O=I.children.indexOf(t);I.children.splice(O,1,...t.children)}const s=y.find(I=>I.type===6&&I.name==="inline-template");s&&P_("COMPILER_INLINE_TEMPLATE",Bn,s.loc)&&t.children.length&&(s.value={type:2,content:yr(t.children[0].loc.start.offset,t.children[t.children.length-1].loc.end.offset),loc:s.loc})}}function oW(t,e){let r=t;for(;ic.charCodeAt(r)!==e&&r<ic.length-1;)r++;return r}function wk(t,e){let r=t;for(;ic.charCodeAt(r)!==e&&r>=0;)r--;return r}const aW=new Set(["if","else","else-if","for","slot"]);function XP({tag:t,props:e}){if(t==="template"){for(let r=0;r<e.length;r++)if(e[r].type===7&&aW.has(e[r].name))return!0}return!1}function lW({tag:t,props:e}){if(Bn.isCustomElement(t))return!1;if(t==="component"||cW(t.charCodeAt(0))||_k(t)||Bn.isBuiltInComponent&&Bn.isBuiltInComponent(t)||Bn.isNativeTag&&!Bn.isNativeTag(t))return!0;for(let r=0;r<e.length;r++){const l=e[r];if(l.type===6){if(l.name==="is"&&l.value){if(l.value.content.startsWith("vue:"))return!0;if(P_("COMPILER_IS_ON_ELEMENT",Bn,l.loc))return!0}}else if(l.name==="bind"&&Kh(l.arg,"is")&&P_("COMPILER_IS_ON_ELEMENT",Bn,l.loc))return!0}return!1}function cW(t){return t>64&&t<91}const uW=/\r\n/g;function Tk(t,e){const r=Bn.whitespace!=="preserve";let l=!1;for(let h=0;h<t.length;h++){const _=t[h];if(_.type===2)if(n2)_.content=_.content.replace(uW,`
`);else if(hW(_.content)){const y=t[h-1]&&t[h-1].type,s=t[h+1]&&t[h+1].type;!y||!s||r&&(y===3&&(s===3||s===1)||y===1&&(s===3||s===1&&dW(_.content)))?(l=!0,t[h]=null):_.content=" "}else r&&(_.content=Ek(_.content))}return l?t.filter(Boolean):t}function hW(t){for(let e=0;e<t.length;e++)if(!Lo(t.charCodeAt(e)))return!1;return!0}function dW(t){for(let e=0;e<t.length;e++){const r=t.charCodeAt(e);if(r===10||r===13)return!0}return!1}function Ek(t){let e="",r=!1;for(let l=0;l<t.length;l++)Lo(t.charCodeAt(l))?r||(e+=" ",r=!0):(e+=t[l],r=!1);return e}function vE(t){(ms[0]||R_).children.push(t)}function zs(t,e){return{start:Cs.getPos(t),end:e==null?e:Cs.getPos(e),source:e==null?e:yr(t,e)}}function fW(t){return zs(t.start.offset,t.end.offset)}function Jh(t,e){t.end=Cs.getPos(e),t.source=yr(t.start.offset,e)}function pW(t){const e={type:6,name:t.rawName,nameLoc:zs(t.loc.start.offset,t.loc.start.offset+t.rawName.length),value:void 0,loc:t.loc};if(t.exp){const r=t.exp.loc;r.end.offset<t.loc.end.offset&&(r.start.offset--,r.start.column--,r.end.offset++,r.end.column++),e.value={type:2,content:t.exp.content,loc:r}}return e}function Gv(t,e=!1,r,l=0,h=0){return cn(t,e,r,l)}function Bl(t,e,r){Bn.onError(gs(t,zs(e,e)))}function mW(){Cs.reset(),Cr=null,Pn=null,fo="",Vl=-1,Gh=-1,ms.length=0}function gW(t,e){if(mW(),ic=t,Bn=wn({},bk),e){let h;for(h in e)e[h]!=null&&(Bn[h]=e[h])}Cs.mode=Bn.parseMode==="html"?1:Bn.parseMode==="sfc"?2:0,Cs.inXML=Bn.ns===1||Bn.ns===2;const r=e&&e.delimiters;r&&(Cs.delimiterOpen=Cx(r[0]),Cs.delimiterClose=Cx(r[1]));const l=R_=Uq([],t);return Cs.parse(ic),l.loc=zs(0,t.length),l.children=Tk(l.children),R_=null,l}function _W(t,e){qv(t,void 0,e,Sk(t,t.children[0]))}function Sk(t,e){const{children:r}=t;return r.length===1&&e.type===1&&!Dx(e)}function qv(t,e,r,l=!1,h=!1){const{children:_}=t,y=[];for(let k=0;k<_.length;k++){const j=_[k];if(j.type===1&&j.tagType===0){const Z=l?0:ko(j,r);if(Z>0){if(Z>=2){j.codegenNode.patchFlag=-1,y.push(j);continue}}else{const Y=j.codegenNode;if(Y.type===13){const se=Y.patchFlag;if((se===void 0||se===512||se===1)&&Mk(j,r)>=2){const ne=Ik(j);ne&&(Y.props=r.hoist(ne))}Y.dynamicProps&&(Y.dynamicProps=r.hoist(Y.dynamicProps))}}}else if(j.type===12&&(l?0:ko(j,r))>=2){y.push(j);continue}if(j.type===1){const Z=j.tagType===1;Z&&r.scopes.vSlot++,qv(j,t,r,!1,h),Z&&r.scopes.vSlot--}else if(j.type===11)qv(j,t,r,j.children.length===1,!0);else if(j.type===9)for(let Z=0;Z<j.branches.length;Z++)qv(j.branches[Z],t,r,j.branches[Z].children.length===1,h)}let s=!1;if(y.length===_.length&&t.type===1){if(t.tagType===0&&t.codegenNode&&t.codegenNode.type===13&&yi(t.codegenNode.children))t.codegenNode.children=I(sd(t.codegenNode.children)),s=!0;else if(t.tagType===1&&t.codegenNode&&t.codegenNode.type===13&&t.codegenNode.children&&!yi(t.codegenNode.children)&&t.codegenNode.children.type===15){const k=O(t.codegenNode,"default");k&&(k.returns=I(sd(k.returns)),s=!0)}else if(t.tagType===3&&e&&e.type===1&&e.tagType===1&&e.codegenNode&&e.codegenNode.type===13&&e.codegenNode.children&&!yi(e.codegenNode.children)&&e.codegenNode.children.type===15){const k=ta(t,"slot",!0),j=k&&k.arg&&O(e.codegenNode,k.arg);j&&(j.returns=I(sd(j.returns)),s=!0)}}if(!s)for(const k of y)k.codegenNode=r.cache(k.codegenNode);function I(k){const j=r.cache(k);return h&&r.hmr&&(j.needArraySpread=!0),j}function O(k,j){if(k.children&&!yi(k.children)&&k.children.type===15){const Z=k.children.properties.find(Y=>Y.key===j||Y.key.content===j);return Z&&Z.value}}y.length&&r.transformHoist&&r.transformHoist(_,r,t)}function ko(t,e){const{constantCache:r}=e;switch(t.type){case 1:if(t.tagType!==0)return 0;const l=r.get(t);if(l!==void 0)return l;const h=t.codegenNode;if(h.type!==13||h.isBlock&&t.tag!=="svg"&&t.tag!=="foreignObject"&&t.tag!=="math")return 0;if(h.patchFlag===void 0){let y=3;const s=Mk(t,e);if(s===0)return r.set(t,0),0;s<y&&(y=s);for(let I=0;I<t.children.length;I++){const O=ko(t.children[I],e);if(O===0)return r.set(t,0),0;O<y&&(y=O)}if(y>1)for(let I=0;I<t.props.length;I++){const O=t.props[I];if(O.type===7&&O.name==="bind"&&O.exp){const k=ko(O.exp,e);if(k===0)return r.set(t,0),0;k<y&&(y=k)}}if(h.isBlock){for(let I=0;I<t.props.length;I++)if(t.props[I].type===7)return r.set(t,0),0;e.removeHelper(fd),e.removeHelper(vp(e.inSSR,h.isComponent)),h.isBlock=!1,e.helper(yp(e.inSSR,h.isComponent))}return r.set(t,y),y}else return r.set(t,0),0;case 2:case 3:return 3;case 9:case 11:case 10:return 0;case 5:case 12:return ko(t.content,e);case 4:return t.constType;case 8:let _=3;for(let y=0;y<t.children.length;y++){const s=t.children[y];if(sn(s)||xo(s))continue;const I=ko(s,e);if(I===0)return 0;I<_&&(_=I)}return _;case 20:return 2;default:return 0}}const yW=new Set([XS,YS,I_,ty]);function Ak(t,e){if(t.type===14&&!sn(t.callee)&&yW.has(t.callee)){const r=t.arguments[0];if(r.type===4)return ko(r,e);if(r.type===14)return Ak(r,e)}return 0}function Mk(t,e){let r=3;const l=Ik(t);if(l&&l.type===15){const{properties:h}=l;for(let _=0;_<h.length;_++){const{key:y,value:s}=h[_],I=ko(y,e);if(I===0)return I;I<r&&(r=I);let O;if(s.type===4?O=ko(s,e):s.type===14?O=Ak(s,e):O=0,O===0)return O;O<r&&(r=O)}}return r}function Ik(t){const e=t.codegenNode;if(e.type===13)return e.props}function vW(t,{filename:e="",prefixIdentifiers:r=!1,hoistStatic:l=!1,hmr:h=!1,cacheHandlers:_=!1,nodeTransforms:y=[],directiveTransforms:s={},transformHoist:I=null,isBuiltInComponent:O=hr,isCustomElement:k=hr,expressionPlugins:j=[],scopeId:Z=null,slotted:Y=!0,ssr:se=!1,inSSR:ne=!1,ssrCssVars:de="",bindingMetadata:me=xn,inline:Te=!1,isTS:ge=!1,onError:fe=t2,onWarn:Ae=gk,compatConfig:Ge}){const ze=e.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),Ke={filename:e,selfName:ze&&xd(cs(ze[1])),prefixIdentifiers:r,hoistStatic:l,hmr:h,cacheHandlers:_,nodeTransforms:y,directiveTransforms:s,transformHoist:I,isBuiltInComponent:O,isCustomElement:k,expressionPlugins:j,scopeId:Z,slotted:Y,ssr:se,inSSR:ne,ssrCssVars:de,bindingMetadata:me,inline:Te,isTS:ge,onError:fe,onWarn:Ae,compatConfig:Ge,root:t,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],cached:[],constantCache:new WeakMap,temps:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,grandParent:null,currentNode:t,childIndex:0,inVOnce:!1,helper(Xe){const Ue=Ke.helpers.get(Xe)||0;return Ke.helpers.set(Xe,Ue+1),Xe},removeHelper(Xe){const Ue=Ke.helpers.get(Xe);if(Ue){const et=Ue-1;et?Ke.helpers.set(Xe,et):Ke.helpers.delete(Xe)}},helperString(Xe){return`_${gp[Ke.helper(Xe)]}`},replaceNode(Xe){Ke.parent.children[Ke.childIndex]=Ke.currentNode=Xe},removeNode(Xe){const Ue=Ke.parent.children,et=Xe?Ue.indexOf(Xe):Ke.currentNode?Ke.childIndex:-1;!Xe||Xe===Ke.currentNode?(Ke.currentNode=null,Ke.onNodeRemoved()):Ke.childIndex>et&&(Ke.childIndex--,Ke.onNodeRemoved()),Ke.parent.children.splice(et,1)},onNodeRemoved:hr,addIdentifiers(Xe){},removeIdentifiers(Xe){},hoist(Xe){sn(Xe)&&(Xe=cn(Xe)),Ke.hoists.push(Xe);const Ue=cn(`_hoisted_${Ke.hoists.length}`,!1,Xe.loc,2);return Ue.hoisted=Xe,Ue},cache(Xe,Ue=!1,et=!1){const lt=jq(Ke.cached.length,Xe,Ue,et);return Ke.cached.push(lt),lt}};return Ke.filters=new Set,Ke}function xW(t,e){const r=vW(t,e);P1(t,r),e.hoistStatic&&_W(t,r),e.ssr||bW(t,r),t.helpers=new Set([...r.helpers.keys()]),t.components=[...r.components],t.directives=[...r.directives],t.imports=r.imports,t.hoists=r.hoists,t.temps=r.temps,t.cached=r.cached,t.transformed=!0,t.filters=[...r.filters]}function bW(t,e){const{helper:r}=e,{children:l}=t;if(l.length===1){const h=l[0];if(Sk(t,h)&&h.codegenNode){const _=h.codegenNode;_.type===13&&e2(_,e),t.codegenNode=_}else t.codegenNode=h}else if(l.length>1){let h=64;t.codegenNode=C_(e,r(M_),void 0,t.children,h,void 0,void 0,!0,void 0,!1)}}function wW(t,e){let r=0;const l=()=>{r--};for(;r<t.children.length;r++){const h=t.children[r];sn(h)||(e.grandParent=e.parent,e.parent=t,e.childIndex=r,e.onNodeRemoved=l,P1(h,e))}}function P1(t,e){e.currentNode=t;const{nodeTransforms:r}=e,l=[];for(let _=0;_<r.length;_++){const y=r[_](t,e);if(y&&(yi(y)?l.push(...y):l.push(y)),e.currentNode)t=e.currentNode;else return}switch(t.type){case 3:e.ssr||e.helper(ey);break;case 5:e.ssr||e.helper(I1);break;case 9:for(let _=0;_<t.branches.length;_++)P1(t.branches[_],e);break;case 10:case 11:case 1:case 0:wW(t,e);break}e.currentNode=t;let h=l.length;for(;h--;)l[h]()}function Ck(t,e){const r=sn(t)?l=>l===t:l=>t.test(l);return(l,h)=>{if(l.type===1){const{props:_}=l;if(l.tagType===3&&_.some(eW))return;const y=[];for(let s=0;s<_.length;s++){const I=_[s];if(I.type===7&&r(I.name)){_.splice(s,1),s--;const O=e(l,I,h);O&&y.push(O)}}return y}}}const D1="/*@__PURE__*/",Pk=t=>`${gp[t]}: _${gp[t]}`;function TW(t,{mode:e="function",prefixIdentifiers:r=e==="module",sourceMap:l=!1,filename:h="template.vue.html",scopeId:_=null,optimizeImports:y=!1,runtimeGlobalName:s="Vue",runtimeModuleName:I="vue",ssrRuntimeModuleName:O="vue/server-renderer",ssr:k=!1,isTS:j=!1,inSSR:Z=!1}){const Y={mode:e,prefixIdentifiers:r,sourceMap:l,filename:h,scopeId:_,optimizeImports:y,runtimeGlobalName:s,runtimeModuleName:I,ssrRuntimeModuleName:O,ssr:k,isTS:j,inSSR:Z,source:t.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper(ne){return`_${gp[ne]}`},push(ne,de=-2,me){Y.code+=ne},indent(){se(++Y.indentLevel)},deindent(ne=!1){ne?--Y.indentLevel:se(--Y.indentLevel)},newline(){se(Y.indentLevel)}};function se(ne){Y.push(`
`+"  ".repeat(ne),0)}return Y}function EW(t,e={}){const r=TW(t,e);e.onContextCreated&&e.onContextCreated(r);const{mode:l,push:h,prefixIdentifiers:_,indent:y,deindent:s,newline:I,scopeId:O,ssr:k}=r,j=Array.from(t.helpers),Z=j.length>0,Y=!_&&l!=="module";SW(t,r);const ne=k?"ssrRender":"render",me=(k?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ");if(h(`function ${ne}(${me}) {`),y(),Y&&(h("with (_ctx) {"),y(),Z&&(h(`const { ${j.map(Pk).join(", ")} } = _Vue
`,-1),I())),t.components.length&&(_T(t.components,"component",r),(t.directives.length||t.temps>0)&&I()),t.directives.length&&(_T(t.directives,"directive",r),t.temps>0&&I()),t.filters&&t.filters.length&&(I(),_T(t.filters,"filter",r),I()),t.temps>0){h("let ");for(let Te=0;Te<t.temps;Te++)h(`${Te>0?", ":""}_temp${Te}`)}return(t.components.length||t.directives.length||t.temps)&&(h(`
`,0),I()),k||h("return "),t.codegenNode?kr(t.codegenNode,r):h("null"),Y&&(s(),h("}")),s(),h("}"),{ast:t,code:r.code,preamble:"",map:r.map?r.map.toJSON():void 0}}function SW(t,e){const{ssr:r,prefixIdentifiers:l,push:h,newline:_,runtimeModuleName:y,runtimeGlobalName:s,ssrRuntimeModuleName:I}=e,O=s,k=Array.from(t.helpers);if(k.length>0&&(h(`const _Vue = ${O}
`,-1),t.hoists.length)){const j=[VS,US,ey,jS,dk].filter(Z=>k.includes(Z)).map(Pk).join(", ");h(`const { ${j} } = _Vue
`,-1)}AW(t.hoists,e),_(),h("return ")}function _T(t,e,{helper:r,push:l,newline:h,isTS:_}){const y=r(e==="filter"?qS:e==="component"?$S:GS);for(let s=0;s<t.length;s++){let I=t[s];const O=I.endsWith("__self");O&&(I=I.slice(0,-6)),l(`const ${D_(I,e)} = ${y}(${JSON.stringify(I)}${O?", true":""})${_?"!":""}`),s<t.length-1&&h()}}function AW(t,e){if(!t.length)return;e.pure=!0;const{push:r,newline:l}=e;l();for(let h=0;h<t.length;h++){const _=t[h];_&&(r(`const _hoisted_${h+1} = `),kr(_,e),l())}e.pure=!1}function s2(t,e){const r=t.length>3||!1;e.push("["),r&&e.indent(),iy(t,e,r),r&&e.deindent(),e.push("]")}function iy(t,e,r=!1,l=!0){const{push:h,newline:_}=e;for(let y=0;y<t.length;y++){const s=t[y];sn(s)?h(s,-3):yi(s)?s2(s,e):kr(s,e),y<t.length-1&&(r?(l&&h(","),_()):l&&h(", "))}}function kr(t,e){if(sn(t)){e.push(t,-3);return}if(xo(t)){e.push(e.helper(t));return}switch(t.type){case 1:case 9:case 11:kr(t.codegenNode,e);break;case 2:MW(t,e);break;case 4:Dk(t,e);break;case 5:IW(t,e);break;case 12:kr(t.codegenNode,e);break;case 8:Rk(t,e);break;case 3:PW(t,e);break;case 13:DW(t,e);break;case 14:LW(t,e);break;case 15:OW(t,e);break;case 17:kW(t,e);break;case 18:zW(t,e);break;case 19:FW(t,e);break;case 20:BW(t,e);break;case 21:iy(t.body,e,!0,!1);break}}function MW(t,e){e.push(JSON.stringify(t.content),-3,t)}function Dk(t,e){const{content:r,isStatic:l}=t;e.push(l?JSON.stringify(r):r,-3,t)}function IW(t,e){const{push:r,helper:l,pure:h}=e;h&&r(D1),r(`${l(I1)}(`),kr(t.content,e),r(")")}function Rk(t,e){for(let r=0;r<t.children.length;r++){const l=t.children[r];sn(l)?e.push(l,-3):kr(l,e)}}function CW(t,e){const{push:r}=e;if(t.type===8)r("["),Rk(t,e),r("]");else if(t.isStatic){const l=i2(t.content)?t.content:JSON.stringify(t.content);r(l,-2,t)}else r(`[${t.content}]`,-3,t)}function PW(t,e){const{push:r,helper:l,pure:h}=e;h&&r(D1),r(`${l(ey)}(${JSON.stringify(t.content)})`,-3,t)}function DW(t,e){const{push:r,helper:l,pure:h}=e,{tag:_,props:y,children:s,patchFlag:I,dynamicProps:O,directives:k,isBlock:j,disableTracking:Z,isComponent:Y}=t;let se;I&&(se=String(I)),k&&r(l(WS)+"("),j&&r(`(${l(fd)}(${Z?"true":""}), `),h&&r(D1);const ne=j?vp(e.inSSR,Y):yp(e.inSSR,Y);r(l(ne)+"(",-2,t),iy(RW([_,y,s,se,O]),e),r(")"),j&&r(")"),k&&(r(", "),kr(k,e),r(")"))}function RW(t){let e=t.length;for(;e--&&t[e]==null;);return t.slice(0,e+1).map(r=>r||"null")}function LW(t,e){const{push:r,helper:l,pure:h}=e,_=sn(t.callee)?t.callee:l(t.callee);h&&r(D1),r(_+"(",-2,t),iy(t.arguments,e),r(")")}function OW(t,e){const{push:r,indent:l,deindent:h,newline:_}=e,{properties:y}=t;if(!y.length){r("{}",-2,t);return}const s=y.length>1||!1;r(s?"{":"{ "),s&&l();for(let I=0;I<y.length;I++){const{key:O,value:k}=y[I];CW(O,e),r(": "),kr(k,e),I<y.length-1&&(r(","),_())}s&&h(),r(s?"}":" }")}function kW(t,e){s2(t.elements,e)}function zW(t,e){const{push:r,indent:l,deindent:h}=e,{params:_,returns:y,body:s,newline:I,isSlot:O}=t;O&&r(`_${gp[JS]}(`),r("(",-2,t),yi(_)?iy(_,e):_&&kr(_,e),r(") => "),(I||s)&&(r("{"),l()),y?(I&&r("return "),yi(y)?s2(y,e):kr(y,e)):s&&kr(s,e),(I||s)&&(h(),r("}")),O&&(t.isNonScopedSlot&&r(", undefined, true"),r(")"))}function FW(t,e){const{test:r,consequent:l,alternate:h,newline:_}=t,{push:y,indent:s,deindent:I,newline:O}=e;if(r.type===4){const j=!i2(r.content);j&&y("("),Dk(r,e),j&&y(")")}else y("("),kr(r,e),y(")");_&&s(),e.indentLevel++,_||y(" "),y("? "),kr(l,e),e.indentLevel--,_&&O(),_||y(" "),y(": ");const k=h.type===19;k||e.indentLevel++,kr(h,e),k||e.indentLevel--,_&&I(!0)}function BW(t,e){const{push:r,helper:l,indent:h,deindent:_,newline:y}=e,{needPauseTracking:s,needArraySpread:I}=t;I&&r("[...("),r(`_cache[${t.index}] || (`),s&&(h(),r(`${l(Ix)}(-1`),t.inVOnce&&r(", true"),r("),"),y(),r("(")),r(`_cache[${t.index}] = `),kr(t.value,e),s&&(r(`).cacheIndex = ${t.index},`),y(),r(`${l(Ix)}(1),`),y(),r(`_cache[${t.index}]`),_()),r(")"),I&&r(")]")}new RegExp("\\b"+"arguments,await,break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,let,new,return,super,switch,throw,try,var,void,while,with,yield".split(",").join("\\b|\\b")+"\\b");const NW=Ck(/^(if|else|else-if)$/,(t,e,r)=>VW(t,e,r,(l,h,_)=>{const y=r.parent.children;let s=y.indexOf(l),I=0;for(;s-->=0;){const O=y[s];O&&O.type===9&&(I+=O.branches.length)}return()=>{if(_)l.codegenNode=KP(h,I,r);else{const O=UW(l.codegenNode);O.alternate=KP(h,I+l.branches.length-1,r)}}}));function VW(t,e,r,l){if(e.name!=="else"&&(!e.exp||!e.exp.content.trim())){const h=e.exp?e.exp.loc:t.loc;r.onError(gs(28,e.loc)),e.exp=cn("true",!1,h)}if(e.name==="if"){const h=YP(t,e),_={type:9,loc:fW(t.loc),branches:[h]};if(r.replaceNode(_),l)return l(_,h,!0)}else{const h=r.parent.children;let _=h.indexOf(t);for(;_-->=-1;){const y=h[_];if(y&&y.type===3){r.removeNode(y);continue}if(y&&y.type===2&&!y.content.trim().length){r.removeNode(y);continue}if(y&&y.type===9){e.name==="else-if"&&y.branches[y.branches.length-1].condition===void 0&&r.onError(gs(30,t.loc)),r.removeNode();const s=YP(t,e);y.branches.push(s);const I=l&&l(y,s,!1);P1(s,r),I&&I(),r.currentNode=null}else r.onError(gs(30,t.loc));break}}}function YP(t,e){const r=t.tagType===3;return{type:10,loc:t.loc,condition:e.name==="else"?void 0:e.exp,children:r&&!ta(t,"for")?t.children:[t],userKey:C1(t,"key"),isTemplateIf:r}}function KP(t,e,r){return t.condition?_E(t.condition,JP(t,e,r),tr(r.helper(ey),['""',"true"])):JP(t,e,r)}function JP(t,e,r){const{helper:l}=r,h=Fs("key",cn(`${e}`,!1,jo,2)),{children:_}=t,y=_[0];if(_.length!==1||y.type!==1)if(_.length===1&&y.type===11){const I=y.codegenNode;return Rx(I,h,r),I}else{let I=64;return C_(r,l(M_),ia([h]),_,I,void 0,void 0,!0,!1,!1,t.loc)}else{const I=y.codegenNode,O=iW(I);return O.type===13&&e2(O,r),Rx(O,h,r),I}}function UW(t){for(;;)if(t.type===19)if(t.alternate.type===19)t=t.alternate;else return t;else t.type===20&&(t=t.value)}const jW=(t,e,r)=>{const{modifiers:l,loc:h}=t,_=t.arg;let{exp:y}=t;if(y&&y.type===4&&!y.content.trim()&&(y=void 0),!y){if(_.type!==4||!_.isStatic)return r.onError(gs(52,_.loc)),{props:[Fs(_,cn("",!0,h))]};Lk(t),y=t.exp}return _.type!==4?(_.children.unshift("("),_.children.push(') || ""')):_.isStatic||(_.content=`${_.content} || ""`),l.some(s=>s.content==="camel")&&(_.type===4?_.isStatic?_.content=cs(_.content):_.content=`${r.helperString(mE)}(${_.content})`:(_.children.unshift(`${r.helperString(mE)}(`),_.children.push(")"))),r.inSSR||(l.some(s=>s.content==="prop")&&QP(_,"."),l.some(s=>s.content==="attr")&&QP(_,"^")),{props:[Fs(_,y)]}},Lk=(t,e)=>{const r=t.arg,l=cs(r.content);t.exp=cn(l,!1,r.loc)},QP=(t,e)=>{t.type===4?t.isStatic?t.content=e+t.content:t.content=`\`${e}\${${t.content}}\``:(t.children.unshift(`'${e}' + (`),t.children.push(")"))},$W=Ck("for",(t,e,r)=>{const{helper:l,removeHelper:h}=r;return HW(t,e,r,_=>{const y=tr(l(ZS),[_.source]),s=Px(t),I=ta(t,"memo"),O=C1(t,"key",!1,!0);O&&O.type===7&&!O.exp&&Lk(O);let j=O&&(O.type===6?O.value?cn(O.value.content,!0):void 0:O.exp);const Z=O&&j?Fs("key",j):null,Y=_.source.type===4&&_.source.constType>0,se=Y?64:O?128:256;return _.codegenNode=C_(r,l(M_),void 0,y,se,void 0,void 0,!0,!Y,!1,t.loc),()=>{let ne;const{children:de}=_,me=de.length!==1||de[0].type!==1,Te=Dx(t)?t:s&&t.children.length===1&&Dx(t.children[0])?t.children[0]:null;if(Te?(ne=Te.codegenNode,s&&Z&&Rx(ne,Z,r)):me?ne=C_(r,l(M_),Z?ia([Z]):void 0,t.children,64,void 0,void 0,!0,void 0,!1):(ne=de[0].codegenNode,s&&Z&&Rx(ne,Z,r),ne.isBlock!==!Y&&(ne.isBlock?(h(fd),h(vp(r.inSSR,ne.isComponent))):h(yp(r.inSSR,ne.isComponent))),ne.isBlock=!Y,ne.isBlock?(l(fd),l(vp(r.inSSR,ne.isComponent))):l(yp(r.inSSR,ne.isComponent))),I){const ge=_p(xE(_.parseResult,[cn("_cached")]));ge.body=$q([Va(["const _memo = (",I.exp,")"]),Va(["if (_cached",...j?[" && _cached.key === ",j]:[],` && ${r.helperString(mk)}(_cached, _memo)) return _cached`]),Va(["const _item = ",ne]),cn("_item.memo = _memo"),cn("return _item")]),y.arguments.push(ge,cn("_cache"),cn(String(r.cached.length))),r.cached.push(null)}else y.arguments.push(_p(xE(_.parseResult),ne,!0))}})});function HW(t,e,r,l){if(!e.exp){r.onError(gs(31,e.loc));return}const h=e.forParseResult;if(!h){r.onError(gs(32,e.loc));return}Ok(h);const{addIdentifiers:_,removeIdentifiers:y,scopes:s}=r,{source:I,value:O,key:k,index:j}=h,Z={type:11,loc:e.loc,source:I,valueAlias:O,keyAlias:k,objectIndexAlias:j,parseResult:h,children:Px(t)?t.children:[t]};r.replaceNode(Z),s.vFor++;const Y=l&&l(Z);return()=>{s.vFor--,Y&&Y()}}function Ok(t,e){t.finalized||(t.finalized=!0)}function xE({value:t,key:e,index:r},l=[]){return GW([t,e,r,...l])}function GW(t){let e=t.length;for(;e--&&!t[e];);return t.slice(0,e+1).map((r,l)=>r||cn("_".repeat(l+1),!1))}const eD=cn("undefined",!1),qW=(t,e)=>{if(t.type===1&&(t.tagType===1||t.tagType===3)){const r=ta(t,"slot");if(r)return r.exp,e.scopes.vSlot++,()=>{e.scopes.vSlot--}}},WW=(t,e,r,l)=>_p(t,r,!1,!0,r.length?r[0].loc:l);function ZW(t,e,r=WW){e.helper(JS);const{children:l,loc:h}=t,_=[],y=[];let s=e.scopes.vSlot>0||e.scopes.vFor>0;const I=ta(t,"slot",!0);if(I){const{arg:de,exp:me}=I;de&&!vo(de)&&(s=!0),_.push(Fs(de||cn("default",!0),r(me,void 0,l,h)))}let O=!1,k=!1;const j=[],Z=new Set;let Y=0;for(let de=0;de<l.length;de++){const me=l[de];let Te;if(!Px(me)||!(Te=ta(me,"slot",!0))){me.type!==3&&j.push(me);continue}if(I){e.onError(gs(37,Te.loc));break}O=!0;const{children:ge,loc:fe}=me,{arg:Ae=cn("default",!0),exp:Ge,loc:ze}=Te;let Ke;vo(Ae)?Ke=Ae?Ae.content:"default":s=!0;const Xe=ta(me,"for"),Ue=r(Ge,Xe,ge,fe);let et,lt;if(et=ta(me,"if"))s=!0,y.push(_E(et.exp,fv(Ae,Ue,Y++),eD));else if(lt=ta(me,/^else(-if)?$/,!0)){let Mt=de,si;for(;Mt--&&(si=l[Mt],si.type===3););if(si&&Px(si)&&ta(si,/^(else-)?if$/)){let bt=y[y.length-1];for(;bt.alternate.type===19;)bt=bt.alternate;bt.alternate=lt.exp?_E(lt.exp,fv(Ae,Ue,Y++),eD):fv(Ae,Ue,Y++)}else e.onError(gs(30,lt.loc))}else if(Xe){s=!0;const Mt=Xe.forParseResult;Mt?(Ok(Mt),y.push(tr(e.helper(ZS),[Mt.source,_p(xE(Mt),fv(Ae,Ue),!0)]))):e.onError(gs(32,Xe.loc))}else{if(Ke){if(Z.has(Ke)){e.onError(gs(38,ze));continue}Z.add(Ke),Ke==="default"&&(k=!0)}_.push(Fs(Ae,Ue))}}if(!I){const de=(me,Te)=>{const ge=r(me,void 0,Te,h);return e.compatConfig&&(ge.isNonScopedSlot=!0),Fs("default",ge)};O?j.length&&j.some(me=>kk(me))&&(k?e.onError(gs(39,j[0].loc)):_.push(de(void 0,j))):_.push(de(void 0,l))}const se=s?2:Wv(t.children)?3:1;let ne=ia(_.concat(Fs("_",cn(se+"",!1))),h);return y.length&&(ne=tr(e.helper(pk),[ne,sd(y)])),{slots:ne,hasDynamicSlots:s}}function fv(t,e,r){const l=[Fs("name",t),Fs("fn",e)];return r!=null&&l.push(Fs("key",cn(String(r),!0))),ia(l)}function Wv(t){for(let e=0;e<t.length;e++){const r=t[e];switch(r.type){case 1:if(r.tagType===2||Wv(r.children))return!0;break;case 9:if(Wv(r.branches))return!0;break;case 10:case 11:if(Wv(r.children))return!0;break}}return!1}function kk(t){return t.type!==2&&t.type!==12?!0:t.type===2?!!t.content.trim():kk(t.content)}const zk=new WeakMap,XW=(t,e)=>function(){if(t=e.currentNode,!(t.type===1&&(t.tagType===0||t.tagType===1)))return;const{tag:l,props:h}=t,_=t.tagType===1;let y=_?YW(t,e):`"${l}"`;const s=$n(y)&&y.callee===HS;let I,O,k=0,j,Z,Y,se=s||y===l_||y===NS||!_&&(l==="svg"||l==="foreignObject"||l==="math");if(h.length>0){const ne=Fk(t,e,void 0,_,s);I=ne.props,k=ne.patchFlag,Z=ne.dynamicPropNames;const de=ne.directives;Y=de&&de.length?sd(de.map(me=>JW(me,e))):void 0,ne.shouldUseBlock&&(se=!0)}if(t.children.length>0)if(y===Ax&&(se=!0,k|=1024),_&&y!==l_&&y!==Ax){const{slots:de,hasDynamicSlots:me}=ZW(t,e);O=de,me&&(k|=1024)}else if(t.children.length===1&&y!==l_){const de=t.children[0],me=de.type,Te=me===5||me===8;Te&&ko(de,e)===0&&(k|=1),Te||me===2?O=de:O=t.children}else O=t.children;Z&&Z.length&&(j=QW(Z)),t.codegenNode=C_(e,y,I,O,k===0?void 0:k,j,Y,!!se,!1,_,t.loc)};function YW(t,e,r=!1){let{tag:l}=t;const h=bE(l),_=C1(t,"is",!1,!0);if(_)if(h||rd("COMPILER_IS_ON_ELEMENT",e)){let s;if(_.type===6?s=_.value&&cn(_.value.content,!0):(s=_.exp,s||(s=cn("is",!1,_.arg.loc))),s)return tr(e.helper(HS),[s])}else _.type===6&&_.value.content.startsWith("vue:")&&(l=_.value.content.slice(4));const y=_k(l)||e.isBuiltInComponent(l);return y?(r||e.helper(y),y):(e.helper($S),e.components.add(l),D_(l,"component"))}function Fk(t,e,r=t.props,l,h,_=!1){const{tag:y,loc:s,children:I}=t;let O=[];const k=[],j=[],Z=I.length>0;let Y=!1,se=0,ne=!1,de=!1,me=!1,Te=!1,ge=!1,fe=!1;const Ae=[],Ge=Ue=>{O.length&&(k.push(ia(tD(O),s)),O=[]),Ue&&k.push(Ue)},ze=()=>{e.scopes.vFor>0&&O.push(Fs(cn("ref_for",!0),cn("true")))},Ke=({key:Ue,value:et})=>{if(vo(Ue)){const lt=Ue.content,Mt=yd(lt);if(Mt&&(!l||h)&&lt.toLowerCase()!=="onclick"&&lt!=="onUpdate:modelValue"&&!wu(lt)&&(Te=!0),Mt&&wu(lt)&&(fe=!0),Mt&&et.type===14&&(et=et.arguments[0]),et.type===20||(et.type===4||et.type===8)&&ko(et,e)>0)return;lt==="ref"?ne=!0:lt==="class"?de=!0:lt==="style"?me=!0:lt!=="key"&&!Ae.includes(lt)&&Ae.push(lt),l&&(lt==="class"||lt==="style")&&!Ae.includes(lt)&&Ae.push(lt)}else ge=!0};for(let Ue=0;Ue<r.length;Ue++){const et=r[Ue];if(et.type===6){const{loc:lt,name:Mt,nameLoc:si,value:bt}=et;let Rt=!0;if(Mt==="ref"&&(ne=!0,ze()),Mt==="is"&&(bE(y)||bt&&bt.content.startsWith("vue:")||rd("COMPILER_IS_ON_ELEMENT",e)))continue;O.push(Fs(cn(Mt,!0,si),cn(bt?bt.content:"",Rt,bt?bt.loc:lt)))}else{const{name:lt,arg:Mt,exp:si,loc:bt,modifiers:Rt}=et,Kt=lt==="bind",ii=lt==="on";if(lt==="slot"){l||e.onError(gs(40,bt));continue}if(lt==="once"||lt==="memo"||lt==="is"||Kt&&Kh(Mt,"is")&&(bE(y)||rd("COMPILER_IS_ON_ELEMENT",e))||ii&&_)continue;if((Kt&&Kh(Mt,"key")||ii&&Z&&Kh(Mt,"vue:before-update"))&&(Y=!0),Kt&&Kh(Mt,"ref")&&ze(),!Mt&&(Kt||ii)){if(ge=!0,si)if(Kt){if(ze(),Ge(),rd("COMPILER_V_BIND_OBJECT_ORDER",e)){k.unshift(si);continue}k.push(si)}else Ge({type:14,loc:bt,callee:e.helper(KS),arguments:l?[si]:[si,"true"]});else e.onError(gs(Kt?34:35,bt));continue}Kt&&Rt.some(gn=>gn.content==="prop")&&(se|=32);const qt=e.directiveTransforms[lt];if(qt){const{props:gn,needRuntime:Hn}=qt(et,t,e);!_&&gn.forEach(Ke),ii&&Mt&&!vo(Mt)?Ge(ia(gn,s)):O.push(...gn),Hn&&(j.push(et),xo(Hn)&&zk.set(et,Hn))}else Z8(lt)||(j.push(et),Z&&(Y=!0))}}let Xe;if(k.length?(Ge(),k.length>1?Xe=tr(e.helper(Mx),k,s):Xe=k[0]):O.length&&(Xe=ia(tD(O),s)),ge?se|=16:(de&&!l&&(se|=2),me&&!l&&(se|=4),Ae.length&&(se|=8),Te&&(se|=32)),!Y&&(se===0||se===32)&&(ne||fe||j.length>0)&&(se|=512),!e.inSSR&&Xe)switch(Xe.type){case 15:let Ue=-1,et=-1,lt=!1;for(let bt=0;bt<Xe.properties.length;bt++){const Rt=Xe.properties[bt].key;vo(Rt)?Rt.content==="class"?Ue=bt:Rt.content==="style"&&(et=bt):Rt.isHandlerKey||(lt=!0)}const Mt=Xe.properties[Ue],si=Xe.properties[et];lt?Xe=tr(e.helper(I_),[Xe]):(Mt&&!vo(Mt.value)&&(Mt.value=tr(e.helper(XS),[Mt.value])),si&&(me||si.value.type===4&&si.value.content.trim()[0]==="["||si.value.type===17)&&(si.value=tr(e.helper(YS),[si.value])));break;case 14:break;default:Xe=tr(e.helper(I_),[tr(e.helper(ty),[Xe])]);break}return{props:Xe,directives:j,patchFlag:se,dynamicPropNames:Ae,shouldUseBlock:Y}}function tD(t){const e=new Map,r=[];for(let l=0;l<t.length;l++){const h=t[l];if(h.key.type===8||!h.key.isStatic){r.push(h);continue}const _=h.key.content,y=e.get(_);y?(_==="style"||_==="class"||yd(_))&&KW(y,h):(e.set(_,h),r.push(h))}return r}function KW(t,e){t.value.type===17?t.value.elements.push(e.value):t.value=sd([t.value,e.value],t.loc)}function JW(t,e){const r=[],l=zk.get(t);l?r.push(e.helperString(l)):(e.helper(GS),e.directives.add(t.name),r.push(D_(t.name,"directive")));const{loc:h}=t;if(t.exp&&r.push(t.exp),t.arg&&(t.exp||r.push("void 0"),r.push(t.arg)),Object.keys(t.modifiers).length){t.arg||(t.exp||r.push("void 0"),r.push("void 0"));const _=cn("true",!1,h);r.push(ia(t.modifiers.map(y=>Fs(y,_)),h))}return sd(r,t.loc)}function QW(t){let e="[";for(let r=0,l=t.length;r<l;r++)e+=JSON.stringify(t[r]),r<l-1&&(e+=", ");return e+"]"}function bE(t){return t==="component"||t==="Component"}const e7=(t,e)=>{if(Dx(t)){const{children:r,loc:l}=t,{slotName:h,slotProps:_}=t7(t,e),y=[e.prefixIdentifiers?"_ctx.$slots":"$slots",h,"{}","undefined","true"];let s=2;_&&(y[2]=_,s=3),r.length&&(y[3]=_p([],r,!1,!1,l),s=4),e.scopeId&&!e.slotted&&(s=5),y.splice(s),t.codegenNode=tr(e.helper(fk),y,l)}};function t7(t,e){let r='"default"',l;const h=[];for(let _=0;_<t.props.length;_++){const y=t.props[_];if(y.type===6)y.value&&(y.name==="name"?r=JSON.stringify(y.value.content):(y.name=cs(y.name),h.push(y)));else if(y.name==="bind"&&Kh(y.arg,"name")){if(y.exp)r=y.exp;else if(y.arg&&y.arg.type===4){const s=cs(y.arg.content);r=y.exp=cn(s,!1,y.arg.loc)}}else y.name==="bind"&&y.arg&&vo(y.arg)&&(y.arg.content=cs(y.arg.content)),h.push(y)}if(h.length>0){const{props:_,directives:y}=Fk(t,e,h,!1,!1);l=_,y.length&&e.onError(gs(36,y[0].loc))}return{slotName:r,slotProps:l}}const Bk=(t,e,r,l)=>{const{loc:h,modifiers:_,arg:y}=t;!t.exp&&!_.length&&r.onError(gs(35,h));let s;if(y.type===4)if(y.isStatic){let j=y.content;j.startsWith("vue:")&&(j=`vnode-${j.slice(4)}`);const Z=e.tagType!==0||j.startsWith("vnode")||!/[A-Z]/.test(j)?Qf(cs(j)):`on:${j}`;s=cn(Z,!0,y.loc)}else s=Va([`${r.helperString(gE)}(`,y,")"]);else s=y,s.children.unshift(`${r.helperString(gE)}(`),s.children.push(")");let I=t.exp;I&&!I.content.trim()&&(I=void 0);let O=r.cacheHandlers&&!I&&!r.inVOnce;if(I){const j=vk(I),Z=!(j||Jq(I)),Y=I.content.includes(";");(Z||O&&j)&&(I=Va([`${Z?"$event":"(...args)"} => ${Y?"{":"("}`,I,Y?"}":")"]))}let k={props:[Fs(s,I||cn("() => {}",!1,h))]};return l&&(k=l(k)),O&&(k.props[0].value=r.cache(k.props[0].value)),k.props.forEach(j=>j.key.isHandlerKey=!0),k},i7=(t,e)=>{if(t.type===0||t.type===1||t.type===11||t.type===10)return()=>{const r=t.children;let l,h=!1;for(let _=0;_<r.length;_++){const y=r[_];if(gT(y)){h=!0;for(let s=_+1;s<r.length;s++){const I=r[s];if(gT(I))l||(l=r[_]=Va([y],y.loc)),l.children.push(" + ",I),r.splice(s,1),s--;else{l=void 0;break}}}}if(!(!h||r.length===1&&(t.type===0||t.type===1&&t.tagType===0&&!t.props.find(_=>_.type===7&&!e.directiveTransforms[_.name])&&t.tag!=="template")))for(let _=0;_<r.length;_++){const y=r[_];if(gT(y)||y.type===8){const s=[];(y.type!==2||y.content!==" ")&&s.push(y),!e.ssr&&ko(y,e)===0&&s.push("1"),r[_]={type:12,content:y,loc:y.loc,codegenNode:tr(e.helper(jS),s)}}}}},iD=new WeakSet,n7=(t,e)=>{if(t.type===1&&ta(t,"once",!0))return iD.has(t)||e.inVOnce||e.inSSR?void 0:(iD.add(t),e.inVOnce=!0,e.helper(Ix),()=>{e.inVOnce=!1;const r=e.currentNode;r.codegenNode&&(r.codegenNode=e.cache(r.codegenNode,!0,!0))})},Nk=(t,e,r)=>{const{exp:l,arg:h}=t;if(!l)return r.onError(gs(41,t.loc)),pv();const _=l.loc.source.trim(),y=l.type===4?l.content:_,s=r.bindingMetadata[_];if(s==="props"||s==="props-aliased")return r.onError(gs(44,l.loc)),pv();const I=!1;if(!y.trim()||!vk(l)&&!I)return r.onError(gs(42,l.loc)),pv();const O=h||cn("modelValue",!0),k=h?vo(h)?`onUpdate:${cs(h.content)}`:Va(['"onUpdate:" + ',h]):"onUpdate:modelValue";let j;const Z=r.isTS?"($event: any)":"$event";j=Va([`${Z} => ((`,l,") = $event)"]);const Y=[Fs(O,t.exp),Fs(k,j)];if(t.modifiers.length&&e.tagType===1){const se=t.modifiers.map(de=>de.content).map(de=>(i2(de)?de:JSON.stringify(de))+": true").join(", "),ne=h?vo(h)?`${h.content}Modifiers`:Va([h,' + "Modifiers"']):"modelModifiers";Y.push(Fs(ne,cn(`{ ${se} }`,!1,t.loc,2)))}return pv(Y)};function pv(t=[]){return{props:t}}const s7=/[\w).+\-_$\]]/,r7=(t,e)=>{rd("COMPILER_FILTERS",e)&&(t.type===5?Lx(t.content,e):t.type===1&&t.props.forEach(r=>{r.type===7&&r.name!=="for"&&r.exp&&Lx(r.exp,e)}))};function Lx(t,e){if(t.type===4)nD(t,e);else for(let r=0;r<t.children.length;r++){const l=t.children[r];typeof l=="object"&&(l.type===4?nD(l,e):l.type===8?Lx(t,e):l.type===5&&Lx(l.content,e))}}function nD(t,e){const r=t.content;let l=!1,h=!1,_=!1,y=!1,s=0,I=0,O=0,k=0,j,Z,Y,se,ne=[];for(Y=0;Y<r.length;Y++)if(Z=j,j=r.charCodeAt(Y),l)j===39&&Z!==92&&(l=!1);else if(h)j===34&&Z!==92&&(h=!1);else if(_)j===96&&Z!==92&&(_=!1);else if(y)j===47&&Z!==92&&(y=!1);else if(j===124&&r.charCodeAt(Y+1)!==124&&r.charCodeAt(Y-1)!==124&&!s&&!I&&!O)se===void 0?(k=Y+1,se=r.slice(0,Y).trim()):de();else{switch(j){case 34:h=!0;break;case 39:l=!0;break;case 96:_=!0;break;case 40:O++;break;case 41:O--;break;case 91:I++;break;case 93:I--;break;case 123:s++;break;case 125:s--;break}if(j===47){let me=Y-1,Te;for(;me>=0&&(Te=r.charAt(me),Te===" ");me--);(!Te||!s7.test(Te))&&(y=!0)}}se===void 0?se=r.slice(0,Y).trim():k!==0&&de();function de(){ne.push(r.slice(k,Y).trim()),k=Y+1}if(ne.length){for(Y=0;Y<ne.length;Y++)se=o7(se,ne[Y],e);t.content=se,t.ast=void 0}}function o7(t,e,r){r.helper(qS);const l=e.indexOf("(");if(l<0)return r.filters.add(e),`${D_(e,"filter")}(${t})`;{const h=e.slice(0,l),_=e.slice(l+1);return r.filters.add(h),`${D_(h,"filter")}(${t}${_!==")"?","+_:_}`}}const sD=new WeakSet,a7=(t,e)=>{if(t.type===1){const r=ta(t,"memo");return!r||sD.has(t)?void 0:(sD.add(t),()=>{const l=t.codegenNode||e.currentNode.codegenNode;l&&l.type===13&&(t.tagType!==1&&e2(l,e),t.codegenNode=tr(e.helper(QS),[r.exp,_p(void 0,l),"_cache",String(e.cached.length)]),e.cached.push(null))})}};function l7(t){return[[n7,NW,a7,$W,r7,e7,XW,qW,i7],{on:Bk,bind:jW,model:Nk}]}function c7(t,e={}){const r=e.onError||t2,l=e.mode==="module";e.prefixIdentifiers===!0?r(gs(47)):l&&r(gs(48));const h=!1;e.cacheHandlers&&r(gs(49)),e.scopeId&&!l&&r(gs(50));const _=wn({},e,{prefixIdentifiers:h}),y=sn(t)?gW(t,_):t,[s,I]=l7();return xW(y,wn({},_,{nodeTransforms:[...s,...e.nodeTransforms||[]],directiveTransforms:wn({},I,e.directiveTransforms||{})})),EW(y,_)}const u7=()=>({props:[]});/**
* @vue/compiler-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Vk=Symbol(""),Uk=Symbol(""),jk=Symbol(""),$k=Symbol(""),wE=Symbol(""),Hk=Symbol(""),Gk=Symbol(""),qk=Symbol(""),Wk=Symbol(""),Zk=Symbol("");Vq({[Vk]:"vModelRadio",[Uk]:"vModelCheckbox",[jk]:"vModelText",[$k]:"vModelSelect",[wE]:"vModelDynamic",[Hk]:"withModifiers",[Gk]:"withKeys",[qk]:"vShow",[Wk]:"Transition",[Zk]:"TransitionGroup"});let Uf;function h7(t,e=!1){return Uf||(Uf=document.createElement("div")),e?(Uf.innerHTML=`<div foo="${t.replace(/"/g,"&quot;")}">`,Uf.children[0].getAttribute("foo")):(Uf.innerHTML=t,Uf.textContent)}const d7={parseMode:"html",isVoidTag:h$,isNativeTag:t=>l$(t)||c$(t)||u$(t),isPreTag:t=>t==="pre",isIgnoreNewlineTag:t=>t==="pre"||t==="textarea",decodeEntities:h7,isBuiltInComponent:t=>{if(t==="Transition"||t==="transition")return Wk;if(t==="TransitionGroup"||t==="transition-group")return Zk},getNamespace(t,e,r){let l=e?e.ns:r;if(e&&l===2)if(e.tag==="annotation-xml"){if(t==="svg")return 1;e.props.some(h=>h.type===6&&h.name==="encoding"&&h.value!=null&&(h.value.content==="text/html"||h.value.content==="application/xhtml+xml"))&&(l=0)}else/^m(?:[ions]|text)$/.test(e.tag)&&t!=="mglyph"&&t!=="malignmark"&&(l=0);else e&&l===1&&(e.tag==="foreignObject"||e.tag==="desc"||e.tag==="title")&&(l=0);if(l===0){if(t==="svg")return 1;if(t==="math")return 2}return l}},f7=t=>{t.type===1&&t.props.forEach((e,r)=>{e.type===6&&e.name==="style"&&e.value&&(t.props[r]={type:7,name:"bind",arg:cn("style",!0,e.loc),exp:p7(e.value.content,e.loc),modifiers:[],loc:e.loc})})},p7=(t,e)=>{const r=sO(t);return cn(JSON.stringify(r),!1,e,3)};function Au(t,e){return gs(t,e)}const m7=(t,e,r)=>{const{exp:l,loc:h}=t;return l||r.onError(Au(53,h)),e.children.length&&(r.onError(Au(54,h)),e.children.length=0),{props:[Fs(cn("innerHTML",!0,h),l||cn("",!0))]}},g7=(t,e,r)=>{const{exp:l,loc:h}=t;return l||r.onError(Au(55,h)),e.children.length&&(r.onError(Au(56,h)),e.children.length=0),{props:[Fs(cn("textContent",!0),l?ko(l,r)>0?l:tr(r.helperString(I1),[l],h):cn("",!0))]}},_7=(t,e,r)=>{const l=Nk(t,e,r);if(!l.props.length||e.tagType===1)return l;t.arg&&r.onError(Au(58,t.arg.loc));const{tag:h}=e,_=r.isCustomElement(h);if(h==="input"||h==="textarea"||h==="select"||_){let y=jk,s=!1;if(h==="input"||_){const I=C1(e,"type");if(I){if(I.type===7)y=wE;else if(I.value)switch(I.value.content){case"radio":y=Vk;break;case"checkbox":y=Uk;break;case"file":s=!0,r.onError(Au(59,t.loc));break}}else Qq(e)&&(y=wE)}else h==="select"&&(y=$k);s||(l.needRuntime=r.helper(y))}else r.onError(Au(57,t.loc));return l.props=l.props.filter(y=>!(y.key.type===4&&y.key.content==="modelValue")),l},y7=Uo("passive,once,capture"),v7=Uo("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),x7=Uo("left,right"),Xk=Uo("onkeyup,onkeydown,onkeypress"),b7=(t,e,r,l)=>{const h=[],_=[],y=[];for(let s=0;s<e.length;s++){const I=e[s].content;I==="native"&&P_("COMPILER_V_ON_NATIVE",r)||y7(I)?y.push(I):x7(I)?vo(t)?Xk(t.content.toLowerCase())?h.push(I):_.push(I):(h.push(I),_.push(I)):v7(I)?_.push(I):h.push(I)}return{keyModifiers:h,nonKeyModifiers:_,eventOptionModifiers:y}},rD=(t,e)=>vo(t)&&t.content.toLowerCase()==="onclick"?cn(e,!0):t.type!==4?Va(["(",t,`) === "onClick" ? "${e}" : (`,t,")"]):t,w7=(t,e,r)=>Bk(t,e,r,l=>{const{modifiers:h}=t;if(!h.length)return l;let{key:_,value:y}=l.props[0];const{keyModifiers:s,nonKeyModifiers:I,eventOptionModifiers:O}=b7(_,h,r,t.loc);if(I.includes("right")&&(_=rD(_,"onContextmenu")),I.includes("middle")&&(_=rD(_,"onMouseup")),I.length&&(y=tr(r.helper(Hk),[y,JSON.stringify(I)])),s.length&&(!vo(_)||Xk(_.content.toLowerCase()))&&(y=tr(r.helper(Gk),[y,JSON.stringify(s)])),O.length){const k=O.map(xd).join("");_=vo(_)?cn(`${_.content}${k}`,!0):Va(["(",_,`) + "${k}"`])}return{props:[Fs(_,y)]}}),T7=(t,e,r)=>{const{exp:l,loc:h}=t;return l||r.onError(Au(61,h)),{props:[],needRuntime:r.helper(qk)}},E7=(t,e)=>{t.type===1&&t.tagType===0&&(t.tag==="script"||t.tag==="style")&&e.removeNode()},S7=[f7],A7={cloak:u7,html:m7,text:g7,model:_7,on:w7,show:T7};function M7(t,e={}){return c7(t,wn({},d7,e,{nodeTransforms:[E7,...S7,...e.nodeTransforms||[]],directiveTransforms:wn({},A7,e.directiveTransforms||{}),transformHoist:null}))}/**
* vue v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const oD=Object.create(null);function I7(t,e){if(!sn(t))if(t.nodeType)t=t.innerHTML;else return hr;const r=K8(t,e),l=oD[r];if(l)return l;if(t[0]==="#"){const s=document.querySelector(t);t=s?s.innerHTML:""}const h=wn({hoistStatic:!0,onError:void 0,onWarn:hr},e);!h.isCustomElement&&typeof customElements<"u"&&(h.isCustomElement=s=>!!customElements.get(s));const{code:_}=M7(t,h),y=new Function("Vue",_)(Oq);return y._rc=!0,oD[r]=y}L3(I7);const yl=(t,e)=>{const r=t.__vccOpts||t;for(const[l,h]of e)r[l]=h;return r},C7={mounted(){gsap.registerPlugin(ScrollTrigger),this.$el.querySelector(".slides");let t=gsap.utils.toArray(".slide"),e=r=>window.innerHeight/(window.innerHeight+r.offsetHeight);t.forEach((r,l)=>{let h=r.querySelector(".background"),_=r.querySelector(".content"),y=gsap.timeline({scrollTrigger:{trigger:r,start:()=>l?"top bottom":"top top",end:"bottom top",scrub:!0,invalidateOnRefresh:!0}});y.fromTo(h,{y:()=>l?-window.innerHeight*e(r):0},{y:()=>window.innerHeight*(1-e(r)),ease:"none"}),y.fromTo(_,{y:()=>l?window.innerHeight*-e(r)*2:0},{y:()=>window.innerHeight*e(r)*2,ease:"none"},0)})}};function P7(t,e,r,l,h,_){return Fi(),tn("main",null,e[0]||(e[0]=[A1('<section class="ends" data-v-7b377841>DESCUBRE SI SERÁS UN VERDADERO CAMPEÓN</section><section class="slides" data-v-7b377841><ul class="list" data-v-7b377841><li class="slide" data-v-7b377841><div class="background" style="background-image:url(&#39;image/juegos/mk1.jpg&#39;);" data-v-7b377841></div><div class="content" data-v-7b377841><div class="contentText" data-v-7b377841> ENTRA AL COMBATE, DEMUESTRA TU PODER </div></div><div class="overlay" data-v-7b377841></div></li><li class="slide" data-v-7b377841><div class="background" style="background-image:url(&#39;image/juegos/valorant.jpg&#39;);" data-v-7b377841></div><div class="content" data-v-7b377841><div class="contentText" data-v-7b377841> SOLO LOS MEJORES ALCANZAN LA GLORIA </div></div><div class="overlay" data-v-7b377841></div></li><li class="slide" data-v-7b377841><div class="background" style="background-image:url(&#39;image/juegos/cod6.png&#39;);" data-v-7b377841></div><div class="content" data-v-7b377841><div class="contentText" data-v-7b377841> JUEGA DURO, GANA CON HONOR </div></div><div class="overlay" data-v-7b377841></div></li><li class="slide" data-v-7b377841><div class="background" style="background-image:url(&#39;image/juegos/Hearthstone.jpg&#39;);" data-v-7b377841></div><div class="content" data-v-7b377841><div class="contentText" data-v-7b377841> CADA PARTIDA ES UNA NUEVA OPORTUNIDAD </div></div><div class="overlay" data-v-7b377841></div></li><li class="slide" data-v-7b377841><div class="background" style="background-image:url(&#39;image/juegos/mario.jpg&#39;);" data-v-7b377841></div><div class="content" data-v-7b377841><div class="contentText" data-v-7b377841> LA VICTORIA PERTENECE A LOS PERSEVERANTES </div></div><div class="overlay" data-v-7b377841></div></li><li class="slide" data-v-7b377841><div class="background" style="background-image:url(&#39;image/juegos/tft.jpg&#39;);" data-v-7b377841></div><div class="content" data-v-7b377841><div class="contentText" data-v-7b377841> ENTRENA, COMPITE, CONQUISTA </div></div><div class="overlay" data-v-7b377841></div></li></ul></section><section class="ends" data-v-7b377841>JUEGA AHORA Y PONTE EN LA CIMA</section>',3)]))}const D7=yl(C7,[["render",P7],["__scopeId","data-v-7b377841"]]);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function ny(t){return t+.5|0}const _u=(t,e,r)=>Math.max(Math.min(t,r),e);function Gg(t){return _u(ny(t*2.55),0,255)}function Mu(t){return _u(ny(t*255),0,255)}function Hl(t){return _u(ny(t/2.55)/100,0,1)}function aD(t){return _u(ny(t*100),0,100)}const ea={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},TE=[..."0123456789ABCDEF"],R7=t=>TE[t&15],L7=t=>TE[(t&240)>>4]+TE[t&15],mv=t=>(t&240)>>4===(t&15),O7=t=>mv(t.r)&&mv(t.g)&&mv(t.b)&&mv(t.a);function k7(t){var e=t.length,r;return t[0]==="#"&&(e===4||e===5?r={r:255&ea[t[1]]*17,g:255&ea[t[2]]*17,b:255&ea[t[3]]*17,a:e===5?ea[t[4]]*17:255}:(e===7||e===9)&&(r={r:ea[t[1]]<<4|ea[t[2]],g:ea[t[3]]<<4|ea[t[4]],b:ea[t[5]]<<4|ea[t[6]],a:e===9?ea[t[7]]<<4|ea[t[8]]:255})),r}const z7=(t,e)=>t<255?e(t):"";function F7(t){var e=O7(t)?R7:L7;return t?"#"+e(t.r)+e(t.g)+e(t.b)+z7(t.a,e):void 0}const B7=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Yk(t,e,r){const l=e*Math.min(r,1-r),h=(_,y=(_+t/30)%12)=>r-l*Math.max(Math.min(y-3,9-y,1),-1);return[h(0),h(8),h(4)]}function N7(t,e,r){const l=(h,_=(h+t/60)%6)=>r-r*e*Math.max(Math.min(_,4-_,1),0);return[l(5),l(3),l(1)]}function V7(t,e,r){const l=Yk(t,1,.5);let h;for(e+r>1&&(h=1/(e+r),e*=h,r*=h),h=0;h<3;h++)l[h]*=1-e-r,l[h]+=e;return l}function U7(t,e,r,l,h){return t===h?(e-r)/l+(e<r?6:0):e===h?(r-t)/l+2:(t-e)/l+4}function r2(t){const r=t.r/255,l=t.g/255,h=t.b/255,_=Math.max(r,l,h),y=Math.min(r,l,h),s=(_+y)/2;let I,O,k;return _!==y&&(k=_-y,O=s>.5?k/(2-_-y):k/(_+y),I=U7(r,l,h,k,_),I=I*60+.5),[I|0,O||0,s]}function o2(t,e,r,l){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,r,l)).map(Mu)}function a2(t,e,r){return o2(Yk,t,e,r)}function j7(t,e,r){return o2(V7,t,e,r)}function $7(t,e,r){return o2(N7,t,e,r)}function Kk(t){return(t%360+360)%360}function H7(t){const e=B7.exec(t);let r=255,l;if(!e)return;e[5]!==l&&(r=e[6]?Gg(+e[5]):Mu(+e[5]));const h=Kk(+e[2]),_=+e[3]/100,y=+e[4]/100;return e[1]==="hwb"?l=j7(h,_,y):e[1]==="hsv"?l=$7(h,_,y):l=a2(h,_,y),{r:l[0],g:l[1],b:l[2],a:r}}function G7(t,e){var r=r2(t);r[0]=Kk(r[0]+e),r=a2(r),t.r=r[0],t.g=r[1],t.b=r[2]}function q7(t){if(!t)return;const e=r2(t),r=e[0],l=aD(e[1]),h=aD(e[2]);return t.a<255?`hsla(${r}, ${l}%, ${h}%, ${Hl(t.a)})`:`hsl(${r}, ${l}%, ${h}%)`}const lD={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},cD={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function W7(){const t={},e=Object.keys(cD),r=Object.keys(lD);let l,h,_,y,s;for(l=0;l<e.length;l++){for(y=s=e[l],h=0;h<r.length;h++)_=r[h],s=s.replace(_,lD[_]);_=parseInt(cD[y],16),t[s]=[_>>16&255,_>>8&255,_&255]}return t}let gv;function Z7(t){gv||(gv=W7(),gv.transparent=[0,0,0,0]);const e=gv[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const X7=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Y7(t){const e=X7.exec(t);let r=255,l,h,_;if(e){if(e[7]!==l){const y=+e[7];r=e[8]?Gg(y):_u(y*255,0,255)}return l=+e[1],h=+e[3],_=+e[5],l=255&(e[2]?Gg(l):_u(l,0,255)),h=255&(e[4]?Gg(h):_u(h,0,255)),_=255&(e[6]?Gg(_):_u(_,0,255)),{r:l,g:h,b:_,a:r}}}function K7(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${Hl(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const yT=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,jf=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function J7(t,e,r){const l=jf(Hl(t.r)),h=jf(Hl(t.g)),_=jf(Hl(t.b));return{r:Mu(yT(l+r*(jf(Hl(e.r))-l))),g:Mu(yT(h+r*(jf(Hl(e.g))-h))),b:Mu(yT(_+r*(jf(Hl(e.b))-_))),a:t.a+r*(e.a-t.a)}}function _v(t,e,r){if(t){let l=r2(t);l[e]=Math.max(0,Math.min(l[e]+l[e]*r,e===0?360:1)),l=a2(l),t.r=l[0],t.g=l[1],t.b=l[2]}}function Jk(t,e){return t&&Object.assign(e||{},t)}function uD(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=Mu(t[3]))):(e=Jk(t,{r:0,g:0,b:0,a:1}),e.a=Mu(e.a)),e}function Q7(t){return t.charAt(0)==="r"?Y7(t):H7(t)}class L_{constructor(e){if(e instanceof L_)return e;const r=typeof e;let l;r==="object"?l=uD(e):r==="string"&&(l=k7(e)||Z7(e)||Q7(e)),this._rgb=l,this._valid=!!l}get valid(){return this._valid}get rgb(){var e=Jk(this._rgb);return e&&(e.a=Hl(e.a)),e}set rgb(e){this._rgb=uD(e)}rgbString(){return this._valid?K7(this._rgb):void 0}hexString(){return this._valid?F7(this._rgb):void 0}hslString(){return this._valid?q7(this._rgb):void 0}mix(e,r){if(e){const l=this.rgb,h=e.rgb;let _;const y=r===_?.5:r,s=2*y-1,I=l.a-h.a,O=((s*I===-1?s:(s+I)/(1+s*I))+1)/2;_=1-O,l.r=255&O*l.r+_*h.r+.5,l.g=255&O*l.g+_*h.g+.5,l.b=255&O*l.b+_*h.b+.5,l.a=y*l.a+(1-y)*h.a,this.rgb=l}return this}interpolate(e,r){return e&&(this._rgb=J7(this._rgb,e._rgb,r)),this}clone(){return new L_(this.rgb)}alpha(e){return this._rgb.a=Mu(e),this}clearer(e){const r=this._rgb;return r.a*=1-e,this}greyscale(){const e=this._rgb,r=ny(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=r,this}opaquer(e){const r=this._rgb;return r.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return _v(this._rgb,2,e),this}darken(e){return _v(this._rgb,2,-e),this}saturate(e){return _v(this._rgb,1,e),this}desaturate(e){return _v(this._rgb,1,-e),this}rotate(e){return G7(this._rgb,e),this}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Nl(){}const e9=(()=>{let t=0;return()=>t++})();function vn(t){return t==null}function as(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function bn(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function Ps(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function Do(t,e){return Ps(t)?t:e}function ln(t,e){return typeof t>"u"?e:t}const t9=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100:+t/e,Qk=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function ts(t,e,r){if(t&&typeof t.call=="function")return t.apply(r,e)}function jn(t,e,r,l){let h,_,y;if(as(t))if(_=t.length,l)for(h=_-1;h>=0;h--)e.call(r,t[h],h);else for(h=0;h<_;h++)e.call(r,t[h],h);else if(bn(t))for(y=Object.keys(t),_=y.length,h=0;h<_;h++)e.call(r,t[y[h]],y[h])}function Ox(t,e){let r,l,h,_;if(!t||!e||t.length!==e.length)return!1;for(r=0,l=t.length;r<l;++r)if(h=t[r],_=e[r],h.datasetIndex!==_.datasetIndex||h.index!==_.index)return!1;return!0}function kx(t){if(as(t))return t.map(kx);if(bn(t)){const e=Object.create(null),r=Object.keys(t),l=r.length;let h=0;for(;h<l;++h)e[r[h]]=kx(t[r[h]]);return e}return t}function ez(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function i9(t,e,r,l){if(!ez(t))return;const h=e[t],_=r[t];bn(h)&&bn(_)?O_(h,_,l):e[t]=kx(_)}function O_(t,e,r){const l=as(e)?e:[e],h=l.length;if(!bn(t))return t;r=r||{};const _=r.merger||i9;let y;for(let s=0;s<h;++s){if(y=l[s],!bn(y))continue;const I=Object.keys(y);for(let O=0,k=I.length;O<k;++O)_(I[O],t,y,r)}return t}function c_(t,e){return O_(t,e,{merger:n9})}function n9(t,e,r){if(!ez(t))return;const l=e[t],h=r[t];bn(l)&&bn(h)?c_(l,h):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=kx(h))}const hD={"":t=>t,x:t=>t.x,y:t=>t.y};function s9(t){const e=t.split("."),r=[];let l="";for(const h of e)l+=h,l.endsWith("\\")?l=l.slice(0,-1)+".":(r.push(l),l="");return r}function r9(t){const e=s9(t);return r=>{for(const l of e){if(l==="")break;r=r&&r[l]}return r}}function Ou(t,e){return(hD[e]||(hD[e]=r9(e)))(t)}function l2(t){return t.charAt(0).toUpperCase()+t.slice(1)}const k_=t=>typeof t<"u",ku=t=>typeof t=="function",dD=(t,e)=>{if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0};function o9(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}const us=Math.PI,ls=2*us,a9=ls+us,zx=Number.POSITIVE_INFINITY,l9=us/180,Bs=us/2,Uh=us/4,fD=us*2/3,yu=Math.log10,ml=Math.sign;function u_(t,e,r){return Math.abs(t-e)<r}function pD(t){const e=Math.round(t);t=u_(t,e,t/1e3)?e:t;const r=Math.pow(10,Math.floor(yu(t))),l=t/r;return(l<=1?1:l<=2?2:l<=5?5:10)*r}function c9(t){const e=[],r=Math.sqrt(t);let l;for(l=1;l<r;l++)t%l===0&&(e.push(l),e.push(t/l));return r===(r|0)&&e.push(r),e.sort((h,_)=>h-_).pop(),e}function u9(t){return typeof t=="symbol"||typeof t=="object"&&t!==null&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}function xp(t){return!u9(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function h9(t,e){const r=Math.round(t);return r-e<=t&&r+e>=t}function tz(t,e,r){let l,h,_;for(l=0,h=t.length;l<h;l++)_=t[l][r],isNaN(_)||(e.min=Math.min(e.min,_),e.max=Math.max(e.max,_))}function za(t){return t*(us/180)}function c2(t){return t*(180/us)}function mD(t){if(!Ps(t))return;let e=1,r=0;for(;Math.round(t*e)/e!==t;)e*=10,r++;return r}function iz(t,e){const r=e.x-t.x,l=e.y-t.y,h=Math.sqrt(r*r+l*l);let _=Math.atan2(l,r);return _<-.5*us&&(_+=ls),{angle:_,distance:h}}function EE(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function d9(t,e){return(t-e+a9)%ls-us}function Oo(t){return(t%ls+ls)%ls}function z_(t,e,r,l){const h=Oo(t),_=Oo(e),y=Oo(r),s=Oo(_-h),I=Oo(y-h),O=Oo(h-_),k=Oo(h-y);return h===_||h===y||l&&_===y||s>I&&O<k}function ur(t,e,r){return Math.max(e,Math.min(r,t))}function f9(t){return ur(t,-32768,32767)}function Yl(t,e,r,l=1e-6){return t>=Math.min(e,r)-l&&t<=Math.max(e,r)+l}function u2(t,e,r){r=r||(y=>t[y]<e);let l=t.length-1,h=0,_;for(;l-h>1;)_=h+l>>1,r(_)?h=_:l=_;return{lo:h,hi:l}}const Kl=(t,e,r,l)=>u2(t,r,l?h=>{const _=t[h][e];return _<r||_===r&&t[h+1][e]===r}:h=>t[h][e]<r),p9=(t,e,r)=>u2(t,r,l=>t[l][e]>=r);function m9(t,e,r){let l=0,h=t.length;for(;l<h&&t[l]<e;)l++;for(;h>l&&t[h-1]>r;)h--;return l>0||h<t.length?t.slice(l,h):t}const nz=["push","pop","shift","splice","unshift"];function g9(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),nz.forEach(r=>{const l="_onData"+l2(r),h=t[r];Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value(..._){const y=h.apply(this,_);return t._chartjs.listeners.forEach(s=>{typeof s[l]=="function"&&s[l](..._)}),y}})})}function gD(t,e){const r=t._chartjs;if(!r)return;const l=r.listeners,h=l.indexOf(e);h!==-1&&l.splice(h,1),!(l.length>0)&&(nz.forEach(_=>{delete t[_]}),delete t._chartjs)}function sz(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const rz=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function oz(t,e){let r=[],l=!1;return function(...h){r=h,l||(l=!0,rz.call(window,()=>{l=!1,t.apply(e,r)}))}}function _9(t,e){let r;return function(...l){return e?(clearTimeout(r),r=setTimeout(t,e,l)):t.apply(this,l),e}}const h2=t=>t==="start"?"left":t==="end"?"right":"center",Ir=(t,e,r)=>t==="start"?e:t==="end"?r:(e+r)/2,y9=(t,e,r,l)=>t===(l?"left":"right")?r:t==="center"?(e+r)/2:e;function az(t,e,r){const l=e.length;let h=0,_=l;if(t._sorted){const{iScale:y,vScale:s,_parsed:I}=t,O=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,k=y.axis,{min:j,max:Z,minDefined:Y,maxDefined:se}=y.getUserBounds();if(Y){if(h=Math.min(Kl(I,k,j).lo,r?l:Kl(e,k,y.getPixelForValue(j)).lo),O){const ne=I.slice(0,h+1).reverse().findIndex(de=>!vn(de[s.axis]));h-=Math.max(0,ne)}h=ur(h,0,l-1)}if(se){let ne=Math.max(Kl(I,y.axis,Z,!0).hi+1,r?0:Kl(e,k,y.getPixelForValue(Z),!0).hi+1);if(O){const de=I.slice(ne-1).findIndex(me=>!vn(me[s.axis]));ne+=Math.max(0,de)}_=ur(ne,h,l)-h}else _=l-h}return{start:h,count:_}}function lz(t){const{xScale:e,yScale:r,_scaleRanges:l}=t,h={xmin:e.min,xmax:e.max,ymin:r.min,ymax:r.max};if(!l)return t._scaleRanges=h,!0;const _=l.xmin!==e.min||l.xmax!==e.max||l.ymin!==r.min||l.ymax!==r.max;return Object.assign(l,h),_}const yv=t=>t===0||t===1,_D=(t,e,r)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*ls/r)),yD=(t,e,r)=>Math.pow(2,-10*t)*Math.sin((t-e)*ls/r)+1,h_={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*Bs)+1,easeOutSine:t=>Math.sin(t*Bs),easeInOutSine:t=>-.5*(Math.cos(us*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>yv(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>yv(t)?t:_D(t,.075,.3),easeOutElastic:t=>yv(t)?t:yD(t,.075,.3),easeInOutElastic(t){return yv(t)?t:t<.5?.5*_D(t*2,.1125,.45):.5+.5*yD(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-h_.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?h_.easeInBounce(t*2)*.5:h_.easeOutBounce(t*2-1)*.5+.5};function d2(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function vD(t){return d2(t)?t:new L_(t)}function vT(t){return d2(t)?t:new L_(t).saturate(.5).darken(.1).hexString()}const v9=["x","y","borderWidth","radius","tension"],x9=["color","borderColor","backgroundColor"];function b9(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:x9},numbers:{type:"number",properties:v9}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function w9(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const xD=new Map;function T9(t,e){e=e||{};const r=t+JSON.stringify(e);let l=xD.get(r);return l||(l=new Intl.NumberFormat(t,e),xD.set(r,l)),l}function sy(t,e,r){return T9(e,r).format(t)}const cz={values(t){return as(t)?t:""+t},numeric(t,e,r){if(t===0)return"0";const l=this.chart.options.locale;let h,_=t;if(r.length>1){const O=Math.max(Math.abs(r[0].value),Math.abs(r[r.length-1].value));(O<1e-4||O>1e15)&&(h="scientific"),_=E9(t,r)}const y=yu(Math.abs(_)),s=isNaN(y)?1:Math.max(Math.min(-1*Math.floor(y),20),0),I={notation:h,minimumFractionDigits:s,maximumFractionDigits:s};return Object.assign(I,this.options.ticks.format),sy(t,l,I)},logarithmic(t,e,r){if(t===0)return"0";const l=r[e].significand||t/Math.pow(10,Math.floor(yu(t)));return[1,2,3,5,10,15].includes(l)||e>.8*r.length?cz.numeric.call(this,t,e,r):""}};function E9(t,e){let r=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(r)>=1&&t!==Math.floor(t)&&(r=t-Math.floor(t)),r}var R1={formatters:cz};function S9(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,r)=>r.lineWidth,tickColor:(e,r)=>r.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:R1.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const pd=Object.create(null),SE=Object.create(null);function d_(t,e){if(!e)return t;const r=e.split(".");for(let l=0,h=r.length;l<h;++l){const _=r[l];t=t[_]||(t[_]=Object.create(null))}return t}function xT(t,e,r){return typeof e=="string"?O_(d_(t,e),r):O_(d_(t,""),e)}class A9{constructor(e,r){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=l=>l.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(l,h)=>vT(h.backgroundColor),this.hoverBorderColor=(l,h)=>vT(h.borderColor),this.hoverColor=(l,h)=>vT(h.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(r)}set(e,r){return xT(this,e,r)}get(e){return d_(this,e)}describe(e,r){return xT(SE,e,r)}override(e,r){return xT(pd,e,r)}route(e,r,l,h){const _=d_(this,e),y=d_(this,l),s="_"+r;Object.defineProperties(_,{[s]:{value:_[r],writable:!0},[r]:{enumerable:!0,get(){const I=this[s],O=y[h];return bn(I)?Object.assign({},O,I):ln(I,O)},set(I){this[s]=I}}})}apply(e){e.forEach(r=>r(this))}}var _s=new A9({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[b9,w9,S9]);function M9(t){return!t||vn(t.size)||vn(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function Fx(t,e,r,l,h){let _=e[h];return _||(_=e[h]=t.measureText(h).width,r.push(h)),_>l&&(l=_),l}function I9(t,e,r,l){l=l||{};let h=l.data=l.data||{},_=l.garbageCollect=l.garbageCollect||[];l.font!==e&&(h=l.data={},_=l.garbageCollect=[],l.font=e),t.save(),t.font=e;let y=0;const s=r.length;let I,O,k,j,Z;for(I=0;I<s;I++)if(j=r[I],j!=null&&!as(j))y=Fx(t,h,_,y,j);else if(as(j))for(O=0,k=j.length;O<k;O++)Z=j[O],Z!=null&&!as(Z)&&(y=Fx(t,h,_,y,Z));t.restore();const Y=_.length/2;if(Y>r.length){for(I=0;I<Y;I++)delete h[_[I]];_.splice(0,Y)}return y}function jh(t,e,r){const l=t.currentDevicePixelRatio,h=r!==0?Math.max(r/2,.5):0;return Math.round((e-h)*l)/l+h}function bD(t,e){!e&&!t||(e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function AE(t,e,r,l){uz(t,e,r,l,null)}function uz(t,e,r,l,h){let _,y,s,I,O,k,j,Z;const Y=e.pointStyle,se=e.rotation,ne=e.radius;let de=(se||0)*l9;if(Y&&typeof Y=="object"&&(_=Y.toString(),_==="[object HTMLImageElement]"||_==="[object HTMLCanvasElement]")){t.save(),t.translate(r,l),t.rotate(de),t.drawImage(Y,-Y.width/2,-Y.height/2,Y.width,Y.height),t.restore();return}if(!(isNaN(ne)||ne<=0)){switch(t.beginPath(),Y){default:h?t.ellipse(r,l,h/2,ne,0,0,ls):t.arc(r,l,ne,0,ls),t.closePath();break;case"triangle":k=h?h/2:ne,t.moveTo(r+Math.sin(de)*k,l-Math.cos(de)*ne),de+=fD,t.lineTo(r+Math.sin(de)*k,l-Math.cos(de)*ne),de+=fD,t.lineTo(r+Math.sin(de)*k,l-Math.cos(de)*ne),t.closePath();break;case"rectRounded":O=ne*.516,I=ne-O,y=Math.cos(de+Uh)*I,j=Math.cos(de+Uh)*(h?h/2-O:I),s=Math.sin(de+Uh)*I,Z=Math.sin(de+Uh)*(h?h/2-O:I),t.arc(r-j,l-s,O,de-us,de-Bs),t.arc(r+Z,l-y,O,de-Bs,de),t.arc(r+j,l+s,O,de,de+Bs),t.arc(r-Z,l+y,O,de+Bs,de+us),t.closePath();break;case"rect":if(!se){I=Math.SQRT1_2*ne,k=h?h/2:I,t.rect(r-k,l-I,2*k,2*I);break}de+=Uh;case"rectRot":j=Math.cos(de)*(h?h/2:ne),y=Math.cos(de)*ne,s=Math.sin(de)*ne,Z=Math.sin(de)*(h?h/2:ne),t.moveTo(r-j,l-s),t.lineTo(r+Z,l-y),t.lineTo(r+j,l+s),t.lineTo(r-Z,l+y),t.closePath();break;case"crossRot":de+=Uh;case"cross":j=Math.cos(de)*(h?h/2:ne),y=Math.cos(de)*ne,s=Math.sin(de)*ne,Z=Math.sin(de)*(h?h/2:ne),t.moveTo(r-j,l-s),t.lineTo(r+j,l+s),t.moveTo(r+Z,l-y),t.lineTo(r-Z,l+y);break;case"star":j=Math.cos(de)*(h?h/2:ne),y=Math.cos(de)*ne,s=Math.sin(de)*ne,Z=Math.sin(de)*(h?h/2:ne),t.moveTo(r-j,l-s),t.lineTo(r+j,l+s),t.moveTo(r+Z,l-y),t.lineTo(r-Z,l+y),de+=Uh,j=Math.cos(de)*(h?h/2:ne),y=Math.cos(de)*ne,s=Math.sin(de)*ne,Z=Math.sin(de)*(h?h/2:ne),t.moveTo(r-j,l-s),t.lineTo(r+j,l+s),t.moveTo(r+Z,l-y),t.lineTo(r-Z,l+y);break;case"line":y=h?h/2:Math.cos(de)*ne,s=Math.sin(de)*ne,t.moveTo(r-y,l-s),t.lineTo(r+y,l+s);break;case"dash":t.moveTo(r,l),t.lineTo(r+Math.cos(de)*(h?h/2:ne),l+Math.sin(de)*ne);break;case!1:t.closePath();break}t.fill(),e.borderWidth>0&&t.stroke()}}function Jl(t,e,r){return r=r||.5,!e||t&&t.x>e.left-r&&t.x<e.right+r&&t.y>e.top-r&&t.y<e.bottom+r}function L1(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function O1(t){t.restore()}function C9(t,e,r,l,h){if(!e)return t.lineTo(r.x,r.y);if(h==="middle"){const _=(e.x+r.x)/2;t.lineTo(_,e.y),t.lineTo(_,r.y)}else h==="after"!=!!l?t.lineTo(e.x,r.y):t.lineTo(r.x,e.y);t.lineTo(r.x,r.y)}function P9(t,e,r,l){if(!e)return t.lineTo(r.x,r.y);t.bezierCurveTo(l?e.cp1x:e.cp2x,l?e.cp1y:e.cp2y,l?r.cp2x:r.cp1x,l?r.cp2y:r.cp1y,r.x,r.y)}function D9(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),vn(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function R9(t,e,r,l,h){if(h.strikethrough||h.underline){const _=t.measureText(l),y=e-_.actualBoundingBoxLeft,s=e+_.actualBoundingBoxRight,I=r-_.actualBoundingBoxAscent,O=r+_.actualBoundingBoxDescent,k=h.strikethrough?(I+O)/2:O;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=h.decorationWidth||2,t.moveTo(y,k),t.lineTo(s,k),t.stroke()}}function L9(t,e){const r=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=r}function md(t,e,r,l,h,_={}){const y=as(e)?e:[e],s=_.strokeWidth>0&&_.strokeColor!=="";let I,O;for(t.save(),t.font=h.string,D9(t,_),I=0;I<y.length;++I)O=y[I],_.backdrop&&L9(t,_.backdrop),s&&(_.strokeColor&&(t.strokeStyle=_.strokeColor),vn(_.strokeWidth)||(t.lineWidth=_.strokeWidth),t.strokeText(O,r,l,_.maxWidth)),t.fillText(O,r,l,_.maxWidth),R9(t,r,l,O,_),l+=Number(h.lineHeight);t.restore()}function F_(t,e){const{x:r,y:l,w:h,h:_,radius:y}=e;t.arc(r+y.topLeft,l+y.topLeft,y.topLeft,1.5*us,us,!0),t.lineTo(r,l+_-y.bottomLeft),t.arc(r+y.bottomLeft,l+_-y.bottomLeft,y.bottomLeft,us,Bs,!0),t.lineTo(r+h-y.bottomRight,l+_),t.arc(r+h-y.bottomRight,l+_-y.bottomRight,y.bottomRight,Bs,0,!0),t.lineTo(r+h,l+y.topRight),t.arc(r+h-y.topRight,l+y.topRight,y.topRight,0,-Bs,!0),t.lineTo(r+y.topLeft,l)}const O9=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,k9=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function z9(t,e){const r=(""+t).match(O9);if(!r||r[1]==="normal")return e*1.2;switch(t=+r[2],r[3]){case"px":return t;case"%":t/=100;break}return e*t}const F9=t=>+t||0;function f2(t,e){const r={},l=bn(e),h=l?Object.keys(e):e,_=bn(t)?l?y=>ln(t[y],t[e[y]]):y=>t[y]:()=>t;for(const y of h)r[y]=F9(_(y));return r}function hz(t){return f2(t,{top:"y",right:"x",bottom:"y",left:"x"})}function od(t){return f2(t,["topLeft","topRight","bottomLeft","bottomRight"])}function zr(t){const e=hz(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function sr(t,e){t=t||{},e=e||_s.font;let r=ln(t.size,e.size);typeof r=="string"&&(r=parseInt(r,10));let l=ln(t.style,e.style);l&&!(""+l).match(k9)&&(console.warn('Invalid font style specified: "'+l+'"'),l=void 0);const h={family:ln(t.family,e.family),lineHeight:z9(ln(t.lineHeight,e.lineHeight),r),size:r,style:l,weight:ln(t.weight,e.weight),string:""};return h.string=M9(h),h}function qg(t,e,r,l){let h=!0,_,y,s;for(_=0,y=t.length;_<y;++_)if(s=t[_],s!==void 0&&(e!==void 0&&typeof s=="function"&&(s=s(e),h=!1),r!==void 0&&as(s)&&(s=s[r%s.length],h=!1),s!==void 0))return l&&!h&&(l.cacheable=!1),s}function B9(t,e,r){const{min:l,max:h}=t,_=Qk(e,(h-l)/2),y=(s,I)=>r&&s===0?0:s+I;return{min:y(l,-Math.abs(_)),max:y(h,_)}}function Uu(t,e){return Object.assign(Object.create(t),e)}function p2(t,e=[""],r,l,h=()=>t[0]){const _=r||t;typeof l>"u"&&(l=mz("_fallback",t));const y={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:_,_fallback:l,_getTarget:h,override:s=>p2([s,...t],e,_,l)};return new Proxy(y,{deleteProperty(s,I){return delete s[I],delete s._keys,delete t[0][I],!0},get(s,I){return fz(s,I,()=>q9(I,e,t,s))},getOwnPropertyDescriptor(s,I){return Reflect.getOwnPropertyDescriptor(s._scopes[0],I)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(s,I){return TD(s).includes(I)},ownKeys(s){return TD(s)},set(s,I,O){const k=s._storage||(s._storage=h());return s[I]=k[I]=O,delete s._keys,!0}})}function bp(t,e,r,l){const h={_cacheable:!1,_proxy:t,_context:e,_subProxy:r,_stack:new Set,_descriptors:dz(t,l),setContext:_=>bp(t,_,r,l),override:_=>bp(t.override(_),e,r,l)};return new Proxy(h,{deleteProperty(_,y){return delete _[y],delete t[y],!0},get(_,y,s){return fz(_,y,()=>V9(_,y,s))},getOwnPropertyDescriptor(_,y){return _._descriptors.allKeys?Reflect.has(t,y)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,y)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(_,y){return Reflect.has(t,y)},ownKeys(){return Reflect.ownKeys(t)},set(_,y,s){return t[y]=s,delete _[y],!0}})}function dz(t,e={scriptable:!0,indexable:!0}){const{_scriptable:r=e.scriptable,_indexable:l=e.indexable,_allKeys:h=e.allKeys}=t;return{allKeys:h,scriptable:r,indexable:l,isScriptable:ku(r)?r:()=>r,isIndexable:ku(l)?l:()=>l}}const N9=(t,e)=>t?t+l2(e):e,m2=(t,e)=>bn(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function fz(t,e,r){if(Object.prototype.hasOwnProperty.call(t,e)||e==="constructor")return t[e];const l=r();return t[e]=l,l}function V9(t,e,r){const{_proxy:l,_context:h,_subProxy:_,_descriptors:y}=t;let s=l[e];return ku(s)&&y.isScriptable(e)&&(s=U9(e,s,t,r)),as(s)&&s.length&&(s=j9(e,s,t,y.isIndexable)),m2(e,s)&&(s=bp(s,h,_&&_[e],y)),s}function U9(t,e,r,l){const{_proxy:h,_context:_,_subProxy:y,_stack:s}=r;if(s.has(t))throw new Error("Recursion detected: "+Array.from(s).join("->")+"->"+t);s.add(t);let I=e(_,y||l);return s.delete(t),m2(t,I)&&(I=g2(h._scopes,h,t,I)),I}function j9(t,e,r,l){const{_proxy:h,_context:_,_subProxy:y,_descriptors:s}=r;if(typeof _.index<"u"&&l(t))return e[_.index%e.length];if(bn(e[0])){const I=e,O=h._scopes.filter(k=>k!==I);e=[];for(const k of I){const j=g2(O,h,t,k);e.push(bp(j,_,y&&y[t],s))}}return e}function pz(t,e,r){return ku(t)?t(e,r):t}const $9=(t,e)=>t===!0?e:typeof t=="string"?Ou(e,t):void 0;function H9(t,e,r,l,h){for(const _ of e){const y=$9(r,_);if(y){t.add(y);const s=pz(y._fallback,r,h);if(typeof s<"u"&&s!==r&&s!==l)return s}else if(y===!1&&typeof l<"u"&&r!==l)return null}return!1}function g2(t,e,r,l){const h=e._rootScopes,_=pz(e._fallback,r,l),y=[...t,...h],s=new Set;s.add(l);let I=wD(s,y,r,_||r,l);return I===null||typeof _<"u"&&_!==r&&(I=wD(s,y,_,I,l),I===null)?!1:p2(Array.from(s),[""],h,_,()=>G9(e,r,l))}function wD(t,e,r,l,h){for(;r;)r=H9(t,e,r,l,h);return r}function G9(t,e,r){const l=t._getTarget();e in l||(l[e]={});const h=l[e];return as(h)&&bn(r)?r:h||{}}function q9(t,e,r,l){let h;for(const _ of e)if(h=mz(N9(_,t),r),typeof h<"u")return m2(t,h)?g2(r,l,t,h):h}function mz(t,e){for(const r of e){if(!r)continue;const l=r[t];if(typeof l<"u")return l}}function TD(t){let e=t._keys;return e||(e=t._keys=W9(t._scopes)),e}function W9(t){const e=new Set;for(const r of t)for(const l of Object.keys(r).filter(h=>!h.startsWith("_")))e.add(l);return Array.from(e)}function gz(t,e,r,l){const{iScale:h}=t,{key:_="r"}=this._parsing,y=new Array(l);let s,I,O,k;for(s=0,I=l;s<I;++s)O=s+r,k=e[O],y[s]={r:h.parse(Ou(k,_),O)};return y}const Z9=Number.EPSILON||1e-14,wp=(t,e)=>e<t.length&&!t[e].skip&&t[e],_z=t=>t==="x"?"y":"x";function X9(t,e,r,l){const h=t.skip?e:t,_=e,y=r.skip?e:r,s=EE(_,h),I=EE(y,_);let O=s/(s+I),k=I/(s+I);O=isNaN(O)?0:O,k=isNaN(k)?0:k;const j=l*O,Z=l*k;return{previous:{x:_.x-j*(y.x-h.x),y:_.y-j*(y.y-h.y)},next:{x:_.x+Z*(y.x-h.x),y:_.y+Z*(y.y-h.y)}}}function Y9(t,e,r){const l=t.length;let h,_,y,s,I,O=wp(t,0);for(let k=0;k<l-1;++k)if(I=O,O=wp(t,k+1),!(!I||!O)){if(u_(e[k],0,Z9)){r[k]=r[k+1]=0;continue}h=r[k]/e[k],_=r[k+1]/e[k],s=Math.pow(h,2)+Math.pow(_,2),!(s<=9)&&(y=3/Math.sqrt(s),r[k]=h*y*e[k],r[k+1]=_*y*e[k])}}function K9(t,e,r="x"){const l=_z(r),h=t.length;let _,y,s,I=wp(t,0);for(let O=0;O<h;++O){if(y=s,s=I,I=wp(t,O+1),!s)continue;const k=s[r],j=s[l];y&&(_=(k-y[r])/3,s[`cp1${r}`]=k-_,s[`cp1${l}`]=j-_*e[O]),I&&(_=(I[r]-k)/3,s[`cp2${r}`]=k+_,s[`cp2${l}`]=j+_*e[O])}}function J9(t,e="x"){const r=_z(e),l=t.length,h=Array(l).fill(0),_=Array(l);let y,s,I,O=wp(t,0);for(y=0;y<l;++y)if(s=I,I=O,O=wp(t,y+1),!!I){if(O){const k=O[e]-I[e];h[y]=k!==0?(O[r]-I[r])/k:0}_[y]=s?O?ml(h[y-1])!==ml(h[y])?0:(h[y-1]+h[y])/2:h[y-1]:h[y]}Y9(t,h,_),K9(t,_,e)}function vv(t,e,r){return Math.max(Math.min(t,r),e)}function Q9(t,e){let r,l,h,_,y,s=Jl(t[0],e);for(r=0,l=t.length;r<l;++r)y=_,_=s,s=r<l-1&&Jl(t[r+1],e),_&&(h=t[r],y&&(h.cp1x=vv(h.cp1x,e.left,e.right),h.cp1y=vv(h.cp1y,e.top,e.bottom)),s&&(h.cp2x=vv(h.cp2x,e.left,e.right),h.cp2y=vv(h.cp2y,e.top,e.bottom)))}function eZ(t,e,r,l,h){let _,y,s,I;if(e.spanGaps&&(t=t.filter(O=>!O.skip)),e.cubicInterpolationMode==="monotone")J9(t,h);else{let O=l?t[t.length-1]:t[0];for(_=0,y=t.length;_<y;++_)s=t[_],I=X9(O,s,t[Math.min(_+1,y-(l?0:1))%y],e.tension),s.cp1x=I.previous.x,s.cp1y=I.previous.y,s.cp2x=I.next.x,s.cp2y=I.next.y,O=s}e.capBezierPoints&&Q9(t,r)}function _2(){return typeof window<"u"&&typeof document<"u"}function y2(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function Bx(t,e,r){let l;return typeof t=="string"?(l=parseInt(t,10),t.indexOf("%")!==-1&&(l=l/100*e.parentNode[r])):l=t,l}const k1=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function tZ(t,e){return k1(t).getPropertyValue(e)}const iZ=["top","right","bottom","left"];function ad(t,e,r){const l={};r=r?"-"+r:"";for(let h=0;h<4;h++){const _=iZ[h];l[_]=parseFloat(t[e+"-"+_+r])||0}return l.width=l.left+l.right,l.height=l.top+l.bottom,l}const nZ=(t,e,r)=>(t>0||e>0)&&(!r||!r.shadowRoot);function sZ(t,e){const r=t.touches,l=r&&r.length?r[0]:t,{offsetX:h,offsetY:_}=l;let y=!1,s,I;if(nZ(h,_,t.target))s=h,I=_;else{const O=e.getBoundingClientRect();s=l.clientX-O.left,I=l.clientY-O.top,y=!0}return{x:s,y:I,box:y}}function qh(t,e){if("native"in t)return t;const{canvas:r,currentDevicePixelRatio:l}=e,h=k1(r),_=h.boxSizing==="border-box",y=ad(h,"padding"),s=ad(h,"border","width"),{x:I,y:O,box:k}=sZ(t,r),j=y.left+(k&&s.left),Z=y.top+(k&&s.top);let{width:Y,height:se}=e;return _&&(Y-=y.width+s.width,se-=y.height+s.height),{x:Math.round((I-j)/Y*r.width/l),y:Math.round((O-Z)/se*r.height/l)}}function rZ(t,e,r){let l,h;if(e===void 0||r===void 0){const _=t&&y2(t);if(!_)e=t.clientWidth,r=t.clientHeight;else{const y=_.getBoundingClientRect(),s=k1(_),I=ad(s,"border","width"),O=ad(s,"padding");e=y.width-O.width-I.width,r=y.height-O.height-I.height,l=Bx(s.maxWidth,_,"clientWidth"),h=Bx(s.maxHeight,_,"clientHeight")}}return{width:e,height:r,maxWidth:l||zx,maxHeight:h||zx}}const xv=t=>Math.round(t*10)/10;function oZ(t,e,r,l){const h=k1(t),_=ad(h,"margin"),y=Bx(h.maxWidth,t,"clientWidth")||zx,s=Bx(h.maxHeight,t,"clientHeight")||zx,I=rZ(t,e,r);let{width:O,height:k}=I;if(h.boxSizing==="content-box"){const Z=ad(h,"border","width"),Y=ad(h,"padding");O-=Y.width+Z.width,k-=Y.height+Z.height}return O=Math.max(0,O-_.width),k=Math.max(0,l?O/l:k-_.height),O=xv(Math.min(O,y,I.maxWidth)),k=xv(Math.min(k,s,I.maxHeight)),O&&!k&&(k=xv(O/2)),(e!==void 0||r!==void 0)&&l&&I.height&&k>I.height&&(k=I.height,O=xv(Math.floor(k*l))),{width:O,height:k}}function ED(t,e,r){const l=e||1,h=Math.floor(t.height*l),_=Math.floor(t.width*l);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const y=t.canvas;return y.style&&(r||!y.style.height&&!y.style.width)&&(y.style.height=`${t.height}px`,y.style.width=`${t.width}px`),t.currentDevicePixelRatio!==l||y.height!==h||y.width!==_?(t.currentDevicePixelRatio=l,y.height=h,y.width=_,t.ctx.setTransform(l,0,0,l,0,0),!0):!1}const aZ=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};_2()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return t}();function SD(t,e){const r=tZ(t,e),l=r&&r.match(/^(\d+)(\.\d+)?px$/);return l?+l[1]:void 0}function Wh(t,e,r,l){return{x:t.x+r*(e.x-t.x),y:t.y+r*(e.y-t.y)}}function lZ(t,e,r,l){return{x:t.x+r*(e.x-t.x),y:l==="middle"?r<.5?t.y:e.y:l==="after"?r<1?t.y:e.y:r>0?e.y:t.y}}function cZ(t,e,r,l){const h={x:t.cp2x,y:t.cp2y},_={x:e.cp1x,y:e.cp1y},y=Wh(t,h,r),s=Wh(h,_,r),I=Wh(_,e,r),O=Wh(y,s,r),k=Wh(s,I,r);return Wh(O,k,r)}const uZ=function(t,e){return{x(r){return t+t+e-r},setWidth(r){e=r},textAlign(r){return r==="center"?r:r==="right"?"left":"right"},xPlus(r,l){return r-l},leftForLtr(r,l){return r-l}}},hZ=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function sp(t,e,r){return t?uZ(e,r):hZ()}function yz(t,e){let r,l;(e==="ltr"||e==="rtl")&&(r=t.canvas.style,l=[r.getPropertyValue("direction"),r.getPropertyPriority("direction")],r.setProperty("direction",e,"important"),t.prevTextDirection=l)}function vz(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function xz(t){return t==="angle"?{between:z_,compare:d9,normalize:Oo}:{between:Yl,compare:(e,r)=>e-r,normalize:e=>e}}function AD({start:t,end:e,count:r,loop:l,style:h}){return{start:t%r,end:e%r,loop:l&&(e-t+1)%r===0,style:h}}function dZ(t,e,r){const{property:l,start:h,end:_}=r,{between:y,normalize:s}=xz(l),I=e.length;let{start:O,end:k,loop:j}=t,Z,Y;if(j){for(O+=I,k+=I,Z=0,Y=I;Z<Y&&y(s(e[O%I][l]),h,_);++Z)O--,k--;O%=I,k%=I}return k<O&&(k+=I),{start:O,end:k,loop:j,style:t.style}}function bz(t,e,r){if(!r)return[t];const{property:l,start:h,end:_}=r,y=e.length,{compare:s,between:I,normalize:O}=xz(l),{start:k,end:j,loop:Z,style:Y}=dZ(t,e,r),se=[];let ne=!1,de=null,me,Te,ge;const fe=()=>I(h,ge,me)&&s(h,ge)!==0,Ae=()=>s(_,me)===0||I(_,ge,me),Ge=()=>ne||fe(),ze=()=>!ne||Ae();for(let Ke=k,Xe=k;Ke<=j;++Ke)Te=e[Ke%y],!Te.skip&&(me=O(Te[l]),me!==ge&&(ne=I(me,h,_),de===null&&Ge()&&(de=s(me,h)===0?Ke:Xe),de!==null&&ze()&&(se.push(AD({start:de,end:Ke,loop:Z,count:y,style:Y})),de=null),Xe=Ke,ge=me));return de!==null&&se.push(AD({start:de,end:j,loop:Z,count:y,style:Y})),se}function wz(t,e){const r=[],l=t.segments;for(let h=0;h<l.length;h++){const _=bz(l[h],t.points,e);_.length&&r.push(..._)}return r}function fZ(t,e,r,l){let h=0,_=e-1;if(r&&!l)for(;h<e&&!t[h].skip;)h++;for(;h<e&&t[h].skip;)h++;for(h%=e,r&&(_+=h);_>h&&t[_%e].skip;)_--;return _%=e,{start:h,end:_}}function pZ(t,e,r,l){const h=t.length,_=[];let y=e,s=t[e],I;for(I=e+1;I<=r;++I){const O=t[I%h];O.skip||O.stop?s.skip||(l=!1,_.push({start:e%h,end:(I-1)%h,loop:l}),e=y=O.stop?I:null):(y=I,s.skip&&(e=I)),s=O}return y!==null&&_.push({start:e%h,end:y%h,loop:l}),_}function mZ(t,e){const r=t.points,l=t.options.spanGaps,h=r.length;if(!h)return[];const _=!!t._loop,{start:y,end:s}=fZ(r,h,_,l);if(l===!0)return MD(t,[{start:y,end:s,loop:_}],r,e);const I=s<y?s+h:s,O=!!t._fullLoop&&y===0&&s===h-1;return MD(t,pZ(r,y,I,O),r,e)}function MD(t,e,r,l){return!l||!l.setContext||!r?e:gZ(t,e,r,l)}function gZ(t,e,r,l){const h=t._chart.getContext(),_=ID(t.options),{_datasetIndex:y,options:{spanGaps:s}}=t,I=r.length,O=[];let k=_,j=e[0].start,Z=j;function Y(se,ne,de,me){const Te=s?-1:1;if(se!==ne){for(se+=I;r[se%I].skip;)se-=Te;for(;r[ne%I].skip;)ne+=Te;se%I!==ne%I&&(O.push({start:se%I,end:ne%I,loop:de,style:me}),k=me,j=ne%I)}}for(const se of e){j=s?j:se.start;let ne=r[j%I],de;for(Z=j+1;Z<=se.end;Z++){const me=r[Z%I];de=ID(l.setContext(Uu(h,{type:"segment",p0:ne,p1:me,p0DataIndex:(Z-1)%I,p1DataIndex:Z%I,datasetIndex:y}))),_Z(de,k)&&Y(j,Z-1,se.loop,k),ne=me,k=de}j<Z-1&&Y(j,Z-1,se.loop,k)}return O}function ID(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function _Z(t,e){if(!e)return!1;const r=[],l=function(h,_){return d2(_)?(r.includes(_)||r.push(_),r.indexOf(_)):_};return JSON.stringify(t,l)!==JSON.stringify(e,l)}function bv(t,e,r){return t.options.clip?t[r]:e[r]}function yZ(t,e){const{xScale:r,yScale:l}=t;return r&&l?{left:bv(r,e,"left"),right:bv(r,e,"right"),top:bv(l,e,"top"),bottom:bv(l,e,"bottom")}:e}function Tz(t,e){const r=e._clip;if(r.disabled)return!1;const l=yZ(e,t.chartArea);return{left:r.left===!1?0:l.left-(r.left===!0?0:r.left),right:r.right===!1?t.width:l.right+(r.right===!0?0:r.right),top:r.top===!1?0:l.top-(r.top===!0?0:r.top),bottom:r.bottom===!1?t.height:l.bottom+(r.bottom===!0?0:r.bottom)}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class vZ{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,r,l,h){const _=r.listeners[h],y=r.duration;_.forEach(s=>s({chart:e,initial:r.initial,numSteps:y,currentStep:Math.min(l-r.start,y)}))}_refresh(){this._request||(this._running=!0,this._request=rz.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let r=0;this._charts.forEach((l,h)=>{if(!l.running||!l.items.length)return;const _=l.items;let y=_.length-1,s=!1,I;for(;y>=0;--y)I=_[y],I._active?(I._total>l.duration&&(l.duration=I._total),I.tick(e),s=!0):(_[y]=_[_.length-1],_.pop());s&&(h.draw(),this._notify(h,l,e,"progress")),_.length||(l.running=!1,this._notify(h,l,e,"complete"),l.initial=!1),r+=_.length}),this._lastDate=e,r===0&&(this._running=!1)}_getAnims(e){const r=this._charts;let l=r.get(e);return l||(l={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},r.set(e,l)),l}listen(e,r,l){this._getAnims(e).listeners[r].push(l)}add(e,r){!r||!r.length||this._getAnims(e).items.push(...r)}has(e){return this._getAnims(e).items.length>0}start(e){const r=this._charts.get(e);r&&(r.running=!0,r.start=Date.now(),r.duration=r.items.reduce((l,h)=>Math.max(l,h._duration),0),this._refresh())}running(e){if(!this._running)return!1;const r=this._charts.get(e);return!(!r||!r.running||!r.items.length)}stop(e){const r=this._charts.get(e);if(!r||!r.items.length)return;const l=r.items;let h=l.length-1;for(;h>=0;--h)l[h].cancel();r.items=[],this._notify(e,r,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Ul=new vZ;const CD="transparent",xZ={boolean(t,e,r){return r>.5?e:t},color(t,e,r){const l=vD(t||CD),h=l.valid&&vD(e||CD);return h&&h.valid?h.mix(l,r).hexString():e},number(t,e,r){return t+(e-t)*r}};class bZ{constructor(e,r,l,h){const _=r[l];h=qg([e.to,h,_,e.from]);const y=qg([e.from,_,h]);this._active=!0,this._fn=e.fn||xZ[e.type||typeof y],this._easing=h_[e.easing]||h_.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=r,this._prop=l,this._from=y,this._to=h,this._promises=void 0}active(){return this._active}update(e,r,l){if(this._active){this._notify(!1);const h=this._target[this._prop],_=l-this._start,y=this._duration-_;this._start=l,this._duration=Math.floor(Math.max(y,e.duration)),this._total+=_,this._loop=!!e.loop,this._to=qg([e.to,r,h,e.from]),this._from=qg([e.from,h,r])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const r=e-this._start,l=this._duration,h=this._prop,_=this._from,y=this._loop,s=this._to;let I;if(this._active=_!==s&&(y||r<l),!this._active){this._target[h]=s,this._notify(!0);return}if(r<0){this._target[h]=_;return}I=r/l%2,I=y&&I>1?2-I:I,I=this._easing(Math.min(1,Math.max(0,I))),this._target[h]=this._fn(_,s,I)}wait(){const e=this._promises||(this._promises=[]);return new Promise((r,l)=>{e.push({res:r,rej:l})})}_notify(e){const r=e?"res":"rej",l=this._promises||[];for(let h=0;h<l.length;h++)l[h][r]()}}class Ez{constructor(e,r){this._chart=e,this._properties=new Map,this.configure(r)}configure(e){if(!bn(e))return;const r=Object.keys(_s.animation),l=this._properties;Object.getOwnPropertyNames(e).forEach(h=>{const _=e[h];if(!bn(_))return;const y={};for(const s of r)y[s]=_[s];(as(_.properties)&&_.properties||[h]).forEach(s=>{(s===h||!l.has(s))&&l.set(s,y)})})}_animateOptions(e,r){const l=r.options,h=TZ(e,l);if(!h)return[];const _=this._createAnimations(h,l);return l.$shared&&wZ(e.options.$animations,l).then(()=>{e.options=l},()=>{}),_}_createAnimations(e,r){const l=this._properties,h=[],_=e.$animations||(e.$animations={}),y=Object.keys(r),s=Date.now();let I;for(I=y.length-1;I>=0;--I){const O=y[I];if(O.charAt(0)==="$")continue;if(O==="options"){h.push(...this._animateOptions(e,r));continue}const k=r[O];let j=_[O];const Z=l.get(O);if(j)if(Z&&j.active()){j.update(Z,k,s);continue}else j.cancel();if(!Z||!Z.duration){e[O]=k;continue}_[O]=j=new bZ(Z,e,O,k),h.push(j)}return h}update(e,r){if(this._properties.size===0){Object.assign(e,r);return}const l=this._createAnimations(e,r);if(l.length)return Ul.add(this._chart,l),!0}}function wZ(t,e){const r=[],l=Object.keys(e);for(let h=0;h<l.length;h++){const _=t[l[h]];_&&_.active()&&r.push(_.wait())}return Promise.all(r)}function TZ(t,e){if(!e)return;let r=t.options;if(!r){t.options=e;return}return r.$shared&&(t.options=r=Object.assign({},r,{$shared:!1,$animations:{}})),r}function PD(t,e){const r=t&&t.options||{},l=r.reverse,h=r.min===void 0?e:0,_=r.max===void 0?e:0;return{start:l?_:h,end:l?h:_}}function EZ(t,e,r){if(r===!1)return!1;const l=PD(t,r),h=PD(e,r);return{top:h.end,right:l.end,bottom:h.start,left:l.start}}function SZ(t){let e,r,l,h;return bn(t)?(e=t.top,r=t.right,l=t.bottom,h=t.left):e=r=l=h=t,{top:e,right:r,bottom:l,left:h,disabled:t===!1}}function Sz(t,e){const r=[],l=t._getSortedDatasetMetas(e);let h,_;for(h=0,_=l.length;h<_;++h)r.push(l[h].index);return r}function DD(t,e,r,l={}){const h=t.keys,_=l.mode==="single";let y,s,I,O;if(e===null)return;let k=!1;for(y=0,s=h.length;y<s;++y){if(I=+h[y],I===r){if(k=!0,l.all)continue;break}O=t.values[I],Ps(O)&&(_||e===0||ml(e)===ml(O))&&(e+=O)}return!k&&!l.all?0:e}function AZ(t,e){const{iScale:r,vScale:l}=e,h=r.axis==="x"?"x":"y",_=l.axis==="x"?"x":"y",y=Object.keys(t),s=new Array(y.length);let I,O,k;for(I=0,O=y.length;I<O;++I)k=y[I],s[I]={[h]:k,[_]:t[k]};return s}function bT(t,e){const r=t&&t.options.stacked;return r||r===void 0&&e.stack!==void 0}function MZ(t,e,r){return`${t.id}.${e.id}.${r.stack||r.type}`}function IZ(t){const{min:e,max:r,minDefined:l,maxDefined:h}=t.getUserBounds();return{min:l?e:Number.NEGATIVE_INFINITY,max:h?r:Number.POSITIVE_INFINITY}}function CZ(t,e,r){const l=t[e]||(t[e]={});return l[r]||(l[r]={})}function RD(t,e,r,l){for(const h of e.getMatchingVisibleMetas(l).reverse()){const _=t[h.index];if(r&&_>0||!r&&_<0)return h.index}return null}function LD(t,e){const{chart:r,_cachedMeta:l}=t,h=r._stacks||(r._stacks={}),{iScale:_,vScale:y,index:s}=l,I=_.axis,O=y.axis,k=MZ(_,y,l),j=e.length;let Z;for(let Y=0;Y<j;++Y){const se=e[Y],{[I]:ne,[O]:de}=se,me=se._stacks||(se._stacks={});Z=me[O]=CZ(h,k,ne),Z[s]=de,Z._top=RD(Z,y,!0,l.type),Z._bottom=RD(Z,y,!1,l.type);const Te=Z._visualValues||(Z._visualValues={});Te[s]=de}}function wT(t,e){const r=t.scales;return Object.keys(r).filter(l=>r[l].axis===e).shift()}function PZ(t,e){return Uu(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function DZ(t,e,r){return Uu(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:r,index:e,mode:"default",type:"data"})}function zg(t,e){const r=t.controller.index,l=t.vScale&&t.vScale.axis;if(l){e=e||t._parsed;for(const h of e){const _=h._stacks;if(!_||_[l]===void 0||_[l][r]===void 0)return;delete _[l][r],_[l]._visualValues!==void 0&&_[l]._visualValues[r]!==void 0&&delete _[l]._visualValues[r]}}}const TT=t=>t==="reset"||t==="none",OD=(t,e)=>e?t:Object.assign({},t),RZ=(t,e,r)=>t&&!e.hidden&&e._stacked&&{keys:Sz(r,!0),values:null};class Ua{constructor(e,r){this.chart=e,this._ctx=e.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=bT(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&zg(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,r=this._cachedMeta,l=this.getDataset(),h=(j,Z,Y,se)=>j==="x"?Z:j==="r"?se:Y,_=r.xAxisID=ln(l.xAxisID,wT(e,"x")),y=r.yAxisID=ln(l.yAxisID,wT(e,"y")),s=r.rAxisID=ln(l.rAxisID,wT(e,"r")),I=r.indexAxis,O=r.iAxisID=h(I,_,y,s),k=r.vAxisID=h(I,y,_,s);r.xScale=this.getScaleForId(_),r.yScale=this.getScaleForId(y),r.rScale=this.getScaleForId(s),r.iScale=this.getScaleForId(O),r.vScale=this.getScaleForId(k)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const r=this._cachedMeta;return e===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&gD(this._data,this),e._stacked&&zg(e)}_dataCheck(){const e=this.getDataset(),r=e.data||(e.data=[]),l=this._data;if(bn(r)){const h=this._cachedMeta;this._data=AZ(r,h)}else if(l!==r){if(l){gD(l,this);const h=this._cachedMeta;zg(h),h._parsed=[]}r&&Object.isExtensible(r)&&g9(r,this),this._syncList=[],this._data=r}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const r=this._cachedMeta,l=this.getDataset();let h=!1;this._dataCheck();const _=r._stacked;r._stacked=bT(r.vScale,r),r.stack!==l.stack&&(h=!0,zg(r),r.stack=l.stack),this._resyncElements(e),(h||_!==r._stacked)&&(LD(this,r._parsed),r._stacked=bT(r.vScale,r))}configure(){const e=this.chart.config,r=e.datasetScopeKeys(this._type),l=e.getOptionScopes(this.getDataset(),r,!0);this.options=e.createResolver(l,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,r){const{_cachedMeta:l,_data:h}=this,{iScale:_,_stacked:y}=l,s=_.axis;let I=e===0&&r===h.length?!0:l._sorted,O=e>0&&l._parsed[e-1],k,j,Z;if(this._parsing===!1)l._parsed=h,l._sorted=!0,Z=h;else{as(h[e])?Z=this.parseArrayData(l,h,e,r):bn(h[e])?Z=this.parseObjectData(l,h,e,r):Z=this.parsePrimitiveData(l,h,e,r);const Y=()=>j[s]===null||O&&j[s]<O[s];for(k=0;k<r;++k)l._parsed[k+e]=j=Z[k],I&&(Y()&&(I=!1),O=j);l._sorted=I}y&&LD(this,Z)}parsePrimitiveData(e,r,l,h){const{iScale:_,vScale:y}=e,s=_.axis,I=y.axis,O=_.getLabels(),k=_===y,j=new Array(h);let Z,Y,se;for(Z=0,Y=h;Z<Y;++Z)se=Z+l,j[Z]={[s]:k||_.parse(O[se],se),[I]:y.parse(r[se],se)};return j}parseArrayData(e,r,l,h){const{xScale:_,yScale:y}=e,s=new Array(h);let I,O,k,j;for(I=0,O=h;I<O;++I)k=I+l,j=r[k],s[I]={x:_.parse(j[0],k),y:y.parse(j[1],k)};return s}parseObjectData(e,r,l,h){const{xScale:_,yScale:y}=e,{xAxisKey:s="x",yAxisKey:I="y"}=this._parsing,O=new Array(h);let k,j,Z,Y;for(k=0,j=h;k<j;++k)Z=k+l,Y=r[Z],O[k]={x:_.parse(Ou(Y,s),Z),y:y.parse(Ou(Y,I),Z)};return O}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,r,l){const h=this.chart,_=this._cachedMeta,y=r[e.axis],s={keys:Sz(h,!0),values:r._stacks[e.axis]._visualValues};return DD(s,y,_.index,{mode:l})}updateRangeFromParsed(e,r,l,h){const _=l[r.axis];let y=_===null?NaN:_;const s=h&&l._stacks[r.axis];h&&s&&(h.values=s,y=DD(h,_,this._cachedMeta.index)),e.min=Math.min(e.min,y),e.max=Math.max(e.max,y)}getMinMax(e,r){const l=this._cachedMeta,h=l._parsed,_=l._sorted&&e===l.iScale,y=h.length,s=this._getOtherScale(e),I=RZ(r,l,this.chart),O={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:k,max:j}=IZ(s);let Z,Y;function se(){Y=h[Z];const ne=Y[s.axis];return!Ps(Y[e.axis])||k>ne||j<ne}for(Z=0;Z<y&&!(!se()&&(this.updateRangeFromParsed(O,e,Y,I),_));++Z);if(_){for(Z=y-1;Z>=0;--Z)if(!se()){this.updateRangeFromParsed(O,e,Y,I);break}}return O}getAllParsedValues(e){const r=this._cachedMeta._parsed,l=[];let h,_,y;for(h=0,_=r.length;h<_;++h)y=r[h][e.axis],Ps(y)&&l.push(y);return l}getMaxOverflow(){return!1}getLabelAndValue(e){const r=this._cachedMeta,l=r.iScale,h=r.vScale,_=this.getParsed(e);return{label:l?""+l.getLabelForValue(_[l.axis]):"",value:h?""+h.getLabelForValue(_[h.axis]):""}}_update(e){const r=this._cachedMeta;this.update(e||"default"),r._clip=SZ(ln(this.options.clip,EZ(r.xScale,r.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,r=this.chart,l=this._cachedMeta,h=l.data||[],_=r.chartArea,y=[],s=this._drawStart||0,I=this._drawCount||h.length-s,O=this.options.drawActiveElementsOnTop;let k;for(l.dataset&&l.dataset.draw(e,_,s,I),k=s;k<s+I;++k){const j=h[k];j.hidden||(j.active&&O?y.push(j):j.draw(e,_))}for(k=0;k<y.length;++k)y[k].draw(e,_)}getStyle(e,r){const l=r?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(l):this.resolveDataElementOptions(e||0,l)}getContext(e,r,l){const h=this.getDataset();let _;if(e>=0&&e<this._cachedMeta.data.length){const y=this._cachedMeta.data[e];_=y.$context||(y.$context=DZ(this.getContext(),e,y)),_.parsed=this.getParsed(e),_.raw=h.data[e],_.index=_.dataIndex=e}else _=this.$context||(this.$context=PZ(this.chart.getContext(),this.index)),_.dataset=h,_.index=_.datasetIndex=this.index;return _.active=!!r,_.mode=l,_}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,r){return this._resolveElementOptions(this.dataElementType.id,r,e)}_resolveElementOptions(e,r="default",l){const h=r==="active",_=this._cachedDataOpts,y=e+"-"+r,s=_[y],I=this.enableOptionSharing&&k_(l);if(s)return OD(s,I);const O=this.chart.config,k=O.datasetElementScopeKeys(this._type,e),j=h?[`${e}Hover`,"hover",e,""]:[e,""],Z=O.getOptionScopes(this.getDataset(),k),Y=Object.keys(_s.elements[e]),se=()=>this.getContext(l,h,r),ne=O.resolveNamedOptions(Z,Y,se,j);return ne.$shared&&(ne.$shared=I,_[y]=Object.freeze(OD(ne,I))),ne}_resolveAnimations(e,r,l){const h=this.chart,_=this._cachedDataOpts,y=`animation-${r}`,s=_[y];if(s)return s;let I;if(h.options.animation!==!1){const k=this.chart.config,j=k.datasetAnimationScopeKeys(this._type,r),Z=k.getOptionScopes(this.getDataset(),j);I=k.createResolver(Z,this.getContext(e,l,r))}const O=new Ez(h,I&&I.animations);return I&&I._cacheable&&(_[y]=Object.freeze(O)),O}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,r){return!r||TT(e)||this.chart._animationsDisabled}_getSharedOptions(e,r){const l=this.resolveDataElementOptions(e,r),h=this._sharedOptions,_=this.getSharedOptions(l),y=this.includeOptions(r,_)||_!==h;return this.updateSharedOptions(_,r,l),{sharedOptions:_,includeOptions:y}}updateElement(e,r,l,h){TT(h)?Object.assign(e,l):this._resolveAnimations(r,h).update(e,l)}updateSharedOptions(e,r,l){e&&!TT(r)&&this._resolveAnimations(void 0,r).update(e,l)}_setStyle(e,r,l,h){e.active=h;const _=this.getStyle(r,h);this._resolveAnimations(r,l,h).update(e,{options:!h&&this.getSharedOptions(_)||_})}removeHoverStyle(e,r,l){this._setStyle(e,l,"active",!1)}setHoverStyle(e,r,l){this._setStyle(e,l,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const r=this._data,l=this._cachedMeta.data;for(const[s,I,O]of this._syncList)this[s](I,O);this._syncList=[];const h=l.length,_=r.length,y=Math.min(_,h);y&&this.parse(0,y),_>h?this._insertElements(h,_-h,e):_<h&&this._removeElements(_,h-_)}_insertElements(e,r,l=!0){const h=this._cachedMeta,_=h.data,y=e+r;let s;const I=O=>{for(O.length+=r,s=O.length-1;s>=y;s--)O[s]=O[s-r]};for(I(_),s=e;s<y;++s)_[s]=new this.dataElementType;this._parsing&&I(h._parsed),this.parse(e,r),l&&this.updateElements(_,e,r,"reset")}updateElements(e,r,l,h){}_removeElements(e,r){const l=this._cachedMeta;if(this._parsing){const h=l._parsed.splice(e,r);l._stacked&&zg(l,h)}l.data.splice(e,r)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[r,l,h]=e;this[r](l,h)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,r){r&&this._sync(["_removeElements",e,r]);const l=arguments.length-2;l&&this._sync(["_insertElements",e,l])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ri(Ua,"defaults",{}),ri(Ua,"datasetElementType",null),ri(Ua,"dataElementType",null);function LZ(t,e){if(!t._cache.$bar){const r=t.getMatchingVisibleMetas(e);let l=[];for(let h=0,_=r.length;h<_;h++)l=l.concat(r[h].controller.getAllParsedValues(t));t._cache.$bar=sz(l.sort((h,_)=>h-_))}return t._cache.$bar}function OZ(t){const e=t.iScale,r=LZ(e,t.type);let l=e._length,h,_,y,s;const I=()=>{y===32767||y===-32768||(k_(s)&&(l=Math.min(l,Math.abs(y-s)||l)),s=y)};for(h=0,_=r.length;h<_;++h)y=e.getPixelForValue(r[h]),I();for(s=void 0,h=0,_=e.ticks.length;h<_;++h)y=e.getPixelForTick(h),I();return l}function kZ(t,e,r,l){const h=r.barThickness;let _,y;return vn(h)?(_=e.min*r.categoryPercentage,y=r.barPercentage):(_=h*l,y=1),{chunk:_/l,ratio:y,start:e.pixels[t]-_/2}}function zZ(t,e,r,l){const h=e.pixels,_=h[t];let y=t>0?h[t-1]:null,s=t<h.length-1?h[t+1]:null;const I=r.categoryPercentage;y===null&&(y=_-(s===null?e.end-e.start:s-_)),s===null&&(s=_+_-y);const O=_-(_-Math.min(y,s))/2*I;return{chunk:Math.abs(s-y)/2*I/l,ratio:r.barPercentage,start:O}}function FZ(t,e,r,l){const h=r.parse(t[0],l),_=r.parse(t[1],l),y=Math.min(h,_),s=Math.max(h,_);let I=y,O=s;Math.abs(y)>Math.abs(s)&&(I=s,O=y),e[r.axis]=O,e._custom={barStart:I,barEnd:O,start:h,end:_,min:y,max:s}}function Az(t,e,r,l){return as(t)?FZ(t,e,r,l):e[r.axis]=r.parse(t,l),e}function kD(t,e,r,l){const h=t.iScale,_=t.vScale,y=h.getLabels(),s=h===_,I=[];let O,k,j,Z;for(O=r,k=r+l;O<k;++O)Z=e[O],j={},j[h.axis]=s||h.parse(y[O],O),I.push(Az(Z,j,_,O));return I}function ET(t){return t&&t.barStart!==void 0&&t.barEnd!==void 0}function BZ(t,e,r){return t!==0?ml(t):(e.isHorizontal()?1:-1)*(e.min>=r?1:-1)}function NZ(t){let e,r,l,h,_;return t.horizontal?(e=t.base>t.x,r="left",l="right"):(e=t.base<t.y,r="bottom",l="top"),e?(h="end",_="start"):(h="start",_="end"),{start:r,end:l,reverse:e,top:h,bottom:_}}function VZ(t,e,r,l){let h=e.borderSkipped;const _={};if(!h){t.borderSkipped=_;return}if(h===!0){t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:y,end:s,reverse:I,top:O,bottom:k}=NZ(t);h==="middle"&&r&&(t.enableBorderRadius=!0,(r._top||0)===l?h=O:(r._bottom||0)===l?h=k:(_[zD(k,y,s,I)]=!0,h=O)),_[zD(h,y,s,I)]=!0,t.borderSkipped=_}function zD(t,e,r,l){return l?(t=UZ(t,e,r),t=FD(t,r,e)):t=FD(t,e,r),t}function UZ(t,e,r){return t===e?r:t===r?e:t}function FD(t,e,r){return t==="start"?e:t==="end"?r:t}function jZ(t,{inflateAmount:e},r){t.inflateAmount=e==="auto"?r===1?.33:0:e}class Zv extends Ua{parsePrimitiveData(e,r,l,h){return kD(e,r,l,h)}parseArrayData(e,r,l,h){return kD(e,r,l,h)}parseObjectData(e,r,l,h){const{iScale:_,vScale:y}=e,{xAxisKey:s="x",yAxisKey:I="y"}=this._parsing,O=_.axis==="x"?s:I,k=y.axis==="x"?s:I,j=[];let Z,Y,se,ne;for(Z=l,Y=l+h;Z<Y;++Z)ne=r[Z],se={},se[_.axis]=_.parse(Ou(ne,O),Z),j.push(Az(Ou(ne,k),se,y,Z));return j}updateRangeFromParsed(e,r,l,h){super.updateRangeFromParsed(e,r,l,h);const _=l._custom;_&&r===this._cachedMeta.vScale&&(e.min=Math.min(e.min,_.min),e.max=Math.max(e.max,_.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const r=this._cachedMeta,{iScale:l,vScale:h}=r,_=this.getParsed(e),y=_._custom,s=ET(y)?"["+y.start+", "+y.end+"]":""+h.getLabelForValue(_[h.axis]);return{label:""+l.getLabelForValue(_[l.axis]),value:s}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const r=this._cachedMeta;this.updateElements(r.data,0,r.data.length,e)}updateElements(e,r,l,h){const _=h==="reset",{index:y,_cachedMeta:{vScale:s}}=this,I=s.getBasePixel(),O=s.isHorizontal(),k=this._getRuler(),{sharedOptions:j,includeOptions:Z}=this._getSharedOptions(r,h);for(let Y=r;Y<r+l;Y++){const se=this.getParsed(Y),ne=_||vn(se[s.axis])?{base:I,head:I}:this._calculateBarValuePixels(Y),de=this._calculateBarIndexPixels(Y,k),me=(se._stacks||{})[s.axis],Te={horizontal:O,base:ne.base,enableBorderRadius:!me||ET(se._custom)||y===me._top||y===me._bottom,x:O?ne.head:de.center,y:O?de.center:ne.head,height:O?de.size:Math.abs(ne.size),width:O?Math.abs(ne.size):de.size};Z&&(Te.options=j||this.resolveDataElementOptions(Y,e[Y].active?"active":h));const ge=Te.options||e[Y].options;VZ(Te,ge,me,y),jZ(Te,ge,k.ratio),this.updateElement(e[Y],Y,Te,h)}}_getStacks(e,r){const{iScale:l}=this._cachedMeta,h=l.getMatchingVisibleMetas(this._type).filter(k=>k.controller.options.grouped),_=l.options.stacked,y=[],s=this._cachedMeta.controller.getParsed(r),I=s&&s[l.axis],O=k=>{const j=k._parsed.find(Y=>Y[l.axis]===I),Z=j&&j[k.vScale.axis];if(vn(Z)||isNaN(Z))return!0};for(const k of h)if(!(r!==void 0&&O(k))&&((_===!1||y.indexOf(k.stack)===-1||_===void 0&&k.stack===void 0)&&y.push(k.stack),k.index===e))break;return y.length||y.push(void 0),y}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,r,l){const h=this._getStacks(e,l),_=r!==void 0?h.indexOf(r):-1;return _===-1?h.length-1:_}_getRuler(){const e=this.options,r=this._cachedMeta,l=r.iScale,h=[];let _,y;for(_=0,y=r.data.length;_<y;++_)h.push(l.getPixelForValue(this.getParsed(_)[l.axis],_));const s=e.barThickness;return{min:s||OZ(r),pixels:h,start:l._startPixel,end:l._endPixel,stackCount:this._getStackCount(),scale:l,grouped:e.grouped,ratio:s?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:r,_stacked:l,index:h},options:{base:_,minBarLength:y}}=this,s=_||0,I=this.getParsed(e),O=I._custom,k=ET(O);let j=I[r.axis],Z=0,Y=l?this.applyStack(r,I,l):j,se,ne;Y!==j&&(Z=Y-j,Y=j),k&&(j=O.barStart,Y=O.barEnd-O.barStart,j!==0&&ml(j)!==ml(O.barEnd)&&(Z=0),Z+=j);const de=!vn(_)&&!k?_:Z;let me=r.getPixelForValue(de);if(this.chart.getDataVisibility(e)?se=r.getPixelForValue(Z+Y):se=me,ne=se-me,Math.abs(ne)<y){ne=BZ(ne,r,s)*y,j===s&&(me-=ne/2);const Te=r.getPixelForDecimal(0),ge=r.getPixelForDecimal(1),fe=Math.min(Te,ge),Ae=Math.max(Te,ge);me=Math.max(Math.min(me,Ae),fe),se=me+ne,l&&!k&&(I._stacks[r.axis]._visualValues[h]=r.getValueForPixel(se)-r.getValueForPixel(me))}if(me===r.getPixelForValue(s)){const Te=ml(ne)*r.getLineWidthForValue(s)/2;me+=Te,ne-=Te}return{size:ne,base:me,head:se,center:se+ne/2}}_calculateBarIndexPixels(e,r){const l=r.scale,h=this.options,_=h.skipNull,y=ln(h.maxBarThickness,1/0);let s,I;if(r.grouped){const O=_?this._getStackCount(e):r.stackCount,k=h.barThickness==="flex"?zZ(e,r,h,O):kZ(e,r,h,O),j=this._getStackIndex(this.index,this._cachedMeta.stack,_?e:void 0);s=k.start+k.chunk*j+k.chunk/2,I=Math.min(y,k.chunk*k.ratio)}else s=l.getPixelForValue(this.getParsed(e)[l.axis],e),I=Math.min(y,r.min*r.ratio);return{base:s-I/2,head:s+I/2,center:s,size:I}}draw(){const e=this._cachedMeta,r=e.vScale,l=e.data,h=l.length;let _=0;for(;_<h;++_)this.getParsed(_)[r.axis]!==null&&!l[_].hidden&&l[_].draw(this._ctx)}}ri(Zv,"id","bar"),ri(Zv,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),ri(Zv,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Xv extends Ua{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,r,l,h){const _=super.parsePrimitiveData(e,r,l,h);for(let y=0;y<_.length;y++)_[y]._custom=this.resolveDataElementOptions(y+l).radius;return _}parseArrayData(e,r,l,h){const _=super.parseArrayData(e,r,l,h);for(let y=0;y<_.length;y++){const s=r[l+y];_[y]._custom=ln(s[2],this.resolveDataElementOptions(y+l).radius)}return _}parseObjectData(e,r,l,h){const _=super.parseObjectData(e,r,l,h);for(let y=0;y<_.length;y++){const s=r[l+y];_[y]._custom=ln(s&&s.r&&+s.r,this.resolveDataElementOptions(y+l).radius)}return _}getMaxOverflow(){const e=this._cachedMeta.data;let r=0;for(let l=e.length-1;l>=0;--l)r=Math.max(r,e[l].size(this.resolveDataElementOptions(l))/2);return r>0&&r}getLabelAndValue(e){const r=this._cachedMeta,l=this.chart.data.labels||[],{xScale:h,yScale:_}=r,y=this.getParsed(e),s=h.getLabelForValue(y.x),I=_.getLabelForValue(y.y),O=y._custom;return{label:l[e]||"",value:"("+s+", "+I+(O?", "+O:"")+")"}}update(e){const r=this._cachedMeta.data;this.updateElements(r,0,r.length,e)}updateElements(e,r,l,h){const _=h==="reset",{iScale:y,vScale:s}=this._cachedMeta,{sharedOptions:I,includeOptions:O}=this._getSharedOptions(r,h),k=y.axis,j=s.axis;for(let Z=r;Z<r+l;Z++){const Y=e[Z],se=!_&&this.getParsed(Z),ne={},de=ne[k]=_?y.getPixelForDecimal(.5):y.getPixelForValue(se[k]),me=ne[j]=_?s.getBasePixel():s.getPixelForValue(se[j]);ne.skip=isNaN(de)||isNaN(me),O&&(ne.options=I||this.resolveDataElementOptions(Z,Y.active?"active":h),_&&(ne.options.radius=0)),this.updateElement(Y,Z,ne,h)}}resolveDataElementOptions(e,r){const l=this.getParsed(e);let h=super.resolveDataElementOptions(e,r);h.$shared&&(h=Object.assign({},h,{$shared:!1}));const _=h.radius;return r!=="active"&&(h.radius=0),h.radius+=ln(l&&l._custom,_),h}}ri(Xv,"id","bubble"),ri(Xv,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),ri(Xv,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function $Z(t,e,r){let l=1,h=1,_=0,y=0;if(e<ls){const s=t,I=s+e,O=Math.cos(s),k=Math.sin(s),j=Math.cos(I),Z=Math.sin(I),Y=(ge,fe,Ae)=>z_(ge,s,I,!0)?1:Math.max(fe,fe*r,Ae,Ae*r),se=(ge,fe,Ae)=>z_(ge,s,I,!0)?-1:Math.min(fe,fe*r,Ae,Ae*r),ne=Y(0,O,j),de=Y(Bs,k,Z),me=se(us,O,j),Te=se(us+Bs,k,Z);l=(ne-me)/2,h=(de-Te)/2,_=-(ne+me)/2,y=-(de+Te)/2}return{ratioX:l,ratioY:h,offsetX:_,offsetY:y}}class Qh extends Ua{constructor(e,r){super(e,r),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,r){const l=this.getDataset().data,h=this._cachedMeta;if(this._parsing===!1)h._parsed=l;else{let _=I=>+l[I];if(bn(l[e])){const{key:I="value"}=this._parsing;_=O=>+Ou(l[O],I)}let y,s;for(y=e,s=e+r;y<s;++y)h._parsed[y]=_(y)}}_getRotation(){return za(this.options.rotation-90)}_getCircumference(){return za(this.options.circumference)}_getRotationExtents(){let e=ls,r=-ls;for(let l=0;l<this.chart.data.datasets.length;++l)if(this.chart.isDatasetVisible(l)&&this.chart.getDatasetMeta(l).type===this._type){const h=this.chart.getDatasetMeta(l).controller,_=h._getRotation(),y=h._getCircumference();e=Math.min(e,_),r=Math.max(r,_+y)}return{rotation:e,circumference:r-e}}update(e){const r=this.chart,{chartArea:l}=r,h=this._cachedMeta,_=h.data,y=this.getMaxBorderWidth()+this.getMaxOffset(_)+this.options.spacing,s=Math.max((Math.min(l.width,l.height)-y)/2,0),I=Math.min(t9(this.options.cutout,s),1),O=this._getRingWeight(this.index),{circumference:k,rotation:j}=this._getRotationExtents(),{ratioX:Z,ratioY:Y,offsetX:se,offsetY:ne}=$Z(j,k,I),de=(l.width-y)/Z,me=(l.height-y)/Y,Te=Math.max(Math.min(de,me)/2,0),ge=Qk(this.options.radius,Te),fe=Math.max(ge*I,0),Ae=(ge-fe)/this._getVisibleDatasetWeightTotal();this.offsetX=se*ge,this.offsetY=ne*ge,h.total=this.calculateTotal(),this.outerRadius=ge-Ae*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Ae*O,0),this.updateElements(_,0,_.length,e)}_circumference(e,r){const l=this.options,h=this._cachedMeta,_=this._getCircumference();return r&&l.animation.animateRotate||!this.chart.getDataVisibility(e)||h._parsed[e]===null||h.data[e].hidden?0:this.calculateCircumference(h._parsed[e]*_/ls)}updateElements(e,r,l,h){const _=h==="reset",y=this.chart,s=y.chartArea,O=y.options.animation,k=(s.left+s.right)/2,j=(s.top+s.bottom)/2,Z=_&&O.animateScale,Y=Z?0:this.innerRadius,se=Z?0:this.outerRadius,{sharedOptions:ne,includeOptions:de}=this._getSharedOptions(r,h);let me=this._getRotation(),Te;for(Te=0;Te<r;++Te)me+=this._circumference(Te,_);for(Te=r;Te<r+l;++Te){const ge=this._circumference(Te,_),fe=e[Te],Ae={x:k+this.offsetX,y:j+this.offsetY,startAngle:me,endAngle:me+ge,circumference:ge,outerRadius:se,innerRadius:Y};de&&(Ae.options=ne||this.resolveDataElementOptions(Te,fe.active?"active":h)),me+=ge,this.updateElement(fe,Te,Ae,h)}}calculateTotal(){const e=this._cachedMeta,r=e.data;let l=0,h;for(h=0;h<r.length;h++){const _=e._parsed[h];_!==null&&!isNaN(_)&&this.chart.getDataVisibility(h)&&!r[h].hidden&&(l+=Math.abs(_))}return l}calculateCircumference(e){const r=this._cachedMeta.total;return r>0&&!isNaN(e)?ls*(Math.abs(e)/r):0}getLabelAndValue(e){const r=this._cachedMeta,l=this.chart,h=l.data.labels||[],_=sy(r._parsed[e],l.options.locale);return{label:h[e]||"",value:_}}getMaxBorderWidth(e){let r=0;const l=this.chart;let h,_,y,s,I;if(!e){for(h=0,_=l.data.datasets.length;h<_;++h)if(l.isDatasetVisible(h)){y=l.getDatasetMeta(h),e=y.data,s=y.controller;break}}if(!e)return 0;for(h=0,_=e.length;h<_;++h)I=s.resolveDataElementOptions(h),I.borderAlign!=="inner"&&(r=Math.max(r,I.borderWidth||0,I.hoverBorderWidth||0));return r}getMaxOffset(e){let r=0;for(let l=0,h=e.length;l<h;++l){const _=this.resolveDataElementOptions(l);r=Math.max(r,_.offset||0,_.hoverOffset||0)}return r}_getRingWeightOffset(e){let r=0;for(let l=0;l<e;++l)this.chart.isDatasetVisible(l)&&(r+=this._getRingWeight(l));return r}_getRingWeight(e){return Math.max(ln(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}ri(Qh,"id","doughnut"),ri(Qh,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),ri(Qh,"descriptors",{_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")}),ri(Qh,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const r=e.data;if(r.labels.length&&r.datasets.length){const{labels:{pointStyle:l,color:h}}=e.legend.options;return r.labels.map((_,y)=>{const I=e.getDatasetMeta(0).controller.getStyle(y);return{text:_,fillStyle:I.backgroundColor,strokeStyle:I.borderColor,fontColor:h,lineWidth:I.borderWidth,pointStyle:l,hidden:!e.getDataVisibility(y),index:y}})}return[]}},onClick(e,r,l){l.chart.toggleDataVisibility(r.index),l.chart.update()}}}});class Yv extends Ua{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const r=this._cachedMeta,{dataset:l,data:h=[],_dataset:_}=r,y=this.chart._animationsDisabled;let{start:s,count:I}=az(r,h,y);this._drawStart=s,this._drawCount=I,lz(r)&&(s=0,I=h.length),l._chart=this.chart,l._datasetIndex=this.index,l._decimated=!!_._decimated,l.points=h;const O=this.resolveDatasetElementOptions(e);this.options.showLine||(O.borderWidth=0),O.segment=this.options.segment,this.updateElement(l,void 0,{animated:!y,options:O},e),this.updateElements(h,s,I,e)}updateElements(e,r,l,h){const _=h==="reset",{iScale:y,vScale:s,_stacked:I,_dataset:O}=this._cachedMeta,{sharedOptions:k,includeOptions:j}=this._getSharedOptions(r,h),Z=y.axis,Y=s.axis,{spanGaps:se,segment:ne}=this.options,de=xp(se)?se:Number.POSITIVE_INFINITY,me=this.chart._animationsDisabled||_||h==="none",Te=r+l,ge=e.length;let fe=r>0&&this.getParsed(r-1);for(let Ae=0;Ae<ge;++Ae){const Ge=e[Ae],ze=me?Ge:{};if(Ae<r||Ae>=Te){ze.skip=!0;continue}const Ke=this.getParsed(Ae),Xe=vn(Ke[Y]),Ue=ze[Z]=y.getPixelForValue(Ke[Z],Ae),et=ze[Y]=_||Xe?s.getBasePixel():s.getPixelForValue(I?this.applyStack(s,Ke,I):Ke[Y],Ae);ze.skip=isNaN(Ue)||isNaN(et)||Xe,ze.stop=Ae>0&&Math.abs(Ke[Z]-fe[Z])>de,ne&&(ze.parsed=Ke,ze.raw=O.data[Ae]),j&&(ze.options=k||this.resolveDataElementOptions(Ae,Ge.active?"active":h)),me||this.updateElement(Ge,Ae,ze,h),fe=Ke}}getMaxOverflow(){const e=this._cachedMeta,r=e.dataset,l=r.options&&r.options.borderWidth||0,h=e.data||[];if(!h.length)return l;const _=h[0].size(this.resolveDataElementOptions(0)),y=h[h.length-1].size(this.resolveDataElementOptions(h.length-1));return Math.max(l,_,y)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}ri(Yv,"id","line"),ri(Yv,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),ri(Yv,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class f_ extends Ua{constructor(e,r){super(e,r),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const r=this._cachedMeta,l=this.chart,h=l.data.labels||[],_=sy(r._parsed[e].r,l.options.locale);return{label:h[e]||"",value:_}}parseObjectData(e,r,l,h){return gz.bind(this)(e,r,l,h)}update(e){const r=this._cachedMeta.data;this._updateRadius(),this.updateElements(r,0,r.length,e)}getMinMax(){const e=this._cachedMeta,r={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((l,h)=>{const _=this.getParsed(h).r;!isNaN(_)&&this.chart.getDataVisibility(h)&&(_<r.min&&(r.min=_),_>r.max&&(r.max=_))}),r}_updateRadius(){const e=this.chart,r=e.chartArea,l=e.options,h=Math.min(r.right-r.left,r.bottom-r.top),_=Math.max(h/2,0),y=Math.max(l.cutoutPercentage?_/100*l.cutoutPercentage:1,0),s=(_-y)/e.getVisibleDatasetCount();this.outerRadius=_-s*this.index,this.innerRadius=this.outerRadius-s}updateElements(e,r,l,h){const _=h==="reset",y=this.chart,I=y.options.animation,O=this._cachedMeta.rScale,k=O.xCenter,j=O.yCenter,Z=O.getIndexAngle(0)-.5*us;let Y=Z,se;const ne=360/this.countVisibleElements();for(se=0;se<r;++se)Y+=this._computeAngle(se,h,ne);for(se=r;se<r+l;se++){const de=e[se];let me=Y,Te=Y+this._computeAngle(se,h,ne),ge=y.getDataVisibility(se)?O.getDistanceFromCenterForValue(this.getParsed(se).r):0;Y=Te,_&&(I.animateScale&&(ge=0),I.animateRotate&&(me=Te=Z));const fe={x:k,y:j,innerRadius:0,outerRadius:ge,startAngle:me,endAngle:Te,options:this.resolveDataElementOptions(se,de.active?"active":h)};this.updateElement(de,se,fe,h)}}countVisibleElements(){const e=this._cachedMeta;let r=0;return e.data.forEach((l,h)=>{!isNaN(this.getParsed(h).r)&&this.chart.getDataVisibility(h)&&r++}),r}_computeAngle(e,r,l){return this.chart.getDataVisibility(e)?za(this.resolveDataElementOptions(e,r).angle||l):0}}ri(f_,"id","polarArea"),ri(f_,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),ri(f_,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const r=e.data;if(r.labels.length&&r.datasets.length){const{labels:{pointStyle:l,color:h}}=e.legend.options;return r.labels.map((_,y)=>{const I=e.getDatasetMeta(0).controller.getStyle(y);return{text:_,fillStyle:I.backgroundColor,strokeStyle:I.borderColor,fontColor:h,lineWidth:I.borderWidth,pointStyle:l,hidden:!e.getDataVisibility(y),index:y}})}return[]}},onClick(e,r,l){l.chart.toggleDataVisibility(r.index),l.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class ME extends Qh{}ri(ME,"id","pie"),ri(ME,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Kv extends Ua{getLabelAndValue(e){const r=this._cachedMeta.vScale,l=this.getParsed(e);return{label:r.getLabels()[e],value:""+r.getLabelForValue(l[r.axis])}}parseObjectData(e,r,l,h){return gz.bind(this)(e,r,l,h)}update(e){const r=this._cachedMeta,l=r.dataset,h=r.data||[],_=r.iScale.getLabels();if(l.points=h,e!=="resize"){const y=this.resolveDatasetElementOptions(e);this.options.showLine||(y.borderWidth=0);const s={_loop:!0,_fullLoop:_.length===h.length,options:y};this.updateElement(l,void 0,s,e)}this.updateElements(h,0,h.length,e)}updateElements(e,r,l,h){const _=this._cachedMeta.rScale,y=h==="reset";for(let s=r;s<r+l;s++){const I=e[s],O=this.resolveDataElementOptions(s,I.active?"active":h),k=_.getPointPositionForValue(s,this.getParsed(s).r),j=y?_.xCenter:k.x,Z=y?_.yCenter:k.y,Y={x:j,y:Z,angle:k.angle,skip:isNaN(j)||isNaN(Z),options:O};this.updateElement(I,s,Y,h)}}}ri(Kv,"id","radar"),ri(Kv,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),ri(Kv,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Jv extends Ua{getLabelAndValue(e){const r=this._cachedMeta,l=this.chart.data.labels||[],{xScale:h,yScale:_}=r,y=this.getParsed(e),s=h.getLabelForValue(y.x),I=_.getLabelForValue(y.y);return{label:l[e]||"",value:"("+s+", "+I+")"}}update(e){const r=this._cachedMeta,{data:l=[]}=r,h=this.chart._animationsDisabled;let{start:_,count:y}=az(r,l,h);if(this._drawStart=_,this._drawCount=y,lz(r)&&(_=0,y=l.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:s,_dataset:I}=r;s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!I._decimated,s.points=l;const O=this.resolveDatasetElementOptions(e);O.segment=this.options.segment,this.updateElement(s,void 0,{animated:!h,options:O},e)}else this.datasetElementType&&(delete r.dataset,this.datasetElementType=!1);this.updateElements(l,_,y,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,r,l,h){const _=h==="reset",{iScale:y,vScale:s,_stacked:I,_dataset:O}=this._cachedMeta,k=this.resolveDataElementOptions(r,h),j=this.getSharedOptions(k),Z=this.includeOptions(h,j),Y=y.axis,se=s.axis,{spanGaps:ne,segment:de}=this.options,me=xp(ne)?ne:Number.POSITIVE_INFINITY,Te=this.chart._animationsDisabled||_||h==="none";let ge=r>0&&this.getParsed(r-1);for(let fe=r;fe<r+l;++fe){const Ae=e[fe],Ge=this.getParsed(fe),ze=Te?Ae:{},Ke=vn(Ge[se]),Xe=ze[Y]=y.getPixelForValue(Ge[Y],fe),Ue=ze[se]=_||Ke?s.getBasePixel():s.getPixelForValue(I?this.applyStack(s,Ge,I):Ge[se],fe);ze.skip=isNaN(Xe)||isNaN(Ue)||Ke,ze.stop=fe>0&&Math.abs(Ge[Y]-ge[Y])>me,de&&(ze.parsed=Ge,ze.raw=O.data[fe]),Z&&(ze.options=j||this.resolveDataElementOptions(fe,Ae.active?"active":h)),Te||this.updateElement(Ae,fe,ze,h),ge=Ge}this.updateSharedOptions(j,h,k)}getMaxOverflow(){const e=this._cachedMeta,r=e.data||[];if(!this.options.showLine){let s=0;for(let I=r.length-1;I>=0;--I)s=Math.max(s,r[I].size(this.resolveDataElementOptions(I))/2);return s>0&&s}const l=e.dataset,h=l.options&&l.options.borderWidth||0;if(!r.length)return h;const _=r[0].size(this.resolveDataElementOptions(0)),y=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(h,_,y)/2}}ri(Jv,"id","scatter"),ri(Jv,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),ri(Jv,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var HZ=Object.freeze({__proto__:null,BarController:Zv,BubbleController:Xv,DoughnutController:Qh,LineController:Yv,PieController:ME,PolarAreaController:f_,RadarController:Kv,ScatterController:Jv});function $h(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class v2{constructor(e){ri(this,"options");this.options=e||{}}static override(e){Object.assign(v2.prototype,e)}init(){}formats(){return $h()}parse(){return $h()}format(){return $h()}add(){return $h()}diff(){return $h()}startOf(){return $h()}endOf(){return $h()}}var GZ={_date:v2};function qZ(t,e,r,l){const{controller:h,data:_,_sorted:y}=t,s=h._cachedMeta.iScale,I=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(s&&e===s.axis&&e!=="r"&&y&&_.length){const O=s._reversePixels?p9:Kl;if(l){if(h._sharedOptions){const k=_[0],j=typeof k.getRange=="function"&&k.getRange(e);if(j){const Z=O(_,e,r-j),Y=O(_,e,r+j);return{lo:Z.lo,hi:Y.hi}}}}else{const k=O(_,e,r);if(I){const{vScale:j}=h._cachedMeta,{_parsed:Z}=t,Y=Z.slice(0,k.lo+1).reverse().findIndex(ne=>!vn(ne[j.axis]));k.lo-=Math.max(0,Y);const se=Z.slice(k.hi).findIndex(ne=>!vn(ne[j.axis]));k.hi+=Math.max(0,se)}return k}}return{lo:0,hi:_.length-1}}function ry(t,e,r,l,h){const _=t.getSortedVisibleDatasetMetas(),y=r[e];for(let s=0,I=_.length;s<I;++s){const{index:O,data:k}=_[s],{lo:j,hi:Z}=qZ(_[s],e,y,h);for(let Y=j;Y<=Z;++Y){const se=k[Y];se.skip||l(se,O,Y)}}}function WZ(t){const e=t.indexOf("x")!==-1,r=t.indexOf("y")!==-1;return function(l,h){const _=e?Math.abs(l.x-h.x):0,y=r?Math.abs(l.y-h.y):0;return Math.sqrt(Math.pow(_,2)+Math.pow(y,2))}}function ST(t,e,r,l,h){const _=[];return!h&&!t.isPointInArea(e)||ry(t,r,e,function(s,I,O){!h&&!Jl(s,t.chartArea,0)||s.inRange(e.x,e.y,l)&&_.push({element:s,datasetIndex:I,index:O})},!0),_}function ZZ(t,e,r,l){let h=[];function _(y,s,I){const{startAngle:O,endAngle:k}=y.getProps(["startAngle","endAngle"],l),{angle:j}=iz(y,{x:e.x,y:e.y});z_(j,O,k)&&h.push({element:y,datasetIndex:s,index:I})}return ry(t,r,e,_),h}function XZ(t,e,r,l,h,_){let y=[];const s=WZ(r);let I=Number.POSITIVE_INFINITY;function O(k,j,Z){const Y=k.inRange(e.x,e.y,h);if(l&&!Y)return;const se=k.getCenterPoint(h);if(!(!!_||t.isPointInArea(se))&&!Y)return;const de=s(e,se);de<I?(y=[{element:k,datasetIndex:j,index:Z}],I=de):de===I&&y.push({element:k,datasetIndex:j,index:Z})}return ry(t,r,e,O),y}function AT(t,e,r,l,h,_){return!_&&!t.isPointInArea(e)?[]:r==="r"&&!l?ZZ(t,e,r,h):XZ(t,e,r,l,h,_)}function BD(t,e,r,l,h){const _=[],y=r==="x"?"inXRange":"inYRange";let s=!1;return ry(t,r,e,(I,O,k)=>{I[y]&&I[y](e[r],h)&&(_.push({element:I,datasetIndex:O,index:k}),s=s||I.inRange(e.x,e.y,h))}),l&&!s?[]:_}var YZ={evaluateInteractionItems:ry,modes:{index(t,e,r,l){const h=qh(e,t),_=r.axis||"x",y=r.includeInvisible||!1,s=r.intersect?ST(t,h,_,l,y):AT(t,h,_,!1,l,y),I=[];return s.length?(t.getSortedVisibleDatasetMetas().forEach(O=>{const k=s[0].index,j=O.data[k];j&&!j.skip&&I.push({element:j,datasetIndex:O.index,index:k})}),I):[]},dataset(t,e,r,l){const h=qh(e,t),_=r.axis||"xy",y=r.includeInvisible||!1;let s=r.intersect?ST(t,h,_,l,y):AT(t,h,_,!1,l,y);if(s.length>0){const I=s[0].datasetIndex,O=t.getDatasetMeta(I).data;s=[];for(let k=0;k<O.length;++k)s.push({element:O[k],datasetIndex:I,index:k})}return s},point(t,e,r,l){const h=qh(e,t),_=r.axis||"xy",y=r.includeInvisible||!1;return ST(t,h,_,l,y)},nearest(t,e,r,l){const h=qh(e,t),_=r.axis||"xy",y=r.includeInvisible||!1;return AT(t,h,_,r.intersect,l,y)},x(t,e,r,l){const h=qh(e,t);return BD(t,h,"x",r.intersect,l)},y(t,e,r,l){const h=qh(e,t);return BD(t,h,"y",r.intersect,l)}}};const Mz=["left","top","right","bottom"];function Fg(t,e){return t.filter(r=>r.pos===e)}function ND(t,e){return t.filter(r=>Mz.indexOf(r.pos)===-1&&r.box.axis===e)}function Bg(t,e){return t.sort((r,l)=>{const h=e?l:r,_=e?r:l;return h.weight===_.weight?h.index-_.index:h.weight-_.weight})}function KZ(t){const e=[];let r,l,h,_,y,s;for(r=0,l=(t||[]).length;r<l;++r)h=t[r],{position:_,options:{stack:y,stackWeight:s=1}}=h,e.push({index:r,box:h,pos:_,horizontal:h.isHorizontal(),weight:h.weight,stack:y&&_+y,stackWeight:s});return e}function JZ(t){const e={};for(const r of t){const{stack:l,pos:h,stackWeight:_}=r;if(!l||!Mz.includes(h))continue;const y=e[l]||(e[l]={count:0,placed:0,weight:0,size:0});y.count++,y.weight+=_}return e}function QZ(t,e){const r=JZ(t),{vBoxMaxWidth:l,hBoxMaxHeight:h}=e;let _,y,s;for(_=0,y=t.length;_<y;++_){s=t[_];const{fullSize:I}=s.box,O=r[s.stack],k=O&&s.stackWeight/O.weight;s.horizontal?(s.width=k?k*l:I&&e.availableWidth,s.height=h):(s.width=l,s.height=k?k*h:I&&e.availableHeight)}return r}function eX(t){const e=KZ(t),r=Bg(e.filter(O=>O.box.fullSize),!0),l=Bg(Fg(e,"left"),!0),h=Bg(Fg(e,"right")),_=Bg(Fg(e,"top"),!0),y=Bg(Fg(e,"bottom")),s=ND(e,"x"),I=ND(e,"y");return{fullSize:r,leftAndTop:l.concat(_),rightAndBottom:h.concat(I).concat(y).concat(s),chartArea:Fg(e,"chartArea"),vertical:l.concat(h).concat(I),horizontal:_.concat(y).concat(s)}}function VD(t,e,r,l){return Math.max(t[r],e[r])+Math.max(t[l],e[l])}function Iz(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function tX(t,e,r,l){const{pos:h,box:_}=r,y=t.maxPadding;if(!bn(h)){r.size&&(t[h]-=r.size);const j=l[r.stack]||{size:0,count:1};j.size=Math.max(j.size,r.horizontal?_.height:_.width),r.size=j.size/j.count,t[h]+=r.size}_.getPadding&&Iz(y,_.getPadding());const s=Math.max(0,e.outerWidth-VD(y,t,"left","right")),I=Math.max(0,e.outerHeight-VD(y,t,"top","bottom")),O=s!==t.w,k=I!==t.h;return t.w=s,t.h=I,r.horizontal?{same:O,other:k}:{same:k,other:O}}function iX(t){const e=t.maxPadding;function r(l){const h=Math.max(e[l]-t[l],0);return t[l]+=h,h}t.y+=r("top"),t.x+=r("left"),r("right"),r("bottom")}function nX(t,e){const r=e.maxPadding;function l(h){const _={left:0,top:0,right:0,bottom:0};return h.forEach(y=>{_[y]=Math.max(e[y],r[y])}),_}return l(t?["left","right"]:["top","bottom"])}function Wg(t,e,r,l){const h=[];let _,y,s,I,O,k;for(_=0,y=t.length,O=0;_<y;++_){s=t[_],I=s.box,I.update(s.width||e.w,s.height||e.h,nX(s.horizontal,e));const{same:j,other:Z}=tX(e,r,s,l);O|=j&&h.length,k=k||Z,I.fullSize||h.push(s)}return O&&Wg(h,e,r,l)||k}function wv(t,e,r,l,h){t.top=r,t.left=e,t.right=e+l,t.bottom=r+h,t.width=l,t.height=h}function UD(t,e,r,l){const h=r.padding;let{x:_,y}=e;for(const s of t){const I=s.box,O=l[s.stack]||{count:1,placed:0,weight:1},k=s.stackWeight/O.weight||1;if(s.horizontal){const j=e.w*k,Z=O.size||I.height;k_(O.start)&&(y=O.start),I.fullSize?wv(I,h.left,y,r.outerWidth-h.right-h.left,Z):wv(I,e.left+O.placed,y,j,Z),O.start=y,O.placed+=j,y=I.bottom}else{const j=e.h*k,Z=O.size||I.width;k_(O.start)&&(_=O.start),I.fullSize?wv(I,_,h.top,Z,r.outerHeight-h.bottom-h.top):wv(I,_,e.top+O.placed,Z,j),O.start=_,O.placed+=j,_=I.right}}e.x=_,e.y=y}var Or={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(r){e.draw(r)}}]},t.boxes.push(e)},removeBox(t,e){const r=t.boxes?t.boxes.indexOf(e):-1;r!==-1&&t.boxes.splice(r,1)},configure(t,e,r){e.fullSize=r.fullSize,e.position=r.position,e.weight=r.weight},update(t,e,r,l){if(!t)return;const h=zr(t.options.layout.padding),_=Math.max(e-h.width,0),y=Math.max(r-h.height,0),s=eX(t.boxes),I=s.vertical,O=s.horizontal;jn(t.boxes,ne=>{typeof ne.beforeLayout=="function"&&ne.beforeLayout()});const k=I.reduce((ne,de)=>de.box.options&&de.box.options.display===!1?ne:ne+1,0)||1,j=Object.freeze({outerWidth:e,outerHeight:r,padding:h,availableWidth:_,availableHeight:y,vBoxMaxWidth:_/2/k,hBoxMaxHeight:y/2}),Z=Object.assign({},h);Iz(Z,zr(l));const Y=Object.assign({maxPadding:Z,w:_,h:y,x:h.left,y:h.top},h),se=QZ(I.concat(O),j);Wg(s.fullSize,Y,j,se),Wg(I,Y,j,se),Wg(O,Y,j,se)&&Wg(I,Y,j,se),iX(Y),UD(s.leftAndTop,Y,j,se),Y.x+=Y.w,Y.y+=Y.h,UD(s.rightAndBottom,Y,j,se),t.chartArea={left:Y.left,top:Y.top,right:Y.left+Y.w,bottom:Y.top+Y.h,height:Y.h,width:Y.w},jn(s.chartArea,ne=>{const de=ne.box;Object.assign(de,t.chartArea),de.update(Y.w,Y.h,{left:0,top:0,right:0,bottom:0})})}};class Cz{acquireContext(e,r){}releaseContext(e){return!1}addEventListener(e,r,l){}removeEventListener(e,r,l){}getDevicePixelRatio(){return 1}getMaximumSize(e,r,l,h){return r=Math.max(0,r||e.width),l=l||e.height,{width:r,height:Math.max(0,h?Math.floor(r/h):l)}}isAttached(e){return!0}updateConfig(e){}}class sX extends Cz{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Qv="$chartjs",rX={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},jD=t=>t===null||t==="";function oX(t,e){const r=t.style,l=t.getAttribute("height"),h=t.getAttribute("width");if(t[Qv]={initial:{height:l,width:h,style:{display:r.display,height:r.height,width:r.width}}},r.display=r.display||"block",r.boxSizing=r.boxSizing||"border-box",jD(h)){const _=SD(t,"width");_!==void 0&&(t.width=_)}if(jD(l))if(t.style.height==="")t.height=t.width/(e||2);else{const _=SD(t,"height");_!==void 0&&(t.height=_)}return t}const Pz=aZ?{passive:!0}:!1;function aX(t,e,r){t&&t.addEventListener(e,r,Pz)}function lX(t,e,r){t&&t.canvas&&t.canvas.removeEventListener(e,r,Pz)}function cX(t,e){const r=rX[t.type]||t.type,{x:l,y:h}=qh(t,e);return{type:r,chart:e,native:t,x:l!==void 0?l:null,y:h!==void 0?h:null}}function Nx(t,e){for(const r of t)if(r===e||r.contains(e))return!0}function uX(t,e,r){const l=t.canvas,h=new MutationObserver(_=>{let y=!1;for(const s of _)y=y||Nx(s.addedNodes,l),y=y&&!Nx(s.removedNodes,l);y&&r()});return h.observe(document,{childList:!0,subtree:!0}),h}function hX(t,e,r){const l=t.canvas,h=new MutationObserver(_=>{let y=!1;for(const s of _)y=y||Nx(s.removedNodes,l),y=y&&!Nx(s.addedNodes,l);y&&r()});return h.observe(document,{childList:!0,subtree:!0}),h}const B_=new Map;let $D=0;function Dz(){const t=window.devicePixelRatio;t!==$D&&($D=t,B_.forEach((e,r)=>{r.currentDevicePixelRatio!==t&&e()}))}function dX(t,e){B_.size||window.addEventListener("resize",Dz),B_.set(t,e)}function fX(t){B_.delete(t),B_.size||window.removeEventListener("resize",Dz)}function pX(t,e,r){const l=t.canvas,h=l&&y2(l);if(!h)return;const _=oz((s,I)=>{const O=h.clientWidth;r(s,I),O<h.clientWidth&&r()},window),y=new ResizeObserver(s=>{const I=s[0],O=I.contentRect.width,k=I.contentRect.height;O===0&&k===0||_(O,k)});return y.observe(h),dX(t,_),y}function MT(t,e,r){r&&r.disconnect(),e==="resize"&&fX(t)}function mX(t,e,r){const l=t.canvas,h=oz(_=>{t.ctx!==null&&r(cX(_,t))},t);return aX(l,e,h),h}class gX extends Cz{acquireContext(e,r){const l=e&&e.getContext&&e.getContext("2d");return l&&l.canvas===e?(oX(e,r),l):null}releaseContext(e){const r=e.canvas;if(!r[Qv])return!1;const l=r[Qv].initial;["height","width"].forEach(_=>{const y=l[_];vn(y)?r.removeAttribute(_):r.setAttribute(_,y)});const h=l.style||{};return Object.keys(h).forEach(_=>{r.style[_]=h[_]}),r.width=r.width,delete r[Qv],!0}addEventListener(e,r,l){this.removeEventListener(e,r);const h=e.$proxies||(e.$proxies={}),y={attach:uX,detach:hX,resize:pX}[r]||mX;h[r]=y(e,r,l)}removeEventListener(e,r){const l=e.$proxies||(e.$proxies={}),h=l[r];if(!h)return;({attach:MT,detach:MT,resize:MT}[r]||lX)(e,r,h),l[r]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,r,l,h){return oZ(e,r,l,h)}isAttached(e){const r=e&&y2(e);return!!(r&&r.isConnected)}}function _X(t){return!_2()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?sX:gX}var Rv;let lc=(Rv=class{constructor(){ri(this,"x");ri(this,"y");ri(this,"active",!1);ri(this,"options");ri(this,"$animations")}tooltipPosition(e){const{x:r,y:l}=this.getProps(["x","y"],e);return{x:r,y:l}}hasValue(){return xp(this.x)&&xp(this.y)}getProps(e,r){const l=this.$animations;if(!r||!l)return this;const h={};return e.forEach(_=>{h[_]=l[_]&&l[_].active()?l[_]._to:this[_]}),h}},ri(Rv,"defaults",{}),ri(Rv,"defaultRoutes"),Rv);function yX(t,e){const r=t.options.ticks,l=vX(t),h=Math.min(r.maxTicksLimit||l,l),_=r.major.enabled?bX(e):[],y=_.length,s=_[0],I=_[y-1],O=[];if(y>h)return wX(e,O,_,y/h),O;const k=xX(_,e,h);if(y>0){let j,Z;const Y=y>1?Math.round((I-s)/(y-1)):null;for(Tv(e,O,k,vn(Y)?0:s-Y,s),j=0,Z=y-1;j<Z;j++)Tv(e,O,k,_[j],_[j+1]);return Tv(e,O,k,I,vn(Y)?e.length:I+Y),O}return Tv(e,O,k),O}function vX(t){const e=t.options.offset,r=t._tickSize(),l=t._length/r+(e?0:1),h=t._maxLength/r;return Math.floor(Math.min(l,h))}function xX(t,e,r){const l=TX(t),h=e.length/r;if(!l)return Math.max(h,1);const _=c9(l);for(let y=0,s=_.length-1;y<s;y++){const I=_[y];if(I>h)return I}return Math.max(h,1)}function bX(t){const e=[];let r,l;for(r=0,l=t.length;r<l;r++)t[r].major&&e.push(r);return e}function wX(t,e,r,l){let h=0,_=r[0],y;for(l=Math.ceil(l),y=0;y<t.length;y++)y===_&&(e.push(t[y]),h++,_=r[h*l])}function Tv(t,e,r,l,h){const _=ln(l,0),y=Math.min(ln(h,t.length),t.length);let s=0,I,O,k;for(r=Math.ceil(r),h&&(I=h-l,r=I/Math.floor(I/r)),k=_;k<0;)s++,k=Math.round(_+s*r);for(O=Math.max(_,0);O<y;O++)O===k&&(e.push(t[O]),s++,k=Math.round(_+s*r))}function TX(t){const e=t.length;let r,l;if(e<2)return!1;for(l=t[0],r=1;r<e;++r)if(t[r]-t[r-1]!==l)return!1;return l}const EX=t=>t==="left"?"right":t==="right"?"left":t,HD=(t,e,r)=>e==="top"||e==="left"?t[e]+r:t[e]-r,GD=(t,e)=>Math.min(e||t,t);function qD(t,e){const r=[],l=t.length/e,h=t.length;let _=0;for(;_<h;_+=l)r.push(t[Math.floor(_)]);return r}function SX(t,e,r){const l=t.ticks.length,h=Math.min(e,l-1),_=t._startPixel,y=t._endPixel,s=1e-6;let I=t.getPixelForTick(h),O;if(!(r&&(l===1?O=Math.max(I-_,y-I):e===0?O=(t.getPixelForTick(1)-I)/2:O=(I-t.getPixelForTick(h-1))/2,I+=h<e?O:-O,I<_-s||I>y+s)))return I}function AX(t,e){jn(t,r=>{const l=r.gc,h=l.length/2;let _;if(h>e){for(_=0;_<h;++_)delete r.data[l[_]];l.splice(0,h)}})}function Ng(t){return t.drawTicks?t.tickLength:0}function WD(t,e){if(!t.display)return 0;const r=sr(t.font,e),l=zr(t.padding);return(as(t.text)?t.text.length:1)*r.lineHeight+l.height}function MX(t,e){return Uu(t,{scale:e,type:"scale"})}function IX(t,e,r){return Uu(t,{tick:r,index:e,type:"tick"})}function CX(t,e,r){let l=h2(t);return(r&&e!=="right"||!r&&e==="right")&&(l=EX(l)),l}function PX(t,e,r,l){const{top:h,left:_,bottom:y,right:s,chart:I}=t,{chartArea:O,scales:k}=I;let j=0,Z,Y,se;const ne=y-h,de=s-_;if(t.isHorizontal()){if(Y=Ir(l,_,s),bn(r)){const me=Object.keys(r)[0],Te=r[me];se=k[me].getPixelForValue(Te)+ne-e}else r==="center"?se=(O.bottom+O.top)/2+ne-e:se=HD(t,r,e);Z=s-_}else{if(bn(r)){const me=Object.keys(r)[0],Te=r[me];Y=k[me].getPixelForValue(Te)-de+e}else r==="center"?Y=(O.left+O.right)/2-de+e:Y=HD(t,r,e);se=Ir(l,y,h),j=r==="left"?-Bs:Bs}return{titleX:Y,titleY:se,maxWidth:Z,rotation:j}}class wd extends lc{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,r){return e}getUserBounds(){let{_userMin:e,_userMax:r,_suggestedMin:l,_suggestedMax:h}=this;return e=Do(e,Number.POSITIVE_INFINITY),r=Do(r,Number.NEGATIVE_INFINITY),l=Do(l,Number.POSITIVE_INFINITY),h=Do(h,Number.NEGATIVE_INFINITY),{min:Do(e,l),max:Do(r,h),minDefined:Ps(e),maxDefined:Ps(r)}}getMinMax(e){let{min:r,max:l,minDefined:h,maxDefined:_}=this.getUserBounds(),y;if(h&&_)return{min:r,max:l};const s=this.getMatchingVisibleMetas();for(let I=0,O=s.length;I<O;++I)y=s[I].controller.getMinMax(this,e),h||(r=Math.min(r,y.min)),_||(l=Math.max(l,y.max));return r=_&&r>l?l:r,l=h&&r>l?r:l,{min:Do(r,Do(l,r)),max:Do(l,Do(r,l))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ts(this.options.beforeUpdate,[this])}update(e,r,l){const{beginAtZero:h,grace:_,ticks:y}=this.options,s=y.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=r,this._margins=l=Object.assign({left:0,right:0,top:0,bottom:0},l),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+l.left+l.right:this.height+l.top+l.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=B9(this,_,h),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const I=s<this.ticks.length;this._convertTicksToLabels(I?qD(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),y.display&&(y.autoSkip||y.source==="auto")&&(this.ticks=yX(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),I&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,r,l;this.isHorizontal()?(r=this.left,l=this.right):(r=this.top,l=this.bottom,e=!e),this._startPixel=r,this._endPixel=l,this._reversePixels=e,this._length=l-r,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ts(this.options.afterUpdate,[this])}beforeSetDimensions(){ts(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ts(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),ts(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ts(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const r=this.options.ticks;let l,h,_;for(l=0,h=e.length;l<h;l++)_=e[l],_.label=ts(r.callback,[_.value,l,e],this)}afterTickToLabelConversion(){ts(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ts(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,r=e.ticks,l=GD(this.ticks.length,e.ticks.maxTicksLimit),h=r.minRotation||0,_=r.maxRotation;let y=h,s,I,O;if(!this._isVisible()||!r.display||h>=_||l<=1||!this.isHorizontal()){this.labelRotation=h;return}const k=this._getLabelSizes(),j=k.widest.width,Z=k.highest.height,Y=ur(this.chart.width-j,0,this.maxWidth);s=e.offset?this.maxWidth/l:Y/(l-1),j+6>s&&(s=Y/(l-(e.offset?.5:1)),I=this.maxHeight-Ng(e.grid)-r.padding-WD(e.title,this.chart.options.font),O=Math.sqrt(j*j+Z*Z),y=c2(Math.min(Math.asin(ur((k.highest.height+6)/s,-1,1)),Math.asin(ur(I/O,-1,1))-Math.asin(ur(Z/O,-1,1)))),y=Math.max(h,Math.min(_,y))),this.labelRotation=y}afterCalculateLabelRotation(){ts(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ts(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:r,options:{ticks:l,title:h,grid:_}}=this,y=this._isVisible(),s=this.isHorizontal();if(y){const I=WD(h,r.options.font);if(s?(e.width=this.maxWidth,e.height=Ng(_)+I):(e.height=this.maxHeight,e.width=Ng(_)+I),l.display&&this.ticks.length){const{first:O,last:k,widest:j,highest:Z}=this._getLabelSizes(),Y=l.padding*2,se=za(this.labelRotation),ne=Math.cos(se),de=Math.sin(se);if(s){const me=l.mirror?0:de*j.width+ne*Z.height;e.height=Math.min(this.maxHeight,e.height+me+Y)}else{const me=l.mirror?0:ne*j.width+de*Z.height;e.width=Math.min(this.maxWidth,e.width+me+Y)}this._calculatePadding(O,k,de,ne)}}this._handleMargins(),s?(this.width=this._length=r.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=r.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,r,l,h){const{ticks:{align:_,padding:y},position:s}=this.options,I=this.labelRotation!==0,O=s!=="top"&&this.axis==="x";if(this.isHorizontal()){const k=this.getPixelForTick(0)-this.left,j=this.right-this.getPixelForTick(this.ticks.length-1);let Z=0,Y=0;I?O?(Z=h*e.width,Y=l*r.height):(Z=l*e.height,Y=h*r.width):_==="start"?Y=r.width:_==="end"?Z=e.width:_!=="inner"&&(Z=e.width/2,Y=r.width/2),this.paddingLeft=Math.max((Z-k+y)*this.width/(this.width-k),0),this.paddingRight=Math.max((Y-j+y)*this.width/(this.width-j),0)}else{let k=r.height/2,j=e.height/2;_==="start"?(k=0,j=e.height):_==="end"&&(k=r.height,j=0),this.paddingTop=k+y,this.paddingBottom=j+y}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ts(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:r}=this.options;return r==="top"||r==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let r,l;for(r=0,l=e.length;r<l;r++)vn(e[r].label)&&(e.splice(r,1),l--,r--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const r=this.options.ticks.sampleSize;let l=this.ticks;r<l.length&&(l=qD(l,r)),this._labelSizes=e=this._computeLabelSizes(l,l.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,r,l){const{ctx:h,_longestTextCache:_}=this,y=[],s=[],I=Math.floor(r/GD(r,l));let O=0,k=0,j,Z,Y,se,ne,de,me,Te,ge,fe,Ae;for(j=0;j<r;j+=I){if(se=e[j].label,ne=this._resolveTickFontOptions(j),h.font=de=ne.string,me=_[de]=_[de]||{data:{},gc:[]},Te=ne.lineHeight,ge=fe=0,!vn(se)&&!as(se))ge=Fx(h,me.data,me.gc,ge,se),fe=Te;else if(as(se))for(Z=0,Y=se.length;Z<Y;++Z)Ae=se[Z],!vn(Ae)&&!as(Ae)&&(ge=Fx(h,me.data,me.gc,ge,Ae),fe+=Te);y.push(ge),s.push(fe),O=Math.max(ge,O),k=Math.max(fe,k)}AX(_,r);const Ge=y.indexOf(O),ze=s.indexOf(k),Ke=Xe=>({width:y[Xe]||0,height:s[Xe]||0});return{first:Ke(0),last:Ke(r-1),widest:Ke(Ge),highest:Ke(ze),widths:y,heights:s}}getLabelForValue(e){return e}getPixelForValue(e,r){return NaN}getValueForPixel(e){}getPixelForTick(e){const r=this.ticks;return e<0||e>r.length-1?null:this.getPixelForValue(r[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const r=this._startPixel+e*this._length;return f9(this._alignToPixels?jh(this.chart,r,0):r)}getDecimalForPixel(e){const r=(e-this._startPixel)/this._length;return this._reversePixels?1-r:r}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:r}=this;return e<0&&r<0?r:e>0&&r>0?e:0}getContext(e){const r=this.ticks||[];if(e>=0&&e<r.length){const l=r[e];return l.$context||(l.$context=IX(this.getContext(),e,l))}return this.$context||(this.$context=MX(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,r=za(this.labelRotation),l=Math.abs(Math.cos(r)),h=Math.abs(Math.sin(r)),_=this._getLabelSizes(),y=e.autoSkipPadding||0,s=_?_.widest.width+y:0,I=_?_.highest.height+y:0;return this.isHorizontal()?I*l>s*h?s/l:I/h:I*h<s*l?I/l:s/h}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const r=this.axis,l=this.chart,h=this.options,{grid:_,position:y,border:s}=h,I=_.offset,O=this.isHorizontal(),j=this.ticks.length+(I?1:0),Z=Ng(_),Y=[],se=s.setContext(this.getContext()),ne=se.display?se.width:0,de=ne/2,me=function(Rt){return jh(l,Rt,ne)};let Te,ge,fe,Ae,Ge,ze,Ke,Xe,Ue,et,lt,Mt;if(y==="top")Te=me(this.bottom),ze=this.bottom-Z,Xe=Te-de,et=me(e.top)+de,Mt=e.bottom;else if(y==="bottom")Te=me(this.top),et=e.top,Mt=me(e.bottom)-de,ze=Te+de,Xe=this.top+Z;else if(y==="left")Te=me(this.right),Ge=this.right-Z,Ke=Te-de,Ue=me(e.left)+de,lt=e.right;else if(y==="right")Te=me(this.left),Ue=e.left,lt=me(e.right)-de,Ge=Te+de,Ke=this.left+Z;else if(r==="x"){if(y==="center")Te=me((e.top+e.bottom)/2+.5);else if(bn(y)){const Rt=Object.keys(y)[0],Kt=y[Rt];Te=me(this.chart.scales[Rt].getPixelForValue(Kt))}et=e.top,Mt=e.bottom,ze=Te+de,Xe=ze+Z}else if(r==="y"){if(y==="center")Te=me((e.left+e.right)/2);else if(bn(y)){const Rt=Object.keys(y)[0],Kt=y[Rt];Te=me(this.chart.scales[Rt].getPixelForValue(Kt))}Ge=Te-de,Ke=Ge-Z,Ue=e.left,lt=e.right}const si=ln(h.ticks.maxTicksLimit,j),bt=Math.max(1,Math.ceil(j/si));for(ge=0;ge<j;ge+=bt){const Rt=this.getContext(ge),Kt=_.setContext(Rt),ii=s.setContext(Rt),qt=Kt.lineWidth,gn=Kt.color,Hn=ii.dash||[],Ln=ii.dashOffset,li=Kt.tickWidth,ys=Kt.tickColor,is=Kt.tickBorderDash||[],Sn=Kt.tickBorderDashOffset;fe=SX(this,ge,I),fe!==void 0&&(Ae=jh(l,fe,qt),O?Ge=Ke=Ue=lt=Ae:ze=Xe=et=Mt=Ae,Y.push({tx1:Ge,ty1:ze,tx2:Ke,ty2:Xe,x1:Ue,y1:et,x2:lt,y2:Mt,width:qt,color:gn,borderDash:Hn,borderDashOffset:Ln,tickWidth:li,tickColor:ys,tickBorderDash:is,tickBorderDashOffset:Sn}))}return this._ticksLength=j,this._borderValue=Te,Y}_computeLabelItems(e){const r=this.axis,l=this.options,{position:h,ticks:_}=l,y=this.isHorizontal(),s=this.ticks,{align:I,crossAlign:O,padding:k,mirror:j}=_,Z=Ng(l.grid),Y=Z+k,se=j?-k:Y,ne=-za(this.labelRotation),de=[];let me,Te,ge,fe,Ae,Ge,ze,Ke,Xe,Ue,et,lt,Mt="middle";if(h==="top")Ge=this.bottom-se,ze=this._getXAxisLabelAlignment();else if(h==="bottom")Ge=this.top+se,ze=this._getXAxisLabelAlignment();else if(h==="left"){const bt=this._getYAxisLabelAlignment(Z);ze=bt.textAlign,Ae=bt.x}else if(h==="right"){const bt=this._getYAxisLabelAlignment(Z);ze=bt.textAlign,Ae=bt.x}else if(r==="x"){if(h==="center")Ge=(e.top+e.bottom)/2+Y;else if(bn(h)){const bt=Object.keys(h)[0],Rt=h[bt];Ge=this.chart.scales[bt].getPixelForValue(Rt)+Y}ze=this._getXAxisLabelAlignment()}else if(r==="y"){if(h==="center")Ae=(e.left+e.right)/2-Y;else if(bn(h)){const bt=Object.keys(h)[0],Rt=h[bt];Ae=this.chart.scales[bt].getPixelForValue(Rt)}ze=this._getYAxisLabelAlignment(Z).textAlign}r==="y"&&(I==="start"?Mt="top":I==="end"&&(Mt="bottom"));const si=this._getLabelSizes();for(me=0,Te=s.length;me<Te;++me){ge=s[me],fe=ge.label;const bt=_.setContext(this.getContext(me));Ke=this.getPixelForTick(me)+_.labelOffset,Xe=this._resolveTickFontOptions(me),Ue=Xe.lineHeight,et=as(fe)?fe.length:1;const Rt=et/2,Kt=bt.color,ii=bt.textStrokeColor,qt=bt.textStrokeWidth;let gn=ze;y?(Ae=Ke,ze==="inner"&&(me===Te-1?gn=this.options.reverse?"left":"right":me===0?gn=this.options.reverse?"right":"left":gn="center"),h==="top"?O==="near"||ne!==0?lt=-et*Ue+Ue/2:O==="center"?lt=-si.highest.height/2-Rt*Ue+Ue:lt=-si.highest.height+Ue/2:O==="near"||ne!==0?lt=Ue/2:O==="center"?lt=si.highest.height/2-Rt*Ue:lt=si.highest.height-et*Ue,j&&(lt*=-1),ne!==0&&!bt.showLabelBackdrop&&(Ae+=Ue/2*Math.sin(ne))):(Ge=Ke,lt=(1-et)*Ue/2);let Hn;if(bt.showLabelBackdrop){const Ln=zr(bt.backdropPadding),li=si.heights[me],ys=si.widths[me];let is=lt-Ln.top,Sn=0-Ln.left;switch(Mt){case"middle":is-=li/2;break;case"bottom":is-=li;break}switch(ze){case"center":Sn-=ys/2;break;case"right":Sn-=ys;break;case"inner":me===Te-1?Sn-=ys:me>0&&(Sn-=ys/2);break}Hn={left:Sn,top:is,width:ys+Ln.width,height:li+Ln.height,color:bt.backdropColor}}de.push({label:fe,font:Xe,textOffset:lt,options:{rotation:ne,color:Kt,strokeColor:ii,strokeWidth:qt,textAlign:gn,textBaseline:Mt,translation:[Ae,Ge],backdrop:Hn}})}return de}_getXAxisLabelAlignment(){const{position:e,ticks:r}=this.options;if(-za(this.labelRotation))return e==="top"?"left":"right";let h="center";return r.align==="start"?h="left":r.align==="end"?h="right":r.align==="inner"&&(h="inner"),h}_getYAxisLabelAlignment(e){const{position:r,ticks:{crossAlign:l,mirror:h,padding:_}}=this.options,y=this._getLabelSizes(),s=e+_,I=y.widest.width;let O,k;return r==="left"?h?(k=this.right+_,l==="near"?O="left":l==="center"?(O="center",k+=I/2):(O="right",k+=I)):(k=this.right-s,l==="near"?O="right":l==="center"?(O="center",k-=I/2):(O="left",k=this.left)):r==="right"?h?(k=this.left+_,l==="near"?O="right":l==="center"?(O="center",k-=I/2):(O="left",k-=I)):(k=this.left+s,l==="near"?O="left":l==="center"?(O="center",k+=I/2):(O="right",k=this.right)):O="right",{textAlign:O,x:k}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,r=this.options.position;if(r==="left"||r==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(r==="top"||r==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:r},left:l,top:h,width:_,height:y}=this;r&&(e.save(),e.fillStyle=r,e.fillRect(l,h,_,y),e.restore())}getLineWidthForValue(e){const r=this.options.grid;if(!this._isVisible()||!r.display)return 0;const h=this.ticks.findIndex(_=>_.value===e);return h>=0?r.setContext(this.getContext(h)).lineWidth:0}drawGrid(e){const r=this.options.grid,l=this.ctx,h=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let _,y;const s=(I,O,k)=>{!k.width||!k.color||(l.save(),l.lineWidth=k.width,l.strokeStyle=k.color,l.setLineDash(k.borderDash||[]),l.lineDashOffset=k.borderDashOffset,l.beginPath(),l.moveTo(I.x,I.y),l.lineTo(O.x,O.y),l.stroke(),l.restore())};if(r.display)for(_=0,y=h.length;_<y;++_){const I=h[_];r.drawOnChartArea&&s({x:I.x1,y:I.y1},{x:I.x2,y:I.y2},I),r.drawTicks&&s({x:I.tx1,y:I.ty1},{x:I.tx2,y:I.ty2},{color:I.tickColor,width:I.tickWidth,borderDash:I.tickBorderDash,borderDashOffset:I.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:r,options:{border:l,grid:h}}=this,_=l.setContext(this.getContext()),y=l.display?_.width:0;if(!y)return;const s=h.setContext(this.getContext(0)).lineWidth,I=this._borderValue;let O,k,j,Z;this.isHorizontal()?(O=jh(e,this.left,y)-y/2,k=jh(e,this.right,s)+s/2,j=Z=I):(j=jh(e,this.top,y)-y/2,Z=jh(e,this.bottom,s)+s/2,O=k=I),r.save(),r.lineWidth=_.width,r.strokeStyle=_.color,r.beginPath(),r.moveTo(O,j),r.lineTo(k,Z),r.stroke(),r.restore()}drawLabels(e){if(!this.options.ticks.display)return;const l=this.ctx,h=this._computeLabelArea();h&&L1(l,h);const _=this.getLabelItems(e);for(const y of _){const s=y.options,I=y.font,O=y.label,k=y.textOffset;md(l,O,0,k,I,s)}h&&O1(l)}drawTitle(){const{ctx:e,options:{position:r,title:l,reverse:h}}=this;if(!l.display)return;const _=sr(l.font),y=zr(l.padding),s=l.align;let I=_.lineHeight/2;r==="bottom"||r==="center"||bn(r)?(I+=y.bottom,as(l.text)&&(I+=_.lineHeight*(l.text.length-1))):I+=y.top;const{titleX:O,titleY:k,maxWidth:j,rotation:Z}=PX(this,I,r,s);md(e,l.text,0,0,_,{color:l.color,maxWidth:j,rotation:Z,textAlign:CX(s,r,h),textBaseline:"middle",translation:[O,k]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,r=e.ticks&&e.ticks.z||0,l=ln(e.grid&&e.grid.z,-1),h=ln(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==wd.prototype.draw?[{z:r,draw:_=>{this.draw(_)}}]:[{z:l,draw:_=>{this.drawBackground(),this.drawGrid(_),this.drawTitle()}},{z:h,draw:()=>{this.drawBorder()}},{z:r,draw:_=>{this.drawLabels(_)}}]}getMatchingVisibleMetas(e){const r=this.chart.getSortedVisibleDatasetMetas(),l=this.axis+"AxisID",h=[];let _,y;for(_=0,y=r.length;_<y;++_){const s=r[_];s[l]===this.id&&(!e||s.type===e)&&h.push(s)}return h}_resolveTickFontOptions(e){const r=this.options.ticks.setContext(this.getContext(e));return sr(r.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class Ev{constructor(e,r,l){this.type=e,this.scope=r,this.override=l,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const r=Object.getPrototypeOf(e);let l;LX(r)&&(l=this.register(r));const h=this.items,_=e.id,y=this.scope+"."+_;if(!_)throw new Error("class does not have id: "+e);return _ in h||(h[_]=e,DX(e,y,l),this.override&&_s.override(e.id,e.overrides)),y}get(e){return this.items[e]}unregister(e){const r=this.items,l=e.id,h=this.scope;l in r&&delete r[l],h&&l in _s[h]&&(delete _s[h][l],this.override&&delete pd[l])}}function DX(t,e,r){const l=O_(Object.create(null),[r?_s.get(r):{},_s.get(e),t.defaults]);_s.set(e,l),t.defaultRoutes&&RX(e,t.defaultRoutes),t.descriptors&&_s.describe(e,t.descriptors)}function RX(t,e){Object.keys(e).forEach(r=>{const l=r.split("."),h=l.pop(),_=[t].concat(l).join("."),y=e[r].split("."),s=y.pop(),I=y.join(".");_s.route(_,h,I,s)})}function LX(t){return"id"in t&&"defaults"in t}class OX{constructor(){this.controllers=new Ev(Ua,"datasets",!0),this.elements=new Ev(lc,"elements"),this.plugins=new Ev(Object,"plugins"),this.scales=new Ev(wd,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,r,l){[...r].forEach(h=>{const _=l||this._getRegistryForType(h);l||_.isForType(h)||_===this.plugins&&h.id?this._exec(e,_,h):jn(h,y=>{const s=l||this._getRegistryForType(y);this._exec(e,s,y)})})}_exec(e,r,l){const h=l2(e);ts(l["before"+h],[],l),r[e](l),ts(l["after"+h],[],l)}_getRegistryForType(e){for(let r=0;r<this._typedRegistries.length;r++){const l=this._typedRegistries[r];if(l.isForType(e))return l}return this.plugins}_get(e,r,l){const h=r.get(e);if(h===void 0)throw new Error('"'+e+'" is not a registered '+l+".");return h}}var hl=new OX;class kX{constructor(){this._init=[]}notify(e,r,l,h){r==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const _=h?this._descriptors(e).filter(h):this._descriptors(e),y=this._notify(_,e,r,l);return r==="afterDestroy"&&(this._notify(_,e,"stop"),this._notify(this._init,e,"uninstall")),y}_notify(e,r,l,h){h=h||{};for(const _ of e){const y=_.plugin,s=y[l],I=[r,h,_.options];if(ts(s,I,y)===!1&&h.cancelable)return!1}return!0}invalidate(){vn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const r=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),r}_createDescriptors(e,r){const l=e&&e.config,h=ln(l.options&&l.options.plugins,{}),_=zX(l);return h===!1&&!r?[]:BX(e,_,h,r)}_notifyStateChanges(e){const r=this._oldCache||[],l=this._cache,h=(_,y)=>_.filter(s=>!y.some(I=>s.plugin.id===I.plugin.id));this._notify(h(r,l),e,"stop"),this._notify(h(l,r),e,"start")}}function zX(t){const e={},r=[],l=Object.keys(hl.plugins.items);for(let _=0;_<l.length;_++)r.push(hl.getPlugin(l[_]));const h=t.plugins||[];for(let _=0;_<h.length;_++){const y=h[_];r.indexOf(y)===-1&&(r.push(y),e[y.id]=!0)}return{plugins:r,localIds:e}}function FX(t,e){return!e&&t===!1?null:t===!0?{}:t}function BX(t,{plugins:e,localIds:r},l,h){const _=[],y=t.getContext();for(const s of e){const I=s.id,O=FX(l[I],h);O!==null&&_.push({plugin:s,options:NX(t.config,{plugin:s,local:r[I]},O,y)})}return _}function NX(t,{plugin:e,local:r},l,h){const _=t.pluginScopeKeys(e),y=t.getOptionScopes(l,_);return r&&e.defaults&&y.push(e.defaults),t.createResolver(y,h,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function IE(t,e){const r=_s.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||r.indexAxis||"x"}function VX(t,e){let r=t;return t==="_index_"?r=e:t==="_value_"&&(r=e==="x"?"y":"x"),r}function UX(t,e){return t===e?"_index_":"_value_"}function ZD(t){if(t==="x"||t==="y"||t==="r")return t}function jX(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function CE(t,...e){if(ZD(t))return t;for(const r of e){const l=r.axis||jX(r.position)||t.length>1&&ZD(t[0].toLowerCase());if(l)return l}throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function XD(t,e,r){if(r[e+"AxisID"]===t)return{axis:e}}function $X(t,e){if(e.data&&e.data.datasets){const r=e.data.datasets.filter(l=>l.xAxisID===t||l.yAxisID===t);if(r.length)return XD(t,"x",r[0])||XD(t,"y",r[0])}return{}}function HX(t,e){const r=pd[t.type]||{scales:{}},l=e.scales||{},h=IE(t.type,e),_=Object.create(null);return Object.keys(l).forEach(y=>{const s=l[y];if(!bn(s))return console.error(`Invalid scale configuration for scale: ${y}`);if(s._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${y}`);const I=CE(y,s,$X(y,t),_s.scales[s.type]),O=UX(I,h),k=r.scales||{};_[y]=c_(Object.create(null),[{axis:I},s,k[I],k[O]])}),t.data.datasets.forEach(y=>{const s=y.type||t.type,I=y.indexAxis||IE(s,e),k=(pd[s]||{}).scales||{};Object.keys(k).forEach(j=>{const Z=VX(j,I),Y=y[Z+"AxisID"]||Z;_[Y]=_[Y]||Object.create(null),c_(_[Y],[{axis:Z},l[Y],k[j]])})}),Object.keys(_).forEach(y=>{const s=_[y];c_(s,[_s.scales[s.type],_s.scale])}),_}function Rz(t){const e=t.options||(t.options={});e.plugins=ln(e.plugins,{}),e.scales=HX(t,e)}function Lz(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function GX(t){return t=t||{},t.data=Lz(t.data),Rz(t),t}const YD=new Map,Oz=new Set;function Sv(t,e){let r=YD.get(t);return r||(r=e(),YD.set(t,r),Oz.add(r)),r}const Vg=(t,e,r)=>{const l=Ou(e,r);l!==void 0&&t.add(l)};class qX{constructor(e){this._config=GX(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=Lz(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),Rz(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Sv(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,r){return Sv(`${e}.transition.${r}`,()=>[[`datasets.${e}.transitions.${r}`,`transitions.${r}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,r){return Sv(`${e}-${r}`,()=>[[`datasets.${e}.elements.${r}`,`datasets.${e}`,`elements.${r}`,""]])}pluginScopeKeys(e){const r=e.id,l=this.type;return Sv(`${l}-plugin-${r}`,()=>[[`plugins.${r}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,r){const l=this._scopeCache;let h=l.get(e);return(!h||r)&&(h=new Map,l.set(e,h)),h}getOptionScopes(e,r,l){const{options:h,type:_}=this,y=this._cachedScopes(e,l),s=y.get(r);if(s)return s;const I=new Set;r.forEach(k=>{e&&(I.add(e),k.forEach(j=>Vg(I,e,j))),k.forEach(j=>Vg(I,h,j)),k.forEach(j=>Vg(I,pd[_]||{},j)),k.forEach(j=>Vg(I,_s,j)),k.forEach(j=>Vg(I,SE,j))});const O=Array.from(I);return O.length===0&&O.push(Object.create(null)),Oz.has(r)&&y.set(r,O),O}chartOptionScopes(){const{options:e,type:r}=this;return[e,pd[r]||{},_s.datasets[r]||{},{type:r},_s,SE]}resolveNamedOptions(e,r,l,h=[""]){const _={$shared:!0},{resolver:y,subPrefixes:s}=KD(this._resolverCache,e,h);let I=y;if(ZX(y,r)){_.$shared=!1,l=ku(l)?l():l;const O=this.createResolver(e,l,s);I=bp(y,l,O)}for(const O of r)_[O]=I[O];return _}createResolver(e,r,l=[""],h){const{resolver:_}=KD(this._resolverCache,e,l);return bn(r)?bp(_,r,void 0,h):_}}function KD(t,e,r){let l=t.get(e);l||(l=new Map,t.set(e,l));const h=r.join();let _=l.get(h);return _||(_={resolver:p2(e,r),subPrefixes:r.filter(s=>!s.toLowerCase().includes("hover"))},l.set(h,_)),_}const WX=t=>bn(t)&&Object.getOwnPropertyNames(t).some(e=>ku(t[e]));function ZX(t,e){const{isScriptable:r,isIndexable:l}=dz(t);for(const h of e){const _=r(h),y=l(h),s=(y||_)&&t[h];if(_&&(ku(s)||WX(s))||y&&as(s))return!0}return!1}var XX="4.4.9";const YX=["top","bottom","left","right","chartArea"];function JD(t,e){return t==="top"||t==="bottom"||YX.indexOf(t)===-1&&e==="x"}function QD(t,e){return function(r,l){return r[t]===l[t]?r[e]-l[e]:r[t]-l[t]}}function eR(t){const e=t.chart,r=e.options.animation;e.notifyPlugins("afterRender"),ts(r&&r.onComplete,[t],e)}function KX(t){const e=t.chart,r=e.options.animation;ts(r&&r.onProgress,[t],e)}function kz(t){return _2()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const ex={},tR=t=>{const e=kz(t);return Object.values(ex).filter(r=>r.canvas===e).pop()};function JX(t,e,r){const l=Object.keys(t);for(const h of l){const _=+h;if(_>=e){const y=t[h];delete t[h],(r>0||_>e)&&(t[_+r]=y)}}}function QX(t,e,r,l){return!r||t.type==="mouseout"?null:l?e:t}class Gl{static register(...e){hl.add(...e),iR()}static unregister(...e){hl.remove(...e),iR()}constructor(e,r){const l=this.config=new qX(r),h=kz(e),_=tR(h);if(_)throw new Error("Canvas is already in use. Chart with ID '"+_.id+"' must be destroyed before the canvas with ID '"+_.canvas.id+"' can be reused.");const y=l.createResolver(l.chartOptionScopes(),this.getContext());this.platform=new(l.platform||_X(h)),this.platform.updateConfig(l);const s=this.platform.acquireContext(h,y.aspectRatio),I=s&&s.canvas,O=I&&I.height,k=I&&I.width;if(this.id=e9(),this.ctx=s,this.canvas=I,this.width=k,this.height=O,this._options=y,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new kX,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=_9(j=>this.update(j),y.resizeDelay||0),this._dataChanges=[],ex[this.id]=this,!s||!I){console.error("Failed to create chart: can't acquire context from the given item");return}Ul.listen(this,"complete",eR),Ul.listen(this,"progress",KX),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:r},width:l,height:h,_aspectRatio:_}=this;return vn(e)?r&&_?_:h?l/h:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return hl}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ED(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return bD(this.canvas,this.ctx),this}stop(){return Ul.stop(this),this}resize(e,r){Ul.running(this)?this._resizeBeforeDraw={width:e,height:r}:this._resize(e,r)}_resize(e,r){const l=this.options,h=this.canvas,_=l.maintainAspectRatio&&this.aspectRatio,y=this.platform.getMaximumSize(h,e,r,_),s=l.devicePixelRatio||this.platform.getDevicePixelRatio(),I=this.width?"resize":"attach";this.width=y.width,this.height=y.height,this._aspectRatio=this.aspectRatio,ED(this,s,!0)&&(this.notifyPlugins("resize",{size:y}),ts(l.onResize,[this,y],this),this.attached&&this._doResize(I)&&this.render())}ensureScalesHaveIDs(){const r=this.options.scales||{};jn(r,(l,h)=>{l.id=h})}buildOrUpdateScales(){const e=this.options,r=e.scales,l=this.scales,h=Object.keys(l).reduce((y,s)=>(y[s]=!1,y),{});let _=[];r&&(_=_.concat(Object.keys(r).map(y=>{const s=r[y],I=CE(y,s),O=I==="r",k=I==="x";return{options:s,dposition:O?"chartArea":k?"bottom":"left",dtype:O?"radialLinear":k?"category":"linear"}}))),jn(_,y=>{const s=y.options,I=s.id,O=CE(I,s),k=ln(s.type,y.dtype);(s.position===void 0||JD(s.position,O)!==JD(y.dposition))&&(s.position=y.dposition),h[I]=!0;let j=null;if(I in l&&l[I].type===k)j=l[I];else{const Z=hl.getScale(k);j=new Z({id:I,type:k,ctx:this.ctx,chart:this}),l[j.id]=j}j.init(s,e)}),jn(h,(y,s)=>{y||delete l[s]}),jn(l,y=>{Or.configure(this,y,y.options),Or.addBox(this,y)})}_updateMetasets(){const e=this._metasets,r=this.data.datasets.length,l=e.length;if(e.sort((h,_)=>h.index-_.index),l>r){for(let h=r;h<l;++h)this._destroyDatasetMeta(h);e.splice(r,l-r)}this._sortedMetasets=e.slice(0).sort(QD("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:r}}=this;e.length>r.length&&delete this._stacks,e.forEach((l,h)=>{r.filter(_=>_===l._dataset).length===0&&this._destroyDatasetMeta(h)})}buildOrUpdateControllers(){const e=[],r=this.data.datasets;let l,h;for(this._removeUnreferencedMetasets(),l=0,h=r.length;l<h;l++){const _=r[l];let y=this.getDatasetMeta(l);const s=_.type||this.config.type;if(y.type&&y.type!==s&&(this._destroyDatasetMeta(l),y=this.getDatasetMeta(l)),y.type=s,y.indexAxis=_.indexAxis||IE(s,this.options),y.order=_.order||0,y.index=l,y.label=""+_.label,y.visible=this.isDatasetVisible(l),y.controller)y.controller.updateIndex(l),y.controller.linkScales();else{const I=hl.getController(s),{datasetElementType:O,dataElementType:k}=_s.datasets[s];Object.assign(I,{dataElementType:hl.getElement(k),datasetElementType:O&&hl.getElement(O)}),y.controller=new I(this,l),e.push(y.controller)}}return this._updateMetasets(),e}_resetElements(){jn(this.data.datasets,(e,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const r=this.config;r.update();const l=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),h=this._animationsDisabled=!l.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const _=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let y=0;for(let O=0,k=this.data.datasets.length;O<k;O++){const{controller:j}=this.getDatasetMeta(O),Z=!h&&_.indexOf(j)===-1;j.buildOrUpdateElements(Z),y=Math.max(+j.getMaxOverflow(),y)}y=this._minPadding=l.layout.autoPadding?y:0,this._updateLayout(y),h||jn(_,O=>{O.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(QD("z","_idx"));const{_active:s,_lastEvent:I}=this;I?this._eventHandler(I,!0):s.length&&this._updateHoverStyles(s,s,!0),this.render()}_updateScales(){jn(this.scales,e=>{Or.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,r=new Set(Object.keys(this._listeners)),l=new Set(e.events);(!dD(r,l)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,r=this._getUniformDataChanges()||[];for(const{method:l,start:h,count:_}of r){const y=l==="_removeElements"?-_:_;JX(e,h,y)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const r=this.data.datasets.length,l=_=>new Set(e.filter(y=>y[0]===_).map((y,s)=>s+","+y.splice(1).join(","))),h=l(0);for(let _=1;_<r;_++)if(!dD(h,l(_)))return;return Array.from(h).map(_=>_.split(",")).map(_=>({method:_[1],start:+_[2],count:+_[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Or.update(this,this.width,this.height,e);const r=this.chartArea,l=r.width<=0||r.height<=0;this._layers=[],jn(this.boxes,h=>{l&&h.position==="chartArea"||(h.configure&&h.configure(),this._layers.push(...h._layers()))},this),this._layers.forEach((h,_)=>{h._idx=_}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let r=0,l=this.data.datasets.length;r<l;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,l=this.data.datasets.length;r<l;++r)this._updateDataset(r,ku(e)?e({datasetIndex:r}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,r){const l=this.getDatasetMeta(e),h={meta:l,index:e,mode:r,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",h)!==!1&&(l.controller._update(r),h.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",h))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Ul.has(this)?this.attached&&!Ul.running(this)&&Ul.start(this):(this.draw(),eR({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:l,height:h}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(l,h)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const r=this._layers;for(e=0;e<r.length&&r[e].z<=0;++e)r[e].draw(this.chartArea);for(this._drawDatasets();e<r.length;++e)r[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const r=this._sortedMetasets,l=[];let h,_;for(h=0,_=r.length;h<_;++h){const y=r[h];(!e||y.visible)&&l.push(y)}return l}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let r=e.length-1;r>=0;--r)this._drawDataset(e[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const r=this.ctx,l={meta:e,index:e.index,cancelable:!0},h=Tz(this,e);this.notifyPlugins("beforeDatasetDraw",l)!==!1&&(h&&L1(r,h),e.controller.draw(),h&&O1(r),l.cancelable=!1,this.notifyPlugins("afterDatasetDraw",l))}isPointInArea(e){return Jl(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,r,l,h){const _=YZ.modes[r];return typeof _=="function"?_(this,e,l,h):[]}getDatasetMeta(e){const r=this.data.datasets[e],l=this._metasets;let h=l.filter(_=>_&&_._dataset===r).pop();return h||(h={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:e,_dataset:r,_parsed:[],_sorted:!1},l.push(h)),h}getContext(){return this.$context||(this.$context=Uu(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const r=this.data.datasets[e];if(!r)return!1;const l=this.getDatasetMeta(e);return typeof l.hidden=="boolean"?!l.hidden:!r.hidden}setDatasetVisibility(e,r){const l=this.getDatasetMeta(e);l.hidden=!r}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,r,l){const h=l?"show":"hide",_=this.getDatasetMeta(e),y=_.controller._resolveAnimations(void 0,h);k_(r)?(_.data[r].hidden=!l,this.update()):(this.setDatasetVisibility(e,l),y.update(_,{visible:l}),this.update(s=>s.datasetIndex===e?h:void 0))}hide(e,r){this._updateVisibility(e,r,!1)}show(e,r){this._updateVisibility(e,r,!0)}_destroyDatasetMeta(e){const r=this._metasets[e];r&&r.controller&&r.controller._destroy(),delete this._metasets[e]}_stop(){let e,r;for(this.stop(),Ul.remove(this),e=0,r=this.data.datasets.length;e<r;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:r}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),bD(e,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),delete ex[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,r=this.platform,l=(_,y)=>{r.addEventListener(this,_,y),e[_]=y},h=(_,y,s)=>{_.offsetX=y,_.offsetY=s,this._eventHandler(_)};jn(this.options.events,_=>l(_,h))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,r=this.platform,l=(I,O)=>{r.addEventListener(this,I,O),e[I]=O},h=(I,O)=>{e[I]&&(r.removeEventListener(this,I,O),delete e[I])},_=(I,O)=>{this.canvas&&this.resize(I,O)};let y;const s=()=>{h("attach",s),this.attached=!0,this.resize(),l("resize",_),l("detach",y)};y=()=>{this.attached=!1,h("resize",_),this._stop(),this._resize(0,0),l("attach",s)},r.isAttached(this.canvas)?s():y()}unbindEvents(){jn(this._listeners,(e,r)=>{this.platform.removeEventListener(this,r,e)}),this._listeners={},jn(this._responsiveListeners,(e,r)=>{this.platform.removeEventListener(this,r,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,r,l){const h=l?"set":"remove";let _,y,s,I;for(r==="dataset"&&(_=this.getDatasetMeta(e[0].datasetIndex),_.controller["_"+h+"DatasetHoverStyle"]()),s=0,I=e.length;s<I;++s){y=e[s];const O=y&&this.getDatasetMeta(y.datasetIndex).controller;O&&O[h+"HoverStyle"](y.element,y.datasetIndex,y.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const r=this._active||[],l=e.map(({datasetIndex:_,index:y})=>{const s=this.getDatasetMeta(_);if(!s)throw new Error("No dataset found at index "+_);return{datasetIndex:_,element:s.data[y],index:y}});!Ox(l,r)&&(this._active=l,this._lastEvent=null,this._updateHoverStyles(l,r))}notifyPlugins(e,r,l){return this._plugins.notify(this,e,r,l)}isPluginEnabled(e){return this._plugins._cache.filter(r=>r.plugin.id===e).length===1}_updateHoverStyles(e,r,l){const h=this.options.hover,_=(I,O)=>I.filter(k=>!O.some(j=>k.datasetIndex===j.datasetIndex&&k.index===j.index)),y=_(r,e),s=l?e:_(e,r);y.length&&this.updateHoverStyle(y,h.mode,!1),s.length&&h.mode&&this.updateHoverStyle(s,h.mode,!0)}_eventHandler(e,r){const l={event:e,replay:r,cancelable:!0,inChartArea:this.isPointInArea(e)},h=y=>(y.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",l,h)===!1)return;const _=this._handleEvent(e,r,l.inChartArea);return l.cancelable=!1,this.notifyPlugins("afterEvent",l,h),(_||l.changed)&&this.render(),this}_handleEvent(e,r,l){const{_active:h=[],options:_}=this,y=r,s=this._getActiveElements(e,h,l,y),I=o9(e),O=QX(e,this._lastEvent,l,I);l&&(this._lastEvent=null,ts(_.onHover,[e,s,this],this),I&&ts(_.onClick,[e,s,this],this));const k=!Ox(s,h);return(k||r)&&(this._active=s,this._updateHoverStyles(s,h,r)),this._lastEvent=O,k}_getActiveElements(e,r,l,h){if(e.type==="mouseout")return[];if(!l)return r;const _=this.options.hover;return this.getElementsAtEventForMode(e,_.mode,_,h)}}ri(Gl,"defaults",_s),ri(Gl,"instances",ex),ri(Gl,"overrides",pd),ri(Gl,"registry",hl),ri(Gl,"version",XX),ri(Gl,"getChart",tR);function iR(){return jn(Gl.instances,t=>t._plugins.invalidate())}function eY(t,e,r){const{startAngle:l,pixelMargin:h,x:_,y,outerRadius:s,innerRadius:I}=e;let O=h/s;t.beginPath(),t.arc(_,y,s,l-O,r+O),I>h?(O=h/I,t.arc(_,y,I,r+O,l-O,!0)):t.arc(_,y,h,r+Bs,l-Bs),t.closePath(),t.clip()}function tY(t){return f2(t,["outerStart","outerEnd","innerStart","innerEnd"])}function iY(t,e,r,l){const h=tY(t.options.borderRadius),_=(r-e)/2,y=Math.min(_,l*e/2),s=I=>{const O=(r-Math.min(_,I))*l/2;return ur(I,0,Math.min(_,O))};return{outerStart:s(h.outerStart),outerEnd:s(h.outerEnd),innerStart:ur(h.innerStart,0,y),innerEnd:ur(h.innerEnd,0,y)}}function $f(t,e,r,l){return{x:r+t*Math.cos(e),y:l+t*Math.sin(e)}}function Vx(t,e,r,l,h,_){const{x:y,y:s,startAngle:I,pixelMargin:O,innerRadius:k}=e,j=Math.max(e.outerRadius+l+r-O,0),Z=k>0?k+l+r+O:0;let Y=0;const se=h-I;if(l){const bt=k>0?k-l:0,Rt=j>0?j-l:0,Kt=(bt+Rt)/2,ii=Kt!==0?se*Kt/(Kt+l):se;Y=(se-ii)/2}const ne=Math.max(.001,se*j-r/us)/j,de=(se-ne)/2,me=I+de+Y,Te=h-de-Y,{outerStart:ge,outerEnd:fe,innerStart:Ae,innerEnd:Ge}=iY(e,Z,j,Te-me),ze=j-ge,Ke=j-fe,Xe=me+ge/ze,Ue=Te-fe/Ke,et=Z+Ae,lt=Z+Ge,Mt=me+Ae/et,si=Te-Ge/lt;if(t.beginPath(),_){const bt=(Xe+Ue)/2;if(t.arc(y,s,j,Xe,bt),t.arc(y,s,j,bt,Ue),fe>0){const qt=$f(Ke,Ue,y,s);t.arc(qt.x,qt.y,fe,Ue,Te+Bs)}const Rt=$f(lt,Te,y,s);if(t.lineTo(Rt.x,Rt.y),Ge>0){const qt=$f(lt,si,y,s);t.arc(qt.x,qt.y,Ge,Te+Bs,si+Math.PI)}const Kt=(Te-Ge/Z+(me+Ae/Z))/2;if(t.arc(y,s,Z,Te-Ge/Z,Kt,!0),t.arc(y,s,Z,Kt,me+Ae/Z,!0),Ae>0){const qt=$f(et,Mt,y,s);t.arc(qt.x,qt.y,Ae,Mt+Math.PI,me-Bs)}const ii=$f(ze,me,y,s);if(t.lineTo(ii.x,ii.y),ge>0){const qt=$f(ze,Xe,y,s);t.arc(qt.x,qt.y,ge,me-Bs,Xe)}}else{t.moveTo(y,s);const bt=Math.cos(Xe)*j+y,Rt=Math.sin(Xe)*j+s;t.lineTo(bt,Rt);const Kt=Math.cos(Ue)*j+y,ii=Math.sin(Ue)*j+s;t.lineTo(Kt,ii)}t.closePath()}function nY(t,e,r,l,h){const{fullCircles:_,startAngle:y,circumference:s}=e;let I=e.endAngle;if(_){Vx(t,e,r,l,I,h);for(let O=0;O<_;++O)t.fill();isNaN(s)||(I=y+(s%ls||ls))}return Vx(t,e,r,l,I,h),t.fill(),I}function sY(t,e,r,l,h){const{fullCircles:_,startAngle:y,circumference:s,options:I}=e,{borderWidth:O,borderJoinStyle:k,borderDash:j,borderDashOffset:Z}=I,Y=I.borderAlign==="inner";if(!O)return;t.setLineDash(j||[]),t.lineDashOffset=Z,Y?(t.lineWidth=O*2,t.lineJoin=k||"round"):(t.lineWidth=O,t.lineJoin=k||"bevel");let se=e.endAngle;if(_){Vx(t,e,r,l,se,h);for(let ne=0;ne<_;++ne)t.stroke();isNaN(s)||(se=y+(s%ls||ls))}Y&&eY(t,e,se),_||(Vx(t,e,r,l,se,h),t.stroke())}class Zg extends lc{constructor(r){super();ri(this,"circumference");ri(this,"endAngle");ri(this,"fullCircles");ri(this,"innerRadius");ri(this,"outerRadius");ri(this,"pixelMargin");ri(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,r&&Object.assign(this,r)}inRange(r,l,h){const _=this.getProps(["x","y"],h),{angle:y,distance:s}=iz(_,{x:r,y:l}),{startAngle:I,endAngle:O,innerRadius:k,outerRadius:j,circumference:Z}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],h),Y=(this.options.spacing+this.options.borderWidth)/2,se=ln(Z,O-I),ne=z_(y,I,O)&&I!==O,de=se>=ls||ne,me=Yl(s,k+Y,j+Y);return de&&me}getCenterPoint(r){const{x:l,y:h,startAngle:_,endAngle:y,innerRadius:s,outerRadius:I}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],r),{offset:O,spacing:k}=this.options,j=(_+y)/2,Z=(s+I+k+O)/2;return{x:l+Math.cos(j)*Z,y:h+Math.sin(j)*Z}}tooltipPosition(r){return this.getCenterPoint(r)}draw(r){const{options:l,circumference:h}=this,_=(l.offset||0)/4,y=(l.spacing||0)/2,s=l.circular;if(this.pixelMargin=l.borderAlign==="inner"?.33:0,this.fullCircles=h>ls?Math.floor(h/ls):0,h===0||this.innerRadius<0||this.outerRadius<0)return;r.save();const I=(this.startAngle+this.endAngle)/2;r.translate(Math.cos(I)*_,Math.sin(I)*_);const O=1-Math.sin(Math.min(us,h||0)),k=_*O;r.fillStyle=l.backgroundColor,r.strokeStyle=l.borderColor,nY(r,this,k,y,s),sY(r,this,k,y,s),r.restore()}}ri(Zg,"id","arc"),ri(Zg,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),ri(Zg,"defaultRoutes",{backgroundColor:"backgroundColor"}),ri(Zg,"descriptors",{_scriptable:!0,_indexable:r=>r!=="borderDash"});function zz(t,e,r=e){t.lineCap=ln(r.borderCapStyle,e.borderCapStyle),t.setLineDash(ln(r.borderDash,e.borderDash)),t.lineDashOffset=ln(r.borderDashOffset,e.borderDashOffset),t.lineJoin=ln(r.borderJoinStyle,e.borderJoinStyle),t.lineWidth=ln(r.borderWidth,e.borderWidth),t.strokeStyle=ln(r.borderColor,e.borderColor)}function rY(t,e,r){t.lineTo(r.x,r.y)}function oY(t){return t.stepped?C9:t.tension||t.cubicInterpolationMode==="monotone"?P9:rY}function Fz(t,e,r={}){const l=t.length,{start:h=0,end:_=l-1}=r,{start:y,end:s}=e,I=Math.max(h,y),O=Math.min(_,s),k=h<y&&_<y||h>s&&_>s;return{count:l,start:I,loop:e.loop,ilen:O<I&&!k?l+O-I:O-I}}function aY(t,e,r,l){const{points:h,options:_}=e,{count:y,start:s,loop:I,ilen:O}=Fz(h,r,l),k=oY(_);let{move:j=!0,reverse:Z}=l||{},Y,se,ne;for(Y=0;Y<=O;++Y)se=h[(s+(Z?O-Y:Y))%y],!se.skip&&(j?(t.moveTo(se.x,se.y),j=!1):k(t,ne,se,Z,_.stepped),ne=se);return I&&(se=h[(s+(Z?O:0))%y],k(t,ne,se,Z,_.stepped)),!!I}function lY(t,e,r,l){const h=e.points,{count:_,start:y,ilen:s}=Fz(h,r,l),{move:I=!0,reverse:O}=l||{};let k=0,j=0,Z,Y,se,ne,de,me;const Te=fe=>(y+(O?s-fe:fe))%_,ge=()=>{ne!==de&&(t.lineTo(k,de),t.lineTo(k,ne),t.lineTo(k,me))};for(I&&(Y=h[Te(0)],t.moveTo(Y.x,Y.y)),Z=0;Z<=s;++Z){if(Y=h[Te(Z)],Y.skip)continue;const fe=Y.x,Ae=Y.y,Ge=fe|0;Ge===se?(Ae<ne?ne=Ae:Ae>de&&(de=Ae),k=(j*k+fe)/++j):(ge(),t.lineTo(fe,Ae),se=Ge,j=0,ne=de=Ae),me=Ae}ge()}function PE(t){const e=t.options,r=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!r?lY:aY}function cY(t){return t.stepped?lZ:t.tension||t.cubicInterpolationMode==="monotone"?cZ:Wh}function uY(t,e,r,l){let h=e._path;h||(h=e._path=new Path2D,e.path(h,r,l)&&h.closePath()),zz(t,e.options),t.stroke(h)}function hY(t,e,r,l){const{segments:h,options:_}=e,y=PE(e);for(const s of h)zz(t,_,s.style),t.beginPath(),y(t,e,s,{start:r,end:r+l-1})&&t.closePath(),t.stroke()}const dY=typeof Path2D=="function";function fY(t,e,r,l){dY&&!e.options.segment?uY(t,e,r,l):hY(t,e,r,l)}class vu extends lc{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,r){const l=this.options;if((l.tension||l.cubicInterpolationMode==="monotone")&&!l.stepped&&!this._pointsUpdated){const h=l.spanGaps?this._loop:this._fullLoop;eZ(this._points,l,e,h,r),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=mZ(this,this.options.segment))}first(){const e=this.segments,r=this.points;return e.length&&r[e[0].start]}last(){const e=this.segments,r=this.points,l=e.length;return l&&r[e[l-1].end]}interpolate(e,r){const l=this.options,h=e[r],_=this.points,y=wz(this,{property:r,start:h,end:h});if(!y.length)return;const s=[],I=cY(l);let O,k;for(O=0,k=y.length;O<k;++O){const{start:j,end:Z}=y[O],Y=_[j],se=_[Z];if(Y===se){s.push(Y);continue}const ne=Math.abs((h-Y[r])/(se[r]-Y[r])),de=I(Y,se,ne,l.stepped);de[r]=e[r],s.push(de)}return s.length===1?s[0]:s}pathSegment(e,r,l){return PE(this)(e,this,r,l)}path(e,r,l){const h=this.segments,_=PE(this);let y=this._loop;r=r||0,l=l||this.points.length-r;for(const s of h)y&=_(e,this,s,{start:r,end:r+l-1});return!!y}draw(e,r,l,h){const _=this.options||{};(this.points||[]).length&&_.borderWidth&&(e.save(),fY(e,this,l,h),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}ri(vu,"id","line"),ri(vu,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),ri(vu,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),ri(vu,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function nR(t,e,r,l){const h=t.options,{[r]:_}=t.getProps([r],l);return Math.abs(e-_)<h.radius+h.hitRadius}class tx extends lc{constructor(r){super();ri(this,"parsed");ri(this,"skip");ri(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,r&&Object.assign(this,r)}inRange(r,l,h){const _=this.options,{x:y,y:s}=this.getProps(["x","y"],h);return Math.pow(r-y,2)+Math.pow(l-s,2)<Math.pow(_.hitRadius+_.radius,2)}inXRange(r,l){return nR(this,r,"x",l)}inYRange(r,l){return nR(this,r,"y",l)}getCenterPoint(r){const{x:l,y:h}=this.getProps(["x","y"],r);return{x:l,y:h}}size(r){r=r||this.options||{};let l=r.radius||0;l=Math.max(l,l&&r.hoverRadius||0);const h=l&&r.borderWidth||0;return(l+h)*2}draw(r,l){const h=this.options;this.skip||h.radius<.1||!Jl(this,l,this.size(h)/2)||(r.strokeStyle=h.borderColor,r.lineWidth=h.borderWidth,r.fillStyle=h.backgroundColor,AE(r,h,this.x,this.y))}getRange(){const r=this.options||{};return r.radius+r.hitRadius}}ri(tx,"id","point"),ri(tx,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),ri(tx,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Bz(t,e){const{x:r,y:l,base:h,width:_,height:y}=t.getProps(["x","y","base","width","height"],e);let s,I,O,k,j;return t.horizontal?(j=y/2,s=Math.min(r,h),I=Math.max(r,h),O=l-j,k=l+j):(j=_/2,s=r-j,I=r+j,O=Math.min(l,h),k=Math.max(l,h)),{left:s,top:O,right:I,bottom:k}}function xu(t,e,r,l){return t?0:ur(e,r,l)}function pY(t,e,r){const l=t.options.borderWidth,h=t.borderSkipped,_=hz(l);return{t:xu(h.top,_.top,0,r),r:xu(h.right,_.right,0,e),b:xu(h.bottom,_.bottom,0,r),l:xu(h.left,_.left,0,e)}}function mY(t,e,r){const{enableBorderRadius:l}=t.getProps(["enableBorderRadius"]),h=t.options.borderRadius,_=od(h),y=Math.min(e,r),s=t.borderSkipped,I=l||bn(h);return{topLeft:xu(!I||s.top||s.left,_.topLeft,0,y),topRight:xu(!I||s.top||s.right,_.topRight,0,y),bottomLeft:xu(!I||s.bottom||s.left,_.bottomLeft,0,y),bottomRight:xu(!I||s.bottom||s.right,_.bottomRight,0,y)}}function gY(t){const e=Bz(t),r=e.right-e.left,l=e.bottom-e.top,h=pY(t,r/2,l/2),_=mY(t,r/2,l/2);return{outer:{x:e.left,y:e.top,w:r,h:l,radius:_},inner:{x:e.left+h.l,y:e.top+h.t,w:r-h.l-h.r,h:l-h.t-h.b,radius:{topLeft:Math.max(0,_.topLeft-Math.max(h.t,h.l)),topRight:Math.max(0,_.topRight-Math.max(h.t,h.r)),bottomLeft:Math.max(0,_.bottomLeft-Math.max(h.b,h.l)),bottomRight:Math.max(0,_.bottomRight-Math.max(h.b,h.r))}}}}function IT(t,e,r,l){const h=e===null,_=r===null,s=t&&!(h&&_)&&Bz(t,l);return s&&(h||Yl(e,s.left,s.right))&&(_||Yl(r,s.top,s.bottom))}function _Y(t){return t.topLeft||t.topRight||t.bottomLeft||t.bottomRight}function yY(t,e){t.rect(e.x,e.y,e.w,e.h)}function CT(t,e,r={}){const l=t.x!==r.x?-e:0,h=t.y!==r.y?-e:0,_=(t.x+t.w!==r.x+r.w?e:0)-l,y=(t.y+t.h!==r.y+r.h?e:0)-h;return{x:t.x+l,y:t.y+h,w:t.w+_,h:t.h+y,radius:t.radius}}class ix extends lc{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:r,options:{borderColor:l,backgroundColor:h}}=this,{inner:_,outer:y}=gY(this),s=_Y(y.radius)?F_:yY;e.save(),(y.w!==_.w||y.h!==_.h)&&(e.beginPath(),s(e,CT(y,r,_)),e.clip(),s(e,CT(_,-r,y)),e.fillStyle=l,e.fill("evenodd")),e.beginPath(),s(e,CT(_,r)),e.fillStyle=h,e.fill(),e.restore()}inRange(e,r,l){return IT(this,e,r,l)}inXRange(e,r){return IT(this,e,null,r)}inYRange(e,r){return IT(this,null,e,r)}getCenterPoint(e){const{x:r,y:l,base:h,horizontal:_}=this.getProps(["x","y","base","horizontal"],e);return{x:_?(r+h)/2:r,y:_?l:(l+h)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}ri(ix,"id","bar"),ri(ix,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),ri(ix,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var vY=Object.freeze({__proto__:null,ArcElement:Zg,BarElement:ix,LineElement:vu,PointElement:tx});const DE=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],sR=DE.map(t=>t.replace("rgb(","rgba(").replace(")",", 0.5)"));function Nz(t){return DE[t%DE.length]}function Vz(t){return sR[t%sR.length]}function xY(t,e){return t.borderColor=Nz(e),t.backgroundColor=Vz(e),++e}function bY(t,e){return t.backgroundColor=t.data.map(()=>Nz(e++)),e}function wY(t,e){return t.backgroundColor=t.data.map(()=>Vz(e++)),e}function TY(t){let e=0;return(r,l)=>{const h=t.getDatasetMeta(l).controller;h instanceof Qh?e=bY(r,e):h instanceof f_?e=wY(r,e):h&&(e=xY(r,e))}}function rR(t){let e;for(e in t)if(t[e].borderColor||t[e].backgroundColor)return!0;return!1}function EY(t){return t&&(t.borderColor||t.backgroundColor)}function SY(){return _s.borderColor!=="rgba(0,0,0,0.1)"||_s.backgroundColor!=="rgba(0,0,0,0.1)"}var AY={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(t,e,r){if(!r.enabled)return;const{data:{datasets:l},options:h}=t.config,{elements:_}=h,y=rR(l)||EY(h)||_&&rR(_)||SY();if(!r.forceOverride&&y)return;const s=TY(t);l.forEach(s)}};function MY(t,e,r,l,h){const _=h.samples||l;if(_>=r)return t.slice(e,e+r);const y=[],s=(r-2)/(_-2);let I=0;const O=e+r-1;let k=e,j,Z,Y,se,ne;for(y[I++]=t[k],j=0;j<_-2;j++){let de=0,me=0,Te;const ge=Math.floor((j+1)*s)+1+e,fe=Math.min(Math.floor((j+2)*s)+1,r)+e,Ae=fe-ge;for(Te=ge;Te<fe;Te++)de+=t[Te].x,me+=t[Te].y;de/=Ae,me/=Ae;const Ge=Math.floor(j*s)+1+e,ze=Math.min(Math.floor((j+1)*s)+1,r)+e,{x:Ke,y:Xe}=t[k];for(Y=se=-1,Te=Ge;Te<ze;Te++)se=.5*Math.abs((Ke-de)*(t[Te].y-Xe)-(Ke-t[Te].x)*(me-Xe)),se>Y&&(Y=se,Z=t[Te],ne=Te);y[I++]=Z,k=ne}return y[I++]=t[O],y}function IY(t,e,r,l){let h=0,_=0,y,s,I,O,k,j,Z,Y,se,ne;const de=[],me=e+r-1,Te=t[e].x,fe=t[me].x-Te;for(y=e;y<e+r;++y){s=t[y],I=(s.x-Te)/fe*l,O=s.y;const Ae=I|0;if(Ae===k)O<se?(se=O,j=y):O>ne&&(ne=O,Z=y),h=(_*h+s.x)/++_;else{const Ge=y-1;if(!vn(j)&&!vn(Z)){const ze=Math.min(j,Z),Ke=Math.max(j,Z);ze!==Y&&ze!==Ge&&de.push({...t[ze],x:h}),Ke!==Y&&Ke!==Ge&&de.push({...t[Ke],x:h})}y>0&&Ge!==Y&&de.push(t[Ge]),de.push(s),k=Ae,_=0,se=ne=O,j=Z=Y=y}}return de}function Uz(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function oR(t){t.data.datasets.forEach(e=>{Uz(e)})}function CY(t,e){const r=e.length;let l=0,h;const{iScale:_}=t,{min:y,max:s,minDefined:I,maxDefined:O}=_.getUserBounds();return I&&(l=ur(Kl(e,_.axis,y).lo,0,r-1)),O?h=ur(Kl(e,_.axis,s).hi+1,l,r)-l:h=r-l,{start:l,count:h}}var PY={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,r)=>{if(!r.enabled){oR(t);return}const l=t.width;t.data.datasets.forEach((h,_)=>{const{_data:y,indexAxis:s}=h,I=t.getDatasetMeta(_),O=y||h.data;if(qg([s,t.options.indexAxis])==="y"||!I.controller.supportsDecimation)return;const k=t.scales[I.xAxisID];if(k.type!=="linear"&&k.type!=="time"||t.options.parsing)return;let{start:j,count:Z}=CY(I,O);const Y=r.threshold||4*l;if(Z<=Y){Uz(h);return}vn(y)&&(h._data=O,delete h.data,Object.defineProperty(h,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(ne){this._data=ne}}));let se;switch(r.algorithm){case"lttb":se=MY(O,j,Z,l,r);break;case"min-max":se=IY(O,j,Z,l);break;default:throw new Error(`Unsupported decimation algorithm '${r.algorithm}'`)}h._decimated=se})},destroy(t){oR(t)}};function DY(t,e,r){const l=t.segments,h=t.points,_=e.points,y=[];for(const s of l){let{start:I,end:O}=s;O=x2(I,O,h);const k=RE(r,h[I],h[O],s.loop);if(!e.segments){y.push({source:s,target:k,start:h[I],end:h[O]});continue}const j=wz(e,k);for(const Z of j){const Y=RE(r,_[Z.start],_[Z.end],Z.loop),se=bz(s,h,Y);for(const ne of se)y.push({source:ne,target:Z,start:{[r]:aR(k,Y,"start",Math.max)},end:{[r]:aR(k,Y,"end",Math.min)}})}}return y}function RE(t,e,r,l){if(l)return;let h=e[t],_=r[t];return t==="angle"&&(h=Oo(h),_=Oo(_)),{property:t,start:h,end:_}}function RY(t,e){const{x:r=null,y:l=null}=t||{},h=e.points,_=[];return e.segments.forEach(({start:y,end:s})=>{s=x2(y,s,h);const I=h[y],O=h[s];l!==null?(_.push({x:I.x,y:l}),_.push({x:O.x,y:l})):r!==null&&(_.push({x:r,y:I.y}),_.push({x:r,y:O.y}))}),_}function x2(t,e,r){for(;e>t;e--){const l=r[e];if(!isNaN(l.x)&&!isNaN(l.y))break}return e}function aR(t,e,r,l){return t&&e?l(t[r],e[r]):t?t[r]:e?e[r]:0}function jz(t,e){let r=[],l=!1;return as(t)?(l=!0,r=t):r=RY(t,e),r.length?new vu({points:r,options:{tension:0},_loop:l,_fullLoop:l}):null}function lR(t){return t&&t.fill!==!1}function LY(t,e,r){let h=t[e].fill;const _=[e];let y;if(!r)return h;for(;h!==!1&&_.indexOf(h)===-1;){if(!Ps(h))return h;if(y=t[h],!y)return!1;if(y.visible)return h;_.push(h),h=y.fill}return!1}function OY(t,e,r){const l=BY(t);if(bn(l))return isNaN(l.value)?!1:l;let h=parseFloat(l);return Ps(h)&&Math.floor(h)===h?kY(l[0],e,h,r):["origin","start","end","stack","shape"].indexOf(l)>=0&&l}function kY(t,e,r,l){return(t==="-"||t==="+")&&(r=e+r),r===e||r<0||r>=l?!1:r}function zY(t,e){let r=null;return t==="start"?r=e.bottom:t==="end"?r=e.top:bn(t)?r=e.getPixelForValue(t.value):e.getBasePixel&&(r=e.getBasePixel()),r}function FY(t,e,r){let l;return t==="start"?l=r:t==="end"?l=e.options.reverse?e.min:e.max:bn(t)?l=t.value:l=e.getBaseValue(),l}function BY(t){const e=t.options,r=e.fill;let l=ln(r&&r.target,r);return l===void 0&&(l=!!e.backgroundColor),l===!1||l===null?!1:l===!0?"origin":l}function NY(t){const{scale:e,index:r,line:l}=t,h=[],_=l.segments,y=l.points,s=VY(e,r);s.push(jz({x:null,y:e.bottom},l));for(let I=0;I<_.length;I++){const O=_[I];for(let k=O.start;k<=O.end;k++)UY(h,y[k],s)}return new vu({points:h,options:{}})}function VY(t,e){const r=[],l=t.getMatchingVisibleMetas("line");for(let h=0;h<l.length;h++){const _=l[h];if(_.index===e)break;_.hidden||r.unshift(_.dataset)}return r}function UY(t,e,r){const l=[];for(let h=0;h<r.length;h++){const _=r[h],{first:y,last:s,point:I}=jY(_,e,"x");if(!(!I||y&&s)){if(y)l.unshift(I);else if(t.push(I),!s)break}}t.push(...l)}function jY(t,e,r){const l=t.interpolate(e,r);if(!l)return{};const h=l[r],_=t.segments,y=t.points;let s=!1,I=!1;for(let O=0;O<_.length;O++){const k=_[O],j=y[k.start][r],Z=y[k.end][r];if(Yl(h,j,Z)){s=h===j,I=h===Z;break}}return{first:s,last:I,point:l}}class $z{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,r,l){const{x:h,y:_,radius:y}=this;return r=r||{start:0,end:ls},e.arc(h,_,y,r.end,r.start,!0),!l.bounds}interpolate(e){const{x:r,y:l,radius:h}=this,_=e.angle;return{x:r+Math.cos(_)*h,y:l+Math.sin(_)*h,angle:_}}}function $Y(t){const{chart:e,fill:r,line:l}=t;if(Ps(r))return HY(e,r);if(r==="stack")return NY(t);if(r==="shape")return!0;const h=GY(t);return h instanceof $z?h:jz(h,l)}function HY(t,e){const r=t.getDatasetMeta(e);return r&&t.isDatasetVisible(e)?r.dataset:null}function GY(t){return(t.scale||{}).getPointPositionForValue?WY(t):qY(t)}function qY(t){const{scale:e={},fill:r}=t,l=zY(r,e);if(Ps(l)){const h=e.isHorizontal();return{x:h?l:null,y:h?null:l}}return null}function WY(t){const{scale:e,fill:r}=t,l=e.options,h=e.getLabels().length,_=l.reverse?e.max:e.min,y=FY(r,e,_),s=[];if(l.grid.circular){const I=e.getPointPositionForValue(0,_);return new $z({x:I.x,y:I.y,radius:e.getDistanceFromCenterForValue(y)})}for(let I=0;I<h;++I)s.push(e.getPointPositionForValue(I,y));return s}function PT(t,e,r){const l=$Y(e),{chart:h,index:_,line:y,scale:s,axis:I}=e,O=y.options,k=O.fill,j=O.backgroundColor,{above:Z=j,below:Y=j}=k||{},se=h.getDatasetMeta(_),ne=Tz(h,se);l&&y.points.length&&(L1(t,r),ZY(t,{line:y,target:l,above:Z,below:Y,area:r,scale:s,axis:I,clip:ne}),O1(t))}function ZY(t,e){const{line:r,target:l,above:h,below:_,area:y,scale:s,clip:I}=e,O=r._loop?"angle":e.axis;t.save(),O==="x"&&_!==h&&(cR(t,l,y.top),uR(t,{line:r,target:l,color:h,scale:s,property:O,clip:I}),t.restore(),t.save(),cR(t,l,y.bottom)),uR(t,{line:r,target:l,color:_,scale:s,property:O,clip:I}),t.restore()}function cR(t,e,r){const{segments:l,points:h}=e;let _=!0,y=!1;t.beginPath();for(const s of l){const{start:I,end:O}=s,k=h[I],j=h[x2(I,O,h)];_?(t.moveTo(k.x,k.y),_=!1):(t.lineTo(k.x,r),t.lineTo(k.x,k.y)),y=!!e.pathSegment(t,s,{move:y}),y?t.closePath():t.lineTo(j.x,r)}t.lineTo(e.first().x,r),t.closePath(),t.clip()}function uR(t,e){const{line:r,target:l,property:h,color:_,scale:y,clip:s}=e,I=DY(r,l,h);for(const{source:O,target:k,start:j,end:Z}of I){const{style:{backgroundColor:Y=_}={}}=O,se=l!==!0;t.save(),t.fillStyle=Y,XY(t,y,s,se&&RE(h,j,Z)),t.beginPath();const ne=!!r.pathSegment(t,O);let de;if(se){ne?t.closePath():hR(t,l,Z,h);const me=!!l.pathSegment(t,k,{move:ne,reverse:!0});de=ne&&me,de||hR(t,l,j,h)}t.closePath(),t.fill(de?"evenodd":"nonzero"),t.restore()}}function XY(t,e,r,l){const h=e.chart.chartArea,{property:_,start:y,end:s}=l||{};if(_==="x"||_==="y"){let I,O,k,j;_==="x"?(I=y,O=h.top,k=s,j=h.bottom):(I=h.left,O=y,k=h.right,j=s),t.beginPath(),r&&(I=Math.max(I,r.left),k=Math.min(k,r.right),O=Math.max(O,r.top),j=Math.min(j,r.bottom)),t.rect(I,O,k-I,j-O),t.clip()}}function hR(t,e,r,l){const h=e.interpolate(r,l);h&&t.lineTo(h.x,h.y)}var YY={id:"filler",afterDatasetsUpdate(t,e,r){const l=(t.data.datasets||[]).length,h=[];let _,y,s,I;for(y=0;y<l;++y)_=t.getDatasetMeta(y),s=_.dataset,I=null,s&&s.options&&s instanceof vu&&(I={visible:t.isDatasetVisible(y),index:y,fill:OY(s,y,l),chart:t,axis:_.controller.options.indexAxis,scale:_.vScale,line:s}),_.$filler=I,h.push(I);for(y=0;y<l;++y)I=h[y],!(!I||I.fill===!1)&&(I.fill=LY(h,y,r.propagate))},beforeDraw(t,e,r){const l=r.drawTime==="beforeDraw",h=t.getSortedVisibleDatasetMetas(),_=t.chartArea;for(let y=h.length-1;y>=0;--y){const s=h[y].$filler;s&&(s.line.updateControlPoints(_,s.axis),l&&s.fill&&PT(t.ctx,s,_))}},beforeDatasetsDraw(t,e,r){if(r.drawTime!=="beforeDatasetsDraw")return;const l=t.getSortedVisibleDatasetMetas();for(let h=l.length-1;h>=0;--h){const _=l[h].$filler;lR(_)&&PT(t.ctx,_,t.chartArea)}},beforeDatasetDraw(t,e,r){const l=e.meta.$filler;!lR(l)||r.drawTime!=="beforeDatasetDraw"||PT(t.ctx,l,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const dR=(t,e)=>{let{boxHeight:r=e,boxWidth:l=e}=t;return t.usePointStyle&&(r=Math.min(r,e),l=t.pointStyleWidth||Math.min(l,e)),{boxWidth:l,boxHeight:r,itemHeight:Math.max(e,r)}},KY=(t,e)=>t!==null&&e!==null&&t.datasetIndex===e.datasetIndex&&t.index===e.index;class fR extends lc{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,r,l){this.maxWidth=e,this.maxHeight=r,this._margins=l,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let r=ts(e.generateLabels,[this.chart],this)||[];e.filter&&(r=r.filter(l=>e.filter(l,this.chart.data))),e.sort&&(r=r.sort((l,h)=>e.sort(l,h,this.chart.data))),this.options.reverse&&r.reverse(),this.legendItems=r}fit(){const{options:e,ctx:r}=this;if(!e.display){this.width=this.height=0;return}const l=e.labels,h=sr(l.font),_=h.size,y=this._computeTitleHeight(),{boxWidth:s,itemHeight:I}=dR(l,_);let O,k;r.font=h.string,this.isHorizontal()?(O=this.maxWidth,k=this._fitRows(y,_,s,I)+10):(k=this.maxHeight,O=this._fitCols(y,h,s,I)+10),this.width=Math.min(O,e.maxWidth||this.maxWidth),this.height=Math.min(k,e.maxHeight||this.maxHeight)}_fitRows(e,r,l,h){const{ctx:_,maxWidth:y,options:{labels:{padding:s}}}=this,I=this.legendHitBoxes=[],O=this.lineWidths=[0],k=h+s;let j=e;_.textAlign="left",_.textBaseline="middle";let Z=-1,Y=-k;return this.legendItems.forEach((se,ne)=>{const de=l+r/2+_.measureText(se.text).width;(ne===0||O[O.length-1]+de+2*s>y)&&(j+=k,O[O.length-(ne>0?0:1)]=0,Y+=k,Z++),I[ne]={left:0,top:Y,row:Z,width:de,height:h},O[O.length-1]+=de+s}),j}_fitCols(e,r,l,h){const{ctx:_,maxHeight:y,options:{labels:{padding:s}}}=this,I=this.legendHitBoxes=[],O=this.columnSizes=[],k=y-e;let j=s,Z=0,Y=0,se=0,ne=0;return this.legendItems.forEach((de,me)=>{const{itemWidth:Te,itemHeight:ge}=JY(l,r,_,de,h);me>0&&Y+ge+2*s>k&&(j+=Z+s,O.push({width:Z,height:Y}),se+=Z+s,ne++,Z=Y=0),I[me]={left:se,top:Y,col:ne,width:Te,height:ge},Z=Math.max(Z,Te),Y+=ge+s}),j+=Z,O.push({width:Z,height:Y}),j}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:r,options:{align:l,labels:{padding:h},rtl:_}}=this,y=sp(_,this.left,this.width);if(this.isHorizontal()){let s=0,I=Ir(l,this.left+h,this.right-this.lineWidths[s]);for(const O of r)s!==O.row&&(s=O.row,I=Ir(l,this.left+h,this.right-this.lineWidths[s])),O.top+=this.top+e+h,O.left=y.leftForLtr(y.x(I),O.width),I+=O.width+h}else{let s=0,I=Ir(l,this.top+e+h,this.bottom-this.columnSizes[s].height);for(const O of r)O.col!==s&&(s=O.col,I=Ir(l,this.top+e+h,this.bottom-this.columnSizes[s].height)),O.top=I,O.left+=this.left+h,O.left=y.leftForLtr(y.x(O.left),O.width),I+=O.height+h}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;L1(e,this),this._draw(),O1(e)}}_draw(){const{options:e,columnSizes:r,lineWidths:l,ctx:h}=this,{align:_,labels:y}=e,s=_s.color,I=sp(e.rtl,this.left,this.width),O=sr(y.font),{padding:k}=y,j=O.size,Z=j/2;let Y;this.drawTitle(),h.textAlign=I.textAlign("left"),h.textBaseline="middle",h.lineWidth=.5,h.font=O.string;const{boxWidth:se,boxHeight:ne,itemHeight:de}=dR(y,j),me=function(Ge,ze,Ke){if(isNaN(se)||se<=0||isNaN(ne)||ne<0)return;h.save();const Xe=ln(Ke.lineWidth,1);if(h.fillStyle=ln(Ke.fillStyle,s),h.lineCap=ln(Ke.lineCap,"butt"),h.lineDashOffset=ln(Ke.lineDashOffset,0),h.lineJoin=ln(Ke.lineJoin,"miter"),h.lineWidth=Xe,h.strokeStyle=ln(Ke.strokeStyle,s),h.setLineDash(ln(Ke.lineDash,[])),y.usePointStyle){const Ue={radius:ne*Math.SQRT2/2,pointStyle:Ke.pointStyle,rotation:Ke.rotation,borderWidth:Xe},et=I.xPlus(Ge,se/2),lt=ze+Z;uz(h,Ue,et,lt,y.pointStyleWidth&&se)}else{const Ue=ze+Math.max((j-ne)/2,0),et=I.leftForLtr(Ge,se),lt=od(Ke.borderRadius);h.beginPath(),Object.values(lt).some(Mt=>Mt!==0)?F_(h,{x:et,y:Ue,w:se,h:ne,radius:lt}):h.rect(et,Ue,se,ne),h.fill(),Xe!==0&&h.stroke()}h.restore()},Te=function(Ge,ze,Ke){md(h,Ke.text,Ge,ze+de/2,O,{strikethrough:Ke.hidden,textAlign:I.textAlign(Ke.textAlign)})},ge=this.isHorizontal(),fe=this._computeTitleHeight();ge?Y={x:Ir(_,this.left+k,this.right-l[0]),y:this.top+k+fe,line:0}:Y={x:this.left+k,y:Ir(_,this.top+fe+k,this.bottom-r[0].height),line:0},yz(this.ctx,e.textDirection);const Ae=de+k;this.legendItems.forEach((Ge,ze)=>{h.strokeStyle=Ge.fontColor,h.fillStyle=Ge.fontColor;const Ke=h.measureText(Ge.text).width,Xe=I.textAlign(Ge.textAlign||(Ge.textAlign=y.textAlign)),Ue=se+Z+Ke;let et=Y.x,lt=Y.y;I.setWidth(this.width),ge?ze>0&&et+Ue+k>this.right&&(lt=Y.y+=Ae,Y.line++,et=Y.x=Ir(_,this.left+k,this.right-l[Y.line])):ze>0&&lt+Ae>this.bottom&&(et=Y.x=et+r[Y.line].width+k,Y.line++,lt=Y.y=Ir(_,this.top+fe+k,this.bottom-r[Y.line].height));const Mt=I.x(et);if(me(Mt,lt,Ge),et=y9(Xe,et+se+Z,ge?et+Ue:this.right,e.rtl),Te(I.x(et),lt,Ge),ge)Y.x+=Ue+k;else if(typeof Ge.text!="string"){const si=O.lineHeight;Y.y+=Hz(Ge,si)+k}else Y.y+=Ae}),vz(this.ctx,e.textDirection)}drawTitle(){const e=this.options,r=e.title,l=sr(r.font),h=zr(r.padding);if(!r.display)return;const _=sp(e.rtl,this.left,this.width),y=this.ctx,s=r.position,I=l.size/2,O=h.top+I;let k,j=this.left,Z=this.width;if(this.isHorizontal())Z=Math.max(...this.lineWidths),k=this.top+O,j=Ir(e.align,j,this.right-Z);else{const se=this.columnSizes.reduce((ne,de)=>Math.max(ne,de.height),0);k=O+Ir(e.align,this.top,this.bottom-se-e.labels.padding-this._computeTitleHeight())}const Y=Ir(s,j,j+Z);y.textAlign=_.textAlign(h2(s)),y.textBaseline="middle",y.strokeStyle=r.color,y.fillStyle=r.color,y.font=l.string,md(y,r.text,Y,k,l)}_computeTitleHeight(){const e=this.options.title,r=sr(e.font),l=zr(e.padding);return e.display?r.lineHeight+l.height:0}_getLegendItemAt(e,r){let l,h,_;if(Yl(e,this.left,this.right)&&Yl(r,this.top,this.bottom)){for(_=this.legendHitBoxes,l=0;l<_.length;++l)if(h=_[l],Yl(e,h.left,h.left+h.width)&&Yl(r,h.top,h.top+h.height))return this.legendItems[l]}return null}handleEvent(e){const r=this.options;if(!tK(e.type,r))return;const l=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const h=this._hoveredItem,_=KY(h,l);h&&!_&&ts(r.onLeave,[e,h,this],this),this._hoveredItem=l,l&&!_&&ts(r.onHover,[e,l,this],this)}else l&&ts(r.onClick,[e,l,this],this)}}function JY(t,e,r,l,h){const _=QY(l,t,e,r),y=eK(h,l,e.lineHeight);return{itemWidth:_,itemHeight:y}}function QY(t,e,r,l){let h=t.text;return h&&typeof h!="string"&&(h=h.reduce((_,y)=>_.length>y.length?_:y)),e+r.size/2+l.measureText(h).width}function eK(t,e,r){let l=t;return typeof e.text!="string"&&(l=Hz(e,r)),l}function Hz(t,e){const r=t.text?t.text.length:0;return e*r}function tK(t,e){return!!((t==="mousemove"||t==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(t==="click"||t==="mouseup"))}var iK={id:"legend",_element:fR,start(t,e,r){const l=t.legend=new fR({ctx:t.ctx,options:r,chart:t});Or.configure(t,l,r),Or.addBox(t,l)},stop(t){Or.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,r){const l=t.legend;Or.configure(t,l,r),l.options=r},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,r){const l=e.datasetIndex,h=r.chart;h.isDatasetVisible(l)?(h.hide(l),e.hidden=!0):(h.show(l),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:r,pointStyle:l,textAlign:h,color:_,useBorderRadius:y,borderRadius:s}}=t.legend.options;return t._getSortedDatasetMetas().map(I=>{const O=I.controller.getStyle(r?0:void 0),k=zr(O.borderWidth);return{text:e[I.index].label,fillStyle:O.backgroundColor,fontColor:_,hidden:!I.visible,lineCap:O.borderCapStyle,lineDash:O.borderDash,lineDashOffset:O.borderDashOffset,lineJoin:O.borderJoinStyle,lineWidth:(k.width+k.height)/4,strokeStyle:O.borderColor,pointStyle:l||O.pointStyle,rotation:O.rotation,textAlign:h||O.textAlign,borderRadius:y&&(s||O.borderRadius),datasetIndex:I.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class b2 extends lc{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,r){const l=this.options;if(this.left=0,this.top=0,!l.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=r;const h=as(l.text)?l.text.length:1;this._padding=zr(l.padding);const _=h*sr(l.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=_:this.width=_}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:r,left:l,bottom:h,right:_,options:y}=this,s=y.align;let I=0,O,k,j;return this.isHorizontal()?(k=Ir(s,l,_),j=r+e,O=_-l):(y.position==="left"?(k=l+e,j=Ir(s,h,r),I=us*-.5):(k=_-e,j=Ir(s,r,h),I=us*.5),O=h-r),{titleX:k,titleY:j,maxWidth:O,rotation:I}}draw(){const e=this.ctx,r=this.options;if(!r.display)return;const l=sr(r.font),_=l.lineHeight/2+this._padding.top,{titleX:y,titleY:s,maxWidth:I,rotation:O}=this._drawArgs(_);md(e,r.text,0,0,l,{color:r.color,maxWidth:I,rotation:O,textAlign:h2(r.align),textBaseline:"middle",translation:[y,s]})}}function nK(t,e){const r=new b2({ctx:t.ctx,options:e,chart:t});Or.configure(t,r,e),Or.addBox(t,r),t.titleBlock=r}var sK={id:"title",_element:b2,start(t,e,r){nK(t,r)},stop(t){const e=t.titleBlock;Or.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,r){const l=t.titleBlock;Or.configure(t,l,r),l.options=r},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Av=new WeakMap;var rK={id:"subtitle",start(t,e,r){const l=new b2({ctx:t.ctx,options:r,chart:t});Or.configure(t,l,r),Or.addBox(t,l),Av.set(t,l)},stop(t){Or.removeBox(t,Av.get(t)),Av.delete(t)},beforeUpdate(t,e,r){const l=Av.get(t);Or.configure(t,l,r),l.options=r},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Xg={average(t){if(!t.length)return!1;let e,r,l=new Set,h=0,_=0;for(e=0,r=t.length;e<r;++e){const s=t[e].element;if(s&&s.hasValue()){const I=s.tooltipPosition();l.add(I.x),h+=I.y,++_}}return _===0||l.size===0?!1:{x:[...l].reduce((s,I)=>s+I)/l.size,y:h/_}},nearest(t,e){if(!t.length)return!1;let r=e.x,l=e.y,h=Number.POSITIVE_INFINITY,_,y,s;for(_=0,y=t.length;_<y;++_){const I=t[_].element;if(I&&I.hasValue()){const O=I.getCenterPoint(),k=EE(e,O);k<h&&(h=k,s=I)}}if(s){const I=s.tooltipPosition();r=I.x,l=I.y}return{x:r,y:l}}};function cl(t,e){return e&&(as(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function jl(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function oK(t,e){const{element:r,datasetIndex:l,index:h}=e,_=t.getDatasetMeta(l).controller,{label:y,value:s}=_.getLabelAndValue(h);return{chart:t,label:y,parsed:_.getParsed(h),raw:t.data.datasets[l].data[h],formattedValue:s,dataset:_.getDataset(),dataIndex:h,datasetIndex:l,element:r}}function pR(t,e){const r=t.chart.ctx,{body:l,footer:h,title:_}=t,{boxWidth:y,boxHeight:s}=e,I=sr(e.bodyFont),O=sr(e.titleFont),k=sr(e.footerFont),j=_.length,Z=h.length,Y=l.length,se=zr(e.padding);let ne=se.height,de=0,me=l.reduce((fe,Ae)=>fe+Ae.before.length+Ae.lines.length+Ae.after.length,0);if(me+=t.beforeBody.length+t.afterBody.length,j&&(ne+=j*O.lineHeight+(j-1)*e.titleSpacing+e.titleMarginBottom),me){const fe=e.displayColors?Math.max(s,I.lineHeight):I.lineHeight;ne+=Y*fe+(me-Y)*I.lineHeight+(me-1)*e.bodySpacing}Z&&(ne+=e.footerMarginTop+Z*k.lineHeight+(Z-1)*e.footerSpacing);let Te=0;const ge=function(fe){de=Math.max(de,r.measureText(fe).width+Te)};return r.save(),r.font=O.string,jn(t.title,ge),r.font=I.string,jn(t.beforeBody.concat(t.afterBody),ge),Te=e.displayColors?y+2+e.boxPadding:0,jn(l,fe=>{jn(fe.before,ge),jn(fe.lines,ge),jn(fe.after,ge)}),Te=0,r.font=k.string,jn(t.footer,ge),r.restore(),de+=se.width,{width:de,height:ne}}function aK(t,e){const{y:r,height:l}=e;return r<l/2?"top":r>t.height-l/2?"bottom":"center"}function lK(t,e,r,l){const{x:h,width:_}=l,y=r.caretSize+r.caretPadding;if(t==="left"&&h+_+y>e.width||t==="right"&&h-_-y<0)return!0}function cK(t,e,r,l){const{x:h,width:_}=r,{width:y,chartArea:{left:s,right:I}}=t;let O="center";return l==="center"?O=h<=(s+I)/2?"left":"right":h<=_/2?O="left":h>=y-_/2&&(O="right"),lK(O,t,e,r)&&(O="center"),O}function mR(t,e,r){const l=r.yAlign||e.yAlign||aK(t,r);return{xAlign:r.xAlign||e.xAlign||cK(t,e,r,l),yAlign:l}}function uK(t,e){let{x:r,width:l}=t;return e==="right"?r-=l:e==="center"&&(r-=l/2),r}function hK(t,e,r){let{y:l,height:h}=t;return e==="top"?l+=r:e==="bottom"?l-=h+r:l-=h/2,l}function gR(t,e,r,l){const{caretSize:h,caretPadding:_,cornerRadius:y}=t,{xAlign:s,yAlign:I}=r,O=h+_,{topLeft:k,topRight:j,bottomLeft:Z,bottomRight:Y}=od(y);let se=uK(e,s);const ne=hK(e,I,O);return I==="center"?s==="left"?se+=O:s==="right"&&(se-=O):s==="left"?se-=Math.max(k,Z)+h:s==="right"&&(se+=Math.max(j,Y)+h),{x:ur(se,0,l.width-e.width),y:ur(ne,0,l.height-e.height)}}function Mv(t,e,r){const l=zr(r.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-l.right:t.x+l.left}function _R(t){return cl([],jl(t))}function dK(t,e,r){return Uu(t,{tooltip:e,tooltipItems:r,type:"tooltip"})}function yR(t,e){const r=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return r?t.override(r):t}const Gz={beforeTitle:Nl,title(t){if(t.length>0){const e=t[0],r=e.chart.data.labels,l=r?r.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(l>0&&e.dataIndex<l)return r[e.dataIndex]}return""},afterTitle:Nl,beforeBody:Nl,beforeLabel:Nl,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const r=t.formattedValue;return vn(r)||(e+=r),e},labelColor(t){const r=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:r.borderColor,backgroundColor:r.backgroundColor,borderWidth:r.borderWidth,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const r=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:r.pointStyle,rotation:r.rotation}},afterLabel:Nl,afterBody:Nl,beforeFooter:Nl,footer:Nl,afterFooter:Nl};function ho(t,e,r,l){const h=t[e].call(r,l);return typeof h>"u"?Gz[e].call(r,l):h}class LE extends lc{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const r=this.chart,l=this.options.setContext(this.getContext()),h=l.enabled&&r.options.animation&&l.animations,_=new Ez(this.chart,h);return h._cacheable&&(this._cachedAnimations=Object.freeze(_)),_}getContext(){return this.$context||(this.$context=dK(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,r){const{callbacks:l}=r,h=ho(l,"beforeTitle",this,e),_=ho(l,"title",this,e),y=ho(l,"afterTitle",this,e);let s=[];return s=cl(s,jl(h)),s=cl(s,jl(_)),s=cl(s,jl(y)),s}getBeforeBody(e,r){return _R(ho(r.callbacks,"beforeBody",this,e))}getBody(e,r){const{callbacks:l}=r,h=[];return jn(e,_=>{const y={before:[],lines:[],after:[]},s=yR(l,_);cl(y.before,jl(ho(s,"beforeLabel",this,_))),cl(y.lines,ho(s,"label",this,_)),cl(y.after,jl(ho(s,"afterLabel",this,_))),h.push(y)}),h}getAfterBody(e,r){return _R(ho(r.callbacks,"afterBody",this,e))}getFooter(e,r){const{callbacks:l}=r,h=ho(l,"beforeFooter",this,e),_=ho(l,"footer",this,e),y=ho(l,"afterFooter",this,e);let s=[];return s=cl(s,jl(h)),s=cl(s,jl(_)),s=cl(s,jl(y)),s}_createItems(e){const r=this._active,l=this.chart.data,h=[],_=[],y=[];let s=[],I,O;for(I=0,O=r.length;I<O;++I)s.push(oK(this.chart,r[I]));return e.filter&&(s=s.filter((k,j,Z)=>e.filter(k,j,Z,l))),e.itemSort&&(s=s.sort((k,j)=>e.itemSort(k,j,l))),jn(s,k=>{const j=yR(e.callbacks,k);h.push(ho(j,"labelColor",this,k)),_.push(ho(j,"labelPointStyle",this,k)),y.push(ho(j,"labelTextColor",this,k))}),this.labelColors=h,this.labelPointStyles=_,this.labelTextColors=y,this.dataPoints=s,s}update(e,r){const l=this.options.setContext(this.getContext()),h=this._active;let _,y=[];if(!h.length)this.opacity!==0&&(_={opacity:0});else{const s=Xg[l.position].call(this,h,this._eventPosition);y=this._createItems(l),this.title=this.getTitle(y,l),this.beforeBody=this.getBeforeBody(y,l),this.body=this.getBody(y,l),this.afterBody=this.getAfterBody(y,l),this.footer=this.getFooter(y,l);const I=this._size=pR(this,l),O=Object.assign({},s,I),k=mR(this.chart,l,O),j=gR(l,O,k,this.chart);this.xAlign=k.xAlign,this.yAlign=k.yAlign,_={opacity:1,x:j.x,y:j.y,width:I.width,height:I.height,caretX:s.x,caretY:s.y}}this._tooltipItems=y,this.$context=void 0,_&&this._resolveAnimations().update(this,_),e&&l.external&&l.external.call(this,{chart:this.chart,tooltip:this,replay:r})}drawCaret(e,r,l,h){const _=this.getCaretPosition(e,l,h);r.lineTo(_.x1,_.y1),r.lineTo(_.x2,_.y2),r.lineTo(_.x3,_.y3)}getCaretPosition(e,r,l){const{xAlign:h,yAlign:_}=this,{caretSize:y,cornerRadius:s}=l,{topLeft:I,topRight:O,bottomLeft:k,bottomRight:j}=od(s),{x:Z,y:Y}=e,{width:se,height:ne}=r;let de,me,Te,ge,fe,Ae;return _==="center"?(fe=Y+ne/2,h==="left"?(de=Z,me=de-y,ge=fe+y,Ae=fe-y):(de=Z+se,me=de+y,ge=fe-y,Ae=fe+y),Te=de):(h==="left"?me=Z+Math.max(I,k)+y:h==="right"?me=Z+se-Math.max(O,j)-y:me=this.caretX,_==="top"?(ge=Y,fe=ge-y,de=me-y,Te=me+y):(ge=Y+ne,fe=ge+y,de=me+y,Te=me-y),Ae=ge),{x1:de,x2:me,x3:Te,y1:ge,y2:fe,y3:Ae}}drawTitle(e,r,l){const h=this.title,_=h.length;let y,s,I;if(_){const O=sp(l.rtl,this.x,this.width);for(e.x=Mv(this,l.titleAlign,l),r.textAlign=O.textAlign(l.titleAlign),r.textBaseline="middle",y=sr(l.titleFont),s=l.titleSpacing,r.fillStyle=l.titleColor,r.font=y.string,I=0;I<_;++I)r.fillText(h[I],O.x(e.x),e.y+y.lineHeight/2),e.y+=y.lineHeight+s,I+1===_&&(e.y+=l.titleMarginBottom-s)}}_drawColorBox(e,r,l,h,_){const y=this.labelColors[l],s=this.labelPointStyles[l],{boxHeight:I,boxWidth:O}=_,k=sr(_.bodyFont),j=Mv(this,"left",_),Z=h.x(j),Y=I<k.lineHeight?(k.lineHeight-I)/2:0,se=r.y+Y;if(_.usePointStyle){const ne={radius:Math.min(O,I)/2,pointStyle:s.pointStyle,rotation:s.rotation,borderWidth:1},de=h.leftForLtr(Z,O)+O/2,me=se+I/2;e.strokeStyle=_.multiKeyBackground,e.fillStyle=_.multiKeyBackground,AE(e,ne,de,me),e.strokeStyle=y.borderColor,e.fillStyle=y.backgroundColor,AE(e,ne,de,me)}else{e.lineWidth=bn(y.borderWidth)?Math.max(...Object.values(y.borderWidth)):y.borderWidth||1,e.strokeStyle=y.borderColor,e.setLineDash(y.borderDash||[]),e.lineDashOffset=y.borderDashOffset||0;const ne=h.leftForLtr(Z,O),de=h.leftForLtr(h.xPlus(Z,1),O-2),me=od(y.borderRadius);Object.values(me).some(Te=>Te!==0)?(e.beginPath(),e.fillStyle=_.multiKeyBackground,F_(e,{x:ne,y:se,w:O,h:I,radius:me}),e.fill(),e.stroke(),e.fillStyle=y.backgroundColor,e.beginPath(),F_(e,{x:de,y:se+1,w:O-2,h:I-2,radius:me}),e.fill()):(e.fillStyle=_.multiKeyBackground,e.fillRect(ne,se,O,I),e.strokeRect(ne,se,O,I),e.fillStyle=y.backgroundColor,e.fillRect(de,se+1,O-2,I-2))}e.fillStyle=this.labelTextColors[l]}drawBody(e,r,l){const{body:h}=this,{bodySpacing:_,bodyAlign:y,displayColors:s,boxHeight:I,boxWidth:O,boxPadding:k}=l,j=sr(l.bodyFont);let Z=j.lineHeight,Y=0;const se=sp(l.rtl,this.x,this.width),ne=function(Ke){r.fillText(Ke,se.x(e.x+Y),e.y+Z/2),e.y+=Z+_},de=se.textAlign(y);let me,Te,ge,fe,Ae,Ge,ze;for(r.textAlign=y,r.textBaseline="middle",r.font=j.string,e.x=Mv(this,de,l),r.fillStyle=l.bodyColor,jn(this.beforeBody,ne),Y=s&&de!=="right"?y==="center"?O/2+k:O+2+k:0,fe=0,Ge=h.length;fe<Ge;++fe){for(me=h[fe],Te=this.labelTextColors[fe],r.fillStyle=Te,jn(me.before,ne),ge=me.lines,s&&ge.length&&(this._drawColorBox(r,e,fe,se,l),Z=Math.max(j.lineHeight,I)),Ae=0,ze=ge.length;Ae<ze;++Ae)ne(ge[Ae]),Z=j.lineHeight;jn(me.after,ne)}Y=0,Z=j.lineHeight,jn(this.afterBody,ne),e.y-=_}drawFooter(e,r,l){const h=this.footer,_=h.length;let y,s;if(_){const I=sp(l.rtl,this.x,this.width);for(e.x=Mv(this,l.footerAlign,l),e.y+=l.footerMarginTop,r.textAlign=I.textAlign(l.footerAlign),r.textBaseline="middle",y=sr(l.footerFont),r.fillStyle=l.footerColor,r.font=y.string,s=0;s<_;++s)r.fillText(h[s],I.x(e.x),e.y+y.lineHeight/2),e.y+=y.lineHeight+l.footerSpacing}}drawBackground(e,r,l,h){const{xAlign:_,yAlign:y}=this,{x:s,y:I}=e,{width:O,height:k}=l,{topLeft:j,topRight:Z,bottomLeft:Y,bottomRight:se}=od(h.cornerRadius);r.fillStyle=h.backgroundColor,r.strokeStyle=h.borderColor,r.lineWidth=h.borderWidth,r.beginPath(),r.moveTo(s+j,I),y==="top"&&this.drawCaret(e,r,l,h),r.lineTo(s+O-Z,I),r.quadraticCurveTo(s+O,I,s+O,I+Z),y==="center"&&_==="right"&&this.drawCaret(e,r,l,h),r.lineTo(s+O,I+k-se),r.quadraticCurveTo(s+O,I+k,s+O-se,I+k),y==="bottom"&&this.drawCaret(e,r,l,h),r.lineTo(s+Y,I+k),r.quadraticCurveTo(s,I+k,s,I+k-Y),y==="center"&&_==="left"&&this.drawCaret(e,r,l,h),r.lineTo(s,I+j),r.quadraticCurveTo(s,I,s+j,I),r.closePath(),r.fill(),h.borderWidth>0&&r.stroke()}_updateAnimationTarget(e){const r=this.chart,l=this.$animations,h=l&&l.x,_=l&&l.y;if(h||_){const y=Xg[e.position].call(this,this._active,this._eventPosition);if(!y)return;const s=this._size=pR(this,e),I=Object.assign({},y,this._size),O=mR(r,e,I),k=gR(e,I,O,r);(h._to!==k.x||_._to!==k.y)&&(this.xAlign=O.xAlign,this.yAlign=O.yAlign,this.width=s.width,this.height=s.height,this.caretX=y.x,this.caretY=y.y,this._resolveAnimations().update(this,k))}}_willRender(){return!!this.opacity}draw(e){const r=this.options.setContext(this.getContext());let l=this.opacity;if(!l)return;this._updateAnimationTarget(r);const h={width:this.width,height:this.height},_={x:this.x,y:this.y};l=Math.abs(l)<.001?0:l;const y=zr(r.padding),s=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;r.enabled&&s&&(e.save(),e.globalAlpha=l,this.drawBackground(_,e,h,r),yz(e,r.textDirection),_.y+=y.top,this.drawTitle(_,e,r),this.drawBody(_,e,r),this.drawFooter(_,e,r),vz(e,r.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,r){const l=this._active,h=e.map(({datasetIndex:s,index:I})=>{const O=this.chart.getDatasetMeta(s);if(!O)throw new Error("Cannot find a dataset at index "+s);return{datasetIndex:s,element:O.data[I],index:I}}),_=!Ox(l,h),y=this._positionChanged(h,r);(_||y)&&(this._active=h,this._eventPosition=r,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,r,l=!0){if(r&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const h=this.options,_=this._active||[],y=this._getActiveElements(e,_,r,l),s=this._positionChanged(y,e),I=r||!Ox(y,_)||s;return I&&(this._active=y,(h.enabled||h.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,r))),I}_getActiveElements(e,r,l,h){const _=this.options;if(e.type==="mouseout")return[];if(!h)return r.filter(s=>this.chart.data.datasets[s.datasetIndex]&&this.chart.getDatasetMeta(s.datasetIndex).controller.getParsed(s.index)!==void 0);const y=this.chart.getElementsAtEventForMode(e,_.mode,_,l);return _.reverse&&y.reverse(),y}_positionChanged(e,r){const{caretX:l,caretY:h,options:_}=this,y=Xg[_.position].call(this,e,r);return y!==!1&&(l!==y.x||h!==y.y)}}ri(LE,"positioners",Xg);var fK={id:"tooltip",_element:LE,positioners:Xg,afterInit(t,e,r){r&&(t.tooltip=new LE({chart:t,options:r}))},beforeUpdate(t,e,r){t.tooltip&&t.tooltip.initialize(r)},reset(t,e,r){t.tooltip&&t.tooltip.initialize(r)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const r={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...r,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",r)}},afterEvent(t,e){if(t.tooltip){const r=e.replay;t.tooltip.handleEvent(e.event,r,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Gz},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},pK=Object.freeze({__proto__:null,Colors:AY,Decimation:PY,Filler:YY,Legend:iK,SubTitle:rK,Title:sK,Tooltip:fK});const mK=(t,e,r,l)=>(typeof e=="string"?(r=t.push(e)-1,l.unshift({index:r,label:e})):isNaN(e)&&(r=null),r);function gK(t,e,r,l){const h=t.indexOf(e);if(h===-1)return mK(t,e,r,l);const _=t.lastIndexOf(e);return h!==_?r:h}const _K=(t,e)=>t===null?null:ur(Math.round(t),0,e);function vR(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class OE extends wd{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const r=this._addedLabels;if(r.length){const l=this.getLabels();for(const{index:h,label:_}of r)l[h]===_&&l.splice(h,1);this._addedLabels=[]}super.init(e)}parse(e,r){if(vn(e))return null;const l=this.getLabels();return r=isFinite(r)&&l[r]===e?r:gK(l,e,ln(r,e),this._addedLabels),_K(r,l.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:r}=this.getUserBounds();let{min:l,max:h}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(l=0),r||(h=this.getLabels().length-1)),this.min=l,this.max=h}buildTicks(){const e=this.min,r=this.max,l=this.options.offset,h=[];let _=this.getLabels();_=e===0&&r===_.length-1?_:_.slice(e,r+1),this._valueRange=Math.max(_.length-(l?0:1),1),this._startValue=this.min-(l?.5:0);for(let y=e;y<=r;y++)h.push({value:y});return h}getLabelForValue(e){return vR.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const r=this.ticks;return e<0||e>r.length-1?null:this.getPixelForValue(r[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}ri(OE,"id","category"),ri(OE,"defaults",{ticks:{callback:vR}});function yK(t,e){const r=[],{bounds:h,step:_,min:y,max:s,precision:I,count:O,maxTicks:k,maxDigits:j,includeBounds:Z}=t,Y=_||1,se=k-1,{min:ne,max:de}=e,me=!vn(y),Te=!vn(s),ge=!vn(O),fe=(de-ne)/(j+1);let Ae=pD((de-ne)/se/Y)*Y,Ge,ze,Ke,Xe;if(Ae<1e-14&&!me&&!Te)return[{value:ne},{value:de}];Xe=Math.ceil(de/Ae)-Math.floor(ne/Ae),Xe>se&&(Ae=pD(Xe*Ae/se/Y)*Y),vn(I)||(Ge=Math.pow(10,I),Ae=Math.ceil(Ae*Ge)/Ge),h==="ticks"?(ze=Math.floor(ne/Ae)*Ae,Ke=Math.ceil(de/Ae)*Ae):(ze=ne,Ke=de),me&&Te&&_&&h9((s-y)/_,Ae/1e3)?(Xe=Math.round(Math.min((s-y)/Ae,k)),Ae=(s-y)/Xe,ze=y,Ke=s):ge?(ze=me?y:ze,Ke=Te?s:Ke,Xe=O-1,Ae=(Ke-ze)/Xe):(Xe=(Ke-ze)/Ae,u_(Xe,Math.round(Xe),Ae/1e3)?Xe=Math.round(Xe):Xe=Math.ceil(Xe));const Ue=Math.max(mD(Ae),mD(ze));Ge=Math.pow(10,vn(I)?Ue:I),ze=Math.round(ze*Ge)/Ge,Ke=Math.round(Ke*Ge)/Ge;let et=0;for(me&&(Z&&ze!==y?(r.push({value:y}),ze<y&&et++,u_(Math.round((ze+et*Ae)*Ge)/Ge,y,xR(y,fe,t))&&et++):ze<y&&et++);et<Xe;++et){const lt=Math.round((ze+et*Ae)*Ge)/Ge;if(Te&&lt>s)break;r.push({value:lt})}return Te&&Z&&Ke!==s?r.length&&u_(r[r.length-1].value,s,xR(s,fe,t))?r[r.length-1].value=s:r.push({value:s}):(!Te||Ke===s)&&r.push({value:Ke}),r}function xR(t,e,{horizontal:r,minRotation:l}){const h=za(l),_=(r?Math.sin(h):Math.cos(h))||.001,y=.75*e*(""+t).length;return Math.min(e/_,y)}class Ux extends wd{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,r){return vn(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:r,maxDefined:l}=this.getUserBounds();let{min:h,max:_}=this;const y=I=>h=r?h:I,s=I=>_=l?_:I;if(e){const I=ml(h),O=ml(_);I<0&&O<0?s(0):I>0&&O>0&&y(0)}if(h===_){let I=_===0?1:Math.abs(_*.05);s(_+I),e||y(h-I)}this.min=h,this.max=_}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:r,stepSize:l}=e,h;return l?(h=Math.ceil(this.max/l)-Math.floor(this.min/l)+1,h>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${l} would result generating up to ${h} ticks. Limiting to 1000.`),h=1e3)):(h=this.computeTickLimit(),r=r||11),r&&(h=Math.min(r,h)),h}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,r=e.ticks;let l=this.getTickLimit();l=Math.max(2,l);const h={maxTicks:l,bounds:e.bounds,min:e.min,max:e.max,precision:r.precision,step:r.stepSize,count:r.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:r.minRotation||0,includeBounds:r.includeBounds!==!1},_=this._range||this,y=yK(h,_);return e.bounds==="ticks"&&tz(y,this,"value"),e.reverse?(y.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),y}configure(){const e=this.ticks;let r=this.min,l=this.max;if(super.configure(),this.options.offset&&e.length){const h=(l-r)/Math.max(e.length-1,1)/2;r-=h,l+=h}this._startValue=r,this._endValue=l,this._valueRange=l-r}getLabelForValue(e){return sy(e,this.chart.options.locale,this.options.ticks.format)}}class kE extends Ux{determineDataLimits(){const{min:e,max:r}=this.getMinMax(!0);this.min=Ps(e)?e:0,this.max=Ps(r)?r:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),r=e?this.width:this.height,l=za(this.options.ticks.minRotation),h=(e?Math.sin(l):Math.cos(l))||.001,_=this._resolveTickFontOptions(0);return Math.ceil(r/Math.min(40,_.lineHeight/h))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}ri(kE,"id","linear"),ri(kE,"defaults",{ticks:{callback:R1.formatters.numeric}});const N_=t=>Math.floor(yu(t)),Hh=(t,e)=>Math.pow(10,N_(t)+e);function bR(t){return t/Math.pow(10,N_(t))===1}function wR(t,e,r){const l=Math.pow(10,r),h=Math.floor(t/l);return Math.ceil(e/l)-h}function vK(t,e){const r=e-t;let l=N_(r);for(;wR(t,e,l)>10;)l++;for(;wR(t,e,l)<10;)l--;return Math.min(l,N_(t))}function xK(t,{min:e,max:r}){e=Do(t.min,e);const l=[],h=N_(e);let _=vK(e,r),y=_<0?Math.pow(10,Math.abs(_)):1;const s=Math.pow(10,_),I=h>_?Math.pow(10,h):0,O=Math.round((e-I)*y)/y,k=Math.floor((e-I)/s/10)*s*10;let j=Math.floor((O-k)/Math.pow(10,_)),Z=Do(t.min,Math.round((I+k+j*Math.pow(10,_))*y)/y);for(;Z<r;)l.push({value:Z,major:bR(Z),significand:j}),j>=10?j=j<15?15:20:j++,j>=20&&(_++,j=2,y=_>=0?1:y),Z=Math.round((I+k+j*Math.pow(10,_))*y)/y;const Y=Do(t.max,Z);return l.push({value:Y,major:bR(Y),significand:j}),l}class zE extends wd{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,r){const l=Ux.prototype.parse.apply(this,[e,r]);if(l===0){this._zero=!0;return}return Ps(l)&&l>0?l:null}determineDataLimits(){const{min:e,max:r}=this.getMinMax(!0);this.min=Ps(e)?Math.max(0,e):null,this.max=Ps(r)?Math.max(0,r):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Ps(this._userMin)&&(this.min=e===Hh(this.min,0)?Hh(this.min,-1):Hh(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:r}=this.getUserBounds();let l=this.min,h=this.max;const _=s=>l=e?l:s,y=s=>h=r?h:s;l===h&&(l<=0?(_(1),y(10)):(_(Hh(l,-1)),y(Hh(h,1)))),l<=0&&_(Hh(h,-1)),h<=0&&y(Hh(l,1)),this.min=l,this.max=h}buildTicks(){const e=this.options,r={min:this._userMin,max:this._userMax},l=xK(r,this);return e.bounds==="ticks"&&tz(l,this,"value"),e.reverse?(l.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),l}getLabelForValue(e){return e===void 0?"0":sy(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=yu(e),this._valueRange=yu(this.max)-yu(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(yu(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const r=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+r*this._valueRange)}}ri(zE,"id","logarithmic"),ri(zE,"defaults",{ticks:{callback:R1.formatters.logarithmic,major:{enabled:!0}}});function FE(t){const e=t.ticks;if(e.display&&t.display){const r=zr(e.backdropPadding);return ln(e.font&&e.font.size,_s.font.size)+r.height}return 0}function bK(t,e,r){return r=as(r)?r:[r],{w:I9(t,e.string,r),h:r.length*e.lineHeight}}function TR(t,e,r,l,h){return t===l||t===h?{start:e-r/2,end:e+r/2}:t<l||t>h?{start:e-r,end:e}:{start:e,end:e+r}}function wK(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},r=Object.assign({},e),l=[],h=[],_=t._pointLabels.length,y=t.options.pointLabels,s=y.centerPointLabels?us/_:0;for(let I=0;I<_;I++){const O=y.setContext(t.getPointLabelContext(I));h[I]=O.padding;const k=t.getPointPosition(I,t.drawingArea+h[I],s),j=sr(O.font),Z=bK(t.ctx,j,t._pointLabels[I]);l[I]=Z;const Y=Oo(t.getIndexAngle(I)+s),se=Math.round(c2(Y)),ne=TR(se,k.x,Z.w,0,180),de=TR(se,k.y,Z.h,90,270);TK(r,e,Y,ne,de)}t.setCenterPoint(e.l-r.l,r.r-e.r,e.t-r.t,r.b-e.b),t._pointLabelItems=AK(t,l,h)}function TK(t,e,r,l,h){const _=Math.abs(Math.sin(r)),y=Math.abs(Math.cos(r));let s=0,I=0;l.start<e.l?(s=(e.l-l.start)/_,t.l=Math.min(t.l,e.l-s)):l.end>e.r&&(s=(l.end-e.r)/_,t.r=Math.max(t.r,e.r+s)),h.start<e.t?(I=(e.t-h.start)/y,t.t=Math.min(t.t,e.t-I)):h.end>e.b&&(I=(h.end-e.b)/y,t.b=Math.max(t.b,e.b+I))}function EK(t,e,r){const l=t.drawingArea,{extra:h,additionalAngle:_,padding:y,size:s}=r,I=t.getPointPosition(e,l+h+y,_),O=Math.round(c2(Oo(I.angle+Bs))),k=CK(I.y,s.h,O),j=MK(O),Z=IK(I.x,s.w,j);return{visible:!0,x:I.x,y:k,textAlign:j,left:Z,top:k,right:Z+s.w,bottom:k+s.h}}function SK(t,e){if(!e)return!0;const{left:r,top:l,right:h,bottom:_}=t;return!(Jl({x:r,y:l},e)||Jl({x:r,y:_},e)||Jl({x:h,y:l},e)||Jl({x:h,y:_},e))}function AK(t,e,r){const l=[],h=t._pointLabels.length,_=t.options,{centerPointLabels:y,display:s}=_.pointLabels,I={extra:FE(_)/2,additionalAngle:y?us/h:0};let O;for(let k=0;k<h;k++){I.padding=r[k],I.size=e[k];const j=EK(t,k,I);l.push(j),s==="auto"&&(j.visible=SK(j,O),j.visible&&(O=j))}return l}function MK(t){return t===0||t===180?"center":t<180?"left":"right"}function IK(t,e,r){return r==="right"?t-=e:r==="center"&&(t-=e/2),t}function CK(t,e,r){return r===90||r===270?t-=e/2:(r>270||r<90)&&(t-=e),t}function PK(t,e,r){const{left:l,top:h,right:_,bottom:y}=r,{backdropColor:s}=e;if(!vn(s)){const I=od(e.borderRadius),O=zr(e.backdropPadding);t.fillStyle=s;const k=l-O.left,j=h-O.top,Z=_-l+O.width,Y=y-h+O.height;Object.values(I).some(se=>se!==0)?(t.beginPath(),F_(t,{x:k,y:j,w:Z,h:Y,radius:I}),t.fill()):t.fillRect(k,j,Z,Y)}}function DK(t,e){const{ctx:r,options:{pointLabels:l}}=t;for(let h=e-1;h>=0;h--){const _=t._pointLabelItems[h];if(!_.visible)continue;const y=l.setContext(t.getPointLabelContext(h));PK(r,y,_);const s=sr(y.font),{x:I,y:O,textAlign:k}=_;md(r,t._pointLabels[h],I,O+s.lineHeight/2,s,{color:y.color,textAlign:k,textBaseline:"middle"})}}function qz(t,e,r,l){const{ctx:h}=t;if(r)h.arc(t.xCenter,t.yCenter,e,0,ls);else{let _=t.getPointPosition(0,e);h.moveTo(_.x,_.y);for(let y=1;y<l;y++)_=t.getPointPosition(y,e),h.lineTo(_.x,_.y)}}function RK(t,e,r,l,h){const _=t.ctx,y=e.circular,{color:s,lineWidth:I}=e;!y&&!l||!s||!I||r<0||(_.save(),_.strokeStyle=s,_.lineWidth=I,_.setLineDash(h.dash||[]),_.lineDashOffset=h.dashOffset,_.beginPath(),qz(t,r,y,l),_.closePath(),_.stroke(),_.restore())}function LK(t,e,r){return Uu(t,{label:r,index:e,type:"pointLabel"})}class Yg extends Ux{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=zr(FE(this.options)/2),r=this.width=this.maxWidth-e.width,l=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+r/2+e.left),this.yCenter=Math.floor(this.top+l/2+e.top),this.drawingArea=Math.floor(Math.min(r,l)/2)}determineDataLimits(){const{min:e,max:r}=this.getMinMax(!1);this.min=Ps(e)&&!isNaN(e)?e:0,this.max=Ps(r)&&!isNaN(r)?r:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/FE(this.options))}generateTickLabels(e){Ux.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((r,l)=>{const h=ts(this.options.pointLabels.callback,[r,l],this);return h||h===0?h:""}).filter((r,l)=>this.chart.getDataVisibility(l))}fit(){const e=this.options;e.display&&e.pointLabels.display?wK(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,r,l,h){this.xCenter+=Math.floor((e-r)/2),this.yCenter+=Math.floor((l-h)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,r,l,h))}getIndexAngle(e){const r=ls/(this._pointLabels.length||1),l=this.options.startAngle||0;return Oo(e*r+za(l))}getDistanceFromCenterForValue(e){if(vn(e))return NaN;const r=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*r:(e-this.min)*r}getValueForDistanceFromCenter(e){if(vn(e))return NaN;const r=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-r:this.min+r}getPointLabelContext(e){const r=this._pointLabels||[];if(e>=0&&e<r.length){const l=r[e];return LK(this.getContext(),e,l)}}getPointPosition(e,r,l=0){const h=this.getIndexAngle(e)-Bs+l;return{x:Math.cos(h)*r+this.xCenter,y:Math.sin(h)*r+this.yCenter,angle:h}}getPointPositionForValue(e,r){return this.getPointPosition(e,this.getDistanceFromCenterForValue(r))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:r,top:l,right:h,bottom:_}=this._pointLabelItems[e];return{left:r,top:l,right:h,bottom:_}}drawBackground(){const{backgroundColor:e,grid:{circular:r}}=this.options;if(e){const l=this.ctx;l.save(),l.beginPath(),qz(this,this.getDistanceFromCenterForValue(this._endValue),r,this._pointLabels.length),l.closePath(),l.fillStyle=e,l.fill(),l.restore()}}drawGrid(){const e=this.ctx,r=this.options,{angleLines:l,grid:h,border:_}=r,y=this._pointLabels.length;let s,I,O;if(r.pointLabels.display&&DK(this,y),h.display&&this.ticks.forEach((k,j)=>{if(j!==0||j===0&&this.min<0){I=this.getDistanceFromCenterForValue(k.value);const Z=this.getContext(j),Y=h.setContext(Z),se=_.setContext(Z);RK(this,Y,I,y,se)}}),l.display){for(e.save(),s=y-1;s>=0;s--){const k=l.setContext(this.getPointLabelContext(s)),{color:j,lineWidth:Z}=k;!Z||!j||(e.lineWidth=Z,e.strokeStyle=j,e.setLineDash(k.borderDash),e.lineDashOffset=k.borderDashOffset,I=this.getDistanceFromCenterForValue(r.reverse?this.min:this.max),O=this.getPointPosition(s,I),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(O.x,O.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,r=this.options,l=r.ticks;if(!l.display)return;const h=this.getIndexAngle(0);let _,y;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(h),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((s,I)=>{if(I===0&&this.min>=0&&!r.reverse)return;const O=l.setContext(this.getContext(I)),k=sr(O.font);if(_=this.getDistanceFromCenterForValue(this.ticks[I].value),O.showLabelBackdrop){e.font=k.string,y=e.measureText(s.label).width,e.fillStyle=O.backdropColor;const j=zr(O.backdropPadding);e.fillRect(-y/2-j.left,-_-k.size/2-j.top,y+j.width,k.size+j.height)}md(e,s.label,0,-_,k,{color:O.color,strokeColor:O.textStrokeColor,strokeWidth:O.textStrokeWidth})}),e.restore()}drawTitle(){}}ri(Yg,"id","radialLinear"),ri(Yg,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:R1.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}}),ri(Yg,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),ri(Yg,"descriptors",{angleLines:{_fallback:"grid"}});const z1={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},yo=Object.keys(z1);function ER(t,e){return t-e}function SR(t,e){if(vn(e))return null;const r=t._adapter,{parser:l,round:h,isoWeekday:_}=t._parseOpts;let y=e;return typeof l=="function"&&(y=l(y)),Ps(y)||(y=typeof l=="string"?r.parse(y,l):r.parse(y)),y===null?null:(h&&(y=h==="week"&&(xp(_)||_===!0)?r.startOf(y,"isoWeek",_):r.startOf(y,h)),+y)}function AR(t,e,r,l){const h=yo.length;for(let _=yo.indexOf(t);_<h-1;++_){const y=z1[yo[_]],s=y.steps?y.steps:Number.MAX_SAFE_INTEGER;if(y.common&&Math.ceil((r-e)/(s*y.size))<=l)return yo[_]}return yo[h-1]}function OK(t,e,r,l,h){for(let _=yo.length-1;_>=yo.indexOf(r);_--){const y=yo[_];if(z1[y].common&&t._adapter.diff(h,l,y)>=e-1)return y}return yo[r?yo.indexOf(r):0]}function kK(t){for(let e=yo.indexOf(t)+1,r=yo.length;e<r;++e)if(z1[yo[e]].common)return yo[e]}function MR(t,e,r){if(!r)t[e]=!0;else if(r.length){const{lo:l,hi:h}=u2(r,e),_=r[l]>=e?r[l]:r[h];t[_]=!0}}function zK(t,e,r,l){const h=t._adapter,_=+h.startOf(e[0].value,l),y=e[e.length-1].value;let s,I;for(s=_;s<=y;s=+h.add(s,1,l))I=r[s],I>=0&&(e[I].major=!0);return e}function IR(t,e,r){const l=[],h={},_=e.length;let y,s;for(y=0;y<_;++y)s=e[y],h[s]=y,l.push({value:s,major:!1});return _===0||!r?l:zK(t,l,h,r)}class V_ extends wd{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,r={}){const l=e.time||(e.time={}),h=this._adapter=new GZ._date(e.adapters.date);h.init(r),c_(l.displayFormats,h.formats()),this._parseOpts={parser:l.parser,round:l.round,isoWeekday:l.isoWeekday},super.init(e),this._normalized=r.normalized}parse(e,r){return e===void 0?null:SR(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,r=this._adapter,l=e.time.unit||"day";let{min:h,max:_,minDefined:y,maxDefined:s}=this.getUserBounds();function I(O){!y&&!isNaN(O.min)&&(h=Math.min(h,O.min)),!s&&!isNaN(O.max)&&(_=Math.max(_,O.max))}(!y||!s)&&(I(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&I(this.getMinMax(!1))),h=Ps(h)&&!isNaN(h)?h:+r.startOf(Date.now(),l),_=Ps(_)&&!isNaN(_)?_:+r.endOf(Date.now(),l)+1,this.min=Math.min(h,_-1),this.max=Math.max(h+1,_)}_getLabelBounds(){const e=this.getLabelTimestamps();let r=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return e.length&&(r=e[0],l=e[e.length-1]),{min:r,max:l}}buildTicks(){const e=this.options,r=e.time,l=e.ticks,h=l.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&h.length&&(this.min=this._userMin||h[0],this.max=this._userMax||h[h.length-1]);const _=this.min,y=this.max,s=m9(h,_,y);return this._unit=r.unit||(l.autoSkip?AR(r.minUnit,this.min,this.max,this._getLabelCapacity(_)):OK(this,s.length,r.minUnit,this.min,this.max)),this._majorUnit=!l.major.enabled||this._unit==="year"?void 0:kK(this._unit),this.initOffsets(h),e.reverse&&s.reverse(),IR(this,s,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let r=0,l=0,h,_;this.options.offset&&e.length&&(h=this.getDecimalForValue(e[0]),e.length===1?r=1-h:r=(this.getDecimalForValue(e[1])-h)/2,_=this.getDecimalForValue(e[e.length-1]),e.length===1?l=_:l=(_-this.getDecimalForValue(e[e.length-2]))/2);const y=e.length<3?.5:.25;r=ur(r,0,y),l=ur(l,0,y),this._offsets={start:r,end:l,factor:1/(r+1+l)}}_generate(){const e=this._adapter,r=this.min,l=this.max,h=this.options,_=h.time,y=_.unit||AR(_.minUnit,r,l,this._getLabelCapacity(r)),s=ln(h.ticks.stepSize,1),I=y==="week"?_.isoWeekday:!1,O=xp(I)||I===!0,k={};let j=r,Z,Y;if(O&&(j=+e.startOf(j,"isoWeek",I)),j=+e.startOf(j,O?"day":y),e.diff(l,r,y)>1e5*s)throw new Error(r+" and "+l+" are too far apart with stepSize of "+s+" "+y);const se=h.ticks.source==="data"&&this.getDataTimestamps();for(Z=j,Y=0;Z<l;Z=+e.add(Z,s,y),Y++)MR(k,Z,se);return(Z===l||h.bounds==="ticks"||Y===1)&&MR(k,Z,se),Object.keys(k).sort(ER).map(ne=>+ne)}getLabelForValue(e){const r=this._adapter,l=this.options.time;return l.tooltipFormat?r.format(e,l.tooltipFormat):r.format(e,l.displayFormats.datetime)}format(e,r){const h=this.options.time.displayFormats,_=this._unit,y=r||h[_];return this._adapter.format(e,y)}_tickFormatFunction(e,r,l,h){const _=this.options,y=_.ticks.callback;if(y)return ts(y,[e,r,l],this);const s=_.time.displayFormats,I=this._unit,O=this._majorUnit,k=I&&s[I],j=O&&s[O],Z=l[r],Y=O&&j&&Z&&Z.major;return this._adapter.format(e,h||(Y?j:k))}generateTickLabels(e){let r,l,h;for(r=0,l=e.length;r<l;++r)h=e[r],h.label=this._tickFormatFunction(h.value,r,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const r=this._offsets,l=this.getDecimalForValue(e);return this.getPixelForDecimal((r.start+l)*r.factor)}getValueForPixel(e){const r=this._offsets,l=this.getDecimalForPixel(e)/r.factor-r.end;return this.min+l*(this.max-this.min)}_getLabelSize(e){const r=this.options.ticks,l=this.ctx.measureText(e).width,h=za(this.isHorizontal()?r.maxRotation:r.minRotation),_=Math.cos(h),y=Math.sin(h),s=this._resolveTickFontOptions(0).size;return{w:l*_+s*y,h:l*y+s*_}}_getLabelCapacity(e){const r=this.options.time,l=r.displayFormats,h=l[r.unit]||l.millisecond,_=this._tickFormatFunction(e,0,IR(this,[e],this._majorUnit),h),y=this._getLabelSize(_),s=Math.floor(this.isHorizontal()?this.width/y.w:this.height/y.h)-1;return s>0?s:1}getDataTimestamps(){let e=this._cache.data||[],r,l;if(e.length)return e;const h=this.getMatchingVisibleMetas();if(this._normalized&&h.length)return this._cache.data=h[0].controller.getAllParsedValues(this);for(r=0,l=h.length;r<l;++r)e=e.concat(h[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let r,l;if(e.length)return e;const h=this.getLabels();for(r=0,l=h.length;r<l;++r)e.push(SR(this,h[r]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return sz(e.sort(ER))}}ri(V_,"id","time"),ri(V_,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Iv(t,e,r){let l=0,h=t.length-1,_,y,s,I;r?(e>=t[l].pos&&e<=t[h].pos&&({lo:l,hi:h}=Kl(t,"pos",e)),{pos:_,time:s}=t[l],{pos:y,time:I}=t[h]):(e>=t[l].time&&e<=t[h].time&&({lo:l,hi:h}=Kl(t,"time",e)),{time:_,pos:s}=t[l],{time:y,pos:I}=t[h]);const O=y-_;return O?s+(I-s)*(e-_)/O:s}class BE extends V_{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),r=this._table=this.buildLookupTable(e);this._minPos=Iv(r,this.min),this._tableRange=Iv(r,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:r,max:l}=this,h=[],_=[];let y,s,I,O,k;for(y=0,s=e.length;y<s;++y)O=e[y],O>=r&&O<=l&&h.push(O);if(h.length<2)return[{time:r,pos:0},{time:l,pos:1}];for(y=0,s=h.length;y<s;++y)k=h[y+1],I=h[y-1],O=h[y],Math.round((k+I)/2)!==O&&_.push({time:O,pos:y/(s-1)});return _}_generate(){const e=this.min,r=this.max;let l=super.getDataTimestamps();return(!l.includes(e)||!l.length)&&l.splice(0,0,e),(!l.includes(r)||l.length===1)&&l.push(r),l.sort((h,_)=>h-_)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const r=this.getDataTimestamps(),l=this.getLabelTimestamps();return r.length&&l.length?e=this.normalize(r.concat(l)):e=r.length?r:l,e=this._cache.all=e,e}getDecimalForValue(e){return(Iv(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const r=this._offsets,l=this.getDecimalForPixel(e)/r.factor-r.end;return Iv(this._table,l*this._tableRange+this._minPos,!0)}}ri(BE,"id","timeseries"),ri(BE,"defaults",V_.defaults);var FK=Object.freeze({__proto__:null,CategoryScale:OE,LinearScale:kE,LogarithmicScale:zE,RadialLinearScale:Yg,TimeScale:V_,TimeSeriesScale:BE});const BK=[HZ,vY,pK,FK];const NK={props:{probabilidad:{type:Number,required:!0}},computed:{imageUrl(){return this.probabilidad===0?"../image/ImageResult/catxd.png":this.probabilidad<25?"../image/ImageResult/catsad.png":this.probabilidad<50?"../image/ImageResult/catstanding.png":this.probabilidad<75?"../image/ImageResult/catcat.png":"../image/ImageResult/kirbo.jpg"},imageInter(){return"../image/logo/logo.png"}}},VK={class:"book"},UK=["src"],jK={class:"cover"},$K=["src"];function HK(t,e,r,l,h,_){return Fi(),tn("div",VK,[gt("img",{src:_.imageUrl,alt:"Meme divertido",class:"meme-image"},null,8,UK),gt("div",jK,[gt("img",{src:_.imageInter,alt:"meme image"},null,8,$K)])])}const GK=yl(NK,[["render",HK],["__scopeId","data-v-a5d25d2b"]]);Gl.register(...BK);const qK={inheritAttrs:!1,components:{CardResultado:GK},props:{userId:{type:Number,required:!0}},data(){return{MiUsuario:{},mostrarModal:!1,modalType:null,MiUsuarioEditado:{},eventosParticipados:[],eventosGanados:[],NoParticipadosEventos:!1,NoTorneosGanados:!1,probabilidadGanar:0,Imagen1:"../image/ImageResult/catxd.png",Imagen2:"../image/ImageResult/catsad.png",Imagen3:"../image/ImageResult/catstanding.png",Imagen4:"../image/ImageResult/catcat.png",Imagen5:"../image/ImageResult/kirbo.jpg"}},mounted(){this.ObtenerElDatosDeUsuarios()},methods:{ObtenerElDatosDeUsuarios(){axios.get("usuarios",{params:{id_usuario:this.userId}}).then(t=>{console.log("ID de usuario enviado:",this.userId),console.log("Datos del usuario:",t.data),t.data.length>0?(this.MiUsuario=t.data[0],this.eventosParticipados=this.MiUsuario.eventos,this.eventosGanados=this.eventosParticipados.filter(e=>e.pivot.posicion===1),this.eventosParticipados.length!=0?(this.renderGrafico(this.eventosParticipados),this.calcularProbabilidad()):this.NoParticipadosEventos=!0,this.eventosGanados.length!=0?this.renderGrafico(this.eventosGanados):this.NoTorneosGanados=!0):console.error("No se encontró el usuario")}).catch(t=>{console.error("Error al cargar los datos:",t)})},abrirModal(t){this.modalType=t,this.mostrarModal=!0,t==="editar"&&(this.MiUsuarioEditado={...this.MiUsuario})},cerrarModal(){this.modalType=null,this.mostrarModal=!1},guardarCambios(){console.log("Guardando cambios:",this.MiUsuarioEditado),axios.put(`usuarios/${this.MiUsuario.id_usuario}`,this.MiUsuarioEditado).then(()=>{this.cerrarModal()}).catch(t=>{console.error("Error en la actualización:",t)})},eliminarUsuario(){console.log("Eliminando usuario:",this.MiUsuario.id_usuario),axios.delete(`usuarios/${this.MiUsuario.id_usuario}`).then(()=>{this.cerrarModal(),window.location.href="/public/"}).catch(t=>{console.error("Error al eliminar:",t)})},calcularProbabilidad(){const t=this.eventosParticipados.length,e=this.eventosGanados.length;t>0&&(this.probabilidadGanar=(e/t*100).toFixed(2))},renderGrafico(t){const e={};t.forEach(y=>{var I;const s=((I=y.juego)==null?void 0:I.nombre)||"Juego desconocido";e[s]?e[s]++:e[s]=1});const r=Object.keys(e),l=Object.values(e),h=["#C6FF41","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#C9CBCF","#8AE234","#F03464","#B94FC8"],_=t===this.eventosParticipados?document.getElementById("graficoParticipados"):document.getElementById("graficoGanados");_&&new Gl(_,{type:"pie",data:{labels:r,datasets:[{data:l,backgroundColor:h.slice(0,r.length)}]},options:{responsive:!0,plugins:{legend:{position:"top",labels:{color:"white",font:{size:14,family:"'Exo 2', sans-serif"}}}}}})}}},WK={class:"cardContainer"},ZK={class:"cardcontainer"},XK={class:"cardinfo"},YK={class:"cardinfoName"},KK={class:"cardinfoNameUser"},JK={class:"cardinfoNameYear"},QK={class:"cardinfoGmail"},eJ={class:"cardinfoName"},tJ={class:"cardinfoNameUser"},iJ={key:0},nJ={key:1},sJ={class:"cardinfoNameYear"},rJ={key:0},oJ={key:1},aJ={class:"cardButton"},lJ={class:"tablaEstadistica"},cJ={class:"tablaEstadisticaParticipados"},uJ={key:0,id:"graficoParticipados"},hJ={key:1},dJ={class:"tablaEstadisticaGanados"},fJ={key:0,id:"graficoGanados"},pJ={key:1},mJ={class:"ResultadosFinal"},gJ={class:"ResultadoFinalTexto"},_J={class:"ResultadoFinalLibro"},yJ={key:0,class:"modal"},vJ={class:"modal-dialog"},xJ={class:"modal-content"},bJ={class:"modal-header"},wJ={class:"modal-title"},TJ={class:"modal-body"},EJ={key:0},SJ={key:1},AJ={key:2},MJ=["src"],IJ=["src"],CJ=["src"],PJ=["src"],DJ=["src"],RJ={class:"modal-footer"};function LJ(t,e,r,l,h,_){const y=gx("card-resultado");return Fi(),tn(os,null,[gt("div",WK,[e[11]||(e[11]=gt("div",{class:"cardheader"},null,-1)),gt("div",ZK,[gt("div",XK,[gt("div",YK,[gt("div",KK,[gt("h4",null,"Nombre: "+Is(h.MiUsuario.nombre),1)]),gt("div",JK,[gt("h4",null,"Edad: "+Is(h.MiUsuario.edad),1)])]),gt("div",QK,[gt("h4",null,"Gmail: "+Is(h.MiUsuario.mail),1)]),gt("div",eJ,[gt("div",tJ,[h.NoParticipadosEventos==!1?(Fi(),tn("h4",iJ," Torneos Participados: "+Is(h.eventosParticipados.length),1)):(Fi(),tn("h4",nJ," No has Participado aun "))]),gt("div",sJ,[h.NoTorneosGanados==!1?(Fi(),tn("h4",rJ," Torneos Ganados: "+Is(h.eventosGanados.length),1)):(Fi(),tn("h4",oJ," No has ganado aun "))])]),gt("div",aJ,[gt("button",{class:"Editar",onClick:e[0]||(e[0]=s=>_.abrirModal("editar"))},"Editar"),gt("button",{class:"Eliminar",onClick:e[1]||(e[1]=s=>_.abrirModal("eliminar"))},"Eliminar")])])])]),e[29]||(e[29]=gt("h1",null,"Estadísticas",-1)),gt("div",lJ,[gt("div",cJ,[e[13]||(e[13]=gt("h1",null,"Has participado en: ",-1)),h.NoParticipadosEventos==!1?(Fi(),tn("canvas",uJ)):(Fi(),tn("div",hJ,e[12]||(e[12]=[gt("p",null,"no has participados aun",-1)])))]),gt("div",dJ,[e[15]||(e[15]=gt("h1",null,"Has ganado: ",-1)),h.NoTorneosGanados==!1?(Fi(),tn("canvas",fJ)):(Fi(),tn("div",pJ,e[14]||(e[14]=[gt("p",null,"no has Ganado aun",-1)])))])]),gt("div",mJ,[gt("div",gJ,[e[16]||(e[16]=gt("h1",null,"Tus resultados",-1)),e[17]||(e[17]=gt("p",null,[Ro(" Has participado en batallas, torneos, y desafíos... algunos ganados, otros solo vividos. Tu rendimiento ha sido evaluado, y con base en tus victorias y participaciones, hemos calculado tu probabilidad de ser el próximo campeón supremo. ¿Curioso por saber tu destino? "),gt("strong",null,"Abre el libro y descubre tu recompensa.")],-1)),gt("button",{class:"btn btn-info mt-3",onClick:e[2]||(e[2]=s=>_.abrirModal("explicacion"))}," ¿Qué significa cada imagen? ")]),gt("div",_J,[Yn(y,{probabilidad:h.probabilidadGanar},null,8,["probabilidad"])])]),h.mostrarModal?(Fi(),tn("div",yJ,[gt("div",vJ,[gt("div",xJ,[gt("div",bJ,[gt("h1",wJ,Is(h.modalType==="editar"?"Editar Usuario":h.modalType==="eliminar"?"Eliminar Usuario":"Significado de las imágenes"),1),gt("button",{type:"button",class:"close",onClick:e[3]||(e[3]=(...s)=>_.cerrarModal&&_.cerrarModal(...s))},e[18]||(e[18]=[gt("span",null,"×",-1)]))]),gt("div",TJ,[h.modalType==="editar"?(Fi(),tn("div",EJ,[e[19]||(e[19]=gt("label",null,"Nombre:",-1)),ka(gt("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>h.MiUsuarioEditado.nombre=s),type:"text"},null,512),[[Na,h.MiUsuarioEditado.nombre]]),e[20]||(e[20]=gt("label",null,"Email:",-1)),ka(gt("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>h.MiUsuarioEditado.mail=s),type:"email"},null,512),[[Na,h.MiUsuarioEditado.mail]]),e[21]||(e[21]=gt("label",null,"Edad:",-1)),ka(gt("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>h.MiUsuarioEditado.edad=s),type:"number"},null,512),[[Na,h.MiUsuarioEditado.edad]])])):h.modalType==="eliminar"?(Fi(),tn("div",SJ,[e[22]||(e[22]=Ro(" ¿Estás seguro de que deseas eliminar al usuario ")),gt("strong",null,Is(h.MiUsuario.nombre),1),e[23]||(e[23]=Ro("? "))])):h.modalType==="explicacion"?(Fi(),tn("div",AJ,[gt("ul",null,[gt("li",null,[gt("img",{src:h.Imagen1},null,8,MJ),e[24]||(e[24]=Ro(" Tus posibilidades son escasas... pero incluso un 1% es suficiente para cambiar el destino. "))])]),gt("ul",null,[gt("li",null,[gt("img",{src:h.Imagen2},null,8,IJ),e[25]||(e[25]=Ro(" No será fácil, pero si sigues luchando, podrías dar la sorpresa que nadie espera. "))])]),gt("ul",null,[gt("li",null,[gt("img",{src:h.Imagen3},null,8,CJ),e[26]||(e[26]=Ro(" Tienes una oportunidad real. No subestimes lo que eres capaz de lograr. "))])]),gt("ul",null,[gt("li",null,[gt("img",{src:h.Imagen4},null,8,PJ),e[27]||(e[27]=Ro(" Estás en la cima de tu forma. ¡Tu victoria está al alcance de la mano! "))])]),gt("ul",null,[gt("li",null,[gt("img",{src:h.Imagen5},null,8,DJ),e[28]||(e[28]=Ro(" ¡Es prácticamente tuyo! El título de campeón te espera. Solo falta que lo reclames. "))])])])):Zl("",!0)]),gt("div",RJ,[h.modalType==="editar"?(Fi(),tn("button",{key:0,class:"btn btn-secondary",onClick:e[7]||(e[7]=(...s)=>_.guardarCambios&&_.guardarCambios(...s))}," Guardar cambios ")):h.modalType==="eliminar"?(Fi(),tn("button",{key:1,class:"btn btn-danger",onClick:e[8]||(e[8]=(...s)=>_.eliminarUsuario&&_.eliminarUsuario(...s))}," Eliminar ")):Zl("",!0),h.modalType==="editar"?(Fi(),tn("button",{key:2,class:"btn btn-danger",onClick:e[9]||(e[9]=(...s)=>_.cerrarModal&&_.cerrarModal(...s))},"Cerrar")):Zl("",!0),h.modalType==="eliminar"?(Fi(),tn("button",{key:3,class:"btn btn-secondary",onClick:e[10]||(e[10]=(...s)=>_.cerrarModal&&_.cerrarModal(...s))},"Cerrar")):Zl("",!0)])])])])):Zl("",!0)],64)}const OJ=yl(qK,[["render",LJ],["__scopeId","data-v-541c3c24"]]);const kJ={data(){return{Juegos:[],juego:{},MensajeDeError:"",EsError:!1,MyModelo:null,insert:!1}},methods:{SelectJuegos(){const t=this;Ug.get("juegos").then(e=>{t.Juegos=e.data})},AbirMenuEditar(t){this.insert=!1,this.juego={...t},this.MyModelo=new tc("#Añadir"),this.MyModelo.show()},AbrirMenuAñadir(){this.insert=!0,this.MyModelo=new tc("#Añadir"),this.MyModelo.show()},AbrirMenuEliminar(t){this.EsError=!1,this.juego=t,this.MyModelo=new tc("#Eliminar"),this.MyModelo.show()},CerrarModal(){this.MyModelo&&this.MyModelo.hide()},AñadirJuego(){const t=this;Ug.post("juegos",t.juego).then(()=>{this.SelectJuegos(),this.CerrarModal()}).catch(e=>{this.EsError=!0,t.MensajeDeError=e.response.data.error})},EliminarJuego(){const t=this;Ug.delete("juegos/"+t.juego.id_juego).then(()=>{this.SelectJuegos(),this.CerrarModal()}).catch(e=>{this.EsError=!0,this.MensajeDeError=e.response.data.error||"Error al eliminar el juego"})},EditarJuego(){Ug.put(`juegos/${this.juego.id_juego}`,this.juego).then(()=>{this.SelectJuegos(),this.CerrarModal()}).catch(t=>{var e,r;this.EsError=!0,this.MensajeDeError=((r=(e=t.response)==null?void 0:e.data)==null?void 0:r.error)||"Error desconocido",console.error("Error en la actualización:",t)})}},created(){this.SelectJuegos()}},zJ={class:"tabla-juegos container mt-4"},FJ={class:"table table-striped table-bordered"},BJ={class:"thead-dark"},NJ=["onClick"],VJ=["onClick"],UJ={class:"modal",tabindex:"-1",role:"dialog",id:"Añadir"},jJ={class:"modal-dialog",role:"document"},$J={class:"modal-content"},HJ={class:"modal-header"},GJ={key:0,class:"modal-title"},qJ={key:1,class:"modal-title"},WJ={class:"modal-body"},ZJ={class:"mb-3"},XJ={class:"mb-3"},YJ={class:"modal-footer"},KJ={class:"modal",tabindex:"-1",role:"dialog",id:"Eliminar"},JJ={class:"modal-dialog",role:"document"},QJ={class:"modal-content"},eQ={class:"modal-body"},tQ={key:0,class:"badge text-bg-danger"},iQ={class:"modal-footer"};function nQ(t,e,r,l,h,_){return Fi(),tn(os,null,[gt("div",zJ,[gt("table",FJ,[gt("thead",BJ,[gt("tr",null,[e[8]||(e[8]=gt("th",null,"Nombre",-1)),e[9]||(e[9]=gt("th",null,"PEGI",-1)),e[10]||(e[10]=gt("th",null,"Acciones",-1)),gt("th",null,[gt("button",{class:"btn btn-primary btn-sm me-2",onClick:e[0]||(e[0]=y=>_.AbrirMenuAñadir())}," Añadir ")])])]),gt("tbody",null,[(Fi(!0),tn(os,null,dp(h.Juegos,y=>(Fi(),tn("tr",{key:y.id},[gt("td",null,Is(y.nombre),1),gt("td",null,Is(y.pegi),1),gt("td",null,[gt("button",{class:"btn btn-primary btn-sm me-2",onClick:s=>_.AbirMenuEditar(y)}," Editar ",8,NJ),gt("button",{class:"btn btn-danger btn-sm",onClick:s=>_.AbrirMenuEliminar(y)}," Eliminar ",8,VJ)])]))),128))])])]),gt("div",UJ,[gt("div",jJ,[gt("div",$J,[gt("div",HJ,[h.insert?(Fi(),tn("h5",GJ,"Añadir Juegos")):(Fi(),tn("h5",qJ,"Editar"))]),gt("div",WJ,[gt("div",ZJ,[e[11]||(e[11]=gt("label",{for:"nombre",class:"form-label"},"Nombre del Juego",-1)),ka(gt("input",{type:"text",class:"form-control",id:"nombre","onUpdate:modelValue":e[1]||(e[1]=y=>h.juego.nombre=y),required:""},null,512),[[Na,h.juego.nombre]])]),gt("div",XJ,[e[12]||(e[12]=gt("label",{for:"pegi",class:"form-label"},"PEGI",-1)),ka(gt("input",{type:"number",class:"form-control",id:"pegi","onUpdate:modelValue":e[2]||(e[2]=y=>h.juego.pegi=y),min:"3",max:"18",required:""},null,512),[[Na,h.juego.pegi]])])]),gt("div",YJ,[h.insert?(Fi(),tn("button",{key:0,onClick:e[3]||(e[3]=(...y)=>_.AñadirJuego&&_.AñadirJuego(...y)),type:"button",class:"btn btn-danger"}," Añadir ")):(Fi(),tn("button",{key:1,onClick:e[4]||(e[4]=(...y)=>_.EditarJuego&&_.EditarJuego(...y)),type:"button",class:"btn btn-danger"}," Editar ")),gt("button",{onClick:e[5]||(e[5]=(...y)=>_.CerrarModal&&_.CerrarModal(...y)),type:"button",class:"btn btn-secondary"}," Cerrar ")])])])]),gt("div",KJ,[gt("div",JJ,[gt("div",QJ,[e[15]||(e[15]=gt("div",{class:"modal-header"},[gt("h5",{class:"modal-title"},"Eliminar Juego")],-1)),gt("div",eQ,[gt("p",null,[e[13]||(e[13]=Ro(" ¿Seguro que deseas eliminar el juego ")),gt("strong",null,Is(h.juego.nombre),1),e[14]||(e[14]=Ro("? "))]),h.EsError?(Fi(),tn("span",tQ,Is(h.MensajeDeError),1)):Zl("",!0)]),gt("div",iQ,[gt("button",{onClick:e[6]||(e[6]=(...y)=>_.EliminarJuego&&_.EliminarJuego(...y)),type:"button",class:"btn btn-danger"}," Eliminar "),gt("button",{onClick:e[7]||(e[7]=(...y)=>_.CerrarModal&&_.CerrarModal(...y)),type:"button",class:"btn btn-secondary"}," Cerrar ")])])])])],64)}const sQ=yl(kJ,[["render",nQ],["__scopeId","data-v-77023cee"]]);const rQ={data(){return{categorias:[],juegos:[],plataformas:[],selectedCategoria:"",selectedJuegos:"",selectedPegi:"",selectedPlataforma:""}},created(){this.fetchCategorias(),this.fetchJuegos(),this.fetchPlataformas()},methods:{fetchCategorias(){axios.get("categorias").then(t=>{this.categorias=t.data}).catch(t=>{console.error("Error al cargar las categorías",t)})},fetchJuegos(){axios.get("juegos").then(t=>{this.juegos=t.data}).catch(t=>{console.error("Error al cargar los juegos",t)})},fetchPlataformas(){axios.get("plataformas").then(t=>{this.plataformas=t.data}).catch(t=>{console.error("Error al cargar las plataformas",t)})},submitForm(){this.$emit("filtrar",{juego:this.selectedJuegos,pegi:this.selectedPegi,categoria:this.selectedCategoria,plataforma:this.selectedPlataforma})},verTodosJuegos(){this.$emit("filtrar",{juego:"",pegi:"",categoria:"",plataforma:""}),this.selectedJuegos="",this.selectedPegi="",this.selectedCategoria="",this.selectedPlataforma=""}}},oQ={class:"Micontainer"},aQ={class:"f-juegos"},lQ={class:"f-pegi"},cQ={class:"f-categoria"},uQ=["value"],hQ={class:"f-plataforma"},dQ=["value"],fQ={class:"ver-todos"};function pQ(t,e,r,l,h,_){return Fi(),tn("div",oQ,[e[12]||(e[12]=gt("h1",null,"Filtros de búsqueda",-1)),gt("form",{onSubmit:e[5]||(e[5]=tk((...y)=>_.submitForm&&_.submitForm(...y),["prevent"])),class:"MiForm"},[gt("div",aQ,[e[6]||(e[6]=gt("h5",{class:"label"},"Nombre del Juego:",-1)),ka(gt("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=y=>h.selectedJuegos=y),placeholder:"Introduce el nombre del juego"},null,512),[[Na,h.selectedJuegos]])]),gt("div",lQ,[e[8]||(e[8]=gt("h5",{class:"label"},"PEGI:",-1)),ka(gt("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":e[1]||(e[1]=y=>h.selectedPegi=y)},e[7]||(e[7]=[A1('<option value="3" data-v-6e15e685>PEGI 3</option><option value="7" data-v-6e15e685>PEGI 7</option><option value="12" data-v-6e15e685>PEGI 12</option><option value="16" data-v-6e15e685>PEGI 16</option><option value="18" data-v-6e15e685>PEGI 18</option>',5)]),512),[[o_,h.selectedPegi]])]),gt("div",cQ,[e[9]||(e[9]=gt("h5",{class:"label"},"Categoría:",-1)),ka(gt("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":e[2]||(e[2]=y=>h.selectedCategoria=y)},[(Fi(!0),tn(os,null,dp(h.categorias,y=>(Fi(),tn("option",{key:y.id_categoria,value:y.nombre},Is(y.nombre),9,uQ))),128))],512),[[o_,h.selectedCategoria]])]),gt("div",hQ,[e[10]||(e[10]=gt("h5",{class:"label"},"Plataforma:",-1)),ka(gt("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":e[3]||(e[3]=y=>h.selectedPlataforma=y)},[(Fi(!0),tn(os,null,dp(h.plataformas,y=>(Fi(),tn("option",{key:y.id_plataforma,value:y.nombre},Is(y.nombre),9,dQ))),128))],512),[[o_,h.selectedPlataforma]])]),e[11]||(e[11]=gt("div",{class:"f-submit"},[gt("button",{type:"submit",class:"btn btn-secondary"},"Buscar")],-1)),gt("div",fQ,[gt("button",{onClick:e[4]||(e[4]=(...y)=>_.verTodosJuegos&&_.verTodosJuegos(...y)),class:"btn btn-light"},"Ver todos los juegos")])],32)])}const mQ=yl(rQ,[["render",pQ],["__scopeId","data-v-6e15e685"]]);const gQ={props:{nombre:String,image:String,juegoID:Number},methods:{goToGame(){const t=window.location.origin+"/public";window.location.href=`${t}/eventos/${this.juegoID}`}}},_Q={class:"canvas"},yQ={id:"card"},vQ=["src","alt"];function xQ(t,e,r,l,h,_){return Fi(),tn("div",{class:"Torneo",onClick:e[0]||(e[0]=(...y)=>_.goToGame&&_.goToGame(...y))},[gt("div",_Q,[e[1]||(e[1]=A1('<div class="tracker tr-1" data-v-975651d1></div><div class="tracker tr-2" data-v-975651d1></div><div class="tracker tr-3" data-v-975651d1></div><div class="tracker tr-4" data-v-975651d1></div><div class="tracker tr-5" data-v-975651d1></div><div class="tracker tr-6" data-v-975651d1></div><div class="tracker tr-7" data-v-975651d1></div><div class="tracker tr-8" data-v-975651d1></div><div class="tracker tr-9" data-v-975651d1></div><div class="tracker tr-10" data-v-975651d1></div><div class="tracker tr-11" data-v-975651d1></div><div class="tracker tr-12" data-v-975651d1></div><div class="tracker tr-13" data-v-975651d1></div><div class="tracker tr-14" data-v-975651d1></div><div class="tracker tr-15" data-v-975651d1></div><div class="tracker tr-16" data-v-975651d1></div><div class="tracker tr-17" data-v-975651d1></div><div class="tracker tr-18" data-v-975651d1></div><div class="tracker tr-19" data-v-975651d1></div><div class="tracker tr-20" data-v-975651d1></div><div class="tracker tr-21" data-v-975651d1></div><div class="tracker tr-22" data-v-975651d1></div><div class="tracker tr-23" data-v-975651d1></div><div class="tracker tr-24" data-v-975651d1></div><div class="tracker tr-25" data-v-975651d1></div>',25)),gt("div",yQ,[gt("img",{src:r.image,alt:r.nombre,class:"torneo-img"},null,8,vQ)])])])}const bQ=yl(gQ,[["render",xQ],["__scopeId","data-v-975651d1"]]);const wQ={components:{torneosCards:bQ,torneosFiltros:mQ},data(){return{torneos:[],torneosFiltrados:[],currentPage:1,lastPage:1,filtros:{}}},methods:{filtrarJuegos(t){this.filtros=t,this.GetJuegosFiltro(t)},GetJuegos(t=1){axios.get("juegos",{params:{page:t}}).then(e=>{this.torneos=e.data.data,this.currentPage=e.data.meta.current_page,this.lastPage=e.data.meta.last_page}).catch(e=>{console.error("Error al cargar los datos:",e)})},GetJuegosFiltro(t,e=1){axios.get("juegos",{params:{juego:t.juego,pegi:t.pegi,categoria:t.categoria,plataforma:t.plataforma,page:e}}).then(r=>{this.torneos=r.data.data,this.currentPage=r.data.meta.current_page,this.lastPage=r.data.meta.last_page}).catch(r=>{console.error("Error al aplicar filtros:",r)})},cambiarPagina(t){this.currentPage=t,Object.keys(this.filtros).length?this.GetJuegosFiltro(this.filtros,t):this.GetJuegos(t)}},created(){this.GetJuegos()}},TQ={class:"TorneosContainer"},EQ={class:"Filtroseccion"},SQ={class:"FiltroJuego"},AQ={class:"ContenedorDeTornoes"},MQ={class:"pagination"},IQ=["disabled"],CQ=["disabled"];function PQ(t,e,r,l,h,_){const y=gx("torneos-filtros"),s=gx("torneos-cards");return Fi(),tn("div",TQ,[gt("div",EQ,[Yn(y,{onFiltrar:_.filtrarJuegos},null,8,["onFiltrar"])]),gt("div",SQ,[gt("div",AQ,[(Fi(!0),tn(os,null,dp(h.torneos,(I,O)=>(Fi(),A_(s,{key:O,image:I.rutas,nombre:I.nombre,juegoID:I.id_juego},null,8,["image","nombre","juegoID"]))),128))]),gt("div",MQ,[gt("button",{disabled:h.currentPage===1,onClick:e[0]||(e[0]=I=>_.cambiarPagina(h.currentPage-1))},"Anterior",8,IQ),gt("span",null,"Página "+Is(h.currentPage)+" de "+Is(h.lastPage),1),gt("button",{disabled:h.currentPage===h.lastPage,onClick:e[1]||(e[1]=I=>_.cambiarPagina(h.currentPage+1))},"Siguiente",8,CQ)])])])}const DQ=yl(wQ,[["render",PQ],["__scopeId","data-v-1d3fe6c4"]]);var RQ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function LQ(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Wz={exports:{}};(function(t,e){(function(r,l){t.exports=l()})(RQ,function(){var r,l,h;function _(s,I){if(!r)r=I;else if(!l)l=I;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",k={};r(k),h=I(k),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}_(["exports"],function(s){function I(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var O,k={},j={};function Z(){if(O)return j;O=1,Object.defineProperty(j,"__esModule",{value:!0}),j.setMatrixArrayType=function(f){j.ARRAY_TYPE=i=f},j.toRadian=function(f){return f*u},j.equals=function(f,d){return Math.abs(f-d)<=c*Math.max(1,Math.abs(f),Math.abs(d))},j.RANDOM=j.ARRAY_TYPE=j.EPSILON=void 0;var c=1e-6;j.EPSILON=c;var i=typeof Float32Array<"u"?Float32Array:Array;j.ARRAY_TYPE=i;var o=Math.random;j.RANDOM=o;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var f=0,d=arguments.length;d--;)f+=arguments[d]*arguments[d];return Math.sqrt(f)}),j}var Y,se={};function ne(){if(Y)return se;function c(d){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(d)}Y=1,Object.defineProperty(se,"__esModule",{value:!0}),se.create=function(){var d=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d},se.clone=function(d){var g=new i.ARRAY_TYPE(4);return g[0]=d[0],g[1]=d[1],g[2]=d[2],g[3]=d[3],g},se.copy=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[3],d},se.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d},se.fromValues=function(d,g,w,E){var M=new i.ARRAY_TYPE(4);return M[0]=d,M[1]=g,M[2]=w,M[3]=E,M},se.set=function(d,g,w,E,M){return d[0]=g,d[1]=w,d[2]=E,d[3]=M,d},se.transpose=function(d,g){if(d===g){var w=g[1];d[1]=g[2],d[2]=w}else d[0]=g[0],d[1]=g[2],d[2]=g[1],d[3]=g[3];return d},se.invert=function(d,g){var w=g[0],E=g[1],M=g[2],x=g[3],S=w*x-M*E;return S?(d[0]=x*(S=1/S),d[1]=-E*S,d[2]=-M*S,d[3]=w*S,d):null},se.adjoint=function(d,g){var w=g[0];return d[0]=g[3],d[1]=-g[1],d[2]=-g[2],d[3]=w,d},se.determinant=function(d){return d[0]*d[3]-d[2]*d[1]},se.multiply=u,se.rotate=function(d,g,w){var E=g[0],M=g[1],x=g[2],S=g[3],P=Math.sin(w),A=Math.cos(w);return d[0]=E*A+x*P,d[1]=M*A+S*P,d[2]=E*-P+x*A,d[3]=M*-P+S*A,d},se.scale=function(d,g,w){var E=g[1],M=g[2],x=g[3],S=w[0],P=w[1];return d[0]=g[0]*S,d[1]=E*S,d[2]=M*P,d[3]=x*P,d},se.fromRotation=function(d,g){var w=Math.sin(g),E=Math.cos(g);return d[0]=E,d[1]=w,d[2]=-w,d[3]=E,d},se.fromScaling=function(d,g){return d[0]=g[0],d[1]=0,d[2]=0,d[3]=g[1],d},se.str=function(d){return"mat2("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")"},se.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3])},se.LDU=function(d,g,w,E){return d[2]=E[2]/E[0],w[0]=E[0],w[1]=E[1],w[3]=E[3]-d[2]*w[1],[d,g,w]},se.add=function(d,g,w){return d[0]=g[0]+w[0],d[1]=g[1]+w[1],d[2]=g[2]+w[2],d[3]=g[3]+w[3],d},se.subtract=f,se.exactEquals=function(d,g){return d[0]===g[0]&&d[1]===g[1]&&d[2]===g[2]&&d[3]===g[3]},se.equals=function(d,g){var w=d[0],E=d[1],M=d[2],x=d[3],S=g[0],P=g[1],A=g[2],C=g[3];return Math.abs(w-S)<=i.EPSILON*Math.max(1,Math.abs(w),Math.abs(S))&&Math.abs(E-P)<=i.EPSILON*Math.max(1,Math.abs(E),Math.abs(P))&&Math.abs(M-A)<=i.EPSILON*Math.max(1,Math.abs(M),Math.abs(A))&&Math.abs(x-C)<=i.EPSILON*Math.max(1,Math.abs(x),Math.abs(C))},se.multiplyScalar=function(d,g,w){return d[0]=g[0]*w,d[1]=g[1]*w,d[2]=g[2]*w,d[3]=g[3]*w,d},se.multiplyScalarAndAdd=function(d,g,w,E){return d[0]=g[0]+w[0]*E,d[1]=g[1]+w[1]*E,d[2]=g[2]+w[2]*E,d[3]=g[3]+w[3]*E,d},se.sub=se.mul=void 0;var i=function(d,g){if(d&&d.__esModule)return d;if(d===null||c(d)!=="object"&&typeof d!="function")return{default:d};var w=o(void 0);if(w&&w.has(d))return w.get(d);var E={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in d)if(x!=="default"&&Object.prototype.hasOwnProperty.call(d,x)){var S=M?Object.getOwnPropertyDescriptor(d,x):null;S&&(S.get||S.set)?Object.defineProperty(E,x,S):E[x]=d[x]}return E.default=d,w&&w.set(d,E),E}(Z());function o(d){if(typeof WeakMap!="function")return null;var g=new WeakMap,w=new WeakMap;return(o=function(E){return E?w:g})(d)}function u(d,g,w){var E=g[0],M=g[1],x=g[2],S=g[3],P=w[0],A=w[1],C=w[2],R=w[3];return d[0]=E*P+x*A,d[1]=M*P+S*A,d[2]=E*C+x*R,d[3]=M*C+S*R,d}function f(d,g,w){return d[0]=g[0]-w[0],d[1]=g[1]-w[1],d[2]=g[2]-w[2],d[3]=g[3]-w[3],d}return se.mul=u,se.sub=f,se}var de,me={};function Te(){if(de)return me;function c(d){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(d)}de=1,Object.defineProperty(me,"__esModule",{value:!0}),me.create=function(){var d=new i.ARRAY_TYPE(6);return i.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[4]=0,d[5]=0),d[0]=1,d[3]=1,d},me.clone=function(d){var g=new i.ARRAY_TYPE(6);return g[0]=d[0],g[1]=d[1],g[2]=d[2],g[3]=d[3],g[4]=d[4],g[5]=d[5],g},me.copy=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[3],d[4]=g[4],d[5]=g[5],d},me.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=0,d[5]=0,d},me.fromValues=function(d,g,w,E,M,x){var S=new i.ARRAY_TYPE(6);return S[0]=d,S[1]=g,S[2]=w,S[3]=E,S[4]=M,S[5]=x,S},me.set=function(d,g,w,E,M,x,S){return d[0]=g,d[1]=w,d[2]=E,d[3]=M,d[4]=x,d[5]=S,d},me.invert=function(d,g){var w=g[0],E=g[1],M=g[2],x=g[3],S=g[4],P=g[5],A=w*x-E*M;return A?(d[0]=x*(A=1/A),d[1]=-E*A,d[2]=-M*A,d[3]=w*A,d[4]=(M*P-x*S)*A,d[5]=(E*S-w*P)*A,d):null},me.determinant=function(d){return d[0]*d[3]-d[1]*d[2]},me.multiply=u,me.rotate=function(d,g,w){var E=g[0],M=g[1],x=g[2],S=g[3],P=g[4],A=g[5],C=Math.sin(w),R=Math.cos(w);return d[0]=E*R+x*C,d[1]=M*R+S*C,d[2]=E*-C+x*R,d[3]=M*-C+S*R,d[4]=P,d[5]=A,d},me.scale=function(d,g,w){var E=g[1],M=g[2],x=g[3],S=g[4],P=g[5],A=w[0],C=w[1];return d[0]=g[0]*A,d[1]=E*A,d[2]=M*C,d[3]=x*C,d[4]=S,d[5]=P,d},me.translate=function(d,g,w){var E=g[0],M=g[1],x=g[2],S=g[3],P=g[4],A=g[5],C=w[0],R=w[1];return d[0]=E,d[1]=M,d[2]=x,d[3]=S,d[4]=E*C+x*R+P,d[5]=M*C+S*R+A,d},me.fromRotation=function(d,g){var w=Math.sin(g),E=Math.cos(g);return d[0]=E,d[1]=w,d[2]=-w,d[3]=E,d[4]=0,d[5]=0,d},me.fromScaling=function(d,g){return d[0]=g[0],d[1]=0,d[2]=0,d[3]=g[1],d[4]=0,d[5]=0,d},me.fromTranslation=function(d,g){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=g[0],d[5]=g[1],d},me.str=function(d){return"mat2d("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+")"},me.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],1)},me.add=function(d,g,w){return d[0]=g[0]+w[0],d[1]=g[1]+w[1],d[2]=g[2]+w[2],d[3]=g[3]+w[3],d[4]=g[4]+w[4],d[5]=g[5]+w[5],d},me.subtract=f,me.multiplyScalar=function(d,g,w){return d[0]=g[0]*w,d[1]=g[1]*w,d[2]=g[2]*w,d[3]=g[3]*w,d[4]=g[4]*w,d[5]=g[5]*w,d},me.multiplyScalarAndAdd=function(d,g,w,E){return d[0]=g[0]+w[0]*E,d[1]=g[1]+w[1]*E,d[2]=g[2]+w[2]*E,d[3]=g[3]+w[3]*E,d[4]=g[4]+w[4]*E,d[5]=g[5]+w[5]*E,d},me.exactEquals=function(d,g){return d[0]===g[0]&&d[1]===g[1]&&d[2]===g[2]&&d[3]===g[3]&&d[4]===g[4]&&d[5]===g[5]},me.equals=function(d,g){var w=d[0],E=d[1],M=d[2],x=d[3],S=d[4],P=d[5],A=g[0],C=g[1],R=g[2],B=g[3],N=g[4],G=g[5];return Math.abs(w-A)<=i.EPSILON*Math.max(1,Math.abs(w),Math.abs(A))&&Math.abs(E-C)<=i.EPSILON*Math.max(1,Math.abs(E),Math.abs(C))&&Math.abs(M-R)<=i.EPSILON*Math.max(1,Math.abs(M),Math.abs(R))&&Math.abs(x-B)<=i.EPSILON*Math.max(1,Math.abs(x),Math.abs(B))&&Math.abs(S-N)<=i.EPSILON*Math.max(1,Math.abs(S),Math.abs(N))&&Math.abs(P-G)<=i.EPSILON*Math.max(1,Math.abs(P),Math.abs(G))},me.sub=me.mul=void 0;var i=function(d,g){if(d&&d.__esModule)return d;if(d===null||c(d)!=="object"&&typeof d!="function")return{default:d};var w=o(void 0);if(w&&w.has(d))return w.get(d);var E={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in d)if(x!=="default"&&Object.prototype.hasOwnProperty.call(d,x)){var S=M?Object.getOwnPropertyDescriptor(d,x):null;S&&(S.get||S.set)?Object.defineProperty(E,x,S):E[x]=d[x]}return E.default=d,w&&w.set(d,E),E}(Z());function o(d){if(typeof WeakMap!="function")return null;var g=new WeakMap,w=new WeakMap;return(o=function(E){return E?w:g})(d)}function u(d,g,w){var E=g[0],M=g[1],x=g[2],S=g[3],P=g[4],A=g[5],C=w[0],R=w[1],B=w[2],N=w[3],G=w[4],H=w[5];return d[0]=E*C+x*R,d[1]=M*C+S*R,d[2]=E*B+x*N,d[3]=M*B+S*N,d[4]=E*G+x*H+P,d[5]=M*G+S*H+A,d}function f(d,g,w){return d[0]=g[0]-w[0],d[1]=g[1]-w[1],d[2]=g[2]-w[2],d[3]=g[3]-w[3],d[4]=g[4]-w[4],d[5]=g[5]-w[5],d}return me.mul=u,me.sub=f,me}var ge,fe={};function Ae(){if(ge)return fe;function c(d){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(d)}ge=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.create=function(){var d=new i.ARRAY_TYPE(9);return i.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d},fe.fromMat4=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[4],d[4]=g[5],d[5]=g[6],d[6]=g[8],d[7]=g[9],d[8]=g[10],d},fe.clone=function(d){var g=new i.ARRAY_TYPE(9);return g[0]=d[0],g[1]=d[1],g[2]=d[2],g[3]=d[3],g[4]=d[4],g[5]=d[5],g[6]=d[6],g[7]=d[7],g[8]=d[8],g},fe.copy=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[3],d[4]=g[4],d[5]=g[5],d[6]=g[6],d[7]=g[7],d[8]=g[8],d},fe.fromValues=function(d,g,w,E,M,x,S,P,A){var C=new i.ARRAY_TYPE(9);return C[0]=d,C[1]=g,C[2]=w,C[3]=E,C[4]=M,C[5]=x,C[6]=S,C[7]=P,C[8]=A,C},fe.set=function(d,g,w,E,M,x,S,P,A,C){return d[0]=g,d[1]=w,d[2]=E,d[3]=M,d[4]=x,d[5]=S,d[6]=P,d[7]=A,d[8]=C,d},fe.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},fe.transpose=function(d,g){if(d===g){var w=g[1],E=g[2],M=g[5];d[1]=g[3],d[2]=g[6],d[3]=w,d[5]=g[7],d[6]=E,d[7]=M}else d[0]=g[0],d[1]=g[3],d[2]=g[6],d[3]=g[1],d[4]=g[4],d[5]=g[7],d[6]=g[2],d[7]=g[5],d[8]=g[8];return d},fe.invert=function(d,g){var w=g[0],E=g[1],M=g[2],x=g[3],S=g[4],P=g[5],A=g[6],C=g[7],R=g[8],B=R*S-P*C,N=-R*x+P*A,G=C*x-S*A,H=w*B+E*N+M*G;return H?(d[0]=B*(H=1/H),d[1]=(-R*E+M*C)*H,d[2]=(P*E-M*S)*H,d[3]=N*H,d[4]=(R*w-M*A)*H,d[5]=(-P*w+M*x)*H,d[6]=G*H,d[7]=(-C*w+E*A)*H,d[8]=(S*w-E*x)*H,d):null},fe.adjoint=function(d,g){var w=g[0],E=g[1],M=g[2],x=g[3],S=g[4],P=g[5],A=g[6],C=g[7],R=g[8];return d[0]=S*R-P*C,d[1]=M*C-E*R,d[2]=E*P-M*S,d[3]=P*A-x*R,d[4]=w*R-M*A,d[5]=M*x-w*P,d[6]=x*C-S*A,d[7]=E*A-w*C,d[8]=w*S-E*x,d},fe.determinant=function(d){var g=d[3],w=d[4],E=d[5],M=d[6],x=d[7],S=d[8];return d[0]*(S*w-E*x)+d[1]*(-S*g+E*M)+d[2]*(x*g-w*M)},fe.multiply=u,fe.translate=function(d,g,w){var E=g[0],M=g[1],x=g[2],S=g[3],P=g[4],A=g[5],C=g[6],R=g[7],B=g[8],N=w[0],G=w[1];return d[0]=E,d[1]=M,d[2]=x,d[3]=S,d[4]=P,d[5]=A,d[6]=N*E+G*S+C,d[7]=N*M+G*P+R,d[8]=N*x+G*A+B,d},fe.rotate=function(d,g,w){var E=g[0],M=g[1],x=g[2],S=g[3],P=g[4],A=g[5],C=g[6],R=g[7],B=g[8],N=Math.sin(w),G=Math.cos(w);return d[0]=G*E+N*S,d[1]=G*M+N*P,d[2]=G*x+N*A,d[3]=G*S-N*E,d[4]=G*P-N*M,d[5]=G*A-N*x,d[6]=C,d[7]=R,d[8]=B,d},fe.scale=function(d,g,w){var E=w[0],M=w[1];return d[0]=E*g[0],d[1]=E*g[1],d[2]=E*g[2],d[3]=M*g[3],d[4]=M*g[4],d[5]=M*g[5],d[6]=g[6],d[7]=g[7],d[8]=g[8],d},fe.fromTranslation=function(d,g){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=g[0],d[7]=g[1],d[8]=1,d},fe.fromRotation=function(d,g){var w=Math.sin(g),E=Math.cos(g);return d[0]=E,d[1]=w,d[2]=0,d[3]=-w,d[4]=E,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},fe.fromScaling=function(d,g){return d[0]=g[0],d[1]=0,d[2]=0,d[3]=0,d[4]=g[1],d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},fe.fromMat2d=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=0,d[3]=g[2],d[4]=g[3],d[5]=0,d[6]=g[4],d[7]=g[5],d[8]=1,d},fe.fromQuat=function(d,g){var w=g[0],E=g[1],M=g[2],x=g[3],S=w+w,P=E+E,A=M+M,C=w*S,R=E*S,B=E*P,N=M*S,G=M*P,H=M*A,$=x*S,W=x*P,K=x*A;return d[0]=1-B-H,d[3]=R-K,d[6]=N+W,d[1]=R+K,d[4]=1-C-H,d[7]=G-$,d[2]=N-W,d[5]=G+$,d[8]=1-C-B,d},fe.normalFromMat4=function(d,g){var w=g[0],E=g[1],M=g[2],x=g[3],S=g[4],P=g[5],A=g[6],C=g[7],R=g[8],B=g[9],N=g[10],G=g[11],H=g[12],$=g[13],W=g[14],K=g[15],Q=w*P-E*S,ue=w*A-M*S,oe=w*C-x*S,ae=E*A-M*P,Ee=E*C-x*P,he=M*C-x*A,Se=R*$-B*H,Le=R*W-N*H,De=R*K-G*H,Fe=B*W-N*$,ke=B*K-G*$,He=N*K-G*W,Ve=Q*He-ue*ke+oe*Fe+ae*De-Ee*Le+he*Se;return Ve?(d[0]=(P*He-A*ke+C*Fe)*(Ve=1/Ve),d[1]=(A*De-S*He-C*Le)*Ve,d[2]=(S*ke-P*De+C*Se)*Ve,d[3]=(M*ke-E*He-x*Fe)*Ve,d[4]=(w*He-M*De+x*Le)*Ve,d[5]=(E*De-w*ke-x*Se)*Ve,d[6]=($*he-W*Ee+K*ae)*Ve,d[7]=(W*oe-H*he-K*ue)*Ve,d[8]=(H*Ee-$*oe+K*Q)*Ve,d):null},fe.projection=function(d,g,w){return d[0]=2/g,d[1]=0,d[2]=0,d[3]=0,d[4]=-2/w,d[5]=0,d[6]=-1,d[7]=1,d[8]=1,d},fe.str=function(d){return"mat3("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+", "+d[6]+", "+d[7]+", "+d[8]+")"},fe.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8])},fe.add=function(d,g,w){return d[0]=g[0]+w[0],d[1]=g[1]+w[1],d[2]=g[2]+w[2],d[3]=g[3]+w[3],d[4]=g[4]+w[4],d[5]=g[5]+w[5],d[6]=g[6]+w[6],d[7]=g[7]+w[7],d[8]=g[8]+w[8],d},fe.subtract=f,fe.multiplyScalar=function(d,g,w){return d[0]=g[0]*w,d[1]=g[1]*w,d[2]=g[2]*w,d[3]=g[3]*w,d[4]=g[4]*w,d[5]=g[5]*w,d[6]=g[6]*w,d[7]=g[7]*w,d[8]=g[8]*w,d},fe.multiplyScalarAndAdd=function(d,g,w,E){return d[0]=g[0]+w[0]*E,d[1]=g[1]+w[1]*E,d[2]=g[2]+w[2]*E,d[3]=g[3]+w[3]*E,d[4]=g[4]+w[4]*E,d[5]=g[5]+w[5]*E,d[6]=g[6]+w[6]*E,d[7]=g[7]+w[7]*E,d[8]=g[8]+w[8]*E,d},fe.exactEquals=function(d,g){return d[0]===g[0]&&d[1]===g[1]&&d[2]===g[2]&&d[3]===g[3]&&d[4]===g[4]&&d[5]===g[5]&&d[6]===g[6]&&d[7]===g[7]&&d[8]===g[8]},fe.equals=function(d,g){var w=d[0],E=d[1],M=d[2],x=d[3],S=d[4],P=d[5],A=d[6],C=d[7],R=d[8],B=g[0],N=g[1],G=g[2],H=g[3],$=g[4],W=g[5],K=g[6],Q=g[7],ue=g[8];return Math.abs(w-B)<=i.EPSILON*Math.max(1,Math.abs(w),Math.abs(B))&&Math.abs(E-N)<=i.EPSILON*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(M-G)<=i.EPSILON*Math.max(1,Math.abs(M),Math.abs(G))&&Math.abs(x-H)<=i.EPSILON*Math.max(1,Math.abs(x),Math.abs(H))&&Math.abs(S-$)<=i.EPSILON*Math.max(1,Math.abs(S),Math.abs($))&&Math.abs(P-W)<=i.EPSILON*Math.max(1,Math.abs(P),Math.abs(W))&&Math.abs(A-K)<=i.EPSILON*Math.max(1,Math.abs(A),Math.abs(K))&&Math.abs(C-Q)<=i.EPSILON*Math.max(1,Math.abs(C),Math.abs(Q))&&Math.abs(R-ue)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(ue))},fe.sub=fe.mul=void 0;var i=function(d,g){if(d&&d.__esModule)return d;if(d===null||c(d)!=="object"&&typeof d!="function")return{default:d};var w=o(void 0);if(w&&w.has(d))return w.get(d);var E={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in d)if(x!=="default"&&Object.prototype.hasOwnProperty.call(d,x)){var S=M?Object.getOwnPropertyDescriptor(d,x):null;S&&(S.get||S.set)?Object.defineProperty(E,x,S):E[x]=d[x]}return E.default=d,w&&w.set(d,E),E}(Z());function o(d){if(typeof WeakMap!="function")return null;var g=new WeakMap,w=new WeakMap;return(o=function(E){return E?w:g})(d)}function u(d,g,w){var E=g[0],M=g[1],x=g[2],S=g[3],P=g[4],A=g[5],C=g[6],R=g[7],B=g[8],N=w[0],G=w[1],H=w[2],$=w[3],W=w[4],K=w[5],Q=w[6],ue=w[7],oe=w[8];return d[0]=N*E+G*S+H*C,d[1]=N*M+G*P+H*R,d[2]=N*x+G*A+H*B,d[3]=$*E+W*S+K*C,d[4]=$*M+W*P+K*R,d[5]=$*x+W*A+K*B,d[6]=Q*E+ue*S+oe*C,d[7]=Q*M+ue*P+oe*R,d[8]=Q*x+ue*A+oe*B,d}function f(d,g,w){return d[0]=g[0]-w[0],d[1]=g[1]-w[1],d[2]=g[2]-w[2],d[3]=g[3]-w[3],d[4]=g[4]-w[4],d[5]=g[5]-w[5],d[6]=g[6]-w[6],d[7]=g[7]-w[7],d[8]=g[8]-w[8],d}return fe.mul=u,fe.sub=f,fe}var Ge,ze={};function Ke(){if(Ge)return ze;function c(x){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},c(x)}Ge=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.create=function(){var x=new i.ARRAY_TYPE(16);return i.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},ze.clone=function(x){var S=new i.ARRAY_TYPE(16);return S[0]=x[0],S[1]=x[1],S[2]=x[2],S[3]=x[3],S[4]=x[4],S[5]=x[5],S[6]=x[6],S[7]=x[7],S[8]=x[8],S[9]=x[9],S[10]=x[10],S[11]=x[11],S[12]=x[12],S[13]=x[13],S[14]=x[14],S[15]=x[15],S},ze.copy=function(x,S){return x[0]=S[0],x[1]=S[1],x[2]=S[2],x[3]=S[3],x[4]=S[4],x[5]=S[5],x[6]=S[6],x[7]=S[7],x[8]=S[8],x[9]=S[9],x[10]=S[10],x[11]=S[11],x[12]=S[12],x[13]=S[13],x[14]=S[14],x[15]=S[15],x},ze.fromValues=function(x,S,P,A,C,R,B,N,G,H,$,W,K,Q,ue,oe){var ae=new i.ARRAY_TYPE(16);return ae[0]=x,ae[1]=S,ae[2]=P,ae[3]=A,ae[4]=C,ae[5]=R,ae[6]=B,ae[7]=N,ae[8]=G,ae[9]=H,ae[10]=$,ae[11]=W,ae[12]=K,ae[13]=Q,ae[14]=ue,ae[15]=oe,ae},ze.set=function(x,S,P,A,C,R,B,N,G,H,$,W,K,Q,ue,oe,ae){return x[0]=S,x[1]=P,x[2]=A,x[3]=C,x[4]=R,x[5]=B,x[6]=N,x[7]=G,x[8]=H,x[9]=$,x[10]=W,x[11]=K,x[12]=Q,x[13]=ue,x[14]=oe,x[15]=ae,x},ze.identity=u,ze.transpose=function(x,S){if(x===S){var P=S[1],A=S[2],C=S[3],R=S[6],B=S[7],N=S[11];x[1]=S[4],x[2]=S[8],x[3]=S[12],x[4]=P,x[6]=S[9],x[7]=S[13],x[8]=A,x[9]=R,x[11]=S[14],x[12]=C,x[13]=B,x[14]=N}else x[0]=S[0],x[1]=S[4],x[2]=S[8],x[3]=S[12],x[4]=S[1],x[5]=S[5],x[6]=S[9],x[7]=S[13],x[8]=S[2],x[9]=S[6],x[10]=S[10],x[11]=S[14],x[12]=S[3],x[13]=S[7],x[14]=S[11],x[15]=S[15];return x},ze.invert=function(x,S){var P=S[0],A=S[1],C=S[2],R=S[3],B=S[4],N=S[5],G=S[6],H=S[7],$=S[8],W=S[9],K=S[10],Q=S[11],ue=S[12],oe=S[13],ae=S[14],Ee=S[15],he=P*N-A*B,Se=P*G-C*B,Le=P*H-R*B,De=A*G-C*N,Fe=A*H-R*N,ke=C*H-R*G,He=$*oe-W*ue,Ve=$*ae-K*ue,qe=$*Ee-Q*ue,pt=W*ae-K*oe,dt=W*Ee-Q*oe,Ft=K*Ee-Q*ae,_t=he*Ft-Se*dt+Le*pt+De*qe-Fe*Ve+ke*He;return _t?(x[0]=(N*Ft-G*dt+H*pt)*(_t=1/_t),x[1]=(C*dt-A*Ft-R*pt)*_t,x[2]=(oe*ke-ae*Fe+Ee*De)*_t,x[3]=(K*Fe-W*ke-Q*De)*_t,x[4]=(G*qe-B*Ft-H*Ve)*_t,x[5]=(P*Ft-C*qe+R*Ve)*_t,x[6]=(ae*Le-ue*ke-Ee*Se)*_t,x[7]=($*ke-K*Le+Q*Se)*_t,x[8]=(B*dt-N*qe+H*He)*_t,x[9]=(A*qe-P*dt-R*He)*_t,x[10]=(ue*Fe-oe*Le+Ee*he)*_t,x[11]=(W*Le-$*Fe-Q*he)*_t,x[12]=(N*Ve-B*pt-G*He)*_t,x[13]=(P*pt-A*Ve+C*He)*_t,x[14]=(oe*Se-ue*De-ae*he)*_t,x[15]=($*De-W*Se+K*he)*_t,x):null},ze.adjoint=function(x,S){var P=S[0],A=S[1],C=S[2],R=S[3],B=S[4],N=S[5],G=S[6],H=S[7],$=S[8],W=S[9],K=S[10],Q=S[11],ue=S[12],oe=S[13],ae=S[14],Ee=S[15];return x[0]=N*(K*Ee-Q*ae)-W*(G*Ee-H*ae)+oe*(G*Q-H*K),x[1]=-(A*(K*Ee-Q*ae)-W*(C*Ee-R*ae)+oe*(C*Q-R*K)),x[2]=A*(G*Ee-H*ae)-N*(C*Ee-R*ae)+oe*(C*H-R*G),x[3]=-(A*(G*Q-H*K)-N*(C*Q-R*K)+W*(C*H-R*G)),x[4]=-(B*(K*Ee-Q*ae)-$*(G*Ee-H*ae)+ue*(G*Q-H*K)),x[5]=P*(K*Ee-Q*ae)-$*(C*Ee-R*ae)+ue*(C*Q-R*K),x[6]=-(P*(G*Ee-H*ae)-B*(C*Ee-R*ae)+ue*(C*H-R*G)),x[7]=P*(G*Q-H*K)-B*(C*Q-R*K)+$*(C*H-R*G),x[8]=B*(W*Ee-Q*oe)-$*(N*Ee-H*oe)+ue*(N*Q-H*W),x[9]=-(P*(W*Ee-Q*oe)-$*(A*Ee-R*oe)+ue*(A*Q-R*W)),x[10]=P*(N*Ee-H*oe)-B*(A*Ee-R*oe)+ue*(A*H-R*N),x[11]=-(P*(N*Q-H*W)-B*(A*Q-R*W)+$*(A*H-R*N)),x[12]=-(B*(W*ae-K*oe)-$*(N*ae-G*oe)+ue*(N*K-G*W)),x[13]=P*(W*ae-K*oe)-$*(A*ae-C*oe)+ue*(A*K-C*W),x[14]=-(P*(N*ae-G*oe)-B*(A*ae-C*oe)+ue*(A*G-C*N)),x[15]=P*(N*K-G*W)-B*(A*K-C*W)+$*(A*G-C*N),x},ze.determinant=function(x){var S=x[0],P=x[1],A=x[2],C=x[3],R=x[4],B=x[5],N=x[6],G=x[7],H=x[8],$=x[9],W=x[10],K=x[11],Q=x[12],ue=x[13],oe=x[14],ae=x[15];return(S*B-P*R)*(W*ae-K*oe)-(S*N-A*R)*($*ae-K*ue)+(S*G-C*R)*($*oe-W*ue)+(P*N-A*B)*(H*ae-K*Q)-(P*G-C*B)*(H*oe-W*Q)+(A*G-C*N)*(H*ue-$*Q)},ze.multiply=f,ze.translate=function(x,S,P){var A,C,R,B,N,G,H,$,W,K,Q,ue,oe=P[0],ae=P[1],Ee=P[2];return S===x?(x[12]=S[0]*oe+S[4]*ae+S[8]*Ee+S[12],x[13]=S[1]*oe+S[5]*ae+S[9]*Ee+S[13],x[14]=S[2]*oe+S[6]*ae+S[10]*Ee+S[14],x[15]=S[3]*oe+S[7]*ae+S[11]*Ee+S[15]):(C=S[1],R=S[2],B=S[3],N=S[4],G=S[5],H=S[6],$=S[7],W=S[8],K=S[9],Q=S[10],ue=S[11],x[0]=A=S[0],x[1]=C,x[2]=R,x[3]=B,x[4]=N,x[5]=G,x[6]=H,x[7]=$,x[8]=W,x[9]=K,x[10]=Q,x[11]=ue,x[12]=A*oe+N*ae+W*Ee+S[12],x[13]=C*oe+G*ae+K*Ee+S[13],x[14]=R*oe+H*ae+Q*Ee+S[14],x[15]=B*oe+$*ae+ue*Ee+S[15]),x},ze.scale=function(x,S,P){var A=P[0],C=P[1],R=P[2];return x[0]=S[0]*A,x[1]=S[1]*A,x[2]=S[2]*A,x[3]=S[3]*A,x[4]=S[4]*C,x[5]=S[5]*C,x[6]=S[6]*C,x[7]=S[7]*C,x[8]=S[8]*R,x[9]=S[9]*R,x[10]=S[10]*R,x[11]=S[11]*R,x[12]=S[12],x[13]=S[13],x[14]=S[14],x[15]=S[15],x},ze.rotate=function(x,S,P,A){var C,R,B,N,G,H,$,W,K,Q,ue,oe,ae,Ee,he,Se,Le,De,Fe,ke,He,Ve,qe,pt,dt=A[0],Ft=A[1],_t=A[2],Et=Math.hypot(dt,Ft,_t);return Et<i.EPSILON?null:(dt*=Et=1/Et,Ft*=Et,_t*=Et,C=Math.sin(P),R=Math.cos(P),G=S[1],H=S[2],$=S[3],K=S[5],Q=S[6],ue=S[7],ae=S[9],Ee=S[10],he=S[11],Se=dt*dt*(B=1-R)+R,Fe=dt*Ft*B-_t*C,ke=Ft*Ft*B+R,He=_t*Ft*B+dt*C,Ve=dt*_t*B+Ft*C,qe=Ft*_t*B-dt*C,pt=_t*_t*B+R,x[0]=(N=S[0])*Se+(W=S[4])*(Le=Ft*dt*B+_t*C)+(oe=S[8])*(De=_t*dt*B-Ft*C),x[1]=G*Se+K*Le+ae*De,x[2]=H*Se+Q*Le+Ee*De,x[3]=$*Se+ue*Le+he*De,x[4]=N*Fe+W*ke+oe*He,x[5]=G*Fe+K*ke+ae*He,x[6]=H*Fe+Q*ke+Ee*He,x[7]=$*Fe+ue*ke+he*He,x[8]=N*Ve+W*qe+oe*pt,x[9]=G*Ve+K*qe+ae*pt,x[10]=H*Ve+Q*qe+Ee*pt,x[11]=$*Ve+ue*qe+he*pt,S!==x&&(x[12]=S[12],x[13]=S[13],x[14]=S[14],x[15]=S[15]),x)},ze.rotateX=function(x,S,P){var A=Math.sin(P),C=Math.cos(P),R=S[4],B=S[5],N=S[6],G=S[7],H=S[8],$=S[9],W=S[10],K=S[11];return S!==x&&(x[0]=S[0],x[1]=S[1],x[2]=S[2],x[3]=S[3],x[12]=S[12],x[13]=S[13],x[14]=S[14],x[15]=S[15]),x[4]=R*C+H*A,x[5]=B*C+$*A,x[6]=N*C+W*A,x[7]=G*C+K*A,x[8]=H*C-R*A,x[9]=$*C-B*A,x[10]=W*C-N*A,x[11]=K*C-G*A,x},ze.rotateY=function(x,S,P){var A=Math.sin(P),C=Math.cos(P),R=S[0],B=S[1],N=S[2],G=S[3],H=S[8],$=S[9],W=S[10],K=S[11];return S!==x&&(x[4]=S[4],x[5]=S[5],x[6]=S[6],x[7]=S[7],x[12]=S[12],x[13]=S[13],x[14]=S[14],x[15]=S[15]),x[0]=R*C-H*A,x[1]=B*C-$*A,x[2]=N*C-W*A,x[3]=G*C-K*A,x[8]=R*A+H*C,x[9]=B*A+$*C,x[10]=N*A+W*C,x[11]=G*A+K*C,x},ze.rotateZ=function(x,S,P){var A=Math.sin(P),C=Math.cos(P),R=S[0],B=S[1],N=S[2],G=S[3],H=S[4],$=S[5],W=S[6],K=S[7];return S!==x&&(x[8]=S[8],x[9]=S[9],x[10]=S[10],x[11]=S[11],x[12]=S[12],x[13]=S[13],x[14]=S[14],x[15]=S[15]),x[0]=R*C+H*A,x[1]=B*C+$*A,x[2]=N*C+W*A,x[3]=G*C+K*A,x[4]=H*C-R*A,x[5]=$*C-B*A,x[6]=W*C-N*A,x[7]=K*C-G*A,x},ze.fromTranslation=function(x,S){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=S[0],x[13]=S[1],x[14]=S[2],x[15]=1,x},ze.fromScaling=function(x,S){return x[0]=S[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=S[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=S[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ze.fromRotation=function(x,S,P){var A,C,R,B=P[0],N=P[1],G=P[2],H=Math.hypot(B,N,G);return H<i.EPSILON?null:(B*=H=1/H,N*=H,G*=H,A=Math.sin(S),C=Math.cos(S),x[0]=B*B*(R=1-C)+C,x[1]=N*B*R+G*A,x[2]=G*B*R-N*A,x[3]=0,x[4]=B*N*R-G*A,x[5]=N*N*R+C,x[6]=G*N*R+B*A,x[7]=0,x[8]=B*G*R+N*A,x[9]=N*G*R-B*A,x[10]=G*G*R+C,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},ze.fromXRotation=function(x,S){var P=Math.sin(S),A=Math.cos(S);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=A,x[6]=P,x[7]=0,x[8]=0,x[9]=-P,x[10]=A,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ze.fromYRotation=function(x,S){var P=Math.sin(S),A=Math.cos(S);return x[0]=A,x[1]=0,x[2]=-P,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=P,x[9]=0,x[10]=A,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ze.fromZRotation=function(x,S){var P=Math.sin(S),A=Math.cos(S);return x[0]=A,x[1]=P,x[2]=0,x[3]=0,x[4]=-P,x[5]=A,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ze.fromRotationTranslation=d,ze.fromQuat2=function(x,S){var P=new i.ARRAY_TYPE(3),A=-S[0],C=-S[1],R=-S[2],B=S[3],N=S[4],G=S[5],H=S[6],$=S[7],W=A*A+C*C+R*R+B*B;return W>0?(P[0]=2*(N*B+$*A+G*R-H*C)/W,P[1]=2*(G*B+$*C+H*A-N*R)/W,P[2]=2*(H*B+$*R+N*C-G*A)/W):(P[0]=2*(N*B+$*A+G*R-H*C),P[1]=2*(G*B+$*C+H*A-N*R),P[2]=2*(H*B+$*R+N*C-G*A)),d(x,S,P),x},ze.getTranslation=function(x,S){return x[0]=S[12],x[1]=S[13],x[2]=S[14],x},ze.getScaling=g,ze.getRotation=function(x,S){var P=new i.ARRAY_TYPE(3);g(P,S);var A=1/P[0],C=1/P[1],R=1/P[2],B=S[0]*A,N=S[1]*C,G=S[2]*R,H=S[4]*A,$=S[5]*C,W=S[6]*R,K=S[8]*A,Q=S[9]*C,ue=S[10]*R,oe=B+$+ue,ae=0;return oe>0?(ae=2*Math.sqrt(oe+1),x[3]=.25*ae,x[0]=(W-Q)/ae,x[1]=(K-G)/ae,x[2]=(N-H)/ae):B>$&&B>ue?(ae=2*Math.sqrt(1+B-$-ue),x[3]=(W-Q)/ae,x[0]=.25*ae,x[1]=(N+H)/ae,x[2]=(K+G)/ae):$>ue?(ae=2*Math.sqrt(1+$-B-ue),x[3]=(K-G)/ae,x[0]=(N+H)/ae,x[1]=.25*ae,x[2]=(W+Q)/ae):(ae=2*Math.sqrt(1+ue-B-$),x[3]=(N-H)/ae,x[0]=(K+G)/ae,x[1]=(W+Q)/ae,x[2]=.25*ae),x},ze.fromRotationTranslationScale=function(x,S,P,A){var C=S[0],R=S[1],B=S[2],N=S[3],G=C+C,H=R+R,$=B+B,W=C*G,K=C*H,Q=C*$,ue=R*H,oe=R*$,ae=B*$,Ee=N*G,he=N*H,Se=N*$,Le=A[0],De=A[1],Fe=A[2];return x[0]=(1-(ue+ae))*Le,x[1]=(K+Se)*Le,x[2]=(Q-he)*Le,x[3]=0,x[4]=(K-Se)*De,x[5]=(1-(W+ae))*De,x[6]=(oe+Ee)*De,x[7]=0,x[8]=(Q+he)*Fe,x[9]=(oe-Ee)*Fe,x[10]=(1-(W+ue))*Fe,x[11]=0,x[12]=P[0],x[13]=P[1],x[14]=P[2],x[15]=1,x},ze.fromRotationTranslationScaleOrigin=function(x,S,P,A,C){var R=S[0],B=S[1],N=S[2],G=S[3],H=R+R,$=B+B,W=N+N,K=R*H,Q=R*$,ue=R*W,oe=B*$,ae=B*W,Ee=N*W,he=G*H,Se=G*$,Le=G*W,De=A[0],Fe=A[1],ke=A[2],He=C[0],Ve=C[1],qe=C[2],pt=(1-(oe+Ee))*De,dt=(Q+Le)*De,Ft=(ue-Se)*De,_t=(Q-Le)*Fe,Et=(1-(K+Ee))*Fe,mt=(ae+he)*Fe,ei=(ue+Se)*ke,Lt=(ae-he)*ke,jt=(1-(K+oe))*ke;return x[0]=pt,x[1]=dt,x[2]=Ft,x[3]=0,x[4]=_t,x[5]=Et,x[6]=mt,x[7]=0,x[8]=ei,x[9]=Lt,x[10]=jt,x[11]=0,x[12]=P[0]+He-(pt*He+_t*Ve+ei*qe),x[13]=P[1]+Ve-(dt*He+Et*Ve+Lt*qe),x[14]=P[2]+qe-(Ft*He+mt*Ve+jt*qe),x[15]=1,x},ze.fromQuat=function(x,S){var P=S[0],A=S[1],C=S[2],R=S[3],B=P+P,N=A+A,G=C+C,H=P*B,$=A*B,W=A*N,K=C*B,Q=C*N,ue=C*G,oe=R*B,ae=R*N,Ee=R*G;return x[0]=1-W-ue,x[1]=$+Ee,x[2]=K-ae,x[3]=0,x[4]=$-Ee,x[5]=1-H-ue,x[6]=Q+oe,x[7]=0,x[8]=K+ae,x[9]=Q-oe,x[10]=1-H-W,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ze.frustum=function(x,S,P,A,C,R,B){var N=1/(P-S),G=1/(C-A),H=1/(R-B);return x[0]=2*R*N,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*R*G,x[6]=0,x[7]=0,x[8]=(P+S)*N,x[9]=(C+A)*G,x[10]=(B+R)*H,x[11]=-1,x[12]=0,x[13]=0,x[14]=B*R*2*H,x[15]=0,x},ze.perspectiveNO=w,ze.perspectiveZO=function(x,S,P,A,C){var R,B=1/Math.tan(S/2);return x[0]=B/P,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=B,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,C!=null&&C!==1/0?(x[10]=C*(R=1/(A-C)),x[14]=C*A*R):(x[10]=-1,x[14]=-A),x},ze.perspectiveFromFieldOfView=function(x,S,P,A){var C=Math.tan(S.upDegrees*Math.PI/180),R=Math.tan(S.downDegrees*Math.PI/180),B=Math.tan(S.leftDegrees*Math.PI/180),N=Math.tan(S.rightDegrees*Math.PI/180),G=2/(B+N),H=2/(C+R);return x[0]=G,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=H,x[6]=0,x[7]=0,x[8]=-(B-N)*G*.5,x[9]=(C-R)*H*.5,x[10]=A/(P-A),x[11]=-1,x[12]=0,x[13]=0,x[14]=A*P/(P-A),x[15]=0,x},ze.orthoNO=E,ze.orthoZO=function(x,S,P,A,C,R,B){var N=1/(S-P),G=1/(A-C),H=1/(R-B);return x[0]=-2*N,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*G,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=H,x[11]=0,x[12]=(S+P)*N,x[13]=(C+A)*G,x[14]=R*H,x[15]=1,x},ze.lookAt=function(x,S,P,A){var C,R,B,N,G,H,$,W,K,Q,ue=S[0],oe=S[1],ae=S[2],Ee=A[0],he=A[1],Se=A[2],Le=P[0],De=P[1],Fe=P[2];return Math.abs(ue-Le)<i.EPSILON&&Math.abs(oe-De)<i.EPSILON&&Math.abs(ae-Fe)<i.EPSILON?u(x):($=ue-Le,W=oe-De,K=ae-Fe,C=he*(K*=Q=1/Math.hypot($,W,K))-Se*(W*=Q),R=Se*($*=Q)-Ee*K,B=Ee*W-he*$,(Q=Math.hypot(C,R,B))?(C*=Q=1/Q,R*=Q,B*=Q):(C=0,R=0,B=0),N=W*B-K*R,G=K*C-$*B,H=$*R-W*C,(Q=Math.hypot(N,G,H))?(N*=Q=1/Q,G*=Q,H*=Q):(N=0,G=0,H=0),x[0]=C,x[1]=N,x[2]=$,x[3]=0,x[4]=R,x[5]=G,x[6]=W,x[7]=0,x[8]=B,x[9]=H,x[10]=K,x[11]=0,x[12]=-(C*ue+R*oe+B*ae),x[13]=-(N*ue+G*oe+H*ae),x[14]=-($*ue+W*oe+K*ae),x[15]=1,x)},ze.targetTo=function(x,S,P,A){var C=S[0],R=S[1],B=S[2],N=A[0],G=A[1],H=A[2],$=C-P[0],W=R-P[1],K=B-P[2],Q=$*$+W*W+K*K;Q>0&&($*=Q=1/Math.sqrt(Q),W*=Q,K*=Q);var ue=G*K-H*W,oe=H*$-N*K,ae=N*W-G*$;return(Q=ue*ue+oe*oe+ae*ae)>0&&(ue*=Q=1/Math.sqrt(Q),oe*=Q,ae*=Q),x[0]=ue,x[1]=oe,x[2]=ae,x[3]=0,x[4]=W*ae-K*oe,x[5]=K*ue-$*ae,x[6]=$*oe-W*ue,x[7]=0,x[8]=$,x[9]=W,x[10]=K,x[11]=0,x[12]=C,x[13]=R,x[14]=B,x[15]=1,x},ze.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},ze.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},ze.add=function(x,S,P){return x[0]=S[0]+P[0],x[1]=S[1]+P[1],x[2]=S[2]+P[2],x[3]=S[3]+P[3],x[4]=S[4]+P[4],x[5]=S[5]+P[5],x[6]=S[6]+P[6],x[7]=S[7]+P[7],x[8]=S[8]+P[8],x[9]=S[9]+P[9],x[10]=S[10]+P[10],x[11]=S[11]+P[11],x[12]=S[12]+P[12],x[13]=S[13]+P[13],x[14]=S[14]+P[14],x[15]=S[15]+P[15],x},ze.subtract=M,ze.multiplyScalar=function(x,S,P){return x[0]=S[0]*P,x[1]=S[1]*P,x[2]=S[2]*P,x[3]=S[3]*P,x[4]=S[4]*P,x[5]=S[5]*P,x[6]=S[6]*P,x[7]=S[7]*P,x[8]=S[8]*P,x[9]=S[9]*P,x[10]=S[10]*P,x[11]=S[11]*P,x[12]=S[12]*P,x[13]=S[13]*P,x[14]=S[14]*P,x[15]=S[15]*P,x},ze.multiplyScalarAndAdd=function(x,S,P,A){return x[0]=S[0]+P[0]*A,x[1]=S[1]+P[1]*A,x[2]=S[2]+P[2]*A,x[3]=S[3]+P[3]*A,x[4]=S[4]+P[4]*A,x[5]=S[5]+P[5]*A,x[6]=S[6]+P[6]*A,x[7]=S[7]+P[7]*A,x[8]=S[8]+P[8]*A,x[9]=S[9]+P[9]*A,x[10]=S[10]+P[10]*A,x[11]=S[11]+P[11]*A,x[12]=S[12]+P[12]*A,x[13]=S[13]+P[13]*A,x[14]=S[14]+P[14]*A,x[15]=S[15]+P[15]*A,x},ze.exactEquals=function(x,S){return x[0]===S[0]&&x[1]===S[1]&&x[2]===S[2]&&x[3]===S[3]&&x[4]===S[4]&&x[5]===S[5]&&x[6]===S[6]&&x[7]===S[7]&&x[8]===S[8]&&x[9]===S[9]&&x[10]===S[10]&&x[11]===S[11]&&x[12]===S[12]&&x[13]===S[13]&&x[14]===S[14]&&x[15]===S[15]},ze.equals=function(x,S){var P=x[0],A=x[1],C=x[2],R=x[3],B=x[4],N=x[5],G=x[6],H=x[7],$=x[8],W=x[9],K=x[10],Q=x[11],ue=x[12],oe=x[13],ae=x[14],Ee=x[15],he=S[0],Se=S[1],Le=S[2],De=S[3],Fe=S[4],ke=S[5],He=S[6],Ve=S[7],qe=S[8],pt=S[9],dt=S[10],Ft=S[11],_t=S[12],Et=S[13],mt=S[14],ei=S[15];return Math.abs(P-he)<=i.EPSILON*Math.max(1,Math.abs(P),Math.abs(he))&&Math.abs(A-Se)<=i.EPSILON*Math.max(1,Math.abs(A),Math.abs(Se))&&Math.abs(C-Le)<=i.EPSILON*Math.max(1,Math.abs(C),Math.abs(Le))&&Math.abs(R-De)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(De))&&Math.abs(B-Fe)<=i.EPSILON*Math.max(1,Math.abs(B),Math.abs(Fe))&&Math.abs(N-ke)<=i.EPSILON*Math.max(1,Math.abs(N),Math.abs(ke))&&Math.abs(G-He)<=i.EPSILON*Math.max(1,Math.abs(G),Math.abs(He))&&Math.abs(H-Ve)<=i.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ve))&&Math.abs($-qe)<=i.EPSILON*Math.max(1,Math.abs($),Math.abs(qe))&&Math.abs(W-pt)<=i.EPSILON*Math.max(1,Math.abs(W),Math.abs(pt))&&Math.abs(K-dt)<=i.EPSILON*Math.max(1,Math.abs(K),Math.abs(dt))&&Math.abs(Q-Ft)<=i.EPSILON*Math.max(1,Math.abs(Q),Math.abs(Ft))&&Math.abs(ue-_t)<=i.EPSILON*Math.max(1,Math.abs(ue),Math.abs(_t))&&Math.abs(oe-Et)<=i.EPSILON*Math.max(1,Math.abs(oe),Math.abs(Et))&&Math.abs(ae-mt)<=i.EPSILON*Math.max(1,Math.abs(ae),Math.abs(mt))&&Math.abs(Ee-ei)<=i.EPSILON*Math.max(1,Math.abs(Ee),Math.abs(ei))},ze.sub=ze.mul=ze.ortho=ze.perspective=void 0;var i=function(x,S){if(x&&x.__esModule)return x;if(x===null||c(x)!=="object"&&typeof x!="function")return{default:x};var P=o(void 0);if(P&&P.has(x))return P.get(x);var A={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var B=C?Object.getOwnPropertyDescriptor(x,R):null;B&&(B.get||B.set)?Object.defineProperty(A,R,B):A[R]=x[R]}return A.default=x,P&&P.set(x,A),A}(Z());function o(x){if(typeof WeakMap!="function")return null;var S=new WeakMap,P=new WeakMap;return(o=function(A){return A?P:S})(x)}function u(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function f(x,S,P){var A=S[0],C=S[1],R=S[2],B=S[3],N=S[4],G=S[5],H=S[6],$=S[7],W=S[8],K=S[9],Q=S[10],ue=S[11],oe=S[12],ae=S[13],Ee=S[14],he=S[15],Se=P[0],Le=P[1],De=P[2],Fe=P[3];return x[0]=Se*A+Le*N+De*W+Fe*oe,x[1]=Se*C+Le*G+De*K+Fe*ae,x[2]=Se*R+Le*H+De*Q+Fe*Ee,x[3]=Se*B+Le*$+De*ue+Fe*he,x[4]=(Se=P[4])*A+(Le=P[5])*N+(De=P[6])*W+(Fe=P[7])*oe,x[5]=Se*C+Le*G+De*K+Fe*ae,x[6]=Se*R+Le*H+De*Q+Fe*Ee,x[7]=Se*B+Le*$+De*ue+Fe*he,x[8]=(Se=P[8])*A+(Le=P[9])*N+(De=P[10])*W+(Fe=P[11])*oe,x[9]=Se*C+Le*G+De*K+Fe*ae,x[10]=Se*R+Le*H+De*Q+Fe*Ee,x[11]=Se*B+Le*$+De*ue+Fe*he,x[12]=(Se=P[12])*A+(Le=P[13])*N+(De=P[14])*W+(Fe=P[15])*oe,x[13]=Se*C+Le*G+De*K+Fe*ae,x[14]=Se*R+Le*H+De*Q+Fe*Ee,x[15]=Se*B+Le*$+De*ue+Fe*he,x}function d(x,S,P){var A=S[0],C=S[1],R=S[2],B=S[3],N=A+A,G=C+C,H=R+R,$=A*N,W=A*G,K=A*H,Q=C*G,ue=C*H,oe=R*H,ae=B*N,Ee=B*G,he=B*H;return x[0]=1-(Q+oe),x[1]=W+he,x[2]=K-Ee,x[3]=0,x[4]=W-he,x[5]=1-($+oe),x[6]=ue+ae,x[7]=0,x[8]=K+Ee,x[9]=ue-ae,x[10]=1-($+Q),x[11]=0,x[12]=P[0],x[13]=P[1],x[14]=P[2],x[15]=1,x}function g(x,S){var P=S[4],A=S[5],C=S[6],R=S[8],B=S[9],N=S[10];return x[0]=Math.hypot(S[0],S[1],S[2]),x[1]=Math.hypot(P,A,C),x[2]=Math.hypot(R,B,N),x}function w(x,S,P,A,C){var R,B=1/Math.tan(S/2);return x[0]=B/P,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=B,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,C!=null&&C!==1/0?(x[10]=(C+A)*(R=1/(A-C)),x[14]=2*C*A*R):(x[10]=-1,x[14]=-2*A),x}function E(x,S,P,A,C,R,B){var N=1/(S-P),G=1/(A-C),H=1/(R-B);return x[0]=-2*N,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*G,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*H,x[11]=0,x[12]=(S+P)*N,x[13]=(C+A)*G,x[14]=(B+R)*H,x[15]=1,x}function M(x,S,P){return x[0]=S[0]-P[0],x[1]=S[1]-P[1],x[2]=S[2]-P[2],x[3]=S[3]-P[3],x[4]=S[4]-P[4],x[5]=S[5]-P[5],x[6]=S[6]-P[6],x[7]=S[7]-P[7],x[8]=S[8]-P[8],x[9]=S[9]-P[9],x[10]=S[10]-P[10],x[11]=S[11]-P[11],x[12]=S[12]-P[12],x[13]=S[13]-P[13],x[14]=S[14]-P[14],x[15]=S[15]-P[15],x}return ze.perspective=w,ze.ortho=E,ze.mul=f,ze.sub=M,ze}var Xe,Ue={},et={};function lt(){if(Xe)return et;function c(C){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},c(C)}Xe=1,Object.defineProperty(et,"__esModule",{value:!0}),et.create=u,et.clone=function(C){var R=new i.ARRAY_TYPE(3);return R[0]=C[0],R[1]=C[1],R[2]=C[2],R},et.length=f,et.fromValues=function(C,R,B){var N=new i.ARRAY_TYPE(3);return N[0]=C,N[1]=R,N[2]=B,N},et.copy=function(C,R){return C[0]=R[0],C[1]=R[1],C[2]=R[2],C},et.set=function(C,R,B,N){return C[0]=R,C[1]=B,C[2]=N,C},et.add=function(C,R,B){return C[0]=R[0]+B[0],C[1]=R[1]+B[1],C[2]=R[2]+B[2],C},et.subtract=d,et.multiply=g,et.divide=w,et.ceil=function(C,R){return C[0]=Math.ceil(R[0]),C[1]=Math.ceil(R[1]),C[2]=Math.ceil(R[2]),C},et.floor=function(C,R){return C[0]=Math.floor(R[0]),C[1]=Math.floor(R[1]),C[2]=Math.floor(R[2]),C},et.min=function(C,R,B){return C[0]=Math.min(R[0],B[0]),C[1]=Math.min(R[1],B[1]),C[2]=Math.min(R[2],B[2]),C},et.max=function(C,R,B){return C[0]=Math.max(R[0],B[0]),C[1]=Math.max(R[1],B[1]),C[2]=Math.max(R[2],B[2]),C},et.round=function(C,R){return C[0]=Math.round(R[0]),C[1]=Math.round(R[1]),C[2]=Math.round(R[2]),C},et.scale=function(C,R,B){return C[0]=R[0]*B,C[1]=R[1]*B,C[2]=R[2]*B,C},et.scaleAndAdd=function(C,R,B,N){return C[0]=R[0]+B[0]*N,C[1]=R[1]+B[1]*N,C[2]=R[2]+B[2]*N,C},et.distance=E,et.squaredDistance=M,et.squaredLength=x,et.negate=function(C,R){return C[0]=-R[0],C[1]=-R[1],C[2]=-R[2],C},et.inverse=function(C,R){return C[0]=1/R[0],C[1]=1/R[1],C[2]=1/R[2],C},et.normalize=function(C,R){var B=R[0],N=R[1],G=R[2],H=B*B+N*N+G*G;return H>0&&(H=1/Math.sqrt(H)),C[0]=R[0]*H,C[1]=R[1]*H,C[2]=R[2]*H,C},et.dot=S,et.cross=function(C,R,B){var N=R[0],G=R[1],H=R[2],$=B[0],W=B[1],K=B[2];return C[0]=G*K-H*W,C[1]=H*$-N*K,C[2]=N*W-G*$,C},et.lerp=function(C,R,B,N){var G=R[0],H=R[1],$=R[2];return C[0]=G+N*(B[0]-G),C[1]=H+N*(B[1]-H),C[2]=$+N*(B[2]-$),C},et.hermite=function(C,R,B,N,G,H){var $=H*H,W=$*(2*H-3)+1,K=$*(H-2)+H,Q=$*(H-1),ue=$*(3-2*H);return C[0]=R[0]*W+B[0]*K+N[0]*Q+G[0]*ue,C[1]=R[1]*W+B[1]*K+N[1]*Q+G[1]*ue,C[2]=R[2]*W+B[2]*K+N[2]*Q+G[2]*ue,C},et.bezier=function(C,R,B,N,G,H){var $=1-H,W=$*$,K=H*H,Q=W*$,ue=3*H*W,oe=3*K*$,ae=K*H;return C[0]=R[0]*Q+B[0]*ue+N[0]*oe+G[0]*ae,C[1]=R[1]*Q+B[1]*ue+N[1]*oe+G[1]*ae,C[2]=R[2]*Q+B[2]*ue+N[2]*oe+G[2]*ae,C},et.random=function(C,R){R=R||1;var B=2*i.RANDOM()*Math.PI,N=2*i.RANDOM()-1,G=Math.sqrt(1-N*N)*R;return C[0]=Math.cos(B)*G,C[1]=Math.sin(B)*G,C[2]=N*R,C},et.transformMat4=function(C,R,B){var N=R[0],G=R[1],H=R[2],$=B[3]*N+B[7]*G+B[11]*H+B[15];return C[0]=(B[0]*N+B[4]*G+B[8]*H+B[12])/($=$||1),C[1]=(B[1]*N+B[5]*G+B[9]*H+B[13])/$,C[2]=(B[2]*N+B[6]*G+B[10]*H+B[14])/$,C},et.transformMat3=function(C,R,B){var N=R[0],G=R[1],H=R[2];return C[0]=N*B[0]+G*B[3]+H*B[6],C[1]=N*B[1]+G*B[4]+H*B[7],C[2]=N*B[2]+G*B[5]+H*B[8],C},et.transformQuat=function(C,R,B){var N=B[0],G=B[1],H=B[2],$=R[0],W=R[1],K=R[2],Q=G*K-H*W,ue=H*$-N*K,oe=N*W-G*$,ae=G*oe-H*ue,Ee=H*Q-N*oe,he=N*ue-G*Q,Se=2*B[3];return ue*=Se,oe*=Se,Ee*=2,he*=2,C[0]=$+(Q*=Se)+(ae*=2),C[1]=W+ue+Ee,C[2]=K+oe+he,C},et.rotateX=function(C,R,B,N){var G=[],H=[];return G[0]=R[0]-B[0],G[1]=R[1]-B[1],G[2]=R[2]-B[2],H[0]=G[0],H[1]=G[1]*Math.cos(N)-G[2]*Math.sin(N),H[2]=G[1]*Math.sin(N)+G[2]*Math.cos(N),C[0]=H[0]+B[0],C[1]=H[1]+B[1],C[2]=H[2]+B[2],C},et.rotateY=function(C,R,B,N){var G=[],H=[];return G[0]=R[0]-B[0],G[1]=R[1]-B[1],G[2]=R[2]-B[2],H[0]=G[2]*Math.sin(N)+G[0]*Math.cos(N),H[1]=G[1],H[2]=G[2]*Math.cos(N)-G[0]*Math.sin(N),C[0]=H[0]+B[0],C[1]=H[1]+B[1],C[2]=H[2]+B[2],C},et.rotateZ=function(C,R,B,N){var G=[],H=[];return G[0]=R[0]-B[0],G[1]=R[1]-B[1],G[2]=R[2]-B[2],H[0]=G[0]*Math.cos(N)-G[1]*Math.sin(N),H[1]=G[0]*Math.sin(N)+G[1]*Math.cos(N),H[2]=G[2],C[0]=H[0]+B[0],C[1]=H[1]+B[1],C[2]=H[2]+B[2],C},et.angle=function(C,R){var B=C[0],N=C[1],G=C[2],H=R[0],$=R[1],W=R[2],K=Math.sqrt(B*B+N*N+G*G)*Math.sqrt(H*H+$*$+W*W),Q=K&&S(C,R)/K;return Math.acos(Math.min(Math.max(Q,-1),1))},et.zero=function(C){return C[0]=0,C[1]=0,C[2]=0,C},et.str=function(C){return"vec3("+C[0]+", "+C[1]+", "+C[2]+")"},et.exactEquals=function(C,R){return C[0]===R[0]&&C[1]===R[1]&&C[2]===R[2]},et.equals=function(C,R){var B=C[0],N=C[1],G=C[2],H=R[0],$=R[1],W=R[2];return Math.abs(B-H)<=i.EPSILON*Math.max(1,Math.abs(B),Math.abs(H))&&Math.abs(N-$)<=i.EPSILON*Math.max(1,Math.abs(N),Math.abs($))&&Math.abs(G-W)<=i.EPSILON*Math.max(1,Math.abs(G),Math.abs(W))},et.forEach=et.sqrLen=et.len=et.sqrDist=et.dist=et.div=et.mul=et.sub=void 0;var i=function(C,R){if(C&&C.__esModule)return C;if(C===null||c(C)!=="object"&&typeof C!="function")return{default:C};var B=o(void 0);if(B&&B.has(C))return B.get(C);var N={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in C)if(H!=="default"&&Object.prototype.hasOwnProperty.call(C,H)){var $=G?Object.getOwnPropertyDescriptor(C,H):null;$&&($.get||$.set)?Object.defineProperty(N,H,$):N[H]=C[H]}return N.default=C,B&&B.set(C,N),N}(Z());function o(C){if(typeof WeakMap!="function")return null;var R=new WeakMap,B=new WeakMap;return(o=function(N){return N?B:R})(C)}function u(){var C=new i.ARRAY_TYPE(3);return i.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0),C}function f(C){return Math.hypot(C[0],C[1],C[2])}function d(C,R,B){return C[0]=R[0]-B[0],C[1]=R[1]-B[1],C[2]=R[2]-B[2],C}function g(C,R,B){return C[0]=R[0]*B[0],C[1]=R[1]*B[1],C[2]=R[2]*B[2],C}function w(C,R,B){return C[0]=R[0]/B[0],C[1]=R[1]/B[1],C[2]=R[2]/B[2],C}function E(C,R){return Math.hypot(R[0]-C[0],R[1]-C[1],R[2]-C[2])}function M(C,R){var B=R[0]-C[0],N=R[1]-C[1],G=R[2]-C[2];return B*B+N*N+G*G}function x(C){var R=C[0],B=C[1],N=C[2];return R*R+B*B+N*N}function S(C,R){return C[0]*R[0]+C[1]*R[1]+C[2]*R[2]}et.sub=d,et.mul=g,et.div=w,et.dist=E,et.sqrDist=M,et.len=f,et.sqrLen=x;var P,A=(P=u(),function(C,R,B,N,G,H){var $,W;for(R||(R=3),B||(B=0),W=N?Math.min(N*R+B,C.length):C.length,$=B;$<W;$+=R)P[0]=C[$],P[1]=C[$+1],P[2]=C[$+2],G(P,P,H),C[$]=P[0],C[$+1]=P[1],C[$+2]=P[2];return C});return et.forEach=A,et}var Mt,si,bt={};function Rt(){if(Mt)return bt;function c(A){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(A)}Mt=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.create=u,bt.clone=function(A){var C=new i.ARRAY_TYPE(4);return C[0]=A[0],C[1]=A[1],C[2]=A[2],C[3]=A[3],C},bt.fromValues=function(A,C,R,B){var N=new i.ARRAY_TYPE(4);return N[0]=A,N[1]=C,N[2]=R,N[3]=B,N},bt.copy=function(A,C){return A[0]=C[0],A[1]=C[1],A[2]=C[2],A[3]=C[3],A},bt.set=function(A,C,R,B,N){return A[0]=C,A[1]=R,A[2]=B,A[3]=N,A},bt.add=function(A,C,R){return A[0]=C[0]+R[0],A[1]=C[1]+R[1],A[2]=C[2]+R[2],A[3]=C[3]+R[3],A},bt.subtract=f,bt.multiply=d,bt.divide=g,bt.ceil=function(A,C){return A[0]=Math.ceil(C[0]),A[1]=Math.ceil(C[1]),A[2]=Math.ceil(C[2]),A[3]=Math.ceil(C[3]),A},bt.floor=function(A,C){return A[0]=Math.floor(C[0]),A[1]=Math.floor(C[1]),A[2]=Math.floor(C[2]),A[3]=Math.floor(C[3]),A},bt.min=function(A,C,R){return A[0]=Math.min(C[0],R[0]),A[1]=Math.min(C[1],R[1]),A[2]=Math.min(C[2],R[2]),A[3]=Math.min(C[3],R[3]),A},bt.max=function(A,C,R){return A[0]=Math.max(C[0],R[0]),A[1]=Math.max(C[1],R[1]),A[2]=Math.max(C[2],R[2]),A[3]=Math.max(C[3],R[3]),A},bt.round=function(A,C){return A[0]=Math.round(C[0]),A[1]=Math.round(C[1]),A[2]=Math.round(C[2]),A[3]=Math.round(C[3]),A},bt.scale=function(A,C,R){return A[0]=C[0]*R,A[1]=C[1]*R,A[2]=C[2]*R,A[3]=C[3]*R,A},bt.scaleAndAdd=function(A,C,R,B){return A[0]=C[0]+R[0]*B,A[1]=C[1]+R[1]*B,A[2]=C[2]+R[2]*B,A[3]=C[3]+R[3]*B,A},bt.distance=w,bt.squaredDistance=E,bt.length=M,bt.squaredLength=x,bt.negate=function(A,C){return A[0]=-C[0],A[1]=-C[1],A[2]=-C[2],A[3]=-C[3],A},bt.inverse=function(A,C){return A[0]=1/C[0],A[1]=1/C[1],A[2]=1/C[2],A[3]=1/C[3],A},bt.normalize=function(A,C){var R=C[0],B=C[1],N=C[2],G=C[3],H=R*R+B*B+N*N+G*G;return H>0&&(H=1/Math.sqrt(H)),A[0]=R*H,A[1]=B*H,A[2]=N*H,A[3]=G*H,A},bt.dot=function(A,C){return A[0]*C[0]+A[1]*C[1]+A[2]*C[2]+A[3]*C[3]},bt.cross=function(A,C,R,B){var N=R[0]*B[1]-R[1]*B[0],G=R[0]*B[2]-R[2]*B[0],H=R[0]*B[3]-R[3]*B[0],$=R[1]*B[2]-R[2]*B[1],W=R[1]*B[3]-R[3]*B[1],K=R[2]*B[3]-R[3]*B[2],Q=C[0],ue=C[1],oe=C[2],ae=C[3];return A[0]=ue*K-oe*W+ae*$,A[1]=-Q*K+oe*H-ae*G,A[2]=Q*W-ue*H+ae*N,A[3]=-Q*$+ue*G-oe*N,A},bt.lerp=function(A,C,R,B){var N=C[0],G=C[1],H=C[2],$=C[3];return A[0]=N+B*(R[0]-N),A[1]=G+B*(R[1]-G),A[2]=H+B*(R[2]-H),A[3]=$+B*(R[3]-$),A},bt.random=function(A,C){var R,B,N,G,H,$;C=C||1;do H=(R=2*i.RANDOM()-1)*R+(B=2*i.RANDOM()-1)*B;while(H>=1);do $=(N=2*i.RANDOM()-1)*N+(G=2*i.RANDOM()-1)*G;while($>=1);var W=Math.sqrt((1-H)/$);return A[0]=C*R,A[1]=C*B,A[2]=C*N*W,A[3]=C*G*W,A},bt.transformMat4=function(A,C,R){var B=C[0],N=C[1],G=C[2],H=C[3];return A[0]=R[0]*B+R[4]*N+R[8]*G+R[12]*H,A[1]=R[1]*B+R[5]*N+R[9]*G+R[13]*H,A[2]=R[2]*B+R[6]*N+R[10]*G+R[14]*H,A[3]=R[3]*B+R[7]*N+R[11]*G+R[15]*H,A},bt.transformQuat=function(A,C,R){var B=C[0],N=C[1],G=C[2],H=R[0],$=R[1],W=R[2],K=R[3],Q=K*B+$*G-W*N,ue=K*N+W*B-H*G,oe=K*G+H*N-$*B,ae=-H*B-$*N-W*G;return A[0]=Q*K+ae*-H+ue*-W-oe*-$,A[1]=ue*K+ae*-$+oe*-H-Q*-W,A[2]=oe*K+ae*-W+Q*-$-ue*-H,A[3]=C[3],A},bt.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=0,A},bt.str=function(A){return"vec4("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+")"},bt.exactEquals=function(A,C){return A[0]===C[0]&&A[1]===C[1]&&A[2]===C[2]&&A[3]===C[3]},bt.equals=function(A,C){var R=A[0],B=A[1],N=A[2],G=A[3],H=C[0],$=C[1],W=C[2],K=C[3];return Math.abs(R-H)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(H))&&Math.abs(B-$)<=i.EPSILON*Math.max(1,Math.abs(B),Math.abs($))&&Math.abs(N-W)<=i.EPSILON*Math.max(1,Math.abs(N),Math.abs(W))&&Math.abs(G-K)<=i.EPSILON*Math.max(1,Math.abs(G),Math.abs(K))},bt.forEach=bt.sqrLen=bt.len=bt.sqrDist=bt.dist=bt.div=bt.mul=bt.sub=void 0;var i=function(A,C){if(A&&A.__esModule)return A;if(A===null||c(A)!=="object"&&typeof A!="function")return{default:A};var R=o(void 0);if(R&&R.has(A))return R.get(A);var B={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if(G!=="default"&&Object.prototype.hasOwnProperty.call(A,G)){var H=N?Object.getOwnPropertyDescriptor(A,G):null;H&&(H.get||H.set)?Object.defineProperty(B,G,H):B[G]=A[G]}return B.default=A,R&&R.set(A,B),B}(Z());function o(A){if(typeof WeakMap!="function")return null;var C=new WeakMap,R=new WeakMap;return(o=function(B){return B?R:C})(A)}function u(){var A=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0),A}function f(A,C,R){return A[0]=C[0]-R[0],A[1]=C[1]-R[1],A[2]=C[2]-R[2],A[3]=C[3]-R[3],A}function d(A,C,R){return A[0]=C[0]*R[0],A[1]=C[1]*R[1],A[2]=C[2]*R[2],A[3]=C[3]*R[3],A}function g(A,C,R){return A[0]=C[0]/R[0],A[1]=C[1]/R[1],A[2]=C[2]/R[2],A[3]=C[3]/R[3],A}function w(A,C){return Math.hypot(C[0]-A[0],C[1]-A[1],C[2]-A[2],C[3]-A[3])}function E(A,C){var R=C[0]-A[0],B=C[1]-A[1],N=C[2]-A[2],G=C[3]-A[3];return R*R+B*B+N*N+G*G}function M(A){return Math.hypot(A[0],A[1],A[2],A[3])}function x(A){var C=A[0],R=A[1],B=A[2],N=A[3];return C*C+R*R+B*B+N*N}bt.sub=f,bt.mul=d,bt.div=g,bt.dist=w,bt.sqrDist=E,bt.len=M,bt.sqrLen=x;var S,P=(S=u(),function(A,C,R,B,N,G){var H,$;for(C||(C=4),R||(R=0),$=B?Math.min(B*C+R,A.length):A.length,H=R;H<$;H+=C)S[0]=A[H],S[1]=A[H+1],S[2]=A[H+2],S[3]=A[H+3],N(S,S,G),A[H]=S[0],A[H+1]=S[1],A[H+2]=S[2],A[H+3]=S[3];return A});return bt.forEach=P,bt}function Kt(){if(si)return Ue;function c(he){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Se){return typeof Se}:function(Se){return Se&&typeof Symbol=="function"&&Se.constructor===Symbol&&Se!==Symbol.prototype?"symbol":typeof Se},c(he)}si=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.create=w,Ue.identity=function(he){return he[0]=0,he[1]=0,he[2]=0,he[3]=1,he},Ue.setAxisAngle=E,Ue.getAxisAngle=function(he,Se){var Le=2*Math.acos(Se[3]),De=Math.sin(Le/2);return De>i.EPSILON?(he[0]=Se[0]/De,he[1]=Se[1]/De,he[2]=Se[2]/De):(he[0]=1,he[1]=0,he[2]=0),Le},Ue.getAngle=function(he,Se){var Le=R(he,Se);return Math.acos(2*Le*Le-1)},Ue.multiply=M,Ue.rotateX=function(he,Se,Le){Le*=.5;var De=Se[0],Fe=Se[1],ke=Se[2],He=Se[3],Ve=Math.sin(Le),qe=Math.cos(Le);return he[0]=De*qe+He*Ve,he[1]=Fe*qe+ke*Ve,he[2]=ke*qe-Fe*Ve,he[3]=He*qe-De*Ve,he},Ue.rotateY=function(he,Se,Le){Le*=.5;var De=Se[0],Fe=Se[1],ke=Se[2],He=Se[3],Ve=Math.sin(Le),qe=Math.cos(Le);return he[0]=De*qe-ke*Ve,he[1]=Fe*qe+He*Ve,he[2]=ke*qe+De*Ve,he[3]=He*qe-Fe*Ve,he},Ue.rotateZ=function(he,Se,Le){Le*=.5;var De=Se[0],Fe=Se[1],ke=Se[2],He=Se[3],Ve=Math.sin(Le),qe=Math.cos(Le);return he[0]=De*qe+Fe*Ve,he[1]=Fe*qe-De*Ve,he[2]=ke*qe+He*Ve,he[3]=He*qe-ke*Ve,he},Ue.calculateW=function(he,Se){var Le=Se[0],De=Se[1],Fe=Se[2];return he[0]=Le,he[1]=De,he[2]=Fe,he[3]=Math.sqrt(Math.abs(1-Le*Le-De*De-Fe*Fe)),he},Ue.exp=x,Ue.ln=S,Ue.pow=function(he,Se,Le){return S(he,Se),C(he,he,Le),x(he,he),he},Ue.slerp=P,Ue.random=function(he){var Se=i.RANDOM(),Le=i.RANDOM(),De=i.RANDOM(),Fe=Math.sqrt(1-Se),ke=Math.sqrt(Se);return he[0]=Fe*Math.sin(2*Math.PI*Le),he[1]=Fe*Math.cos(2*Math.PI*Le),he[2]=ke*Math.sin(2*Math.PI*De),he[3]=ke*Math.cos(2*Math.PI*De),he},Ue.invert=function(he,Se){var Le=Se[0],De=Se[1],Fe=Se[2],ke=Se[3],He=Le*Le+De*De+Fe*Fe+ke*ke,Ve=He?1/He:0;return he[0]=-Le*Ve,he[1]=-De*Ve,he[2]=-Fe*Ve,he[3]=ke*Ve,he},Ue.conjugate=function(he,Se){return he[0]=-Se[0],he[1]=-Se[1],he[2]=-Se[2],he[3]=Se[3],he},Ue.fromMat3=A,Ue.fromEuler=function(he,Se,Le,De){var Fe=.5*Math.PI/180;Se*=Fe,Le*=Fe,De*=Fe;var ke=Math.sin(Se),He=Math.cos(Se),Ve=Math.sin(Le),qe=Math.cos(Le),pt=Math.sin(De),dt=Math.cos(De);return he[0]=ke*qe*dt-He*Ve*pt,he[1]=He*Ve*dt+ke*qe*pt,he[2]=He*qe*pt-ke*Ve*dt,he[3]=He*qe*dt+ke*Ve*pt,he},Ue.str=function(he){return"quat("+he[0]+", "+he[1]+", "+he[2]+", "+he[3]+")"},Ue.setAxes=Ue.sqlerp=Ue.rotationTo=Ue.equals=Ue.exactEquals=Ue.normalize=Ue.sqrLen=Ue.squaredLength=Ue.len=Ue.length=Ue.lerp=Ue.dot=Ue.scale=Ue.mul=Ue.add=Ue.set=Ue.copy=Ue.fromValues=Ue.clone=void 0;var i=g(Z()),o=g(Ae()),u=g(lt()),f=g(Rt());function d(he){if(typeof WeakMap!="function")return null;var Se=new WeakMap,Le=new WeakMap;return(d=function(De){return De?Le:Se})(he)}function g(he,Se){if(he&&he.__esModule)return he;if(he===null||c(he)!=="object"&&typeof he!="function")return{default:he};var Le=d(Se);if(Le&&Le.has(he))return Le.get(he);var De={},Fe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ke in he)if(ke!=="default"&&Object.prototype.hasOwnProperty.call(he,ke)){var He=Fe?Object.getOwnPropertyDescriptor(he,ke):null;He&&(He.get||He.set)?Object.defineProperty(De,ke,He):De[ke]=he[ke]}return De.default=he,Le&&Le.set(he,De),De}function w(){var he=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(he[0]=0,he[1]=0,he[2]=0),he[3]=1,he}function E(he,Se,Le){Le*=.5;var De=Math.sin(Le);return he[0]=De*Se[0],he[1]=De*Se[1],he[2]=De*Se[2],he[3]=Math.cos(Le),he}function M(he,Se,Le){var De=Se[0],Fe=Se[1],ke=Se[2],He=Se[3],Ve=Le[0],qe=Le[1],pt=Le[2],dt=Le[3];return he[0]=De*dt+He*Ve+Fe*pt-ke*qe,he[1]=Fe*dt+He*qe+ke*Ve-De*pt,he[2]=ke*dt+He*pt+De*qe-Fe*Ve,he[3]=He*dt-De*Ve-Fe*qe-ke*pt,he}function x(he,Se){var Le=Se[0],De=Se[1],Fe=Se[2],ke=Se[3],He=Math.sqrt(Le*Le+De*De+Fe*Fe),Ve=Math.exp(ke),qe=He>0?Ve*Math.sin(He)/He:0;return he[0]=Le*qe,he[1]=De*qe,he[2]=Fe*qe,he[3]=Ve*Math.cos(He),he}function S(he,Se){var Le=Se[0],De=Se[1],Fe=Se[2],ke=Se[3],He=Math.sqrt(Le*Le+De*De+Fe*Fe),Ve=He>0?Math.atan2(He,ke)/He:0;return he[0]=Le*Ve,he[1]=De*Ve,he[2]=Fe*Ve,he[3]=.5*Math.log(Le*Le+De*De+Fe*Fe+ke*ke),he}function P(he,Se,Le,De){var Fe,ke,He,Ve,qe,pt=Se[0],dt=Se[1],Ft=Se[2],_t=Se[3],Et=Le[0],mt=Le[1],ei=Le[2],Lt=Le[3];return(ke=pt*Et+dt*mt+Ft*ei+_t*Lt)<0&&(ke=-ke,Et=-Et,mt=-mt,ei=-ei,Lt=-Lt),1-ke>i.EPSILON?(Fe=Math.acos(ke),He=Math.sin(Fe),Ve=Math.sin((1-De)*Fe)/He,qe=Math.sin(De*Fe)/He):(Ve=1-De,qe=De),he[0]=Ve*pt+qe*Et,he[1]=Ve*dt+qe*mt,he[2]=Ve*Ft+qe*ei,he[3]=Ve*_t+qe*Lt,he}function A(he,Se){var Le,De=Se[0]+Se[4]+Se[8];if(De>0)Le=Math.sqrt(De+1),he[3]=.5*Le,he[0]=(Se[5]-Se[7])*(Le=.5/Le),he[1]=(Se[6]-Se[2])*Le,he[2]=(Se[1]-Se[3])*Le;else{var Fe=0;Se[4]>Se[0]&&(Fe=1),Se[8]>Se[3*Fe+Fe]&&(Fe=2);var ke=(Fe+1)%3,He=(Fe+2)%3;Le=Math.sqrt(Se[3*Fe+Fe]-Se[3*ke+ke]-Se[3*He+He]+1),he[Fe]=.5*Le,he[3]=(Se[3*ke+He]-Se[3*He+ke])*(Le=.5/Le),he[ke]=(Se[3*ke+Fe]+Se[3*Fe+ke])*Le,he[He]=(Se[3*He+Fe]+Se[3*Fe+He])*Le}return he}Ue.clone=f.clone,Ue.fromValues=f.fromValues,Ue.copy=f.copy,Ue.set=f.set,Ue.add=f.add,Ue.mul=M;var C=f.scale;Ue.scale=C;var R=f.dot;Ue.dot=R,Ue.lerp=f.lerp;var B=f.length;Ue.length=B,Ue.len=B;var N=f.squaredLength;Ue.squaredLength=N,Ue.sqrLen=N;var G=f.normalize;Ue.normalize=G,Ue.exactEquals=f.exactEquals,Ue.equals=f.equals;var H,$,W,K=(H=u.create(),$=u.fromValues(1,0,0),W=u.fromValues(0,1,0),function(he,Se,Le){var De=u.dot(Se,Le);return De<-.999999?(u.cross(H,$,Se),u.len(H)<1e-6&&u.cross(H,W,Se),u.normalize(H,H),E(he,H,Math.PI),he):De>.999999?(he[0]=0,he[1]=0,he[2]=0,he[3]=1,he):(u.cross(H,Se,Le),he[0]=H[0],he[1]=H[1],he[2]=H[2],he[3]=1+De,G(he,he))});Ue.rotationTo=K;var Q,ue,oe=(Q=w(),ue=w(),function(he,Se,Le,De,Fe,ke){return P(Q,Se,Fe,ke),P(ue,Le,De,ke),P(he,Q,ue,2*ke*(1-ke)),he});Ue.sqlerp=oe;var ae,Ee=(ae=o.create(),function(he,Se,Le,De){return ae[0]=Le[0],ae[3]=Le[1],ae[6]=Le[2],ae[1]=De[0],ae[4]=De[1],ae[7]=De[2],ae[2]=-Se[0],ae[5]=-Se[1],ae[8]=-Se[2],G(he,A(he,ae))});return Ue.setAxes=Ee,Ue}var ii,qt={};function gn(){if(ii)return qt;function c(P){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},c(P)}ii=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.create=function(){var P=new i.ARRAY_TYPE(8);return i.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0,P[4]=0,P[5]=0,P[6]=0,P[7]=0),P[3]=1,P},qt.clone=function(P){var A=new i.ARRAY_TYPE(8);return A[0]=P[0],A[1]=P[1],A[2]=P[2],A[3]=P[3],A[4]=P[4],A[5]=P[5],A[6]=P[6],A[7]=P[7],A},qt.fromValues=function(P,A,C,R,B,N,G,H){var $=new i.ARRAY_TYPE(8);return $[0]=P,$[1]=A,$[2]=C,$[3]=R,$[4]=B,$[5]=N,$[6]=G,$[7]=H,$},qt.fromRotationTranslationValues=function(P,A,C,R,B,N,G){var H=new i.ARRAY_TYPE(8);H[0]=P,H[1]=A,H[2]=C,H[3]=R;var $=.5*B,W=.5*N,K=.5*G;return H[4]=$*R+W*C-K*A,H[5]=W*R+K*P-$*C,H[6]=K*R+$*A-W*P,H[7]=-$*P-W*A-K*C,H},qt.fromRotationTranslation=g,qt.fromTranslation=function(P,A){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=.5*A[0],P[5]=.5*A[1],P[6]=.5*A[2],P[7]=0,P},qt.fromRotation=function(P,A){return P[0]=A[0],P[1]=A[1],P[2]=A[2],P[3]=A[3],P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},qt.fromMat4=function(P,A){var C=o.create();u.getRotation(C,A);var R=new i.ARRAY_TYPE(3);return u.getTranslation(R,A),g(P,C,R),P},qt.copy=w,qt.identity=function(P){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},qt.set=function(P,A,C,R,B,N,G,H,$){return P[0]=A,P[1]=C,P[2]=R,P[3]=B,P[4]=N,P[5]=G,P[6]=H,P[7]=$,P},qt.getDual=function(P,A){return P[0]=A[4],P[1]=A[5],P[2]=A[6],P[3]=A[7],P},qt.setDual=function(P,A){return P[4]=A[0],P[5]=A[1],P[6]=A[2],P[7]=A[3],P},qt.getTranslation=function(P,A){var C=A[4],R=A[5],B=A[6],N=A[7],G=-A[0],H=-A[1],$=-A[2],W=A[3];return P[0]=2*(C*W+N*G+R*$-B*H),P[1]=2*(R*W+N*H+B*G-C*$),P[2]=2*(B*W+N*$+C*H-R*G),P},qt.translate=function(P,A,C){var R=A[0],B=A[1],N=A[2],G=A[3],H=.5*C[0],$=.5*C[1],W=.5*C[2],K=A[4],Q=A[5],ue=A[6],oe=A[7];return P[0]=R,P[1]=B,P[2]=N,P[3]=G,P[4]=G*H+B*W-N*$+K,P[5]=G*$+N*H-R*W+Q,P[6]=G*W+R*$-B*H+ue,P[7]=-R*H-B*$-N*W+oe,P},qt.rotateX=function(P,A,C){var R=-A[0],B=-A[1],N=-A[2],G=A[3],H=A[4],$=A[5],W=A[6],K=A[7],Q=H*G+K*R+$*N-W*B,ue=$*G+K*B+W*R-H*N,oe=W*G+K*N+H*B-$*R,ae=K*G-H*R-$*B-W*N;return o.rotateX(P,A,C),P[4]=Q*(G=P[3])+ae*(R=P[0])+ue*(N=P[2])-oe*(B=P[1]),P[5]=ue*G+ae*B+oe*R-Q*N,P[6]=oe*G+ae*N+Q*B-ue*R,P[7]=ae*G-Q*R-ue*B-oe*N,P},qt.rotateY=function(P,A,C){var R=-A[0],B=-A[1],N=-A[2],G=A[3],H=A[4],$=A[5],W=A[6],K=A[7],Q=H*G+K*R+$*N-W*B,ue=$*G+K*B+W*R-H*N,oe=W*G+K*N+H*B-$*R,ae=K*G-H*R-$*B-W*N;return o.rotateY(P,A,C),P[4]=Q*(G=P[3])+ae*(R=P[0])+ue*(N=P[2])-oe*(B=P[1]),P[5]=ue*G+ae*B+oe*R-Q*N,P[6]=oe*G+ae*N+Q*B-ue*R,P[7]=ae*G-Q*R-ue*B-oe*N,P},qt.rotateZ=function(P,A,C){var R=-A[0],B=-A[1],N=-A[2],G=A[3],H=A[4],$=A[5],W=A[6],K=A[7],Q=H*G+K*R+$*N-W*B,ue=$*G+K*B+W*R-H*N,oe=W*G+K*N+H*B-$*R,ae=K*G-H*R-$*B-W*N;return o.rotateZ(P,A,C),P[4]=Q*(G=P[3])+ae*(R=P[0])+ue*(N=P[2])-oe*(B=P[1]),P[5]=ue*G+ae*B+oe*R-Q*N,P[6]=oe*G+ae*N+Q*B-ue*R,P[7]=ae*G-Q*R-ue*B-oe*N,P},qt.rotateByQuatAppend=function(P,A,C){var R=C[0],B=C[1],N=C[2],G=C[3],H=A[0],$=A[1],W=A[2],K=A[3];return P[0]=H*G+K*R+$*N-W*B,P[1]=$*G+K*B+W*R-H*N,P[2]=W*G+K*N+H*B-$*R,P[3]=K*G-H*R-$*B-W*N,P[4]=(H=A[4])*G+(K=A[7])*R+($=A[5])*N-(W=A[6])*B,P[5]=$*G+K*B+W*R-H*N,P[6]=W*G+K*N+H*B-$*R,P[7]=K*G-H*R-$*B-W*N,P},qt.rotateByQuatPrepend=function(P,A,C){var R=A[0],B=A[1],N=A[2],G=A[3],H=C[0],$=C[1],W=C[2],K=C[3];return P[0]=R*K+G*H+B*W-N*$,P[1]=B*K+G*$+N*H-R*W,P[2]=N*K+G*W+R*$-B*H,P[3]=G*K-R*H-B*$-N*W,P[4]=R*(K=C[7])+G*(H=C[4])+B*(W=C[6])-N*($=C[5]),P[5]=B*K+G*$+N*H-R*W,P[6]=N*K+G*W+R*$-B*H,P[7]=G*K-R*H-B*$-N*W,P},qt.rotateAroundAxis=function(P,A,C,R){if(Math.abs(R)<i.EPSILON)return w(P,A);var B=Math.hypot(C[0],C[1],C[2]);R*=.5;var N=Math.sin(R),G=N*C[0]/B,H=N*C[1]/B,$=N*C[2]/B,W=Math.cos(R),K=A[0],Q=A[1],ue=A[2],oe=A[3];P[0]=K*W+oe*G+Q*$-ue*H,P[1]=Q*W+oe*H+ue*G-K*$,P[2]=ue*W+oe*$+K*H-Q*G,P[3]=oe*W-K*G-Q*H-ue*$;var ae=A[4],Ee=A[5],he=A[6],Se=A[7];return P[4]=ae*W+Se*G+Ee*$-he*H,P[5]=Ee*W+Se*H+he*G-ae*$,P[6]=he*W+Se*$+ae*H-Ee*G,P[7]=Se*W-ae*G-Ee*H-he*$,P},qt.add=function(P,A,C){return P[0]=A[0]+C[0],P[1]=A[1]+C[1],P[2]=A[2]+C[2],P[3]=A[3]+C[3],P[4]=A[4]+C[4],P[5]=A[5]+C[5],P[6]=A[6]+C[6],P[7]=A[7]+C[7],P},qt.multiply=E,qt.scale=function(P,A,C){return P[0]=A[0]*C,P[1]=A[1]*C,P[2]=A[2]*C,P[3]=A[3]*C,P[4]=A[4]*C,P[5]=A[5]*C,P[6]=A[6]*C,P[7]=A[7]*C,P},qt.lerp=function(P,A,C,R){var B=1-R;return M(A,C)<0&&(R=-R),P[0]=A[0]*B+C[0]*R,P[1]=A[1]*B+C[1]*R,P[2]=A[2]*B+C[2]*R,P[3]=A[3]*B+C[3]*R,P[4]=A[4]*B+C[4]*R,P[5]=A[5]*B+C[5]*R,P[6]=A[6]*B+C[6]*R,P[7]=A[7]*B+C[7]*R,P},qt.invert=function(P,A){var C=S(A);return P[0]=-A[0]/C,P[1]=-A[1]/C,P[2]=-A[2]/C,P[3]=A[3]/C,P[4]=-A[4]/C,P[5]=-A[5]/C,P[6]=-A[6]/C,P[7]=A[7]/C,P},qt.conjugate=function(P,A){return P[0]=-A[0],P[1]=-A[1],P[2]=-A[2],P[3]=A[3],P[4]=-A[4],P[5]=-A[5],P[6]=-A[6],P[7]=A[7],P},qt.normalize=function(P,A){var C=S(A);if(C>0){C=Math.sqrt(C);var R=A[0]/C,B=A[1]/C,N=A[2]/C,G=A[3]/C,H=A[4],$=A[5],W=A[6],K=A[7],Q=R*H+B*$+N*W+G*K;P[0]=R,P[1]=B,P[2]=N,P[3]=G,P[4]=(H-R*Q)/C,P[5]=($-B*Q)/C,P[6]=(W-N*Q)/C,P[7]=(K-G*Q)/C}return P},qt.str=function(P){return"quat2("+P[0]+", "+P[1]+", "+P[2]+", "+P[3]+", "+P[4]+", "+P[5]+", "+P[6]+", "+P[7]+")"},qt.exactEquals=function(P,A){return P[0]===A[0]&&P[1]===A[1]&&P[2]===A[2]&&P[3]===A[3]&&P[4]===A[4]&&P[5]===A[5]&&P[6]===A[6]&&P[7]===A[7]},qt.equals=function(P,A){var C=P[0],R=P[1],B=P[2],N=P[3],G=P[4],H=P[5],$=P[6],W=P[7],K=A[0],Q=A[1],ue=A[2],oe=A[3],ae=A[4],Ee=A[5],he=A[6],Se=A[7];return Math.abs(C-K)<=i.EPSILON*Math.max(1,Math.abs(C),Math.abs(K))&&Math.abs(R-Q)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(Q))&&Math.abs(B-ue)<=i.EPSILON*Math.max(1,Math.abs(B),Math.abs(ue))&&Math.abs(N-oe)<=i.EPSILON*Math.max(1,Math.abs(N),Math.abs(oe))&&Math.abs(G-ae)<=i.EPSILON*Math.max(1,Math.abs(G),Math.abs(ae))&&Math.abs(H-Ee)<=i.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ee))&&Math.abs($-he)<=i.EPSILON*Math.max(1,Math.abs($),Math.abs(he))&&Math.abs(W-Se)<=i.EPSILON*Math.max(1,Math.abs(W),Math.abs(Se))},qt.sqrLen=qt.squaredLength=qt.len=qt.length=qt.dot=qt.mul=qt.setReal=qt.getReal=void 0;var i=d(Z()),o=d(Kt()),u=d(Ke());function f(P){if(typeof WeakMap!="function")return null;var A=new WeakMap,C=new WeakMap;return(f=function(R){return R?C:A})(P)}function d(P,A){if(P&&P.__esModule)return P;if(P===null||c(P)!=="object"&&typeof P!="function")return{default:P};var C=f(A);if(C&&C.has(P))return C.get(P);var R={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var N in P)if(N!=="default"&&Object.prototype.hasOwnProperty.call(P,N)){var G=B?Object.getOwnPropertyDescriptor(P,N):null;G&&(G.get||G.set)?Object.defineProperty(R,N,G):R[N]=P[N]}return R.default=P,C&&C.set(P,R),R}function g(P,A,C){var R=.5*C[0],B=.5*C[1],N=.5*C[2],G=A[0],H=A[1],$=A[2],W=A[3];return P[0]=G,P[1]=H,P[2]=$,P[3]=W,P[4]=R*W+B*$-N*H,P[5]=B*W+N*G-R*$,P[6]=N*W+R*H-B*G,P[7]=-R*G-B*H-N*$,P}function w(P,A){return P[0]=A[0],P[1]=A[1],P[2]=A[2],P[3]=A[3],P[4]=A[4],P[5]=A[5],P[6]=A[6],P[7]=A[7],P}function E(P,A,C){var R=A[0],B=A[1],N=A[2],G=A[3],H=C[4],$=C[5],W=C[6],K=C[7],Q=A[4],ue=A[5],oe=A[6],ae=A[7],Ee=C[0],he=C[1],Se=C[2],Le=C[3];return P[0]=R*Le+G*Ee+B*Se-N*he,P[1]=B*Le+G*he+N*Ee-R*Se,P[2]=N*Le+G*Se+R*he-B*Ee,P[3]=G*Le-R*Ee-B*he-N*Se,P[4]=R*K+G*H+B*W-N*$+Q*Le+ae*Ee+ue*Se-oe*he,P[5]=B*K+G*$+N*H-R*W+ue*Le+ae*he+oe*Ee-Q*Se,P[6]=N*K+G*W+R*$-B*H+oe*Le+ae*Se+Q*he-ue*Ee,P[7]=G*K-R*H-B*$-N*W+ae*Le-Q*Ee-ue*he-oe*Se,P}qt.getReal=o.copy,qt.setReal=o.copy,qt.mul=E;var M=o.dot;qt.dot=M;var x=o.length;qt.length=x,qt.len=x;var S=o.squaredLength;return qt.squaredLength=S,qt.sqrLen=S,qt}var Hn,Ln,li={};function ys(){if(Hn)return li;function c(A){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(A)}Hn=1,Object.defineProperty(li,"__esModule",{value:!0}),li.create=u,li.clone=function(A){var C=new i.ARRAY_TYPE(2);return C[0]=A[0],C[1]=A[1],C},li.fromValues=function(A,C){var R=new i.ARRAY_TYPE(2);return R[0]=A,R[1]=C,R},li.copy=function(A,C){return A[0]=C[0],A[1]=C[1],A},li.set=function(A,C,R){return A[0]=C,A[1]=R,A},li.add=function(A,C,R){return A[0]=C[0]+R[0],A[1]=C[1]+R[1],A},li.subtract=f,li.multiply=d,li.divide=g,li.ceil=function(A,C){return A[0]=Math.ceil(C[0]),A[1]=Math.ceil(C[1]),A},li.floor=function(A,C){return A[0]=Math.floor(C[0]),A[1]=Math.floor(C[1]),A},li.min=function(A,C,R){return A[0]=Math.min(C[0],R[0]),A[1]=Math.min(C[1],R[1]),A},li.max=function(A,C,R){return A[0]=Math.max(C[0],R[0]),A[1]=Math.max(C[1],R[1]),A},li.round=function(A,C){return A[0]=Math.round(C[0]),A[1]=Math.round(C[1]),A},li.scale=function(A,C,R){return A[0]=C[0]*R,A[1]=C[1]*R,A},li.scaleAndAdd=function(A,C,R,B){return A[0]=C[0]+R[0]*B,A[1]=C[1]+R[1]*B,A},li.distance=w,li.squaredDistance=E,li.length=M,li.squaredLength=x,li.negate=function(A,C){return A[0]=-C[0],A[1]=-C[1],A},li.inverse=function(A,C){return A[0]=1/C[0],A[1]=1/C[1],A},li.normalize=function(A,C){var R=C[0],B=C[1],N=R*R+B*B;return N>0&&(N=1/Math.sqrt(N)),A[0]=C[0]*N,A[1]=C[1]*N,A},li.dot=function(A,C){return A[0]*C[0]+A[1]*C[1]},li.cross=function(A,C,R){var B=C[0]*R[1]-C[1]*R[0];return A[0]=A[1]=0,A[2]=B,A},li.lerp=function(A,C,R,B){var N=C[0],G=C[1];return A[0]=N+B*(R[0]-N),A[1]=G+B*(R[1]-G),A},li.random=function(A,C){C=C||1;var R=2*i.RANDOM()*Math.PI;return A[0]=Math.cos(R)*C,A[1]=Math.sin(R)*C,A},li.transformMat2=function(A,C,R){var B=C[0],N=C[1];return A[0]=R[0]*B+R[2]*N,A[1]=R[1]*B+R[3]*N,A},li.transformMat2d=function(A,C,R){var B=C[0],N=C[1];return A[0]=R[0]*B+R[2]*N+R[4],A[1]=R[1]*B+R[3]*N+R[5],A},li.transformMat3=function(A,C,R){var B=C[0],N=C[1];return A[0]=R[0]*B+R[3]*N+R[6],A[1]=R[1]*B+R[4]*N+R[7],A},li.transformMat4=function(A,C,R){var B=C[0],N=C[1];return A[0]=R[0]*B+R[4]*N+R[12],A[1]=R[1]*B+R[5]*N+R[13],A},li.rotate=function(A,C,R,B){var N=C[0]-R[0],G=C[1]-R[1],H=Math.sin(B),$=Math.cos(B);return A[0]=N*$-G*H+R[0],A[1]=N*H+G*$+R[1],A},li.angle=function(A,C){var R=A[0],B=A[1],N=C[0],G=C[1],H=Math.sqrt(R*R+B*B)*Math.sqrt(N*N+G*G);return Math.acos(Math.min(Math.max(H&&(R*N+B*G)/H,-1),1))},li.zero=function(A){return A[0]=0,A[1]=0,A},li.str=function(A){return"vec2("+A[0]+", "+A[1]+")"},li.exactEquals=function(A,C){return A[0]===C[0]&&A[1]===C[1]},li.equals=function(A,C){var R=A[0],B=A[1],N=C[0],G=C[1];return Math.abs(R-N)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(N))&&Math.abs(B-G)<=i.EPSILON*Math.max(1,Math.abs(B),Math.abs(G))},li.forEach=li.sqrLen=li.sqrDist=li.dist=li.div=li.mul=li.sub=li.len=void 0;var i=function(A,C){if(A&&A.__esModule)return A;if(A===null||c(A)!=="object"&&typeof A!="function")return{default:A};var R=o(void 0);if(R&&R.has(A))return R.get(A);var B={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if(G!=="default"&&Object.prototype.hasOwnProperty.call(A,G)){var H=N?Object.getOwnPropertyDescriptor(A,G):null;H&&(H.get||H.set)?Object.defineProperty(B,G,H):B[G]=A[G]}return B.default=A,R&&R.set(A,B),B}(Z());function o(A){if(typeof WeakMap!="function")return null;var C=new WeakMap,R=new WeakMap;return(o=function(B){return B?R:C})(A)}function u(){var A=new i.ARRAY_TYPE(2);return i.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0),A}function f(A,C,R){return A[0]=C[0]-R[0],A[1]=C[1]-R[1],A}function d(A,C,R){return A[0]=C[0]*R[0],A[1]=C[1]*R[1],A}function g(A,C,R){return A[0]=C[0]/R[0],A[1]=C[1]/R[1],A}function w(A,C){return Math.hypot(C[0]-A[0],C[1]-A[1])}function E(A,C){var R=C[0]-A[0],B=C[1]-A[1];return R*R+B*B}function M(A){return Math.hypot(A[0],A[1])}function x(A){var C=A[0],R=A[1];return C*C+R*R}li.len=M,li.sub=f,li.mul=d,li.div=g,li.dist=w,li.sqrDist=E,li.sqrLen=x;var S,P=(S=u(),function(A,C,R,B,N,G){var H,$;for(C||(C=2),R||(R=0),$=B?Math.min(B*C+R,A.length):A.length,H=R;H<$;H+=C)S[0]=A[H],S[1]=A[H+1],N(S,S,G),A[H]=S[0],A[H+1]=S[1];return A});return li.forEach=P,li}function is(){if(Ln)return k;function c(A){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(A)}Ln=1,Object.defineProperty(k,"__esModule",{value:!0}),k.vec4=k.vec3=k.vec2=k.quat2=k.quat=k.mat4=k.mat3=k.mat2d=k.mat2=k.glMatrix=void 0;var i=P(Z());k.glMatrix=i;var o=P(ne());k.mat2=o;var u=P(Te());k.mat2d=u;var f=P(Ae());k.mat3=f;var d=P(Ke());k.mat4=d;var g=P(Kt());k.quat=g;var w=P(gn());k.quat2=w;var E=P(ys());k.vec2=E;var M=P(lt());k.vec3=M;var x=P(Rt());function S(A){if(typeof WeakMap!="function")return null;var C=new WeakMap,R=new WeakMap;return(S=function(B){return B?R:C})(A)}function P(A,C){if(A&&A.__esModule)return A;if(A===null||c(A)!=="object"&&typeof A!="function")return{default:A};var R=S(C);if(R&&R.has(A))return R.get(A);var B={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if(G!=="default"&&Object.prototype.hasOwnProperty.call(A,G)){var H=N?Object.getOwnPropertyDescriptor(A,G):null;H&&(H.get||H.set)?Object.defineProperty(B,G,H):B[G]=A[G]}return B.default=A,R&&R.set(A,B),B}return k.vec4=x,k}var Sn,hs,Ns,Fr,ce=is(),dr=function(){if(hs)return Sn;function c(i,o,u,f){this.cx=3*i,this.bx=3*(u-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=u,this.p2y=f}return hs=1,Sn=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,o){if(o===void 0&&(o=1e-6),i<0)return 0;if(i>1)return 1;for(var u=i,f=0;f<8;f++){var d=this.sampleCurveX(u)-i;if(Math.abs(d)<o)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=d/g}var w=0,E=1;for(u=i,f=0;f<20&&(d=this.sampleCurveX(u),!(Math.abs(d-i)<o));f++)i>d?w=u:E=u,u=.5*(E-w)+w;return u},solve:function(i,o){return this.sampleCurveY(this.solveCurveX(i,o))}},Sn}(),vr=I(dr);function Ze(){if(Fr)return Ns;function c(i,o){this.x=i,this.y=o}return Fr=1,Ns=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,o){return this.clone()._rotateAround(i,o)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var o=i.x-this.x,u=i.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,o){return Math.atan2(this.x*o-this.y*i,this.x*i+this.y*o)},_matMult:function(i){var o=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=o,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var o=Math.cos(i),u=Math.sin(i),f=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=f,this},_rotateAround:function(i,o){var u=Math.cos(i),f=Math.sin(i),d=o.y+f*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-f*(this.y-o.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(i){return i instanceof c?i:Array.isArray(i)?new c(i[0],i[1]):i},Ns}var Ie=I(Ze());function wt(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let o=0;o<c.length;o++)if(!wt(c[o],i[o]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const o in c)if(!wt(c[o],i[o]))return!1;return!0}return c===i}const Vt=Math.PI/180,Bt=180/Math.PI;function yt(c){return c*Vt}function Xt(c){return c*Bt}const Zt=[[0,0],[1,0],[1,1],[0,1]];function Yt(c){if(c<=0)return 0;if(c>=1)return 1;const i=c*c,o=i*c;return 4*(c<.5?o:3*(c-i)+o-.75)}function Ut(c,i,o,u){const f=new vr(c,i,o,u);return function(d){return f.solve(d)}}const Ei=Ut(.25,.1,.25,1);function At(c,i,o){return Math.min(o,Math.max(i,c))}function ci(c,i,o){return(o=At((o-c)/(i-c),0,1))*o*(3-2*o)}function Ai(c,i,o){const u=o-i,f=((c-i)%u+u)%u+i;return f===i?o:f}function Xi(c,i,o){if(!c.length)return o(null,[]);let u=c.length;const f=new Array(c.length);let d=null;c.forEach((g,w)=>{i(g,(E,M)=>{E&&(d=E),f[w]=M,--u==0&&o(d,f)})})}function ji(c,...i){for(const o of i)for(const u in o)c[u]=o[u];return c}let un=1;function Kn(){return un++}function ds(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Ws(c,i){c.forEach(o=>{i[o]&&(i[o]=i[o].bind(i))})}function vs(c,i,o){const u={};for(const f in c)u[f]=i.call(this,c[f],f,c);return u}function Br(c,i,o){const u={};for(const f in c)i.call(this,c[f],f,c)&&(u[f]=c[f]);return u}function or(c){return Array.isArray(c)?c.map(or):typeof c=="object"&&c?vs(c,or):c}const Ts={};function on(c){Ts[c]||(typeof console<"u"&&console.warn(c),Ts[c]=!0)}function rn(c,i,o){return(o.y-c.y)*(i.x-c.x)>(i.y-c.y)*(o.x-c.x)}function Hu(c){let i=0;for(let o,u,f=0,d=c.length,g=d-1;f<d;g=f++)o=c[f],u=c[g],i+=(u.x-o.x)*(o.y+u.y);return i}function cc([c,i,o]){const u=yt(i+90),f=yt(o);return{x:c*Math.cos(u)*Math.sin(f),y:c*Math.sin(u)*Math.sin(f),z:c*Math.cos(f),azimuthal:i,polar:o}}function fr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xl(c){const i={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,f,d)=>{const g=f||d;return i[u]=!g||g.toLowerCase(),""}),i["max-age"]){const o=parseInt(i["max-age"],10);isNaN(o)?delete i["max-age"]:i["max-age"]=o}return i}let Gu=null;function uc(c,i){return[c[4*i],c[4*i+1],c[4*i+2],c[4*i+3]]}function Td(c,i,o,u){for(;i<o;){const f=i+o>>1;c[f]<u?i=f+1:o=f}return i}function Ed(c,i,o,u){for(;i<o;){const f=i+o>>1;c[f]<=u?i=f+1:o=f}return i}function qu(c){return c>0?1/(1.001-c):1+c}function nt(c){return c>0?1-1/(1.001-c):-c}const te={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!te.API_URL)return null;try{const c=new URL(te.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function re(c){return te.API_URL_REGEX.test(c)}function ye(c){return te.API_SPRITE_REGEX.test(c)}let Pe,Me,Oe,Ye,Be,tt;function rt(){return Pe==null&&(Pe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Pe}const it={now:()=>Ye!==void 0?Ye:performance.now(),setNow(c){Ye=c},restoreNow(){Ye=void 0},frame(c){const i=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(c,i=0){const{width:o,height:u}=c;Be||(Be=document.createElement("canvas"));const f=Be.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(o>Be.width||u>Be.height)&&(Be.width=o,Be.height=u),f.clearRect(-i,-i,o+2*i,u+2*i),f.drawImage(c,0,0,o,u),f.getImageData(-i,-i,o+2*i,u+2*i)},resolveURL:c=>(Me||(Me=document.createElement("a")),Me.href=c,Me.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Oe==null&&(Oe=window.matchMedia("(prefers-reduced-motion: reduce)")),Oe.matches)},hasCanvasFingerprintNoise(){if(tt!==void 0)return tt;if(!rt())return tt=!1,!1;const c=new OffscreenCanvas(85,1),i=c.getContext("2d",{willReadFrequently:!0});let o=0;for(let f=0;f<c.width;++f)i.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,i.fillRect(f,0,1,1);const u=i.getImageData(0,0,c.width,c.height);o=0;for(let f=0;f<u.data.length;++f)if(f%4!=3&&o++!==u.data[f])return tt=!0,!0;return tt=!1,!1}};function xt(c,i){const o=c.indexOf("?");if(o<0)return`${c}?${new URLSearchParams(i).toString()}`;const u=new URLSearchParams(c.slice(o));for(const f in i)u.set(f,i[f]);return`${c.slice(0,o)}?${u.toString()}`}function Ot(c,i={persistentParams:[]}){const o=c.indexOf("?");if(o<0)return c;const u=new URLSearchParams,f=new URLSearchParams(c.slice(o));for(const g of i.persistentParams){const w=f.get(g);w&&u.set(g,w)}const d=u.toString();return`${c.slice(0,o)}${d.length>0?`?${d}`:""}`}const Nt="mapbox-tiles";let mi=500,vi=50;const xi=["language","worldview","jobid"];let Ti,_n;function On(){try{return caches}catch{}}function Ci(){const c=On();c&&Ti==null&&(Ti=c.open(Nt))}let Ki=1/0;const Ji={supported:!1,testSupport:function(c){!Es&&Gn&&(Zs?ar(c):nn=c)}};let nn,Gn,Es=!1,Zs=!1;const to=typeof self<"u"?self:{};function ar(c){const i=c.createTexture();c.bindTexture(c.TEXTURE_2D,i);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Gn),c.isContextLost())return;Ji.supported=!0}catch{}c.deleteTexture(i),Es=!0}to.document&&(Gn=to.document.createElement("img"),Gn.onload=function(){nn&&ar(nn),nn=null,Zs=!0},Gn.onerror=function(){Es=!0,nn=null},Gn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ss={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ss);class Ds extends Error{constructor(i,o,u){o===401&&re(u)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const hc=fr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,io=function(c,i){if(!(/^file:/.test(o=c.url)||/^file:/.test(hc())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,f){const d=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:hc(),referrerPolicy:u.referrerPolicy,signal:d.signal});let w=!1,E=!1;const M=(x=g.url).indexOf("sku=")>0&&re(x);var x;u.type==="json"&&g.headers.set("Accept","application/json");const S=(A,C,R)=>{if(E)return;if(A&&A.message!=="SecurityError"&&on(A.toString()),C&&R)return P(C);const B=Date.now();fetch(g).then(N=>{if(N.ok){const G=M?N.clone():null;return P(N,G,B)}return f(new Ds(N.statusText,N.status,u.url))}).catch(N=>{N.name!=="AbortError"&&f(new Error(`${N.message} ${u.url}`))})},P=(A,C,R)=>{(u.type==="arrayBuffer"?A.arrayBuffer():u.type==="json"?A.json():A.text()).then(B=>{E||(C&&R&&function(N,G,H){if(Ci(),Ti==null)return;const $=xl(G.headers.get("Cache-Control")||"");if($["no-store"])return;const W={status:G.status,statusText:G.statusText,headers:new Headers};G.headers.forEach((ue,oe)=>W.headers.set(oe,ue)),$["max-age"]&&W.headers.set("Expires",new Date(H+1e3*$["max-age"]).toUTCString());const K=W.headers.get("Expires");if(!K||new Date(K).getTime()-H<42e4)return;let Q=Ot(N.url,{persistentParams:xi});if(G.status===206){const ue=N.headers.get("Range");if(!ue)return;W.status=200,Q=xt(Q,{range:ue})}(function(ue,oe){if(_n===void 0)try{new Response(new ReadableStream),_n=!0}catch{_n=!1}_n?oe(ue.body):ue.blob().then(oe)})(G,ue=>{const oe=new Response((ae=G.status)!==200&&ae!==404&&[101,103,204,205,304].includes(ae)?null:ue,W);var ae;Ci(),Ti!=null&&Ti.then(Ee=>Ee.put(Q,oe)).catch(Ee=>on(Ee.message))})}(g,C,R),w=!0,f(null,B,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(B=>{E||f(new Error(B.message))})};return M?function(A,C){if(Ci(),Ti==null)return C(null);Ti.then(R=>{let B=Ot(A.url,{persistentParams:xi});const N=A.headers.get("Range");N&&(B=xt(B,{range:N})),R.match(B).then(G=>{const H=function($){if(!$)return!1;const W=new Date($.headers.get("Expires")||0),K=xl($.headers.get("Cache-Control")||"");return W>Date.now()&&!K["no-cache"]}(G);R.delete(B),H&&R.put(B,G.clone()),C(null,G,H)}).catch(C)}).catch(C)}(g,S):S(null,null),{cancel:()=>{E=!0,w||d.abort()}}}(c,i);if(fr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,i,void 0,!0)}var o;return function(u,f){const d=new XMLHttpRequest;d.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const g in u.headers)d.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=u.credentials==="include",d.onerror=()=>{f(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let g=d.response;if(u.type==="json")try{g=JSON.parse(d.response)}catch(w){return f(w)}f(null,g,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else f(new Ds(d.statusText,d.status,u.url))},d.send(u.body),{cancel:()=>d.abort()}}(c,i)},ua=function(c,i){return io(ji(c,{type:"arrayBuffer"}),i)};function Op(c){const i=document.createElement("a");return i.href=c,i.protocol===location.protocol&&i.host===location.host}const Sd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Wu,dc;Wu=[],dc=0;const kp=function(c,i){if(Ji.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),dc>=te.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:c,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Wu.push(d),d}dc++;let o=!1;const u=()=>{if(!o)for(o=!0,dc--;Wu.length&&dc<te.MAX_PARALLEL_IMAGE_REQUESTS;){const d=Wu.shift(),{requestParameters:g,callback:w,cancelled:E}=d;E||(d.cancel=kp(g,w).cancel)}},f=ua(c,(d,g,w,E)=>{u(),d?i(d):g&&(self.createImageBitmap?function(M,x){const S=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(S).then(P=>{x(null,P)}).catch(P=>{x(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(M,x)=>i(M,x,w,E)):function(M,x){const S=new Image;S.onload=()=>{x(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame(()=>{S.src=Sd})},S.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(M)],{type:"image/png"});S.src=M.byteLength?URL.createObjectURL(P):Sd}(g,(M,x)=>i(M,x,w,E)))});return{cancel:()=>{f.cancel(),u()}}};var ly,cy,zp,fc={exports:{}},Nr={exports:{}},bo={exports:{}},Ha=function(){if(zp)return fc.exports;zp=1;var c=(ly||(ly=1,Nr.exports=function(o,u){var f,d,g,w,E,M,x,S;for(d=o.length-(f=3&o.length),g=u,E=3432918353,M=461845907,S=0;S<d;)x=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24,++S,g=27492+(65535&(w=5*(65535&(g=(g^=x=(65535&(x=(x=(65535&x)*E+(((x>>>16)*E&65535)<<16)&4294967295)<<15|x>>>17))*M+(((x>>>16)*M&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(x=0,f){case 3:x^=(255&o.charCodeAt(S+2))<<16;case 2:x^=(255&o.charCodeAt(S+1))<<8;case 1:g^=x=(65535&(x=(x=(65535&(x^=255&o.charCodeAt(S)))*E+(((x>>>16)*E&65535)<<16)&4294967295)<<15|x>>>17))*M+(((x>>>16)*M&65535)<<16)&4294967295}return g^=o.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Nr.exports),i=(cy||(cy=1,bo.exports=function(o,u){for(var f,d=o.length,g=u^d,w=0;d>=4;)f=1540483477*(65535&(f=255&o.charCodeAt(w)|(255&o.charCodeAt(++w))<<8|(255&o.charCodeAt(++w))<<16|(255&o.charCodeAt(++w))<<24))+((1540483477*(f>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),d-=4,++w;switch(d){case 3:g^=(255&o.charCodeAt(w+2))<<16;case 2:g^=(255&o.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&o.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),bo.exports);return fc.exports=c,fc.exports.murmur3=c,fc.exports.murmur2=i,fc.exports}(),Vr=I(Ha);class xr{constructor(i,...o){ji(this,o[0]||{}),this.type=i}}class pc extends xr{constructor(i,o={}){super("error",ji({error:i},o))}}function Fp(c,i,o){o[c]&&o[c].indexOf(i)!==-1||(o[c]=o[c]||[],o[c].push(i))}function Ad(c,i,o){if(o&&o[c]){const u=o[c].indexOf(i);u!==-1&&o[c].splice(u,1)}}class wo{on(i,o){return this._listeners=this._listeners||{},Fp(i,o,this._listeners),this}off(i,o){return Ad(i,o,this._listeners),Ad(i,o,this._oneTimeListeners),this}once(i,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Fp(i,o,this._oneTimeListeners),this):new Promise(u=>{this.once(i,u)})}fire(i,o){const u=typeof i=="string"?new xr(i,o):i,f=u.type;if(this.listens(f)){u.target=this;const d=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const E of d)E.call(this,u);const g=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const E of g)Ad(f,E,this._oneTimeListeners),E.call(this,u);const w=this._eventedParent;w&&(ji(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(u))}else u instanceof pc&&console.error(u.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,o){return this._eventedParent=i,this._eventedParentData=o,this}}class pr{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new pr(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[o,u]=i.split("");return new pr({name:o,iconsetId:u})}static isEqual(i,o){return i.name===o.name&&i.iconsetId===o.iconsetId}toString(){return pr.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var uy,Bp={},no=function(){if(uy)return Bp;uy=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(d){return(d=Math.round(d))<0?0:d>255?255:d}function o(d){return i(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function u(d){return(g=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:g>1?1:g;var g}function f(d,g,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?d+(g-d)*w*6:2*w<1?g:3*w<2?d+(g-d)*(2/3-w)*6:d}try{Bp.parseCSSColor=function(d){var g,w=d.replace(/ /g,"").toLowerCase();if(w in c)return c[w].slice();if(w[0]==="#")return w.length===4?(g=parseInt(w.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:w.length===7&&(g=parseInt(w.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var E=w.indexOf("("),M=w.indexOf(")");if(E!==-1&&M+1===w.length){var x=w.substr(0,E),S=w.substr(E+1,M-(E+1)).split(","),P=1;switch(x){case"rgba":if(S.length!==4)return null;P=u(S.pop());case"rgb":return S.length!==3?null:[o(S[0]),o(S[1]),o(S[2]),P];case"hsla":if(S.length!==4)return null;P=u(S.pop());case"hsl":if(S.length!==3)return null;var A=(parseFloat(S[0])%360+360)%360/360,C=u(S[1]),R=u(S[2]),B=R<=.5?R*(C+1):R+C-R*C,N=2*R-B;return[i(255*f(N,B,A+1/3)),i(255*f(N,B,A)),i(255*f(N,B,A-1/3)),P];default:return null}}return null}}catch{}return Bp}();class Qi{constructor(i,o,u,f=1){this.r=i,this.g=o,this.b=u,this.a=f}static parse(i){if(!i)return;if(i instanceof Qi)return i;if(typeof i!="string")return;const o=no.parseCSSColor(i);return o?new Qi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toStringPremultipliedAlpha(){const[i,o,u,f]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(i)},${Math.round(o)},${Math.round(u)},${f})`}toString(){const[i,o,u,f]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*o)},${Math.round(255*u)},${f})`}toRenderColor(i){const{r:o,g:u,b:f,a:d}=this;return new Np(i,o,u,f,d)}clone(){return new Qi(this.r,this.g,this.b,this.a)}}class Np{constructor(i,o,u,f,d){if(i){const g=i.image.height,w=g*g;o=d===0?0:o/d*(g-1),u=d===0?0:u/d*(g-1),f=d===0?0:f/d*(g-1);const E=Math.floor(o),M=Math.floor(u),x=Math.floor(f),S=Math.ceil(o),P=Math.ceil(u),A=Math.ceil(f),C=o-E,R=u-M,B=f-x,N=i.image.data,G=4*(E+M*w+x*g),H=4*(E+M*w+A*g),$=4*(E+P*w+x*g),W=4*(E+P*w+A*g),K=4*(S+M*w+x*g),Q=4*(S+M*w+A*g),ue=4*(S+P*w+x*g),oe=4*(S+P*w+A*g);if(G<0||oe>=N.length)throw new Error("out of range");this.r=ni(ni(ni(N[G],N[H],B),ni(N[$],N[W],B),R),ni(ni(N[K],N[Q],B),ni(N[ue],N[oe],B),R),C)/255*d,this.g=ni(ni(ni(N[G+1],N[H+1],B),ni(N[$+1],N[W+1],B),R),ni(ni(N[K+1],N[Q+1],B),ni(N[ue+1],N[oe+1],B),R),C)/255*d,this.b=ni(ni(ni(N[G+2],N[H+2],B),ni(N[$+2],N[W+2],B),R),ni(ni(N[K+2],N[Q+2],B),ni(N[ue+2],N[oe+2],B),R),C)/255*d,this.a=d}else this.r=o,this.g=u,this.b=f,this.a=d}toArray(){const{r:i,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[255*i/f,255*o/f,255*u/f,f]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:i,g:o,b:u,a:f}=this,d=Math.min(Math.max(i/f,0),1),g=Math.min(Math.max(o/f,0),1),w=Math.min(Math.max(u/f,0),1),E=Math.min(d,g,w),M=Math.max(d,g,w),x=(E+M)/2;if(E===M)return[0,0,100*x,f];const S=M-E,P=x>.5?S/(2-M-E):S/(M+E);let A=0;return M===d?A=(g-w)/S+(g<w?6:0):M===g?A=(w-d)/S+2:M===w&&(A=(d-g)/S+4),A*=60,[Math.min(Math.max(A,0),360),Math.min(Math.max(100*P,0),100),Math.min(Math.max(100*x,0),100),f]}toArray01(){const{r:i,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[i/f,o/f,u/f,f]}toArray01Scaled(i){const{r:o,g:u,b:f,a:d}=this;return d===0?[0,0,0]:[o/d*i,u/d*i,f/d*i]}toArray01PremultipliedAlpha(){const{r:i,g:o,b:u,a:f}=this;return[i,o,u,f]}toArray01Linear(){const{r:i,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[Math.pow(i/f,2.2),Math.pow(o/f,2.2),Math.pow(u/f,2.2),f]}}function ni(c,i,o){return c*(1-o)+i*o}function hy(c,i,o){return c.map((u,f)=>ni(u,i[f],o))}function dy(c){return c*c*c*c*c}Qi.black=new Qi(0,0,0,1),Qi.white=new Qi(1,1,1,1),Qi.transparent=new Qi(0,0,0,0),Qi.red=new Qi(1,0,0,1),Qi.blue=new Qi(0,0,1,1);var Zu=Object.freeze({__proto__:null,array:hy,color:function(c,i,o){return new Qi(ni(c.r,i.r,o),ni(c.g,i.g,o),ni(c.b,i.b,o),ni(c.a,i.a,o))},easeIn:dy,number:ni});function $i(c,...i){for(const o of i)for(const u in o)c[u]=o[u];return c}class so extends Error{constructor(i,o){super(o),this.message=o,this.key=i}}class Md{constructor(i,o=[]){this.parent=i,this.bindings={};for(const[u,f]of o)this.bindings[u]=f}concat(i){return new Md(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const mc={kind:"null"},Gt={kind:"number"},Yi={kind:"string"},Ni={kind:"boolean"},Xs={kind:"color"},gc={kind:"object"},Hi={kind:"value"},ha={kind:"collator"},Xu={kind:"formatted"},da={kind:"resolvedImage"};function Vs(c,i){return{kind:"array",itemType:c,N:i}}function qn(c){if(c.kind==="array"){const i=qn(c.itemType);return typeof c.N=="number"?`array<${i}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${i}>`}return c.kind}const To=[mc,Gt,Yi,Ni,Xs,Xu,gc,Vs(Hi),da];function _c(c,i){if(i.kind==="error")return null;if(c.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!_c(c.itemType,i.itemType))&&(typeof c.N!="number"||c.N===i.N))return null}else{if(c.kind===i.kind)return null;if(c.kind==="value"){for(const o of To)if(!_c(o,i))return null}}return`Expected ${qn(c)} but found ${qn(i)} instead.`}function Vp(c,i){return i.some(o=>o.kind===c.kind)}function yc(c,i){return i.some(o=>o==="null"?c===null:o==="array"?Array.isArray(c):o==="object"?c&&!Array.isArray(c)&&typeof c=="object":o===typeof c)}class Id{constructor(i,o,u){this.sensitivity=i?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,o){return this.collator.compare(i,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yu{constructor(i,o,u,f,d){this.text=i.normalize?i.normalize():i,this.image=o,this.scale=u,this.fontStack=f,this.textColor=d}}class Ys{constructor(i){this.sections=i}static fromString(i){return new Ys([new Yu(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof Ys?i:Ys.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const o of this.sections){if(o.image){const f=o.image.getPrimary().id.toString();i.push(["image",f]);continue}i.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),i.push(u)}return i}}class Ho{constructor(i,o={}){if(this.id=pr.from(i),this.options=Object.assign({},o),o.transform){const{a:u,b:f,c:d,d:g,e:w,f:E}=o.transform;this.options.transform=new DOMMatrix([u,f,d,g,w,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:i,b:o,c:u,d:f,e:d,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:i,b:o,c:u,d:f,e:d,f:g}})}static parse(i){let o,u,f,d;try{({name:o,iconsetId:u,params:f,transform:d}=JSON.parse(i)||{})}catch{return null}if(!o)return null;const{a:g,b:w,c:E,d:M,e:x,f:S}=d||{};return new Ho({name:o,iconsetId:u},{params:f,transform:new DOMMatrix([g,w,E,M,x,S])})}scaleSelf(i){return this.options.transform.scaleSelf(i),this}}class Ks{constructor(i,o,u,f,d=!1){this.primaryId=pr.from(i),this.primaryOptions=o,u&&(this.secondaryId=pr.from(u)),this.secondaryOptions=f,this.available=d}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ho(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ho(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?Ks.build({name:i}):i}static build(i,o,u,f){return!i||typeof i=="object"&&!("name"in i)?null:new Ks(i,u,o,f)}}function Ku(c,i,o,u){return typeof c=="number"&&c>=0&&c<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[c,i,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[c,i,o,u]:[c,i,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Eo(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Qi||c instanceof Id||c instanceof Ys||c instanceof Ks)return!0;if(Array.isArray(c)){for(const i of c)if(!Eo(i))return!1;return!0}if(typeof c=="object"){for(const i in c)if(!Eo(c[i]))return!1;return!0}return!1}function ns(c){if(c===null)return mc;if(typeof c=="string")return Yi;if(typeof c=="boolean")return Ni;if(typeof c=="number")return Gt;if(c instanceof Qi)return Xs;if(c instanceof Id)return ha;if(c instanceof Ys)return Xu;if(c instanceof Ks)return da;if(Array.isArray(c)){const i=c.length;let o;for(const u of c){const f=ns(u);if(o){if(o===f)continue;o=Hi;break}o=f}return Vs(o||Hi,i)}return gc}function As(c){const i=typeof c;return c===null?"":i==="string"||i==="number"||i==="boolean"?String(c):c instanceof Qi?c.toStringPremultipliedAlpha():c instanceof Ys||c instanceof Ks?c.toString():JSON.stringify(c)}class fa{constructor(i,o){this.type=i,this.value=o}static parse(i,o){if(i.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Eo(i[1]))return o.error("invalid value");const u=i[1];let f=ns(u);const d=o.expectedType;return f.kind!=="array"||f.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(f=d),new fa(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Ys?this.value.serialize():this.value}}class Zn{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Up={string:Yi,number:Gt,boolean:Ni,object:gc};class Ur{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let u,f=1;const d=i[0];if(d==="array"){let w,E;if(i.length>2){const M=i[1];if(typeof M!="string"||!(M in Up)||M==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);w=Up[M],f++}else w=Hi;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return o.error('The length argument to "array" must be a positive integer literal',2);E=i[2],f++}u=Vs(w,E)}else u=Up[d];const g=[];for(;f<i.length;f++){const w=o.parse(i[f],f,Hi);if(!w)return null;g.push(w)}return new Ur(u,g)}evaluate(i){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(i);if(!_c(this.type,ns(u)))return u;if(o===this.args.length-1)throw new Zn(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${qn(ns(u))} but was expected to be of type ${qn(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,o=[i.kind];if(i.kind==="array"){const u=i.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const f=i.N;(typeof f=="number"||this.args.length>1)&&o.push(f)}}return o.concat(this.args.map(u=>u.serialize()))}}class vc{constructor(i){this.type=Xu,this.sections=i}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const u=i[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const f=[];let d=!1;for(let g=1;g<=i.length-1;++g){const w=i[g];if(d&&typeof w=="object"&&!Array.isArray(w)){d=!1;let E=null;if(w["font-scale"]&&(E=o.parseObjectValue(w["font-scale"],g,"font-scale",Gt),!E))return null;let M=null;if(w["text-font"]&&(M=o.parseObjectValue(w["text-font"],g,"text-font",Vs(Yi)),!M))return null;let x=null;if(w["text-color"]&&(x=o.parseObjectValue(w["text-color"],g,"text-color",Xs),!x))return null;const S=f[f.length-1];S.scale=E,S.font=M,S.textColor=x}else{const E=o.parse(i[g],g,Hi);if(!E)return null;const M=E.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new vc(f)}evaluate(i){return new Ys(this.sections.map(o=>{const u=o.content.evaluate(i);return ns(u)===da?new Yu("",u,null,null,null):new Yu(As(u),null,o.scale?o.scale.evaluate(i):null,o.font?o.font.evaluate(i).join(","):null,o.textColor?o.textColor.evaluate(i):null)}))}eachChild(i){for(const o of this.sections)i(o.content),o.scale&&i(o.scale),o.font&&i(o.font),o.textColor&&i(o.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const o of this.sections){i.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),i.push(u)}return i}}class Ga{constructor(i,o,u,f){this._imageWarnHistory={},this.type=da,this.namePrimary=i,this.nameSecondary=o,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),f&&(this.paramsSecondary=f.params,this.iconsetIdSecondary=f.iconset?f.iconset.id:void 0)}static parse(i,o){if(i.length<2)return o.error("Expected two or more arguments.");let u=1;const f=[];function d(){if(u<i.length){const w=o.parse(i[u],u++,Yi);return w?(f.push({image:w,options:{}}),!0):(o.error(f.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<i.length){const E=i[u];if((w=E)===null||typeof w!="object"||Array.isArray(w))return!0;const M=E.params,x=E.iconset,S=o.concat(u);if(!M&&!x)return u++,!0;if(M){if(typeof M!="object"||M.constructor!==Object)return S.error('Image options "params" should be an object'),!1;const P={},A=S.concat(void 0,"params");for(const C in M){if(!C)return A.error("Image parameter name should be non-empty"),!1;const R=A.concat(void 0,C).parse(M[C],void 0,Xs,void 0,{typeAnnotation:"coerce"});if(!R)return!1;P[C]=R}f[f.length-1].options.params=P}if(x){if(typeof x!="object"||x.constructor!==Object)return S.error('Image options "iconset" should be an object'),!1;if(!x.id)return S.error('Image options "iconset" should have an "id" property'),!1;f[f.length-1].options.iconset=x}return u++,!0}var w;return!0}for(let w=0;w<2;w++)if(!d()||!g())return;return new Ga(f[0].image,f[1]?f[1].image:void 0,f[0].options,f[1]?f[1].options:void 0)}evaluateParams(i,o){const u={};if(o){for(const f in o)if(o[f])try{u[f]=o[f].evaluate(i)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(i){const o={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,f=Ks.build(o,u,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(f&&i.availableImages){const d=f.getPrimary().id;if(f.available=i.availableImages.some(g=>pr.isEqual(g,d)),f.available){const g=f.getSecondary()?f.getSecondary().id:null;g&&(f.available=i.availableImages.some(w=>pr.isEqual(w,g)))}}return f}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const o in this.paramsPrimary)this.paramsPrimary[o]&&i(this.paramsPrimary[o]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const o in this.paramsSecondary)this.paramsSecondary[o]&&i(this.paramsSecondary[o])}outputDefined(){return!1}serializeOptions(i,o){const u={};if(o&&(u.iconset={id:o}),i){u.params={};for(const f in i)i[f]&&(u.params[f]=i[f].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const o=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);o&&i.push(o)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const o=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);o&&i.push(o)}return i}}function pa(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const U1={"to-boolean":Ni,"to-color":Xs,"to-number":Gt,"to-string":Yi};class ma{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const u=i[0],f=[];let d=mc;if(u==="to-array"){if(!Array.isArray(i[1]))return null;const g=i[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);d=Vs(o.expectedType.itemType,g)}else{if(!(g>0&&Eo(i[1][0])))return null;d=Vs(ns(i[1][0]),g)}for(let w=0;w<g;w++){const E=i[1][w];let M;if(pa(E)==="array")M=o.parse(E,void 0,d.itemType);else{const x=pa(E);if(x!==d.itemType.kind)return o.error(`Expected ${d.itemType.kind} but found ${x}.`);M=o.registry.literal.parse(["literal",E===void 0?null:E],o)}if(!M)return null;f.push(M)}}else{if((u==="to-boolean"||u==="to-string")&&i.length!==2)return o.error("Expected one argument.");d=U1[u];for(let g=1;g<i.length;g++){const w=o.parse(i[g],g,Hi);if(!w)return null;f.push(w)}}return new ma(d,f)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let o,u;for(const f of this.args){if(o=f.evaluate(i),u=null,o instanceof Qi)return o;if(typeof o=="string"){const d=i.parseColor(o);if(d)return d}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Ku(o[0],o[1],o[2],o[3]),!u))return new Qi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Zn(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(i),o===null)return 0;const f=Number(o);if(!isNaN(f))return f}throw new Zn(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Ys.fromString(As(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Ks.build(As(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(o=>o.evaluate(i)):As(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new vc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ga(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{i.push(o.serialize())}),i}}const j1=["Unknown","Point","LineString","Polygon"];class Cd{constructor(i,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?j1[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-i[0])+this.featureDistanceData.bearing[1]*(f*o-i[1])}return 0}parseColor(i){let o=this._parseColorCache[i];return o||(o=this._parseColorCache[i]=Qi.parse(i)),o}getConfig(i){return this.options?this.options.get(i):null}}class lr{constructor(i,o,u,f,d){this.name=i,this.type=o,this._evaluate=u,this.args=f,this._overloadIndex=d}evaluate(i){if(!this._evaluate){const o=lr.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,o){const u=i[0],f=lr.definitions[u];if(!f)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(f)?f[0]:f.type,g=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=[];let E=null,M=-1;for(const[x,S]of g){if(Array.isArray(x)&&x.length!==i.length-1)continue;w.push(x),M++,E=new Zp(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const P=[];let A=!1;for(let C=1;C<i.length;C++){const R=i[C],B=Array.isArray(x)?x[C-1]:x.type,N=E.parse(R,1+P.length,B);if(!N){A=!0;break}P.push(N)}if(!A)if(Array.isArray(x)&&x.length!==P.length)E.error(`Expected ${x.length} arguments, but found ${P.length} instead.`);else{for(let C=0;C<P.length;C++){const R=Array.isArray(x)?x[C]:x.type,B=P[C];E.concat(C+1).checkSubtype(R,B.type)}if(E.errors.length===0)return new lr(u,d,S,P,M)}}if(w.length===1)o.errors.push(...E.errors);else{const x=(w.length?w:g.map(([P])=>P)).map($1).join(" | "),S=[];for(let P=1;P<i.length;P++){const A=o.parse(i[P],1+S.length);if(!A)return null;S.push(qn(A.type))}o.error(`Expected arguments of type ${x}, but found (${S.join(", ")}) instead.`)}return null}static register(i,o){lr.definitions=o;for(const u in o)i[u]=lr}}function $1(c){return Array.isArray(c)?`(${c.map(qn).join(", ")})`:`(${qn(c.type)}...)`}class bl{constructor(i,o,u){this.type=ha,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=o}static parse(i,o){if(i.length!==2)return o.error("Expected one argument.");const u=i[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const f=u["case-sensitive"]===void 0?o.parse(!1,1,Ni):o.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Ni);if(!f)return null;const d=u["diacritic-sensitive"]===void 0?o.parse(!1,1,Ni):o.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Ni);if(!d)return null;let g=null;return u.locale&&(g=o.parseObjectValue(u.locale,1,"locale",Yi),!g)?null:new bl(f,d,g)}evaluate(i){return new Id(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function fy(c,i,o=0,u=c.length-1,f=H1){for(;u>o;){if(u-o>600){const E=u-o+1,M=i-o+1,x=Math.log(E),S=.5*Math.exp(2*x/3),P=.5*Math.sqrt(x*S*(E-S)/E)*(M-E/2<0?-1:1);fy(c,i,Math.max(o,Math.floor(i-M*S/E+P)),Math.min(u,Math.floor(i+(E-M)*S/E+P)),f)}const d=c[i];let g=o,w=u;for(Ju(c,o,i),f(c[u],d)>0&&Ju(c,o,u);g<w;){for(Ju(c,g,w),g++,w--;f(c[g],d)<0;)g++;for(;f(c[w],d)>0;)w--}f(c[o],d)===0?Ju(c,o,w):(w++,Ju(c,w,u)),w<=i&&(o=w+1),i<=w&&(u=w-1)}}function Ju(c,i,o){const u=c[i];c[i]=c[o],c[o]=u}function H1(c,i){return c<i?-1:c>i?1:0}function G1(c){let i=0;for(let o,u,f=0,d=c.length,g=d-1;f<d;g=f++)o=c[f],u=c[g],i+=(u.x-o.x)*(o.y+u.y);return i}function Qu(c,i){c[0]=Math.min(c[0],i[0]),c[1]=Math.min(c[1],i[1]),c[2]=Math.max(c[2],i[0]),c[3]=Math.max(c[3],i[1])}function eh(c,i){return!(c[0]<=i[0]||c[2]>=i[2]||c[1]<=i[1]||c[3]>=i[3])}function q1(c,i,o){const u=c[0]-i[0],f=c[1]-i[1],d=c[0]-o[0],g=c[1]-o[1];return u*g-d*f==0&&u*d<=0&&f*g<=0}function wl(c,i,o=!1){let u=!1;for(let w=0,E=i.length;w<E;w++){const M=i[w];for(let x=0,S=M.length,P=S-1;x<S;P=x++){const A=M[P],C=M[x];if(q1(c,A,C))return o;(d=A)[1]>(f=c)[1]!=(g=C)[1]>f[1]&&f[0]<(g[0]-d[0])*(f[1]-d[1])/(g[1]-d[1])+d[0]&&(u=!u)}}var f,d,g;return u}function Tl(c,i,o,u){const f=u[0]-o[0],d=u[1]-o[1],g=(c[0]-o[0])*d-f*(c[1]-o[1]),w=(i[0]-o[0])*d-f*(i[1]-o[1]);return g>0&&w<0||g<0&&w>0}function Pd(c,i,o,u){return(f=[u[0]-o[0],u[1]-o[1]])[0]*(d=[i[0]-c[0],i[1]-c[1]])[1]-f[1]*d[0]!=0&&!(!Tl(c,i,o,u)||!Tl(o,u,c,i));var f,d}const qa=8192;function jp(c,i){const o=(180+c[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,f=Math.pow(2,i.z);return[Math.round(o*f*qa),Math.round(u*f*qa)]}function W1(c,i){for(let o=0;o<i.length;o++)if(wl(c,i[o]))return!0;return!1}function Z1(c,i,o){for(const u of o)for(let f=0,d=u.length,g=d-1;f<d;g=f++)if(Pd(c,i,u[g],u[f]))return!0;return!1}function py(c,i){for(let o=0;o<c.length;++o)if(!wl(c[o],i))return!1;for(let o=0;o<c.length-1;++o)if(Z1(c[o],c[o+1],i))return!1;return!0}function X1(c,i){for(let o=0;o<i.length;o++)if(py(c,i[o]))return!0;return!1}function Wa(c,i,o){const u=[];for(let f=0;f<c.length;f++){const d=[];for(let g=0;g<c[f].length;g++){const w=jp(c[f][g],o);Qu(i,w),d.push(w)}u.push(d)}return u}function Mi(c,i,o){const u=[];for(let f=0;f<c.length;f++){const d=Wa(c[f],i,o);u.push(d)}return u}function Jt(c,i,o,u){if(c[0]<o[0]||c[0]>o[2]){const f=.5*u;let d=c[0]-o[0]>f?-u:o[0]-c[0]>f?u:0;d===0&&(d=c[0]-o[2]>f?-u:o[2]-c[0]>f?u:0),c[0]+=d}Qu(i,c)}function Dd(c,i,o,u){const f=Math.pow(2,u.z)*qa,d=[u.x*qa,u.y*qa],g=[];if(!c)return g;for(const w of c)for(const E of w){const M=[E.x+d[0],E.y+d[1]];Jt(M,i,o,f),g.push(M)}return g}function gi(c,i,o,u){const f=Math.pow(2,u.z)*qa,d=[u.x*qa,u.y*qa],g=[];if(!c)return g;for(const E of c){const M=[];for(const x of E){const S=[x.x+d[0],x.y+d[1]];Qu(i,S),M.push(S)}g.push(M)}if(i[2]-i[0]<=f/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of g)for(const M of E)Jt(M,i,o,f)}var w;return g}class ga{constructor(i,o){this.type=Ni,this.geojson=i,this.geometries=o}static parse(i,o){if(i.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Eo(i[1])){const u=i[1];if(u.type==="FeatureCollection")for(let f=0;f<u.features.length;++f){const d=u.features[f].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ga(u,u.features[f].geometry)}else if(u.type==="Feature"){const f=u.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new ga(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new ga(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const w=Wa(u.coordinates,d,g),E=Dd(o.geometry(),f,d,g);if(!eh(f,d))return!1;for(const M of E)if(!wl(M,w))return!1}if(u.type==="MultiPolygon"){const w=Mi(u.coordinates,d,g),E=Dd(o.geometry(),f,d,g);if(!eh(f,d))return!1;for(const M of E)if(!W1(M,w))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const w=Wa(u.coordinates,d,g),E=gi(o.geometry(),f,d,g);if(!eh(f,d))return!1;for(const M of E)if(!py(M,w))return!1}if(u.type==="MultiPolygon"){const w=Mi(u.coordinates,d,g),E=gi(o.geometry(),f,d,g);if(!eh(f,d))return!1;for(const M of E)if(!X1(M,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const xc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},fi=1/298.257223563,$p=fi*(2-fi),El=Math.PI/180;class bc{static fromTile(i,o,u){const f=Math.PI*(1-2*(i+.5)/Math.pow(2,o)),d=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/El;return new bc(d,u)}static get units(){return xc}constructor(i,o){if(i===void 0)throw new Error("No latitude given.");if(o&&!xc[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(xc).join(", ")}`);const u=6378.137*El*(o?xc[o]:1),f=Math.cos(i*El),d=1/(1-$p*(1-f*f)),g=Math.sqrt(d);this.kx=u*g*f,this.ky=u*g*d*(1-$p)}distance(i,o){const u=Un(i[0]-o[0])*this.kx,f=(i[1]-o[1])*this.ky;return Math.sqrt(u*u+f*f)}bearing(i,o){const u=Un(o[0]-i[0])*this.kx;return Math.atan2(u,(o[1]-i[1])*this.ky)/El}destination(i,o,u){const f=u*El;return this.offset(i,Math.sin(f)*o,Math.cos(f)*o)}offset(i,o,u){return[i[0]+o/this.kx,i[1]+u/this.ky]}lineDistance(i){let o=0;for(let u=0;u<i.length-1;u++)o+=this.distance(i[u],i[u+1]);return o}area(i){let o=0;for(let u=0;u<i.length;u++){const f=i[u];for(let d=0,g=f.length,w=g-1;d<g;w=d++)o+=Un(f[d][0]-f[w][0])*(f[d][1]+f[w][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(i,o){let u=0;if(o<=0)return i[0];for(let f=0;f<i.length-1;f++){const d=i[f],g=i[f+1],w=this.distance(d,g);if(u+=w,u>o)return wc(d,g,(o-(u-w))/w)}return i[i.length-1]}pointToSegmentDistance(i,o,u){let[f,d]=o,g=Un(u[0]-f)*this.kx,w=(u[1]-d)*this.ky;if(g!==0||w!==0){const E=(Un(i[0]-f)*this.kx*g+(i[1]-d)*this.ky*w)/(g*g+w*w);E>1?(f=u[0],d=u[1]):E>0&&(f+=g/this.kx*E,d+=w/this.ky*E)}return g=Un(i[0]-f)*this.kx,w=(i[1]-d)*this.ky,Math.sqrt(g*g+w*w)}pointOnLine(i,o){let u=1/0,f=i[0][0],d=i[0][1],g=0,w=0;for(let E=0;E<i.length-1;E++){let M=i[E][0],x=i[E][1],S=Un(i[E+1][0]-M)*this.kx,P=(i[E+1][1]-x)*this.ky,A=0;S===0&&P===0||(A=(Un(o[0]-M)*this.kx*S+(o[1]-x)*this.ky*P)/(S*S+P*P),A>1?(M=i[E+1][0],x=i[E+1][1]):A>0&&(M+=S/this.kx*A,x+=P/this.ky*A)),S=Un(o[0]-M)*this.kx,P=(o[1]-x)*this.ky;const C=S*S+P*P;C<u&&(u=C,f=M,d=x,g=E,w=A)}return{point:[f,d],index:g,t:Math.max(0,Math.min(1,w))}}lineSlice(i,o,u){let f=this.pointOnLine(u,i),d=this.pointOnLine(u,o);if(f.index>d.index||f.index===d.index&&f.t>d.t){const M=f;f=d,d=M}const g=[f.point],w=f.index+1,E=d.index;!Hp(u[w],g[0])&&w<=E&&g.push(u[w]);for(let M=w+1;M<=E;M++)g.push(u[M]);return Hp(u[E],d.point)||g.push(d.point),g}lineSliceAlong(i,o,u){let f=0;const d=[];for(let g=0;g<u.length-1;g++){const w=u[g],E=u[g+1],M=this.distance(w,E);if(f+=M,f>i&&d.length===0&&d.push(wc(w,E,(i-(f-M))/M)),f>=o)return d.push(wc(w,E,(o-(f-M))/M)),d;f>i&&d.push(E)}return d}bufferPoint(i,o){const u=o/this.ky,f=o/this.kx;return[i[0]-f,i[1]-u,i[0]+f,i[1]+u]}bufferBBox(i,o){const u=o/this.ky,f=o/this.kx;return[i[0]-f,i[1]-u,i[2]+f,i[3]+u]}insideBBox(i,o){return Un(i[0]-o[0])>=0&&Un(i[0]-o[2])<=0&&i[1]>=o[1]&&i[1]<=o[3]}}function Hp(c,i){return c[0]===i[0]&&c[1]===i[1]}function wc(c,i,o){const u=Un(i[0]-c[0]);return[c[0]+u*o,c[1]+(i[1]-c[1])*o]}function Un(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class th{constructor(i=[],o=(u,f)=>u<f?-1:u>f?1:0){if(this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:o,compare:u}=this,f=o[i];for(;i>0;){const d=i-1>>1,g=o[d];if(u(f,g)>=0)break;o[i]=g,i=d}o[i]=f}_down(i){const{data:o,compare:u}=this,f=this.length>>1,d=o[i];for(;i<f;){let g=1+(i<<1);const w=g+1;if(w<this.length&&u(o[w],o[g])<0&&(g=w),u(o[g],d)>=0)break;o[i]=o[g],i=g}o[i]=d}}var St=8192;function Rd(c,i){return i.dist-c.dist}const _a=100,Us=50;function my(c){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==c.length)return!1;for(let o=0;o<i.length;o++)if(i[o]!==c[o])return!1;return!0}function Ld(c){return c[1]-c[0]+1}function ya(c,i){const o=c[1]>=c[0]&&c[1]<i;return o||console.warn("Distance Expression: Index is out of range"),o}function Tc(c,i){if(c[0]>c[1])return[null,null];const o=Ld(c);if(i){if(o===2)return[c,null];const u=Math.floor(o/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}{if(o===1)return[c,null];const u=Math.floor(o/2)-1;return[[c[0],c[0]+u],[c[0]+u+1,c[1]]]}}function Za(c,i){const o=[1/0,1/0,-1/0,-1/0];if(!ya(i,c.length))return o;for(let u=i[0];u<=i[1];++u)Qu(o,c[u]);return o}function Ec(c){const i=[1/0,1/0,-1/0,-1/0];for(let o=0;o<c.length;++o)for(let u=0;u<c[o].length;++u)Qu(i,c[o][u]);return i}function Sc(c,i,o){if(my(c)||my(i))return NaN;let u=0,f=0;return c[2]<i[0]&&(u=i[0]-c[2]),c[0]>i[2]&&(u=c[0]-i[2]),c[1]>i[3]&&(f=c[1]-i[3]),c[3]<i[1]&&(f=i[1]-c[3]),o.distance([0,0],[u,f])}function Y1(c){return 360*c-180}function K1(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Gp(c,i){const o=Math.pow(2,i.z),u=(c.y/St+i.y)/o;return[Y1((c.x/St+i.x)/o),K1(u)]}function gy(c,i){const o=[];for(let u=0;u<c.length;++u)o.push(Gp(c[u],i));return o}function _y(c,i,o){const u=o.pointOnLine(i,c).point;return o.distance(c,u)}function yy(c,i,o,u,f){const d=o.slice(u[0],u[1]+1);let g=1/0;for(let w=i[0];w<=i[1];++w)if((g=Math.min(g,_y(c[w],d,f)))===0)return 0;return g}function Od(c,i,o,u,f){const d=Math.min(f.pointToSegmentDistance(c,o,u),f.pointToSegmentDistance(i,o,u)),g=Math.min(f.pointToSegmentDistance(o,c,i),f.pointToSegmentDistance(u,c,i));return Math.min(d,g)}function J1(c,i,o,u,f){if(!ya(i,c.length)||!ya(u,o.length))return NaN;let d=1/0;for(let g=i[0];g<i[1];++g)for(let w=u[0];w<u[1];++w){if(Pd(c[g],c[g+1],o[w],o[w+1]))return 0;d=Math.min(d,Od(c[g],c[g+1],o[w],o[w+1],f))}return d}function Sl(c,i,o,u,f){if(!ya(i,c.length)||!ya(u,o.length))return NaN;let d=1/0;for(let g=i[0];g<=i[1];++g)for(let w=u[0];w<=u[1];++w)if((d=Math.min(d,f.distance(c[g],o[w])))===0)return d;return d}function Q1(c,i,o){if(wl(c,i,!0))return 0;let u=1/0;for(const f of i){const d=f.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[d-1]&&(u=Math.min(u,o.pointToSegmentDistance(c,f[d-1],f[0])))===0||(u=Math.min(u,_y(c,f,o)))===0)return u}return u}function eb(c,i,o,u){if(!ya(i,c.length))return NaN;for(let d=i[0];d<=i[1];++d)if(wl(c[d],o,!0))return 0;let f=1/0;for(let d=i[0];d<i[1];++d)for(const g of o)for(let w=0,E=g.length,M=E-1;w<E;M=w++){if(Pd(c[d],c[d+1],g[M],g[w]))return 0;f=Math.min(f,Od(c[d],c[d+1],g[M],g[w],u))}return f}function kd(c,i){for(const o of c)for(let u=0;u<=o.length-1;++u)if(wl(o[u],i,!0))return!0;return!1}function vy(c,i,o,u=1/0){const f=Ec(c),d=Ec(i);if(u!==1/0&&Sc(f,d,o)>=u)return u;if(eh(f,d)){if(kd(c,i))return 0}else if(kd(i,c))return 0;let g=u;for(const w of c)for(let E=0,M=w.length,x=M-1;E<M;x=E++)for(const S of i)for(let P=0,A=S.length,C=A-1;P<A;C=P++){if(Pd(w[x],w[E],S[C],S[P]))return 0;g=Math.min(g,Od(w[x],w[E],S[C],S[P],o))}return g}function ih(c,i,o,u,f,d,g){if(d===null||g===null)return;const w=Sc(Za(u,d),Za(f,g),o);w<i&&c.push({dist:w,range1:d,range2:g})}function So(c,i,o,u,f=1/0){let d=Math.min(u.distance(c[0],o[0][0]),f);if(d===0)return d;const g=new th([{dist:0,range1:[0,c.length-1],range2:[0,0]}],Rd),w=i?Us:_a,E=Ec(o);for(;g.length;){const M=g.pop();if(M.dist>=d)continue;const x=M.range1;if(Ld(x)<=w){if(!ya(x,c.length))return NaN;if(i){const S=eb(c,x,o,u);if((d=Math.min(d,S))===0)return d}else for(let S=x[0];S<=x[1];++S){const P=Q1(c[S],o,u);if((d=Math.min(d,P))===0)return d}}else{const S=Tc(x,i);if(S[0]!==null){const P=Sc(Za(c,S[0]),E,u);P<d&&g.push({dist:P,range1:S[0],range2:[0,0]})}if(S[1]!==null){const P=Sc(Za(c,S[1]),E,u);P<d&&g.push({dist:P,range1:S[1],range2:[0,0]})}}}return d}function qp(c,i,o,u,f,d=1/0){let g=Math.min(d,f.distance(c[0],o[0]));if(g===0)return g;const w=new th([{dist:0,range1:[0,c.length-1],range2:[0,o.length-1]}],Rd),E=i?Us:_a,M=u?Us:_a;for(;w.length;){const x=w.pop();if(x.dist>=g)continue;const S=x.range1,P=x.range2;if(Ld(S)<=E&&Ld(P)<=M){if(!ya(S,c.length)||!ya(P,o.length))return NaN;if(i&&u?g=Math.min(g,J1(c,S,o,P,f)):i||u?i&&!u?g=Math.min(g,yy(o,P,c,S,f)):!i&&u&&(g=Math.min(g,yy(c,S,o,P,f))):g=Math.min(g,Sl(c,S,o,P,f)),g===0)return g}else{const A=Tc(S,i),C=Tc(P,u);ih(w,g,f,c,o,A[0],C[0]),ih(w,g,f,c,o,A[0],C[1]),ih(w,g,f,c,o,A[1],C[0]),ih(w,g,f,c,o,A[1],C[1])}}return g}function zd(c,i,o,u,f=1/0){let d=f;const g=Za(c,[0,c.length-1]);for(const w of o)if(!(d!==1/0&&Sc(g,Za(w,[0,w.length-1]),u)>=d)&&(d=Math.min(d,qp(c,i,w,!0,u,d)),d===0))return d;return d}function nh(c,i,o,u,f=1/0){let d=f;const g=Za(c,[0,c.length-1]);for(const w of o){if(d!==1/0&&Sc(g,Ec(w),u)>=d)continue;const E=So(c,i,w,u,d);if(isNaN(E))return E;if((d=Math.min(d,E))===0)return d}return d}function Fd(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Xa{constructor(i,o){this.type=Gt,this.geojson=i,this.geometries=o}static parse(i,o){if(i.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(Eo(i[1])){const u=i[1];if(u.type==="FeatureCollection"){for(let f=0;f<u.features.length;++f)if(Fd(u.features[f].geometry.type))return new Xa(u,u.features[f].geometry)}else if(u.type==="Feature"){if(Fd(u.geometry.type))return new Xa(u,u.geometry)}else if(Fd(u.type))return new Xa(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const o=i.geometry(),u=i.canonicalID();if(o!=null&&u!=null){if(i.geometryType()==="Point")return function(f,d,g){const w=[];for(const M of f)for(const x of M)w.push(Gp(x,d));const E=new bc(w[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?qp(w,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",E):g.type==="MultiLineString"?zd(w,!1,g.coordinates,E):g.type==="Polygon"||g.type==="MultiPolygon"?nh(w,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,E):null}(o,u,this.geometries);if(i.geometryType()==="LineString")return function(f,d,g){const w=[];for(const M of f){const x=[];for(const S of M)x.push(Gp(S,d));w.push(x)}const E=new bc(w[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return zd(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,E);if(g.type==="MultiLineString"){let M=1/0;for(let x=0;x<g.coordinates.length;x++){const S=zd(g.coordinates[x],!0,w,E,M);if(isNaN(S))return S;if((M=Math.min(M,S))===0)return M}return M}if(g.type==="Polygon"||g.type==="MultiPolygon"){let M=1/0;for(let x=0;x<w.length;x++){const S=nh(w[x],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,E,M);if(isNaN(S))return S;if((M=Math.min(M,S))===0)return M}return M}return null}(o,u,this.geometries);if(i.geometryType()==="Polygon")return function(f,d,g){const w=[];for(const M of function(x,S){const P=x.length;if(P<=1)return[x];const A=[];let C,R;for(let B=0;B<P;B++){const N=G1(x[B]);N!==0&&(x[B].area=Math.abs(N),R===void 0&&(R=N<0),R===N<0?(C&&A.push(C),C=[x[B]]):C.push(x[B]))}return C&&A.push(C),A}(f)){const x=[];for(let S=0;S<M.length;++S)x.push(gy(M[S],d));w.push(x)}const E=new bc(w[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return nh(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,E);if(g.type==="MultiLineString"){let M=1/0;for(let x=0;x<g.coordinates.length;x++){const S=nh(g.coordinates[x],!0,w,E,M);if(isNaN(S))return S;if((M=Math.min(M,S))===0)return M}return M}return g.type==="Polygon"||g.type==="MultiPolygon"?function(M,x,S){let P=1/0;for(const A of M)for(const C of x){const R=vy(A,C,S,P);if(isNaN(R))return R;if((P=Math.min(P,R))===0)return P}return P}(g.type==="Polygon"?[g.coordinates]:g.coordinates,w,E):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Bd(c,i){switch(c){case"string":return As(i);case"number":return+i;case"boolean":return!!i;case"color":return Qi.parse(i);case"formatted":return Ys.fromString(As(i));case"resolvedImage":return Ks.build(As(i))}return i}function Wp(c,i,o,u){return u!==void 0&&(c=u*Math.round(c/u)),i!==void 0&&c<i&&(c=i),o!==void 0&&c>o&&(c=o),c}class Al{constructor(i,o,u){this.type=i,this.key=o,this.scope=u}static parse(i,o){let u=o.expectedType;if(u==null&&(u=Hi),i.length<2||i.length>3)return o.error("Invalid number of arguments for 'config' expression.");const f=o.parse(i[1],1);if(!(f instanceof fa))return o.error("Key name of 'config' expression must be a string literal.");if(i.length>=3){const d=o.parse(i[2],2);return d instanceof fa?new Al(u,As(f.value),As(d.value)):o.error("Scope of 'config' expression must be a string literal.")}return new Al(u,As(f.value))}evaluate(i){const o=[this.key,this.scope,i.scope].filter(Boolean).join(""),u=i.getConfig(o);if(!u)return null;const{type:f,value:d,values:g,minValue:w,maxValue:E,stepValue:M}=u,x=u.default.evaluate(i);let S=x;if(d){const P=i.scope;i.scope=(P||"").split("").slice(1).join(""),S=d.evaluate(i),i.scope=P}return f&&(S=Bd(f,S)),S===void 0||w===void 0&&E===void 0&&M===void 0||(typeof S=="number"?S=Wp(S,w,E,M):Array.isArray(S)&&(S=S.map(P=>typeof P=="number"?Wp(P,w,E,M):P))),d!==void 0&&S!==void 0&&g&&!g.includes(S)&&(S=x,f&&(S=Bd(f,S))),(f&&f!==this.type||S!==void 0&&ns(S)!==this.type)&&(S=Bd(this.type.kind,S)),S}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.key),i}}function Ac(c){if(c instanceof lr&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof ga||c instanceof Xa)return!1;let i=!0;return c.eachChild(o=>{i&&!Ac(o)&&(i=!1)}),i}function sh(c){if(c instanceof lr&&c.name==="feature-state")return!1;let i=!0;return c.eachChild(o=>{i&&!sh(o)&&(i=!1)}),i}function rh(c){if(c instanceof Al)return new Set([c.key]);let i=new Set;return c.eachChild(o=>{i=new Set([...i,...rh(o)])}),i}function va(c,i){if(c instanceof lr&&i.indexOf(c.name)>=0)return!1;let o=!0;return c.eachChild(u=>{o&&!va(u,i)&&(o=!1)}),o}class Ml{constructor(i,o){this.type=o.type,this.name=i,this.boundExpression=o}static parse(i,o){if(i.length!==2||typeof i[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=i[1];return o.scope.has(u)?new Ml(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Mc{constructor(i,o=[],u,f=new Md,d=[],g,w){this.registry=i,this.path=o,this.key=o.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=f,this.errors=d,this.expectedType=u,this._scope=g,this.options=w}parse(i,o,u,f,d={}){return o||u?this.concat(o,null,u,f)._parse(i,d):this._parse(i,d)}parseObjectValue(i,o,u,f,d,g={}){return this.concat(o,u,f,d)._parse(i,g)}_parse(i,o){function u(f,d,g){return g==="assert"?new Ur(d,[f]):g==="coerce"?new ma(d,[f]):f}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(f){let d=f.parse(i,this);if(!d)return null;if(this.expectedType){const g=this.expectedType,w=d.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||w.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(g,w))return null}else d=u(d,g,o.typeAnnotation||"coerce");else d=u(d,g,o.typeAnnotation||"assert")}if(!(d instanceof fa)&&d.type.kind!=="resolvedImage"&&Nd(d)){const g=new Cd(this._scope,this.options);try{d=new fa(d.type,d.evaluate(g))}catch(w){return this.error(w.message),null}}return d}return ma.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,o,u,f){let d=typeof i=="number"?this.path.concat(i):this.path;d=typeof o=="string"?d.concat(o):d;const g=f?this.scope.concat(f):this.scope;return new Mc(this.registry,d,u||null,g,this.errors,this._scope,this.options)}error(i,...o){const u=`${this.key}${o.map(f=>`[${f}]`).join("")}`;this.errors.push(new so(u,i))}checkSubtype(i,o){const u=_c(i,o);return u&&this.error(u),u}}var Zp=Mc;function Nd(c){if(c instanceof Ml)return Nd(c.boundExpression);if(c instanceof lr&&c.name==="error"||c instanceof bl||c instanceof ga||c instanceof Xa||c instanceof Al)return!1;const i=c instanceof ma||c instanceof Ur;let o=!0;return c.eachChild(u=>{o=i?o&&Nd(u):o&&u instanceof fa}),!!o&&Ac(c)&&va(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function oh(c,i){const o=c.length-1;let u,f,d=0,g=o,w=0;for(;d<=g;)if(w=Math.floor((d+g)/2),u=c[w],f=c[w+1],u<=i){if(w===o||i<f)return w;d=w+1}else{if(!(u>i))throw new Zn("Input is not a number.");g=w-1}return 0}class Go{constructor(i,o,u){this.type=i,this.input=o,this.labels=[],this.outputs=[];for(const[f,d]of u)this.labels.push(f),this.outputs.push(d)}static parse(i,o){if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(i[1],1,Gt);if(!u)return null;const f=[];let d=null;o.expectedType&&o.expectedType.kind!=="value"&&(d=o.expectedType);for(let g=1;g<i.length;g+=2){const w=g===1?-1/0:i[g],E=i[g+1],M=g,x=g+1;if(typeof w!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=w)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const S=o.parse(E,x,d);if(!S)return null;d=d||S.type,f.push([w,S])}return new Go(d,u,f)}evaluate(i){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(i);const f=this.input.evaluate(i);if(f<=o[0])return u[0].evaluate(i);const d=o.length;return f>=o[d-1]?u[d-1].evaluate(i):u[oh(o,f)].evaluate(i)}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&i.push(this.labels[o]),i.push(this.outputs[o].serialize());return i}}const Ri=.95047,xy=1.08883,by=4/29,Ic=6/29,Xp=3*Ic*Ic,tb=Ic*Ic*Ic,An=Math.PI/180,ib=180/Math.PI;function Yp(c){return c>tb?Math.pow(c,1/3):c/Xp+by}function Kp(c){return c>Ic?c*c*c:Xp*(c-by)}function Jp(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Qp(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function wy(c){const i=Qp(c.r),o=Qp(c.g),u=Qp(c.b),f=Yp((.4124564*i+.3575761*o+.1804375*u)/Ri),d=Yp((.2126729*i+.7151522*o+.072175*u)/1);return{l:116*d-16,a:500*(f-d),b:200*(d-Yp((.0193339*i+.119192*o+.9503041*u)/xy)),alpha:c.a}}function Ty(c){let i=(c.l+16)/116,o=isNaN(c.a)?i:i+c.a/500,u=isNaN(c.b)?i:i-c.b/200;return i=1*Kp(i),o=Ri*Kp(o),u=xy*Kp(u),new Qi(Jp(3.2404542*o-1.5371385*i-.4985314*u),Jp(-.969266*o+1.8760108*i+.041556*u),Jp(.0556434*o-.2040259*i+1.0572252*u),c.alpha)}function nb(c,i,o){const u=i-c;return c+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const ah={forward:wy,reverse:Ty,interpolate:function(c,i,o){return{l:ni(c.l,i.l,o),a:ni(c.a,i.a,o),b:ni(c.b,i.b,o),alpha:ni(c.alpha,i.alpha,o)}}},lh={forward:function(c){const{l:i,a:o,b:u}=wy(c),f=Math.atan2(u,o)*ib;return{h:f<0?f+360:f,c:Math.sqrt(o*o+u*u),l:i,alpha:c.a}},reverse:function(c){const i=c.h*An,o=c.c;return Ty({l:c.l,a:Math.cos(i)*o,b:Math.sin(i)*o,alpha:c.alpha})},interpolate:function(c,i,o){return{h:nb(c.h,i.h,o),c:ni(c.c,i.c,o),l:ni(c.l,i.l,o),alpha:ni(c.alpha,i.alpha,o)}}};var Ey=Object.freeze({__proto__:null,hcl:lh,lab:ah});class jr{constructor(i,o,u,f,d){this.type=i,this.operator=o,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[g,w]of d)this.labels.push(g),this.outputs.push(w)}static interpolationFactor(i,o,u,f){let d=0;if(i.name==="exponential")d=em(o,i.base,u,f);else if(i.name==="linear")d=em(o,1,u,f);else if(i.name==="cubic-bezier"){const g=i.controlPoints;d=new vr(g[0],g[1],g[2],g[3]).solve(em(o,1,u,f))}return d}static parse(i,o){let[u,f,d,...g]=i;if(!Array.isArray(f)||f.length===0)return o.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const M=f[1];if(typeof M!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:M}}else{if(f[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const M=f.slice(1);if(M.length!==4||M.some(x=>typeof x!="number"||x<0||x>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:M}}}if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(d=o.parse(d,2,Gt),!d)return null;const w=[];let E=null;u==="interpolate-hcl"||u==="interpolate-lab"?E=Xs:o.expectedType&&o.expectedType.kind!=="value"&&(E=o.expectedType);for(let M=0;M<g.length;M+=2){const x=g[M],S=g[M+1],P=M+3,A=M+4;if(typeof x!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(w.length&&w[w.length-1][0]>=x)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const C=o.parse(S,A,E);if(!C)return null;E=E||C.type,w.push([x,C])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new jr(E,u,f,d,w):o.error(`Type ${qn(E)} is not interpolatable.`)}evaluate(i){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(i);const f=this.input.evaluate(i);if(f<=o[0])return u[0].evaluate(i);const d=o.length;if(f>=o[d-1])return u[d-1].evaluate(i);const g=oh(o,f),w=jr.interpolationFactor(this.interpolation,f,o[g],o[g+1]),E=u[g].evaluate(i),M=u[g+1].evaluate(i);return this.operator==="interpolate"?Zu[this.type.kind.toLowerCase()](E,M,w):this.operator==="interpolate-hcl"?lh.reverse(lh.interpolate(lh.forward(E),lh.forward(M),w)):ah.reverse(ah.interpolate(ah.forward(E),ah.forward(M),w))}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const o=[this.operator,i,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function em(c,i,o,u){const f=u-o,d=c-o;return f===0?0:i===1?d/f:(Math.pow(i,d)-1)/(Math.pow(i,f)-1)}class Vd{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expectected at least one argument.");let u=null;const f=o.expectedType;f&&f.kind!=="value"&&(u=f);const d=[];for(const w of i.slice(1)){const E=o.parse(w,1+d.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,d.push(E)}const g=f&&d.some(w=>_c(f,w.type));return new Vd(g?Hi:u,d)}evaluate(i){let o,u=null,f=0;for(const d of this.args){if(f++,u=d.evaluate(i),u&&u instanceof Ks&&!u.available&&(o||(o=u),u=null,f===this.args.length))return o;if(u!==null)break}return u}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(o=>{i.push(o.serialize())}),i}}class Ud{constructor(i,o){this.type=o.type,this.bindings=[].concat(i),this.result=o}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const o of this.bindings)i(o[1]);i(this.result)}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const u=[];for(let d=1;d<i.length-1;d+=2){const g=i[d];if(typeof g!="string")return o.error(`Expected string, but found ${typeof g} instead.`,d);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",d);const w=o.parse(i[d+1],d+1);if(!w)return null;u.push([g,w])}const f=o.parse(i[i.length-1],i.length-1,o.expectedType,u);return f?new Ud(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[o,u]of this.bindings)i.push(o,u.serialize());return i.push(this.result.serialize()),i}}class tm{constructor(i,o,u){this.type=i,this.index=o,this.input=u}static parse(i,o){if(i.length!==3)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=o.parse(i[1],1,Gt),f=o.parse(i[2],2,Vs(o.expectedType||Hi));return u&&f?new tm(f.type.itemType,u,f):null}evaluate(i){const o=this.index.evaluate(i),u=this.input.evaluate(i);if(o<0)throw new Zn(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new Zn(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new Zn(`Array index must be an integer, but found ${o} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[o]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class im{constructor(i,o,u){this.type=i,this.index=o,this.input=u}static parse(i,o){if(i.length!==3)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=o.parse(i[1],1,Gt),f=o.parse(i[2],2,Vs(o.expectedType||Hi));return u&&f?new im(f.type.itemType,u,f):null}evaluate(i){const o=this.index.evaluate(i),u=this.input.evaluate(i);if(o<0)throw new Zn(`Array index out of bounds: ${o} < 0.`);if(o>u.length-1)throw new Zn(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o===Math.floor(o))return u[o];const f=Math.floor(o),d=Math.ceil(o),g=u[f],w=u[d];if(typeof g!="number"||typeof w!="number")throw new Zn(`Cannot interpolate between non-number values at index ${o}.`);const E=o-f;return g*(1-E)+w*E}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class nm{constructor(i,o){this.type=Ni,this.needle=i,this.haystack=o}static parse(i,o){if(i.length!==3)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=o.parse(i[1],1,Hi),f=o.parse(i[2],2,Hi);return u&&f?Vp(u.type,[Ni,Yi,Gt,mc,Hi])?new nm(u,f):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${qn(u.type)} instead`):null}evaluate(i){const o=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(u==null)return!1;if(!yc(o,["boolean","string","number","null"]))throw new Zn(`Expected first argument to be of type boolean, string, number or null, but found ${qn(ns(o))} instead.`);if(!yc(u,["string","array"]))throw new Zn(`Expected second argument to be of type array or string, but found ${qn(ns(u))} instead.`);return u.indexOf(o)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class jd{constructor(i,o,u){this.type=Gt,this.needle=i,this.haystack=o,this.fromIndex=u}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=o.parse(i[1],1,Hi),f=o.parse(i[2],2,Hi);if(!u||!f)return null;if(!Vp(u.type,[Ni,Yi,Gt,mc,Hi]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${qn(u.type)} instead`);if(i.length===4){const d=o.parse(i[3],3,Gt);return d?new jd(u,f,d):null}return new jd(u,f)}evaluate(i){const o=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!yc(o,["boolean","string","number","null"]))throw new Zn(`Expected first argument to be of type boolean, string, number or null, but found ${qn(ns(o))} instead.`);if(!yc(u,["string","array"]))throw new Zn(`Expected second argument to be of type array or string, but found ${qn(ns(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(i);return u.indexOf(o,f)}return u.indexOf(o)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class sm{constructor(i,o,u,f,d,g){this.inputType=i,this.type=o,this.input=u,this.cases=f,this.outputs=d,this.otherwise=g}static parse(i,o){if(i.length<5)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return o.error("Expected an even number of arguments.");let u,f;o.expectedType&&o.expectedType.kind!=="value"&&(f=o.expectedType);const d={},g=[];for(let M=2;M<i.length-1;M+=2){let x=i[M];const S=i[M+1];Array.isArray(x)||(x=[x]);const P=o.concat(M);if(x.length===0)return P.error("Expected at least one branch label.");for(const C of x){if(typeof C!="number"&&typeof C!="string")return P.error("Branch labels must be numbers or strings.");if(typeof C=="number"&&Math.abs(C)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof C=="number"&&Math.floor(C)!==C)return P.error("Numeric branch labels must be integer values.");if(u){if(P.checkSubtype(u,ns(C)))return null}else u=ns(C);if(d[String(C)]!==void 0)return P.error("Branch labels must be unique.");d[String(C)]=g.length}const A=o.parse(S,M,f);if(!A)return null;f=f||A.type,g.push(A)}const w=o.parse(i[1],1,Hi);if(!w)return null;const E=o.parse(i[i.length-1],i.length-1,f);return E?w.type.kind!=="value"&&o.concat(1).checkSubtype(u,w.type)?null:new sm(u,f,w,d,g,E):null}evaluate(i){const o=this.input.evaluate(i);return(ns(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],f={};for(const g of o){const w=f[this.cases[g]];w===void 0?(f[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[w][1].push(g)}const d=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,w]of u)i.push(w.length===1?d(w[0]):w.map(d)),i.push(this.outputs[g].serialize());return i.push(this.otherwise.serialize()),i}}class rm{constructor(i,o,u){this.type=i,this.branches=o,this.otherwise=u}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const f=[];for(let g=1;g<i.length-1;g+=2){const w=o.parse(i[g],g,Ni);if(!w)return null;const E=o.parse(i[g+1],g+1,u);if(!E)return null;f.push([w,E]),u=u||E.type}const d=o.parse(i[i.length-1],i.length-1,u);return d?new rm(u,f,d):null}evaluate(i){for(const[o,u]of this.branches)if(o.evaluate(i))return u.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[o,u]of this.branches)i(o),i(u);i(this.otherwise)}outputDefined(){return this.branches.every(([i,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(o=>{i.push(o.serialize())}),i}}class $d{constructor(i,o,u,f){this.type=i,this.input=o,this.beginIndex=u,this.endIndex=f}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=o.parse(i[1],1,Hi),f=o.parse(i[2],2,Gt);if(!u||!f)return null;if(!Vp(u.type,[Vs(Hi),Yi,Hi]))return o.error(`Expected first argument to be of type array or string, but found ${qn(u.type)} instead`);if(i.length===4){const d=o.parse(i[3],3,Gt);return d?new $d(u.type,u,f,d):null}return new $d(u.type,u,f)}evaluate(i){const o=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!yc(o,["string","array"]))throw new Zn(`Expected first argument to be of type array or string, but found ${qn(ns(o))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(i);return o.slice(u,f)}return o.slice(u)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Sy(c,i){return c==="=="||c==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Ay(c,i,o,u){return u.compare(i,o)===0}function Cc(c,i,o){const u=c!=="=="&&c!=="!=";return class Zz{constructor(d,g,w){this.type=Ni,this.lhs=d,this.rhs=g,this.collator=w,this.hasUntypedArgument=d.type.kind==="value"||g.type.kind==="value"}static parse(d,g){if(d.length!==3&&d.length!==4)return g.error("Expected two or three arguments.");const w=d[0];let E=g.parse(d[1],1,Hi);if(!E)return null;if(!Sy(w,E.type))return g.concat(1).error(`"${w}" comparisons are not supported for type '${qn(E.type)}'.`);let M=g.parse(d[2],2,Hi);if(!M)return null;if(!Sy(w,M.type))return g.concat(2).error(`"${w}" comparisons are not supported for type '${qn(M.type)}'.`);if(E.type.kind!==M.type.kind&&E.type.kind!=="value"&&M.type.kind!=="value")return g.error(`Cannot compare types '${qn(E.type)}' and '${qn(M.type)}'.`);u&&(E.type.kind==="value"&&M.type.kind!=="value"?E=new Ur(M.type,[E]):E.type.kind!=="value"&&M.type.kind==="value"&&(M=new Ur(E.type,[M])));let x=null;if(d.length===4){if(E.type.kind!=="string"&&M.type.kind!=="string"&&E.type.kind!=="value"&&M.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(x=g.parse(d[3],3,ha),!x)return null}return new Zz(E,M,x)}evaluate(d){const g=this.lhs.evaluate(d),w=this.rhs.evaluate(d);if(u&&this.hasUntypedArgument){const E=ns(g),M=ns(w);if(E.kind!==M.kind||E.kind!=="string"&&E.kind!=="number")throw new Zn(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${E.kind}, ${M.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=ns(g),M=ns(w);if(E.kind!=="string"||M.kind!=="string")return i(d,g,w)}return this.collator?o(d,g,w,this.collator.evaluate(d)):i(d,g,w)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[c];return this.eachChild(g=>{d.push(g.serialize())}),d}}}const sb=Cc("==",function(c,i,o){return i===o},Ay),rb=Cc("!=",function(c,i,o){return i!==o},function(c,i,o,u){return!Ay(0,i,o,u)}),ob=Cc("<",function(c,i,o){return i<o},function(c,i,o,u){return u.compare(i,o)<0}),ab=Cc(">",function(c,i,o){return i>o},function(c,i,o,u){return u.compare(i,o)>0}),lb=Cc("<=",function(c,i,o){return i<=o},function(c,i,o,u){return u.compare(i,o)<=0}),cb=Cc(">=",function(c,i,o){return i>=o},function(c,i,o,u){return u.compare(i,o)>=0});class ch{constructor(i,o,u,f,d,g){this.type=Yi,this.number=i,this.locale=o,this.currency=u,this.unit=f,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(i,o){if(i.length!==3)return o.error("Expected two arguments.");const u=o.parse(i[1],1,Gt);if(!u)return null;const f=i[2];if(typeof f!="object"||Array.isArray(f))return o.error("NumberFormat options argument must be an object.");let d=null;if(f.locale&&(d=o.parseObjectValue(f.locale,2,"locale",Yi),!d))return null;let g=null;if(f.currency&&(g=o.parseObjectValue(f.currency,2,"currency",Yi),!g))return null;let w=null;if(f.unit&&(w=o.parseObjectValue(f.unit,2,"unit",Yi),!w))return null;let E=null;if(f["min-fraction-digits"]&&(E=o.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",Gt),!E))return null;let M=null;return f["max-fraction-digits"]&&(M=o.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",Gt),!M)?null:new ch(u,d,g,w,E,M)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class om{constructor(i){this.type=Gt,this.input=i}static parse(i,o){if(i.length!==2)return o.error(`Expected 1 argument, but found ${i.length-1} instead.`);const u=o.parse(i[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${qn(u.type)} instead.`):new om(u):null}evaluate(i){const o=this.input.evaluate(i);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Zn(`Expected value to be of type string or array, but found ${qn(ns(o))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(o=>{i.push(o.serialize())}),i}}function am(c){return function(){c=1831565813+(c|=0)|0;let i=Math.imul(c^c>>>15,1|c);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const Pc={"==":sb,"!=":rb,">":ab,"<":ob,">=":cb,"<=":lb,array:Ur,at:tm,"at-interpolated":im,boolean:Ur,case:rm,coalesce:Vd,collator:bl,format:vc,image:Ga,in:nm,"index-of":jd,interpolate:jr,"interpolate-hcl":jr,"interpolate-lab":jr,length:om,let:Ud,literal:fa,match:sm,number:Ur,"number-format":ch,object:Ur,slice:$d,step:Go,string:Ur,"to-boolean":ma,"to-color":ma,"to-number":ma,"to-string":ma,var:Ml,within:ga,distance:Xa,config:Al};function My(c,[i,o,u,f]){i=i.evaluate(c),o=o.evaluate(c),u=u.evaluate(c);const d=f?f.evaluate(c):1,g=Ku(i,o,u,d);if(g)throw new Zn(g);return new Qi(i/255*d,o/255*d,u/255*d,d)}function Iy(c,[i,o,u,f]){i=i.evaluate(c),o=o.evaluate(c),u=u.evaluate(c);const d=f?f.evaluate(c):1,g=function(M,x,S,P){return typeof M=="number"&&M>=0&&M<=360?typeof x=="number"&&x>=0&&x<=100&&typeof S=="number"&&S>=0&&S<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[M,x,S,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[M,x,S,P]:[M,x,S]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[M,x,S,P]:[M,x,S]).join(", ")}]: 'h' must be between 0 and 360.`}(i,o,u,d);if(g)throw new Zn(g);const w=`hsla(${i}, ${o}%, ${u}%, ${d})`,E=Qi.parse(w);if(!E)throw new Zn(`Failed to parse HSLA color: ${w}`);return E}function lm(c,i){return c in i}function Hd(c,i){const o=i[c];return o===void 0?null:o}function ro(c){return{type:c}}function cm(c){return{result:"success",value:c}}function xa(c){return{result:"error",value:c}}function um(c,i){return!!c&&!!c.parameters&&c.parameters.indexOf(i)>-1}function Dc(c){return c["property-type"]==="data-driven"}function Gd(c){return um(c.expression,"measure-light")}function Cy(c){return um(c.expression,"zoom")}function hm(c){return!!c.expression&&c.expression.interpolated}function qd(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Py(c){return c}function Dy(c,i){const o=i.type==="color",u=c.stops&&typeof c.stops[0][0]=="object",f=u||!(u||c.property!==void 0),d=c.type||(hm(i)?"exponential":"interval");if(o&&((c=$i({},c)).stops&&(c.stops=c.stops.map(M=>[M[0],Qi.parse(M[1])])),c.default=Qi.parse(c.default?c.default:i.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!Ey[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let g,w,E;if(d==="exponential")g=dm;else if(d==="interval")g=Ry;else if(d==="categorical"){g=ub,w=Object.create(null);for(const M of c.stops)w[M[0]]=M[1];E=typeof c.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);g=Wd}if(u){const M={},x=[];for(let A=0;A<c.stops.length;A++){const C=c.stops[A],R=C[0].zoom;M[R]===void 0&&(M[R]={zoom:R,type:c.type,property:c.property,default:c.default,stops:[]},x.push(R)),M[R].stops.push([C[0].value,C[1]])}const S=[];for(const A of x)S.push([M[A].zoom,Dy(M[A],i)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:jr.interpolationFactor.bind(void 0,P),zoomStops:S.map(A=>A[0]),evaluate:({zoom:A},C)=>dm({stops:S,base:c.base},i,A).evaluate(A,C)}}if(f){const M=d==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:jr.interpolationFactor.bind(void 0,M),zoomStops:c.stops.map(x=>x[0]),evaluate:({zoom:x})=>g(c,i,x,w,E)}}return{kind:"source",evaluate(M,x){const S=x&&x.properties?x.properties[c.property]:void 0;return S===void 0?uh(c.default,i.default):g(c,i,S,w,E)}}}function uh(c,i,o){return c!==void 0?c:i!==void 0?i:o!==void 0?o:void 0}function ub(c,i,o,u,f){return uh(typeof o===f?u[o]:void 0,c.default,i.default)}function Ry(c,i,o){if(pa(o)!=="number")return uh(c.default,i.default);const u=c.stops.length;if(u===1||o<=c.stops[0][0])return c.stops[0][1];if(o>=c.stops[u-1][0])return c.stops[u-1][1];const f=oh(c.stops.map(d=>d[0]),o);return c.stops[f][1]}function dm(c,i,o){const u=c.base!==void 0?c.base:1;if(pa(o)!=="number")return uh(c.default,i.default);const f=c.stops.length;if(f===1||o<=c.stops[0][0])return c.stops[0][1];if(o>=c.stops[f-1][0])return c.stops[f-1][1];const d=oh(c.stops.map(x=>x[0]),o),g=function(x,S,P,A){const C=A-P,R=x-P;return C===0?0:S===1?R/C:(Math.pow(S,R)-1)/(Math.pow(S,C)-1)}(o,u,c.stops[d][0],c.stops[d+1][0]),w=c.stops[d][1],E=c.stops[d+1][1];let M=Zu[i.type]||Py;if(c.colorSpace&&c.colorSpace!=="rgb"){const x=Ey[c.colorSpace];M=(S,P)=>x.reverse(x.interpolate(x.forward(S),x.forward(P),g))}return typeof w.evaluate=="function"?{evaluate(...x){const S=w.evaluate.apply(void 0,x),P=E.evaluate.apply(void 0,x);if(S!==void 0&&P!==void 0)return M(S,P,g)}}:M(w,E,g)}function Wd(c,i,o){return i.type==="color"?o=Qi.parse(o):i.type==="formatted"?o=Ys.fromString(o.toString()):i.type==="resolvedImage"?o=Ks.build(o.toString()):pa(o)===i.type||i.type==="enum"&&i.values[o]||(o=void 0),uh(o,c.default,i.default)}lr.register(Pc,{error:[{kind:"error"},[Yi],(c,[i])=>{throw new Zn(i.evaluate(c))}],typeof:[Yi,[Hi],(c,[i])=>qn(ns(i.evaluate(c)))],"to-rgba":[Vs(Gt,4),[Xs],(c,[i])=>i.evaluate(c).toRenderColor(null).toArray()],"to-hsla":[Vs(Gt,4),[Xs],(c,[i])=>i.evaluate(c).toRenderColor(null).toHslaArray()],rgb:[Xs,[Gt,Gt,Gt],My],rgba:[Xs,[Gt,Gt,Gt,Gt],My],hsl:[Xs,[Gt,Gt,Gt],Iy],hsla:[Xs,[Gt,Gt,Gt,Gt],Iy],has:{type:Ni,overloads:[[[Yi],(c,[i])=>lm(i.evaluate(c),c.properties())],[[Yi,gc],(c,[i,o])=>lm(i.evaluate(c),o.evaluate(c))]]},get:{type:Hi,overloads:[[[Yi],(c,[i])=>Hd(i.evaluate(c),c.properties())],[[Yi,gc],(c,[i,o])=>Hd(i.evaluate(c),o.evaluate(c))]]},"feature-state":[Hi,[Yi],(c,[i])=>Hd(i.evaluate(c),c.featureState||{})],properties:[gc,[],c=>c.properties()],"geometry-type":[Yi,[],c=>c.geometryType()],id:[Hi,[],c=>c.id()],zoom:[Gt,[],c=>c.globals.zoom],pitch:[Gt,[],c=>c.globals.pitch||0],"distance-from-center":[Gt,[],c=>c.distanceFromCenter()],"measure-light":[Gt,[Yi],(c,[i])=>c.measureLight(i.evaluate(c))],"heatmap-density":[Gt,[],c=>c.globals.heatmapDensity||0],"line-progress":[Gt,[],c=>c.globals.lineProgress||0],"raster-value":[Gt,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[Gt,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[Gt,[],c=>c.globals.skyRadialProgress||0],accumulated:[Hi,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Gt,ro(Gt),(c,i)=>{let o=0;for(const u of i)o+=u.evaluate(c);return o}],"*":[Gt,ro(Gt),(c,i)=>{let o=1;for(const u of i)o*=u.evaluate(c);return o}],"-":{type:Gt,overloads:[[[Gt,Gt],(c,[i,o])=>i.evaluate(c)-o.evaluate(c)],[[Gt],(c,[i])=>-i.evaluate(c)]]},"/":[Gt,[Gt,Gt],(c,[i,o])=>i.evaluate(c)/o.evaluate(c)],"%":[Gt,[Gt,Gt],(c,[i,o])=>i.evaluate(c)%o.evaluate(c)],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(c,[i,o])=>Math.pow(i.evaluate(c),o.evaluate(c))],sqrt:[Gt,[Gt],(c,[i])=>Math.sqrt(i.evaluate(c))],log10:[Gt,[Gt],(c,[i])=>Math.log(i.evaluate(c))/Math.LN10],ln:[Gt,[Gt],(c,[i])=>Math.log(i.evaluate(c))],log2:[Gt,[Gt],(c,[i])=>Math.log(i.evaluate(c))/Math.LN2],sin:[Gt,[Gt],(c,[i])=>Math.sin(i.evaluate(c))],cos:[Gt,[Gt],(c,[i])=>Math.cos(i.evaluate(c))],tan:[Gt,[Gt],(c,[i])=>Math.tan(i.evaluate(c))],asin:[Gt,[Gt],(c,[i])=>Math.asin(i.evaluate(c))],acos:[Gt,[Gt],(c,[i])=>Math.acos(i.evaluate(c))],atan:[Gt,[Gt],(c,[i])=>Math.atan(i.evaluate(c))],min:[Gt,ro(Gt),(c,i)=>Math.min(...i.map(o=>o.evaluate(c)))],max:[Gt,ro(Gt),(c,i)=>Math.max(...i.map(o=>o.evaluate(c)))],abs:[Gt,[Gt],(c,[i])=>Math.abs(i.evaluate(c))],round:[Gt,[Gt],(c,[i])=>{const o=i.evaluate(c);return o<0?-Math.round(-o):Math.round(o)}],floor:[Gt,[Gt],(c,[i])=>Math.floor(i.evaluate(c))],ceil:[Gt,[Gt],(c,[i])=>Math.ceil(i.evaluate(c))],"filter-==":[Ni,[Yi,Hi],(c,[i,o])=>c.properties()[i.value]===o.value],"filter-id-==":[Ni,[Hi],(c,[i])=>c.id()===i.value],"filter-type-==":[Ni,[Yi],(c,[i])=>c.geometryType()===i.value],"filter-<":[Ni,[Yi,Hi],(c,[i,o])=>{const u=c.properties()[i.value],f=o.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Ni,[Hi],(c,[i])=>{const o=c.id(),u=i.value;return typeof o==typeof u&&o<u}],"filter->":[Ni,[Yi,Hi],(c,[i,o])=>{const u=c.properties()[i.value],f=o.value;return typeof u==typeof f&&u>f}],"filter-id->":[Ni,[Hi],(c,[i])=>{const o=c.id(),u=i.value;return typeof o==typeof u&&o>u}],"filter-<=":[Ni,[Yi,Hi],(c,[i,o])=>{const u=c.properties()[i.value],f=o.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Ni,[Hi],(c,[i])=>{const o=c.id(),u=i.value;return typeof o==typeof u&&o<=u}],"filter->=":[Ni,[Yi,Hi],(c,[i,o])=>{const u=c.properties()[i.value],f=o.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Ni,[Hi],(c,[i])=>{const o=c.id(),u=i.value;return typeof o==typeof u&&o>=u}],"filter-has":[Ni,[Hi],(c,[i])=>i.value in c.properties()],"filter-has-id":[Ni,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Ni,[Vs(Yi)],(c,[i])=>i.value.indexOf(c.geometryType())>=0],"filter-id-in":[Ni,[Vs(Hi)],(c,[i])=>i.value.indexOf(c.id())>=0],"filter-in-small":[Ni,[Yi,Vs(Hi)],(c,[i,o])=>o.value.indexOf(c.properties()[i.value])>=0],"filter-in-large":[Ni,[Yi,Vs(Hi)],(c,[i,o])=>function(u,f,d,g){for(;d<=g;){const w=d+g>>1;if(f[w]===u)return!0;f[w]>u?g=w-1:d=w+1}return!1}(c.properties()[i.value],o.value,0,o.value.length-1)],all:{type:Ni,overloads:[[[Ni,Ni],(c,[i,o])=>i.evaluate(c)&&o.evaluate(c)],[ro(Ni),(c,i)=>{for(const o of i)if(!o.evaluate(c))return!1;return!0}]]},any:{type:Ni,overloads:[[[Ni,Ni],(c,[i,o])=>i.evaluate(c)||o.evaluate(c)],[ro(Ni),(c,i)=>{for(const o of i)if(o.evaluate(c))return!0;return!1}]]},"!":[Ni,[Ni],(c,[i])=>!i.evaluate(c)],"is-supported-script":[Ni,[Yi],(c,[i])=>{const o=c.globals&&c.globals.isSupportedScript;return!o||o(i.evaluate(c))}],upcase:[Yi,[Yi],(c,[i])=>i.evaluate(c).toUpperCase()],downcase:[Yi,[Yi],(c,[i])=>i.evaluate(c).toLowerCase()],concat:[Yi,ro(Hi),(c,i)=>i.map(o=>As(o.evaluate(c))).join("")],"resolved-locale":[Yi,[ha],(c,[i])=>i.evaluate(c).resolvedLocale()],random:[Gt,[Gt,Gt,Hi],(c,i)=>{const[o,u,f]=i.map(g=>g.evaluate(c));if(o>u||o===u)return o;let d;if(typeof f=="string")d=function(g){let w=0;if(g.length===0)return w;for(let E=0;E<g.length;E++)w=(w<<5)-w+g.charCodeAt(E),w|=0;return w}(f);else{if(typeof f!="number")throw new Zn(`Invalid seed input: ${f}`);d=f}return o+am(d)()*(u-o)}]});class fm{constructor(i,o,u,f){this.expression=i,this._warningHistory={},this._evaluator=new Cd(u,f),this._defaultValue=o?function(d){return d.type==="color"&&(qd(d.default)||Array.isArray(d.default))?new Qi(0,0,0,0):d.type==="color"?Qi.parse(d.default)||null:d.default===void 0?null:d.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this.configDependencies=rh(i)}evaluateWithoutErrorHandling(i,o,u,f,d,g,w,E){return this._evaluator.globals=i,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(i,o,u,f,d,g,w,E){this._evaluator.globals=i,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Zn(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function Zd(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Pc}function Rc(c,i,o,u){const f=new Zp(Pc,[],i?function(g){const w={color:Xs,string:Yi,number:Gt,enum:Yi,boolean:Ni,formatted:Xu,resolvedImage:da};return g.type==="array"?Vs(w[g.value]||Hi,g.length):w[g.type]}(i):void 0,void 0,void 0,o,u),d=f.parse(c,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?cm(new fm(d,i,o,u)):xa(f.errors)}class pm{constructor(i,o,u,f){this.kind=i,this._styleExpression=o,this.isLightConstant=u,this.isLineProgressConstant=f,this.isStateDependent=i!=="constant"&&!sh(o.expression),this.configDependencies=rh(o.expression)}evaluateWithoutErrorHandling(i,o,u,f,d,g){return this._styleExpression.evaluateWithoutErrorHandling(i,o,u,f,d,g)}evaluate(i,o,u,f,d,g){return this._styleExpression.evaluate(i,o,u,f,d,g)}}class Lc{constructor(i,o,u,f,d,g){this.kind=i,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=i!=="camera"&&!sh(o.expression),this.isLightConstant=d,this.isLineProgressConstant=g,this.configDependencies=rh(o.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,o,u,f,d,g){return this._styleExpression.evaluateWithoutErrorHandling(i,o,u,f,d,g)}evaluate(i,o,u,f,d,g){return this._styleExpression.evaluate(i,o,u,f,d,g)}interpolationFactor(i,o,u){return this.interpolationType?jr.interpolationFactor(this.interpolationType,i,o,u):0}}function mm(c,i,o,u){if((c=Rc(c,i,o,u)).result==="error")return c;const f=c.value.expression,d=Ac(f);if(!d&&!Dc(i))return xa([new so("","data expressions not supported")]);const g=va(f,["zoom","pitch","distance-from-center"]);if(!g&&!Cy(i))return xa([new so("","zoom expressions not supported")]);const w=va(f,["measure-light"]);if(!w&&!Gd(i))return xa([new so("","measure-light expression not supported")]);const E=va(f,["line-progress"]);if(!E&&!function(S){return um(S.expression,"line-progress")}(i))return xa([new so("","line-progress expression not supported")]);const M=i.expression&&i.expression.relaxZoomRestriction,x=Yd(f);return x||g||M?x instanceof so?xa([x]):x instanceof jr&&!hm(i)?xa([new so("",'"interpolate" expressions cannot be used with this property')]):cm(x?new Lc(d&&E?"camera":"composite",c.value,x.labels,x instanceof jr?x.interpolation:void 0,w,E):new pm(d&&E?"constant":"source",c.value,w,E)):xa([new so("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Xd{constructor(i,o){this._parameters=i,this._specification=o,$i(this,Dy(this._parameters,this._specification))}static deserialize(i){return new Xd(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Yd(c){let i=null;if(c instanceof Ud)i=Yd(c.result);else if(c instanceof Vd){for(const o of c.args)if(i=Yd(o),i)break}else(c instanceof Go||c instanceof jr)&&c.input instanceof lr&&c.input.name==="zoom"&&(i=c);return i instanceof so||c.eachChild(o=>{const u=Yd(o);u instanceof so?i=u:i&&u&&i!==u&&(i=new so("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var hh,Ly,Oy=function(){if(Ly)return hh;Ly=1,hh=i;var c=3;function i(o,u,f){var d=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var g=new Int32Array(this.arrayBuffer);o=g[0],this.d=(u=g[1])+2*(f=g[2]);for(var w=0;w<this.d*this.d;w++){var E=g[c+w],M=g[c+w+1];d.push(E===M?null:g.subarray(E,M))}var x=g[c+d.length+1];this.keys=g.subarray(g[c+d.length],x),this.bboxes=g.subarray(x),this.insert=this._insertReadonly}else{this.d=u+2*f;for(var S=0;S<this.d*this.d;S++)d.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=f,this.scale=u/o,this.uid=0;var P=f/u*o;this.min=-P,this.max=o+P}return i.prototype.insert=function(o,u,f,d,g){this._forEachCell(u,f,d,g,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(d),this.bboxes.push(g)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(o,u,f,d,g,w){this.cells[g].push(w)},i.prototype.query=function(o,u,f,d,g){var w=this.min,E=this.max;if(o<=w&&u<=w&&E<=f&&E<=d&&!g)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(o,u,f,d,this._queryCell,M,{},g),M},i.prototype._queryCell=function(o,u,f,d,g,w,E,M){var x=this.cells[g];if(x!==null)for(var S=this.keys,P=this.bboxes,A=0;A<x.length;A++){var C=x[A];if(E[C]===void 0){var R=4*C;(M?M(P[R+0],P[R+1],P[R+2],P[R+3]):o<=P[R+2]&&u<=P[R+3]&&f>=P[R+0]&&d>=P[R+1])?(E[C]=!0,w.push(S[C])):E[C]=!1}}},i.prototype._forEachCell=function(o,u,f,d,g,w,E,M){for(var x=this._convertToCellCoord(o),S=this._convertToCellCoord(u),P=this._convertToCellCoord(f),A=this._convertToCellCoord(d),C=x;C<=P;C++)for(var R=S;R<=A;R++){var B=this.d*R+C;if((!M||M(this._convertFromCellCoord(C),this._convertFromCellCoord(R),this._convertFromCellCoord(C+1),this._convertFromCellCoord(R+1)))&&g.call(this,o,u,f,d,B,w,E,M))return}},i.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},i.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=c+this.cells.length+1+1,f=0,d=0;d<this.cells.length;d++)f+=this.cells[d].length;var g=new Int32Array(u+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var w=u,E=0;E<o.length;E++){var M=o[E];g[c+E]=w,g.set(M,w),w+=M.length}return g[c+o.length]=w,g.set(this.keys,w),g[c+o.length+1]=w+=this.keys.length,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer},hh}(),Oc=I(Oy);const Kd={};function zt(c,i,o={}){Object.defineProperty(c,"_classRegistryKey",{value:i,writable:!1}),Kd[i]={klass:c,omit:o.omit||[]}}zt(Object,"Object"),Oc.serialize=function(c,i){const o=c.toArrayBuffer();return i&&i.add(o),{buffer:o}},Oc.deserialize=function(c){return new Oc(c.buffer)},Object.defineProperty(Oc,"name",{value:"Grid"}),zt(Oc,"Grid"),typeof DOMMatrix<"u"&&zt(DOMMatrix,"DOMMatrix"),zt(Qi,"Color"),zt(Error,"Error"),zt(Ys,"Formatted"),zt(Yu,"FormattedSection"),zt(Ds,"AJAXError"),zt(Ks,"ResolvedImage"),zt(Xd,"StylePropertyFunction"),zt(fm,"StyleExpression",{omit:["_evaluator"]}),zt(pr,"ImageId"),zt(Ho,"ImageVariant"),zt(Lc,"ZoomDependentExpression"),zt(pm,"ZoomConstantExpression"),zt(lr,"CompoundExpression",{omit:["_evaluate"]});for(const c in Pc)Kd[Pc[c]._classRegistryKey]||zt(Pc[c],`Expression${c}`);function gm(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function _m(c){return self.ImageBitmap&&c instanceof ImageBitmap}function Ya(c,i){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(gm(c)||_m(c))return i&&i.add(c),c;if(ArrayBuffer.isView(c))return i&&i.add(c.buffer),c;if(c instanceof ImageData)return i&&i.add(c.data.buffer),c;if(Array.isArray(c)){const o=[];for(const u of c)o.push(Ya(u,i));return o}if(c instanceof Map){const o={$name:"Map",entries:[]};for(const[u,f]of c.entries())o.entries.push(Ya(u),Ya(f));return o}if(c instanceof Set){const o={$name:"Set"};let u=0;for(const f of c.values())o[++u]=Ya(f);return o}if(c instanceof DOMMatrix){const o={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const f of u)o[f]=c[f];return o}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const o=c.constructor,u=o._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${o.name}".`);const f=o.serialize?o.serialize(c,i):{};if(!o.serialize){for(const d in c)c.hasOwnProperty(d)&&(Kd[u].omit.indexOf(d)>=0||(f[d]=Ya(c[d],i)));c instanceof Error&&(f.message=c.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof c)}function $r(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||gm(c)||_m(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map($r);if(typeof c=="object"){const i=c.$name||"Object";if(i==="Map"){const f=c.entries||[],d=new Map;for(let g=0;g<f.length;g+=2)d.set($r(f[g]),$r(f[g+1]));return d}if(i==="Set"){const f=new Set;for(const d of Object.keys(c))d!=="$name"&&f.add($r(c[d]));return f}if(i==="DOMMatrix"){let f;return f=c.is2D?[c.a,c.b,c.c,c.d,c.e,c.f]:[c.m11,c.m12,c.m13,c.m14,c.m21,c.m22,c.m23,c.m24,c.m31,c.m32,c.m33,c.m34,c.m41,c.m42,c.m43,c.m44],new DOMMatrix(f)}if(i==="BigInt")return BigInt(c.value);const{klass:o}=Kd[i];if(!o)throw new Error(`Can't deserialize unregistered class "${i}".`);if(o.deserialize)return o.deserialize(c);const u=Object.create(o.prototype);for(const f of Object.keys(c))f!=="$name"&&(u[f]=$r(c[f]));return u}throw new Error("can't deserialize object of type "+typeof c)}const Qt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function ym(c){for(const i of c)if(Jd(i.charCodeAt(0)))return!0;return!1}function hb(c){for(const i of c)if(!ky(i.charCodeAt(0)))return!1;return!0}function ky(c){return!(Qt.Arabic(c)||Qt["Arabic Supplement"](c)||Qt["Arabic Extended-A"](c)||Qt["Arabic Presentation Forms-A"](c)||Qt["Arabic Presentation Forms-B"](c))}function Jd(c){return!(c!==746&&c!==747&&(c<4352||!(Qt["Bopomofo Extended"](c)||Qt.Bopomofo(c)||Qt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Qt["CJK Compatibility Ideographs"](c)||Qt["CJK Compatibility"](c)||Qt["CJK Radicals Supplement"](c)||Qt["CJK Strokes"](c)||!(!Qt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Qt["CJK Unified Ideographs Extension A"](c)||Qt["CJK Unified Ideographs"](c)||Qt["Enclosed CJK Letters and Months"](c)||Qt["Hangul Compatibility Jamo"](c)||Qt["Hangul Jamo Extended-A"](c)||Qt["Hangul Jamo Extended-B"](c)||Qt["Hangul Jamo"](c)||Qt["Hangul Syllables"](c)||Qt.Hiragana(c)||Qt["Ideographic Description Characters"](c)||Qt.Kanbun(c)||Qt["Kangxi Radicals"](c)||Qt["Katakana Phonetic Extensions"](c)||Qt.Katakana(c)&&c!==12540||!(!Qt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Qt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Qt["Unified Canadian Aboriginal Syllabics"](c)||Qt["Unified Canadian Aboriginal Syllabics Extended"](c)||Qt["Vertical Forms"](c)||Qt["Yijing Hexagram Symbols"](c)||Qt["Yi Syllables"](c)||Qt["Yi Radicals"](c))))}function vm(c){return!(Jd(c)||function(i){return!!(Qt["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Qt["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Qt["Letterlike Symbols"](i)||Qt["Number Forms"](i)||Qt["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Qt["Control Pictures"](i)&&i!==9251||Qt["Optical Character Recognition"](i)||Qt["Enclosed Alphanumerics"](i)||Qt["Geometric Shapes"](i)||Qt["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Qt["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Qt["CJK Symbols and Punctuation"](i)||Qt.Katakana(i)||Qt["Private Use Area"](i)||Qt["CJK Compatibility Forms"](i)||Qt["Small Form Variants"](i)||Qt["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(c))}function zy(c){return Qt.Arabic(c)||Qt["Arabic Supplement"](c)||Qt["Arabic Extended-A"](c)||Qt["Arabic Presentation Forms-A"](c)||Qt["Arabic Presentation Forms-B"](c)}function Qd(c){return c>=1424&&c<=2303||Qt["Arabic Presentation Forms-A"](c)||Qt["Arabic Presentation Forms-B"](c)}function xm(c,i){return!(!i&&Qd(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Qt.Khmer(c))}function Fy(c){for(const i of c)if(Qd(i.charCodeAt(0)))return!0;return!1}const bm="deferred",qo="loading",wm="loaded";let Tm=null,mr="unavailable",Ka=null;const dh=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(mr="error"),Tm&&Tm(c)};function ef(){kc.fire(new xr("pluginStateChange",{pluginStatus:mr,pluginURL:Ka}))}const kc=new wo,tf=function(){return mr},By=function(){if(mr!==bm||!Ka)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");mr=qo,ef(),Ka&&ua({url:Ka},c=>{c?dh(c):(mr=wm,ef())})},oo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>mr===wm||oo.applyArabicShaping!=null,isLoading:()=>mr===qo,setState(c){mr=c.pluginStatus,Ka=c.pluginURL},isParsed:()=>oo.applyArabicShaping!=null&&oo.processBidirectionalText!=null&&oo.processStyledBidirectionalText!=null,getPluginURL:()=>Ka};class fn{constructor(i,o){this.zoom=i,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(o,u){for(const f of o)if(!xm(f.charCodeAt(0),u))return!1;return!0}(i,oo.isLoaded())}}class zc{constructor(i,o,u,f){this.property=i,this.value=o,this.expression=function(d,g,w,E){if(qd(d))return new Xd(d,g);if(Zd(d)||Array.isArray(d)&&d.length>0){const M=mm(d,g,w,E);if(M.result==="error")throw new Error(M.value.map(x=>`${x.key}: ${x.message}`).join(", "));return M.value}{let M=d;return typeof d=="string"&&g.type==="color"&&(M=Qi.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>M}}}(o===void 0?i.specification.default:o,i.specification,u,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,o,u){return this.property.possiblyEvaluate(this,i,o,u)}}class Em{constructor(i,o,u){this.property=i,this.value=new zc(i,void 0,o,u)}transitioned(i,o){return new nf(this.property,this.value,o,ji({},i.transition,this.transition),i.now)}untransitioned(){return new nf(this.property,this.value,null,{},0)}}class Sm{constructor(i,o,u){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(i){return or(this._values[i].value.value)}setValue(i,o){this._values.hasOwnProperty(i)||(this._values[i]=new Em(this._values[i].property,this._scope,this._options)),this._values[i].value=new zc(this._values[i].property,o===null?void 0:or(o),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,o){o&&(this._options=o);const u=this._properties.properties;if(i)for(const f in i){const d=i[f];if(f.endsWith("-transition")){const g=f.slice(0,-11);u[g]&&this.setTransition(g,d)}else u.hasOwnProperty(f)&&this.setValue(f,d)}}getTransition(i){return or(this._values[i].transition)}setTransition(i,o){this._values.hasOwnProperty(i)||(this._values[i]=new Em(this._values[i].property)),this._values[i].transition=or(o)||void 0}serialize(){const i={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(i[o]=u);const f=this.getTransition(o);f!==void 0&&(i[`${o}-transition`]=f)}return i}transitioned(i,o){const u=new fh(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(i,o._values[f]);return u}untransitioned(){const i=new fh(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].untransitioned();return i}}class nf{constructor(i,o,u,f,d){const g=f.delay||0,w=f.duration||0;d=d||0,this.property=i,this.value=o,this.begin=d+g,this.end=this.begin+w,i.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(i,o,u){const f=i.now||0,d=this.value.possiblyEvaluate(i,o,u),g=this.prior;if(g){if(f>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(f<this.begin)return g.possiblyEvaluate(i,o,u);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(i,o,u),d,Yt(w))}}return d}}class fh{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,o,u){const f=new Nc(this._properties);for(const d of Object.keys(this._values))f._values[d]=this._values[d].possiblyEvaluate(i,o,u);return f}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Fc{constructor(i,o,u){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(i){return or(this._values[i].value)}setValue(i,o){this._values[i]=new zc(this._values[i].property,o===null?void 0:or(o),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(i[o]=u)}return i}possiblyEvaluate(i,o,u){const f=new Nc(this._properties);for(const d of Object.keys(this._values))f._values[d]=this._values[d].possiblyEvaluate(i,o,u);return f}}class Bc{constructor(i,o,u){this.property=i,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,o,u,f){return this.property.evaluate(this.value,this.parameters,i,o,u,f)}}class Nc{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Tt{constructor(i){this.specification=i}possiblyEvaluate(i,o){return i.expression.evaluate(o)}interpolate(i,o,u){const f=Zu[this.specification.type];return f?f(i,o,u):i}}class kt{constructor(i,o){this.specification=i,this.overrides=o}possiblyEvaluate(i,o,u,f){return new Bc(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(o,null,{},u,f)}:i.expression,o)}interpolate(i,o,u){if(i.value.kind!=="constant"||o.value.kind!=="constant")return i;if(i.value.value===void 0||o.value.value===void 0)return new Bc(this,{kind:"constant",value:void 0},i.parameters);const f=Zu[this.specification.type];return f?new Bc(this,{kind:"constant",value:f(i.value.value,o.value.value,u)},i.parameters):i}evaluate(i,o,u,f,d,g){return i.kind==="constant"?i.value:i.evaluate(o,u,f,d,g)}}class Vc{constructor(i){this.specification=i}possiblyEvaluate(i,o,u,f){return!!i.expression.evaluate(o,null,{},u,f)}interpolate(){return!1}}class kn{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new fn(0,{});for(const u in i){const f=i[u];f.specification.overridable&&this.overridableProperties.push(u);const d=this.defaultPropertyValues[u]=new zc(f,void 0),g=this.defaultTransitionablePropertyValues[u]=new Em(f);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=d.possiblyEvaluate(o)}}}zt(kt,"DataDrivenProperty"),zt(Tt,"DataConstantProperty"),zt(Vc,"ColorRampProperty");var We=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Ny(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function sf(c){if(Array.isArray(c))return c.map(sf);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const i={};for(const o in c)i[o]=sf(c[o]);return i}return Ny(c)}function Am(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const i of c.slice(1))if(!Am(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function Mm(c,i="",o=null,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Am(c)||(c=rf(c));const f=c;let d=!0;try{d=function(x){if(!Uc(x))return x;let S=sf(x);return Uy(S),S=Vy(S),S}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let g=null,w=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){w=We[`filter_${u}`];const x=Rc(d,w,i,o);if(x.result==="error")throw new Error(x.value.map(S=>`${S.key}: ${S.message}`).join(", "));g=(S,P,A)=>x.value.evaluate(S,P,{},A)}let E=null,M=null;if(d!==f){const x=Rc(f,w,i,o);if(x.result==="error")throw new Error(x.value.map(S=>`${S.key}: ${S.message}`).join(", "));E=(S,P,A,C,R)=>x.value.evaluate(S,P,{},A,void 0,void 0,C,R),M=!Ac(x.value.expression)}return{filter:g,dynamicFilter:E||void 0,needGeometry:jy(d),needFeature:!!M}}function Vy(c){if(!Array.isArray(c))return c;const i=function(o){if(db.has(o[0])){for(let u=1;u<o.length;u++)if(Uc(o[u]))return!0}return o}(c);return i===!0?i:i.map(o=>Vy(o))}function Uy(c){let i=!1;const o=[];if(c[0]==="case"){for(let u=1;u<c.length-1;u+=2)i=i||Uc(c[u]),o.push(c[u+1]);o.push(c[c.length-1])}else if(c[0]==="match"){i=i||Uc(c[1]);for(let u=2;u<c.length-1;u+=2)o.push(c[u+1]);o.push(c[c.length-1])}else if(c[0]==="step"){i=i||Uc(c[1]);for(let u=1;u<c.length-1;u+=2)o.push(c[u+1])}i&&(c.length=0,c.push("any",...o));for(let u=1;u<c.length;u++)Uy(c[u])}function Uc(c){if(!Array.isArray(c))return!1;if((i=c[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let o=1;o<c.length;o++)if(Uc(c[o]))return!0;return!1}const db=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fb(c,i){return c<i?-1:c>i?1:0}function jy(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let i=1;i<c.length;i++)if(jy(c[i]))return!0;return!1}function rf(c){if(!c)return!0;const i=c[0];return c.length<=1?i!=="any":i==="=="?Ja(c[1],c[2],"=="):i==="!="?Il(Ja(c[1],c[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Ja(c[1],c[2],i):i==="any"?(o=c.slice(1),["any"].concat(o.map(rf))):i==="all"?["all"].concat(c.slice(1).map(rf)):i==="none"?["all"].concat(c.slice(1).map(rf).map(Il)):i==="in"?Im(c[1],c.slice(2)):i==="!in"?Il(Im(c[1],c.slice(2))):i==="has"?Cm(c[1]):i!=="!has"||Il(Cm(c[1]));var o}function Ja(c,i,o){switch(c){case"$type":return[`filter-type-${o}`,i];case"$id":return[`filter-id-${o}`,i];default:return[`filter-${o}`,c,i]}}function Im(c,i){if(i.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(o=>typeof o!=typeof i[0])?["filter-in-large",c,["literal",i.sort(fb)]]:["filter-in-small",c,["literal",i]]}}function Cm(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Il(c){return["!",c]}const of="";function jc(c,i){return i?`${c}${of}${i}`:c}const ba="-transition",$y=new Set(["fill","line","background","hillshade","raster"]);class Ms extends wo{constructor(i,o,u,f,d){if(super(),this.id=i.id,this.fqid=jc(this.id,u),this.type=i.type,this.scope=u,this.lut=f,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const g=Rc(this.filter,We[`filter_${i.type}`]);g.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...g.value.configDependencies]))}if(i.slot&&(this.slot=i.slot),o.layout&&(this._unevaluatedLayout=new Fc(o.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint){this._transitionablePaint=new Sm(o.paint,this.scope,d);for(const g in i.paint)this.setPaintProperty(g,i.paint[g]);for(const g in i.layout)this.setLayoutProperty(g,i.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nc(o.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&$y.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,o){if(this.type==="custom"&&i==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[i]&&(u.setValue(i,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),i==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(ba)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,o){const u=this._transitionablePaint,f=u._properties.properties;if(i.endsWith(ba)){const S=i.slice(0,-11);return f[S]&&u.setTransition(S,o||void 0),!1}if(!f[i])return!1;const d=u._values[i],g=d.value.isDataDriven(),w=d.value;u.setValue(i,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const E=u._values[i].value,M=E.isDataDriven(),x=i.endsWith("pattern")||i==="line-dasharray";return M||g||x||this._handleOverridablePaintPropertyUpdate(i,w,E)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,o,u){return null}_handleOverridablePaintPropertyUpdate(i,o,u){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,o)}serialize(){return Br({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length))}is3D(i){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const i in this.paint._values){const o=this.paint.get(i);if(o instanceof Bc&&Dc(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=Mm(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,o,u,f,d,g,w,E,M){}}const pb={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ph{constructor(i,o){this._structArray=i,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class yn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,o){return i._trim(),o&&(i.isTransferred=!0,o.add(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const o=Object.create(this.prototype);return o.arrayBuffer=i.arrayBuffer,o.length=i.length,o.capacity=i.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Gi(c,i=1){let o=0,u=0;return{members:c.map(f=>{const d=pb[f.type].BYTES_PER_ELEMENT,g=o=Hy(o,Math.max(i,d)),w=f.components||1;return u=Math.max(u,d),o+=d*w,{name:f.name,type:f.type,components:w,offset:g}}),size:Hy(o,Math.max(u,i)),alignment:i}}function Hy(c,i){return Math.ceil(c/i)*i}class wa extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o){const u=this.length;return this.resize(u+1),this.emplace(u,i,o)}emplace(i,o,u){const f=2*i;return this.int16[f+0]=o,this.int16[f+1]=u,i}}wa.prototype.bytesPerElement=4,zt(wa,"StructArrayLayout2i4");class $c extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,o,u)}emplace(i,o,u,f){const d=3*i;return this.int16[d+0]=o,this.int16[d+1]=u,this.int16[d+2]=f,i}}$c.prototype.bytesPerElement=6,zt($c,"StructArrayLayout3i6");class Ta extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,i,o,u,f)}emplace(i,o,u,f,d){const g=4*i;return this.int16[g+0]=o,this.int16[g+1]=u,this.int16[g+2]=f,this.int16[g+3]=d,i}}Ta.prototype.bytesPerElement=8,zt(Ta,"StructArrayLayout4i8");class Cl extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.float32[1*i+0]=o,i}}Cl.prototype.bytesPerElement=4,zt(Cl,"StructArrayLayout1f4");class mh extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,o,u)}emplace(i,o,u,f){const d=4*i,g=2*i;return this.int16[d+0]=o,this.int16[d+1]=u,this.float32[g+1]=f,i}}mh.prototype.bytesPerElement=8,zt(mh,"StructArrayLayout2i1f8");class Pm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,o,u)}emplace(i,o,u,f){const d=4*i;return this.int16[d+0]=o,this.int16[d+1]=u,this.int16[d+2]=f,i}}Pm.prototype.bytesPerElement=8,zt(Pm,"StructArrayLayout3i8");class ao extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,u,f,d)}emplace(i,o,u,f,d,g){const w=5*i;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=f,this.int16[w+3]=d,this.int16[w+4]=g,i}}ao.prototype.bytesPerElement=10,zt(ao,"StructArrayLayout5i10");class Dm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,u,f,d,g,w)}emplace(i,o,u,f,d,g,w,E){const M=6*i,x=12*i,S=3*i;return this.int16[M+0]=o,this.int16[M+1]=u,this.uint8[x+4]=f,this.uint8[x+5]=d,this.uint8[x+6]=g,this.uint8[x+7]=w,this.float32[S+2]=E,i}}Dm.prototype.bytesPerElement=12,zt(Dm,"StructArrayLayout2i4ub1f12");class Ao extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,o,u)}emplace(i,o,u,f){const d=3*i;return this.float32[d+0]=o,this.float32[d+1]=u,this.float32[d+2]=f,i}}Ao.prototype.bytesPerElement=12,zt(Ao,"StructArrayLayout3f12");class Qa extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,u,f,d)}emplace(i,o,u,f,d,g){const w=6*i,E=3*i;return this.uint16[w+0]=o,this.uint16[w+1]=u,this.uint16[w+2]=f,this.uint16[w+3]=d,this.float32[E+2]=g,i}}Qa.prototype.bytesPerElement=12,zt(Qa,"StructArrayLayout4ui1f12");class af extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,i,o,u,f)}emplace(i,o,u,f,d){const g=4*i;return this.uint16[g+0]=o,this.uint16[g+1]=u,this.uint16[g+2]=f,this.uint16[g+3]=d,i}}af.prototype.bytesPerElement=8,zt(af,"StructArrayLayout4ui8");class lf extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,o,u,f,d,g)}emplace(i,o,u,f,d,g,w){const E=6*i;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=f,this.int16[E+3]=d,this.int16[E+4]=g,this.int16[E+5]=w,i}}lf.prototype.bytesPerElement=12,zt(lf,"StructArrayLayout6i12");class Rm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w,E,M,x,S,P){const A=this.length;return this.resize(A+1),this.emplace(A,i,o,u,f,d,g,w,E,M,x,S,P)}emplace(i,o,u,f,d,g,w,E,M,x,S,P,A){const C=12*i;return this.int16[C+0]=o,this.int16[C+1]=u,this.int16[C+2]=f,this.int16[C+3]=d,this.uint16[C+4]=g,this.uint16[C+5]=w,this.uint16[C+6]=E,this.uint16[C+7]=M,this.int16[C+8]=x,this.int16[C+9]=S,this.int16[C+10]=P,this.int16[C+11]=A,i}}Rm.prototype.bytesPerElement=24,zt(Rm,"StructArrayLayout4i4ui4i24");class Lm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,o,u,f,d,g)}emplace(i,o,u,f,d,g,w){const E=10*i,M=5*i;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=f,this.float32[M+2]=d,this.float32[M+3]=g,this.float32[M+4]=w,i}}Lm.prototype.bytesPerElement=20,zt(Lm,"StructArrayLayout3i3f20");class Pl extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,i,o,u,f)}emplace(i,o,u,f,d){const g=4*i;return this.float32[g+0]=o,this.float32[g+1]=u,this.float32[g+2]=f,this.float32[g+3]=d,i}}Pl.prototype.bytesPerElement=16,zt(Pl,"StructArrayLayout4f16");class Om extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint32[1*i+0]=o,i}}Om.prototype.bytesPerElement=4,zt(Om,"StructArrayLayout1ul4");class el extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o){const u=this.length;return this.resize(u+1),this.emplace(u,i,o)}emplace(i,o,u){const f=2*i;return this.uint16[f+0]=o,this.uint16[f+1]=u,i}}el.prototype.bytesPerElement=4,zt(el,"StructArrayLayout2ui4");class km extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w,E,M,x,S,P,A){const C=this.length;return this.resize(C+1),this.emplace(C,i,o,u,f,d,g,w,E,M,x,S,P,A)}emplace(i,o,u,f,d,g,w,E,M,x,S,P,A,C){const R=20*i,B=10*i;return this.int16[R+0]=o,this.int16[R+1]=u,this.int16[R+2]=f,this.int16[R+3]=d,this.int16[R+4]=g,this.float32[B+3]=w,this.float32[B+4]=E,this.float32[B+5]=M,this.float32[B+6]=x,this.int16[R+14]=S,this.uint32[B+8]=P,this.uint16[R+18]=A,this.uint16[R+19]=C,i}}km.prototype.bytesPerElement=40,zt(km,"StructArrayLayout5i4f1i1ul2ui40");class gh extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,u,f,d,g,w)}emplace(i,o,u,f,d,g,w,E){const M=8*i;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=f,this.int16[M+4]=d,this.int16[M+5]=g,this.int16[M+6]=w,this.int16[M+7]=E,i}}gh.prototype.bytesPerElement=16,zt(gh,"StructArrayLayout3i2i2i16");class zm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,u,f,d)}emplace(i,o,u,f,d,g){const w=4*i,E=8*i;return this.float32[w+0]=o,this.float32[w+1]=u,this.float32[w+2]=f,this.int16[E+6]=d,this.int16[E+7]=g,i}}zm.prototype.bytesPerElement=16,zt(zm,"StructArrayLayout2f1f2i16");class Fm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,o,u,f,d,g)}emplace(i,o,u,f,d,g,w){const E=20*i,M=5*i;return this.uint8[E+0]=o,this.uint8[E+1]=u,this.float32[M+1]=f,this.float32[M+2]=d,this.float32[M+3]=g,this.float32[M+4]=w,i}}Fm.prototype.bytesPerElement=20,zt(Fm,"StructArrayLayout2ub4f20");class Rs extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,o,u)}emplace(i,o,u,f){const d=3*i;return this.uint16[d+0]=o,this.uint16[d+1]=u,this.uint16[d+2]=f,i}}Rs.prototype.bytesPerElement=6,zt(Rs,"StructArrayLayout3ui6");class cf extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B,N,G,H,$,W){const K=this.length;return this.resize(K+1),this.emplace(K,i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B,N,G,H,$,W)}emplace(i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B,N,G,H,$,W,K){const Q=30*i,ue=15*i,oe=60*i;return this.int16[Q+0]=o,this.int16[Q+1]=u,this.int16[Q+2]=f,this.float32[ue+2]=d,this.float32[ue+3]=g,this.uint16[Q+8]=w,this.uint16[Q+9]=E,this.uint32[ue+5]=M,this.uint32[ue+6]=x,this.uint32[ue+7]=S,this.uint16[Q+16]=P,this.uint16[Q+17]=A,this.uint16[Q+18]=C,this.float32[ue+10]=R,this.float32[ue+11]=B,this.uint8[oe+48]=N,this.uint8[oe+49]=G,this.uint8[oe+50]=H,this.uint32[ue+13]=$,this.int16[Q+28]=W,this.uint8[oe+58]=K,i}}cf.prototype.bytesPerElement=60,zt(cf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class uf extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B,N,G,H,$,W,K,Q,ue,oe,ae,Ee,he,Se,Le,De,Fe,ke){const He=this.length;return this.resize(He+1),this.emplace(He,i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B,N,G,H,$,W,K,Q,ue,oe,ae,Ee,he,Se,Le,De,Fe,ke)}emplace(i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B,N,G,H,$,W,K,Q,ue,oe,ae,Ee,he,Se,Le,De,Fe,ke,He){const Ve=20*i,qe=40*i,pt=80*i;return this.float32[Ve+0]=o,this.float32[Ve+1]=u,this.int16[qe+4]=f,this.int16[qe+5]=d,this.int16[qe+6]=g,this.int16[qe+7]=w,this.int16[qe+8]=E,this.int16[qe+9]=M,this.int16[qe+10]=x,this.int16[qe+11]=S,this.int16[qe+12]=P,this.uint16[qe+13]=A,this.uint16[qe+14]=C,this.uint16[qe+15]=R,this.uint16[qe+16]=B,this.uint16[qe+17]=N,this.uint16[qe+18]=G,this.uint16[qe+19]=H,this.uint16[qe+20]=$,this.uint16[qe+21]=W,this.uint16[qe+22]=K,this.uint16[qe+23]=Q,this.uint16[qe+24]=ue,this.uint16[qe+25]=oe,this.uint16[qe+26]=ae,this.uint16[qe+27]=Ee,this.uint32[Ve+14]=he,this.float32[Ve+15]=Se,this.float32[Ve+16]=Le,this.float32[Ve+17]=De,this.float32[Ve+18]=Fe,this.uint8[pt+76]=ke,this.uint16[qe+39]=He,i}}uf.prototype.bytesPerElement=80,zt(uf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class br extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,u,f,d)}emplace(i,o,u,f,d,g){const w=5*i;return this.float32[w+0]=o,this.float32[w+1]=u,this.float32[w+2]=f,this.float32[w+3]=d,this.float32[w+4]=g,i}}br.prototype.bytesPerElement=20,zt(br,"StructArrayLayout5f20");class hf extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,u,f,d,g,w)}emplace(i,o,u,f,d,g,w,E){const M=7*i;return this.float32[M+0]=o,this.float32[M+1]=u,this.float32[M+2]=f,this.float32[M+3]=d,this.float32[M+4]=g,this.float32[M+5]=w,this.float32[M+6]=E,i}}hf.prototype.bytesPerElement=28,zt(hf,"StructArrayLayout7f28");class Bm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w,E,M,x,S){const P=this.length;return this.resize(P+1),this.emplace(P,i,o,u,f,d,g,w,E,M,x,S)}emplace(i,o,u,f,d,g,w,E,M,x,S,P){const A=11*i;return this.float32[A+0]=o,this.float32[A+1]=u,this.float32[A+2]=f,this.float32[A+3]=d,this.float32[A+4]=g,this.float32[A+5]=w,this.float32[A+6]=E,this.float32[A+7]=M,this.float32[A+8]=x,this.float32[A+9]=S,this.float32[A+10]=P,i}}Bm.prototype.bytesPerElement=44,zt(Bm,"StructArrayLayout11f44");class Nm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w,E,M){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,u,f,d,g,w,E,M)}emplace(i,o,u,f,d,g,w,E,M,x){const S=9*i;return this.float32[S+0]=o,this.float32[S+1]=u,this.float32[S+2]=f,this.float32[S+3]=d,this.float32[S+4]=g,this.float32[S+5]=w,this.float32[S+6]=E,this.float32[S+7]=M,this.float32[S+8]=x,i}}Nm.prototype.bytesPerElement=36,zt(Nm,"StructArrayLayout9f36");class Hc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o){const u=this.length;return this.resize(u+1),this.emplace(u,i,o)}emplace(i,o,u){const f=2*i;return this.float32[f+0]=o,this.float32[f+1]=u,i}}Hc.prototype.bytesPerElement=8,zt(Hc,"StructArrayLayout2f8");class _h extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,i,o,u,f)}emplace(i,o,u,f,d){const g=6*i;return this.uint32[3*i+0]=o,this.uint16[g+2]=u,this.uint16[g+3]=f,this.uint16[g+4]=d,i}}_h.prototype.bytesPerElement=12,zt(_h,"StructArrayLayout1ul3ui12");class df extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint16[1*i+0]=o,i}}df.prototype.bytesPerElement=2,zt(df,"StructArrayLayout1ui2");class ff extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B){const N=this.length;return this.resize(N+1),this.emplace(N,i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B)}emplace(i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B,N){const G=16*i;return this.float32[G+0]=o,this.float32[G+1]=u,this.float32[G+2]=f,this.float32[G+3]=d,this.float32[G+4]=g,this.float32[G+5]=w,this.float32[G+6]=E,this.float32[G+7]=M,this.float32[G+8]=x,this.float32[G+9]=S,this.float32[G+10]=P,this.float32[G+11]=A,this.float32[G+12]=C,this.float32[G+13]=R,this.float32[G+14]=B,this.float32[G+15]=N,i}}ff.prototype.bytesPerElement=64,zt(ff,"StructArrayLayout16f64");class pf extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,f,d,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,u,f,d,g,w)}emplace(i,o,u,f,d,g,w,E){const M=10*i,x=5*i;return this.uint16[M+0]=o,this.uint16[M+1]=u,this.uint16[M+2]=f,this.uint16[M+3]=d,this.float32[x+2]=g,this.float32[x+3]=w,this.float32[x+4]=E,i}}pf.prototype.bytesPerElement=20,zt(pf,"StructArrayLayout4ui3f20");class mf extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.int16[1*i+0]=o,i}}mf.prototype.bytesPerElement=2,zt(mf,"StructArrayLayout1i2");class Vm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint8[1*i+0]=o,i}}Vm.prototype.bytesPerElement=1,zt(Vm,"StructArrayLayout1ub1");class Um extends ph{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Um.prototype.size=40;class yh extends km{get(i){return new Um(this,i)}}zt(yh,"CollisionBoxArray");class Gy extends ph{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Gy.prototype.size=60;class qy extends cf{get(i){return new Gy(this,i)}}zt(qy,"PlacedSymbolArray");class Wy extends ph{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Wy.prototype.size=80;class Zy extends uf{get(i){return new Wy(this,i)}}zt(Zy,"SymbolInstanceArray");class Xy extends Cl{getoffsetX(i){return this.float32[1*i+0]}}zt(Xy,"GlyphOffsetArray");class vh extends wa{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}zt(vh,"SymbolLineVertexArray");class xh extends ph{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xh.prototype.size=12;class wr extends _h{get(i){return new xh(this,i)}}zt(wr,"FeatureIndexArray");class bh extends el{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}zt(bh,"FillExtrusionCentroidArray");class Yy extends ph{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Yy.prototype.size=6;class Ky extends $c{get(i){return new Yy(this,i)}}zt(Ky,"FillExtrusionWallArray");const mb=Gi([{name:"a_pos",components:2,type:"Int16"}],4),gb=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Mn{constructor(i=[]){this.segments=i}_prepareSegment(i,o,u,f){let d=this.segments[this.segments.length-1];return i>Mn.MAX_VERTEX_ARRAY_LENGTH&&on(`Max vertices per segment is ${Mn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!d||d.vertexLength+i>Mn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==f)&&(d={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},f!==void 0&&(d.sortKey=f),this.segments.push(d)),d}prepareSegment(i,o,u,f){return this._prepareSegment(i,o.length,u.length,f)}get(){return this.segments}destroy(){for(const i of this.segments)for(const o in i.vaos)i.vaos[o].destroy()}static simpleSegment(i,o,u,f){return new Mn([{vertexOffset:i,primitiveOffset:o,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}function Jy(c,i){return 256*(c=At(Math.floor(c),0,255))+At(Math.floor(i),0,255)}Mn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zt(Mn,"SegmentVector");const jm=Gi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),_b=Gi([{name:"a_dash",components:4,type:"Uint16"}]);class wh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,o,u,f){this.ids.push($m(i)),this.positions.push(o,u,f)}eachPosition(i,o){const u=$m(i);let f=0,d=this.ids.length-1;for(;f<d;){const g=f+d>>1;this.ids[g]>=u?d=g:f=g+1}for(;this.ids[f]===u;)o(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(i,o){const u=new Float64Array(i.ids),f=new Uint32Array(i.positions);return Th(u,f,0,u.length-1),o&&(o.add(u.buffer),o.add(f.buffer)),{ids:u,positions:f}}static deserialize(i){const o=new wh;let u;o.ids=i.ids,o.positions=i.positions;for(const f of o.ids)f!==u&&o.uniqueIds.push(f),u=f;return o.indexed=!0,o}}function $m(c){const i=+c;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:Vr(String(c))}function Th(c,i,o,u){for(;o<u;){const f=c[o+u>>1];let d=o-1,g=u+1;for(;;){do d++;while(c[d]<f);do g--;while(c[g]>f);if(d>=g)break;gf(c,d,g),gf(i,3*d,3*g),gf(i,3*d+1,3*g+1),gf(i,3*d+2,3*g+2)}g-o<u-g?(Th(c,i,o,g),o=g+1):(Th(c,i,g+1,u),u=g)}}function gf(c,i,o){const u=c[i];c[i]=c[o],c[o]=u}zt(wh,"FeaturePositionMap");class Wo{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,o),this.initialized=!0),!!this.location}set(i,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Eh extends Wo{constructor(i){super(i),this.current=0}set(i,o,u){this.fetchUniformLocation(i,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Xn extends Wo{constructor(i){super(i),this.current=0}set(i,o,u){this.fetchUniformLocation(i,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class lo extends Wo{constructor(i){super(i),this.current=[0,0]}set(i,o,u){this.fetchUniformLocation(i,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Gc extends Wo{constructor(i){super(i),this.current=[0,0,0]}set(i,o,u){this.fetchUniformLocation(i,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Sh extends Wo{constructor(i){super(i),this.current=[0,0,0,0]}set(i,o,u){this.fetchUniformLocation(i,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Qy extends Wo{constructor(i){super(i),this.current=Qi.transparent.toRenderColor(null)}set(i,o,u){this.fetchUniformLocation(i,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const e0=new Float32Array(16);class Ah extends Wo{constructor(i){super(i),this.current=e0}set(i,o,u){if(this.fetchUniformLocation(i,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let f=1;f<16;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Hm=new Float32Array(9),yb=new Float32Array(4);class Gm extends Wo{constructor(i){super(i),this.current=yb}set(i,o,u){if(this.fetchUniformLocation(i,o)){for(let f=0;f<4;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function qm(c){return[Jy(255*c.r,255*c.g),Jy(255*c.b,255*c.a)]}class Mh{constructor(i,o,u,f){this.value=i,this.uniformNames=o.map(d=>`u_${d}`),this.type=u,this.context=f}setUniform(i,o,u,f,d){const g=f.constantOr(this.value);o.set(i,d,g instanceof Qi?g.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(i,o){return this.type==="color"?new Qy(i):new Xn(i)}}class Dl{constructor(i,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,o,u,f,d){const g=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;g&&o.set(i,d,g)}getBinding(i,o){return o==="u_pattern"||o==="u_dash"?new Sh(i):new Xn(i)}}class Ea{constructor(i,o,u,f){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(d=>({name:`a_${d}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(i,o,u,f,d,g,w){const E=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new fn(0,{brightness:g}),o,{},d,f,w):this.expression.kind==="constant"&&this.expression.value,x=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new fn(0,{brightness:g}),o,{},d,f,w):this.lutExpression.value)==="none";this.paintVertexArray.resize(i),this._setPaintValue(E,i,M,x?null:this.context.lut)}updatePaintArray(i,o,u,f,d,g,w){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w},u,f,void 0,d):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new fn(0,{brightness:w}),u,f,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(i,o,E,M?null:this.context.lut)}_setPaintValue(i,o,u,f){if(this.type==="color"){const d=qm(u.toRenderColor(f));for(let g=i;g<o;g++)this.paintVertexArray.emplace(g,d[0],d[1])}else{for(let d=i;d<o;d++)this.paintVertexArray.emplace(d,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mo{constructor(i,o,u,f,d,g){this.expression=i,this.uniformNames=o.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=f,this.context=d,this.maxValue=0,this.paintVertexAttributes=o.map(w=>({name:`a_${w}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,o,u,f,d,g,w){const E=this.expression.evaluate(new fn(this.context.zoom,{brightness:g}),o,{},d,f,w),M=this.expression.evaluate(new fn(this.context.zoom+1,{brightness:g}),o,{},d,f,w),x=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new fn(0,{brightness:g}),o,{},d,f,w):this.lutExpression.value)==="none",S=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(S,i,E,M,x?null:this.context.lut)}updatePaintArray(i,o,u,f,d,g,w){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:w},u,f,void 0,d),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w},u,f,void 0,d),x=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new fn(0,{brightness:w}),u,f,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(i,o,E,M,x?null:this.context.lut)}_setPaintValue(i,o,u,f,d){if(this.type==="color"){const g=qm(u.toRenderColor(d)),w=qm(u.toRenderColor(d));for(let E=i;E<o;E++)this.paintVertexArray.emplace(E,g[0],g[1],w[0],w[1])}else{for(let g=i;g<o;g++)this.paintVertexArray.emplace(g,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,o,u,f,d){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,w=At(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);o.set(i,d,w)}getBinding(i,o){return new Xn(i)}}class tl{constructor(i,o,u,f,d){this.expression=i,this.layerId=d,this.paintVertexAttributes=(u==="array"?_b:jm).members;for(let g=0;g<o.length;++g);this.paintVertexArray=new f}populatePaintArray(i,o,u,f){const d=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(d,i,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(i,o,u,f,d,g,w){this._setPaintValues(i,o,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(i,o,u,f){if(!f||!u)return;const d=f[u];if(!d)return;const{tl:g,br:w,pixelRatio:E}=d;for(let M=i;M<o;M++)this.paintVertexArray.emplace(M,g[0],g[1],w[0],w[1],E)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rl{constructor(i,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const f=[];for(const d in i.paint._values){const g=i.paint.get(d);if(d.endsWith("-use-theme")||!u(d)||!(g instanceof Bc&&Dc(g.property.specification)))continue;const w=xb(d,i.type),E=g.value,M=g.property.specification.type,x=!!g.property.useIntegerZoom,S=d==="line-dasharray"||d.endsWith("pattern"),P=i.paint.get(`${d}-use-theme`),A=d==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||P&&P.value.kind!=="constant";if(E.kind!=="constant"||A)if(E.kind==="source"||A||S){const C=t0(d,M,"source");this.binders[d]=S?new tl(E,w,M,C,i.id):new Ea(E,w,M,C),f.push(`/a_${d}`)}else{const C=t0(d,M,"composite");this.binders[d]=new Mo(E,w,M,x,o,C),f.push(`/z_${d}`)}else this.binders[d]=S?new Dl(E.value,w):new Mh(E.value,w,M,o),f.push(`/u_${d}`);P&&(this.binders[d].lutExpression=P.value)}this.cacheKey=f.sort().join("")}getMaxValue(i){const o=this.binders[i];return o instanceof Ea||o instanceof Mo?o.maxValue:0}populatePaintArrays(i,o,u,f,d,g,w){for(const E in this.binders){const M=this.binders[E];M.context=this.context,(M instanceof Ea||M instanceof Mo||M instanceof tl)&&M.populatePaintArray(i,o,u,f,d,g,w)}}setConstantPatternPositions(i){for(const o in this.binders){const u=this.binders[o];u instanceof Dl&&u.setConstantPatternPositions(i)}}updatePaintArrays(i,o,u,f,d,g,w,E,M){let x=!1;const S=Object.keys(i),P=S.length!==0&&!E,A=P?S:o.uniqueIds;this.context.lut=d.lut;for(const C in this.binders){const R=this.binders[C];if(R.context=this.context,(R instanceof Ea||R instanceof Mo||R instanceof tl)&&R.expression&&R.expression.kind&&R.expression.kind!=="constant"&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const B=d.paint.get(C);R.expression=B.value;for(const N of A){const G=i[N.toString()];o.eachPosition(N,(H,$,W)=>{const K=f.feature(H);R.updatePaintArray($,W,K,G,g,w,M)})}if(!P)for(const N of u.uniqueIds){const G=i[N.toString()];u.eachPosition(N,(H,$,W)=>{const K=f.feature(H);R.updatePaintArray($,W,K,G,g,w,M)})}x=!0}}return x}defines(){const i=[];for(const o in this.binders){const u=this.binders[o];(u instanceof Mh||u instanceof Dl)&&i.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return i}getBinderAttributes(){const i=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Ea||u instanceof Mo||u instanceof tl)for(let f=0;f<u.paintVertexAttributes.length;f++)i.push(u.paintVertexAttributes[f].name)}return i}getBinderUniforms(){const i=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Mh||u instanceof Dl||u instanceof Mo)for(const f of u.uniformNames)i.push(f)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Mh||f instanceof Dl||f instanceof Mo)for(const d of f.uniformNames)o.push({name:d,property:u,binding:f.getBinding(i,d)})}return o}setUniforms(i,o,u,f,d){for(const{name:g,property:w,binding:E}of u)this.binders[w].setUniform(i,E,d,f.get(w),g)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Ea||o instanceof Mo||o instanceof tl)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(i){for(const o in this.binders){const u=this.binders[o];(u instanceof Ea||u instanceof Mo||u instanceof tl)&&u.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const o=this.binders[i];(o instanceof Ea||o instanceof Mo||o instanceof tl)&&o.destroy()}}}class il{constructor(i,o,u=()=>!0){this.programConfigurations={};for(const f of i)this.programConfigurations[f.id]=new Rl(f,o,u);this.needsUpload=!1,this._featureMap=new wh,this._featureMapWithoutIds=new wh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,o,u,f,d,g,w,E){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,o,f,d,g,w,E);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,o,u,f,d,g,w){for(const E of u)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,o,E,f,d,g,w||0)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const vb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function xb(c,i){return vb[c]||[c.replace(`${i}-`,"").replace(/-/g,"_")]}const bb={"line-pattern":{source:Qa,composite:Qa},"fill-pattern":{source:Qa,composite:Qa},"fill-extrusion-pattern":{source:Qa,composite:Qa},"line-dasharray":{source:af,composite:af}},_f={color:{source:Hc,composite:Pl},number:{source:Cl,composite:Hc}};function t0(c,i,o){const u=bb[c];return u&&u[o]||_f[i][o]}zt(Mh,"ConstantBinder"),zt(Dl,"PatternConstantBinder"),zt(Ea,"SourceExpressionBinder"),zt(tl,"PatternCompositeBinder"),zt(Mo,"CompositeExpressionBinder"),zt(Rl,"ProgramConfiguration",{omit:["_buffers"]}),zt(il,"ProgramConfigurationSet");const cr=St/Math.PI/2,qc=5,i0=6,n0=16383,Wc=64,yf=[Wc,32,16],Hr=-cr,Gr=cr;function Zc(c,i,o,u=cr){return o=yt(o),[c*Math.sin(o)*u,-i*u,c*Math.cos(o)*u]}function Ll(c,i,o){return Zc(Math.cos(yt(c)),Math.sin(yt(c)),i,o)}const Ol=63710088e-1,Wm=2*Math.PI*Ol;class qi{constructor(i,o){if(isNaN(i)||isNaN(o))throw new Error(`Invalid LngLat object: (${i}, ${o})`);if(this.lng=+i,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qi(Ai(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const o=Math.PI/180,u=this.lat*o,f=i.lat*o,d=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((i.lng-this.lng)*o);return Ol*Math.acos(Math.min(d,1))}toBounds(i=0){const o=360*i/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new nl({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(i){return Ll(this.lat,this.lng,cr+i*cr/Ol)}static convert(i){if(i instanceof qi)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new qi(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new qi(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class nl{constructor(i,o){if(i)if(o)this.setSouthWest(i).setNorthEast(o);else if(i.length===4){const u=i;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=i;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(i){return this._ne=i instanceof qi?new qi(i.lng,i.lat):qi.convert(i),this}setSouthWest(i){return this._sw=i instanceof qi?new qi(i.lng,i.lat):qi.convert(i),this}extend(i){const o=this._sw,u=this._ne;let f,d;if(i instanceof qi)f=i,d=i;else{if(!(i instanceof nl))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(nl.convert(i)):this.extend(qi.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(qi.convert(i)):this;if(f=i._sw,d=i._ne,!f||!d)return this}return o||u?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),u.lng=Math.max(d.lng,u.lng),u.lat=Math.max(d.lat,u.lat)):(this._sw=new qi(f.lng,f.lat),this._ne=new qi(d.lng,d.lat)),this}getCenter(){return new qi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qi(this.getWest(),this.getNorth())}getSouthEast(){return new qi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:o,lat:u}=qi.convert(i);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(i){if(i)return i instanceof nl?i:new nl(i)}}const wb=0,Tb=25.5;function vf(c){return Wm*Math.cos(c*Math.PI/180)}function Zo(c){return(180+c)/360}function Tr(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function js(c,i){return c/vf(i)}function Er(c){return 360*c-180}function Ls(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Zm(c,i){return c*vf(Ls(i))}const Wn=85.051129;function s0(c){return Math.cos(yt(At(c,-Wn,Wn)))}function sl(c,i){const o=At(i,wb,Tb),u=Math.pow(2,o);return s0(c)*Wm/(512*u)}function Eb(c){return 1/Math.cos(c*Math.PI/180)}function m(c,i=0){const o=Math.exp(Math.PI*(1-(c.y+i/St)/(1<<c.z)*2));return 80150034*o/(o*o+1)/St/(1<<c.z)}class n{constructor(i,o,u=0){this.x=+i,this.y=+o,this.z=+u}static fromLngLat(i,o=0){const u=qi.convert(i);return new n(Zo(u.lng),Tr(u.lat),js(o,u.lat))}toLngLat(){return new qi(Er(this.x),Ls(this.y))}toAltitude(){return Zm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Wm*Eb(Ls(this.y))}}function a(c,i,o,u,f,d,g,w,E){const M=(i+u)/2,x=(o+f)/2,S=new Ie(M,x);w(S),function(P,A,C,R,B,N){const G=C-B,H=R-N;return Math.abs((R-A)*G-(C-P)*H)/Math.hypot(G,H)}(S.x,S.y,d.x,d.y,g.x,g.y)>=E?(a(c,i,o,M,x,d,S,w,E),a(c,M,x,u,f,S,g,w,E)):c.push(g)}function p(c,i,o){let u=c[0],f=u.x,d=u.y;i(u);const g=[u];for(let w=1;w<c.length;w++){const E=c[w],{x:M,y:x}=E;i(E),a(g,f,d,M,x,u,E,i,o),f=M,d=x,u=E}return g}function v(c,i,o,u){if(u(i,o)){const f=i.add(o)._mult(.5);v(c,i,f,u),v(c,f,o,u)}else c.push(o)}function b(c,i){let o=c[0];const u=[o];for(let f=1;f<c.length;f++){const d=c[f];v(u,o,d,i),o=d}return u}const T=Math.pow(2,14)-1,D=-T-1;function L(c,i){const o=Math.round(c.x*i),u=Math.round(c.y*i);return c.x=At(o,D,T),c.y=At(u,D,T),(o<c.x||o>c.x+1||u<c.y||u>c.y+1)&&on("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function z(c,i,o){const u=c.loadGeometry(),f=c.extent,d=St/f;if(i&&o&&o.projection.isReprojectedInTileSpace){const g=1<<i.z,{scale:w,x:E,y:M,projection:x}=o,S=P=>{const A=Er((i.x+P.x/f)/g),C=Ls((i.y+P.y/f)/g),R=x.project(A,C);P.x=(R.x*w-E)*f,P.y=(R.y*w-M)*f};for(let P=0;P<u.length;P++)if(c.type!==1)u[P]=p(u[P],S,1);else{const A=[];for(const C of u[P])C.x<0||C.x>=f||C.y<0||C.y>=f||(S(C),A.push(C));u[P]=A}}for(const g of u)for(const w of g)L(w,d);return u}function F(c,i){return{type:c.type,id:c.id,properties:c.properties,geometry:i?z(c):[]}}function V(c,i,o,u,f){c.emplaceBack(2*i+(u+1)/2,2*o+(f+1)/2)}function U(c,i,o){c.emplaceBack(i.x,i.y,i.z,o[0]*16384,o[1]*16384,o[2]*16384)}class q{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new wa,this.indexArray=new Rs,this.segments=new Mn,this.programConfigurations=new il(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(i,o){}populate(i,o,u,f){const d=this.layers[0],g=[];let w=null;d.type==="circle"&&(w=d.layout.get("circle-sort-key"));for(const{feature:M,id:x,index:S,sourceLayerIndex:P}of i){const A=this.layers[0]._featureFilter.needGeometry,C=F(M,A);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),C,u))continue;const R=w?w.evaluate(C,{},u):void 0,B={id:x,properties:M.properties,type:M.type,sourceLayerIndex:P,index:S,geometry:A?C.geometry:z(M,u,f),patterns:{},sortKey:R};g.push(B)}w&&g.sort((M,x)=>M.sortKey-x.sortKey);let E=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new lf,E=f.projection);for(const M of g){const{geometry:x,index:S,sourceLayerIndex:P}=M,A=i[S].feature;this.addFeature(M,x,S,o.availableImages,u,E,o.brightness),o.featureIndex.insert(A,x,S,P,this.index)}}update(i,o,u,f,d,g,w){this.programConfigurations.updatePaintArrays(i,o,d,u,f,g,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,mb.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,gb.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,o,u,f,d,g,w){for(const E of o)for(const M of E){const x=M.x,S=M.y;if(x<0||x>=St||S<0||S>=St)continue;if(g){const C=g.projectTilePoint(x,S,d),R=g.upVector(d,x,S),B=this.globeExtVertexArray;U(B,C,R),U(B,C,R),U(B,C,R),U(B,C,R)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),A=P.vertexLength;V(this.layoutVertexArray,x,S,-1,-1),V(this.layoutVertexArray,x,S,1,-1),V(this.layoutVertexArray,x,S,1,1),V(this.layoutVertexArray,x,S,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},f,d,w)}}function J(c,i){for(let o=0;o<c.length;o++)if(xe(i,c[o]))return!0;for(let o=0;o<i.length;o++)if(xe(c,i[o]))return!0;return!!le(c,i)}function X(c,i,o){return!!xe(c,i)||!!pe(i,c,o)}function ee(c,i){if(c.length===1)return ve(i,c[0]);for(let o=0;o<i.length;o++){const u=i[o];for(let f=0;f<u.length;f++)if(xe(c,u[f]))return!0}for(let o=0;o<c.length;o++)if(ve(i,c[o]))return!0;for(let o=0;o<i.length;o++)if(le(c,i[o]))return!0;return!1}function ie(c,i,o){if(c.length>1){if(le(c,i))return!0;for(let u=0;u<i.length;u++)if(pe(i[u],c,o))return!0}for(let u=0;u<c.length;u++)if(pe(c[u],i,o))return!0;return!1}function le(c,i){if(c.length===0||i.length===0)return!1;for(let o=0;o<c.length-1;o++){const u=c[o],f=c[o+1];for(let d=0;d<i.length-1;d++)if(_e(u,f,i[d],i[d+1]))return!0}return!1}function _e(c,i,o,u){return rn(c,o,u)!==rn(i,o,u)&&rn(c,i,o)!==rn(c,i,u)}function pe(c,i,o){const u=o*o;if(i.length===1)return c.distSqr(i[0])<u;for(let f=1;f<i.length;f++)if(we(c,i[f-1],i[f])<u)return!0;return!1}function we(c,i,o){const u=i.distSqr(o);if(u===0)return c.distSqr(i);const f=((c.x-i.x)*(o.x-i.x)+(c.y-i.y)*(o.y-i.y))/u;return c.distSqr(f<0?i:f>1?o:o.sub(i)._mult(f)._add(i))}function ve(c,i){let o,u,f,d=!1;for(let g=0;g<c.length;g++){o=c[g];for(let w=0,E=o.length-1;w<o.length;E=w++)u=o[w],f=o[E],u.y>i.y!=f.y>i.y&&i.x<(f.x-u.x)*(i.y-u.y)/(f.y-u.y)+u.x&&(d=!d)}return d}function xe(c,i){let o=!1;for(let u=0,f=c.length-1;u<c.length;f=u++){const d=c[u],g=c[f];d.y>i.y!=g.y>i.y&&i.x<(g.x-d.x)*(i.y-d.y)/(g.y-d.y)+d.x&&(o=!o)}return o}function be(c,i,o,u,f){for(const g of c)if(i<=g.x&&o<=g.y&&u>=g.x&&f>=g.y)return!0;const d=[new Ie(i,o),new Ie(i,f),new Ie(u,f),new Ie(u,o)];if(c.length>2){for(const g of d)if(xe(c,g))return!0}for(let g=0;g<c.length-1;g++)if(Ce(c[g],c[g+1],d))return!0;return!1}function Ce(c,i,o){const u=o[0],f=o[2];if(c.x<u.x&&i.x<u.x||c.x>f.x&&i.x>f.x||c.y<u.y&&i.y<u.y||c.y>f.y&&i.y>f.y)return!1;const d=rn(c,i,o[0]);return d!==rn(c,i,o[1])||d!==rn(c,i,o[2])||d!==rn(c,i,o[3])}function Re(c,i,o,u,f,d){let g=i.y-c.y,w=c.x-i.x;if(d=d||0){const E=g*g+w*w;if(E===0)return!0;const M=Math.sqrt(E);g/=M,w/=M}return!((o.x-c.x)*g+(o.y-c.y)*w-d<0||(u.x-c.x)*g+(u.y-c.y)*w-d<0||(f.x-c.x)*g+(f.y-c.y)*w-d<0)}function Je(c,i,o,u,f,d,g){return!(Re(c,i,u,f,d,g)||Re(i,o,u,f,d,g)||Re(o,c,u,f,d,g)||Re(u,f,c,i,o,g)||Re(f,d,c,i,o,g)||Re(d,u,c,i,o,g))}function $e(c,i,o){const u=i.paint.get(c).value;return u.kind==="constant"?u.value:o.programConfigurations.get(i.id).getMaxValue(c)}function ct(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function ut(c,i,o,u,f){if(!i[0]&&!i[1])return c;const d=Ie.convert(i)._mult(f);o==="viewport"&&d._rotate(-u);const g=[];for(let w=0;w<c.length;w++)g.push(c[w].sub(d));return g}function vt(c,i,o,u){const f=Ie.convert(c)._mult(u);return i==="viewport"&&f._rotate(-o),f}let je,at;zt(q,"CircleBucket",{omit:["layers"]});var Ne,ot={exports:{}},st=(Ne||(Ne=1,function(c,i){(function(o){function u(d,g,w){var E=f(256*d,256*(g=Math.pow(2,w)-g-1),w),M=f(256*(d+1),256*(g+1),w);return E[0]+","+E[1]+","+M[0]+","+M[1]}function f(d,g,w){var E=2*Math.PI*6378137/256/Math.pow(2,w);return[d*E-2*Math.PI*6378137/2,g*E-2*Math.PI*6378137/2]}o.getURL=function(d,g,w,E,M,x){return x=x||{},d+"?"+["bbox="+u(w,E,M),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+g].join("&")},o.getTileBBox=u,o.getMercCoords=f,Object.defineProperty(o,"__esModule",{value:!0})})(i)}(0,ot.exports)),ot.exports);class ht{constructor(i,o,u){this.z=i,this.x=o,this.y=u,this.key=Ct(0,i,i,o,u)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,o){const u=st.getTileBBox(this.x,this.y,this.z),f=function(d,g,w){let E,M="";for(let x=d;x>0;x--)E=1<<x-1,M+=(g&E?1:0)+(w&E?2:0);return M}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qe{constructor(i,o){this.wrap=i,this.canonical=o,this.key=Ct(i,o.z,o.z,o.x,o.y)}}class ft{constructor(i,o,u,f,d){this.overscaledZ=i,this.wrap=o,this.canonical=new ht(u,+f,+d),this.key=o===0&&i===u?this.canonical.key:Ct(o,i,u,f,d)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const o=this.canonical.z-i;return i>this.canonical.z?new ft(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ft(i,this.wrap,i,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(i,o=!0){if(this.overscaledZ===i&&o)return this.key;if(i>this.canonical.z)return Ct(this.wrap*+o,i,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-i;return Ct(this.wrap*+o,i,i,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const o=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>o&&i.canonical.y===this.canonical.y>>o}children(i){if(this.overscaledZ>=i)return[new ft(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new ft(o,this.wrap,o,u,f),new ft(o,this.wrap,o,u+1,f),new ft(o,this.wrap,o,u,f+1),new ft(o,this.wrap,o,u+1,f+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new ft(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new ft(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qe(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ct(c,i,o,u,f){const d=1<<Math.min(o,22);let g=d*(f%d)+u%d;return c&&o<22&&(g+=d*d*((c<0?-2*c-1:2*c)%(1<<2*(22-o)))),16*(32*g+o)+(i-o)}const Pt=[c=>{let i=c.canonical.x-1,o=c.wrap;return i<0&&(i=(1<<c.canonical.z)-1,o--),new ft(c.overscaledZ,o,c.canonical.z,i,c.canonical.y)},c=>{let i=c.canonical.x+1,o=c.wrap;return i===1<<c.canonical.z&&(i=0,o++),new ft(c.overscaledZ,o,c.canonical.z,i,c.canonical.y)},c=>new ft(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new ft(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];zt(ht,"CanonicalTileID"),zt(ft,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Dt=Gi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$t}=Dt,pi=Gi([{name:"a_pos_3",components:3,type:"Int16"}]);var ti=Gi([{name:"a_pos",type:"Int16",components:2}]);class hi{constructor(i,o){this.pos=i,this.dir=o}intersectsPlane(i,o,u){const f=ce.vec2.dot(o,this.dir);if(Math.abs(f)<1e-6)return!1;const d=((i[0]-this.pos[0])*o[0]+(i[1]-this.pos[1])*o[1])/f;return u[0]=this.pos[0]+this.dir[0]*d,u[1]=this.pos[1]+this.dir[1]*d,!0}}class oi{constructor(i,o){this.pos=i,this.dir=o}intersectsPlane(i,o,u){const f=ce.vec3.dot(o,this.dir);if(Math.abs(f)<1e-6)return!1;const d=((i[0]-this.pos[0])*o[0]+(i[1]-this.pos[1])*o[1]+(i[2]-this.pos[2])*o[2])/f;return u[0]=this.pos[0]+this.dir[0]*d,u[1]=this.pos[1]+this.dir[1]*d,u[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(i,o,u){if(ce.vec3.equals(this.pos,i)||o===0)return u[0]=u[1]=u[2]=0,!1;const[f,d,g]=this.dir,w=this.pos[0]-i[0],E=this.pos[1]-i[1],M=this.pos[2]-i[2],x=f*f+d*d+g*g,S=2*(w*f+E*d+M*g),P=S*S-4*x*(w*w+E*E+M*M-o*o);if(P<0){const A=Math.max(-S/2,0),C=w+f*A,R=E+d*A,B=M+g*A,N=Math.hypot(C,R,B);return u[0]=C*o/N,u[1]=R*o/N,u[2]=B*o/N,!1}{const A=(-S-Math.sqrt(P))/(2*x);if(A<0){const C=Math.hypot(w,E,M);return u[0]=w*o/C,u[1]=E*o/C,u[2]=M*o/C,!1}return u[0]=w+f*A,u[1]=E+d*A,u[2]=M+g*A,!0}}}class Di{constructor(i,o,u,f,d){this.TL=i,this.TR=o,this.BR=u,this.BL=f,this.horizon=d}static fromInvProjectionMatrix(i,o,u){const f=[-1,1,1],d=[1,1,1],g=[1,-1,1],w=[-1,-1,1],E=ce.vec3.transformMat4(f,f,i),M=ce.vec3.transformMat4(d,d,i),x=ce.vec3.transformMat4(g,g,i),S=ce.vec3.transformMat4(w,w,i);return new Di(E,M,x,S,o/u)}}function Wi(c,i,o){let u=1/0,f=-1/0;const d=[];for(const g of c){ce.vec3.sub(d,g,i);const w=ce.vec3.dot(d,o);u=Math.min(u,w),f=Math.max(f,w)}return[u,f]}function mn(c,i){let o=!0;for(let u=0;u<c.planes.length;u++){const f=c.planes[u];let d=0;for(let g=0;g<i.length;g++)d+=ce.vec3.dot(f,i[g])+f[3]>=0;if(d===0)return 0;d!==i.length&&(o=!1)}return o?2:1}function Si(c,i){for(const o of c.projections){const u=Wi(i,c.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function In(c,i){let o=0;const u=[0,0,0,0];for(let f=0;f<c.length;f++)u[0]=c[f][0],u[1]=c[f][1],u[2]=c[f][2],u[3]=1,ce.vec4.dot(u,i)>=0&&o++;return o}class _i{constructor(i,o){this.points=i||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Ht.fromPoints(this.points),this.projections=[],this.frustumEdges=[ce.vec3.sub([],this.points[2],this.points[3]),ce.vec3.sub([],this.points[0],this.points[3]),ce.vec3.sub([],this.points[4],this.points[0]),ce.vec3.sub([],this.points[5],this.points[1]),ce.vec3.sub([],this.points[6],this.points[2]),ce.vec3.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const f=[0,-u[2],u[1]],d=[u[2],0,-u[0]];this.projections.push({axis:f,projection:Wi(this.points,this.points[0],f)}),this.projections.push({axis:d,projection:Wi(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(i,o,u,f){const d=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const x=ce.vec4.transformMat4([],M,i),S=1/x[3]/o*d;return ce.vec4.mul(x,x,[S,S,f?1/x[3]:S,S])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const x=ce.vec3.sub([],g[M[0]],g[M[1]]),S=ce.vec3.sub([],g[M[2]],g[M[1]]),P=ce.vec3.normalize([],ce.vec3.cross([],x,S)),A=-ce.vec3.dot(P,g[M[1]]);return P.concat(A)}),E=[];for(let M=0;M<g.length;M++)E.push([g[M][0],g[M][1],g[M][2]]);return new _i(E,w)}intersectsPrecise(i,o,u){for(let f=0;f<o.length;f++)if(!In(i,o[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!In(i,this.planes[f]))return 0;for(const f of u)for(const d of this.frustumEdges){const g=ce.vec3.cross([],f,d),w=ce.vec3.length(g);if(w===0)continue;ce.vec3.scale(g,g,1/w);const E=Wi(this.points,this.points[0],g),M=Wi(i,this.points[0],g);if(E[0]>M[1]||M[0]>E[1])return 0}return 1}containsPoint(i){for(const o of this.planes){const u=o[3];if(ce.vec3.dot([o[0],o[1],o[2]],i)+u<0)return!1}return!0}}class Ht{static fromPoints(i){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const f of i)ce.vec3.min(o,o,f),ce.vec3.max(u,u,f);return new Ht(o,u)}static fromTileIdAndHeight(i,o,u){const f=1<<i.canonical.z,d=i.canonical.x,g=i.canonical.y;return new Ht([d/f,g/f,o],[(d+1)/f,(g+1)/f,u])}static applyTransform(i,o){const u=i.getCorners();for(let f=0;f<u.length;++f)ce.vec3.transformMat4(u[f],u[f],o);return Ht.fromPoints(u)}static applyTransformFast(i,o){const u=[o[12],o[13],o[14]],f=[...u];for(let d=0;d<3;d++)for(let g=0;g<3;g++){const w=o[4*g+d],E=w*i.min[g],M=w*i.max[g];u[d]+=Math.min(E,M),f[d]+=Math.max(E,M)}return new Ht(u,f)}static projectAabbCorners(i,o){const u=i.getCorners();for(let f=0;f<u.length;++f)ce.vec3.transformMat4(u[f],u[f],o);return u}constructor(i,o){this.min=i,this.max=o,this.center=ce.vec3.scale([],ce.vec3.add([],this.min,this.max),.5)}quadrant(i){const o=[i%2==0,i<2],u=ce.vec3.clone(this.min),f=ce.vec3.clone(this.max);for(let d=0;d<o.length;d++)u[d]=o[d]?this.min[d]:this.center[d],f[d]=o[d]?this.center[d]:this.max[d];return f[2]=this.max[2],new Ht(u,f)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,o=this.max;return[[i[0],i[1],i[2]],[o[0],i[1],i[2]],[o[0],o[1],i[2]],[i[0],o[1],i[2]],[i[0],i[1],o[2]],[o[0],i[1],o[2]],[o[0],o[1],o[2]],[i[0],o[1],o[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?mn(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?mn(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,o){return o||this.intersects(i)?Si(i,this.getCorners()):0}intersectsPreciseFlat(i,o){return o||this.intersectsFlat(i)?Si(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let o=0;o<3;++o)if(this.min[o]>i.max[o]||i.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],i.min[o]),this.max[o]=Math.max(this.max[o],i.max[o])}encapsulatePoint(i){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],i[o]),this.max[o]=Math.max(this.max[o],i[o])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}function Li(c){return c*cr/Ol}zt(Ht,"Aabb");const en=[new Ht([Hr,Hr,Hr],[Gr,Gr,Gr]),new Ht([Hr,Hr,Hr],[0,0,Gr]),new Ht([0,Hr,Hr],[Gr,0,Gr]),new Ht([Hr,0,Hr],[0,Gr,Gr]),new Ht([0,0,Hr],[Gr,Gr,Gr])];function Vi(c,i,o,u=!0){const f=ce.vec3.scale([],c._camera.position,c.worldSize),d=[i,o,1,1];ce.vec4.transformMat4(d,d,c.pixelMatrixInverse),ce.vec4.scale(d,d,1/d[3]);const g=ce.vec3.sub([],d,f),w=ce.vec3.normalize([],g),E=c.globeMatrix,M=[E[12],E[13],E[14]],x=ce.vec3.sub([],M,f),S=ce.vec3.length(x),P=ce.vec3.normalize([],x),A=c.worldSize/(2*Math.PI),C=ce.vec3.dot(P,w),R=Math.asin(A/S);if(R<Math.acos(C)){if(!u)return null;const Ee=[],he=[];ce.vec3.scale(Ee,w,S/C),ce.vec3.normalize(he,ce.vec3.sub(he,Ee,x)),ce.vec3.normalize(w,ce.vec3.add(w,x,ce.vec3.scale(w,he,Math.tan(R)*S)))}const B=[];new oi(f,w).closestPointOnSphere(M,A,B);const N=ce.vec3.normalize([],uc(E,0)),G=ce.vec3.normalize([],uc(E,1)),H=ce.vec3.normalize([],uc(E,2)),$=ce.vec3.dot(N,B),W=ce.vec3.dot(G,B),K=ce.vec3.dot(H,B),Q=Xt(Math.asin(-W/A));let ue=Xt(Math.atan2($,K));ue=c.center.lng+function(Ee,he){const Se=(he-Ee+180)%360-180;return Se<-180?Se+360:Se}(c.center.lng,ue);const oe=Zo(ue),ae=At(Tr(Q),0,1);return new n(oe,ae)}class Nn{constructor(i,o,u){this.a=ce.vec3.sub([],i,u),this.b=ce.vec3.sub([],o,u),this.center=u;const f=ce.vec3.normalize([],this.a),d=ce.vec3.normalize([],this.b);this.angle=Math.acos(ce.vec3.dot(f,d))}}function Jn(c,i){if(c.angle===0)return null;let o;return o=c.a[i]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[i]/c.a[i]/Math.sin(c.angle)-1/Math.tan(c.angle)),o<0||o>1?null:function(u,f,d,g){const w=Math.sin(d);return u*(Math.sin((1-g)*d)/w)+f*(Math.sin(g*d)/w)}(c.a[i],c.b[i],c.angle,At(o,0,1))+c.center[i]}function fs(c){if(c.z<=1)return en[c.z+2*c.y+c.x];const i=Cn(zi(c));return Ht.fromPoints(i)}function xs(c,i,o){return ce.vec3.scale(c,c,1-o),ce.vec3.scaleAndAdd(c,c,i,o)}function qr(c,i,o){for(const u of c)ce.vec3.transformMat4(u,u,i),ce.vec3.scale(u,u,o)}function Js(c,i,o,u){const f=i/c.worldSize,d=c.globeMatrix;if(o.z<=1){const oe=fs(o).getCorners();return qr(oe,d,f),Ht.fromPoints(oe)}const g=zi(o,u),w=Cn(g,cr+Li(c._tileCoverLift));qr(w,d,f);const E=Number.MAX_VALUE,M=[-E,-E,-E],x=[E,E,E];if(g.contains(c.center)){for(const Ee of w)ce.vec3.min(x,x,Ee),ce.vec3.max(M,M,Ee);M[2]=0;const oe=c.point,ae=[oe.x*f,oe.y*f,0];return ce.vec3.min(x,x,ae),ce.vec3.max(M,M,ae),new Ht(x,M)}if(c._tileCoverLift>0){for(const oe of w)ce.vec3.min(x,x,oe),ce.vec3.max(M,M,oe);return new Ht(x,M)}const S=[d[12]*f,d[13]*f,d[14]*f],P=g.getCenter(),A=At(c.center.lat,-Wn,Wn),C=At(P.lat,-Wn,Wn),R=Zo(c.center.lng),B=Tr(A);let N=R-Zo(P.lng);const G=B-Tr(C);N>.5?N-=1:N<-.5&&(N+=1);let H=0;if(Math.abs(N)>Math.abs(G))H=N>=0?1:3;else{H=G>=0?0:2;const oe=[d[4]*f,d[5]*f,d[6]*f],ae=-Math.sin(yt(G>=0?g.getSouth():g.getNorth()))*cr;ce.vec3.scaleAndAdd(S,S,oe,ae)}const $=w[H],W=w[(H+1)%4],K=new Nn($,W,S),Q=[Jn(K,0)||$[0],Jn(K,1)||$[1],Jn(K,2)||$[2]],ue=gr(c.zoom);if(ue>0){const oe=function({x:Ee,y:he,z:Se},Le,De,Fe,ke){const He=1/(1<<Se);let Ve=Ee*He,qe=Ve+He,pt=he*He,dt=pt+He,Ft=0;const _t=(Ve+qe)/2-Fe;return _t>.5?Ft=-1:_t<-.5&&(Ft=1),Ve=((Ve+Ft)*Le-(Fe*=Le))*De+Fe,qe=((qe+Ft)*Le-Fe)*De+Fe,pt=(pt*Le-(ke*=Le))*De+ke,dt=(dt*Le-ke)*De+ke,[[Ve,dt,0],[qe,dt,0],[qe,pt,0],[Ve,pt,0]]}(o,i,c._pixelsPerMercatorPixel,R,B);for(let Ee=0;Ee<w.length;Ee++)xs(w[Ee],oe[Ee],ue);const ae=ce.vec3.add([],oe[H],oe[(H+1)%4]);ce.vec3.scale(ae,ae,.5),xs(Q,ae,ue)}for(const oe of w)ce.vec3.min(x,x,oe),ce.vec3.max(M,M,oe);return x[2]=Math.min($[2],W[2]),ce.vec3.min(x,x,Q),ce.vec3.max(M,M,Q),new Ht(x,M)}function zi({x:c,y:i,z:o},u=!1){const f=1/(1<<o),d=new qi(Er(c*f),i===(1<<o)-1&&u?-90:Ls((i+1)*f)),g=new qi(Er((c+1)*f),i===0&&u?90:Ls(i*f));return new nl(d,g)}function Cn(c,i=cr){const o=yt(c.getNorth()),u=yt(c.getSouth()),f=Math.cos(o),d=Math.cos(u),g=Math.sin(o),w=Math.sin(u),E=c.getWest(),M=c.getEast();return[Zc(d,w,E,i),Zc(d,w,M,i),Zc(f,g,M,i),Zc(f,g,E,i)]}function Zi(c,i,o,u){const f=1<<o.z,d=(c/St+o.x)/f;return Ll(Ls((i/St+o.y)/f),Er(d),u)}function hn({min:c,max:i}){return n0/Math.max(i[0]-c[0],i[1]-c[1],i[2]-c[2])}const Os=new Float64Array(16);function Tn(c){const i=hn(c),o=ce.mat4.fromScaling(Os,[i,i,i]);return ce.mat4.translate(o,o,ce.vec3.negate([],c.min))}function ps(c){const i=ce.mat4.fromTranslation(Os,c.min),o=1/hn(c);return ce.mat4.scale(i,i,[o,o,o])}function Xo(c){const i=St/(2*Math.PI);return c/(2*Math.PI)/i}function Sr(c,i){return St/(512*Math.pow(2,c))*hn(fs(i))}function co(c,i,o,u,f){const d=Xo(o),g=[c,i,-o/(2*Math.PI)],w=ce.mat4.identity(new Float64Array(16));return ce.mat4.translate(w,w,g),ce.mat4.scale(w,w,[d,d,d]),ce.mat4.rotateX(w,w,yt(-f)),ce.mat4.rotateY(w,w,yt(-u)),w}function gr(c){return ci(qc,i0,c)}function uo(c,i){const o=Ll(i.lat,i.lng),u=function(d){const g=Ll(d._center.lat,d._center.lng),w=ce.vec3.fromValues(0,1,0);let E=ce.vec3.cross([],w,g);const M=ce.mat4.fromRotation([],-d.angle,g);E=ce.vec3.transformMat4(E,E,M),ce.mat4.fromRotation(M,-d._pitch,E);const x=ce.vec3.normalize([],g);return ce.vec3.scale(x,x,Li(d.cameraToCenterDistance/d.pixelsPerMeter)),ce.vec3.transformMat4(x,x,M),ce.vec3.add([],g,x)}(c),f=ce.vec3.subtract([],u,o);return ce.vec3.angle(f,o)}function Ar(c,i){return uo(c,i)>Math.PI/2*1.01}const Sa=yt(85),Yo=Math.cos(Sa),Aa=Math.sin(Sa),Xm=ce.mat4.create(),Xc=c=>{const i=[];return c.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function xf(c,i,o,u,f,d,g,w,E){if(d&&c.queryGeometry.isAboveHorizon)return!1;d&&(E*=c.pixelToTileUnitsFactor);const M=c.tileID.canonical,x=o.projection.upVectorScale(M,o.center.lat,o.worldSize).metersToTile;for(const S of i)for(const P of S){const A=P.add(w),C=f&&o.elevation?o.elevation.exaggeration()*f.getElevationAt(A.x,A.y,!0):0,R=o.projection.projectTilePoint(A.x,A.y,M);if(C>0){const H=o.projection.upVector(M,A.x,A.y);R.x+=H[0]*x*C,R.y+=H[1]*x*C,R.z+=H[2]*x*C}const B=d?A:Ym(R.x,R.y,R.z,u),N=d?c.tilespaceRays.map(H=>dF(H,C)):c.queryGeometry.screenGeometry,G=ce.vec4.transformMat4([],[R.x,R.y,R.z,1],u);if(!g&&d?E*=G[3]/o.cameraToCenterDistance:g&&!d&&(E*=o.cameraToCenterDistance/G[3]),d){const H=Ls((P.y/St+M.y)/(1<<M.z));E/=o.projection.pixelsPerMeter(H,1)/js(1,H)}if(X(N,B,E))return!0}return!1}function Ym(c,i,o,u){const f=ce.vec4.transformMat4([],[c,i,o,1],u);return new Ie(f[0]/f[3],f[1]/f[3])}const M2=ce.vec3.fromValues(0,0,0),hF=ce.vec3.fromValues(0,0,1);function dF(c,i){const o=ce.vec3.create();return M2[2]=i,c.intersectsPlane(M2,hF,o),new Ie(o[0],o[1])}class I2 extends q{}let C2,P2,D2,R2;function L2(c,{width:i,height:o},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==i*o*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(i*o*u);return c.width=i,c.height=o,c.data=f,c}function O2(c,i,o){const{width:u,height:f}=i;u===c.width&&f===c.height||(Sb(c,i,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,u),height:Math.min(c.height,f)},o,null),c.width=u,c.height=f,c.data=i.data)}function Sb(c,i,o,u,f,d,g,w){if(f.width===0||f.height===0)return i;if(f.width>c.width||f.height>c.height||o.x>c.width-f.width||o.y>c.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>i.width||f.height>i.height||u.x>i.width-f.width||u.y>i.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const E=c.data,M=i.data,x=d===4&&w;for(let S=0;S<f.height;S++){const P=((o.y+S)*c.width+o.x)*d,A=((u.y+S)*i.width+u.x)*d;if(x)for(let C=0;C<f.width;C++){const R=P+C*d+3,B=A+C*d;M[B+0]=255,M[B+1]=255,M[B+2]=255,M[B+3]=E[R]}else if(g)for(let C=0;C<f.width;C++){const R=P+C*d,B=A+C*d,N=E[R+3],G=new Qi(E[R+0]/255*N,E[R+1]/255*N,E[R+2]/255*N,N).toRenderColor(g).toArray();M[B+0]=G[0],M[B+1]=G[1],M[B+2]=G[2],M[B+3]=G[3]}else for(let C=0;C<f.width*d;C++)M[A+C]=E[P+C]}return i}zt(I2,"HeatmapBucket",{omit:["layers"]});class Yc{constructor(i,o){L2(this,i,1,o)}resize(i){O2(this,new Yc(i),1)}clone(){return new Yc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,u,f,d){Sb(i,o,u,f,d,1,null)}}class $s{constructor(i,o){L2(this,i,4,o)}resize(i){O2(this,new $s(i),4)}replace(i,o){o?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new $s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,u,f,d,g,w){Sb(i,o,u,f,d,4,g,w)}}class k2{constructor(i,o){this.width=i.width,this.height=i.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function Km(c){const i={},o=c.resolution||256,u=c.clips?c.clips.length:1,f=c.image||new $s({width:o,height:u}),d=(g,w,E)=>{i[c.evaluationKey]=E;const M=c.expression.evaluate(i);M&&(f.data[g+w+0]=Math.floor(255*M.r/M.a),f.data[g+w+1]=Math.floor(255*M.g/M.a),f.data[g+w+2]=Math.floor(255*M.b/M.a),f.data[g+w+3]=Math.floor(255*M.a))};if(c.clips)for(let g=0,w=0;g<u;++g,w+=4*o)for(let E=0,M=0;E<o;E++,M+=4){const x=E/(o-1),{start:S,end:P}=c.clips[g];d(w,M,S*(1-x)+P*x)}else for(let g=0,w=0;g<o;g++,w+=4)d(0,w,g/(o-1));return f}zt(Yc,"AlphaImage"),zt($s,"RGBAImage");const fF=Gi([{name:"a_pos",components:2,type:"Int16"}],4),pF=Gi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),mF=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),gF=Gi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Jm(c,i,o=2){const u=i&&i.length,f=u?i[0]*o:c.length;let d=z2(c,0,f,o,!0);const g=[];if(!d||d.next===d.prev)return g;let w,E,M;if(u&&(d=function(x,S,P,A){const C=[];for(let R=0,B=S.length;R<B;R++){const N=z2(x,S[R]*A,R<B-1?S[R+1]*A:x.length,A,!1);N===N.next&&(N.steiner=!0),C.push(EF(N))}C.sort(bF);for(let R=0;R<C.length;R++)P=wF(C[R],P);return P}(c,i,d,o)),c.length>80*o){w=1/0,E=1/0;let x=-1/0,S=-1/0;for(let P=o;P<f;P+=o){const A=c[P],C=c[P+1];A<w&&(w=A),C<E&&(E=C),A>x&&(x=A),C>S&&(S=C)}M=Math.max(x-w,S-E),M=M!==0?32767/M:0}return Qm(d,g,o,w,E,M,0),g}function z2(c,i,o,u,f){let d;if(f===function(g,w,E,M){let x=0;for(let S=w,P=E-M;S<E;S+=M)x+=(g[P]-g[S])*(g[S+1]+g[P+1]),P=S;return x}(c,i,o,u)>0)for(let g=i;g<o;g+=u)d=N2(g/u|0,c[g],c[g+1],d);else for(let g=o-u;g>=i;g-=u)d=N2(g/u|0,c[g],c[g+1],d);return d&&r0(d,d.next)&&(tg(d),d=d.next),d}function Ih(c,i){if(!c)return c;i||(i=c);let o,u=c;do if(o=!1,u.steiner||!r0(u,u.next)&&bs(u.prev,u,u.next)!==0)u=u.next;else{if(tg(u),u=i=u.prev,u===u.next)break;o=!0}while(o||u!==i);return i}function Qm(c,i,o,u,f,d,g){if(!c)return;!g&&d&&function(E,M,x,S){let P=E;do P.z===0&&(P.z=Ab(P.x,P.y,M,x,S)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==E);P.prevZ.nextZ=null,P.prevZ=null,function(A){let C,R=1;do{let B,N=A;A=null;let G=null;for(C=0;N;){C++;let H=N,$=0;for(let K=0;K<R&&($++,H=H.nextZ,H);K++);let W=R;for(;$>0||W>0&&H;)$!==0&&(W===0||!H||N.z<=H.z)?(B=N,N=N.nextZ,$--):(B=H,H=H.nextZ,W--),G?G.nextZ=B:A=B,B.prevZ=G,G=B;N=H}G.nextZ=null,R*=2}while(C>1)}(P)}(c,u,f,d);let w=c;for(;c.prev!==c.next;){const E=c.prev,M=c.next;if(d?yF(c,u,f,d):_F(c))i.push(E.i,c.i,M.i),tg(c),c=M.next,w=M.next;else if((c=M)===w){g?g===1?Qm(c=vF(Ih(c),i),i,o,u,f,d,2):g===2&&xF(c,i,o,u,f,d):Qm(Ih(c),i,o,u,f,d,1);break}}}function _F(c){const i=c.prev,o=c,u=c.next;if(bs(i,o,u)>=0)return!1;const f=i.x,d=o.x,g=u.x,w=i.y,E=o.y,M=u.y,x=f<d?f<g?f:g:d<g?d:g,S=w<E?w<M?w:M:E<M?E:M,P=f>d?f>g?f:g:d>g?d:g,A=w>E?w>M?w:M:E>M?E:M;let C=u.next;for(;C!==i;){if(C.x>=x&&C.x<=P&&C.y>=S&&C.y<=A&&bf(f,w,d,E,g,M,C.x,C.y)&&bs(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function yF(c,i,o,u){const f=c.prev,d=c,g=c.next;if(bs(f,d,g)>=0)return!1;const w=f.x,E=d.x,M=g.x,x=f.y,S=d.y,P=g.y,A=w<E?w<M?w:M:E<M?E:M,C=x<S?x<P?x:P:S<P?S:P,R=w>E?w>M?w:M:E>M?E:M,B=x>S?x>P?x:P:S>P?S:P,N=Ab(A,C,i,o,u),G=Ab(R,B,i,o,u);let H=c.prevZ,$=c.nextZ;for(;H&&H.z>=N&&$&&$.z<=G;){if(H.x>=A&&H.x<=R&&H.y>=C&&H.y<=B&&H!==f&&H!==g&&bf(w,x,E,S,M,P,H.x,H.y)&&bs(H.prev,H,H.next)>=0||(H=H.prevZ,$.x>=A&&$.x<=R&&$.y>=C&&$.y<=B&&$!==f&&$!==g&&bf(w,x,E,S,M,P,$.x,$.y)&&bs($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;H&&H.z>=N;){if(H.x>=A&&H.x<=R&&H.y>=C&&H.y<=B&&H!==f&&H!==g&&bf(w,x,E,S,M,P,H.x,H.y)&&bs(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;$&&$.z<=G;){if($.x>=A&&$.x<=R&&$.y>=C&&$.y<=B&&$!==f&&$!==g&&bf(w,x,E,S,M,P,$.x,$.y)&&bs($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function vF(c,i){let o=c;do{const u=o.prev,f=o.next.next;!r0(u,f)&&F2(u,o,o.next,f)&&eg(u,f)&&eg(f,u)&&(i.push(u.i,o.i,f.i),tg(o),tg(o.next),o=c=f),o=o.next}while(o!==c);return Ih(o)}function xF(c,i,o,u,f,d){let g=c;do{let w=g.next.next;for(;w!==g.prev;){if(g.i!==w.i&&SF(g,w)){let E=B2(g,w);return g=Ih(g,g.next),E=Ih(E,E.next),Qm(g,i,o,u,f,d,0),void Qm(E,i,o,u,f,d,0)}w=w.next}g=g.next}while(g!==c)}function bF(c,i){return c.x-i.x}function wF(c,i){const o=function(f,d){let g=d;const w=f.x,E=f.y;let M,x=-1/0;do{if(E<=g.y&&E>=g.next.y&&g.next.y!==g.y){const R=g.x+(E-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(R<=w&&R>x&&(x=R,M=g.x<g.next.x?g:g.next,R===w))return M}g=g.next}while(g!==d);if(!M)return null;const S=M,P=M.x,A=M.y;let C=1/0;g=M;do{if(w>=g.x&&g.x>=P&&w!==g.x&&bf(E<A?w:x,E,P,A,E<A?x:w,E,g.x,g.y)){const R=Math.abs(E-g.y)/(w-g.x);eg(g,f)&&(R<C||R===C&&(g.x>M.x||g.x===M.x&&TF(M,g)))&&(M=g,C=R)}g=g.next}while(g!==S);return M}(c,i);if(!o)return i;const u=B2(o,c);return Ih(u,u.next),Ih(o,o.next)}function TF(c,i){return bs(c.prev,c,i.prev)<0&&bs(i.next,c,c.next)<0}function Ab(c,i,o,u,f){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-o)*f|0)|c<<8))|c<<4))|c<<2))|c<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-u)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function EF(c){let i=c,o=c;do(i.x<o.x||i.x===o.x&&i.y<o.y)&&(o=i),i=i.next;while(i!==c);return o}function bf(c,i,o,u,f,d,g,w){return(f-g)*(i-w)>=(c-g)*(d-w)&&(c-g)*(u-w)>=(o-g)*(i-w)&&(o-g)*(d-w)>=(f-g)*(u-w)}function SF(c,i){return c.next.i!==i.i&&c.prev.i!==i.i&&!function(o,u){let f=o;do{if(f.i!==o.i&&f.next.i!==o.i&&f.i!==u.i&&f.next.i!==u.i&&F2(f,f.next,o,u))return!0;f=f.next}while(f!==o);return!1}(c,i)&&(eg(c,i)&&eg(i,c)&&function(o,u){let f=o,d=!1;const g=(o.x+u.x)/2,w=(o.y+u.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&g<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(d=!d),f=f.next;while(f!==o);return d}(c,i)&&(bs(c.prev,c,i.prev)||bs(c,i.prev,i))||r0(c,i)&&bs(c.prev,c,c.next)>0&&bs(i.prev,i,i.next)>0)}function bs(c,i,o){return(i.y-c.y)*(o.x-i.x)-(i.x-c.x)*(o.y-i.y)}function r0(c,i){return c.x===i.x&&c.y===i.y}function F2(c,i,o,u){const f=a0(bs(c,i,o)),d=a0(bs(c,i,u)),g=a0(bs(o,u,c)),w=a0(bs(o,u,i));return f!==d&&g!==w||!(f!==0||!o0(c,o,i))||!(d!==0||!o0(c,u,i))||!(g!==0||!o0(o,c,u))||!(w!==0||!o0(o,i,u))}function o0(c,i,o){return i.x<=Math.max(c.x,o.x)&&i.x>=Math.min(c.x,o.x)&&i.y<=Math.max(c.y,o.y)&&i.y>=Math.min(c.y,o.y)}function a0(c){return c>0?1:c<0?-1:0}function eg(c,i){return bs(c.prev,c,c.next)<0?bs(c,i,c.next)>=0&&bs(c,c.prev,i)>=0:bs(c,i,c.prev)<0||bs(c,c.next,i)<0}function B2(c,i){const o=Mb(c.i,c.x,c.y),u=Mb(i.i,i.x,i.y),f=c.next,d=i.prev;return c.next=i,i.prev=c,o.next=f,f.prev=o,u.next=o,o.prev=u,d.next=u,u.prev=d,u}function N2(c,i,o,u){const f=Mb(c,i,o);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function tg(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Mb(c,i,o){return{i:c,x:i,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function l0(c,i){const o=c.length;if(o<=1)return[c];const u=[];let f,d;for(let g=0;g<o;g++){const w=Hu(c[g]);w!==0&&(c[g].area=Math.abs(w),d===void 0&&(d=w<0),d===w<0?(f&&u.push(f),f=[c[g]]):f.push(c[g]))}if(f&&u.push(f),i>1)for(let g=0;g<u.length;g++)u[g].length<=i||(fy(u[g],i,1,u[g].length-1,AF),u[g]=u[g].slice(0,i));return u}function AF(c,i){return i.area-c.area}function V2(c,i,o=1){if(!c)return null;const u=typeof c=="string"?Ks.from(c).getPrimary():c.getPrimary(),f=u.id.toString();return i.has(f)||i.set(f,[]),u.scaleSelf(o),i.get(f).push(u),u.toString()}function Ib(c,i,o,u){const f=u.patternDependencies;let d=!1;for(const g of i){const w=g.paint.get(`${c}-pattern`);w.isConstant()||(d=!0),V2(w.constantOr(null),f,o)&&(d=!0)}return d}function Cb(c,i,o,u,f,d){const g=d.patternDependencies;for(const w of i){const E=w.paint.get(`${c}-pattern`).value;if(E.kind!=="constant"){let M=E.evaluate({zoom:u},o,{},d.availableImages);M=M&&M.name?M.name:M;const x=V2(M,g,f);x&&(o.patterns[w.id]=x)}}return o}var Pb,U2,Db,j2,Rb,$2,H2,c0={};function G2(){if(U2)return Pb;U2=1;var c=Ze();function i(f,d,g,w,E){this.properties={},this.extent=g,this.type=0,this._pbf=f,this._geometry=-1,this._keys=w,this._values=E,f.readFields(o,this,d)}function o(f,d,g){f==1?d.id=g.readVarint():f==2?function(w,E){for(var M=w.readVarint()+w.pos;w.pos<M;){var x=E._keys[w.readVarint()],S=E._values[w.readVarint()];E.properties[x]=S}}(g,d):f==3?d.type=g.readVarint():f==4&&(d._geometry=g.pos)}function u(f){for(var d,g,w=0,E=0,M=f.length,x=M-1;E<M;x=E++)w+=((g=f[x]).x-(d=f[E]).x)*(d.y+g.y);return w}return Pb=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var d,g=f.readVarint()+f.pos,w=1,E=0,M=0,x=0,S=[];f.pos<g;){if(E<=0){var P=f.readVarint();w=7&P,E=P>>3}if(E--,w===1||w===2)M+=f.readSVarint(),x+=f.readSVarint(),w===1&&(d&&S.push(d),d=[]),d.push(new c(M,x));else{if(w!==7)throw new Error("unknown command "+w);d&&d.push(d[0].clone())}}return d&&S.push(d),S},i.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var d=f.readVarint()+f.pos,g=1,w=0,E=0,M=0,x=1/0,S=-1/0,P=1/0,A=-1/0;f.pos<d;){if(w<=0){var C=f.readVarint();g=7&C,w=C>>3}if(w--,g===1||g===2)(E+=f.readSVarint())<x&&(x=E),E>S&&(S=E),(M+=f.readSVarint())<P&&(P=M),M>A&&(A=M);else if(g!==7)throw new Error("unknown command "+g)}return[x,P,S,A]},i.prototype.toGeoJSON=function(f,d,g){var w,E,M=this.extent*Math.pow(2,g),x=this.extent*f,S=this.extent*d,P=this.loadGeometry(),A=i.types[this.type];function C(N){for(var G=0;G<N.length;G++){var H=N[G];N[G]=[360*(H.x+x)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+S)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(w=0;w<P.length;w++)R[w]=P[w][0];C(P=R);break;case 2:for(w=0;w<P.length;w++)C(P[w]);break;case 3:for(P=function(N){var G=N.length;if(G<=1)return[N];for(var H,$,W=[],K=0;K<G;K++){var Q=u(N[K]);Q!==0&&($===void 0&&($=Q<0),$===Q<0?(H&&W.push(H),H=[N[K]]):H.push(N[K]))}return H&&W.push(H),W}(P),w=0;w<P.length;w++)for(E=0;E<P[w].length;E++)C(P[w][E])}P.length===1?P=P[0]:A="Multi"+A;var B={type:"Feature",geometry:{type:A,coordinates:P},properties:this.properties};return"id"in this&&(B.id=this.id),B},Pb}function q2(){if(j2)return Db;j2=1;var c=G2();function i(u,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(o,this,f),this.length=this._features.length}function o(u,f,d){u===15?f.version=d.readVarint():u===1?f.name=d.readString():u===5?f.extent=d.readVarint():u===2?f._features.push(d.pos):u===3?f._keys.push(d.readString()):u===4&&f._values.push(function(g){for(var w=null,E=g.readVarint()+g.pos;g.pos<E;){var M=g.readVarint()>>3;w=M===1?g.readString():M===2?g.readFloat():M===3?g.readDouble():M===4?g.readVarint64():M===5?g.readVarint():M===6?g.readSVarint():M===7?g.readBoolean():null}return w}(d))}return Db=i,i.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var f=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,f,this.extent,this._keys,this._values)},Db}function W2(){return H2||(H2=1,c0.VectorTile=function(){if($2)return Rb;$2=1;var c=q2();function i(o,u,f){if(o===3){var d=new c(f,f.readVarint()+f.pos);d.length&&(u[d.name]=d)}}return Rb=function(o,u){this.layers=o.readFields(i,{},u)},Rb}(),c0.VectorTileFeature=G2(),c0.VectorTileLayer=q2()),c0}var Kc=W2();const Ch="3d_elevation_id",Z2="level";class MF{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,o){return this._valid&&i(o(this._geometry)),this}require(i,o,u){return this.get(i,!0,o,u)}optional(i,o,u){return this.get(i,!1,o,u)}success(){return this._valid}get(i,o,u,f){const d=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&d!==void 0?u(f?f(d):d):o&&(this._valid=!1),this}}class X2{constructor(i,o){this.featureFunc=i,this.vertexFunc=o}parseFeature(i,o,u){return this.featureFunc(i,o,u)}parseVertex(i,o,u){return this.vertexFunc(i,o,u)}}const IF=new X2((c,i,o)=>c.reset(i).require(Ch,u=>{o.id=u}).optional("fixed_height_relative",u=>{o.constantHeight=u},kl.decodeRelativeHeight).geometry(u=>{o.bounds=u},kl.computeBounds).success(),(c,i,o)=>c.reset(i).require(Ch,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height_relative",u=>{o.height=u},kl.decodeRelativeHeight).geometry(u=>{o.position=u},kl.getPoint).success()),CF=new X2((c,i,o)=>c.reset(i).require(Ch,u=>{o.id=u}).optional("fixed_height",u=>{o.constantHeight=u},kl.decodeMetricHeight).geometry(u=>{o.bounds=u},kl.computeBounds).success(),(c,i,o)=>c.reset(i).require(Ch,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height",u=>{o.height=u},kl.decodeMetricHeight).geometry(u=>{o.position=u},kl.getPoint).success());class kl{static computeBounds(i){const o=new Ie(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=new Ie(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const f of i[0])o.x>f.x&&(o.x=f.x),o.y>f.y&&(o.y=f.y),u.x<f.x&&(u.x=f.x),u.y<f.y&&(u.y=f.y);return{min:o,max:u}}static getPoint(i){return ce.vec2.fromValues(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static parse(i){const o=[],u=[],f=i.length,d=new MF;for(let w=0;w<f;w++){const E=i.feature(w),M=E.properties.hasOwnProperty("version")?String(E.properties.version):void 0,x=(g=M)?g==="1.0.1"?CF:void 0:IF;if(x===void 0){on(`Unknown elevation feature version number ${M||"(unknown)"}`);continue}const S=E.properties.hasOwnProperty("type")?E.properties.type:void 0;if(S){if(Kc.VectorTileFeature.types[E.type]==="Point"&&S==="curve_point"){const P={};x.parseVertex(d,E,P)&&o.push(P)}else if(Kc.VectorTileFeature.types[E.type]==="Polygon"&&S==="curve_meta"){const P={};x.parseFeature(d,E,P)&&u.push(P)}}}var g;return{vertices:o,features:u}}}class Lb{constructor(i,o,u,f,d,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=i,this.heightRange={min:u,max:u},this.safeArea=o,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||f.length!==0)){this.vertices=f,this.edges=d,this.edges=this.edges.filter(w=>w.a<this.vertices.length&&w.b<this.vertices.length&&!ce.vec2.exactEquals(this.vertices[w.a].position,this.vertices[w.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:ce.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const E=this.vertices[w.a].position,M=this.vertices[w.b].position,x=ce.vec2.subtract(ce.vec2.create(),M,E),S=ce.vec2.length(x),P=ce.vec2.scale(ce.vec2.create(),x,1/S);this.edgeProps.push({vec:x,dir:P,len:S});const A=this.vertexProps[w.a].dir,C=this.vertexProps[w.b].dir;ce.vec2.add(A,A,P),ce.vec2.add(C,C,P)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||ce.vec2.normalize(w.dir,w.dir);this.tessellate(g)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const o=this.getClosestEdge(i);if(o==null)return 0;const[u,f]=o;return((d,g,w)=>(1-w)*d+w*g)(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,f)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let o=0,u=Number.POSITIVE_INFINITY,f=0;const d=ce.vec2.fromValues(i.x,i.y);for(let g=0;g<this.edges.length;g++){const w=this.edges[g],E=this.edgeProps[g].dir,M=new hi(d,this.edgeProps[g].dir),x=this.vertices[w.a].position,S=this.vertices[w.b].position,P=ce.vec2.create(),A=ce.vec2.create(),C=M.intersectsPlane(x,this.vertexProps[w.a].dir,P),R=M.intersectsPlane(S,this.vertexProps[w.b].dir,A);if(!C||!R)continue;const B=ce.vec2.subtract(ce.vec2.create(),A,P),N=ce.vec2.subtract(ce.vec2.create(),d,P),G=ce.vec2.dot(B,B),H=G>0?ce.vec2.dot(N,B)/G:0,$=At(H,0,1),W=Math.abs((H-$)*this.edgeProps[g].len),K=ce.vec2.subtract(ce.vec2.create(),d,x),Q=W+Math.abs(ce.vec2.dot(K,ce.vec2.fromValues(E[1],-E[0])));Q<u&&(o=g,u=Q,f=$)}return[o,f]}tessellate(i){for(let o=this.edges.length-1;o>=0;--o){const u=this.edges[o].a,f=this.edges[o].b,{position:d,height:g,extent:w}=this.vertices[u],{position:E,height:M,extent:x}=this.vertices[f],S=this.vertexProps[u].dir,P=this.vertexProps[f].dir,A=ce.vec3.fromValues(d[0]/i,d[1]/i,g),C=ce.vec3.fromValues(E[0]/i,E[1]/i,M),R=ce.vec3.fromValues(S[1],-S[0],0);ce.vec3.scale(R,R,w);const B=ce.vec3.fromValues(P[1],-P[0],0);if(ce.vec3.scale(B,B,x),this.distSqLines(ce.vec3.fromValues(A[0]+.5*R[0],A[1]+.5*R[1],A[2]+.5*R[2]),ce.vec3.fromValues(C[0]-.5*B[0],C[1]-.5*B[1],C[2]-.5*B[2]),ce.vec3.fromValues(A[0]-.5*R[0],A[1]-.5*R[1],A[2]-.5*R[2]),ce.vec3.fromValues(C[0]+.5*B[0],C[1]+.5*B[1],C[2]+.5*B[2]))<=.05*.05)continue;const N=this.vertices.length,G=ce.vec2.add(ce.vec2.create(),d,E);this.vertices.push({position:ce.vec2.scale(G,G,.5),height:.5*(g+M),extent:.5*(w+x)});const H=ce.vec2.add(ce.vec2.create(),S,P);this.vertexProps.push({dir:ce.vec2.normalize(H,H)}),this.edges.splice(o,1),this.edgeProps.splice(o,1),this.edges.push({a:u,b:N}),this.edges.push({a:N,b:f});const $=ce.vec2.subtract(ce.vec2.create(),this.vertices[N].position,d),W=ce.vec2.length($),K={vec:$,dir:ce.vec2.scale(ce.vec2.create(),$,1/W),len:W};this.edgeProps.push(K),this.edgeProps.push(K)}}distSqLines(i,o,u,f){const d=ce.vec3.subtract(ce.vec3.create(),o,i),g=ce.vec3.subtract(ce.vec3.create(),f,u),w=ce.vec3.subtract(ce.vec3.create(),i,u),E=ce.vec3.dot(d,d),M=ce.vec3.dot(d,g),x=ce.vec3.dot(d,w),S=ce.vec3.dot(g,g),P=ce.vec3.dot(g,w),A=E*S-M*M;if(A===0){const G=ce.vec3.dot(w,g)/ce.vec3.dot(g,g),H=ce.vec3.lerp(ce.vec3.create(),u,f,G);return ce.vec3.squaredDistance(H,i)}const C=(M*P-x*S)/A,R=(E*P-M*x)/A,B=ce.vec3.lerp(ce.vec3.create(),i,o,C),N=ce.vec3.lerp(ce.vec3.create(),u,f,R);return ce.vec3.squaredDistance(B,N)}}class PF{constructor(i,o){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(o)||(this.zScale=Math.pow(2,o.z-i.z),this.xOffset=(i.x*this.zScale-o.x)*St,this.yOffset=(i.y*this.zScale-o.y)*St)}constantElevation(i,o){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,o)}pointElevation(i,o,u){const f=this.constantElevation(o,u);return f??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(o.pointElevation(i),u))}computeBiasedHeight(i,o){return o<=0?i:i+o*ci(0,o,i>=0?i:Math.abs(.5*i))}}zt(Lb,"ElevationFeature");class Y2{constructor(){this.polygons=new Map}add(i,...o){this.polygons.has(i)?this.polygons.get(i).push(...o):this.polygons.set(i,o)}merge(i){for(const[o,u]of i.polygons)this.add(o,...u)}}class Ph{constructor(){this.portals=[]}static evaluate(i){if(i.length===0)return new Ph;let o=[];for(const M of i)o.push(...M.portals);if(o.length===0)return new Ph;const u=(M,x)=>M<=0&&x<=0||M>=St&&x>=St;for(const M of o){const x=M.va,S=M.vb;(u(x.x,S.x)||u(x.y,S.y))&&(M.type="border")}const f=o.filter(M=>M.type!=="unevaluated"),d=o.filter(M=>M.type==="unevaluated");if(d.length===0)return new Ph;d.sort((M,x)=>M.hash===x.hash?M.isTunnel===x.isTunnel?0:M.isTunnel?-1:1:M.hash<x.hash?1:-1),o=f.concat(d);let g=f.length,w=g,E=g;do if(w++,w===o.length||o[g].hash!==o[w].hash){if(w-g==2){E<g&&(o[E]=o[g],o[g]=null);const M=o[E],x=o[w-1];M.type=M.isTunnel!==x.isTunnel?"tunnel":"polygon",M.connection={a:M.connection.a,b:x.connection.a},E++}g=w}while(g!==o.length);return o.splice(E),o.sort((M,x)=>M.hash<x.hash?1:-1),{portals:o}}}zt(Ph,"ElevationPortalGraph"),zt(Y2,"ElevationPolygons");class DF{constructor(i,o,u){this.outPositions=i,this.outNormals=o,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(i,o,u){let f=i[2];u!=null&&(f*=u);const d=this.getVec3Bits(i)<<96n|this.getVec3Bits(o),g=this.vertexLookup.get(d);if(g!=null)return g;const w=this.outPositions.length;this.vertexLookup.set(d,w);const E=Math.trunc(16384*o[0]),M=Math.trunc(16384*o[1]),x=Math.trunc(16384*o[2]);return this.outPositions.emplaceBack(i[0],i[1],f),this.outNormals.emplaceBack(E,M,x),w}addVertices(i,o,...u){const f=[];for(const d of u){const g=this.addVertex(d,i,o);f.push(g)}return f}addTriangles(i,o,u){if(o&&u){const f=u.length===1,d=ce.vec3.fromValues(0,0,0);for(let g=0;g<i.length;g+=3){const w=o[i[g+0]],E=o[i[g+1]],M=o[i[g+2]],x=f?u[0]:u[i[g+1]],S=f?u[0]:u[i[g+2]],P=this.addVertex(ce.vec3.fromValues(w.x,w.y,f?u[0]:u[i[g+0]]),d),A=this.addVertex(ce.vec3.fromValues(E.x,E.y,x),d),C=this.addVertex(ce.vec3.fromValues(M.x,M.y,S),d);this.outIndices.emplaceBack(P,A,C)}}else for(let f=0;f<i.length;f+=3)this.outIndices.emplaceBack(i[f+0],i[f+1],i[f+2])}addQuad(i,o){const u=this.addVertices(o,void 0,...i.map(E=>ce.vec3.fromValues(E.coord.x,E.coord.y,E.height))),[f,d,g,w]=u;this.addTriangles([f,d,g,g,w,f])}getBits(i){return this.view.setFloat32(0,i),BigInt(this.view.getUint32(0))}getVec3Bits(i){return this.getBits(i[0])<<64n|this.getBits(i[1])<<32n|this.getBits(i[2])}}class Ma{constructor(i){this.unevaluatedPortals=new Ph,this.portalPolygons=new Y2,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new mh,this.vertexNormals=new Pm,this.indexArray=new Rs,this.tileToMeters=m(i)}addVertices(i,o){const u=this.unevalVertices.length;for(let f=0;f<i.length;f++)this.unevalVertices.push(i[f]),this.unevalHeights.push(o[f]);return u}addTriangles(i,o,u){const f=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const d of i)f.push(d+o)}addRenderableRing(i,o,u,f,d){const g=[new Ie(d.min.x,d.min.y),new Ie(d.max.x,d.min.y),new Ie(d.max.x,d.max.y),new Ie(d.min.x,d.max.y)];for(let w=0;w<u-1;w++){const E=o+w,M=E+1,x=this.unevalVertices[E],S=this.unevalVertices[M];if(!(x.x>=d.min.x&&x.x<=d.max.x&&x.y>=d.min.y&&x.y<=d.max.y||S.x>=d.min.x&&S.x<=d.max.x&&S.y>=d.min.y&&S.y<=d.max.y||Ce(x,S,g))||this.isOnBorder(x.x,S.x)||this.isOnBorder(x.y,S.y))continue;const P=Ma.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[M]);let A,C=this.vertexHashLookup.get(Ma.computePosHash(x));C!=null?A=C.next:(C=this.vertexHashLookup.get(Ma.computePosHash(S)),A=C!=null?C.prev:P),this.unevalEdges.push({polygonIdx:i,a:E,b:M,hash:P,portalHash:A,isTunnel:f,type:"unevaluated"})}}addPortalCandidates(i,o,u,f,d){if(o.length===0)return;this.portalPolygons.add(i,{geometry:o,zLevel:d});const g=o[0];this.vertexHashLookup.clear();let w=Ma.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let E=0;E<g.length-1;E++){const M=g[E+0],x=g[E+1],S=ce.vec2.fromValues(x.x-M.x,x.y-M.y),P=ce.vec2.length(S);if(P===0)continue;let A="unevaluated";const C=f.pointElevation(M),R=f.pointElevation(x);Math.abs(C)<.01&&Math.abs(R)<.01?A="entrance":(this.isOnBorder(M.x,x.x)||this.isOnBorder(M.y,x.y))&&(A="border");const B=Ma.computeEdgeHash(M,x);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:M,vb:x,vab:S,length:P,hash:B,isTunnel:u,type:A});const N=Ma.computePosHash(M);this.vertexHashLookup.set(N,{prev:w,next:B}),w=B}}construct(i){if(this.unevalVertices.length===0)return;const o=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=S=>{S.primitiveLength=this.indexArray.length-S.primitiveOffset},f=new DF(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const d=o(),g=o(),w=o(),E=(S,P)=>{S.sort((C,R)=>C.type===P&&R.type!==P?-1:C.type!==P&&R.type===P?1:0);const A=S.findIndex(C=>C.type!==P);return A>=0?A:S.length};let M=0;this.unevalEdges.length>0&&(M=E(this.unevalEdges,"none"),this.constructBridgeStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},this.tileToMeters));const x=o();if(this.unevalEdges.length>0){const S=this.unevalEdges.splice(M),P=E(S,"tunnel")+M;this.unevalEdges.push(...S),this.constructTunnelStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},{min:M,max:P})}u(w),f.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(x),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(g),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(d),this.maskSegments=Mn.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.depthSegments=Mn.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableSegments=Mn.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.shadowCasterSegments=Mn.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,mF.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,gF.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(i,o,u,f){const d=new Map;for(let g=u;g<f;g++){const w=o[g],E=w.a,M=w.b;d.has(E)||d.set(E,{}),d.has(M)||d.set(M,{});const x=d.get(E),S=d.get(M);i[M]>0&&(x.to=M),i[E]>0&&(S.from=E)}return d}constructBridgeStructures(i,o,u,f,d,g){const w=this.computeVertexConnections(u,f,d.min,d.max),E=1/g,M=.5*E,x=P=>ce.vec3.fromValues(o[P].x,o[P].y,u[P]*E),S=P=>{const A=w.get(P),C=A.from,R=A.to;if(!C||!R)return;const B=x(C),N=x(P),G=x(R),H=ce.vec3.fromValues(0,0,0);if(!ce.vec3.exactEquals(B,N)){const W=ce.vec3.sub(ce.vec3.create(),N,B);ce.vec3.add(H,H,ce.vec3.normalize(W,W))}if(!ce.vec3.exactEquals(G,N)){const W=ce.vec3.sub(ce.vec3.create(),G,N);ce.vec3.add(H,H,ce.vec3.normalize(W,W))}const $=ce.vec3.len(H);return $>0?ce.vec3.scale(H,H,1/$):void 0};for(let P=d.min;P<d.max;P++){const A=f[P],C=this.prepareEdgePoints(o,u,A,(mt,ei)=>mt>=ei);if(C==null)continue;const R=C[0],B=C[1],N=ce.vec3.fromValues(R.coord.x,R.coord.y,E*R.height),G=ce.vec3.fromValues(B.coord.x,B.coord.y,E*B.height);if(ce.vec3.exactEquals(N,G))continue;const H=ce.vec3.sub(ce.vec3.create(),G,N);ce.vec3.normalize(H,H);const $=mt=>ce.vec3.normalize(mt,mt),W=S(A.a)||H,K=S(A.b)||H,Q=$(ce.vec3.fromValues(W[1],-W[0],0)),ue=$(ce.vec3.fromValues(K[1],-K[0],0)),oe=$(ce.vec3.cross(ce.vec3.create(),Q,W)),ae=$(ce.vec3.cross(ce.vec3.create(),ue,K)),Ee=ce.vec3.create(),he=[ce.vec3.add(ce.vec3.create(),N,ce.vec3.scale(Ee,ce.vec3.sub(Ee,Q,oe),M)),ce.vec3.add(ce.vec3.create(),N,ce.vec3.scale(Ee,ce.vec3.add(Ee,Q,oe),M)),ce.vec3.add(ce.vec3.create(),N,ce.vec3.scale(Ee,oe,M)),N],Se=[ce.vec3.add(ce.vec3.create(),G,ce.vec3.scale(Ee,ce.vec3.sub(Ee,ue,ae),M)),ce.vec3.add(ce.vec3.create(),G,ce.vec3.scale(Ee,ce.vec3.add(Ee,ue,ae),M)),ce.vec3.add(ce.vec3.create(),G,ce.vec3.scale(Ee,ae,M)),G],[Le,De]=i.addVertices(Q,g,he[0],he[1]),[Fe,ke]=i.addVertices(ue,g,Se[0],Se[1]);i.addTriangles([Le,De,Fe,De,ke,Fe]);const[He,Ve]=i.addVertices(oe,g,he[1],he[2]),[qe,pt]=i.addVertices(ae,g,Se[1],Se[2]);i.addTriangles([He,Ve,qe,Ve,pt,qe]);const[dt,Ft]=i.addVertices(ce.vec3.negate(Q,Q),g,he[2],he[3]),[_t,Et]=i.addVertices(ce.vec3.negate(ue,ue),g,Se[2],Se[3]);i.addTriangles([dt,Ft,_t,Ft,Et,_t])}}constructTunnelStructures(i,o,u,f,d,g){const w=E=>ce.vec3.normalize(E,E);for(let E=d.min;E<d.max;E++){const M=this.prepareEdgePoints(o,u,f[E],(A,C)=>A<=C);if(M==null)continue;const[x,S]=M,P=w(ce.vec3.fromValues(S.coord.y-x.coord.y,-(S.coord.x-x.coord.x),0));i.addQuad([x,S,{coord:S.coord,height:f[E].isTunnel?-.1:0},{coord:x.coord,height:f[E].isTunnel?-.1:0}],P)}for(let E=g.min;E<g.max;E++){const M=f[E],x=o[M.a],S=o[M.b],P=w(ce.vec3.fromValues(S.y-x.y,-(S.x-x.x),0));i.addQuad([{coord:S,height:0},{coord:x,height:0},{coord:x,height:u[M.a]+4},{coord:S,height:u[M.b]+4}],P),i.addQuad([{coord:x,height:0},{coord:S,height:0},{coord:S,height:u[M.b]+4},{coord:x,height:u[M.a]+4}],P)}}prepareEdgePoints(i,o,u,f){const d=i[u.a],g=i[u.b];let w=o[u.a],E=o[u.b];if(!(w!==0&&f(w,0)||E!==0&&f(E,0)))return;const M=d.clone(),x=g.clone();if(f(w,0)){if(!f(E,0)){const S=E/(E-w);x.x=ni(x.x,M.x,S),x.y=ni(x.y,M.y,S),E=ni(E,w,S)}}else{const S=w/(w-E);M.x=ni(M.x,x.x,S),M.y=ni(M.y,x.y,S),w=ni(w,E,S)}return[{coord:M,height:w},{coord:x,height:E}]}prepareEdges(i,o){if(o.length===0)return;o.sort((w,E)=>w.hash===E.hash?E.polygonIdx-w.polygonIdx:E.hash>w.hash?1:-1);let u=0,f=0,d=0,g=o[u].polygonIdx;do f++,(f===o.length||o[u].hash!==o[f].hash)&&((f-u==1||o[f-1].polygonIdx!==g)&&(d<u&&(o[d]=o[u],o[u]=null),o[d].type="none",d++),u=f,u!==o.length&&(g=o[u].polygonIdx));while(u!==o.length);if(o.splice(d),o.length!==0&&i.length!==0){o.sort((M,x)=>M.hash<x.hash?1:-1);let w=0,E=0;for(;w!==o.length&&E!==i.length;){const M=o[w],x=i[E];M.portalHash>x.hash?w++:x.hash>M.portalHash?E++:(M.type=x.type,w++)}}}isOnBorder(i,o){return i<=0&&o<=0||i>=St&&o>=St}static computeEdgeHash(i,o){return(i.y===o.y&&i.x>o.x||i.y>o.y)&&([i,o]=[o,i]),BigInt(Ma.computePosHash(i))<<32n|BigInt(Ma.computePosHash(o))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}class Ob{constructor(i,o){this.layoutVertexArray=new wa,this.indexArray=new Rs,this.lineIndexArray=new el,this.triangleSegments=new Mn,this.lineSegments=new Mn,this.programConfigurations=new il(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,o&&(this.elevatedLayoutVertexArray=new Cl)}update(i,o,u,f,d,g,w){this.programConfigurations.updatePaintArrays(i,o,d,u,f,g,w)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,fF.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,pF.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,o,u,f,d,g){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,o,u,f,d,g)}}class kb{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new Ob(i,!1),this.elevationBufferData=new Ob(i,!0),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(i,o){}populate(i,o,u,f){this.hasPattern=Ib("fill",this.layers,this.pixelRatio,o);const d=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:w,id:E,index:M,sourceLayerIndex:x}of i){const S=this.layers[0]._featureFilter.needGeometry,P=F(w,S);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),P,u))continue;const A=d?d.evaluate(P,{},u,o.availableImages):void 0,C={id:E,properties:w.properties,type:w.type,sourceLayerIndex:x,index:M,geometry:S?P.geometry:z(w,u,f),patterns:{},sortKey:A};g.push(C)}d&&g.sort((w,E)=>w.sortKey-E.sortKey);for(const w of g){const{geometry:E,index:M,sourceLayerIndex:x}=w;if(this.hasPattern){const S=Cb("fill",this.layers,w,this.zoom,this.pixelRatio,o);this.patternFeatures.push(S)}else this.addFeature(w,E,M,u,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(i[M].feature,E,M,x,this.index)}}update(i,o,u,f,d,g,w){this.bufferData.update(i,o,u,f,d,g,w),this.elevationBufferData.update(i,o,u,f,d,g,w)}addFeatures(i,o,u,f,d,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,o,u,f,g,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,o,u,f,d,g=[],w,E){const M=l0(o,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,M,f,u,E):this.addGeometry(M,this.bufferData),this.bufferData.populatePaintArrays(i,u,d,g,f,w),this.elevationBufferData.populatePaintArrays(i,u,d,g,f,w)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(i){this.elevatedStructures&&this.elevatedStructures.construct(i)}addElevatedRoadFeature(i,o,u,f,d){const g=new Array,w=this.getElevationFeature(i,d);if(w){g.push({polygons:o,elevationFeature:w,elevationTileID:u});for(const E of g)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ma(E.elevationTileID));const x=E.elevationFeature.isTunnel();let S=0;i.properties.hasOwnProperty(Z2)&&(S=+i.properties[Z2]);for(const P of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,P,x,E.elevationFeature,S)}const M=new PF(u,E.elevationTileID);this.addElevatedGeometry(E.polygons,M,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,f)}}else this.addGeometry(o,this.bufferData)}addElevatedGeometry(i,o,u,f,d){const g={elevation:u,elevationSampler:o,bias:f,index:d},[w,E]=this.addGeometry(i,this.elevationBufferData,g);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:w,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,w),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(i,o,u){let f=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,g=null;u&&(g=u.elevationSampler.constantElevation(u.elevation,u.bias),g!=null&&(f=g,d=g));const w=(E,M,x)=>{if(u!=null)if(M.push(E),g!=null)o.elevatedLayoutVertexArray.emplaceBack(g),x.push(g);else{const S=u.elevationSampler.pointElevation(E,u.elevation,u.bias);o.elevatedLayoutVertexArray.emplaceBack(S),x.push(S),f=Math.min(f,S),d=Math.max(d,S)}};for(const E of i){let M=0;for(const H of E)M+=H.length;const x=o.triangleSegments.prepareSegment(M,o.layoutVertexArray,o.indexArray),S=x.vertexLength,P=[],A=[],C=[],R=[],B=[],N=o.layoutVertexArray.length;for(const H of E){if(H.length===0)continue;H!==E[0]&&A.push(P.length/2);const $=o.lineSegments.prepareSegment(H.length,o.layoutVertexArray,o.lineIndexArray),W=$.vertexLength;u&&B.push(o.layoutVertexArray.length-N),w(H[0],C,R),o.layoutVertexArray.emplaceBack(H[0].x,H[0].y),o.lineIndexArray.emplaceBack(W+H.length-1,W),P.push(H[0].x),P.push(H[0].y);for(let K=1;K<H.length;K++)w(H[K],C,R),o.layoutVertexArray.emplaceBack(H[K].x,H[K].y),o.lineIndexArray.emplaceBack(W+K-1,W+K),P.push(H[K].x),P.push(H[K].y);$.vertexLength+=H.length,$.primitiveLength+=H.length}const G=Jm(P,A);for(let H=0;H<G.length;H+=3)o.indexArray.emplaceBack(S+G[H],S+G[H+1],S+G[H+2]);if(u&&this.elevationMode==="hd-road-base"){const H=u.elevation.isTunnel(),$=u.elevation.safeArea,W=this.elevatedStructures.addVertices(C,R);this.elevatedStructures.addTriangles(G,W,H);const K=B.length;if(K>0){for(let Q=0;Q<K-1;Q++)this.elevatedStructures.addRenderableRing(u.index,B[Q]+W,B[Q+1]-B[Q],H,$);this.elevatedStructures.addRenderableRing(u.index,B[K-1]+W,C.length-B[K-1],H,$)}}x.vertexLength+=M,x.primitiveLength+=G.length/3}return[f,d]}getElevationFeature(i,o){if(!o)return;const u=+i.properties[Ch];return u!=null?o.find(f=>f.id===u):void 0}}let K2,J2,Q2,eA;zt(kb,"FillBucket",{omit:["layers","patternFeatures"]}),zt(Ob,"FillBufferData"),zt(Ma,"ElevatedStructures");class zb{constructor(i,o,u,f){if(this.triangleCount=o.length/3,this.min=new Ie(0,0),this.max=new Ie(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[d,g]=[i[0].clone(),i[0].clone()];for(let S=1;S<i.length;++S){const P=i[S];d.x=Math.min(d.x,P.x),d.y=Math.min(d.y,P.y),g.x=Math.max(g.x,P.x),g.y=Math.max(g.y,P.y)}if(f){const S=Math.ceil(Math.max(g.x-d.x,g.y-d.y)/f);u=Math.max(u,S)}if(u===0)return;this.min=d,this.max=g;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const E=Math.max(w.x,w.y)/u;this.cellsX=Math.max(1,Math.ceil(w.x/E)),this.cellsY=Math.max(1,Math.ceil(w.y/E)),this.xScale=1/E,this.yScale=1/E;const M=[];for(let S=0;S<this.triangleCount;S++){const P=i[o[3*S+0]].sub(this.min),A=i[o[3*S+1]].sub(this.min),C=i[o[3*S+2]].sub(this.min),R=rl(Math.floor(Math.min(P.x,A.x,C.x)),this.xScale,this.cellsX),B=rl(Math.floor(Math.max(P.x,A.x,C.x)),this.xScale,this.cellsX),N=rl(Math.floor(Math.min(P.y,A.y,C.y)),this.yScale,this.cellsY),G=rl(Math.floor(Math.max(P.y,A.y,C.y)),this.yScale,this.cellsY),H=new Ie(0,0),$=new Ie(0,0),W=new Ie(0,0),K=new Ie(0,0);for(let Q=N;Q<=G;++Q){H.y=$.y=Q*E,W.y=K.y=(Q+1)*E;for(let ue=R;ue<=B;++ue)H.x=W.x=ue*E,$.x=K.x=(ue+1)*E,(Je(P,A,C,H,$,K)||Je(P,A,C,H,K,W))&&M.push({cellIdx:Q*this.cellsX+ue,triIdx:S})}}if(M.length===0)return;M.sort((S,P)=>S.cellIdx-P.cellIdx||S.triIdx-P.triIdx);let x=0;for(;x<M.length;){const S=M[x].cellIdx,P={start:this.payload.length,len:0};for(;x<M.length&&M[x].cellIdx===S;)++P.len,this.payload.push(M[x++].triIdx);this.cells[S]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,o){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const u=rl(i.x-this.min.x,this.xScale,this.cellsX),f=rl(i.y-this.min.y,this.yScale,this.cellsY),d=this.cells[f*this.cellsX+u];if(d){this._lazyInitLookup();for(let g=0;g<d.len;g++){const w=this.payload[d.start+g],E=Math.floor(w/8),M=1<<w%8;if(!(this.lookup[E]&M)&&(this.lookup[E]|=M,o.push(w),o.length===this.triangleCount))return}}}query(i,o,u){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>o.x||i.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const f=rl(i.x-this.min.x,this.xScale,this.cellsX),d=rl(o.x-this.min.x,this.xScale,this.cellsX),g=rl(i.y-this.min.y,this.yScale,this.cellsY),w=rl(o.y-this.min.y,this.yScale,this.cellsY);for(let E=g;E<=w;E++)for(let M=f;M<=d;M++){const x=this.cells[E*this.cellsX+M];if(x)for(let S=0;S<x.len;S++){const P=this.payload[x.start+S],A=Math.floor(P/8),C=1<<P%8;if(!(this.lookup[A]&C)&&(this.lookup[A]|=C,u.push(P),u.length===this.triangleCount))return}}}}function rl(c,i,o){return Math.max(0,Math.min(o-1,Math.floor(c*i)))}zt(zb,"TriangleGridIndex");class tA{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(i,o){for(const u of this.footprints)o.push({footprint:u,id:i})}populate(i,o,u,f){const d=[];for(const{feature:g,id:w,index:E,sourceLayerIndex:M}of i){const x=this.layers[0]._featureFilter.needGeometry,S=F(g,x);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),S,u))continue;const P={id:w,properties:g.properties,type:g.type,sourceLayerIndex:M,index:E,geometry:x?S.geometry:z(g,u,f),patterns:{}};d.push(P)}for(const g of d){const{geometry:w,index:E,sourceLayerIndex:M}=g;this.addFeature(g,w,E,u,{},o.availableImages,o.brightness),o.featureIndex.insert(i[E].feature,w,E,M,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,o,u,f,d,g,w){}destroy(){}addFeature(i,o,u,f,d,g=[],w){for(const E of l0(o,2)){const M=[],x=[],S=[],P=new Ie(1/0,1/0),A=new Ie(-1/0,-1/0);for(const B of E)if(B.length!==0){B!==E[0]&&S.push(x.length/2);for(let N=0;N<B.length;N++)x.push(B[N].x),x.push(B[N].y),M.push(B[N]),P.x=Math.min(P.x,B[N].x),P.y=Math.min(P.y,B[N].y),A.x=Math.max(A.x,B[N].x),A.y=Math.max(A.y,B[N].y)}const C=Jm(x,S),R=new zb(M,C,8,256);this.footprints.push({vertices:M,indices:C,grid:R,min:P,max:A})}}}zt(tA,"ClipBucket",{omit:["layers"]});const RF=Gi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),LF=Gi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),OF=Gi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),kF=Gi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),zF=Gi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),FF=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:BF}=RF;class Dh extends Ie{constructor(i,o,u){super(i,o),this.z=u}}class iA extends Dh{constructor(i,o,u,f){super(i,o,u),this.w=f}}function u0(c,i,o,u){const f=[],d=u===0?(g,w,E,M,x,S)=>{g.push(new Ie(S,E+(S-w)/(M-w)*(x-E)))}:(g,w,E,M,x,S)=>{g.push(new Ie(w+(S-E)/(x-E)*(M-w),S))};for(const g of c){const w=[];for(const E of g){if(E.length<=2)continue;const M=[];for(let P=0;P<E.length-1;P++){const A=E[P].x,C=E[P].y,R=E[P+1].x,B=E[P+1].y,N=u===0?A:C,G=u===0?R:B;N<i?G>i&&d(M,A,C,R,B,i):N>o?G<o&&d(M,A,C,R,B,o):M.push(E[P]),G<i&&N>=i&&d(M,A,C,R,B,i),G>o&&N<=o&&d(M,A,C,R,B,o)}let x=E[E.length-1];const S=u===0?x.x:x.y;S>=i&&S<=o&&M.push(x),M.length&&(x=M[M.length-1],M[0].x===x.x&&M[0].y===x.y||M.push(M[0]),w.push(M))}w.length&&f.push(w)}return f}function nA(c,i,o,u){const f=o==="x"?"y":"x",d=(u-c[o])/(i[o]-c[o]);c[f]=c[f]+(i[f]-c[f])*d,c[o]=u,c.hasOwnProperty("z")&&(c.z=ni(c.z,i.z,d)),c.hasOwnProperty("w")&&(c.w=ni(c.w,i.w,d))}function sA(c,i,o,u){const f=o,d=u;for(const g of["x","y"]){let w=c,E=i;w[g]>=E[g]&&(w=i,E=c),w[g]<f&&E[g]>f&&nA(w,E,g,f),w[g]<d&&E[g]>d&&nA(E,w,g,d)}}const h0=Number.MAX_SAFE_INTEGER;function rA(c,i,o,u){return c.order<i||c.order===h0||!(c.clipMask&o)||function(f,d){return d.length!==0&&d.find(g=>g===f)===void 0}(u,c.clipScope)}function d0(c,i){return c.x-i.x||c.y-i.y}function oA(c,i){return d0(c.min,i.min)===0&&d0(c.max,i.max)===0}function Fb(c,i){return!(c.min.x>i.max.x||c.max.x<i.min.x||c.min.y>i.max.y||c.max.y<i.min.y)}function Bb(c,i){if(c.length!==i.length)return!1;for(let o=0;o<c.length;o++)if(c[o].sourceId!==i[o].sourceId||!oA(c[o],i[o])||c[o].order!==i[o].order||c[o].clipMask!==i[o].clipMask||!wt(c[o].clipScope,i[o].clipScope))return!1;return!0}function aA(c,i,o){const u=1/St,f=1/(1<<o.canonical.z),d=(i.x*u+o.canonical.x)*f+o.wrap,g=(i.y*u+o.canonical.y)*f;return{min:new Ie((c.x*u+o.canonical.x)*f+o.wrap,(c.y*u+o.canonical.y)*f),max:new Ie(d,g)}}function NF(c,i,o){const u=1<<o.canonical.z,f=((i.x-o.wrap)*u-o.canonical.x)*St,d=(i.y*u-o.canonical.y)*St;return{min:new Ie(((c.x-o.wrap)*u-o.canonical.x)*St,(c.y*u-o.canonical.y)*St),max:new Ie(f,d)}}function lA(c,i,o,u,f,d,g){const w=c.indices,E=c.vertices,M=[];for(let x=u;x<u+f;x+=3){const S=i[o[x+0]+d],P=i[o[x+1]+d],A=i[o[x+2]+d],C=Math.min(S.x,P.x,A.x),R=Math.max(S.x,P.x,A.x),B=Math.min(S.y,P.y,A.y),N=Math.max(S.y,P.y,A.y);M.length=0,c.grid.query(new Ie(C,B),new Ie(R,N),M);for(let G=0;G<M.length;G++){const H=M[G];if(Je(E[w[3*H+0]],E[w[3*H+1]],E[w[3*H+2]],S,P,A,g))return!0}}return!1}function cA(c,i,o,u){if(!c||!o)return!1;let f=c.vertices;if(!i.canonical.equals(u.canonical)||i.wrap!==u.wrap){if(o.vertices.length<c.vertices.length)return cA(o,u,c,i);const d=i.canonical,g=u.canonical,w=Math.pow(2,g.z-d.z);f=c.vertices.map(E=>new Ie((E.x+d.x*St)*w-g.x*St,(E.y+d.y*St)*w-g.y*St))}return lA(o,f,c.indices,0,c.indices.length,0,0)}function uA(c,i,o,u){const f=Math.pow(2,u.z-o.z);return new Ie((c+o.x*St)*f-u.x*St,(i+o.y*St)*f-u.y*St)}function hA(c,i){const o=[];i.grid.queryPoint(c,o);const u=i.indices,f=i.vertices;for(let d=0;d<o.length;d++){const g=o[d];if(xe([f[u[3*g+0]],f[u[3*g+1]],f[u[3*g+2]]],c))return!0}return!1}const Nb=[new Ie(0,0),new Ie(St,0),new Ie(St,St),new Ie(0,St)];function dA(c,i){const o=[];let u=[];if(!i||c.length<2)return[c];if(c.length===2)return Ce(c[0],c[1],Nb)?[c]:[];for(let f=0;f<c.length+2;f++){const d=c[f%c.length],g=c[(f+1)%c.length],w=Ce(f===0?c[c.length-1]:c[(f-1)%c.length],d,Nb),E=Ce(d,g,Nb),M=w||E;M&&u.push(d),M&&E||u.length>0&&(u.length>1&&o.push(u),u=[])}return u.length>1&&o.push(u),o}const Vb=Kc.VectorTileFeature.types,VF=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],UF=["fill-extrusion-flood-light-ground-radius"],jF=Math.pow(2,13),$F=Math.pow(2,15)-1,fA=new Ie(0,1),Jc=2147483648;function ig(c,i,o,u,f,d,g,w){c.emplaceBack((i<<1)+g,(o<<1)+d,(Math.floor(u*jF)<<1)+f,Math.round(w))}function ng(c,i,o){c.emplaceBack(i.x*St,i.y*St,o?1:0)}function f0(c,i,o,u,f,d){c.emplaceBack(i.x,i.y,(o.x<<1)+u,(o.y<<1)+f,d)}function sg(c,i,o){c.emplaceBack(i.x,i.y,i.z,o[0]*16384,o[1]*16384,o[2]*16384)}class pA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class mA{constructor(){this.centroidXY=new Ie(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ie(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ie(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ie(this.max.x-this.min.x,this.max.y-this.min.y)}}class gA{constructor(){this.acc=new Ie(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,o){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=o.x,i.min.y=i.max.y=o.y)}appendEdge(i,o,u){this.accCount++,this.acc._add(o);let f=!!this.borders;o.x<i.min.x?(i.min.x=o.x,f=!0):o.x>i.max.x&&(i.max.x=o.x,f=!0),o.y<i.min.y?(i.min.y=o.y,f=!0):o.y>i.max.y&&(i.max.y=o.y,f=!0),((o.x===0||o.x===St)&&o.x===u.x)!=((o.y===0||o.y===St)&&o.y===u.y)&&this.processBorderOverlap(o,u),f&&this.checkBorderIntersection(o,u)}checkBorderIntersection(i,o){o.x<0!=i.x<0&&this.addBorderIntersection(0,ni(o.y,i.y,(0-o.x)/(i.x-o.x))),o.x>St!=i.x>St&&this.addBorderIntersection(1,ni(o.y,i.y,(St-o.x)/(i.x-o.x))),o.y<0!=i.y<0&&this.addBorderIntersection(2,ni(o.x,i.x,(0-o.y)/(i.y-o.y))),o.y>St!=i.y>St&&this.addBorderIntersection(3,ni(o.x,i.x,(St-o.y)/(i.y-o.y)))}addBorderIntersection(i,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[i];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(i,o){if(i.x===o.x){if(i.y===o.y)return;const u=i.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,i.y)}else{const u=i.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,i.x)}}centroid(){return this.accCount===0?new Ie(0,0):new Ie(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,o)=>i+ +(o[0]!==Number.MAX_VALUE),0):0}}function _A(c,i){const o=c.add(i)._unit(),u=At(c.x*o.x+c.y*o.y,-1,1);var f,d,g;return g=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(g)))/4*$F*((f=c).x*(d=i).y-f.y*d.x<0?-1:1)}const HF=[c=>c.x<0,c=>c.x>St,c=>c.y<0,c=>c.y>St];function GF(c,i,o,u){const f=[4];if(u===0)return f;o._mult(u);const d=c.sub(o),g=i.sub(o),w=[c,i,d,g];for(let E=0;E<4;E++)for(const M of w)if(HF[E](M)){f.push(E);break}return f}class yA{constructor(i){this.vertexArray=new ao,this.indexArray=new Rs,this.programConfigurations=new il(i.layers,{zoom:i.zoom,lut:i.lut},o=>UF.includes(o)),this._segments=new Mn,this.hiddenByLandmarkVertexArray=new Vm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Mn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,o,u,f=!1){const d=i.length;if(d>2){let g=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let E;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const M=i[0],x=i[1];E=_A(M.sub(i[d-1])._perp()._unit(),x.sub(M)._perp()._unit())}for(let M=0;M<d;M++){const x=M===d-1?0:M+1,S=i[M],P=i[x],A=i[x===d-1?0:x+1],C=P.sub(S)._perp()._unit(),R=_A(C,A.sub(P)._perp()._unit()),B=E,N=R;if(Ub(S,P,o)||f&&bA(S,o)&&bA(P,o)){E=R;continue}const G=w.vertexLength;f0(this.vertexArray,S,P,1,1,B),f0(this.vertexArray,S,P,1,0,B),f0(this.vertexArray,S,P,0,1,N),f0(this.vertexArray,S,P,0,0,N),w.vertexLength+=4;const H=GF(S,P,C,u);for(const $ of H)this._segmentToGroundQuads[g].push({id:G,region:$}),this._segmentToRegionTriCounts[g][$]+=2,w.primitiveLength+=2;E=R}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),o=i.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((f,d)=>f.region-d.region);for(let u=0;u<o;u++){const f=this._segmentToGroundQuads[u],d=i[u],g=this._segmentToRegionTriCounts[u];g.reduce((E,M)=>E+M,0);let w=0;for(let E=0;E<=4;E++){const M=g[E];if(M!==0){let x=this.regionSegments[E];x||(x=this.regionSegments[E]=new Mn);const S={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+w,vertexLength:d.vertexLength,primitiveLength:M};x.get().push(S)}w+=M}for(let E=0;E<f.length;E++){const M=f[E].id;this.indexArray.emplaceBack(M,M+1,M+3),this.indexArray.emplaceBack(M,M+3,M+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,o,u,f,d,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,o,u,f,d,g)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,LF.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,o,u,f,d,g,w){this.hasData()&&this.programConfigurations.updatePaintArrays(i,o,u,f,d,g,w)}updateHiddenByLandmark(i){if(!this.hasData())return;const o=i.groundVertexCount+i.groundVertexArrayOffset;if(i.groundVertexCount===0)return;const u=i.flags&Jc?1:0;for(let f=i.groundVertexArrayOffset;f<o;++f)this.hiddenByLandmarkVertexArray.emplace(f,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,zF.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const o=this.regionSegments[i];o&&o.destroy()}}}}class p0{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Rs,this.footprintVertices=new wa,this.footprintSegments=[],this.layoutVertexArray=new Ta,this.centroidVertexArray=new bh,this.wallVertexArray=new Ky,this.indexArray=new Rs,this.programConfigurations=new il(i.layers,{zoom:i.zoom,lut:i.lut},o=>VF.includes(o)),this.segments=new Mn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new yA(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(i,o){}populate(i,o,u,f){this.features=[],this.hasPattern=Ib("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=m(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:g,index:w,sourceLayerIndex:E}of i){const M=this.layers[0]._featureFilter.needGeometry,x=F(d,M);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),x,u))continue;const S={id:g,sourceLayerIndex:E,index:w,geometry:M?x.geometry:z(d,u,f),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length,A=Vb[S.type]==="Polygon";if(this.hasPattern)this.features.push(Cb("fill-extrusion",this.layers,S,this.zoom,this.pixelRatio,o));else if(this.wallMode)for(const C of S.geometry)for(const R of dA(C,A))this.addFeature(S,[R],w,u,{},o.availableImages,f,o.brightness);else this.addFeature(S,S.geometry,w,u,{},o.availableImages,f,o.brightness);o.featureIndex.insert(d,S.geometry,w,E,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,o,u,f,d,g){for(const w of this.features){const E=Vb[w.type]==="Polygon",{geometry:M}=w;if(this.wallMode)for(const x of M)for(const S of dA(x,E))this.addFeature(w,[S],w.index,o,u,f,d,g);else this.addFeature(w,M,w.index,o,u,f,d,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,o,u,f,d,g,w){this.programConfigurations.updatePaintArrays(i,o,d,u,f,g,w),this.groundEffect.update(i,o,d,u,f,g,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,BF),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,kF.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,FF.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,OF.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,o,u,f,d,g,w,E){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,x=[new Ie(0,0),new Ie(St,St)],S=w.projection,P=S.name==="globe",A=this.wallMode||Vb[i.type]==="Polygon",C=new gA;C.centroidDataIndex=this.centroidData.length;const R=new mA,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},f)<=0,N=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},f);let G;if(R.height=N,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new lf),this.wallMode){if(P)return void on("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;G=function(ae){const Ee=ae[0].x===ae[ae.length-1].x&&ae[0].y===ae[ae.length-1].y;(function(Et){let mt=0;const ei=Et.length;for(let Lt=0;Lt<ei;Lt++)mt+=(Et[(Lt+1)%ei].x-Et[Lt].x)*(Et[(Lt+1)%ei].y+Et[Lt].y);return mt>=0})(ae)||(ae=ae.reverse());const Se={geometry:[],joinNormals:[],indices:[]},Le=[],De=[],Fe=[];let ke=ae.length;for(;ke>=2&&ae[ke-1].equals(ae[ke-2]);)ke--;if(ke<(Ee?3:2))return Se;let He,Ve,qe,pt,dt,Ft=0;for(;Ft<ke-1&&ae[Ft].equals(ae[Ft+1]);)Ft++;Ee&&(He=ae[ke-2],dt=ae[Ft].sub(He)._unit()._perp());for(let Et=Ft;Et<ke;Et++){if(qe=Et===ke-1?Ee?ae[Ft+1]:void 0:ae[Et+1],qe&&ae[Et].equals(qe))continue;dt&&(pt=dt),He&&(Ve=He),He=ae[Et],dt=qe?qe.sub(He)._unit()._perp():pt,pt=pt||dt;let mt=pt.add(dt);mt.x===0&&mt.y===0||mt._unit();const ei=mt.x*dt.x+mt.y*dt.y,Lt=ei!==0?1/ei:1/0,jt=pt.x*dt.y-pt.y*dt.x>0;let ai="miter";const wi=2;ai==="miter"&&Lt>wi&&(ai="bevel"),ai==="bevel"&&(Lt>100&&(ai="flipbevel"),Lt<wi&&(ai="miter"));const di=(Ii,bi,Pi,Ui)=>{const pn=new Ie(Ii.x,Ii.y),ui=new Ie(Ii.x,Ii.y);pn.x+=bi.x*Ui,pn.y+=bi.y*Ui,ui.x-=bi.x*Math.max(Pi,1),ui.y-=bi.y*Math.max(Pi,1),Fe.push(bi),Le.push(pn),De.push(ui)};if(ai==="miter")mt._mult(Lt),di(He,mt,0,0);else if(ai==="flipbevel")mt=dt.mult(-1),di(He,mt,0,0),di(He,mt.mult(-1),0,0);else{const Ii=-Math.sqrt(Lt*Lt-1),bi=jt?Ii:0,Pi=jt?0:Ii;Ve&&di(He,pt,bi,Pi),qe&&di(He,dt,bi,Pi)}}Se.geometry=[...Le,...De.reverse(),Le[0]],Se.joinNormals=[...Fe,...Fe.reverse(),Fe[Fe.length-1]];const _t=Se.geometry.length-1;for(let Et=0;Et<_t/2;Et++)if(Et+1<_t/2){let mt=Et,ei=Et+1,Lt=_t-1-Et,jt=_t-2-Et;mt=mt===0?_t-1:mt-1,ei=ei===0?_t-1:ei-1,Lt=Lt===0?_t-1:Lt-1,jt=jt===0?_t-1:jt-1,Se.indices.push(Lt),Se.indices.push(ei),Se.indices.push(mt),Se.indices.push(Lt),Se.indices.push(jt),Se.indices.push(ei)}return Se}(o[0]),o=[G.geometry]}const H=(ae,Ee)=>ae<(Ee.length-1)/2||ae===Ee.length-1,$=this.wallMode?[o]:l0(o,500);for(let ae=$.length-1;ae>=0;ae--){const Ee=$[ae];(Ee.length===0||(W=Ee[0]).every(he=>he.x<=0)||W.every(he=>he.x>=St)||W.every(he=>he.y<=0)||W.every(he=>he.y>=St))&&$.splice(ae,1)}var W;let K;if(P)K=SA($,x,f);else{K=[];for(const ae of $)K.push({polygon:ae,bounds:x})}const Q=A?this.edgeRadius:0,ue=Q>0&&this.zoom<17,oe=(ae,Ee)=>{if(ae.length===0)return!1;const he=ae[ae.length-1];return Ee.x===he.x&&Ee.y===he.y};for(const{polygon:ae,bounds:Ee}of K){let he=0,Se=0;for(const ke of ae)A&&!ke[0].equals(ke[ke.length-1])&&ke.push(ke[0]),Se+=A?ke.length-1:ke.length;const Le=this.segments.prepareSegment((A?5:4)*Se,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const De={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Fe=new pA;if(Fe.vertexOffset=this.footprintVertices.length,Fe.indexOffset=3*this.footprintIndices.length,Fe.ringIndices=[],A){const ke=[],He=[];he=Le.vertexLength;for(let qe=0;qe<ae.length;qe++){const pt=ae[qe];pt.length&&qe!==0&&He.push(ke.length/2);const dt=[];let Ft,_t;Ft=pt[1].sub(pt[0])._perp()._unit(),Fe.ringIndices.push(pt.length-1);for(let Et=1;Et<pt.length;Et++){const mt=pt[Et],ei=pt[Et===pt.length-1?1:Et+1],Lt=mt.clone();if(Q){_t=ei.sub(mt)._perp()._unit();const jt=Ft.add(_t)._unit(),ai=Q*Math.min(4,1/(Ft.x*jt.x+Ft.y*jt.y));Lt.x+=ai*jt.x,Lt.y+=ai*jt.y,Lt.x=Math.round(Lt.x),Lt.y=Math.round(Lt.y),Ft=_t}if(!B||Q!==0&&!ue||oe(dt,Lt)||dt.push(Lt),ig(this.layoutVertexArray,Lt.x,Lt.y,0,0,1,1,0),this.wallMode){const jt=H(Et,pt);ng(this.wallVertexArray,G.joinNormals[Et],!jt)}Le.vertexLength++,this.footprintVertices.emplaceBack(mt.x,mt.y),ke.push(mt.x,mt.y),P&&sg(this.layoutVertexExtArray,S.projectTilePoint(Lt.x,Lt.y,f),S.upVector(f,Lt.x,Lt.y))}B&&(Q===0||ue)&&(dt.length!==0&&oe(dt,dt[0])&&dt.pop(),this.groundEffect.addData(dt,Ee,M))}const Ve=this.wallMode?G.indices:Jm(ke,He);for(let qe=0;qe<Ve.length;qe+=3)this.footprintIndices.emplaceBack(Fe.vertexOffset+Ve[qe+0],Fe.vertexOffset+Ve[qe+1],Fe.vertexOffset+Ve[qe+2]),this.indexArray.emplaceBack(he+Ve[qe],he+Ve[qe+2],he+Ve[qe+1]),Le.primitiveLength++;Fe.indexCount+=Ve.length,Fe.vertexCount+=this.footprintVertices.length-Fe.vertexOffset}for(let ke=0;ke<ae.length;ke++){const He=ae[ke];C.startRing(R,He[0]);let Ve=He.length>4&&wA(He[He.length-2],He[0],He[1]),qe=Q?qF(He[He.length-2],He[0],He[1],Q):0;const pt=[];let dt,Ft,_t;Ft=He[1].sub(He[0])._perp()._unit();let Et=!0;for(let mt=1,ei=0;mt<He.length;mt++){let Lt=He[mt-1],jt=He[mt];const ai=He[mt===He.length-1?1:mt+1];if(C.appendEdge(R,jt,Lt),Ub(jt,Lt,Ee)){Q&&(Ft=ai.sub(jt)._perp()._unit(),Et=!Et);continue}const wi=jt.sub(Lt)._perp(),di=wi.x/(Math.abs(wi.x)+Math.abs(wi.y)),Ii=wi.y>0?1:0,bi=Lt.dist(jt);if(ei+bi>32768&&(ei=0),Q){_t=ai.sub(jt)._perp()._unit();let ui=xA(Lt,jt,ai,vA(Ft,_t),Q);isNaN(ui)&&(ui=0);const Oi=jt.sub(Lt)._unit();Lt=Lt.add(Oi.mult(qe))._round(),jt=jt.add(Oi.mult(-ui))._round(),qe=ui,Ft=_t,B&&this.zoom>=17&&(oe(pt,Lt)||pt.push(Lt),oe(pt,jt)||pt.push(jt))}const Pi=Le.vertexLength,Ui=He.length>4&&wA(Lt,jt,ai);let pn=TA(ei,Ve,Et);if(ig(this.layoutVertexArray,Lt.x,Lt.y,di,Ii,0,0,pn),ig(this.layoutVertexArray,Lt.x,Lt.y,di,Ii,0,1,pn),this.wallMode){const ui=H(mt-1,He),Oi=G.joinNormals[mt-1];ng(this.wallVertexArray,Oi,ui),ng(this.wallVertexArray,Oi,ui)}if(ei+=bi,pn=TA(ei,Ui,!Et),Ve=Ui,ig(this.layoutVertexArray,jt.x,jt.y,di,Ii,0,0,pn),ig(this.layoutVertexArray,jt.x,jt.y,di,Ii,0,1,pn),this.wallMode){const ui=H(mt,He),Oi=G.joinNormals[mt];ng(this.wallVertexArray,Oi,ui),ng(this.wallVertexArray,Oi,ui)}if(Le.vertexLength+=4,this.indexArray.emplaceBack(Pi+0,Pi+1,Pi+2),this.indexArray.emplaceBack(Pi+1,Pi+3,Pi+2),Le.primitiveLength+=2,Q){const ui=he+(mt===1?He.length-2:mt-2),Oi=mt===1?he:ui+1;if(this.indexArray.emplaceBack(Pi+1,ui,Pi+3),this.indexArray.emplaceBack(ui,Oi,Pi+3),Le.primitiveLength+=2,dt===void 0&&(dt=Pi),!Ub(ai,He[mt],Ee)){const En=mt===He.length-1?dt:Le.vertexLength;this.indexArray.emplaceBack(Pi+2,Pi+3,En),this.indexArray.emplaceBack(Pi+3,En+1,En),this.indexArray.emplaceBack(Pi+3,Oi,En+1),Le.primitiveLength+=3}Et=!Et}if(P){const ui=this.layoutVertexExtArray,Oi=S.projectTilePoint(Lt.x,Lt.y,f),En=S.projectTilePoint(jt.x,jt.y,f),Rn=S.upVector(f,Lt.x,Lt.y),zn=S.upVector(f,jt.x,jt.y);sg(ui,Oi,Rn),sg(ui,Oi,Rn),sg(ui,En,zn),sg(ui,En,zn)}}A&&(he+=He.length-1),B&&Q&&this.zoom>=17&&(pt.length!==0&&oe(pt,pt[0])&&pt.pop(),this.groundEffect.addData(pt,Ee,M,Q>0))}this.footprintSegments.push(Fe),De.triangleCount=this.indexArray.length-De.triangleArrayOffset,this.polygonSegments.push(De),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=C.borders?fA:this.encodeCentroid(C,R),this.centroidData.push(R),C.borders){this.featuresOnBorder.push(C);const ae=this.featuresOnBorder.length-1;for(let Ee=0;Ee<C.borders.length;Ee++)C.borders[Ee][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ee].push(ae)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,d,g,f,E),this.groundEffect.addPaintPropertiesData(i,u,d,g,f,E),this.maxHeight=Math.max(this.maxHeight,N)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((o,u)=>this.featuresOnBorder[o].borders[i][0]-this.featuresOnBorder[u].borders[i][0])}splitToSubtiles(){const i=[];for(let w=0;w<this.centroidData.length;w++){const E=this.centroidData[w],M=+(E.min.y+E.max.y>St),x=2*M+(+(E.min.x+E.max.x>St)^M);for(let S=0;S<E.polygonSegLen;S++){const P=E.polygonSegIdx+S;i.push({centroidIdx:w,subtile:x,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const o=new Rs;i.sort((w,E)=>w.triangleSegmentIdx===E.triangleSegmentIdx?w.subtile-E.subtile:w.triangleSegmentIdx-E.triangleSegmentIdx);let u=0,f=0,d=0;for(const w of i){if(w.triangleSegmentIdx!==u)break;d++}const g=i.length;for(;f!==i.length;){u=i[f].triangleSegmentIdx;let w=0,E=f,M=f;for(let x=E;x<d&&i[x].subtile===w;x++)M++;for(;E!==d;){const x=i[E];w=x.subtile;const S=this.centroidData[x.centroidIdx].min.clone(),P=this.centroidData[x.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let C=E;C<M;C++){const R=i[C],B=this.polygonSegments[R.polygonSegmentIdx],N=this.centroidData[R.centroidIdx].min,G=this.centroidData[R.centroidIdx].max,H=this.indexArray.uint16;for(let $=B.triangleArrayOffset;$<B.triangleArrayOffset+B.triangleCount;$++)o.emplaceBack(H[3*$],H[3*$+1],H[3*$+2]);A.primitiveLength+=B.triangleCount,S.x=Math.min(S.x,N.x),S.y=Math.min(S.y,N.y),P.x=Math.max(P.x,G.x),P.y=Math.max(P.y,G.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:S,max:P}),E=M;for(let C=E;C<d&&i[C].subtile===i[E].subtile;C++)M++}f=d;for(let x=f;x<g&&i[x].triangleSegmentIdx===i[f].triangleSegmentIdx;x++)d++}o._trim(),this.indexArray=o}getVisibleSegments(i,o,u){const f=new Mn;if(this.wallMode){for(const R of this.triangleSubSegments)f.segments.push(R.segment);return f}let d=0,g=0;const w=1<<i.canonical.z;if(o){const R=o.getMinMaxForTile(i);R&&(d=R.min,g=R.max)}g+=this.maxHeight;const E=i.toUnwrapped();let M;const x=[E.canonical.x/w+E.wrap,E.canonical.y/w],S=[(E.canonical.x+1)/w+E.wrap,(E.canonical.y+1)/w],P=(R,B,N)=>[R[0]*(1-N[0])+B[0]*N[0],R[1]*(1-N[1])+B[1]*N[1]],A=[],C=[];for(const R of this.triangleSubSegments){A[0]=R.min.x/St,A[1]=R.min.y/St,C[0]=R.max.x/St,C[1]=R.max.y/St;const B=P(x,S,A),N=P(x,S,C);if(new Ht([B[0],B[1],d],[N[0],N[1],g]).intersectsPrecise(u)===0){M&&(f.segments.push(M),M=void 0);continue}const G=R.segment;M&&M.vertexOffset!==G.vertexOffset&&(f.segments.push(M),M=void 0),M?(M.vertexLength+=G.vertexLength,M.primitiveLength+=G.primitiveLength):M={vertexOffset:G.vertexOffset,primitiveLength:G.primitiveLength,vertexLength:G.vertexLength,primitiveOffset:G.primitiveOffset,sortKey:void 0,vaos:{}}}return M&&f.segments.push(M),f}encodeCentroid(i,o){const u=i.centroid(),f=o.span(),d=Math.min(7,Math.round(f.x*this.tileToMeter/10)),g=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new Ie(At(u.x,1,St-1)<<3|d,At(u.y,1,St-1)<<3|g)}encodeBorderCentroid(i){if(!i.borders)return new Ie(0,0);const o=i.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const f=o[0][0]!==u?0:1;return new Ie(6|(o[0][0]!==u?0:65528),(o[f][0]+o[f][1])/2<<3|6)}{const f=o[2][0]!==u?2:3;return new Ie((o[f][0]+o[f][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(i){const o=this.centroidData[i.centroidDataIndex];o.flags&=Jc,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const o=i.vertexArrayOffset,u=i.vertexCount+i.vertexArrayOffset,f=i.flags&Jc?fA:i.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==f.y||d!==f.x){for(let g=o;g<u;++g)this.centroidVertexArray.emplace(g,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const f=o.getReplacementRegionsForTile(i.toUnwrapped());if(Bb(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const d=[];for(const g of this.activeReplacements){if(g.order<u)continue;const w=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-i.canonical.z));for(const E of this.centroidData)if(!(E.flags&Jc||g.min.x>E.max.x||E.min.x>g.max.x||g.min.y>E.max.y||E.min.y>g.max.y))for(let M=0;M<E.footprintSegLen;M++){const x=this.footprintSegments[E.footprintSegIdx+M];if(d.length=0,WF(this.footprintVertices,x.vertexOffset,x.vertexCount,g.footprintTileId.canonical,i.canonical,d),lA(g.footprint,d,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-w)){E.flags|=Jc;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,o,u){let f=!1;for(let d=0;d<u.footprintSegLen;d++){const g=this.footprintSegments[u.footprintSegIdx+d];let w=0;for(const E of g.ringIndices){for(let M=w,x=E+w-1;M<E+w;x=M++){const S=this.footprintVertices.int16[2*(M+g.vertexOffset)+0],P=this.footprintVertices.int16[2*(M+g.vertexOffset)+1],A=this.footprintVertices.int16[2*(x+g.vertexOffset)+1];P>o!=A>o&&i<(this.footprintVertices.int16[2*(x+g.vertexOffset)+0]-S)*(o-P)/(A-P)+S&&(f=!f)}w=E}}return f}getHeightAtTileCoord(i,o){let u=Number.NEGATIVE_INFINITY,f=!0;const d=4*(i+St)*St+(o+St);if(this.partLookup.hasOwnProperty(d)){const g=this.partLookup[d];return g?{height:g.height,hidden:!!(g.flags&Jc)}:void 0}for(const g of this.centroidData)i>g.max.x||g.min.x>i||o>g.max.y||g.min.y>o||this.footprintContainsPoint(i,o,g)&&g&&g.height>u&&(u=g.height,this.partLookup[d]=g,f=!!(g.flags&Jc));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:f};this.partLookup[d]=void 0}}function vA(c,i){const o=c.add(i)._unit();return c.x*o.x+c.y*o.y}function qF(c,i,o,u){const f=i.sub(c)._perp()._unit(),d=o.sub(i)._perp()._unit();return xA(c,i,o,vA(f,d),u)}function xA(c,i,o,u,f){const d=Math.sqrt(1-u*u);return Math.min(c.dist(i)/3,i.dist(o)/3,f*d/u)}function Ub(c,i,o){return c.x<o[0].x&&i.x<o[0].x||c.x>o[1].x&&i.x>o[1].x||c.y<o[0].y&&i.y<o[0].y||c.y>o[1].y&&i.y>o[1].y}function bA(c,i){return c.x<i[0].x||c.x>i[1].x||c.y<i[0].y||c.y>i[1].y}function wA(c,i,o){if(c.x<0||c.x>=St||i.x<0||i.x>=St||o.x<0||o.x>=St)return!1;const u=o.sub(i),f=u.perp(),d=c.sub(i);return(u.x*d.x+u.y*d.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(d.x*d.x+d.y*d.y))>-.866&&f.x*d.x+f.y*d.y<0}function TA(c,i,o){const u=i?2|c:-3&c;return o?1|u:-2&u}function EA(){const c=Math.PI/32,i=Math.tan(c),o=Ol;return o*Math.sqrt(1+2*i*i)-o}function SA(c,i,o){const u=1<<o.z,f=Er(o.x/u),d=Er((o.x+1)/u),g=Ls(o.y/u),w=Ls((o.y+1)/u);return function(E,M,x,S,P=0,A){const C=[];if(!E.length||!x||!S)return C;const R=(K,Q)=>{for(const ue of K)C.push({polygon:ue,bounds:Q})},B=Math.ceil(Math.log2(x)),N=Math.ceil(Math.log2(S)),G=B-N,H=[];for(let K=0;K<Math.abs(G);K++)H.push(G>0?0:1);for(let K=0;K<Math.min(B,N);K++)H.push(0),H.push(1);let $=E;if($=u0($,M[0].y-P,M[1].y+P,1),$=u0($,M[0].x-P,M[1].x+P,0),!$.length)return C;const W=[];for(H.length?W.push({polygons:$,bounds:M,depth:0}):R($,M);W.length;){const K=W.pop(),Q=K.depth,ue=H[Q],oe=K.bounds[0],ae=K.bounds[1],Ee=ue===0?oe.x:oe.y,he=ue===0?ae.x:ae.y,Se=A?A(ue,Ee,he):.5*(Ee+he),Le=u0(K.polygons,Ee-P,Se+P,ue),De=u0(K.polygons,Se-P,he+P,ue);if(Le.length){const Fe=[oe,new Ie(ue===0?Se:ae.x,ue===1?Se:ae.y)];H.length>Q+1?W.push({polygons:Le,bounds:Fe,depth:Q+1}):R(Le,Fe)}if(De.length){const Fe=[new Ie(ue===0?Se:oe.x,ue===1?Se:oe.y),ae];H.length>Q+1?W.push({polygons:De,bounds:Fe,depth:Q+1}):R(De,Fe)}}return C}(c,i,Math.ceil((d-f)/11.25),Math.ceil((g-w)/11.25),1,(E,M,x)=>{if(E===0)return .5*(M+x);{const S=Ls((o.y+M/St)/u);return(Tr(.5*(Ls((o.y+x/St)/u)+S))*u-o.y)*St}})}function WF(c,i,o,u,f,d){const g=Math.pow(2,u.z-f.z);for(let w=0;w<o;w++){let E=c.int16[2*(w+i)+0],M=c.int16[2*(w+i)+1];E=(E+f.x*St)*g-u.x*St,M=(M+f.y*St)*g-u.y*St,d.push(new Ie(E,M))}}let AA,MA;function rg(c,i){return c.x*i.x+c.y*i.y}function IA(c,i){if(c.length===1){let o=0;const u=i[o++];let f;for(;!f||u.equals(f);)if(f=i[o++],!f)return 1/0;for(;o<i.length;o++){const d=i[o],g=c[0],w=f.sub(u),E=d.sub(u),M=g.sub(u),x=rg(w,w),S=rg(w,E),P=rg(E,E),A=rg(M,w),C=rg(M,E),R=x*P-S*S,B=(P*A-S*C)/R,N=(x*C-S*A)/R,G=u.z*(1-B-N)+f.z*B+d.z*N;if(isFinite(G))return G}return 1/0}{let o=1/0;for(const u of i)o=Math.min(o,u.z);return o}}function CA(c,i,o,u,f,d,g,w){const E=g*f.getElevationAt(c,i,!0,!0),M=d[0]!==0,x=M?d[1]===0?g*(d[0]/7-450):g*function(S,P,A){const C=Math.floor(P[0]/8),R=Math.floor(P[1]/8),B=10*(P[0]-8*C),N=10*(P[1]-8*R),G=S.getElevationAt(C,R,!0,!0),H=S.getMeterToDEM(A),$=Math.floor(.5*(B*H-1)),W=Math.floor(.5*(N*H-1)),K=S.tileCoordToPixel(C,R),Q=2*$+1,ue=2*W+1,oe=function(De,Fe,ke,He,Ve){return[De.getElevationAtPixel(Fe,ke,!0),De.getElevationAtPixel(Fe+Ve,ke,!0),De.getElevationAtPixel(Fe,ke+Ve,!0),De.getElevationAtPixel(Fe+He,ke+Ve,!0)]}(S,K.x-$,K.y-W,Q,ue),ae=Math.abs(oe[0]-oe[1]),Ee=Math.abs(oe[2]-oe[3]),he=Math.abs(oe[0]-oe[2])+Math.abs(oe[1]-oe[3]),Se=Math.min(.25,.5*H*(ae+Ee)/Q),Le=Math.min(.25,.5*H*he/ue);return G+Math.max(Se*B,Le*N)}(f,d,w):E;return{base:E+(o===0?-1:o),top:M?Math.max(x+u,E+o+2):E+u}}zt(p0,"FillExtrusionBucket",{omit:["layers","features"]}),zt(mA,"PartData"),zt(pA,"FootprintSegment"),zt(gA,"BorderCentroidData"),zt(yA,"GroundEffect");const ZF=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),XF=Gi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:YF}=ZF,KF=Gi([{name:"a_packed",components:3,type:"Float32"}]),{members:JF}=KF,QF=Gi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:eB}=QF;class PA{constructor(i,o){this.width=i,this.height=o,this.nextRow=0,this.image=new Yc({width:i,height:o}),this.positions={},this.uploaded=!1}getDash(i,o){const u=this.getKey(i,o);return this.positions[u]}trim(){const i=this.width,o=this.height=ds(this.nextRow);this.image.resize({width:i,height:o})}getKey(i,o){return i.join(",")+o}getDashRanges(i,o,u){const f=[];let d=i.length%2==1?-i[i.length-1]*u:0,g=i[0]*u,w=!0;f.push({left:d,right:g,isDash:w,zeroLength:i[0]===0});let E=i[0];for(let M=1;M<i.length;M++){w=!w;const x=i[M];d=E*u,E+=x,g=E*u,f.push({left:d,right:g,isDash:w,zeroLength:x===0})}return f}addRoundDash(i,o,u){const f=o/2;for(let d=-u;d<=u;d++){const g=this.width*(this.nextRow+u+d);let w=0,E=i[w];for(let M=0;M<this.width;M++){M/E.right>1&&(E=i[++w]);const x=Math.abs(M-E.left),S=Math.abs(M-E.right),P=Math.min(x,S);let A;const C=d/u*(f+1);if(E.isDash){const R=f-Math.abs(C);A=Math.sqrt(P*P+R*R)}else A=f-Math.sqrt(P*P+C*C);this.image.data[g+M]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(i,o){for(let E=i.length-1;E>=0;--E){const M=i[E],x=i[E+1];M.zeroLength?i.splice(E,1):x&&x.isDash===M.isDash&&(x.left=M.left,i.splice(E,1))}const u=i[0],f=i[i.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const d=this.width*this.nextRow;let g=0,w=i[g];for(let E=0;E<this.width;E++){E/w.right>1&&(w=i[++g]);const M=Math.abs(E-w.left),x=Math.abs(E-w.right),S=Math.min(M,x);this.image.data[d+E]=Math.max(0,Math.min(255,(w.isDash?S:-S)+o+128))}}addDash(i,o){const u=this.getKey(i,o);if(this.positions[u])return this.positions[u];const f=o==="round",d=f?7:0,g=2*d+1;if(this.nextRow+g>this.height)return on("LineAtlas out of space"),null;i.length===0&&i.push(1);let w=0;for(let x=0;x<i.length;x++)i[x]<0&&(on("Negative value is found in line dasharray, replacing values with 0"),i[x]=0),w+=i[x];if(w!==0){const x=this.width/w,S=this.getDashRanges(i,this.width,x);f?this.addRoundDash(S,x,d):this.addRegularDash(S,o==="square"?.5*x:0)}const E=this.nextRow+d;this.nextRow+=g;const M={tl:[E,d],br:[w,0]};return this.positions[u]=M,M}}zt(PA,"LineAtlas");const tB=Kc.VectorTileFeature.types,iB=Math.cos(Math.PI/180*37.5),nB=Math.cos(Math.PI/180*5);class jb{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Dm,this.layoutVertexArray2=new Ao,this.patternVertexArray=new Ao,this.indexArray=new Rs,this.programConfigurations=new il(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new Mn,this.maxLineLength=0,this.zOffsetVertexArray=new Ao,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:St/64}updateFootprints(i,o){}populate(i,o,u,f){this.hasPattern=Ib("line",this.layers,this.pixelRatio,o);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=m(u);const g=this.layers[0].layout.get("line-z-offset"),w=g.isConstant()&&!g.constantOr(0),E=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=E==="sea"||E==="ground"||!w&&E==="none",this.hasZOffset&&E==="none"&&on(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const M=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&M!==void 0;const x=[];for(const{feature:C,id:R,index:B,sourceLayerIndex:N}of i){const G=this.layers[0]._featureFilter.needGeometry,H=F(C,G);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),H,u))continue;const $=d?d.evaluate(H,{},u):void 0,W={id:R,properties:C.properties,type:C.type,sourceLayerIndex:N,index:B,geometry:G?H.geometry:z(C,u,f),patterns:{},sortKey:$};x.push(W)}d&&x.sort((C,R)=>C.sortKey-R.sortKey);const{lineAtlas:S,featureIndex:P}=o,A=this.addConstantDashes(S);for(const C of x){const{geometry:R,index:B,sourceLayerIndex:N}=C;if(A&&this.addFeatureDashes(C,S),this.hasPattern){const G=Cb("line",this.layers,C,this.zoom,this.pixelRatio,o);this.patternFeatures.push(G)}else this.addFeature(C,R,B,u,S.positions,o.availableImages,o.brightness);P.insert(i[B].feature,R,B,N,this.index)}}addConstantDashes(i){let o=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,d=u.layout.get("line-cap").value;if(f.kind!=="constant"||d.kind!=="constant")o=!0;else{const g=d.value,w=f.value;if(!w)continue;i.addDash(w,g)}}return o}addFeatureDashes(i,o){const u=this.zoom;for(const f of this.layers){const d=f.paint.get("line-dasharray").value,g=f.layout.get("line-cap").value;if(d.kind==="constant"&&g.kind==="constant")continue;let w,E;if(d.kind==="constant"){if(w=d.value,!w)continue}else w=d.evaluate({zoom:u},i);E=g.kind==="constant"?g.value:g.evaluate({zoom:u},i),o.addDash(w,E),i.patterns[f.id]=o.getKey(w,E)}}update(i,o,u,f,d,g,w){this.programConfigurations.updatePaintArrays(i,o,d,u,f,g,w)}addFeatures(i,o,u,f,d,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,o,u,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,JF)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,eB)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,XF.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,YF),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,o,u,f,d,g,w){const E=this.layers[0].layout,M=E.get("line-join").evaluate(i,{}),x=E.get("line-cap").evaluate(i,{}),S=E.get("line-miter-limit"),P=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i,this.zOffsetValue=E.get("line-z-offset").value;const A=this.layers[0].paint.get("line-width").value;A.kind!=="constant"&&A.isLineProgressConstant===!1&&(this.variableWidthValue=A);for(const C of o)this.addLine(C,i,f,M,x,S,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,d,g,f,w)}addLine(i,o,u,f,d,g,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const E=f==="none";if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<i.length-1;H++)this.totalDistance+=i[H].dist(i[H+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=tB[o.type]==="Polygon";let x=i.length;for(;x>=2&&i[x-1].equals(i[x-2]);)x--;let S=0;for(;S<x-1&&i[S].equals(i[S+1]);)S++;if(x<(M?3:2))return;f==="bevel"&&(g=1.05);const P=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let A,C,R,B,N,G;this.e1=this.e2=-1,M&&(A=i[x-2],N=i[S].sub(A)._unit()._perp());for(let H=S;H<x;H++){if(R=H===x-1?M?i[S+1]:void 0:i[H+1],R&&i[H].equals(R))continue;N&&(B=N),A&&(C=A),A=i[H],G=this.evaluateLineProgressFeatures(C?C.dist(A):0),N=R?R.sub(A)._unit()._perp():B,B=B||N;const $=C&&R;let W=$?f:M||E?"butt":d;const K=B.x*N.x+B.y*N.y;if(E){const Le=function(De){if(De.patternJoinNone){const Fe=De.segmentPoints.length/2,ke=De.lineSoFar-De.segmentStart;for(let He=0;He<Fe;++He){const Ve=De.segmentPoints[2*He+1],qe=Math.round(De.segmentPoints[2*He])+.5+.25*Ve;De.patternVertexArray.emplaceBack(qe,ke,De.segmentStart),De.patternVertexArray.emplaceBack(qe,ke,De.segmentStart)}De.segmentPoints.length=0}De.e1=De.e2=-1};if($&&K<nB){this.updateDistance(C,A),this.addCurrentVertex(A,B,1,1,P,G),Le(this),this.addCurrentVertex(A,N,-1,-1,P,G);continue}if(C){if(!R){this.updateDistance(C,A),this.addCurrentVertex(A,B,1,1,P,G),Le(this);continue}W="miter"}}let Q=B.add(N);Q.x===0&&Q.y===0||Q._unit();const ue=Q.x*N.x+Q.y*N.y,oe=ue!==0?1/ue:1/0,ae=2*Math.sqrt(2-2*ue),Ee=ue<iB&&C&&R,he=B.x*N.y-B.y*N.x>0,Se=this.overscaling<=16?15*St/(512*this.overscaling):0;if($&&W==="round"){if(oe<w)W="miter";else if(oe<=2){const Le=$b(A,-10,St+10);W=this.hasZOffset&&(Le||this.hasCrossSlope)?"miter":"fakeround"}}if(W==="miter"&&oe>g&&(W="bevel"),W==="bevel"&&(oe>2&&(W="flipbevel"),oe<g&&(W="miter")),C&&!(W==="miter"&&Ee)&&this.updateDistance(C,A),W==="miter")if(Ee){const Le=A.dist(C);if(Le>2*Se){const Fe=A.sub(A.sub(C)._mult(Se/Le)._round());this.updateDistance(C,Fe),this.addCurrentVertex(Fe,B,0,0,P,G),C=Fe}this.updateDistance(C,A),Q._mult(oe),this.addCurrentVertex(A,Q,0,0,P,G);const De=A.dist(R);if(De>2*Se){const Fe=A.add(R.sub(A)._mult(Se/De)._round());this.updateDistance(A,Fe),this.addCurrentVertex(Fe,N,0,0,P,G),A=Fe}}else Q._mult(oe),this.addCurrentVertex(A,Q,0,0,P,G);else if(W==="flipbevel"){if(oe>100)Q=N.mult(-1);else{const Le=oe*B.add(N).mag()/B.sub(N).mag();Q._perp()._mult(Le*(he?-1:1))}this.addCurrentVertex(A,Q,0,0,P,G),this.addCurrentVertex(A,Q.mult(-1),0,0,P,G)}else if(W==="bevel"||W==="fakeround"){G!=null&&C&&this.addCurrentVertex(A,B,-1,-1,P,G);const Le=A.dist(C)<=2*Se&&W!=="bevel",De=Q.mult(he?1:-1);De._mult(oe);const Fe=N.mult(he?-1:1),ke=B.mult(he?-1:1),He=this.evaluateLineProgressFeatures(this.distance);if(G==null&&(this.addHalfVertex(A,De.x,De.y,!1,!he,0,P,He),Le||this.addHalfVertex(A,De.x+2*ke.x,De.y+2*ke.y,!1,he,0,P,He)),W==="fakeround"){const Ve=Math.round(180*ae/Math.PI/20);this.addHalfVertex(A,ke.x,ke.y,!1,he,0,P,He);for(let qe=0;qe<Ve;qe++){let pt=qe/Ve;if(pt!==.5){const Ft=pt-.5;pt+=pt*Ft*(pt-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*Ft*Ft+(.848013+K*(.215638*K-1.06021)))}const dt=Fe.sub(ke)._mult(pt)._add(ke)._unit();this.addHalfVertex(A,dt.x,dt.y,!1,he,0,P,He)}this.addHalfVertex(A,Fe.x,Fe.y,!1,he,0,P,He)}Le||G!=null||this.addHalfVertex(A,De.x+2*Fe.x,De.y+2*Fe.y,!1,he,0,P,He),G!=null&&R&&this.addCurrentVertex(A,N,1,1,P,G)}else W==="butt"?this.addCurrentVertex(A,Q,0,0,P,G):W==="square"?(C||this.addCurrentVertex(A,Q,-1,-1,P,G),this.addCurrentVertex(A,Q,0,0,P,G),C&&this.addCurrentVertex(A,Q,1,1,P,G)):W==="round"&&(C&&(this.addCurrentVertex(A,B,0,0,P,G),this.addCurrentVertex(A,B,1,1,P,G,!0)),R&&(this.addCurrentVertex(A,N,-1,-1,P,G,!0),this.addCurrentVertex(A,N,0,0,P,G)))}}addVerticesTo(i,o,u,f,d,g,w,E,M,x){const S=(o.w-i.w)/this.tessellationStep|0;let P=0;const A=this.scaledDistance;if(S>1){this.lineSoFar=i.w;const R=(o.x-i.x)/S,B=(o.y-i.y)/S,N=(o.z-i.z)/S,G=(o.w-i.w)/S;for(let H=1;H<S;++H){i.x+=R,i.y+=B,i.z+=N,this.lineSoFar+=G,P+=G;const $=this.evaluateLineProgressFeatures(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(i,u,f,x,!1,w,M,$),this.addHalfVertex(i,d,g,x,!0,-E,M,$)}}this.lineSoFar=o.w,this.scaledDistance=A;const C=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,u,f,x,!1,w,M,C),this.addHalfVertex(o,d,g,x,!0,-E,M,C)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):on(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}:{zOffset:0,variableWidth:o}}addCurrentVertex(i,o,u,f,d,g,w=!1){const E=o.x+o.y*u,M=o.y-o.x*u,x=o.y*f-o.x,S=-o.y-o.x*f;if(g!=null){const P=this.hasZOffset,A=-10,C=St+10,R=g.zOffset,B=new iA(i.x,i.y,R,this.lineSoFar),N=!!P&&$b(i,A,C),G=this.lineSoFar,H=this.distance;if(this.currentVertex)if(N){const $=this.currentVertexIsOutside,W=this.currentVertex,K=new iA(i.x,i.y,R,this.lineSoFar);if(sA(W,K,A,C),!$b(K,A,C)){if($){this.e1=this.e2=-1,this.distance-=W.dist(B),this.lineSoFar=W.w;const Q=this.evaluateLineProgressFeatures(W.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(W,E,M,w,!1,u,d,Q),this.addHalfVertex(W,x,S,w,!0,-f,d,Q),this.prevDistance=this.distance}this.distance=this.prevDistance+W.dist(K),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(W,K,E,M,x,S,u,f,d,w),this.distance=H,this.scaledDistance=this.distance/this.totalDistance}}else{const $=this.currentVertex;if(this.currentVertexIsOutside){sA($,B,A,C),this.e1=this.e2=-1,this.distance-=$.dist(B),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=$.w;const W=this.evaluateLineProgressFeatures($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,E,M,w,!1,u,d,W),this.addHalfVertex($,x,S,w,!0,-f,d,W),this.prevDistance=this.distance,this.distance=H,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo($,B,E,M,x,S,u,f,d,w)}else N||(this.addHalfVertex(i,E,M,w,!1,u,d,g),this.addHalfVertex(i,x,S,w,!0,-f,d,g));this.currentVertex=B,this.currentVertexIsOutside=N,this.lineSoFar=G}else this.addHalfVertex(i,E,M,w,!1,u,d,g),this.addHalfVertex(i,x,S,w,!0,-f,d,g)}addHalfVertex({x:i,y:o},u,f,d,g,w,E,M){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((i<<1)+(d?1:0),(o<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const S=ni(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,S)}const x=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),E.primitiveLength++),g?this.e2=x:this.e1=x,M!=null&&this.zOffsetVertexArray.emplaceBack(M.zOffset,M.variableWidth,M.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,o){this.prevDistance=this.distance,this.distance+=i.dist(o),this.updateScaledDistance()}}function $b(c,i,o){return c.x<i||c.x>o||c.y<i||c.y>o}let DA,RA;function LA(c,i,o){return i*(St/(c.tileSize*Math.pow(2,o-c.tileID.overscaledZ)))}zt(jb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const OA=(c,i,o)=>(1-o)*c+o*i;function kA(c,i){return 1/LA(c,1,i.tileZoom)}function zA(c,i,o,u){return c.translatePosMatrix(u||i.tileID.projMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const FA=c=>{const i=[];BA(c)&&i.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const o=c.paint.get("line-trim-offset");o[0]===0&&o[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const u=c.layout.get("line-join").constantOr("miter")==="none",f=!!c.paint.get("line-pattern").constantOr(1);return u&&f&&i.push("LINE_JOIN_NONE"),i};function BA(c){const i=c.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}let Hb;const NA=()=>Hb||(Hb={layout:DA||(DA=new kn({"line-cap":new kt(We.layout_line["line-cap"]),"line-join":new kt(We.layout_line["line-join"]),"line-miter-limit":new Tt(We.layout_line["line-miter-limit"]),"line-round-limit":new Tt(We.layout_line["line-round-limit"]),"line-sort-key":new kt(We.layout_line["line-sort-key"]),"line-z-offset":new kt(We.layout_line["line-z-offset"]),"line-elevation-reference":new Tt(We.layout_line["line-elevation-reference"]),"line-cross-slope":new Tt(We.layout_line["line-cross-slope"]),visibility:new Tt(We.layout_line.visibility),"line-width-unit":new Tt(We.layout_line["line-width-unit"])})),paint:RA||(RA=new kn({"line-opacity":new kt(We.paint_line["line-opacity"]),"line-color":new kt(We.paint_line["line-color"]),"line-translate":new Tt(We.paint_line["line-translate"]),"line-translate-anchor":new Tt(We.paint_line["line-translate-anchor"]),"line-width":new kt(We.paint_line["line-width"]),"line-gap-width":new kt(We.paint_line["line-gap-width"]),"line-offset":new kt(We.paint_line["line-offset"]),"line-blur":new kt(We.paint_line["line-blur"]),"line-dasharray":new kt(We.paint_line["line-dasharray"]),"line-pattern":new kt(We.paint_line["line-pattern"]),"line-gradient":new Vc(We.paint_line["line-gradient"]),"line-trim-offset":new Tt(We.paint_line["line-trim-offset"]),"line-trim-fade-range":new Tt(We.paint_line["line-trim-fade-range"]),"line-trim-color":new Tt(We.paint_line["line-trim-color"]),"line-emissive-strength":new Tt(We.paint_line["line-emissive-strength"]),"line-border-width":new kt(We.paint_line["line-border-width"]),"line-border-color":new kt(We.paint_line["line-border-color"]),"line-occlusion-opacity":new Tt(We.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},Hb);class sB extends kt{possiblyEvaluate(i,o){return o=new fn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(i,o)}evaluate(i,o,u,f){return o=ji({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(i,o,u,f)}}let og;function VA(c,i){return i>0?i+2*c:c}const rB=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oB=Gi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),aB=Gi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lB=Gi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),cB=Gi([{name:"a_texb",components:2,type:"Uint16"}]),uB=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),hB=Gi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const UA=Gi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dB=Gi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Hs=24;const Ia=128;function jA(c,i,o,u,f){if(c.kind==="camera")return c.maxSize;if(c.kind==="composite"){const d=i.possiblyEvaluate(new fn(c.maxZoom),o).evaluate(f,{},o),g=i.possiblyEvaluate(new fn(c.minZoom),o).evaluate(f,{},o);return Math.max(d,g)}return i.possiblyEvaluate(new fn(u)).evaluate(f,{},o)}function Gb(c,i){const{expression:o}=i;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new fn(c+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:f}=o;let d=0;for(;d<u.length&&u[d]<=c;)d++;d=Math.max(0,d-1);let g=d;for(;g<u.length&&u[g]<c+1;)g++;g=Math.min(u.length-1,g);const w=u[d],E=u[g];return o.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:E,minSize:o.evaluate(new fn(w)),maxSize:o.evaluate(new fn(E)),interpolationType:f}}}function m0(c,{uSize:i,uSizeT:o},{lowerSize:u,upperSize:f}){return c.kind==="source"?u/Ia:c.kind==="composite"?ni(u/Ia,f/Ia,o):i}function wf(c,i,o=1){let u=0,f=0;if(c.kind==="constant")f=c.layoutSize*o;else if(c.kind!=="source"){const{interpolationType:d,minZoom:g,maxZoom:w}=c,E=d?At(jr.interpolationFactor(d,i,g,w),0,1):0;c.kind==="camera"?f=ni(c.minSize,c.maxSize,E)*o:u=E*o}return{uSizeT:u,uSize:f}}var fB=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ia,evaluateSizeForFeature:m0,evaluateSizeForZoom:wf,getRasterizedIconSize:jA,getSizeData:Gb});function pB(c,i,o){return c.sections.forEach(u=>{u.text=function(f,d,g){const w=d.layout.get("text-transform").evaluate(g,{});return w==="uppercase"?f=f.toLocaleUpperCase():w==="lowercase"&&(f=f.toLocaleLowerCase()),oo.applyArabicShaping&&(f=oo.applyArabicShaping(f)),f}(u.text,i,o)}),c}const ag={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function mB(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function gB(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var $A,qb,HA,Wb={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function _B(){return $A||($A=1,Wb.read=function(c,i,o,u,f){var d,g,w=8*f-u-1,E=(1<<w)-1,M=E>>1,x=-7,S=o?f-1:0,P=o?-1:1,A=c[i+S];for(S+=P,d=A&(1<<-x)-1,A>>=-x,x+=w;x>0;d=256*d+c[i+S],S+=P,x-=8);for(g=d&(1<<-x)-1,d>>=-x,x+=u;x>0;g=256*g+c[i+S],S+=P,x-=8);if(d===0)d=1-M;else{if(d===E)return g?NaN:1/0*(A?-1:1);g+=Math.pow(2,u),d-=M}return(A?-1:1)*g*Math.pow(2,d-u)},Wb.write=function(c,i,o,u,f,d){var g,w,E,M=8*d-f-1,x=(1<<M)-1,S=x>>1,P=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=u?0:d-1,C=u?1:-1,R=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,g=x):(g=Math.floor(Math.log(i)/Math.LN2),i*(E=Math.pow(2,-g))<1&&(g--,E*=2),(i+=g+S>=1?P/E:P*Math.pow(2,1-S))*E>=2&&(g++,E/=2),g+S>=x?(w=0,g=x):g+S>=1?(w=(i*E-1)*Math.pow(2,f),g+=S):(w=i*Math.pow(2,S-1)*Math.pow(2,f),g=0));f>=8;c[o+A]=255&w,A+=C,w/=256,f-=8);for(g=g<<f|w,M+=f;M>0;c[o+A]=255&g,A+=C,g/=256,M-=8);c[o+A-C]|=128*R}),Wb}function GA(){if(HA)return qb;HA=1,qb=i;var c=_B();function i($){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView($)?$:new Uint8Array($||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,u=1/o,f=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d($){return $.type===i.Bytes?$.readVarint()+$.pos:$.pos+1}function g($,W,K){return K?4294967296*W+($>>>0):4294967296*(W>>>0)+($>>>0)}function w($,W,K){var Q=W<=16383?1:W<=2097151?2:W<=268435455?3:Math.floor(Math.log(W)/(7*Math.LN2));K.realloc(Q);for(var ue=K.pos-1;ue>=$;ue--)K.buf[ue+Q]=K.buf[ue]}function E($,W){for(var K=0;K<$.length;K++)W.writeVarint($[K])}function M($,W){for(var K=0;K<$.length;K++)W.writeSVarint($[K])}function x($,W){for(var K=0;K<$.length;K++)W.writeFloat($[K])}function S($,W){for(var K=0;K<$.length;K++)W.writeDouble($[K])}function P($,W){for(var K=0;K<$.length;K++)W.writeBoolean($[K])}function A($,W){for(var K=0;K<$.length;K++)W.writeFixed32($[K])}function C($,W){for(var K=0;K<$.length;K++)W.writeSFixed32($[K])}function R($,W){for(var K=0;K<$.length;K++)W.writeFixed64($[K])}function B($,W){for(var K=0;K<$.length;K++)W.writeSFixed64($[K])}function N($,W){return($[W]|$[W+1]<<8|$[W+2]<<16)+16777216*$[W+3]}function G($,W,K){$[K]=W,$[K+1]=W>>>8,$[K+2]=W>>>16,$[K+3]=W>>>24}function H($,W){return($[W]|$[W+1]<<8|$[W+2]<<16)+($[W+3]<<24)}return i.prototype={destroy:function(){this.buf=null},readFields:function($,W,K){for(K=K||this.length;this.pos<K;){var Q=this.readVarint(),ue=Q>>3,oe=this.pos;this.type=7&Q,$(ue,W,this),this.pos===oe&&this.skip(Q)}return W},readMessage:function($,W){return this.readFields($,W,this.readVarint()+this.pos)},readFixed32:function(){var $=N(this.buf,this.pos);return this.pos+=4,$},readSFixed32:function(){var $=H(this.buf,this.pos);return this.pos+=4,$},readFixed64:function(){var $=N(this.buf,this.pos)+N(this.buf,this.pos+4)*o;return this.pos+=8,$},readSFixed64:function(){var $=N(this.buf,this.pos)+H(this.buf,this.pos+4)*o;return this.pos+=8,$},readFloat:function(){var $=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,$},readDouble:function(){var $=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,$},readVarint:function($){var W,K,Q=this.buf;return W=127&(K=Q[this.pos++]),K<128?W:(W|=(127&(K=Q[this.pos++]))<<7,K<128?W:(W|=(127&(K=Q[this.pos++]))<<14,K<128?W:(W|=(127&(K=Q[this.pos++]))<<21,K<128?W:function(ue,oe,ae){var Ee,he,Se=ae.buf;if(Ee=(112&(he=Se[ae.pos++]))>>4,he<128||(Ee|=(127&(he=Se[ae.pos++]))<<3,he<128)||(Ee|=(127&(he=Se[ae.pos++]))<<10,he<128)||(Ee|=(127&(he=Se[ae.pos++]))<<17,he<128)||(Ee|=(127&(he=Se[ae.pos++]))<<24,he<128)||(Ee|=(1&(he=Se[ae.pos++]))<<31,he<128))return g(ue,Ee,oe);throw new Error("Expected varint not more than 10 bytes")}(W|=(15&(K=Q[this.pos]))<<28,$,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var $=this.readVarint();return $%2==1?($+1)/-2:$/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var $=this.readVarint()+this.pos,W=this.pos;return this.pos=$,$-W>=12&&f?function(K,Q,ue){return f.decode(K.subarray(Q,ue))}(this.buf,W,$):function(K,Q,ue){for(var oe="",ae=Q;ae<ue;){var Ee,he,Se,Le=K[ae],De=null,Fe=Le>239?4:Le>223?3:Le>191?2:1;if(ae+Fe>ue)break;Fe===1?Le<128&&(De=Le):Fe===2?(192&(Ee=K[ae+1]))==128&&(De=(31&Le)<<6|63&Ee)<=127&&(De=null):Fe===3?(he=K[ae+2],(192&(Ee=K[ae+1]))==128&&(192&he)==128&&((De=(15&Le)<<12|(63&Ee)<<6|63&he)<=2047||De>=55296&&De<=57343)&&(De=null)):Fe===4&&(he=K[ae+2],Se=K[ae+3],(192&(Ee=K[ae+1]))==128&&(192&he)==128&&(192&Se)==128&&((De=(15&Le)<<18|(63&Ee)<<12|(63&he)<<6|63&Se)<=65535||De>=1114112)&&(De=null)),De===null?(De=65533,Fe=1):De>65535&&(De-=65536,oe+=String.fromCharCode(De>>>10&1023|55296),De=56320|1023&De),oe+=String.fromCharCode(De),ae+=Fe}return oe}(this.buf,W,$)},readBytes:function(){var $=this.readVarint()+this.pos,W=this.buf.subarray(this.pos,$);return this.pos=$,W},readPackedVarint:function($,W){if(this.type!==i.Bytes)return $.push(this.readVarint(W));var K=d(this);for($=$||[];this.pos<K;)$.push(this.readVarint(W));return $},readPackedSVarint:function($){if(this.type!==i.Bytes)return $.push(this.readSVarint());var W=d(this);for($=$||[];this.pos<W;)$.push(this.readSVarint());return $},readPackedBoolean:function($){if(this.type!==i.Bytes)return $.push(this.readBoolean());var W=d(this);for($=$||[];this.pos<W;)$.push(this.readBoolean());return $},readPackedFloat:function($){if(this.type!==i.Bytes)return $.push(this.readFloat());var W=d(this);for($=$||[];this.pos<W;)$.push(this.readFloat());return $},readPackedDouble:function($){if(this.type!==i.Bytes)return $.push(this.readDouble());var W=d(this);for($=$||[];this.pos<W;)$.push(this.readDouble());return $},readPackedFixed32:function($){if(this.type!==i.Bytes)return $.push(this.readFixed32());var W=d(this);for($=$||[];this.pos<W;)$.push(this.readFixed32());return $},readPackedSFixed32:function($){if(this.type!==i.Bytes)return $.push(this.readSFixed32());var W=d(this);for($=$||[];this.pos<W;)$.push(this.readSFixed32());return $},readPackedFixed64:function($){if(this.type!==i.Bytes)return $.push(this.readFixed64());var W=d(this);for($=$||[];this.pos<W;)$.push(this.readFixed64());return $},readPackedSFixed64:function($){if(this.type!==i.Bytes)return $.push(this.readSFixed64());var W=d(this);for($=$||[];this.pos<W;)$.push(this.readSFixed64());return $},skip:function($){var W=7&$;if(W===i.Varint)for(;this.buf[this.pos++]>127;);else if(W===i.Bytes)this.pos=this.readVarint()+this.pos;else if(W===i.Fixed32)this.pos+=4;else{if(W!==i.Fixed64)throw new Error("Unimplemented type: "+W);this.pos+=8}},writeTag:function($,W){this.writeVarint($<<3|W)},realloc:function($){for(var W=this.length||16;W<this.pos+$;)W*=2;if(W!==this.length){var K=new Uint8Array(W);K.set(this.buf),this.buf=K,this.length=W}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function($){this.realloc(4),G(this.buf,$,this.pos),this.pos+=4},writeSFixed32:function($){this.realloc(4),G(this.buf,$,this.pos),this.pos+=4},writeFixed64:function($){this.realloc(8),G(this.buf,-1&$,this.pos),G(this.buf,Math.floor($*u),this.pos+4),this.pos+=8},writeSFixed64:function($){this.realloc(8),G(this.buf,-1&$,this.pos),G(this.buf,Math.floor($*u),this.pos+4),this.pos+=8},writeVarint:function($){($=+$||0)>268435455||$<0?function(W,K){var Q,ue;if(W>=0?(Q=W%4294967296|0,ue=W/4294967296|0):(ue=~(-W/4294967296),4294967295^(Q=~(-W%4294967296))?Q=Q+1|0:(Q=0,ue=ue+1|0)),W>=18446744073709552e3||W<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");K.realloc(10),function(oe,ae,Ee){Ee.buf[Ee.pos++]=127&oe|128,oe>>>=7,Ee.buf[Ee.pos++]=127&oe|128,oe>>>=7,Ee.buf[Ee.pos++]=127&oe|128,oe>>>=7,Ee.buf[Ee.pos++]=127&oe|128,Ee.buf[Ee.pos]=127&(oe>>>=7)}(Q,0,K),function(oe,ae){var Ee=(7&oe)<<4;ae.buf[ae.pos++]|=Ee|((oe>>>=3)?128:0),oe&&(ae.buf[ae.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(ae.buf[ae.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(ae.buf[ae.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(ae.buf[ae.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(ae.buf[ae.pos++]=127&oe)))))}(ue,K)}($,this):(this.realloc(4),this.buf[this.pos++]=127&$|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=$>>>7&127))))},writeSVarint:function($){this.writeVarint($<0?2*-$-1:2*$)},writeBoolean:function($){this.writeVarint(!!$)},writeString:function($){$=String($),this.realloc(4*$.length),this.pos++;var W=this.pos;this.pos=function(Q,ue,oe){for(var ae,Ee,he=0;he<ue.length;he++){if((ae=ue.charCodeAt(he))>55295&&ae<57344){if(!Ee){ae>56319||he+1===ue.length?(Q[oe++]=239,Q[oe++]=191,Q[oe++]=189):Ee=ae;continue}if(ae<56320){Q[oe++]=239,Q[oe++]=191,Q[oe++]=189,Ee=ae;continue}ae=Ee-55296<<10|ae-56320|65536,Ee=null}else Ee&&(Q[oe++]=239,Q[oe++]=191,Q[oe++]=189,Ee=null);ae<128?Q[oe++]=ae:(ae<2048?Q[oe++]=ae>>6|192:(ae<65536?Q[oe++]=ae>>12|224:(Q[oe++]=ae>>18|240,Q[oe++]=ae>>12&63|128),Q[oe++]=ae>>6&63|128),Q[oe++]=63&ae|128)}return oe}(this.buf,$,this.pos);var K=this.pos-W;K>=128&&w(W,K,this),this.pos=W-1,this.writeVarint(K),this.pos+=K},writeFloat:function($){this.realloc(4),c.write(this.buf,$,this.pos,!0,23,4),this.pos+=4},writeDouble:function($){this.realloc(8),c.write(this.buf,$,this.pos,!0,52,8),this.pos+=8},writeBytes:function($){var W=$.length;this.writeVarint(W),this.realloc(W);for(var K=0;K<W;K++)this.buf[this.pos++]=$[K]},writeRawMessage:function($,W){this.pos++;var K=this.pos;$(W,this);var Q=this.pos-K;Q>=128&&w(K,Q,this),this.pos=K-1,this.writeVarint(Q),this.pos+=Q},writeMessage:function($,W,K){this.writeTag($,i.Bytes),this.writeRawMessage(W,K)},writePackedVarint:function($,W){W.length&&this.writeMessage($,E,W)},writePackedSVarint:function($,W){W.length&&this.writeMessage($,M,W)},writePackedBoolean:function($,W){W.length&&this.writeMessage($,P,W)},writePackedFloat:function($,W){W.length&&this.writeMessage($,x,W)},writePackedDouble:function($,W){W.length&&this.writeMessage($,S,W)},writePackedFixed32:function($,W){W.length&&this.writeMessage($,A,W)},writePackedSFixed32:function($,W){W.length&&this.writeMessage($,C,W)},writePackedFixed64:function($,W){W.length&&this.writeMessage($,R,W)},writePackedSFixed64:function($,W){W.length&&this.writeMessage($,B,W)},writeBytesField:function($,W){this.writeTag($,i.Bytes),this.writeBytes(W)},writeFixed32Field:function($,W){this.writeTag($,i.Fixed32),this.writeFixed32(W)},writeSFixed32Field:function($,W){this.writeTag($,i.Fixed32),this.writeSFixed32(W)},writeFixed64Field:function($,W){this.writeTag($,i.Fixed64),this.writeFixed64(W)},writeSFixed64Field:function($,W){this.writeTag($,i.Fixed64),this.writeSFixed64(W)},writeVarintField:function($,W){this.writeTag($,i.Varint),this.writeVarint(W)},writeSVarintField:function($,W){this.writeTag($,i.Varint),this.writeSVarint(W)},writeStringField:function($,W){this.writeTag($,i.Bytes),this.writeString(W)},writeFloatField:function($,W){this.writeTag($,i.Fixed32),this.writeFloat(W)},writeDoubleField:function($,W){this.writeTag($,i.Fixed64),this.writeDouble(W)},writeBooleanField:function($,W){this.writeVarintField($,!!W)}},qb}var g0=I(GA());const Zb=3;function yB(c,i,o){i.glyphs=[],c===1&&o.readMessage(vB,i)}function vB(c,i,o){if(c===3){const{id:u,bitmap:f,width:d,height:g,left:w,top:E,advance:M}=o.readMessage(xB,{});i.glyphs.push({id:u,bitmap:new Yc({width:d+2*Zb,height:g+2*Zb},f),metrics:{width:d,height:g,left:w,top:E,advance:M}})}else c===4?i.ascender=o.readSVarint():c===5&&(i.descender=o.readSVarint())}function xB(c,i,o){c===1?i.id=o.readVarint():c===2?i.bitmap=o.readBytes():c===3?i.width=o.readVarint():c===4?i.height=o.readVarint():c===5?i.left=o.readSVarint():c===6?i.top=o.readSVarint():c===7&&(i.advance=o.readVarint())}const qA=Zb,Wr={horizontal:1,vertical:2,horizontalOnly:3};class lg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,o){const u=new lg;return u.scale=i||1,u.fontStack=o,u}static forImage(i){const o=new lg;return o.image=i,o}}class Tf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,o,u){const f=new Tf;for(let d=0;d<i.sections.length;d++){const g=i.sections[d];g.image?f.addImageSection(g,u):f.addTextSection(g,o)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(o,u){let f="";for(let d=0;d<o.length;d++){const g=o.charCodeAt(d+1)||null,w=o.charCodeAt(d-1)||null;f+=!u&&(g&&vm(g)&&!ag[o[d+1]]||w&&vm(w)&&!ag[o[d-1]])||!ag[o[d]]?o[d]:ag[o[d]]}return f}(this.text,i)}trim(){let i=0;for(let u=0;u<this.text.length&&_0[this.text.charCodeAt(u)];u++)i++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=i&&_0[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(i,o),this.sectionIndex=this.sectionIndex.slice(i,o)}substring(i,o){const u=new Tf;return u.text=this.text.substring(i,o),u.sectionIndex=this.sectionIndex.slice(i,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,o)=>Math.max(i,this.sections[o].scale),0)}addTextSection(i,o){this.text+=i.text,this.sections.push(lg.forText(i.scale,i.fontStack||o));const u=this.sections.length-1;for(let f=0;f<i.text.length;++f)this.sectionIndex.push(u)}addImageSection(i,o){const u=i.image?i.image.getPrimary():null;if(!u)return void on("Can't add FormattedSection with an empty image.");u.scaleSelf(o);const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCodePoint(f),this.sections.push(lg.forImage(u)),this.sectionIndex.push(this.sections.length-1)):on("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xb(c,i,o,u,f,d,g,w,E,M,x,S,P,A,C,R=1){const B=Tf.fromFeature(c,f,R);S===Wr.vertical&&B.verticalizePunctuation(P);let N=[];const G=function(Q,ue,oe,ae,Ee,he){if(!Q)return[];const Se=[],Le=function(He,Ve,qe,pt,dt,Ft){let _t=0;for(let Et=0;Et<He.length();Et++){const mt=He.getSection(Et);_t+=WA(He.getCodePoint(Et),mt,pt,dt,Ve,Ft)}return _t/Math.max(1,Math.ceil(_t/qe))}(Q,ue,oe,ae,Ee,he),De=Q.text.indexOf("​")>=0;let Fe=0;for(let He=0;He<Q.length();He++){const Ve=Q.getSection(He),qe=Q.getCodePoint(He);if(_0[qe]||(Fe+=WA(qe,Ve,ae,Ee,ue,he)),He<Q.length()-1){const pt=!((ke=qe)<11904||!(Qt["Bopomofo Extended"](ke)||Qt.Bopomofo(ke)||Qt["CJK Compatibility Forms"](ke)||Qt["CJK Compatibility Ideographs"](ke)||Qt["CJK Compatibility"](ke)||Qt["CJK Radicals Supplement"](ke)||Qt["CJK Strokes"](ke)||Qt["CJK Symbols and Punctuation"](ke)||Qt["CJK Unified Ideographs Extension A"](ke)||Qt["CJK Unified Ideographs"](ke)||Qt["Enclosed CJK Letters and Months"](ke)||Qt["Halfwidth and Fullwidth Forms"](ke)||Qt.Hiragana(ke)||Qt["Ideographic Description Characters"](ke)||Qt["Kangxi Radicals"](ke)||Qt["Katakana Phonetic Extensions"](ke)||Qt.Katakana(ke)||Qt["Vertical Forms"](ke)||Qt["Yi Radicals"](ke)||Qt["Yi Syllables"](ke)));(bB[qe]||pt||Ve.image)&&Se.push(XA(He+1,Fe,Le,Se,wB(qe,Q.getCodePoint(He+1),pt&&De),!1))}}var ke;return YA(XA(Q.length(),Fe,Le,Se,0,!0))}(B,M,d,i,u,A),{processBidirectionalText:H,processStyledBidirectionalText:$}=oo;if(H&&B.sections.length===1){const Q=H(B.toString(),G);for(const ue of Q){const oe=new Tf;oe.text=ue,oe.sections=B.sections;for(let ae=0;ae<ue.length;ae++)oe.sectionIndex.push(0);N.push(oe)}}else if($){const Q=$(B.text,B.sectionIndex,G);for(const ue of Q){const oe=new Tf;oe.text=ue[0],oe.sectionIndex=ue[1],oe.sections=B.sections,N.push(oe)}}else N=function(Q,ue){const oe=[],ae=Q.text;let Ee=0;for(const he of ue)oe.push(Q.substring(Ee,he)),Ee=he;return Ee<ae.length&&oe.push(Q.substring(Ee,ae.length)),oe}(B,G);const W=[],K={positionedLines:W,text:B.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Q,ue,oe,ae,Ee,he,Se,Le,De,Fe,ke,He){let Ve=0,qe=0,pt=0;const dt=Le==="right"?1:Le==="left"?0:.5;let Ft=!1;for(const jt of Ee){const ai=jt.getSections();for(const wi of ai){if(wi.image)continue;const di=ue[wi.fontStack];if(di&&(Ft=di.ascender!==void 0&&di.descender!==void 0,!Ft))break}if(!Ft)break}let _t=0;for(const jt of Ee){jt.trim();const ai=jt.getMaxScale(),wi=(ai-1)*Hs,di={positionedGlyphs:[],lineOffset:0};Q.positionedLines[_t]=di;const Ii=di.positionedGlyphs;let bi=0;if(!jt.length()){qe+=he,++_t;continue}let Pi=0,Ui=0;for(let ui=0;ui<jt.length();ui++){const Oi=jt.getSection(ui),En=jt.getSectionIndex(ui),Rn=jt.getCodePoint(ui);let zn=Oi.scale,Vn=null,dn=null,ws=null,_r=Hs,Qn=0;De===Wr.vertical&&((Et=Rn)===12312||Et===12313||Et===12316||Et===12540||Et===12448)&&(De=Wr.horizontal);const rs=!(De===Wr.horizontal||!ke&&!Jd(Rn)||ke&&(_0[Rn]||zy(Rn)));if(Oi.image){const Qs=ae.get(Oi.image.toString());if(!Qs)continue;ws=Oi.image,Q.iconsInText=Q.iconsInText||!0,dn=Qs.paddedRect;const ks=Qs.displaySize;zn=zn*Hs/He,Vn={width:ks[0],height:ks[1],left:0,top:-qA,advance:rs?ks[1]:ks[0],localGlyph:!1},Qn=Ft?-Vn.height*zn:ai*Hs-17-ks[1]*zn,_r=Vn.advance;const Co=(rs?ks[0]:ks[1])*zn-Hs*ai;Co>0&&Co>bi&&(bi=Co)}else{const Qs=oe[Oi.fontStack];if(!Qs)continue;Qs[Rn]&&(dn=Qs[Rn]);const ks=ue[Oi.fontStack];if(!ks)continue;const Co=ks.glyphs[Rn];if(!Co)continue;if(Vn=Co.metrics,_r=Rn!==8203?Hs:0,Ft){const su=ks.ascender!==void 0?Math.abs(ks.ascender):0,Jo=ks.descender!==void 0?Math.abs(ks.descender):0,La=(su+Jo)*zn;Pi<La&&(Pi=La,Ui=(su-Jo)/2*zn),Qn=-su*zn}else Qn=(ai-zn)*Hs-17}rs?(Q.verticalizable=!0,Ii.push({glyph:Rn,image:ws,x:Ve,y:qe+Qn,vertical:rs,scale:zn,localGlyph:Vn.localGlyph,fontStack:Oi.fontStack,sectionIndex:En,metrics:Vn,rect:dn}),Ve+=_r*zn+Fe):(Ii.push({glyph:Rn,image:ws,x:Ve,y:qe+Qn,vertical:rs,scale:zn,localGlyph:Vn.localGlyph,fontStack:Oi.fontStack,sectionIndex:En,metrics:Vn,rect:dn}),Ve+=Vn.advance*zn+Fe)}Ii.length!==0&&(pt=Math.max(Ve-Fe,pt),Ft?KA(Ii,dt,bi,Ui,he*ai/2):KA(Ii,dt,bi,0,he/2)),Ve=0;const pn=he*ai+bi;di.lineOffset=Math.max(bi,wi),qe+=pn,++_t}var Et;const mt=qe,{horizontalAlign:ei,verticalAlign:Lt}=Yb(Se);(function(jt,ai,wi,di,Ii,bi){const Pi=(ai-wi)*Ii,Ui=-bi*di;for(const pn of jt)for(const ui of pn.positionedGlyphs)ui.x+=Pi,ui.y+=Ui})(Q.positionedLines,dt,ei,Lt,pt,mt),Q.top+=-Lt*mt,Q.bottom=Q.top+mt,Q.left+=-ei*pt,Q.right=Q.left+pt,Q.hasBaseline=Ft}(K,i,o,u,N,g,w,E,S,M,P,C),!function(Q){for(const ue of Q)if(ue.positionedGlyphs.length!==0)return!1;return!0}(W))return K}const _0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bB={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function WA(c,i,o,u,f,d){if(i.image){const g=u.get(i.image.toString());return g?g.displaySize[0]*i.scale*Hs/d+f:0}{const g=o[i.fontStack],w=g&&g.glyphs[c];return w?w.metrics.advance*i.scale+f:0}}function ZA(c,i,o,u){const f=Math.pow(c-i,2);return u?c<i?f/2:2*f:f+Math.abs(o)*o}function wB(c,i,o){let u=0;return c===10&&(u-=1e4),o&&(u+=150),c!==40&&c!==65288||(u+=50),i!==41&&i!==65289||(u+=50),u}function XA(c,i,o,u,f,d){let g=null,w=ZA(i,o,f,d);for(const E of u){const M=ZA(i-E.x,o,f,d)+E.badness;M<=w&&(g=E,w=M)}return{index:c,x:i,priorBreak:g,badness:w}}function YA(c){return c?YA(c.priorBreak).concat(c.index):[]}function Yb(c){let i=.5,o=.5;switch(c){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:i,verticalAlign:o}}function KA(c,i,o,u,f){if(!(i||o||u||f))return;const d=c.length-1,g=c[d],w=(g.x+g.metrics.advance*g.scale)*i;for(let E=0;E<=d;E++)c[E].x-=w,c[E].y+=o+u+f}function TB(c,i,o,u){const{horizontalAlign:f,verticalAlign:d}=Yb(u),g=o[0]-c.displaySize[0]*f,w=o[1]-c.displaySize[1]*d;return{imagePrimary:c,imageSecondary:i,top:w,bottom:w+c.displaySize[1],left:g,right:g+c.displaySize[0]}}function JA(c,i,o,u,f,d){const g=c.imagePrimary;let w;if(g.content){const B=g.content,N=g.pixelRatio||1;w=[B[0]/N,B[1]/N,g.displaySize[0]-B[2]/N,g.displaySize[1]-B[3]/N]}const E=i.left*d,M=i.right*d;let x,S,P,A;o==="width"||o==="both"?(A=f[0]+E-u[3],S=f[0]+M+u[1]):(A=f[0]+(E+M-g.displaySize[0])/2,S=A+g.displaySize[0]);const C=i.top*d,R=i.bottom*d;return o==="height"||o==="both"?(x=f[1]+C-u[0],P=f[1]+R+u[2]):(x=f[1]+(C+R-g.displaySize[1])/2,P=x+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:x,right:S,bottom:P,left:A,collisionPadding:w}}class zl extends Ie{constructor(i,o,u,f,d){super(i,o),this.angle=f,this.z=u,d!==void 0&&(this.segment=d)}clone(){return new zl(this.x,this.y,this.z,this.angle,this.segment)}}function QA(c,i,o,u,f){if(i.segment===void 0)return!0;let d=i,g=i.segment+1,w=0;for(;w>-o/2;){if(g--,g<0)return!1;w-=c[g].dist(d),d=c[g]}w+=c[g].dist(c[g+1]),g++;const E=[];let M=0;for(;w<o/2;){const x=c[g],S=c[g+1];if(!S)return!1;let P=c[g-1].angleTo(x)-x.angleTo(S);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:P}),M+=P;w-E[0].distance>u;)M-=E.shift().angleDelta;if(M>f)return!1;g++,w+=x.dist(S)}return!0}function eM(c){let i=0;for(let o=0;o<c.length-1;o++)i+=c[o].dist(c[o+1]);return i}function tM(c,i,o){return c?.6*i*o:0}function iM(c,i){return Math.max(c?c.right-c.left:0,i?i.right-i.left:0)}function EB(c,i,o,u,f,d){const g=tM(o,f,d),w=iM(o,u)*d;let E=0;const M=eM(c)/2;for(let x=0;x<c.length-1;x++){const S=c[x],P=c[x+1],A=S.dist(P);if(E+A>M){const C=(M-E)/A,R=ni(S.x,P.x,C),B=ni(S.y,P.y,C),N=new zl(R,B,0,P.angleTo(S),x);return!g||QA(c,N,w,g,i)?N:void 0}E+=A}}function SB(c,i,o,u,f,d,g,w,E){const M=tM(u,d,g),x=iM(u,f),S=x*g,P=c[0].x===0||c[0].x===E||c[0].y===0||c[0].y===E;return i-S<i/4&&(i=S+i/4),nM(c,P?i/2*w%i:(x/2+2*d)*g*w%i,i,M,o,S,P,!1,E)}function nM(c,i,o,u,f,d,g,w,E){const M=d/2,x=eM(c);let S=0,P=i-o,A=[];for(let C=0;C<c.length-1;C++){const R=c[C],B=c[C+1],N=R.dist(B),G=B.angleTo(R);for(;P+o<S+N;){P+=o;const H=(P-S)/N,$=ni(R.x,B.x,H),W=ni(R.y,B.y,H);if($>=0&&$<E&&W>=0&&W<E&&P-M>=0&&P+M<=x){const K=new zl($,W,0,G,C);u&&!QA(c,K,d,u,f)||A.push(K)}}S+=N}return w||A.length||g||(A=nM(c,S/2,o,u,f,d,g,!0,E)),A}function sM(c,i,o,u,f){const d=[];for(let g=0;g<c.length;g++){const w=c[g];let E;for(let M=0;M<w.length-1;M++){let x=w[M],S=w[M+1];x.x<i&&S.x<i||(x.x<i?x=new Ie(i,x.y+(i-x.x)/(S.x-x.x)*(S.y-x.y))._round():S.x<i&&(S=new Ie(i,x.y+(i-x.x)/(S.x-x.x)*(S.y-x.y))._round()),x.y<o&&S.y<o||(x.y<o?x=new Ie(x.x+(o-x.y)/(S.y-x.y)*(S.x-x.x),o)._round():S.y<o&&(S=new Ie(x.x+(o-x.y)/(S.y-x.y)*(S.x-x.x),o)._round()),x.x>=u&&S.x>=u||(x.x>=u?x=new Ie(u,x.y+(u-x.x)/(S.x-x.x)*(S.y-x.y))._round():S.x>=u&&(S=new Ie(u,x.y+(u-x.x)/(S.x-x.x)*(S.y-x.y))._round()),x.y>=f&&S.y>=f||(x.y>=f?x=new Ie(x.x+(f-x.y)/(S.y-x.y)*(S.x-x.x),f)._round():S.y>=f&&(S=new Ie(x.x+(f-x.y)/(S.y-x.y)*(S.x-x.x),f)._round()),E&&x.equals(E[E.length-1])||(E=[x],d.push(E)),E.push(S)))))}}return d}function rM(c){let i=0,o=0;for(const g of c)i+=g.w*g.h,o=Math.max(o,g.w);c.sort((g,w)=>w.h-g.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),o),h:1/0}];let f=0,d=0;for(const g of c)for(let w=u.length-1;w>=0;w--){const E=u[w];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,d=Math.max(d,g.y+g.h),f=Math.max(f,g.x+g.w),g.w===E.w&&g.h===E.h){const M=u.pop();w<u.length&&(u[w]=M)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(u.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:f,h:d,fill:i/(f*d)||0}}zt(zl,"Anchor");const Ef=1;class cg{static getImagePositionScale(i,o,u){if(o&&i&&i.options&&i.options.transform){const f=i.options.transform;return{x:f.a,y:f.d}}return{x:u,y:u}}constructor(i,o,u,f){this.paddedRect=i;const{pixelRatio:d,version:g,stretchX:w,stretchY:E,content:M,sdf:x,usvg:S}=o;this.pixelRatio=d,this.stretchX=w,this.stretchY=E,this.content=M,this.version=g,this.padding=u,this.sdf=x,this.scale=cg.getImagePositionScale(f,S,d)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function oM(c,i,o){const u=Ho.parse(c),f=function(d,g,w=[1,1]){return{x:0,y:0,w:(d.data?d.data.width:d.width*w[0])+2*g,h:(d.data?d.data.height:d.height*w[1])+2*g}}(i,o,[u.options.transform.a,u.options.transform.d]);return{bin:f,imagePosition:new cg(f,i,o,u),imageVariant:u}}class aM{constructor(i,o,u){const f=new Map,d=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(i,f,Ef,g),this.addImages(o,d,2,g);const{w,h:E}=rM(g),M=new $s({width:w||1,height:E||1});for(const[x,S]of i.entries()){const P=f.get(x).paddedRect;$s.copy(S.data,M,{x:0,y:0},{x:P.x+Ef,y:P.y+Ef},S.data,u,S.sdf)}for(const[x,S]of o.entries()){const P=d.get(x),A=P.paddedRect;let C=P.padding;const R=A.x+C,B=A.y+C,N=S.data.width,G=S.data.height;C=C>1?C-1:C,$s.copy(S.data,M,{x:0,y:0},{x:R,y:B},S.data,u),$s.copy(S.data,M,{x:0,y:G-C},{x:R,y:B-C},{width:N,height:C},u),$s.copy(S.data,M,{x:0,y:0},{x:R,y:B+G},{width:N,height:C},u),$s.copy(S.data,M,{x:N-C,y:0},{x:R-C,y:B},{width:C,height:G},u),$s.copy(S.data,M,{x:0,y:0},{x:R+N,y:B},{width:C,height:G},u),$s.copy(S.data,M,{x:N-C,y:G-C},{x:R-C,y:B-C},{width:C,height:C},u),$s.copy(S.data,M,{x:0,y:G-C},{x:R+N,y:B-C},{width:C,height:C},u),$s.copy(S.data,M,{x:0,y:0},{x:R+N,y:B+G},{width:C,height:C},u),$s.copy(S.data,M,{x:N-C,y:0},{x:R-C,y:B+G},{width:C,height:C},u)}this.lut=u,this.image=M,this.iconPositions=f,this.patternPositions=d}addImages(i,o,u,f){for(const[d,g]of i.entries()){const{bin:w,imagePosition:E,imageVariant:M}=oM(d,g,u);o.set(d,E),f.push(w),g.hasRenderCallback&&this.haveRenderCallbacks.push(M.id)}}patchUpdatedImages(i,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>i.hasImage(f,u)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const f of i.getUpdatedImages(u)){for(const d of this.iconPositions.keys()){const g=Ho.parse(d);if(pr.isEqual(g.id,f)){const w=i.getImage(f,u);this.patchUpdatedImage(this.iconPositions.get(d),w,o)}}for(const d of this.patternPositions.keys()){const g=Ho.parse(d);if(pr.isEqual(g.id,f)){const w=i.getImage(f,u);this.patchUpdatedImage(this.patternPositions.get(d),w,o)}}}}patchUpdatedImage(i,o,u){if(!i||!o||i.version===o.version)return;i.version=o.version;const[f,d]=i.tl,g=i.sdf;if(this.lut||g){const w={width:o.data.width,height:o.data.height},E=new $s(w);$s.copy(o.data,E,{x:0,y:0},{x:0,y:0},w,this.lut,g),u.update(E,{position:{x:f,y:d}})}else u.update(o.data,{position:{x:f,y:d}})}}zt(cg,"ImagePosition"),zt(aM,"ImageAtlas");const ug=1e20;function lM(c,i,o,u,f,d,g,w,E){for(let M=i;M<i+u;M++)cM(c,o*d+M,d,f,g,w,E);for(let M=o;M<o+f;M++)cM(c,M*d+i,1,u,g,w,E)}function cM(c,i,o,u,f,d,g){d[0]=0,g[0]=-ug,g[1]=ug,f[0]=c[i];for(let w=1,E=0,M=0;w<u;w++){f[w]=c[i+w*o];const x=w*w;do{const S=d[E];M=(f[w]-f[S]+x-S*S)/(w-S)/2}while(M<=g[E]&&--E>-1);E++,d[E]=w,g[E]=M,g[E+1]=ug}for(let w=0,E=0;w<u;w++){for(;g[E+1]<w;)E++;const M=d[E],x=w-M;c[i+w*o]=f[M]+x*x}}const Ca=2,Kb={none:0,ideographs:1,all:2};class Sf{constructor(i,o,u){this.requestManager=i,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i,o){this.urls[o]=i}getGlyphs(i,o,u){const f=[],d=this.urls[o]||te.GLYPHS_URL;for(const g in i)for(const w of i[g])f.push({stack:g,id:w});Xi(f,({stack:g,id:w},E)=>{let M=this.entries[g];M||(M=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=M.glyphs[w];if(x!==void 0)return void E(null,{stack:g,id:w,glyph:x});if(x=this._tinySDF(M,g,w),x)return M.glyphs[w]=x,void E(null,{stack:g,id:w,glyph:x});const S=Math.floor(w/256);if(256*S>65535)return on("glyphs > 65535 not supported"),void E(null,{stack:g,id:w,glyph:x});if(M.ranges[S])return void E(null,{stack:g,id:w,glyph:x});let P=M.requests[S];P||(P=M.requests[S]=[],Sf.loadGlyphRange(g,S,d,this.requestManager,(A,C)=>{if(C){M.ascender=C.ascender,M.descender=C.descender;for(const R in C.glyphs)this._doesCharSupportLocalGlyph(+R)||(M.glyphs[+R]=C.glyphs[+R]);M.ranges[S]=!0}for(const R of P)R(A,C);delete M.requests[S]})),P.push((A,C)=>{A?E(A):C&&E(null,{stack:g,id:w,glyph:C.glyphs[w]||null})})},(g,w)=>{if(g)u(g);else if(w){const E={};for(const{stack:M,id:x,glyph:S}of w)E[M]===void 0&&(E[M]={}),E[M].glyphs===void 0&&(E[M].glyphs={}),E[M].glyphs[x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},E[M].ascender=this.entries[M].ascender,E[M].descender=this.entries[M].descender;u(null,E)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Kb.none&&(this.localGlyphMode===Kb.all?!!this.localFontFamily:!!this.localFontFamily&&(Qt["CJK Unified Ideographs"](i)||Qt["Hangul Syllables"](i)||Qt.Hiragana(i)||Qt.Katakana(i)||Qt["CJK Symbols and Punctuation"](i)||Qt["CJK Unified Ideographs Extension A"](i)||Qt["CJK Unified Ideographs Extension B"](i)||Qt.Osage(i)))}_tinySDF(i,o,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let d=i.tinySDF;if(!d){let R="400";/bold/i.test(o)?R="900":/medium/i.test(o)?R="500":/light/i.test(o)&&(R="200"),d=i.tinySDF=new Sf.TinySDF({fontFamily:f,fontWeight:R,fontSize:24*Ca,buffer:3*Ca,radius:8*Ca}),d.fontWeight=R}if(this.localGlyphs[d.fontWeight][u])return this.localGlyphs[d.fontWeight][u];const g=String.fromCodePoint(u),{data:w,width:E,height:M,glyphWidth:x,glyphHeight:S,glyphLeft:P,glyphTop:A,glyphAdvance:C}=d.draw(g);return this.localGlyphs[d.fontWeight][u]={id:u,bitmap:new Yc({width:E,height:M},w),metrics:{width:x/Ca,height:S/Ca,left:P/Ca,top:A/Ca-27,advance:C/Ca,localGlyph:!0}}}}Sf.loadGlyphRange=function(c,i,o,u,f){const d=256*i,g=d+255,w=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",c).replace("{range}",`${d}-${g}`),Ss.Glyphs);ua(w,(E,M)=>{if(E)f(E);else if(M){const x={},S=function(P){return new g0(P).readFields(yB,{})}(M);for(const P of S.glyphs)x[P.id]=P;f(null,{glyphs:x,ascender:S.ascender,descender:S.descender})}})},Sf.TinySDF=class{constructor({fontSize:c=24,buffer:i=3,radius:o=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=i,this.cutoff=u,this.radius=o;const w=this.size=c+4*i,E=this._createCanvas(w),M=this.ctx=E.getContext("2d",{willReadFrequently:!0});M.font=`${g} ${d} ${c}px ${f}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(c){const i=document.createElement("canvas");return i.width=i.height=c,i}draw(c){const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:d}=this.ctx.measureText(c),g=Math.ceil(o),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-f))),E=Math.min(this.size-this.buffer,g+Math.ceil(u)),M=w+2*this.buffer,x=E+2*this.buffer,S=Math.max(M*x,0),P=new Uint8ClampedArray(S),A={data:P,width:M,height:x,glyphWidth:w,glyphHeight:E,glyphTop:g,glyphLeft:0,glyphAdvance:i};if(w===0||E===0)return A;const{ctx:C,buffer:R,gridInner:B,gridOuter:N}=this;C.clearRect(R,R,w,E),C.fillText(c,R,R+g);const G=C.getImageData(R,R,w,E);N.fill(ug,0,S),B.fill(0,0,S);for(let H=0;H<E;H++)for(let $=0;$<w;$++){const W=G.data[4*(H*w+$)+3]/255;if(W===0)continue;const K=(H+R)*M+$+R;if(W===1)N[K]=0,B[K]=ug;else{const Q=.5-W;N[K]=Q>0?Q*Q:0,B[K]=Q<0?Q*Q:0}}lM(N,0,0,M,x,M,this.f,this.v,this.z),lM(B,R,R,w,E,M,this.f,this.v,this.z);for(let H=0;H<S;H++){const $=Math.sqrt(N[H])-Math.sqrt(B[H]);P[H]=Math.round(255-255*($/this.radius+this.cutoff))}return A}};const Qc=Ef;function uM(c,i){return c+i[1]-i[0]}function hM(c,i,o,u,f=1){const d=[],g=c.imagePrimary,w=g.pixelRatio,E=g.paddedRect.w-2*Qc,M=g.paddedRect.h-2*Qc,x=(c.right-c.left)*f,S=(c.bottom-c.top)*f,P=g.stretchX||[[0,E]],A=g.stretchY||[[0,M]],C=P.reduce(uM,0),R=A.reduce(uM,0),B=E-C,N=M-R;let G=0,H=C,$=0,W=R,K=0,Q=B,ue=0,oe=N;if(g.content&&u){const Ee=g.content;G=y0(P,0,Ee[0]),$=y0(A,0,Ee[1]),H=y0(P,Ee[0],Ee[2]),W=y0(A,Ee[1],Ee[3]),K=Ee[0]-G,ue=Ee[1]-$,Q=Ee[2]-Ee[0]-H,oe=Ee[3]-Ee[1]-W}const ae=(Ee,he,Se,Le)=>{const De=v0(Ee.stretch-G,H,x,c.left*f),Fe=x0(Ee.fixed-K,Q,Ee.stretch,C),ke=v0(he.stretch-$,W,S,c.top*f),He=x0(he.fixed-ue,oe,he.stretch,R),Ve=v0(Se.stretch-G,H,x,c.left*f),qe=x0(Se.fixed-K,Q,Se.stretch,C),pt=v0(Le.stretch-$,W,S,c.top*f),dt=x0(Le.fixed-ue,oe,Le.stretch,R),Ft=new Ie(De,ke),_t=new Ie(Ve,ke),Et=new Ie(Ve,pt),mt=new Ie(De,pt),ei=new Ie(Fe/w,He/w),Lt=new Ie(qe/w,dt/w),jt=i*Math.PI/180;if(jt){const Pi=Math.sin(jt),Ui=Math.cos(jt),pn=[Ui,-Pi,Pi,Ui];Ft._matMult(pn),_t._matMult(pn),mt._matMult(pn),Et._matMult(pn)}const ai=Ee.stretch+Ee.fixed,wi=Se.stretch+Se.fixed,di=he.stretch+he.fixed,Ii=Le.stretch+Le.fixed,bi=c.imageSecondary;return{tl:Ft,tr:_t,bl:mt,br:Et,texPrimary:{x:g.paddedRect.x+Qc+ai,y:g.paddedRect.y+Qc+di,w:wi-ai,h:Ii-di},texSecondary:bi?{x:bi.paddedRect.x+Qc+ai,y:bi.paddedRect.y+Qc+di,w:wi-ai,h:Ii-di}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ei,pixelOffsetBR:Lt,minFontScaleX:Q/w/x,minFontScaleY:oe/w/S,isSDF:o}};if(u&&(g.stretchX||g.stretchY)){const Ee=dM(P,B,C),he=dM(A,N,R);for(let Se=0;Se<Ee.length-1;Se++){const Le=Ee[Se],De=Ee[Se+1];for(let Fe=0;Fe<he.length-1;Fe++)d.push(ae(Le,he[Fe],De,he[Fe+1]))}}else d.push(ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:M+1}));return d}function y0(c,i,o){let u=0;for(const f of c)u+=Math.max(i,Math.min(o,f[1]))-Math.max(i,Math.min(o,f[0]));return u}function dM(c,i,o){const u=[{fixed:-Qc,stretch:0}];for(const[f,d]of c){const g=u[u.length-1];u.push({fixed:f-g.stretch,stretch:g.stretch}),u.push({fixed:f-g.stretch,stretch:g.stretch+(d-f)})}return u.push({fixed:i+Qc,stretch:o}),u}function v0(c,i,o,u){return c/i*o+u}function x0(c,i,o,u){return c-i*o/u}function AB(c,i,o,u){const f=i+c.positionedLines[u].lineOffset;return u===0?o+f/2:o+(f+(i+c.positionedLines[u-1].lineOffset))/2}function MB(c,i=1,o=!1){let u=1/0,f=1/0,d=-1/0,g=-1/0;const w=c[0];for(let A=0;A<w.length;A++){const C=w[A];(!A||C.x<u)&&(u=C.x),(!A||C.y<f)&&(f=C.y),(!A||C.x>d)&&(d=C.x),(!A||C.y>g)&&(g=C.y)}const E=Math.min(d-u,g-f);let M=E/2;const x=new th([],IB);if(E===0)return new Ie(u,f);for(let A=u;A<d;A+=E)for(let C=f;C<g;C+=E)x.push(new Af(A+M,C+M,M,c));let S=function(A){let C=0,R=0,B=0;const N=A[0];for(let G=0,H=N.length,$=H-1;G<H;$=G++){const W=N[G],K=N[$],Q=W.x*K.y-K.x*W.y;R+=(W.x+K.x)*Q,B+=(W.y+K.y)*Q,C+=3*Q}return new Af(R/C,B/C,0,A)}(c),P=x.length;for(;x.length;){const A=x.pop();(A.d>S.d||!S.d)&&(S=A,o&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,P)),A.max-S.d<=i||(M=A.h/2,x.push(new Af(A.p.x-M,A.p.y-M,M,c)),x.push(new Af(A.p.x+M,A.p.y-M,M,c)),x.push(new Af(A.p.x-M,A.p.y+M,M,c)),x.push(new Af(A.p.x+M,A.p.y+M,M,c)),P+=4)}return o&&(console.log(`num probes: ${P}`),console.log(`best distance: ${S.d}`)),S.p}function IB(c,i){return i.max-c.max}class Af{constructor(i,o,u,f){this.p=new Ie(i,o),this.h=u,this.d=function(d,g){let w=!1,E=1/0;for(let M=0;M<g.length;M++){const x=g[M];for(let S=0,P=x.length,A=P-1;S<P;A=S++){const C=x[S],R=x[A];C.y>d.y!=R.y>d.y&&d.x<(R.x-C.x)*(d.y-C.y)/(R.y-C.y)+C.x&&(w=!w),E=Math.min(E,we(d,C,R))}}return(w?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const Jb=Number.POSITIVE_INFINITY,CB=Math.sqrt(2);function fM(c,[i,o]){let u=0,f=0;if(o===Jb){i<0&&(i=0);const d=i/CB;switch(c){case"top-right":case"top-left":f=d-7;break;case"bottom-right":case"bottom-left":f=7-d;break;case"bottom":f=7-i;break;case"top":f=i-7}switch(c){case"top-right":case"bottom-right":u=-d;break;case"top-left":case"bottom-left":u=d;break;case"left":u=i;break;case"right":u=-i}}else{switch(i=Math.abs(i),o=Math.abs(o),c){case"top-right":case"top-left":case"top":f=o-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-o}switch(c){case"top-right":case"bottom-right":case"right":u=-i;break;case"top-left":case"bottom-left":case"left":u=i}}return[u,f]}function pM(c,i,o,u,f,d,g,w){if(!c)return;const E=jA(i,o,u,f,d);return c.scaleSelf(E*w*g)}function mM(c,i,o,u,f,d,g,w){return{iconPrimary:pM(c.getPrimary(),i,o,u,f,d,g,w),iconSecondary:pM(c.getSecondary(),i,o,u,f,d,g,w)}}function gM(c,i,o,u){if(!c)return;const f=i.get(o.toString());if(c.imagePrimary=f,u){const d=i.get(u.toString());c.imageSecondary=d}}function PB(c,i){for(const o in c.horizontal)_M(c.horizontal[o],i);_M(c.vertical,i)}function _M(c,i){if(c){for(const o of c.positionedLines)for(const u of o.positionedGlyphs)if(u.image!==null){const f=u.image.toString();u.rect=i.get(f).paddedRect}}}function Qb(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function DB(c,i,o,u,f,d,g,w,E){const M=ew(d.horizontal)||d.vertical,x=o.get("icon-text-fit-padding").evaluate(u,{},f);let S,P=i;return i&&E!=="none"&&(c.allowVerticalPlacement&&d.vertical&&(S=JA(i,d.vertical,E,x,w,g)),M&&(P=JA(i,M,E,x,w,g))),{defaultShapedIcon:P,verticallyShapedIcon:S}}function RB(c,i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B,N,G,H){let $=g.textMaxSize.evaluate(i,{},P);$===void 0?$=w*g.textScaleFactor:$*=g.textScaleFactor;const W=c.layers[0].layout,K=ew(o.horizontal)||o.vertical,Q=A.name==="globe",ue=Hs,oe=c.tilePixelRatio*$/ue,ae=(Fe=c.overscaling,c.zoom>18&&Fe>2&&(Fe>>=1),Math.max(St/(512*Fe),1)*W.get("symbol-spacing")),Ee=W.get("text-padding")*c.tilePixelRatio,he=W.get("icon-padding")*c.tilePixelRatio,Se=yt(W.get("text-max-angle")),Le=W.get("icon-rotation-alignment")==="map"&&H!=="point",De=ae/2;var Fe;c.hasAnyIconTextFit===!1&&B!=="none"&&(c.hasAnyIconTextFit=!0);const ke=i.properties?+i.properties[Ch]:null,He=ke&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(ke):65535,Ve=(qe,pt,dt)=>{if(pt.x<0||pt.x>=St||pt.y<0||pt.y>=St)return;let Ft=null;if(Q){const{x:_t,y:Et,z:mt}=A.projectTilePoint(pt.x,pt.y,dt);Ft={anchor:new zl(_t,Et,mt,0,void 0),up:A.upVector(dt,pt.x,pt.y)}}(function(_t,Et,mt,ei,Lt,jt,ai,wi,di,Ii,bi,Pi,Ui,pn,ui,Oi,En,Rn,zn,Vn,dn,ws,_r,Qn,rs,Qs,ks,Co,su){const Jo=_t.addToLineVertexArray(Et,ei);let La,ru,ou,zh,QI,eC,tC,iC=0,nC=0,sC=0,rC=0,Lw=-1,Ow=-1;const ol={};let oC=Vr("");const Fh=mt?mt.anchor:Et,kw=Co!=="none";let zw=0,Fw=0;if(di._unevaluatedLayout.getValue("text-radial-offset")===void 0?[zw,Fw]=di.layout.get("text-offset").evaluate(dn,{},rs).map(Po=>Po*Hs):(zw=di.layout.get("text-radial-offset").evaluate(dn,{},rs)*Hs,Fw=Jb),_t.allowVerticalPlacement&&Lt.vertical){const Po=Lt.vertical;if(ui)eC=tw(Po),wi&&(tC=tw(wi));else{const Zr=di.layout.get("text-rotate").evaluate(dn,{},rs)+90;ou=b0(Ii,Fh,Et,bi,Pi,Ui,Po,pn,Zr,Oi),wi&&(zh=b0(Ii,Fh,Et,bi,Pi,Ui,wi,Rn,Zr))}}if(jt){const Po=_t.iconSizeData,Zr=di.layout.get("icon-rotate").evaluate(dn,{},rs),Cg=hM(jt,Zr,_r,kw,ws.iconScaleFactor),Nw=wi?hM(wi,Zr,_r,kw,ws.iconScaleFactor):void 0;ru=b0(Ii,Fh,Et,bi,Pi,Ui,jt,Rn,Zr,null),iC=4*Cg.length;let Bh=null;Po.kind==="source"?(Bh=[Ia*di.layout.get("icon-size").evaluate(dn,{},rs)*ws.iconScaleFactor],Bh[0]>eu&&on(`${_t.layerIds[0]}: Value for "icon-size" is >= ${hg}. Reduce your "icon-size".`)):Po.kind==="composite"&&(Bh=[Ia*ws.compositeIconSizes[0].evaluate(dn,{},rs)*ws.iconScaleFactor,Ia*ws.compositeIconSizes[1].evaluate(dn,{},rs)*ws.iconScaleFactor],(Bh[0]>eu||Bh[1]>eu)&&on(`${_t.layerIds[0]}: Value for "icon-size" is >= ${hg}. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,Cg,Bh,Vn,zn,dn,!1,mt,Et,Jo.lineStartIndex,Jo.lineLength,-1,Qn,rs,Qs,ks),Lw=_t.icon.placedSymbolArray.length-1,Nw&&(nC=4*Nw.length,_t.addSymbols(_t.icon,Nw,Bh,Vn,zn,dn,Wr.vertical,mt,Et,Jo.lineStartIndex,Jo.lineLength,-1,Qn,rs,Qs,ks),Ow=_t.icon.placedSymbolArray.length-1)}for(const Po in Lt.horizontal){const Zr=Lt.horizontal[Po];La||(oC=Vr(Zr.text),ui?QI=tw(Zr):La=b0(Ii,Fh,Et,bi,Pi,Ui,Zr,pn,di.layout.get("text-rotate").evaluate(dn,{},rs),Oi));const Cg=Zr.positionedLines.length===1;if(sC+=yM(_t,mt,Et,Zr,ai,di,ui,dn,Oi,Jo,Lt.vertical?Wr.horizontal:Wr.horizontalOnly,Cg?Object.keys(Lt.horizontal):[Po],ol,Lw,ws,Qn,rs,Qs),Cg)break}Lt.vertical&&(rC+=yM(_t,mt,Et,Lt.vertical,ai,di,ui,dn,Oi,Jo,Wr.vertical,["vertical"],ol,Ow,ws,Qn,rs,Qs));let au=-1;const Bw=(Po,Zr)=>Po?Math.max(Po,Zr):Zr;au=Bw(QI,au),au=Bw(eC,au),au=Bw(tC,au);const u4=au>-1?1:0;_t.glyphOffsetArray.length>=65535&&on("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dn.sortKey!==void 0&&_t.addToSortKeyRanges(_t.symbolInstances.length,dn.sortKey),_t.symbolInstances.emplaceBack(Et.x,Et.y,Fh.x,Fh.y,Fh.z,ol.right>=0?ol.right:-1,ol.center>=0?ol.center:-1,ol.left>=0?ol.left:-1,ol.vertical>=0?ol.vertical:-1,Lw,Ow,oC,La!==void 0?La:_t.collisionBoxArray.length,La!==void 0?La+1:_t.collisionBoxArray.length,ou!==void 0?ou:_t.collisionBoxArray.length,ou!==void 0?ou+1:_t.collisionBoxArray.length,ru!==void 0?ru:_t.collisionBoxArray.length,ru!==void 0?ru+1:_t.collisionBoxArray.length,zh||_t.collisionBoxArray.length,zh?zh+1:_t.collisionBoxArray.length,bi,sC,rC,iC,nC,u4,0,zw,Fw,au,0,kw?1:0,su)})(c,pt,Ft,qe,o,u,d,f,c.layers[0],c.collisionBoxArray,i.index,i.sourceLayerIndex,c.index,Ee,G,M,0,he,Le,N,i,g,x,S,P,C,R,B,He)};if(H==="line")for(const qe of sM(i.geometry,0,0,St,St)){const pt=SB(qe,ae,Se,o.vertical||K,u,ue,oe,c.overscaling,St);for(const dt of pt)K&&LB(c,K.text,De,dt)||Ve(qe,dt,P)}else if(H==="line-center"){for(const qe of i.geometry)if(qe.length>1){const pt=EB(qe,Se,o.vertical||K,u,ue,oe);pt&&Ve(qe,pt,P)}}else if(i.type==="Polygon")for(const qe of l0(i.geometry,0)){const pt=MB(qe,16);Ve(qe[0],new zl(pt.x,pt.y,0,0,void 0),P)}else if(i.type==="LineString")for(const qe of i.geometry)Ve(qe,new zl(qe[0].x,qe[0].y,0,0,void 0),P);else if(i.type==="Point")for(const qe of i.geometry)for(const pt of qe)Ve([pt],new zl(pt.x,pt.y,0,0,void 0),P)}const hg=255,eu=hg*Ia;function yM(c,i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B,N){const G=function(W,K,Q,ue,oe,ae,Ee,he){const Se=[];if(K.positionedLines.length===0)return Se;const Le=ue.layout.get("text-rotate").evaluate(ae,{})*Math.PI/180,De=function(qe){const pt=qe[0],dt=qe[1],Ft=pt*dt;return Ft>0?[pt,-dt]:Ft<0?[-pt,dt]:pt===0?[dt,pt]:[dt,-pt]}(Q);let Fe=Math.abs(K.top-K.bottom);for(const qe of K.positionedLines)Fe-=qe.lineOffset;const ke=K.positionedLines.length,He=Fe/ke;let Ve=K.top-Q[1];for(let qe=0;qe<ke;++qe){const pt=K.positionedLines[qe];Ve=AB(K,He,Ve,qe);for(const dt of pt.positionedGlyphs){if(!dt.rect)continue;const Ft=dt.rect||{};let _t=qA+1,Et=!0,mt=1,ei=0;if(dt.image){const dn=Ee.get(dt.image.toString());if(!dn)continue;if(dn.sdf){on("SDF images are not supported in formatted text and will be ignored.");continue}Et=!1,mt=dn.pixelRatio,_t=Ef/mt}const Lt=(oe||he)&&dt.vertical,jt=dt.metrics.advance*dt.scale/2,ai=dt.metrics,wi=dt.rect;if(wi===null)continue;he&&K.verticalizable&&(ei=dt.image?jt-dt.metrics.width*dt.scale/2:0);const di=oe?[dt.x+jt,dt.y]:[0,0];let Ii=[0,0],bi=[0,0],Pi=!1;oe||(Lt?(bi=[dt.x+jt+De[0],dt.y+De[1]-ei],Pi=!0):Ii=[dt.x+jt+Q[0],dt.y+Q[1]-ei]);const Ui=wi.w*dt.scale/(mt*(dt.localGlyph?Ca:1)),pn=wi.h*dt.scale/(mt*(dt.localGlyph?Ca:1));let ui,Oi,En,Rn;if(Lt){const dn=dt.y-Ve,ws=new Ie(-jt,jt-dn),_r=-Math.PI/2,Qn=new Ie(...bi);ui=new Ie(-jt+Ii[0],Ii[1]),ui._rotateAround(_r,ws)._add(Qn),ui.x+=-dn+jt,ui.y-=(ai.left-_t)*dt.scale;const rs=dt.image?ai.advance*dt.scale:Hs*dt.scale,Qs=String.fromCodePoint(dt.glyph);mB(Qs)?ui.x+=(1-_t)*dt.scale:gB(Qs)?ui.x+=rs-ai.height*dt.scale+(-_t-1)*dt.scale:ui.x+=dt.image||ai.width+2*_t===wi.w&&ai.height+2*_t===wi.h?(rs-pn)/2:(rs-(ai.height+2*_t)*dt.scale)/2,Oi=new Ie(ui.x,ui.y-Ui),En=new Ie(ui.x+pn,ui.y),Rn=new Ie(ui.x+pn,ui.y-Ui)}else{const dn=(ai.left-_t)*dt.scale-jt+Ii[0],ws=(-ai.top-_t)*dt.scale+Ii[1],_r=dn+Ui,Qn=ws+pn;ui=new Ie(dn,ws),Oi=new Ie(_r,ws),En=new Ie(dn,Qn),Rn=new Ie(_r,Qn)}if(Le){let dn;dn=oe?new Ie(0,0):Pi?new Ie(De[0],De[1]):new Ie(Q[0],Q[1]),ui._rotateAround(Le,dn),Oi._rotateAround(Le,dn),En._rotateAround(Le,dn),Rn._rotateAround(Le,dn)}const zn=new Ie(0,0),Vn=new Ie(0,0);Se.push({tl:ui,tr:Oi,bl:En,br:Rn,texPrimary:Ft,texSecondary:void 0,writingMode:K.writingMode,glyphOffset:di,sectionIndex:dt.sectionIndex,isSDF:Et,pixelOffsetTL:zn,pixelOffsetBR:Vn,minFontScaleX:0,minFontScaleY:0})}}return Se}(0,u,E,d,g,w,f,c.allowVerticalPlacement),H=c.textSizeData;let $=null;H.kind==="source"?($=[Ia*d.layout.get("text-size").evaluate(w,{},B)*C.textScaleFactor],$[0]>eu&&on(`${c.layerIds[0]}: Value for "text-size" is >= ${hg}. Reduce your "text-size".`)):H.kind==="composite"&&($=[Ia*C.compositeTextSizes[0].evaluate(w,{},B)*C.textScaleFactor,Ia*C.compositeTextSizes[1].evaluate(w,{},B)*C.textScaleFactor],($[0]>eu||$[1]>eu)&&on(`${c.layerIds[0]}: Value for "text-size" is >= ${hg}. Reduce your "text-size".`)),c.addSymbols(c.text,G,$,E,g,w,x,i,o,M.lineStartIndex,M.lineLength,A,R,B,N,!1);for(const W of S)P[W]=c.text.placedSymbolArray.length-1;return 4*G.length}function ew(c){for(const i in c)return c[i];return null}function b0(c,i,o,u,f,d,g,w,E,M){let x=g.top,S=g.bottom,P=g.left,A=g.right;const C=g.collisionPadding;if(C&&(P-=C[0],x-=C[1],A+=C[2],S+=C[3]),E){const R=new Ie(P,x),B=new Ie(A,x),N=new Ie(P,S),G=new Ie(A,S),H=yt(E);let $=new Ie(0,0);M&&($=new Ie(M[0],M[1])),R._rotateAround(H,$),B._rotateAround(H,$),N._rotateAround(H,$),G._rotateAround(H,$),P=Math.min(R.x,B.x,N.x,G.x),A=Math.max(R.x,B.x,N.x,G.x),x=Math.min(R.y,B.y,N.y,G.y),S=Math.max(R.y,B.y,N.y,G.y)}return c.emplaceBack(i.x,i.y,i.z,o.x,o.y,P,x,A,S,w,u,f,d),c.length-1}function tw(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const i=c.bottom-c.top;return i>0?Math.max(10,i):null}function LB(c,i,o,u){const f=c.compareText;if(i in f){const d=f[i];for(let g=d.length-1;g>=0;g--)if(u.dist(d[g])<o)return!0}else f[i]=[];return f[i].push(u),!1}function vM(c,i){const o=c.fovAboveCenter,u=c.elevation?c.elevation.getMinElevationBelowMSL()*i:0,f=(c._camera.position[2]*c.worldSize-u)/Math.cos(c._pitch),d=Math.sin(o)*f/Math.sin(Math.max(Math.PI/2-c._pitch-o,.01));let g=Math.sin(c._pitch)*d+f;const w=f*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let E=Math.max(c.zoom-17,0);c.isOrthographic&&(E/=10),g*=1+E}return Math.min(1.01*g,w)}function dg(c,i){if(!i.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:i};const o=Math.pow(2,-c.z),u=c.x*o,f=(c.x+1)*o,d=c.y*o,g=(c.y+1)*o,w=Er(u),E=Er(f),M=Ls(d),x=Ls(g),S=i.project(w,M),P=i.project(E,M),A=i.project(E,x),C=i.project(w,x);let R=Math.min(S.x,P.x,A.x,C.x),B=Math.min(S.y,P.y,A.y,C.y),N=Math.max(S.x,P.x,A.x,C.x),G=Math.max(S.y,P.y,A.y,C.y);const H=o/16;function $(K,Q,ue,oe,ae,Ee){const he=(ue+ae)/2,Se=(oe+Ee)/2,Le=i.project(Er(he),Ls(Se)),De=Math.max(0,R-Le.x,B-Le.y,Le.x-N,Le.y-G);R=Math.min(R,Le.x),N=Math.max(N,Le.x),B=Math.min(B,Le.y),G=Math.max(G,Le.y),De>H&&($(K,Le,ue,oe,he,Se),$(Le,Q,he,Se,ae,Ee))}$(S,P,u,d,f,d),$(P,A,f,d,f,g),$(A,C,f,g,u,g),$(C,S,u,g,u,d),R-=H,B-=H,N+=H,G+=H;const W=1/Math.max(N-R,G-B);return{scale:W,x:R*W,y:B*W,x2:N*W,y2:G*W,projection:i}}function xM(c,{x:i,y:o},u=0){return new Ie(((i-u)*c.scale-c.x)*St,(o*c.scale-c.y)*St)}const OB=ce.mat4.identity(new Float32Array(16));class tu{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,o){return{x:0,y:0,z:0}}unproject(i,o){return new qi(0,0)}projectTilePoint(i,o,u){return{x:i,y:o,z:0}}locationPoint(i,o,u,f=!0){return i._coordinatePoint(i.locationCoordinate(o,u),f)}pixelsPerMeter(i,o){return js(1,i)*o}pixelSpaceConversion(i,o,u){return 1}farthestPixelDistance(i){return vM(i,i.pixelsPerMeter)}pointCoordinate(i,o,u,f){const d=i.horizonLineFromTop(!1),g=new Ie(o,Math.max(d,u));return i.rayIntersectionCoordinate(i.pointRayIntersection(g,f))}pointCoordinate3D(i,o,u){const f=new Ie(o,u);if(i.elevation)return i.elevation.pointCoordinate(f);{const d=this.pointCoordinate(i,f.x,f.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(i,o){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,o.x,o.y);const u=i.horizonLineFromTop();return o.y<u}createInversionMatrix(i,o){return OB}createTileMatrix(i,o,u){let f,d,g;const w=u.canonical,E=ce.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=dg(w,this);f=1,d=M.x+u.wrap*M.scale,g=M.y,ce.mat4.scale(E,E,[f/M.scale,f/M.scale,i.pixelsPerMeter/o])}else f=o/i.zoomScale(w.z),d=(w.x+Math.pow(2,w.z)*u.wrap)*f,g=w.y*f;return ce.mat4.translate(E,E,[d,g,0]),ce.mat4.scale(E,E,[f/St,f/St,1]),E}upVector(i,o,u){return[0,0,1]}upVectorScale(i,o,u){return{metersToTile:1}}}class kB extends tu{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[o,u]=this.parallels=i.parallels||[29.5,45.5],f=Math.sin(yt(o));this.n=(f+Math.sin(yt(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(i,o){const{n:u,c:f,r0:d}=this,g=yt(i-this.center[0]),w=yt(o),E=Math.sqrt(f-2*u*Math.sin(w))/u;return{x:E*Math.sin(g*u),y:E*Math.cos(g*u)-d,z:0}}unproject(i,o){const{n:u,c:f,r0:d}=this,g=d+o;let w=Math.atan2(i,Math.abs(g))*Math.sign(g);g*u<0&&(w-=Math.PI*Math.sign(i)*Math.sign(g));const E=yt(this.center[0])*u;w=Ai(w,-Math.PI-E,Math.PI-E);const M=At(Xt(w/u)+this.center[0],-180,180),x=Math.asin(At((f-(i*i+g*g)*u*u)/(2*u),-1,1)),S=At(Xt(x),-Wn,Wn);return new qi(M,S)}}const fg=1.340264,pg=-.081106,mg=893e-6,gg=.003796,w0=Math.sqrt(3)/2;class zB extends tu{project(i,o){o=o/180*Math.PI,i=i/180*Math.PI;const u=Math.asin(w0*Math.sin(o)),f=u*u,d=f*f*f;return{x:.5*(i*Math.cos(u)/(w0*(fg+3*pg*f+d*(7*mg+9*gg*f)))/Math.PI+.5),y:1-.5*(u*(fg+pg*f+d*(mg+gg*f))/Math.PI+1),z:0}}unproject(i,o){i=(2*i-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,f=u*u,d=f*f*f;for(let x,S,P,A=0;A<12&&(S=u*(fg+pg*f+d*(mg+gg*f))-o,P=fg+3*pg*f+d*(7*mg+9*gg*f),x=S/P,u=At(u-x,-Math.PI/3,Math.PI/3),f=u*u,d=f*f*f,!(Math.abs(x)<1e-12));++A);const g=w0*i*(fg+3*pg*f+d*(7*mg+9*gg*f))/Math.cos(u),w=Math.asin(Math.sin(u)/w0),E=At(180*g/Math.PI,-180,180),M=At(180*w/Math.PI,-Wn,Wn);return new qi(E,M)}}class FB extends tu{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,o){return{x:.5+i/360,y:.5-o/360,z:0}}unproject(i,o){const u=360*(i-.5),f=At(360*(.5-o),-Wn,Wn);return new qi(u,f)}}const Mf=Math.PI/2;function T0(c){return Math.tan((Mf+c)/2)}class BB extends tu{constructor(i){super(i),this.center=i.center||[0,30];const[o,u]=this.parallels=i.parallels||[30,30];let f=yt(o),d=yt(u);this.southernCenter=f+d<0,this.southernCenter&&(f=-f,d=-d);const g=Math.cos(f),w=T0(f);this.n=f===d?Math.sin(f):Math.log(g/Math.cos(d))/Math.log(T0(d)/w),this.f=g*Math.pow(T0(f),this.n)/this.n}project(i,o){o=yt(o),this.southernCenter&&(o=-o),i=yt(i-this.center[0]);const u=1e-6,{n:f,f:d}=this;d>0?o<-Mf+u&&(o=-Mf+u):o>Mf-u&&(o=Mf-u);const g=d/Math.pow(T0(o),f);let w=g*Math.sin(f*i),E=d-g*Math.cos(f*i);return w=.5*(w/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:w,y:this.southernCenter?E:1-E,z:0}}unproject(i,o){i=(2*i-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f}=this,d=f-o,g=Math.sign(d),w=Math.sign(u)*Math.sqrt(i*i+d*d);let E=Math.atan2(i,Math.abs(d))*g;d*u<0&&(E-=Math.PI*Math.sign(i)*g);const M=At(Xt(E/u)+this.center[0],-180,180),x=At(Xt(2*Math.atan(Math.pow(f/w,1/u))-Mf),-Wn,Wn);return new qi(M,this.southernCenter?-x:x)}}class bM extends tu{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,o){return{x:Zo(i),y:Tr(o),z:0}}unproject(i,o){const u=Er(i),f=Ls(o);return new qi(u,f)}}const wM=yt(Wn);class NB extends tu{project(i,o){const u=(o=yt(o))*o,f=u*u;return{x:.5*((i=yt(i))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(i,o){i=(2*i-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,f=25,d=0,g=u*u;do{g=u*u;const M=g*g;d=(u*(1.007226+g*(.015085+M*(.028874*g-.044475-.005916*M)))-o)/(1.007226+g*(.045255+M*(.259866*g-.311325-.005916*11*M))),u=At(u-d,-wM,wM)}while(Math.abs(d)>1e-6&&--f>0);g=u*u;const w=At(Xt(i/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),E=Xt(u);return new qi(w,E)}}const TM=yt(Wn);class VB extends tu{project(i,o){o=yt(o),i=yt(i);const u=Math.cos(o),f=2/Math.PI,d=Math.acos(u*Math.cos(i/2)),g=Math.sin(d)/d,w=.5*(i*f+2*u*Math.sin(i/2)/g)||0,E=.5*(o+Math.sin(o)/g)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(i,o){let u=i=(2*i-.5)*Math.PI,f=o=(2*(1-o)-1)*Math.PI,d=25;const g=1e-6;let w=0,E=0;do{const M=Math.cos(f),x=Math.sin(f),S=2*x*M,P=x*x,A=M*M,C=Math.cos(u/2),R=Math.sin(u/2),B=2*C*R,N=R*R,G=1-A*C*C,H=G?1/G:0,$=G?Math.acos(M*C)*Math.sqrt(1/G):0,W=.5*(2*$*M*R+2*u/Math.PI)-i,K=.5*($*x+f)-o,Q=.5*H*(A*N+$*M*C*P)+1/Math.PI,ue=H*(B*S/4-$*x*R),oe=.125*H*(S*R-$*x*A*B),ae=.5*H*(P*C+$*N*M)+.5,Ee=ue*oe-ae*Q;w=(K*ue-W*ae)/Ee,E=(W*oe-K*Q)/Ee,u=At(u-w,-Math.PI,Math.PI),f=At(f-E,-TM,TM)}while((Math.abs(w)>g||Math.abs(E)>g)&&--d>0);return new qi(Xt(u),Xt(f))}}class EM extends tu{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(yt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,o){const{scale:u,cosPhi:f}=this;return{x:yt(i)*f*u+.5,y:-Math.sin(yt(o))/f*u+.5,z:0}}unproject(i,o){const{scale:u,cosPhi:f}=this,d=-(o-.5)/u,g=At(Xt((i-.5)/u)/f,-180,180),w=Math.asin(At(d*f,-1,1)),E=At(Xt(w),-Wn,Wn);return new qi(g,E)}}class UB extends bM{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,o,u){const f=Zi(i,o,u),d=Tn(fs(u));return ce.vec3.transformMat4(f,f,d),{x:f[0],y:f[1],z:f[2]}}locationPoint(i,o,u){const f=Ll(o.lat,o.lng),d=ce.vec3.normalize([],f),g=u?i._centerAltitude+u:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(o),i._centerAltitude):i._centerAltitude,w=js(1,0)*St*g;ce.vec3.scaleAndAdd(f,f,d,w);const E=ce.mat4.identity(new Float64Array(16));return ce.mat4.multiply(E,i.pixelMatrix,i.globeMatrix),ce.vec3.transformMat4(f,f,E),new Ie(f[0],f[1])}pixelsPerMeter(i,o){return js(1,0)*o}pixelSpaceConversion(i,o,u){const f=js(1,i)*o,d=ni(js(1,45)*o,f,u);return this.pixelsPerMeter(i,o)/d}createTileMatrix(i,o,u){const f=ps(fs(u.canonical));return ce.mat4.multiply(new Float64Array(16),i.globeMatrix,f)}createInversionMatrix(i,o){const{center:u}=i,f=Tn(fs(o));return ce.mat4.rotateY(f,f,yt(u.lng)),ce.mat4.rotateX(f,f,yt(u.lat)),ce.mat4.scale(f,f,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(i,o,u,f){return Vi(i,o,u,!0)||new n(0,0)}pointCoordinate3D(i,o,u){const f=this.pointCoordinate(i,o,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(i,o){return!Vi(i,o.x,o.y,!1)}farthestPixelDistance(i){const o=function(f,d){const g=f.cameraToCenterDistance,w=f._centerAltitude*d,E=f._camera,M=f._camera.forward(),x=ce.vec3.add([],ce.vec3.scale([],M,-g),[0,0,w]),S=f.worldSize/(2*Math.PI),P=[0,0,-S],A=f.width/f.height,C=Math.tan(f.fovAboveCenter),R=ce.vec3.scale([],E.up(),C),B=ce.vec3.scale([],E.right(),C*A),N=ce.vec3.normalize([],ce.vec3.add([],ce.vec3.add([],M,R),B)),G=[];let H;if(new oi(x,N).closestPointOnSphere(P,S,G)){const $=ce.vec3.add([],G,P),W=ce.vec3.sub([],$,x);H=Math.cos(f.fovAboveCenter)*ce.vec3.length(W)}else{const $=ce.vec3.sub([],x,P),W=ce.vec3.sub([],P,x);ce.vec3.normalize(W,W);const K=ce.vec3.length($)-S;H=Math.sqrt(K*(K+2*S));const Q=Math.acos(H/(S+K))-Math.acos(ce.vec3.dot(M,W));H*=Math.cos(Q)}return 1.01*H}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),u=gr(i.zoom);if(u>0){const f=vM(i,js(1,i.center.lat)*i.worldSize),d=i.worldSize/(2*Math.PI),g=Math.max(i.width,i.height)/i.worldSize*Math.PI;return ni(o,f+d*(1-Math.cos(g)),Math.pow(u,10))}return o}upVector(i,o,u){return Zi(o,u,i,1)}upVectorScale(i){return{metersToTile:Li(hn(fs(i)))}}}function SM(c){const i=c.parallels,o=!!i&&Math.abs(i[0]+i[1])<.01;switch(c.name){case"mercator":return new bM(c);case"equirectangular":return new FB(c);case"naturalEarth":return new NB(c);case"equalEarth":return new zB(c);case"winkelTripel":return new VB(c);case"albers":return o?new EM(c):new kB(c);case"lambertConformalConic":return o?new EM(c):new BB(c);case"globe":return new UB(c)}throw new Error(`Invalid projection name: ${c.name}`)}const jB=Kc.VectorTileFeature.types,$B=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function E0(c,i,o,u,f,d,g,w,E,M,x,S,P){const A=w?Math.min(eu,Math.round(w[0])):0,C=w?Math.min(eu,Math.round(w[1])):0;c.emplaceBack(i,o,Math.round(32*u),Math.round(32*f),d,g,(A<<1)+(E?1:0),C,16*M,16*x,256*S,256*P)}function S0(c,i,o){c.emplaceBack(i,o)}function A0(c,i,o,u,f,d,g){c.emplaceBack(i,o,u,f,d,g)}function M0(c,i,o,u,f){c.emplaceBack(i,o,u,f),c.emplaceBack(i,o,u,f),c.emplaceBack(i,o,u,f),c.emplaceBack(i,o,u,f)}function HB(c){for(const i of c.sections)if(Fy(i.text))return!0;return!1}class iw{constructor(i){this.layoutVertexArray=new Rm,this.indexArray=new Rs,this.programConfigurations=i,this.segments=new Mn,this.dynamicLayoutVertexArray=new Pl,this.opacityVertexArray=new Om,this.placedSymbolArray=new qy,this.iconTransitioningVertexArray=new el,this.globeExtVertexArray=new Lm,this.zOffsetVertexArray=new Cl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(i,o,u,f,d){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,rB.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,aB.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,$B,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,cB.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,oB.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,lB.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}zt(iw,"SymbolBuffers");class nw{constructor(i,o,u){this.layoutVertexArray=new i,this.layoutAttributes=o,this.indexArray=new u,this.segments=new Mn,this.collisionVertexArray=new Fm,this.collisionVertexArrayExt=new Pl}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,uB.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,hB.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}zt(nw,"CollisionBuffers");class I0{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ce.mat4.identity([]),this.placementViewportMatrix=ce.mat4.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Gb(this.zoom,o["text-size"]),this.iconSizeData=Gb(this.zoom,o["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),d=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>Wr[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new iw(new il(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new iw(new il(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new Xy,this.lineVertexArray=new vh,this.symbolInstances=new Zy}calculateGlyphDependencies(i,o,u,f,d){for(const g of i){const w=g.codePointAt(0);if(w===void 0)break;if(o[w]=!0,f&&d&&w<=65535){const E=ag[g];E&&(o[E.charCodeAt(0)]=!0)}}}updateFootprints(i,o){}updateReplacement(i,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!Bb(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(i,o,u,f){const d=this.layers[0],g=d.layout,w=this.projection.name==="globe",E=g.get("text-font"),M=g.get("text-field"),x=g.get("icon-image"),[S,P]=g.get("icon-size-scale-range"),A=At(o.scaleFactor||1,S,P),C=(M.value.kind!=="constant"||M.value.value instanceof Ys&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),R=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,B=g.get("symbol-sort-key");if(this.features=[],!C&&!R)return;const N=o.iconDependencies,G=o.glyphDependencies,H=o.availableImages,$=new fn(this.zoom);for(const{feature:W,id:K,index:Q,sourceLayerIndex:ue}of i){const oe=d._featureFilter.needGeometry,ae=F(W,oe);if(!d._featureFilter.filter($,ae,u))continue;if(oe||(ae.geometry=z(W,u,f)),w&&W.type!==1&&u.z<=5){const De=ae.geometry,Fe=.98078528056,ke=(He,Ve)=>{const qe=Zi(He.x,He.y,u,1),pt=Zi(Ve.x,Ve.y,u,1);return ce.vec3.dot(qe,pt)<Fe};for(let He=0;He<De.length;He++)De[He]=b(De[He],ke)}let Ee,he;if(C){const De=d.getValueAndResolveTokens("text-field",ae,u,H),Fe=Ys.factory(De);HB(Fe)&&(this.hasRTLText=!0),(!this.hasRTLText||tf()==="unavailable"||this.hasRTLText&&oo.isParsed())&&(Ee=pB(Fe,d,ae))}if(R){const De=d.getValueAndResolveTokens("icon-image",ae,u,H);he=De instanceof Ks?De:Ks.build(De)}if(!Ee&&!he)continue;const Se=this.sortFeaturesByKey?B.evaluate(ae,{},u):void 0,Le={id:K,text:Ee,icon:he,index:Q,sourceLayerIndex:ue,geometry:ae.geometry,properties:W.properties,type:jB[W.type],sortKey:Se};if(this.features.push(Le),he){const De=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Fe,iconSecondary:ke}=mM(he,this.iconSizeData,De["icon-size"],u,this.zoom,Le,this.pixelRatio,A),He=Fe.id.toString();if(N.has(He)?N.get(He).push(Fe):N.set(He,[Fe]),ke){const Ve=ke.id.toString();N.has(Ve)?N.get(Ve).push(ke):N.set(Ve,[ke])}}if(Ee){const De=E.evaluate(ae,{},u).join(","),Fe=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Wr.vertical)>=0;for(const ke of Ee.sections)if(ke.image){const He=ke.image.getPrimary().scaleSelf(this.pixelRatio),Ve=He.id.toString(),qe=N.get(Ve)||[];qe.push(He),N.set(Ve,qe)}else{const He=ym(Ee.toString()),Ve=ke.fontStack||De,qe=G[Ve]=G[Ve]||{};this.calculateGlyphDependencies(ke.text,qe,Fe,this.allowVerticalPlacement,He)}}}if(g.get("symbol-placement")==="line"&&(this.features=function(W){const K={},Q={},ue=[];let oe=0;function ae(Le){ue.push(W[Le]),oe++}function Ee(Le,De,Fe){const ke=Q[Le];return delete Q[Le],Q[De]=ke,ue[ke].geometry[0].pop(),ue[ke].geometry[0]=ue[ke].geometry[0].concat(Fe[0]),ke}function he(Le,De,Fe){const ke=K[De];return delete K[De],K[Le]=ke,ue[ke].geometry[0].shift(),ue[ke].geometry[0]=Fe[0].concat(ue[ke].geometry[0]),ke}function Se(Le,De,Fe){const ke=Fe?De[0][De[0].length-1]:De[0][0];return`${Le}:${ke.x}:${ke.y}`}for(let Le=0;Le<W.length;Le++){const De=W[Le],Fe=De.geometry,ke=De.text?De.text.toString():null;if(!ke){ae(Le);continue}const He=Se(ke,Fe),Ve=Se(ke,Fe,!0);if(He in Q&&Ve in K&&Q[He]!==K[Ve]){const qe=he(He,Ve,Fe),pt=Ee(He,Ve,ue[qe].geometry);delete K[He],delete Q[Ve],Q[Se(ke,ue[pt].geometry,!0)]=pt,ue[qe].geometry=null}else He in Q?Ee(He,Ve,Fe):Ve in K?he(He,Ve,Fe):(ae(Le),K[He]=oe-1,Q[Ve]=oe-1)}return ue.filter(Le=>Le.geometry)}(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",o.elevationFeatures){!this.elevationFeatures&&o.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const W of o.elevationFeatures)this.elevationFeatureIdToIndex.set(W.id,this.elevationFeatures.length),this.elevationFeatures.push(W)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((W,K)=>W.sortKey-K.sortKey)}update(i,o,u,f,d,g,w){this.text.programConfigurations.updatePaintArrays(i,o,d,u,f,g,w),this.icon.programConfigurations.updatePaintArrays(i,o,d,u,f,g,w)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);if(u.elevationFeatureIndex===65535)continue;const f=this.elevationFeatures[u.elevationFeatureIndex];if(f){const d=.05+f.pointElevation(new Ie(u.tileAnchorX,u.tileAnchorY));u.zOffset!==d&&(i=!0,u.zOffset=d)}}i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(d,g,w)=>{u+=g,u>d.length&&d.resize(u);for(let E=-g;E<0;E++)d.emplace(E+u,w)},o=(d,g,w)=>{f+=g,f>d.length&&d.resize(f);for(let E=-g;E<0;E++)d.emplace(E+f,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,f=0;for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:E,numIconVertices:M}=g,x=g.zOffset,S=M>0;if((w>0||E>0)&&(i(this.text.zOffsetVertexArray,w,x),i(this.text.zOffsetVertexArray,E,x)),S){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:A}=g;P>=0&&o(this.icon.zOffsetVertexArray,M,x),A>=0&&o(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=SM(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,o){const u=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:f,y:d}of o)this.lineVertexArray.emplaceBack(f,d);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(i,o,u,f,d,g,w,E,M,x,S,P,A,C,R,B){const N=i.indexArray,G=i.layoutVertexArray,H=i.globeExtVertexArray,$=i.segments.prepareSegment(4*o.length,G,N,this.canOverlap?g.sortKey:void 0),W=this.glyphOffsetArray.length,K=$.vertexLength,Q=this.allowVerticalPlacement&&w===Wr.vertical?Math.PI/2:0,ue=g.text&&g.text.sections;for(let ae=0;ae<o.length;ae++){const{tl:Ee,tr:he,bl:Se,br:Le,texPrimary:De,texSecondary:Fe,pixelOffsetTL:ke,pixelOffsetBR:He,minFontScaleX:Ve,minFontScaleY:qe,glyphOffset:pt,isSDF:dt,sectionIndex:Ft}=o[ae],_t=$.vertexLength,Et=pt[1];if(E0(G,M.x,M.y,Ee.x,Et+Ee.y,De.x,De.y,u,dt,ke.x,ke.y,Ve,qe),E0(G,M.x,M.y,he.x,Et+he.y,De.x+De.w,De.y,u,dt,He.x,ke.y,Ve,qe),E0(G,M.x,M.y,Se.x,Et+Se.y,De.x,De.y+De.h,u,dt,ke.x,He.y,Ve,qe),E0(G,M.x,M.y,Le.x,Et+Le.y,De.x+De.w,De.y+De.h,u,dt,He.x,He.y,Ve,qe),E){const{x:mt,y:ei,z:Lt}=E.anchor,[jt,ai,wi]=E.up;A0(H,mt,ei,Lt,jt,ai,wi),A0(H,mt,ei,Lt,jt,ai,wi),A0(H,mt,ei,Lt,jt,ai,wi),A0(H,mt,ei,Lt,jt,ai,wi),M0(i.dynamicLayoutVertexArray,mt,ei,Lt,Q)}else M0(i.dynamicLayoutVertexArray,M.x,M.y,M.z,Q);if(B){const mt=Fe||De;S0(i.iconTransitioningVertexArray,mt.x,mt.y),S0(i.iconTransitioningVertexArray,mt.x+mt.w,mt.y),S0(i.iconTransitioningVertexArray,mt.x,mt.y+mt.h),S0(i.iconTransitioningVertexArray,mt.x+mt.w,mt.y+mt.h)}N.emplaceBack(_t,_t+1,_t+2),N.emplaceBack(_t+1,_t+2,_t+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),ae!==o.length-1&&Ft===o[ae+1].sectionIndex||i.programConfigurations.populatePaintArrays(G.length,g,g.index,{},A,C,R,ue&&ue[Ft])}const oe=E?E.anchor:M;i.placedSymbolArray.emplaceBack(oe.x,oe.y,oe.z,M.x,M.y,W,this.glyphOffsetArray.length-W,K,x,S,M.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],w,0,!1,0,P,0)}_commitLayoutVertex(i,o,u,f,d,g,w){i.emplaceBack(o,u,f,d,g,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(i,o,u,f,d,g,w){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),M=E.vertexLength,x=w.tileAnchorX,S=w.tileAnchorY;for(let A=0;A<4;A++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,i.padding,w.zOffset),this._commitLayoutVertex(u.layoutVertexArray,f,d,g,x,S,new Ie(i.x1,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,d,g,x,S,new Ie(i.x2,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,d,g,x,S,new Ie(i.x2,i.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,d,g,x,S,new Ie(i.x1,i.y2)),E.vertexLength+=4;const P=u.indexArray;P.emplaceBack(M,M+1),P.emplaceBack(M+1,M+2),P.emplaceBack(M+2,M+3),P.emplaceBack(M+3,M),E.primitiveLength+=4}_addTextDebugCollisionBoxes(i,o,u,f,d,g){for(let w=f;w<d;w++){const E=u.get(w),M=this.getSymbolInstanceTextSize(i,g,o,w);this._addCollisionDebugVertices(E,M,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(i,o,u,f,d,g){for(let w=f;w<d;w++){const E=u.get(w),M=this.getSymbolInstanceIconSize(i,o,g.placedIconSymbolIndex);this._addCollisionDebugVertices(E,M,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}generateCollisionDebugBuffers(i,o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nw(gh,UA.members,el),this.iconCollisionBox=new nw(gh,UA.members,el);const f=wf(this.iconSizeData,i),d=wf(this.textSizeData,i,u);for(let g=0;g<this.symbolInstances.length;g++){const w=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(d,i,o,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(d,i,o,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(f,i,o,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(f,i,o,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(i,o,u,f){const d=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:f),g=m0(this.textSizeData,i,d)/Hs;return this.tilePixelRatio*g}getSymbolInstanceIconSize(i,o,u){const f=this.icon.placedSymbolArray.get(u),d=m0(this.iconSizeData,i,f);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(i,o,u,f){i.emplaceBack(o,-u,-u,f),i.emplaceBack(o,u,-u,f),i.emplaceBack(o,u,u,f),i.emplaceBack(o,-u,u,f)}_updateTextDebugCollisionBoxes(i,o,u,f,d,g,w){for(let E=f;E<d;E++){const M=u.get(E),x=this.getSymbolInstanceTextSize(i,g,o,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,M.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(i,o,u,f,d,g,w){for(let E=f;E<d;E++){const M=u.get(E),x=this.getSymbolInstanceIconSize(i,o,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,M.padding,g.zOffset)}}updateCollisionDebugBuffers(i,o,u,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=wf(this.iconSizeData,i,f),g=wf(this.textSizeData,i,u);for(let w=0;w<this.symbolInstances.length;w++){const E=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(g,i,o,E.textBoxStartIndex,E.textBoxEndIndex,E,u),this._updateTextDebugCollisionBoxes(g,i,o,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(d,i,o,E.iconBoxStartIndex,E.iconBoxEndIndex,E,f),this._updateIconDebugCollisionBoxes(d,i,o,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,o,u,f,d,g,w,E,M){const x={};if(o<u){const{x1:S,y1:P,x2:A,y2:C,padding:R,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:$,featureIndex:W}=i.get(o);x.textBox={x1:S,y1:P,x2:A,y2:C,padding:R,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:$},x.textFeatureIndex=W}if(f<d){const{x1:S,y1:P,x2:A,y2:C,padding:R,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:$,featureIndex:W}=i.get(f);x.verticalTextBox={x1:S,y1:P,x2:A,y2:C,padding:R,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:$},x.verticalTextFeatureIndex=W}if(g<w){const{x1:S,y1:P,x2:A,y2:C,padding:R,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:$,featureIndex:W}=i.get(g);x.iconBox={x1:S,y1:P,x2:A,y2:C,padding:R,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:$},x.iconFeatureIndex=W}if(E<M){const{x1:S,y1:P,x2:A,y2:C,padding:R,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:$,featureIndex:W}=i.get(E);x.verticalIconBox={x1:S,y1:P,x2:A,y2:C,padding:R,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:$},x.verticalIconFeatureIndex=W}return x}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,o){const u=i.placedSymbolArray.get(o),f=u.vertexStartIndex+4*u.numGlyphs;for(let d=u.vertexStartIndex;d<f;d+=4)i.indexArray.emplaceBack(d,d+1,d+2),i.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(i),u=Math.cos(i),f=[],d=[],g=[];for(let w=0;w<this.symbolInstances.length;++w){g.push(w);const E=this.symbolInstances.get(w);f.push(0|Math.round(o*E.tileAnchorX+u*E.tileAnchorY)),d.push(E.featureIndex)}return g.sort((w,E)=>f[w]-f[E]||d[E]-d[w]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:M}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),d>=0&&d!==f&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&g!==f&&this.addIndicesForPlacedSymbol(this.text,g),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let AM,MM,sw;zt(I0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),I0.addDynamicAttributes=M0;class IM{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:mc,this.defaultValue=i}evaluate(i){if(i.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(i.formattedSection))return o.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zt(IM,"FormatSectionOverride",{omit:["defaultValue"]});const rw=()=>sw||(sw={layout:AM||(AM=new kn({"symbol-placement":new Tt(We.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(We.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt(We.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Tt(We.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Tt(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(We.layout_symbol["icon-size"]),"icon-size-scale-range":new Tt(We.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new kt(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(We.layout_symbol["icon-image"]),"icon-rotate":new kt(We.layout_symbol["icon-rotate"]),"icon-padding":new Tt(We.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(We.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(We.layout_symbol["icon-offset"]),"icon-anchor":new kt(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(We.layout_symbol["text-rotation-alignment"]),"text-field":new kt(We.layout_symbol["text-field"]),"text-font":new kt(We.layout_symbol["text-font"]),"text-size":new kt(We.layout_symbol["text-size"]),"text-size-scale-range":new Tt(We.layout_symbol["text-size-scale-range"]),"text-max-width":new kt(We.layout_symbol["text-max-width"]),"text-line-height":new kt(We.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(We.layout_symbol["text-letter-spacing"]),"text-justify":new kt(We.layout_symbol["text-justify"]),"text-radial-offset":new kt(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(We.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(We.layout_symbol["text-anchor"]),"text-max-angle":new Tt(We.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(We.layout_symbol["text-writing-mode"]),"text-rotate":new kt(We.layout_symbol["text-rotate"]),"text-padding":new Tt(We.layout_symbol["text-padding"]),"text-keep-upright":new Tt(We.layout_symbol["text-keep-upright"]),"text-transform":new kt(We.layout_symbol["text-transform"]),"text-offset":new kt(We.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt(We.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(We.layout_symbol["text-optional"]),visibility:new Tt(We.layout_symbol.visibility)})),paint:MM||(MM=new kn({"icon-opacity":new kt(We.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new kt(We.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new kt(We.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new kt(We.paint_symbol["text-emissive-strength"]),"icon-color":new kt(We.paint_symbol["icon-color"]),"icon-halo-color":new kt(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(We.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(We.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new kt(We.paint_symbol["icon-image-cross-fade"]),"text-opacity":new kt(We.paint_symbol["text-opacity"]),"text-occlusion-opacity":new kt(We.paint_symbol["text-occlusion-opacity"]),"text-color":new kt(We.paint_symbol["text-color"],{runtimeType:Xs,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new kt(We.paint_symbol["text-halo-color"]),"text-halo-width":new kt(We.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(We.paint_symbol["text-halo-blur"]),"text-translate":new Tt(We.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(We.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Tt(We.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Tt(We.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Tt(We.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Tt(We.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new kt(We.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},sw);class C0 extends Ms{constructor(i,o,u,f){super(i,rw(),o,u,f),this._colorAdjustmentMatrix=ce.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,o){super.recalculate(i,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const d of u)f.indexOf(d)<0&&f.push(d);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,o,u,f){return this._saturation===i&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(d,g,w,E){d=nt(d),g=qu(g);const M=ce.mat4.create(),x=d/3,S=1-2*x,P=[S,x,x,0,x,S,x,0,x,x,S,0,0,0,0,1],A=.5-.5*g,C=E-w;return ce.mat4.multiply(M,[C,0,0,0,0,C,0,0,0,0,C,0,w,w,w,1],[g,0,0,0,0,g,0,0,0,0,g,0,A,A,A,1]),ce.mat4.multiply(M,M,P),M}(i,o,u,f),this._saturation=i,this._contrast=o,this._brightnessMin=u,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,o,u,f){const d=this.layout.get(i).evaluate(o,{},u,f),g=this._unevaluatedLayout._values[i];return g.isDataDriven()||Zd(g.value)||!d?d:function(w,E){return E.replace(/{([^{}]+)}/g,(M,x)=>x in w?String(w[x]):"")}(o.properties,d)}createBucket(i){return new I0(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of rw().paint.overridableProperties){if(!C0.hasPaintOverride(this.layout,i))continue;const o=this.paint.get(i),u=new IM(o),f=new fm(u,o.property.specification,this.scope,this.options);let d=null;d=o.value.kind==="constant"||o.value.kind==="source"?new pm("source",f):new Lc("composite",f,o.value.zoomStops,o.value._interpolationType),this.paint._values[i]=new Bc(o.property,d,o.parameters)}}_handleOverridablePaintPropertyUpdate(i,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&C0.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,o){const u=i.get("text-field"),f=rw().paint.properties[o];let d=!1;const g=w=>{for(const E of w)if(f.overrides&&f.overrides.hasOverride(E))return void(d=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Ys)g(u.value.value.sections);else if(u.value.kind==="source"){const w=M=>{d||(M instanceof fa&&ns(M.value)===Xu?g(M.value.sections):M instanceof vc?g(M.sections):M.eachChild(w))},E=u.value;E._styleExpression&&w(E._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,o,u){return{config:new Rl(this,{zoom:o,lut:u}),overrideFog:!1}}}let CM,PM,DM,RM;var ow=Gi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function aw(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function lw(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class cw{constructor(i,o,u,f){this.context=i,this.format=u,this.useMipmap=f&&f.useMipmap,this.texture=i.gl.createTexture(),this.update(o,{premultiply:f&&f.premultiply})}update(i,o){const u=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,f=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:d}=this,{gl:g}=d,{x:w,y:E}=o&&o.position?o.position:{x:0,y:0},M=w+u,x=E+f;!this.size||this.size[0]===M&&this.size[1]===x||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!o||o.premultiply!==!1));const S=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&M>0&&x>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(M,x)))+1:1;g.texStorage2D(g.TEXTURE_2D,P,this.format,M,x),this.size=[M,x]}if(this.size)if(S)g.texSubImage2D(g.TEXTURE_2D,0,w,E,aw(this.format),lw(this.format),i);else{const P=i.data;P&&g.texSubImage2D(g.TEXTURE_2D,0,w,E,u,f,aw(this.format),lw(this.format),P)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(i,o,u=!1){const{context:f}=this,{gl:d}=f;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!u?i===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,o),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(i,o,u,f){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),o!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,o),this.magFilter=o),i!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?i===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),u!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),this.wrapS=u),f!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,f),this.wrapT=f)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class P0{constructor(i,o){this.context=i,this.texture=o}bind(i,o){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,i),this.minFilter=i),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrapS=o)}}function D0(c,i,o,u,f,d,g,w){const E=[c,i,1,o,u,1,f,d,1],M=[g,w,1],x=ce.mat3.adjoint([],E),[S,P,A]=ce.vec3.transformMat3(M,M,x);return ce.mat3.multiply(E,E,[S,0,0,0,P,0,0,0,A])}function LM(c,i,o,u,f,d,g,w){const E=function(M,x,S,P,A,C,R,B){const N=D0(0,0,1,0,1,1,0,1),G=D0(M,x,S,P,A,C,R,B),H=ce.mat3.adjoint([],N);return ce.mat3.multiply(G,G,H)}(c,i,o,u,f,d,g,w);return[E[2]/E[8]/St,E[5]/E[8]/St]}function R0(c){return[c[0],Math.min(Math.max(c[1],-Wn),Wn)]}class OM extends wo{constructor(i,o,u,f){super(),this.id=i,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=o,this._dirty=!1}load(i,o){if(this._loaded=o||!1,this.fire(new xr("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=kp(this.map._requestManager.transformRequest(this.url,Ss.Image),(u,f)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new pc(u)):f&&(this.image=f instanceof HTMLImageElement?it.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new P0(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new xr("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof P0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=i[0][1],u=i[0][1];for(const d of i)d[1]>u&&(u=d[1]),d[1]<o&&(o=d[1]);const f=(u+o)/2;if(f>Wn?this.onNorthPole=!0:f<-Wn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=i.map(n.fromLngLat);this.tileID=function(g){let w=1/0,E=1/0,M=-1/0,x=-1/0;for(const R of g)w=Math.min(w,R.x),E=Math.min(E,R.y),M=Math.max(M,R.x),x=Math.max(x,R.y);const S=Math.max(M-w,x-E),P=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),A=Math.pow(2,P);let C=Math.floor((w+M)/2*A);return C>1&&(C-=1),new ht(P,C,Math.floor((E+x)/2*A))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new xr("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const N in this.tiles){const G=this.tiles[N];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=dg(new ht(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const G=N[1].x-N[0].x,H=N[1].y-N[0].y,$=N[2].x-N[1].x,W=N[2].y-N[1].y,K=N[3].x-N[2].x,Q=N[3].y-N[2].y,ue=N[0].x-N[3].x,oe=N[0].y-N[3].y,ae=G*W-$*H,Ee=$*Q-K*W,he=K*oe-ue*Q,Se=ue*H-G*oe;return ae>0&&Ee>0&&he>0&&Se>0||ae<0&&Ee<0&&he<0&&Se<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=dg(this.tileID,this.map.transform.projection),[d,g,w,E]=this.coordinates.map(N=>{const G=f.projection.project(N[0],N[1]);return xM(f,G)._round()});this.perspectiveTransform=LM(d.x,d.y,g.x,g.y,w.x,w.y,E.x,E.y);const M=this._boundsArray=new Ta;M.emplaceBack(d.x,d.y,0,0),M.emplaceBack(g.x,g.y,St,0),M.emplaceBack(E.x,E.y,0,St),M.emplaceBack(w.x,w.y,St,St),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(M,ow.members),this.boundsSegments=Mn.simpleSegment(0,0,4,2);const x=[],S=[R0((P=this.coordinates)[0]),R0(P[1]),R0(P[2]),R0(P[3])];var P;const[A,C,R,B]=function(N){let G=N[0][0],H=G,$=N[0][1],W=$;for(let K=1;K<N.length;K++)N[K][0]<G?G=N[K][0]:N[K][0]>H&&(H=N[K][0]),N[K][1]<$?$=N[K][1]:N[K][1]>W&&(W=N[K][1]);return[G,$,H-G,W-$]}(S);{const N=new Ta,[G,H,$,W]=function(ke){let He=ke[0].x,Ve=He,qe=ke[0].y,pt=qe;for(let dt=1;dt<ke.length;dt++)ke[dt].x<He?He=ke[dt].x:ke[dt].x>Ve&&(Ve=ke[dt].x),ke[dt].y<qe?qe=ke[dt].y:ke[dt].y>pt&&(pt=ke[dt].y);return[He,qe,Ve-He,pt-qe]}(u),K=ke=>[(ke.x-G)/$,(ke.y-H)/W],[Q,ue,oe,ae]=u.map(K),Ee=function(ke,He,Ve,qe,pt,dt,Ft,_t){const Et=D0(0,0,1,0,1,1,0,1),mt=D0(ke,He,Ve,qe,pt,dt,Ft,_t),ei=ce.mat3.adjoint([],mt);return ce.mat3.multiply(Et,Et,ei)}(Q[0],Q[1],ue[0],ue[1],oe[0],oe[1],ae[0],ae[1]);this.elevatedGlobePerspectiveTransform=LM(Q[0],Q[1],ue[0],ue[1],oe[0],oe[1],ae[0],ae[1]);const he=(ke,He)=>{x.push(ke.lng);const Ve=Math.round((ke.lng-A)/R*St),qe=Math.round((ke.lat-C)/B*St),pt=K(He),dt=ce.vec3.transformMat3([],[pt[0],pt[1],1],Ee),Ft=Math.round(dt[0]/dt[2]*St),_t=Math.round(dt[1]/dt[2]*St);N.emplaceBack(Ve,qe,Ft,_t)},Se=u[3].x-u[0].x,Le=u[3].y-u[0].y,De=u[2].x-u[1].x,Fe=u[2].y-u[1].y;for(let ke=0;ke<65;ke++){const He=ke/64,Ve=[u[0].x+He*Se,u[0].y+He*Le],qe=[u[1].x+He*De,u[1].y+He*Fe],pt=qe[0]-Ve[0],dt=qe[1]-Ve[1];for(let Ft=0;Ft<65;Ft++){const _t=Ft/64,Et={x:Ve[0]+pt*_t,y:Ve[1]+dt*_t,z:0};he(o.projection.unproject(Et.x,Et.y),Et)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(N,ow.members)}{this.maxLongitudeTriangleSize=0;let N=[],G=new Rs;const H=($,W,K)=>{G.emplaceBack($,W,K);const Q=x[$],ue=x[W],oe=x[K],ae=Math.min(Math.min(Q,ue),oe),Ee=Math.max(Math.max(Q,ue),oe)-ae;Ee>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ee),N.push(ae+Ee/2)};for(let $=0;$<64;$++)for(let W=0;W<64;W++){const K=65*$+W,Q=K+1,ue=K+65,oe=ue+1;H(K,ue,Q),H(Q,ue,oe)}[N,G]=function($,W){const K=Array.from({length:$.length},(oe,ae)=>ae);K.sort((oe,ae)=>$[oe]-$[ae]);const Q=[],ue=new Rs;for(let oe=0;oe<K.length;oe++){const ae=K[oe];Q.push($[ae]);const Ee=3*ae,he=Ee+1;ue.emplaceBack(W.uint16[Ee],W.uint16[he],W.uint16[he+1])}return[Q,ue]}(N,G),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(G)}this.elevatedGlobeSegments=Mn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/St,0,B/St,0,0,C,A,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof P0||(this.texture?this.texture.update(this.image):(this.texture=new cw(o,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(o)}loadTile(i,o){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},o(null)):(i.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let f=(d=i+180)+360*Math.round((u[0]-d)/360);var d;const g=new Mn,w=(S,P)=>{g.segments.push({vertexOffset:0,primitiveOffset:S,vertexLength:o.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-f)<=E){const S=Ed(u,0,u.length,f+E);return S===u.length||w(S,Td(u,S+1,u.length,f+360-E)-S),g}f<u[0]&&(f+=360);const M=Td(u,0,u.length,f-E);if(M===u.length)return w(0,u.length),g;w(0,M-0);const x=Ed(u,M+1,u.length,f+E);return x!==u.length&&w(x,u.length-x),g}}const GB=(Math.pow(256,2)-1)/16907520;class kM extends Ms{constructor(i,o,u,f){super(i,{layout:DM||(DM=new kn({visibility:new Tt(We.layout_raster.visibility)})),paint:RM||(RM=new kn({"raster-opacity":new Tt(We.paint_raster["raster-opacity"]),"raster-color":new Vc(We.paint_raster["raster-color"]),"raster-color-mix":new Tt(We.paint_raster["raster-color-mix"]),"raster-color-range":new Tt(We.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(We.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(We.paint_raster["raster-saturation"]),"raster-contrast":new Tt(We.paint_raster["raster-contrast"]),"raster-resampling":new Tt(We.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(We.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Tt(We.paint_raster["raster-emissive-strength"]),"raster-array-band":new Tt(We.paint_raster["raster-array-band"]),"raster-elevation":new Tt(We.paint_raster["raster-elevation"]),"raster-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},o,u,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof OM&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,f]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(f)||u===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=Km({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,f])}}let zM,FM,BM,NM,VM;class UM extends Ms{constructor(i,o,u,f){super(i,{layout:zM||(zM=new kn({visibility:new Tt(We["layout_raster-particle"].visibility)})),paint:FM||(FM=new kn({"raster-particle-array-band":new Tt(We["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Tt(We["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Vc(We["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Tt(We["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Tt(We["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Tt(We["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Tt(We["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Tt(We["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},o,u,f),this._updateColorRamp(),this.lastInvalidatedAt=it.now()}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Km({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=it.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class qB extends Ms{constructor(i,o){super(i,{},o,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function uw(c,i,o){const u=[0,0,1],f=ce.quat.identity([]);return ce.quat.rotateY(f,f,o?-yt(c)+Math.PI:yt(c)),ce.quat.rotateX(f,f,-yt(i)),ce.vec3.transformQuat(u,u,f),ce.vec3.normalize(u,u)}function jM(c,i){const o=L0(c.projection,c.zoom,c.width,c.height),u=function(d,g,w,E,M){const x=new qi(w.lng-180*iu,w.lat),S=new qi(w.lng+180*iu,w.lat),P=d.project(x.lng,x.lat),A=d.project(S.lng,S.lat),C=-Math.atan2(A.y-P.y,A.x-P.x),R=n.fromLngLat(w);R.y=At(R.y,-1+iu,1-iu);const B=R.toLngLat(),N=d.project(B.lng,B.lat),G=n.fromLngLat(B);G.x+=iu;const H=G.toLngLat(),$=d.project(H.lng,H.lat),W=HM($.x-N.x,$.y-N.y,C),K=n.fromLngLat(B);K.y+=iu;const Q=K.toLngLat(),ue=d.project(Q.lng,Q.lat),oe=HM(ue.x-N.x,ue.y-N.y,C),ae=Math.abs(W.x)/Math.abs(oe.y),Ee=ce.mat4.identity([]);ce.mat4.rotateZ(Ee,Ee,-C*(1-(M?0:E)));const he=ce.mat4.identity([]);return ce.mat4.scale(he,he,[1,1-(1-ae)*E,1]),he[4]=-oe.x/oe.y*E,ce.mat4.rotateZ(he,he,C),ce.mat4.multiply(he,Ee,he),he}(c.projection,0,c.center,o,i),f=$M(c);return ce.mat4.scale(u,u,[f,f,1]),u}function $M(c){const i=c.projection,o=L0(c.projection,c.zoom,c.width,c.height),u=hw(i,c.center),f=hw(i,qi.convert(i.center));return Math.pow(2,u*o+(1-o)*f)}function L0(c,i,o,u,f=1/0){const d=c.range;if(!d)return 0;const g=Math.min(f,Math.max(o,u)),w=Math.log(g/1024)/Math.LN2;return ci(d[0]+w,d[1]+w,i)}const iu=1/4e4;function hw(c,i){const o=At(i.lat,-Wn,Wn),u=new qi(i.lng-180*iu,o),f=new qi(i.lng+180*iu,o),d=c.project(u.lng,o),g=c.project(f.lng,o),w=n.fromLngLat(u),E=n.fromLngLat(f),M=g.x-d.x,x=g.y-d.y,S=E.x-w.x,P=E.y-w.y,A=Math.sqrt((S*S+P*P)/(M*M+x*x));return Math.log(A)/Math.LN2}function HM(c,i,o){const u=Math.cos(o),f=Math.sin(o);return{x:c*u-i*f,y:c*f+i*u}}function GM(c,i,o){ce.mat4.identity(c),ce.mat4.rotateZ(c,c,yt(i[2])),ce.mat4.rotateX(c,c,yt(i[0])),ce.mat4.rotateY(c,c,yt(i[1])),ce.mat4.scale(c,c,o),ce.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function O0(c,i,o,u,f,d,g,w){const E=[o[0]-i[0],o[1]-i[1],0],M=[u[0]-i[0],u[1]-i[1],0];if(ce.vec3.length(E)<1e-12||ce.vec3.length(M)<1e-12)return ce.quat.identity(c);const x=ce.vec3.cross([],E,M);ce.vec3.normalize(x,x),ce.vec3.subtract(M,u,i),E[2]=(d-f)*w,M[2]=(g-f)*w;const S=E;return ce.vec3.cross(S,E,M),ce.vec3.normalize(S,S),ce.quat.rotationTo(c,x,S)}function dw(c,i,o=!1){const u=gr(i.zoom),f=function(d,g,w){const E=g.worldSize,M=[d[12],d[13],d[14]],x=Ls(M[1]/E),S=Er(M[0]/E),P=ce.mat4.identity([]),A=js(1,x)*E,C=js(1,0)*E*sl(x,g.zoom),R=1/Xo(E);let B=C*R;if(w){const $=L0(g.projection,g.zoom,g.width,g.height,1024);B=R*g.projection.pixelSpaceConversion(g.center.lat,E,$)}const N=Ll(x,S);ce.vec3.add(N,N,ce.vec3.scale([],ce.vec3.normalize([],N),A*B*M[2]));const G=function($){const W=[$[0],$[1],$[2]];let K=[0,1,0];const Q=ce.vec3.cross([],K,W);return ce.vec3.cross(K,W,Q),ce.vec3.squaredLength(K)===0&&(K=[0,1,0],ce.vec3.cross(Q,W,K)),ce.vec3.normalize(Q,Q),ce.vec3.normalize(K,K),ce.vec3.normalize(W,W),[Q[0],Q[1],Q[2],0,K[0],K[1],K[2],0,W[0],W[1],W[2],0,$[0],$[1],$[2],1]}(N);ce.mat4.scale(P,P,[B,B,B*A]),ce.mat4.translate(P,P,[-M[0],-M[1],-M[2]]);const H=ce.mat4.multiply([],g.globeMatrix,G);return ce.mat4.multiply(H,H,P),ce.mat4.multiply(H,H,d),H}(c,i,o);if(u>0){const d=function(g,w){const E=w.worldSize,M=js(1,0)*E*sl(w.center.lat,w.zoom)/Xo(E),x=js(1,w.center.lat)*E,S=ce.mat4.identity([]);return ce.mat4.rotateY(S,S,yt(w.center.lng)),ce.mat4.rotateX(S,S,yt(w.center.lat)),ce.mat4.translate(S,S,[0,0,cr]),ce.mat4.scale(S,S,[M,M,M*x]),ce.mat4.translate(S,S,[w.point.x-.5*E,w.point.y-.5*E,0]),ce.mat4.multiply(S,S,g),ce.mat4.multiply(S,w.globeMatrix,S)}(c,i);return function(g,w,E){const M=(C,R,B)=>{const N=ce.vec3.length(C),G=ce.vec3.length(R),H=xs(C,R,B);return ce.vec3.scale(H,H,1/ce.vec3.length(H)*ni(N,G,B))},x=M([g[0],g[1],g[2]],[w[0],w[1],w[2]],E),S=M([g[4],g[5],g[6]],[w[4],w[5],w[6]],E),P=M([g[8],g[9],g[10]],[w[8],w[9],w[10]],E),A=xs([g[12],g[13],g[14]],[w[12],w[13],w[14]],E);return[x[0],x[1],x[2],0,S[0],S[1],S[2],0,P[0],P[1],P[2],0,A[0],A[1],A[2],1]}(f,d,u)}return f}function qM(c,i,o,u){const f=Ht.projectAabbCorners(u,o);let d=Number.MAX_VALUE,g=-1;for(let M=0;M<f.length;++M){const x=f[M];x[0]=(.5*x[0]+.5)*i.width,x[1]=(.5-.5*x[1])*i.height,x[2]<d&&(g=M,d=x[2])}const w=M=>new Ie(f[M][0],f[M][1]);let E;switch(g){case 0:case 6:E=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:E=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:E=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:E=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(J(c,E))return d}const WB=Gi([{name:"a_pos_3f",components:3,type:"Float32"}]),ZB=Gi([{name:"a_color_3f",components:3,type:"Float32"}]),XB=Gi([{name:"a_color_4f",components:4,type:"Float32"}]),YB=Gi([{name:"a_uv_2f",components:2,type:"Float32"}]),KB=Gi([{name:"a_normal_3f",components:3,type:"Float32"}]),JB=Gi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),QB=Gi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),WM={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class k0{constructor(i,o,u,f){this.message=(i?`${i}: `:"")+u,f&&(this.identifier=f),o!=null&&o.__line__&&(this.line=o.__line__)}}function ZM(c,i){const o=c.indexOf("://")===-1;try{return new URL(c,o&&i?"http://example.com":void 0),!0}catch{return!1}}class XM{constructor(i,o){this.feature=i,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class YM{constructor(){this.instancedDataArray=new ff,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class fw{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=i.projection,this.index=i.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(i,o){}populate(i,o,u,f){this.tileToMeter=m(u);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:w,index:E,sourceLayerIndex:M}of i){const x=w??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),S=F(g,d);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),S,u))continue;const P={id:x,sourceLayerIndex:M,index:E,geometry:d?S.geometry:z(g,u,f),properties:g.properties,type:g.type,patterns:{}},A=this.addFeature(P,P.geometry,S);A&&o.featureIndex.insert(g,P.geometry,E,M,this.index,this.instancesPerModel[A].instancedDataArray.length,St/32)}this.lookup=null}update(i,o,u,f){for(const d in this.instancesPerModel){const g=this.instancesPerModel[d];for(const w in i)g.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(g.features[g.idToFeaturesIndex[w]],i[w],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const f of u.features){const d=this.layers[0],g=f.feature,w=this.canonical,E=d.paint.get("model-rotation").evaluate(g,{},w),M=d.paint.get("model-scale").evaluate(g,{},w),x=d.paint.get("model-translation").evaluate(g,{},w);ce.vec3.exactEquals(f.rotation,E)&&ce.vec3.exactEquals(f.scale,M)&&ce.vec3.exactEquals(f.translation,x)||(this.evaluate(f,f.featureStates,u,!0),i=!0)}}return i}updateReplacement(i,o,u,f){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const d=o.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(Bb(this.activeReplacements,d))return!1;this.activeReplacements=d;let g=!1;for(const w in this.instancesPerModel){const E=this.instancesPerModel[w],M=E.instancedDataArray;for(const x of E.features){const S=x.instancedDataOffset,P=x.instancedDataCount;for(let A=0;A<P;A++){const C=16*(A+S);let R=M.float32[C+0];const B=R>St;R=B?R-St:R;const N=Math.floor(R),G=M.float32[C+1];let H=!1;for(const $ of this.activeReplacements)if(!rA($,u,WM.Model,f)&&!($.min.x>N||N>$.max.x||$.min.y>G||G>$.max.y)&&(H=hA(uA(N,G,i.canonical,$.footprintTileId.canonical),$.footprint),H))break;M.float32[C]=H?R+St:R,g=g||H!==B}}}return g}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=i.createVertexBuffer(u.instancedDataArray,JB.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris)for(const o of this.modelUris)i.removeModel(o,"")}addFeature(i,o,u){const f=this.layers[0],d=f.layout.get("model-id").evaluate(u,{},this.canonical);if(!d)return on(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),d;ZM(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new YM);const g=this.instancesPerModel[d],w=g.instancedDataArray,E=new XM(u,w.length);for(const M of o)for(const x of M){if(x.x<0||x.x>=St||x.y<0||x.y>=St)continue;const S=(this.lookupDim-1)/St,P=this.lookupDim*(x.y*S|0)+x.x*S|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const A=w.length;w.resize(A+1),g.instancesEvaluatedElevation.push(0),w.float32[16*A]=x.x,w.float32[16*A+1]=x.y}return E.instancedDataCount=g.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(i.id&&(g.idToFeaturesIndex[i.id]=g.features.length),g.features.push(E),this.evaluate(E,{},g,!1)),d}getModelUris(){return this.modelUris}evaluate(i,o,u,f){const d=this.layers[0],g=i.feature,w=this.canonical,E=i.rotation=d.paint.get("model-rotation").evaluate(g,o,w),M=i.scale=d.paint.get("model-scale").evaluate(g,o,w),x=i.translation=d.paint.get("model-translation").evaluate(g,o,w),S=d.paint.get("model-color").evaluate(g,o,w);S.a=d.paint.get("model-color-mix-intensity").evaluate(g,o,w);const P=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,M[0]),Math.max(M[1],M[2])),GM(P,E,M);const A=Math.round(100*S.a)+S.b/1.05;for(let C=0;C<i.instancedDataCount;++C){const R=i.instancedDataOffset+C,B=16*R,N=u.instancedDataArray.float32;let G=0;f&&(G=N[B+6]-u.instancesEvaluatedElevation[R]);const H=0|N[B+1];N[B]=(0|N[B])+S.r/1.05,N[B+1]=H+S.g/1.05,N[B+2]=A,N[B+3]=1/(w.z>10?this.tileToMeter:m(w,H)),N[B+4]=x[0],N[B+5]=x[1],N[B+6]=x[2]+G,N[B+7]=P[0],N[B+8]=P[1],N[B+9]=P[2],N[B+10]=P[4],N[B+11]=P[5],N[B+12]=P[6],N[B+13]=P[8],N[B+14]=P[9],N[B+15]=P[10],u.instancesEvaluatedElevation[R]=x[2]}}}let KM,JM;zt(fw,"ModelBucket",{omit:["layers"]}),zt(YM,"PerModelAttributes"),zt(XM,"ModelFeature");const Rh=64,If={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function QM(c,i,o,u,f,d,g,w,E,M=!1){const x=o.zoom,S=o.project(u),P=sl(u.lat,x),A=1/P;ce.mat4.identity(c),ce.mat4.translate(c,c,[S.x+g[0]*A,S.y+g[1]*A,g[2]]);let C=1,R=1;const B=o.worldSize;if(M){if(o.projection.name==="mercator"){let $=0;o.elevation&&($=o.elevation.getAtPointOrZero(new n(S.x/B,S.y/B),0));const W=ce.vec4.transformMat4([],[S.x,S.y,$,1],o.projMatrix)[3]/o.cameraToCenterDistance;C=W,R=W*sl(o.center.lat,x)}else if(o.projection.name==="globe"){const $=dw(c,o),W=ce.mat4.multiply([],o.projMatrix,$),K=[0,0,0,1];ce.vec4.transformMat4(K,K,W);const Q=K[3]/o.cameraToCenterDistance,ue=gr(x),oe=o.projection.pixelsPerMeter(u.lat,B)*sl(u.lat,x),ae=o.projection.pixelsPerMeter(o.center.lat,B)*sl(o.center.lat,x);C=Q/ni(oe,s0(o.center.lat),ue),R=Q*P/oe,C*=ae,R*=ae}}else C=A;ce.mat4.scale(c,c,[C,C,R]);const N=[...c],G=i.orientation,H=[];if(GM(H,[G[0]+f[0],G[1]+f[1],G[2]+f[2]],d),ce.mat4.multiply(c,N,H),w&&o.elevation){let $=0;const W=[];if(E&&o.elevation){$=function(ue,oe,ae,Ee,he){const Se=oe.elevation;if(!Se)return 0;const Le=Ht.projectAabbCorners(ae,Ee),De=js(1,he.lat)*oe.worldSize,Fe=function(ei,Lt){const jt=[0,0,1],ai=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const wi of ai){const di=ei[wi.corners[0]],Ii=ei[wi.corners[1]],bi=ei[wi.corners[2]],Pi=[Ii[0]-di[0],Ii[1]-di[1],Lt*(Ii[2]-di[2])],Ui=ce.vec3.cross(Pi,Pi,[bi[0]-di[0],bi[1]-di[1],Lt*(bi[2]-di[2])]);ce.vec3.normalize(Ui,Ui),wi.dotProductWithUp=ce.vec3.dot(Ui,jt)}return ai.sort((wi,di)=>wi.dotProductWithUp-di.dotProductWithUp),ai[0].corners}(Le,De),ke=Le[Fe[0]],He=Le[Fe[1]],Ve=Le[Fe[2]],qe=Le[Fe[3]],pt=Se.getAtPointOrZero(new n(ke[0]/oe.worldSize,ke[1]/oe.worldSize),0),dt=Se.getAtPointOrZero(new n(He[0]/oe.worldSize,He[1]/oe.worldSize),0),Ft=Se.getAtPointOrZero(new n(Ve[0]/oe.worldSize,Ve[1]/oe.worldSize),0),_t=Se.getAtPointOrZero(new n(qe[0]/oe.worldSize,qe[1]/oe.worldSize),0),Et=(pt+_t)/2,mt=(dt+Ft)/2;return Et>mt?dt<Ft?O0(ue,He,qe,ke,dt,_t,pt,De):O0(ue,Ve,ke,qe,Ft,pt,_t,De):pt<_t?O0(ue,ke,He,Ve,pt,dt,Ft,De):O0(ue,qe,Ve,He,_t,Ft,dt,De),Math.max(Et,mt)}(W,o,i.aabb,c,u);const K=ce.mat4.fromQuat([],W),Q=ce.mat4.multiply([],K,H);ce.mat4.multiply(c,N,Q)}else $=o.elevation.getAtPointOrZero(new n(S.x/B,S.y/B),0);$!==0&&(c[14]+=$)}}function _g(c,i,o=!1){c.uploaded||(c.gfxTexture=new cw(i,c.image,o?i.gl.R8:i.gl.RGBA8,{useMipmap:c.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function eN(c,i,o){c.indexBuffer=i.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=i.createVertexBuffer(c.vertexArray,WB.members,!1,!0),c.normalArray&&(c.normalBuffer=i.createVertexBuffer(c.normalArray,KB.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=i.createVertexBuffer(c.texcoordArray,YB.members,!1,!0)),c.colorArray&&(c.colorBuffer=i.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?ZB:XB).members,!1,!0)),c.featureArray&&(c.pbrBuffer=i.createVertexBuffer(c.featureArray,QB.members,!0)),c.segments=Mn.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const u=c.material;u.pbrMetallicRoughness.baseColorTexture&&_g(u.pbrMetallicRoughness.baseColorTexture,i),u.pbrMetallicRoughness.metallicRoughnessTexture&&_g(u.pbrMetallicRoughness.metallicRoughnessTexture,i),u.normalTexture&&_g(u.normalTexture,i),u.occlusionTexture&&_g(u.occlusionTexture,i,o),u.emissionTexture&&_g(u.emissionTexture,i)}function pw(c,i,o){if(c.meshes)for(const u of c.meshes)eN(u,i,o);if(c.children)for(const u of c.children)pw(u,i,o)}function z0(c){if(c.meshes)for(const i of c.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(c.children)for(const i of c.children)z0(i)}function mw(c){if(c.meshes)for(const o of c.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((i=o.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(c.children)for(const o of c.children)mw(o)}class Cf{constructor(i,o,u){this._demTile=i,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(i,o,u){const f=u||i.findDEMTileFor(o);if(!f||!f.dem)return;const d=f.dem,g=f.tileID,w=1<<o.canonical.z-g.canonical.z;return new Cf(f,d.dim/St/w,[(o.canonical.x/w-g.canonical.x)*d.dim,(o.canonical.y/w-g.canonical.y)*d.dim])}tileCoordToPixel(i,o){const u=o*this._scale+this._offset[1],f=Math.floor(i*this._scale+this._offset[0]),d=Math.floor(u);return new Ie(f,d)}getElevationAt(i,o,u,f){const d=i*this._scale+this._offset[0],g=o*this._scale+this._offset[1],w=Math.floor(d),E=Math.floor(g),M=this._dem;return f=!!f,u?ni(ni(M.get(w,E,f),M.get(w,E+1,f),g-E),ni(M.get(w+1,E,f),M.get(w+1,E+1,f),g-E),d-w):M.get(w,E,f)}getElevationAtPixel(i,o,u){return this._dem.get(i,o,!!u)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*js(1,i)*this._dem.stride}}const gw=new Float32Array(262144),Lh=new Uint8Array(262144);function eI(c){let i=0;if(c.meshes)for(const o of c.meshes)i=Math.max(i,o.aabb.max[2]);if(c.children)for(const o of c.children)i=Math.max(i,eI(o));return i}function tI(c,i,o){if(c.meshes)for(const u of c.meshes){if(u.aabb.min[0]===1/0)continue;const f=Ht.applyTransform(u.aabb,c.matrix);o.insert(i,f.min[0],f.min[1],f.max[0],f.max[1])}if(c.children)for(const u of c.children)tI(u,i,o)}const iI=["","wall","door","roof","window","lamp","logo"];class nI{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:eI(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const o=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==i&&(u.transformedAabb=Ht.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),i++;this.aabb=o}return this.aabb}}class F0{constructor(i,o,u,f,d,g,w){this.id=u,this.layers=i,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=If.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=If.HasMapboxMeshFeatures),d&&(this.modelTraits|=If.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of o)this.nodesInfo.push(new nI(E)),tI(E,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(i,o){for(const u of this.getNodesInfo()){const f=u.node;f.footprint&&o.push({footprint:f.footprint,id:i})}}update(i){const o=Object.keys(i).length!==0;if(o&&!this.stateDependentLayers.length)return;const u=o?this.stateDependentLayers:this.layers;if(!wt(i,this.states))for(const f of u)this.evaluate(f,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const f=u.node;this.uploaded?this.updatePbrBuffer(f):pw(f,i,!0)}for(const u of o)z0(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let o=!1;if(!i.meshes)return o;for(const u of i.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(i,o,u){const f=i.transform.projectionOptions,d=i.style.getBrightness(),g=this.brightness!==d;if(!this.uploaded||this.dirty||f.name!==this.projection.name||yg(u.paint.get("model-color").value,g)||yg(u.paint.get("model-color-mix-intensity").value,g)||yg(u.paint.get("model-roughness").value,g)||yg(u.paint.get("model-emissive-strength").value,g)||yg(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=f,this.brightness=d;const w=this.getNodesInfo();for(const E of w)E.state=null;return!0}return!1}evaluateScale(i,o){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const u=this.getNodesInfo(),f=this.id.canonical;for(const d of u){const g=d.feature;d.evaluatedScale=o.paint.get("model-scale").evaluate(g,{},f)}}evaluate(i,o){const u=this.getNodesInfo();for(const f of u){if(!f.node.meshes)continue;const d=f.feature,g=o&&o[d.id];if(wt(g,f.state))continue;f.state=structuredClone(g);const w=f.node.meshes&&f.node.meshes[0].featureData,E=f.evaluatedColor[2],M=f.evaluatedRMEA[2],x=this.id.canonical;if(f.hasTranslucentParts=!1,w){for(let S=0;S<iI.length;S++){const P=iI[S];P.length&&(d.properties.part=P);const A=i.paint.get("model-color").evaluate(d,g,x).toRenderColor(null),C=i.paint.get("model-color-mix-intensity").evaluate(d,g,x);f.evaluatedColor[S]=[A.r,A.g,A.b,C],f.evaluatedRMEA[S][0]=i.paint.get("model-roughness").evaluate(d,g,x),f.evaluatedRMEA[S][2]=i.paint.get("model-emissive-strength").evaluate(d,g,x),f.evaluatedRMEA[S][3]=A.a,f.emissionHeightBasedParams[S]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,g,x),!f.hasTranslucentParts&&A.a<1&&(f.hasTranslucentParts=!0)}delete d.properties.part,iN(f,E!==f.evaluatedColor[2]||M!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(d,g,x);f.evaluatedScale=i.paint.get("model-scale").evaluate(d,g,x),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,o,u,f){const d=i.findDEMTileFor(u);if(d&&(d.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const g=Cf.create(i,u,d);if(!g)return;this.modelTraits&If.HasMapboxMeshFeatures&&this.updateDEM(i,g,u,f);for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const M=E.footprint.vertices;let x=g.getElevationAt(M[0].x,M[0].y,!0,!0);for(let S=1;S<M.length;S++)x=Math.min(x,g.getElevationAt(M[S].x,M[S].y,!0,!0));E.elevation=x}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=o}}updateDEM(i,o,u,f){let d=o._dem._modifiedForSources[f];if(d===void 0&&(o._dem._modifiedForSources[f]=[],d=o._dem._modifiedForSources[f]),d.includes(u.canonical))return;const g=o._dem.dim;d.push(u.canonical);let w=!1;for(const E of this.getNodesInfo()){const M=E.node;if(!M.footprint||!M.footprint.grid)continue;const x=M.footprint.grid,S=o.tileCoordToPixel(x.min.x,x.min.y),P=o.tileCoordToPixel(x.max.x,x.max.y),A=Math.min(Math.min(g-P.y,S.x),Math.min(S.y,g-P.x));if(A<0)continue;const C=At(A,2,5);let R=Math.max(0,S.x-C),B=Math.max(0,S.y-C),N=Math.min(P.x+C,g-1),G=Math.min(P.y+C,g-1);for(let K=B;K<=G;++K)for(let Q=R;Q<=N;++Q)Lh[K*g+Q]=255;let H=0,$=0;for(let K=0;K<x.cellsY;++K)for(let Q=0;Q<x.cellsX;++Q){if(!x.cells[K*x.cellsX+Q])continue;const ue=o.tileCoordToPixel(x.min.x+Q/x.xScale,x.min.y+K/x.yScale),oe=o.tileCoordToPixel(x.min.x+(Q+1)/x.xScale,x.min.y+(K+1)/x.yScale);for(let ae=ue.y;ae<=Math.min(oe.y+1,g-1);++ae)for(let Ee=ue.x;Ee<=Math.min(oe.x+1,g-1);++Ee)Lh[ae*g+Ee]===255&&(Lh[ae*g+Ee]=0,H+=o.getElevationAtPixel(Ee,ae),$++)}const W=H/$;R=Math.max(1,S.x-C),B=Math.max(1,S.y-C),N=Math.min(P.x+C,g-2),G=Math.min(P.y+C,g-2),w=!0;for(let K=B;K<=G;++K)for(let Q=R;Q<=N;++Q)Lh[K*g+Q]===0&&(gw[K*g+Q]=o._dem.set(Q,K,W));for(let K=1;K<C;++K){R=Math.max(1,S.x-K),B=Math.max(1,S.y-K),N=Math.min(P.x+K,g-2),G=Math.min(P.y+K,g-2);for(let Q=B;Q<=G;++Q)for(let ue=R;ue<=N;++ue){const oe=Q*g+ue;if(Lh[oe]===255){let ae=0,Ee=0,he=-1,Se=-1;for(let Le=-1;Le<=1;++Le)for(let De=-1;De<=1;++De){const Fe=(Q+Le)*g+ue+De;if(Lh[Fe]>=K)continue;const ke=gw[Fe],He=Math.abs(ke);He>Ee&&(ae=ke,Ee=He,he=De,Se=Le)}if(Ee>.1){const Le=1-(K+.5*Math.abs(he*Se))/C;let De=o._dem.get(ue,Q)+ae*Le;const Fe=o._dem.get(ue+he,Q+Se),ke=o._dem.get(ue-he,Q-Se,!0);(De-Fe)*(De-ke)>0&&(De=(Fe+ke)/2),gw[oe]=o._dem.set(ue,Q,De),Lh[oe]=K}}}}}w&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=it.now())}setFilter(i){this.filter=i?Mm(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new fn(this.id.overscaledZ),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const o of i)z0(o.node),mw(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(i.toUnwrapped()),f=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const g=f[d].node;f[d].hiddenByReplacement=!!g.footprint&&!u.find(w=>w.footprint===g.footprint)}}getHeightAtTileCoord(i,o){const u=this.getNodesInfo(),f=[],d=[0,0,0],g=ce.mat4.identity([]);for(let w=0;w<this.nodesInfo.length;w++){const E=u[w],M=E.node.meshes[0],x=M.transformedAabb;if(i<x.min[0]||o<x.min[1]||i>x.max[0]||o>x.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};ce.mat4.invert(g,E.node.matrix),d[0]=i,d[1]=o,ce.vec3.transformMat4(d,d,g);const S=(d[0]-M.aabb.min[0])/(M.aabb.max[0]-M.aabb.min[0])*Rh|0,P=Math.min(63,(d[1]-M.aabb.min[1])/(M.aabb.max[1]-M.aabb.min[1])*Rh|0)*Rh+Math.min(63,S),A=M.heightmap[P];if(!(A<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:A,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new Ie(i,o),new Ie(i,o),f),f.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function yg(c,i){return!c.isLightConstant&&i}function tN(c,i,o,u,f,d,g,w){let E=(61440&i|(61440&i)>>4)>>8,M=(3840&i|(3840&i)>>4)>>4,x=240&i|(240&i)>>4;o[3]>0&&(E=ni(E,255*o[0],o[3]),M=ni(M,255*o[1],o[3]),x=ni(x,255*o[2],o[3]));const S=E<<8|M,P=x<<8|Math.floor(255*u[3]),A=function(K){const Q=At(K,0,2);return Math.min(Math.round(.5*Q*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],C=At(f[0],0,1),R=At(f[1],0,1),B=At(f[2],0,1),N=At(f[3],0,1);let G,H,$,W;if(C!==R&&g!==d&&R!==C){const K=g-d;H=1/(K*(R-C)),$=-(d+K*C)/(K*(R-C));const Q=At(f[4],-1,1);W=Math.pow(10,Q),G=255*B<<8|255*N}else G=65535,H=0,$=1,W=1;if(c.emplaceBack(S,P,A,G,H,$,W),w){const K=w.length;w.clear();for(let Q=0;Q<K;Q++)w.emplaceBack(S,P,A,G,H,$,W)}}function iN(c,i,o){const u=c.node;let f=0;const d=o&If.HasMeshoptCompression;for(const g of u.meshes){if(u.lights&&u.lightMeshIndex===f||!g.featureData)continue;g.featureArray=new pf,g.featureArray.reserve(g.featureData.length);let w=i;for(const E of g.featureData){const M=d?65535&E:E>>16&65535,x=d?E>>16&65535:65535&E,S=(15&x)<8?15&x:0,P=c.evaluatedRMEA[S],A=c.evaluatedColor[S],C=c.emissionHeightBasedParams[S];let R;if(w&&S===2&&u.lights&&(R=new pf,R.resize(10*u.lights.length)),tN(g.featureArray,M,A,P,C,g.aabb.min[2],g.aabb.max[2],R),R&&w){w=!1;const B=u.meshes[u.lightMeshIndex];B.featureArray=R,B.featureArray._trim()}}g.featureArray._trim(),f++}}function sI(c,i,o,u){const f=1<<c.z;i.lat=Ls((u/St+c.y)/f),i.lng=Er((o/St+c.x)/f)}zt(F0,"Tiled3dModelBucket",{omit:["layers"]}),zt(nI,"Tiled3dModelFeature");const nN={circle:class extends Ms{constructor(c,i,o,u){super(c,{layout:je||(je=new kn({"circle-sort-key":new kt(We.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Tt(We.layout_circle["circle-elevation-reference"]),visibility:new Tt(We.layout_circle.visibility)})),paint:at||(at=new kn({"circle-radius":new kt(We.paint_circle["circle-radius"]),"circle-color":new kt(We.paint_circle["circle-color"]),"circle-blur":new kt(We.paint_circle["circle-blur"]),"circle-opacity":new kt(We.paint_circle["circle-opacity"]),"circle-translate":new Tt(We.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(We.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt(We.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,u)}createBucket(c){return new q(c)}queryRadius(c){const i=c;return $e("circle-radius",this,i)+$e("circle-stroke-width",this,i)+ct(this.paint.get("circle-translate"))}queryIntersectsFeature(c,i,o,u,f,d,g,w){const E=vt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,c.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o);return xf(c,u,d,g,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,M)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,i,o){const u=Xc(this);return{config:new Rl(this,{zoom:i,lut:o}),defines:u,overrideFog:!1}}},heatmap:class extends Ms{createBucket(c){return new I2(c)}constructor(c,i,o,u){super(c,{layout:C2||(C2=new kn({visibility:new Tt(We.layout_heatmap.visibility)})),paint:P2||(P2=new kn({"heatmap-radius":new kt(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vc(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(We.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Km({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return $e("heatmap-radius",this,c)}queryIntersectsFeature(c,i,o,u,f,d,g,w){const E=this.paint.get("heatmap-radius").evaluate(i,o);return xf(c,u,d,g,w,!0,!0,new Ie(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,i,o){return c==="heatmap"?{config:new Rl(this,{zoom:i,lut:o}),overrideFog:!1}:{}}},hillshade:class extends Ms{constructor(c,i,o,u){super(c,{layout:D2||(D2=new kn({visibility:new Tt(We.layout_hillshade.visibility)})),paint:R2||(R2=new kn({"hillshade-illumination-direction":new Tt(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(We.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt(We.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,i,o){return{overrideFog:!1}}},fill:class extends Ms{constructor(c,i,o,u){super(c,{layout:K2||(K2=new kn({"fill-sort-key":new kt(We.layout_fill["fill-sort-key"]),visibility:new Tt(We.layout_fill.visibility),"fill-elevation-reference":new Tt(We.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new kt(We.layout_fill["fill-construct-bridge-guard-rail"])})),paint:J2||(J2=new kn({"fill-antialias":new Tt(We.paint_fill["fill-antialias"]),"fill-opacity":new kt(We.paint_fill["fill-opacity"]),"fill-color":new kt(We.paint_fill["fill-color"]),"fill-outline-color":new kt(We.paint_fill["fill-outline-color"]),"fill-translate":new Tt(We.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(We.paint_fill["fill-pattern"]),"fill-emissive-strength":new Tt(We.paint_fill["fill-emissive-strength"]),"fill-z-offset":new kt(We.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new kt(We.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new kt(We.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,u)}getProgramIds(){const c=this.paint.get("fill-pattern"),i=c&&c.constantOr(1),o=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(c,i,o){return{config:new Rl(this,{zoom:i,lut:o}),overrideFog:!1}}recalculate(c,i){super.recalculate(c,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new kb(c)}queryRadius(){return ct(this.paint.get("fill-translate"))}queryIntersectsFeature(c,i,o,u,f,d){return!c.queryGeometry.isAboveHorizon&&ee(ut(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,c.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?i&&!c:i}},"fill-extrusion":class extends Ms{constructor(c,i,o,u){super(c,{layout:AA||(AA=new kn({visibility:new Tt(We["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:MA||(MA=new kn({"fill-extrusion-opacity":new Tt(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new kt(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Tt(We["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Tt(We["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Tt(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new kt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new kt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt(We["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt(We["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(We["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new kt(We["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Tt(We["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new p0(c)}queryRadius(){return ct(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,i,o,u,f,d,g,w,E){const M=vt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,c.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(i,o),S=this.paint.get("fill-extrusion-base").evaluate(i,o),P=[0,0],A=w&&d.elevation,C=d.elevation?d.elevation.exaggeration():1,R=c.tile.getBucket(this);if(A&&R instanceof p0){const $=R.centroidVertexArray,W=E+1;W<$.length&&(P[0]=$.geta_centroid_pos0(W),P[1]=$.geta_centroid_pos1(W))}if(P[0]===0&&P[1]===1)return!1;d.projection.name==="globe"&&(u=SA([u],[new Ie(0,0),new Ie(St,St)],c.tileID.canonical).map($=>$.polygon).flat());const B=A?w:null,[N,G]=function($,W,K,Q,ue,oe,ae,Ee,he,Se,Le){return $.projection.name==="globe"?function(De,Fe,ke,He,Ve,qe,pt,dt,Ft,_t,Et){const mt=[],ei=[],Lt=De.projection.upVectorScale(Et,De.center.lat,De.worldSize).metersToTile,jt=[0,0,0,1],ai=[0,0,0,1],wi=(Ii,bi,Pi,Ui)=>{Ii[0]=bi,Ii[1]=Pi,Ii[2]=Ui,Ii[3]=1},di=EA();ke>0&&(ke+=di),He+=di;for(const Ii of Fe){const bi=[],Pi=[];for(const Ui of Ii){const pn=Ui.x+Ve.x,ui=Ui.y+Ve.y,Oi=De.projection.projectTilePoint(pn,ui,Et),En=De.projection.upVector(Et,Ui.x,Ui.y);let Rn=ke,zn=He;if(pt){const Vn=CA(pn,ui,ke,He,pt,dt,Ft,_t);Rn+=Vn.base,zn+=Vn.top}ke!==0?wi(jt,Oi.x+En[0]*Lt*Rn,Oi.y+En[1]*Lt*Rn,Oi.z+En[2]*Lt*Rn):wi(jt,Oi.x,Oi.y,Oi.z),wi(ai,Oi.x+En[0]*Lt*zn,Oi.y+En[1]*Lt*zn,Oi.z+En[2]*Lt*zn),ce.vec3.transformMat4(jt,jt,qe),ce.vec3.transformMat4(ai,ai,qe),bi.push(new Dh(jt[0],jt[1],jt[2])),Pi.push(new Dh(ai[0],ai[1],ai[2]))}mt.push(bi),ei.push(Pi)}return[mt,ei]}($,W,K,Q,ue,oe,ae,Ee,he,Se,Le):ae?function(De,Fe,ke,He,Ve,qe,pt,dt,Ft){const _t=[],Et=[],mt=[0,0,0,1];for(const ei of De){const Lt=[],jt=[];for(const ai of ei){const wi=ai.x+He.x,di=ai.y+He.y,Ii=CA(wi,di,Fe,ke,qe,pt,dt,Ft);mt[0]=wi,mt[1]=di,mt[2]=Ii.base,mt[3]=1,ce.vec4.transformMat4(mt,mt,Ve),mt[3]=Math.max(mt[3],1e-5);const bi=new Dh(mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]);mt[0]=wi,mt[1]=di,mt[2]=Ii.top,mt[3]=1,ce.vec4.transformMat4(mt,mt,Ve),mt[3]=Math.max(mt[3],1e-5);const Pi=new Dh(mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]);Lt.push(bi),jt.push(Pi)}_t.push(Lt),Et.push(jt)}return[_t,Et]}(W,K,Q,ue,oe,ae,Ee,he,Se):function(De,Fe,ke,He,Ve){const qe=[],pt=[],dt=Ve[8]*Fe,Ft=Ve[9]*Fe,_t=Ve[10]*Fe,Et=Ve[11]*Fe,mt=Ve[8]*ke,ei=Ve[9]*ke,Lt=Ve[10]*ke,jt=Ve[11]*ke;for(const ai of De){const wi=[],di=[];for(const Ii of ai){const bi=Ii.x+He.x,Pi=Ii.y+He.y,Ui=Ve[0]*bi+Ve[4]*Pi+Ve[12],pn=Ve[1]*bi+Ve[5]*Pi+Ve[13],ui=Ve[2]*bi+Ve[6]*Pi+Ve[14],Oi=Ve[3]*bi+Ve[7]*Pi+Ve[15],En=Ui+dt,Rn=pn+Ft,zn=ui+_t,Vn=Math.max(Oi+Et,1e-5),dn=Ui+mt,ws=pn+ei,_r=ui+Lt,Qn=Math.max(Oi+jt,1e-5);wi.push(new Dh(En/Vn,Rn/Vn,zn/Vn)),di.push(new Dh(dn/Qn,ws/Qn,_r/Qn))}qe.push(wi),pt.push(di)}return[qe,pt]}(W,K,Q,ue,oe)}(d,u,S,x,M,g,B,P,C,d.center.lat,c.tileID.canonical),H=c.queryGeometry;return function($,W,K){let Q=1/0;ee(K,W)&&(Q=IA(K,W[0]));for(let ue=0;ue<W.length;ue++){const oe=W[ue],ae=$[ue];for(let Ee=0;Ee<oe.length-1;Ee++){const he=oe[Ee],Se=[he,oe[Ee+1],ae[Ee+1],ae[Ee],he];J(K,Se)&&(Q=Math.min(Q,IA(K,Se)))}}return Q!==1/0&&Q}(N,G,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends Ms{constructor(c,i,o,u){const f=NA();super(c,f,i,o,u),f.layout&&(this.layout=new Nc(f.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Go,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,i){super.recalculate(c,i),this.paint._values["line-floorwidth"]=(()=>{if(og)return og;const o=NA();return og=new sB(o.paint.properties["line-width"].specification),og.useIntegerZoom=!0,og})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new jb(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,i,o){const u=FA(this);return{config:new Rl(this,{zoom:i,lut:o}),defines:u,overrideFog:!1}}queryRadius(c){const i=c,o=VA($e("line-width",this,i),$e("line-gap-width",this,i)),u=$e("line-offset",this,i);return o/2+Math.abs(u)+ct(this.paint.get("line-translate"))}queryIntersectsFeature(c,i,o,u,f,d){if(c.queryGeometry.isAboveHorizon)return!1;const g=ut(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,c.pixelToTileUnitsFactor),w=c.pixelToTileUnitsFactor/2*VA(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),E=this.paint.get("line-offset").evaluate(i,o);return E&&(u=function(M,x){const S=[],P=new Ie(0,0);for(let A=0;A<M.length;A++){const C=M[A],R=[];for(let B=0;B<C.length;B++){const N=C[B],G=C[B+1],H=B===0?P:N.sub(C[B-1])._unit()._perp(),$=B===C.length-1?P:G.sub(N)._unit()._perp(),W=H._add($)._unit();W._mult(1/(W.x*$.x+W.y*$.y)),R.push(W._mult(x)._add(N))}S.push(R)}return S}(u,E*c.pixelToTileUnitsFactor)),function(M,x,S){for(let P=0;P<x.length;P++){const A=x[P];if(M.length>=3){for(let C=0;C<A.length;C++)if(xe(M,A[C]))return!0}if(ie(M,A,S))return!0}return!1}(g,u,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets}},symbol:C0,background:class extends Ms{constructor(c,i,o,u){super(c,{layout:CM||(CM=new kn({visibility:new Tt(We.layout_background.visibility)})),paint:PM||(PM=new kn({"background-pitch-alignment":new Tt(We.paint_background["background-pitch-alignment"]),"background-color":new Tt(We.paint_background["background-color"]),"background-pattern":new Tt(We.paint_background["background-pattern"]),"background-opacity":new Tt(We.paint_background["background-opacity"]),"background-emissive-strength":new Tt(We.paint_background["background-emissive-strength"]),"background-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,i,o){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:kM,"raster-particle":UM,sky:class extends Ms{constructor(c,i,o,u){super(c,{layout:BM||(BM=new kn({visibility:new Tt(We.layout_sky.visibility)})),paint:NM||(NM=new kn({"sky-type":new Tt(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new Vc(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt(We.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Km({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(c,i){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),f=!u,d=c.style.light,g=d.properties.get("position");return f&&d.properties.get("anchor")==="viewport"&&on("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?uw(g.azimuthal,90-g.polar,i):uw(u[0],90-u[1],i)}const o=this.paint.get("sky-gradient-center");return uw(o[0],90-o[1],i)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends Ms{constructor(c,i,o,u){super(c,{paint:VM||(VM=new kn({}))},i,null)}},model:class extends Ms{constructor(c,i,o,u){super(c,{layout:KM||(KM=new kn({visibility:new Tt(We.layout_model.visibility),"model-id":new kt(We.layout_model["model-id"])})),paint:JM||(JM=new kn({"model-opacity":new kt(We.paint_model["model-opacity"]),"model-rotation":new kt(We.paint_model["model-rotation"]),"model-scale":new kt(We.paint_model["model-scale"]),"model-translation":new kt(We.paint_model["model-translation"]),"model-color":new kt(We.paint_model["model-color"]),"model-color-mix-intensity":new kt(We.paint_model["model-color-mix-intensity"]),"model-type":new Tt(We.paint_model["model-type"]),"model-cast-shadows":new Tt(We.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt(We.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt(We.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new kt(We.paint_model["model-emissive-strength"]),"model-roughness":new kt(We.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new kt(We.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt(We.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Tt(We.paint_model["model-front-cutoff"]),"model-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new fw(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof F0?St-1:0}queryIntersectsFeature(c,i,o,u,f,d){if(!this.modelManager)return!1;const g=this.modelManager,w=c.tile.getBucket(this);if(!(w&&w instanceof fw))return!1;for(const E in w.instancesPerModel){const M=w.instancesPerModel[E],x=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(x)){const S=M.features[M.idToFeaturesIndex[x]],P=g.getModel(E,this.scope);if(!P)return!1;let A=ce.mat4.create();const C=new qi(0,0),R=w.canonical;let B=Number.MAX_VALUE;for(let N=0;N<S.instancedDataCount;++N){const G=16*(S.instancedDataOffset+N),H=M.instancedDataArray.float32,$=[H[G+4],H[G+5],H[G+6]];sI(R,C,H[G],0|H[G+1]),QM(A,P,d,C,S.rotation,S.scale,$,!1,!1,!1),d.projection.name==="globe"&&(A=dw(A,d));const W=ce.mat4.multiply([],d.projMatrix,A),K=c.queryGeometry,Q=qM(K.isPointQuery()?K.screenBounds:K.screenGeometry,d,W,P.aabb);Q!=null&&(B=Math.min(Q,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(c,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const i=this._transitionablePaint._values[c];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof Lc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ms{constructor(c,i,o,u){super(c,{layout:Q2||(Q2=new kn({"clip-layer-types":new Tt(We.layout_clip["clip-layer-types"]),"clip-layer-scope":new Tt(We.layout_clip["clip-layer-scope"])})),paint:eA||(eA=new kn({}))},i,o,u)}recalculate(c,i){super.recalculate(c,i)}createBucket(c){return new tA(c)}is3D(c){return!0}}};class sN{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class rN{constructor(){this.tasks={},this.taskQueue=[],Ws(["process"],this),this.invoker=new sN(this.process),this.nextId=0}add(i,o){const u=this.nextId++,f=function({type:d,isSymbolTile:g,zoom:w}){return w=w||0,d==="message"?0:d!=="maybePrepare"||g?d!=="parseTile"||g?d==="parseTile"&&g?300-w:d==="maybePrepare"&&g?400-w:500:200-w:100-w}(o);if(f===0){try{i()}finally{}return null}return this.tasks[u]={fn:i,metadata:o,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const o=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let i=null,o=1/0;for(let f=0;f<this.taskQueue.length;f++){const d=this.tasks[this.taskQueue[f]];d.priority<o&&(o=d.priority,i=f)}if(i===null)return null;const u=this.taskQueue[i];return this.taskQueue.splice(i,1),u}remove(){this.invoker.remove()}}class rI{constructor(i,o,u){this.target=i,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Ws(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new rN}send(i,o,u,f,d=!1,g){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[w]=u);const E=new Set;return this.target.postMessage({id:w,type:i,hasCallback:!!u,targetMapId:f,mustQueue:d,sourceMapId:this.mapId,data:Ya(o,E)},E),{cancel:()=>{u&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(i){const o=i.data;if(!o)return;const u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f.cancel()}else if(o.mustQueue||fr()){const f=this.callbacks[u],d=this.scheduler.add(()=>this.processTask(u,o),f&&f.metadata||{type:"message"});d&&(this.cancelCallbacks[u]=d)}else this.processTask(u,o)}processTask(i,o){if(delete this.cancelCallbacks[i],o.type==="<response>"){const u=this.callbacks[i];delete this.callbacks[i],u&&(o.error?u($r(o.error)):u(null,$r(o.data)))}else{const u=new Set,f=o.hasCallback?(g,w)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:g?Ya(g):null,data:Ya(w,u)},u)}:()=>{},d=$r(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,d,f);else if(this.parent.getWorkerSource){const g=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,g[0],d.source,d.scope)[g[1]](d,f)}else f(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var vg={workerUrl:"",workerClass:null,workerParams:void 0};const _w="mapboxgl_preloaded_worker_pool";class Oh{constructor(){this.active={}}acquire(i,o=Oh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<o;)this.workers.push(vg.workerClass!=null?new vg.workerClass:new self.Worker(vg.workerUrl,vg.workerParams));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_w]}numActive(){return Object.keys(this.active).length}}Oh.workerCount=2;class Pf{constructor(i,o,u="Worker",f=Oh.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=Kn();const d=this.workerPool.acquire(this.id,f);for(let g=0;g<d.length;g++){const w=new Pf.Actor(d[g],o,this.id);w.name=`${u} ${g}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,u){Xi(this.actors,(f,d)=>{f.send(i,o,d)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let xg,yw;function B0(){return xg||(xg=new Oh),xg}Pf.Actor=rI;const vw=new Qi(0,0,0);var xw=(c=>(c[c.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",c[c.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",c[c.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",c))(xw||{}),N0=(c=>(c[c.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",c[c.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",c[c.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",c[c.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",c))(N0||{}),bg=(c=>(c[c.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",c[c.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",c[c.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",c[c.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",c[c.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",c))(bg||{}),oI=(c=>(c[c.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",c[c.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",c[c.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",c))(oI||{}),Df=(c=>(c[c.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",c[c.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",c[c.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",c[c.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",c[c.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",c[c.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",c))(Df||{}),aI=(c=>(c[c.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",c[c.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",c[c.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",c))(aI||{});function oN(c,i,o){c===1&&i.icons.push(function(u,f){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:g}=d;if(g.content_area){const{content_area:w}=g;w.top==null&&(w.top=w.left),w.width==null&&(w.width=d.usvg_tree.width),w.height==null&&(w.height=w.width)}return g.stretch_x&&g.stretch_x.length&&lI(g,"x"),g.stretch_y&&g.stretch_y.length&&lI(g,"y"),d}(u.readFields(aN,{name:void 0},f))}(o,o.readVarint()+o.pos))}function lI(c,i){const o=[],u=c[`stretch_${i}`];let f=null;for(let d=0;d<u.length;d++)f===null?f=o.length===0?u[0]:o[o.length-1][1]+u[d]:(o.push([f,f+u[d]]),f=null);c[`stretch_${i}_areas`]=o}function aN(c,i,o){c===1?i.name=o.readString():c===2?i.metadata=function(u,f){return u.readFields(lN,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},f)}(o,o.readVarint()+o.pos):c===3&&(i.usvg_tree=function(u,f){return u.readFields(hN,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},f)}(o,o.readVarint()+o.pos),i.data="usvg_tree")}function lN(c,i,o){c===1?i.stretch_x=o.readPackedVarint():c===2?i.stretch_y=o.readPackedVarint():c===3?i.content_area=function(u,f){return u.readFields(cN,{left:0},f)}(o,o.readVarint()+o.pos):c===4&&i.variables.push(function(u,f){return u.readFields(uN,{name:void 0},f)}(o,o.readVarint()+o.pos))}function cN(c,i,o){c===1?i.left=o.readVarint():c===2?i.width=o.readVarint():c===3?i.top=o.readVarint():c===4&&(i.height=o.readVarint())}function uN(c,i,o){c===1?i.name=o.readString():c===2&&(i.rgb_color=j0(o.readVarint()),i.value="rgb_color")}function hN(c,i,o){c===1?i.width=i.height=o.readVarint():c===2?i.height=o.readVarint():c===3?i.children.push(V0(o,o.readVarint()+o.pos)):c===4?i.linear_gradients.push(function(u,f){return u.readFields(yN,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},f)}(o,o.readVarint()+o.pos)):c===5?i.radial_gradients.push(function(u,f){return u.readFields(xN,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},f)}(o,o.readVarint()+o.pos)):c===7?i.clip_paths.push(function(u,f){return u.readFields(bN,{children:[]},f)}(o,o.readVarint()+o.pos)):c===8&&i.masks.push(function(u,f){const d=u.readFields(wN,{left:0,width:20,mask_type:1,children:[]},f);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(o,o.readVarint()+o.pos))}function V0(c,i){return c.readFields(dN,{},i)}function dN(c,i,o){c===1?(i.group=function(u,f){return u.readFields(fN,{opacity:255,children:[]},f)}(o,o.readVarint()+o.pos),i.node="group"):c===2&&(i.path=function(u,f){return u.readFields(mN,{paint_order:1,commands:[],step:1,diffs:[],rule:1},f)}(o,o.readVarint()+o.pos),i.node="path")}function fN(c,i,o){c===1?i.transform=U0(o,o.readVarint()+o.pos):c===2?i.opacity=o.readVarint():c===5?i.clip_path_idx=o.readVarint():c===6?i.mask_idx=o.readVarint():c===7&&i.children.push(V0(o,o.readVarint()+o.pos))}function U0(c,i){return c.readFields(pN,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function pN(c,i,o){c===1?i.sx=o.readFloat():c===2?i.ky=o.readFloat():c===3?i.kx=o.readFloat():c===4?i.sy=o.readFloat():c===5?i.tx=o.readFloat():c===6&&(i.ty=o.readFloat())}function mN(c,i,o){c===1?i.fill=function(u,f){return u.readFields(gN,{rgb_color:vw,paint:"rgb_color",opacity:255},f)}(o,o.readVarint()+o.pos):c===2?i.stroke=function(u,f){return u.readFields(_N,{rgb_color:vw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},f)}(o,o.readVarint()+o.pos):c===3?i.paint_order=o.readVarint():c===5?o.readPackedVarint(i.commands):c===6?i.step=o.readFloat():c===7?o.readPackedSVarint(i.diffs):c===8&&(i.rule=o.readVarint())}function gN(c,i,o){c===1?(i.rgb_color=j0(o.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=o.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=o.readVarint(),i.paint="radial_gradient_idx"):c===5&&(i.opacity=o.readVarint())}function j0(c){return new Qi((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function _N(c,i,o){c===1?(i.rgb_color=j0(o.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=o.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=o.readVarint(),i.paint="radial_gradient_idx"):c===5?o.readPackedFloat(i.dasharray):c===6?i.dashoffset=o.readFloat():c===7?i.miterlimit=o.readFloat():c===8?i.opacity=o.readVarint():c===9?i.width=o.readFloat():c===10?i.linecap=o.readVarint():c===11&&(i.linejoin=o.readVarint())}function yN(c,i,o){c===1?i.transform=U0(o,o.readVarint()+o.pos):c===2?i.spread_method=o.readVarint():c===3?i.stops.push(cI(o,o.readVarint()+o.pos)):c===4?i.x1=o.readFloat():c===5?i.y1=o.readFloat():c===6?i.x2=o.readFloat():c===7&&(i.y2=o.readFloat())}function cI(c,i){return c.readFields(vN,{offset:0,opacity:255,rgb_color:vw},i)}function vN(c,i,o){c===1?i.offset=o.readFloat():c===2?i.opacity=o.readVarint():c===3&&(i.rgb_color=j0(o.readVarint()))}function xN(c,i,o){c===1?i.transform=U0(o,o.readVarint()+o.pos):c===2?i.spread_method=o.readVarint():c===3?i.stops.push(cI(o,o.readVarint()+o.pos)):c===4?i.cx=o.readFloat():c===5?i.cy=o.readFloat():c===6?i.r=o.readFloat():c===7?i.fx=o.readFloat():c===8?i.fy=o.readFloat():c===9&&(i.fr=o.readFloat())}function bN(c,i,o){c===1?i.transform=U0(o,o.readVarint()+o.pos):c===2?i.clip_path_idx=o.readVarint():c===3&&i.children.push(V0(o,o.readVarint()+o.pos))}function wN(c,i,o){c===1?i.left=i.top=o.readFloat():c===2?i.width=i.height=o.readFloat():c===3?i.top=o.readFloat():c===4?i.height=o.readFloat():c===5?i.mask_type=o.readVarint():c===6?i.mask_idx=o.readVarint():c===7&&i.children.push(V0(o,o.readVarint()+o.pos))}class TN{static calculate(i={},o=[]){const u=new Map,f=new Map;if(Object.keys(i).length===0)return u;o.forEach(d=>{f.set(d.name,d.rgb_color||new Qi(0,0,0))});for(const[d,g]of Object.entries(i))f.has(d)?u.set(f.get(d).toStringPremultipliedAlpha(),g):console.warn(`Ignoring unknown image variable "${d}"`);return u}}function Rf(c,i=255,o){const u=i/255,f=c.toStringPremultipliedAlpha(),d=o.has(f)?o.get(f).clone():c.clone();return d.a*=u,d.toString()}function wg(c,i){if(!rt()){const o=document.createElement("canvas");return o.width=c,o.height=i,o}return new OffscreenCanvas(c,i)}function EN(c,i){const o=TN.calculate(i.params,c.metadata?c.metadata.variables:[]),u=c.usvg_tree,f=u.width,d=u.height,g=i.transform?i.transform:new DOMMatrix,w=Math.max(1,Math.round(f*g.a)),E=Math.max(1,Math.round(d*g.d)),M=new DOMMatrix([w/f,0,0,E/d,0,0]),x=wg(w,E).getContext("2d");return bw(x,M,u,u,o),x.getImageData(0,0,w,E)}function bw(c,i,o,u,f){for(const d of u.children)uI(c,i,o,d,f)}function uI(c,i,o,u,f){u.group?(c.save(),function(d,g,w,E,M){const x=E.mask_idx!=null?w.masks[E.mask_idx]:null,S=E.clip_path_idx!=null?w.clip_paths[E.clip_path_idx]:null;if(E.transform&&(g=$0(E.transform).preMultiplySelf(g)),!function(C,R,B){return C.opacity!==255||R||B}(E,S!=null,x!=null))return void bw(d,g,w,E,M);const P=wg(d.canvas.width,d.canvas.height),A=P.getContext("2d");bw(A,g,w,E,M),S&&_I(A,g,w,S),x&&yI(A,g,w,x,M),d.globalAlpha=E.opacity/255,d.drawImage(P,0,0)}(c,i,o,u.group,f),c.restore()):u.path&&(c.save(),function(d,g,w,E,M){const x=vI(E);d.setTransform(g),E.paint_order===oI.PAINT_ORDER_FILL_AND_STROKE?(hI(d,w,E,x,M),fI(d,w,E,x,M)):(fI(d,w,E,x,M),hI(d,w,E,x,M))}(c,i,o,u.path,f),c.restore())}function hI(c,i,o,u,f){const d=o.fill;if(!d)return;const g=d.opacity/255;switch(d.paint){case"rgb_color":c.fillStyle=Rf(d.rgb_color,d.opacity,f);break;case"linear_gradient_idx":c.fillStyle=pI(c,i.linear_gradients[d.linear_gradient_idx],g,f);break;case"radial_gradient_idx":c.fillStyle=mI(c,i.radial_gradients[d.radial_gradient_idx],g,f)}c.fill(u,dI(o))}function dI(c){return c.rule===xw.PATH_RULE_NON_ZERO?"nonzero":c.rule===xw.PATH_RULE_EVEN_ODD?"evenodd":void 0}function fI(c,i,o,u,f){const d=o.stroke;if(!d)return;c.lineWidth=d.width,c.miterLimit=d.miterlimit,c.setLineDash(d.dasharray),c.lineDashOffset=d.dashoffset;const g=d.opacity/255;switch(d.paint){case"rgb_color":c.strokeStyle=Rf(d.rgb_color,d.opacity,f);break;case"linear_gradient_idx":c.strokeStyle=pI(c,i.linear_gradients[d.linear_gradient_idx],g,f);break;case"radial_gradient_idx":c.strokeStyle=mI(c,i.radial_gradients[d.radial_gradient_idx],g,f)}switch(d.linejoin){case bg.LINE_JOIN_MITER_CLIP:case bg.LINE_JOIN_MITER:c.lineJoin="miter";break;case bg.LINE_JOIN_ROUND:c.lineJoin="round";break;case bg.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(d.linecap){case N0.LINE_CAP_BUTT:c.lineCap="butt";break;case N0.LINE_CAP_ROUND:c.lineCap="round";break;case N0.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(u)}function pI(c,i,o,u){if(i.stops.length===1){const P=i.stops[0];return Rf(P.rgb_color,P.opacity*o,u)}const f=$0(i.transform),{x1:d,y1:g,x2:w,y2:E}=i,M=f.transformPoint(new DOMPoint(d,g)),x=f.transformPoint(new DOMPoint(w,E)),S=c.createLinearGradient(M.x,M.y,x.x,x.y);for(const P of i.stops)S.addColorStop(P.offset,Rf(P.rgb_color,P.opacity*o,u));return S}function mI(c,i,o,u){if(i.stops.length===1){const P=i.stops[0];return Rf(P.rgb_color,P.opacity*o,u)}const f=$0(i.transform),{fx:d,fy:g,cx:w,cy:E}=i,M=f.transformPoint(new DOMPoint(d,g)),x=f.transformPoint(new DOMPoint(w,E)),S=c.createRadialGradient(M.x,M.y,0,x.x,x.y,i.r*((f.a+f.d)/2));for(const P of i.stops)S.addColorStop(P.offset,Rf(P.rgb_color,P.opacity*o,u));return S}function gI(c,i,o,u){const f=u.transform?$0(u.transform).preMultiplySelf(i):i,d=wg(c.canvas.width,c.canvas.height),g=d.getContext("2d");for(const E of u.children)if(E.group)gI(g,f,o,E.group);else if(E.path){const M=E.path,x=new Path2D;x.addPath(vI(M),f),g.fill(x,dI(M))}const w=u.clip_path_idx!=null?o.clip_paths[u.clip_path_idx]:null;w&&_I(g,f,o,w),c.globalCompositeOperation="source-over",c.drawImage(d,0,0)}function _I(c,i,o,u){const f=wg(c.canvas.width,c.canvas.height);gI(f.getContext("2d"),i,o,u),c.globalCompositeOperation="destination-in",c.drawImage(f,0,0)}function yI(c,i,o,u,f){if(u.children.length===0)return;const d=u.mask_idx!=null?o.masks[u.mask_idx]:null;d&&yI(c,i,o,d,f);const g=c.canvas.width,w=c.canvas.height,E=wg(g,w),M=E.getContext("2d"),x=u.width,S=u.height,P=u.left,A=u.top,C=new Path2D,R=new Path2D;R.rect(P,A,x,S),C.addPath(R,i),M.clip(C);for(const G of u.children)uI(M,i,o,G,f);const B=M.getImageData(0,0,g,w),N=B.data;if(u.mask_type===aI.MASK_TYPE_LUMINANCE)for(let G=0;G<N.length;G+=4)N[G+3]=N[G+3]/255*(.2126*N[G]+.7152*N[G+1]+.0722*N[G+2]);M.putImageData(B,0,0),c.globalCompositeOperation="destination-in",c.drawImage(E,0,0)}function $0(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function vI(c){const i=new Path2D,o=c.step;let u=c.diffs[0]*o,f=c.diffs[1]*o;i.moveTo(u,f);for(let d=0,g=2;d<c.commands.length;d++)switch(c.commands[d]){case Df.PATH_COMMAND_MOVE:u+=c.diffs[g++]*o,f+=c.diffs[g++]*o,i.moveTo(u,f);break;case Df.PATH_COMMAND_LINE:u+=c.diffs[g++]*o,f+=c.diffs[g++]*o,i.lineTo(u,f);break;case Df.PATH_COMMAND_QUAD:{const w=u+c.diffs[g++]*o,E=f+c.diffs[g++]*o;u=w+c.diffs[g++]*o,f=E+c.diffs[g++]*o,i.quadraticCurveTo(w,E,u,f);break}case Df.PATH_COMMAND_CUBIC:{const w=u+c.diffs[g++]*o,E=f+c.diffs[g++]*o,M=w+c.diffs[g++]*o,x=E+c.diffs[g++]*o;u=M+c.diffs[g++]*o,f=x+c.diffs[g++]*o,i.bezierCurveTo(w,E,M,x,u,f);break}case Df.PATH_COMMAND_CLOSE:i.closePath()}return i}class H0{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const o=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,o),o}put(i,o){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,o)}delete(i){this.cache.delete(i)}}zt(H0,"LRUCache");class ww{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new $s(i,i.data)}getFromCache(i,o,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new H0(150)),this.cacheMap.get(u).get(jc(i.toString(),o))}setInCache(i,o,u,f){this.cacheDependenciesMap.has(f)||this.cacheDependenciesMap.set(f,new Map),this.cacheMap.has(f)||this.cacheMap.set(f,new H0(150));const d=this.cacheDependenciesMap.get(f),g=jc(i.id.toString(),u);d.get(g)||d.set(g,new Set);const w=this.cacheMap.get(f),E=i.toString();d.get(g).add(E),w.put(jc(i.toString(),u),o)}removeImagesFromCacheByIds(i,o,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const f=this.cacheMap.get(u),d=this.cacheDependenciesMap.get(u);for(const g of i){const w=jc(g.toString(),o);if(d.has(w)){for(const E of d.get(w))f.delete(E);d.delete(w)}}}rasterize(i,o,u,f,d=EN){const g=this.getFromCache(i,u,f);if(g)return g.clone();const w=d(o.icon,i.options),E=ww._getImage(w);return this.setInCache(i,E,u,f),E.clone()}}class xI{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,o){const u=this.toIdx(i,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(i,o){return this.leaves[this.toIdx(i,o)]}toIdx(i,o){return o*this.size+i}}function bI(c,i,o,u){let f=0,d=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(o[g]<c[g]||o[g]>i[g])return null}else{const w=1/u[g];let E=(c[g]-o[g])*w,M=(i[g]-o[g])*w;if(E>M){const x=E;E=M,M=x}if(E>f&&(f=E),M<d&&(d=M),f>d)return null}return f}function wI(c,i,o,u,f,d,g,w,E,M,x){const S=u-c,P=f-i,A=d-o,C=g-c,R=w-i,B=E-o,N=x[1]*B-x[2]*R,G=x[2]*C-x[0]*B,H=x[0]*R-x[1]*C,$=S*N+P*G+A*H;if(Math.abs($)<1e-15)return null;const W=1/$,K=M[0]-c,Q=M[1]-i,ue=M[2]-o,oe=(K*N+Q*G+ue*H)*W;if(oe<0||oe>1)return null;const ae=Q*A-ue*P,Ee=ue*S-K*A,he=K*P-Q*S,Se=(x[0]*ae+x[1]*Ee+x[2]*he)*W;return Se<0||oe+Se>1?null:(C*ae+R*Ee+B*he)*W}function TI(c,i,o){return(c-i)/(o-i)}function EI(c,i,o,u,f,d,g,w,E){const M=1<<o,x=d-u,S=g-f,P=(c+1)/M*x+u,A=(i+0)/M*S+f,C=(i+1)/M*S+f;w[0]=(c+0)/M*x+u,w[1]=A,E[0]=P,E[1]=C}class SI{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(d){const g=Math.ceil(Math.log2(d.dim/8)),w=[];let E=Math.ceil(Math.pow(2,g));const M=1/E,x=(A,C,R,B,N)=>{const G=B?1:0,H=(A+1)*R-G,$=C*R,W=(C+1)*R-G;N[0]=A*R,N[1]=$,N[2]=H,N[3]=W};let S=new xI(E);const P=[];for(let A=0;A<E*E;A++){x(A%E,Math.floor(A/E),M,!1,P);const C=nu(P[0],P[1],d),R=nu(P[2],P[1],d),B=nu(P[2],P[3],d),N=nu(P[0],P[3],d);S.minimums.push(Math.min(C,R,B,N)),S.maximums.push(Math.max(C,R,B,N)),S.leaves.push(1)}for(w.push(S),E/=2;E>=1;E/=2){const A=w[w.length-1];S=new xI(E);for(let C=0;C<E*E;C++){x(C%E,Math.floor(C/E),2,!0,P);const R=A.getElevation(P[0],P[1]),B=A.getElevation(P[2],P[1]),N=A.getElevation(P[2],P[3]),G=A.getElevation(P[0],P[3]),H=A.isLeaf(P[0],P[1]),$=A.isLeaf(P[2],P[1]),W=A.isLeaf(P[2],P[3]),K=A.isLeaf(P[0],P[3]),Q=Math.min(R.min,B.min,N.min,G.min),ue=Math.max(R.max,B.max,N.max,G.max),oe=H&&$&&W&&K;S.maximums.push(ue),S.minimums.push(Q),S.leaves.push(ue-Q<=5&&oe?1:0)}w.push(S)}return w}(this.dem),u=o.length-1,f=o[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(i,o,u,f,d,g,w=1){return bI([i,o,-100],[u,f,this.maximums[0]*w],d,g)}raycast(i,o,u,f,d,g,w=1){if(!this.nodeCount)return null;const E=this.raycastRoot(i,o,u,f,d,g,w);if(E==null)return null;const M=[],x=[],S=[],P=[],A=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;A.length>0;){const{idx:C,t:R,nodex:B,nodey:N,depth:G}=A.pop();if(this.leaves[C]){EI(B,N,G,i,o,u,f,S,P);const $=1<<G,W=(B+0)/$,K=(B+1)/$,Q=(N+0)/$,ue=(N+1)/$,oe=nu(W,Q,this.dem)*w,ae=nu(K,Q,this.dem)*w,Ee=nu(K,ue,this.dem)*w,he=nu(W,ue,this.dem)*w,Se=wI(S[0],S[1],oe,P[0],S[1],ae,P[0],P[1],Ee,d,g),Le=wI(P[0],P[1],Ee,S[0],P[1],he,S[0],S[1],oe,d,g),De=Math.min(Se!==null?Se:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(De!==Number.MAX_VALUE)return De;{const Fe=ce.vec3.scaleAndAdd([],d,g,R);if(AI(oe,ae,he,Ee,TI(Fe[0],S[0],P[0]),TI(Fe[1],S[1],P[1]))>=Fe[2])return R}continue}let H=0;for(let $=0;$<this._siblingOffset.length;$++){EI((B<<1)+this._siblingOffset[$][0],(N<<1)+this._siblingOffset[$][1],G+1,i,o,u,f,S,P),S[2]=-100,P[2]=this.maximums[this.childOffsets[C]+$]*w;const W=bI(S,P,d,g);if(W!=null){const K=W;M[$]=K;let Q=!1;for(let ue=0;ue<H&&!Q;ue++)K>=M[x[ue]]&&(x.splice(ue,0,$),Q=!0);Q||(x[H]=$),H++}}for(let $=0;$<H;$++){const W=x[$];A.push({idx:this.childOffsets[C]+W,t:M[W],nodex:(B<<1)+this._siblingOffset[W][0],nodey:(N<<1)+this._siblingOffset[W][1],depth:G+1})}}return null}_addNode(i,o,u){return this.minimums.push(i),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(i,o,u,f,d){if(i[f].isLeaf(o,u)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const g=f-1,w=i[g];let E=0,M=0;for(let x=0;x<this._siblingOffset.length;x++){const S=2*o+this._siblingOffset[x][0],P=2*u+this._siblingOffset[x][1],A=w.getElevation(S,P),C=w.isLeaf(S,P),R=this._addNode(A.min,A.max,C);C&&(E|=1<<x),M||(M=R)}for(let x=0;x<this._siblingOffset.length;x++)E&1<<x||this._construct(i,2*o+this._siblingOffset[x][0],2*u+this._siblingOffset[x][1],g,M+x)}}function AI(c,i,o,u,f,d){return ni(ni(c,o,d),ni(i,u,d),f)}function nu(c,i,o){const u=o.dim,f=At(c*u-.5,0,u-1),d=At(i*u-.5,0,u-1),g=Math.floor(f),w=Math.floor(d),E=Math.min(g+1,u-1),M=Math.min(w+1,u-1);return AI(o.get(g,w),o.get(E,w),o.get(g,M),o.get(E,M),f-g,d-w)}const SN={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function AN(c,i,o){return(256*c*256+256*i+o)/10-1e4}function MN(c,i,o){return 256*c+i+o/256-32768}class G0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,o,u,f=!1){if(this.uid=i,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void on(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const d=this.dim=o.height-2,g=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let E=0;E<d;E++)g[this._idx(-1,E)]=g[this._idx(0,E)],g[this._idx(d,E)]=g[this._idx(d-1,E)],g[this._idx(E,-1)]=g[this._idx(E,0)],g[this._idx(E,d)]=g[this._idx(E,d-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(d,-1)]=g[this._idx(d-1,0)],g[this._idx(-1,d)]=g[this._idx(0,d-1)],g[this._idx(d,d)]=g[this._idx(d-1,d-1)]}const w=u==="terrarium"?MN:AN;for(let E=0;E<g.length;++E){const M=4*E;this.floatView[E]=w(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}this._timestamp=it.now()}_buildQuadTree(){this._tree=new SI(this)}get(i,o,u=!1){u&&(i=At(i,-1,this.dim),o=At(o,-1,this.dim));const f=this._idx(i,o);return this.floatView[f]}set(i,o,u){const f=this._idx(i,o),d=this.floatView[f];return this.floatView[f]=u,u-d}static getUnpackVector(i){return SN[i]}_idx(i,o){if(i<-1||i>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(i+1)}static pack(i,o){const u=[0,0,0,0],f=G0.getUnpackVector(o);let d=Math.floor((i+f[3])/f[2]);return u[2]=d%256,d=Math.floor(d/256),u[1]=d%256,d=Math.floor(d/256),u[0]=d,u}getPixels(){return new k2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,o,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let f=o*this.dim,d=o*this.dim+this.dim,g=u*this.dim,w=u*this.dim+this.dim;switch(o){case-1:f=d-1;break;case 1:d=f+1}switch(u){case-1:g=w-1;break;case 1:w=g+1}const E=-o*this.dim,M=-u*this.dim;for(let x=g;x<w;x++)for(let S=f;S<d;S++){const P=4*this._idx(S,x),A=4*this._idx(S+E,x+M);this.pixels[P+0]=i.pixels[A+0],this.pixels[P+1]=i.pixels[A+1],this.pixels[P+2]=i.pixels[A+2],this.pixels[P+3]=i.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function IN(c,i,o){c===1?i.headerLength=o.readFixed32():c===2?i.x=o.readVarint():c===3?i.y=o.readVarint():c===4?i.z=o.readVarint():c===5&&i.layers.push(function(u,f){return u.readFields(LN,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(o,o.readVarint()+o.pos))}function CN(c,i,o){c===1?(i.delta_filter=function(u,f){return u.readFields(PN,{blockSize:0},f)}(o,o.readVarint()+o.pos),i.filter="delta_filter"):c===2?(o.readVarint(),i.filter="zigzag_filter"):c===3?(o.readVarint(),i.filter="bitshuffle_filter"):c===4&&(o.readVarint(),i.filter="byteshuffle_filter")}function PN(c,i,o){c===1&&(i.blockSize=o.readVarint())}function DN(c,i,o){c===1?(o.readVarint(),i.codec="gzip_data"):c===2?(o.readVarint(),i.codec="jpeg_image"):c===3?(o.readVarint(),i.codec="webp_image"):c===4&&(o.readVarint(),i.codec="png_image")}function RN(c,i,o){let u=0,f=0;c===1?i.firstByte=o.readFixed64():c===2?i.lastByte=o.readFixed64():c===3?i.filters.push(function(d,g){return d.readFields(CN,{},g)}(o,o.readVarint()+o.pos)):c===4?i.codec=function(d,g){return d.readFields(DN,{},g)}(o,o.readVarint()+o.pos):c===5?f=o.readFloat():c===6?u=o.readFloat():c===7?i.bands.push(o.readString()):c===8?i.offset=o.readDouble():c===9&&(i.scale=o.readDouble()),i.offset===0&&(i.offset=f),i.scale===0&&(i.scale=u)}function LN(c,i,o){c===1?i.version=o.readVarint():c===2?i.name=o.readString():c===3?i.units=o.readString():c===4?i.tileSize=o.readVarint():c===5?i.buffer=o.readVarint():c===6?i.pixelFormat=o.readVarint():c===7&&i.dataIndex.push(function(u,f){return u.readFields(RN,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(o,o.readVarint()+o.pos))}function ON(c,i,o){if(c===2)(function(u,f,d){u.readFields(kN,d,f)})(o,o.readVarint()+o.pos,i);else if(c===3)throw new Error("Not implemented")}function kN(c,i,o){if(c===1){let u=0;const f=o.readVarint()+o.pos;for(;o.pos<f;)i[u++]=o.readVarint()}}function zN(c,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let o=i[3];for(let u=2;u>=1;u--){const f=u===1?1:0,d=u===2?1:0;for(let g=0;g<i[0];g++){const w=i[1]*g;for(let E=f;E<i[1];E++){const M=i[2]*(E+w);for(let x=d;x<i[2];x++){const S=i[3]*(x+M);for(let P=0;P<i[3];P++){const A=S+P;c[A]+=c[A-o]}}}}o*=i[u]}return c}function FN(c){for(let i=0,o=c.length;i<o;i++)c[i]=c[i]>>>1^-(1&c[i]);return c}function BN(c,i){switch(i){case"uint32":return c;case"uint16":for(let o=0;o<c.length;o+=2){const u=c[o],f=c[o+1];c[o]=(240&u)>>4|(61440&u)>>8|(240&f)<<4|61440&f,c[o+1]=15&u|(3840&u)>>4|(15&f)<<8|(3840&f)<<4}return c;case"uint8":for(let o=0;o<c.length;o+=4){const u=c[o],f=c[o+1],d=c[o+2],g=c[o+3];c[o+0]=(192&u)>>6|(192&f)>>4|(192&d)>>2|192&g,c[o+1]=(48&u)>>4|(48&f)>>2|48&d|(48&g)<<2,c[o+2]=(12&u)>>2|12&f|(12&d)<<2|(12&g)<<4,c[o+3]=3&u|(3&f)<<2|(3&d)<<4|(3&g)<<6}return c;default:throw new Error(`Invalid pixel format, "${i}"`)}}zt(G0,"DEMData"),zt(SI,"DemMinMaxQuadTree",{omit:["dem"]});var Io=Uint8Array,Tg=Uint16Array,NN=Int32Array,MI=new Io([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),II=new Io([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),VN=new Io([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),CI=function(c,i){for(var o=new Tg(31),u=0;u<31;++u)o[u]=i+=1<<c[u-1];var f=new NN(o[30]);for(u=1;u<30;++u)for(var d=o[u];d<o[u+1];++d)f[d]=d-o[u]<<5|u;return{b:o,r:f}},PI=CI(MI,2),DI=PI.b,UN=PI.r;DI[28]=258,UN[258]=28;for(var jN=CI(II,0).b,RI=new Tg(32768),ss=0;ss<32768;++ss){var Lf=(43690&ss)>>1|(21845&ss)<<1;RI[ss]=((65280&(Lf=(61680&(Lf=(52428&Lf)>>2|(13107&Lf)<<2))>>4|(3855&Lf)<<4))>>8|(255&Lf)<<8)>>1}var Eg=function(c,i,o){for(var u=c.length,f=0,d=new Tg(i);f<u;++f)c[f]&&++d[c[f]-1];var g,w=new Tg(i);for(f=1;f<i;++f)w[f]=w[f-1]+d[f-1]<<1;g=new Tg(1<<i);var E=15-i;for(f=0;f<u;++f)if(c[f])for(var M=f<<4|c[f],x=i-c[f],S=w[c[f]-1]++<<x,P=S|(1<<x)-1;S<=P;++S)g[RI[S]>>E]=M;return g},Sg=new Io(288);for(ss=0;ss<144;++ss)Sg[ss]=8;for(ss=144;ss<256;++ss)Sg[ss]=9;for(ss=256;ss<280;++ss)Sg[ss]=7;for(ss=280;ss<288;++ss)Sg[ss]=8;var LI=new Io(32);for(ss=0;ss<32;++ss)LI[ss]=5;var $N=Eg(Sg,9),HN=Eg(LI,5),Tw=function(c){for(var i=c[0],o=1;o<c.length;++o)c[o]>i&&(i=c[o]);return i},Pa=function(c,i,o){var u=i/8|0;return(c[u]|c[u+1]<<8)>>(7&i)&o},Ew=function(c,i){var o=i/8|0;return(c[o]|c[o+1]<<8|c[o+2]<<16)>>(7&i)},GN=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Da=function(c,i,o){var u=new Error(i||GN[c]);if(u.code=c,Error.captureStackTrace&&Error.captureStackTrace(u,Da),!o)throw u;return u},qN=new Io(0),WN=typeof TextDecoder<"u"&&new TextDecoder;try{WN.decode(qN,{stream:!0})}catch{}const ZN={gzip_data:"gzip"};class Ko extends Error{constructor(i){super(i),this.name="MRTError"}}const XN={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},OI={uint32:1,uint16:2,uint8:4},YN={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Sw;class q0{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const o=this.layers[i];if(!o)throw new Ko(`Layer '${i}' not found`);return o}getHeaderLength(i){const o=new Uint8Array(i),u=new DataView(i);if(o[0]!==13)throw new Ko("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(i){const o=new Uint8Array(i),u=this.getHeaderLength(i);if(o.length<u)throw new Ko(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const f=function(d,g){return d.readFields(IN,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Sw(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new Ko(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const d of f.layers)this.layers[d.name]=new kI(d,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const o=[],u=this.getLayer(i.layerName);for(let f of i.blockIndices){const d=u.dataIndex[f],g=d.firstByte-i.firstByte,w=d.lastByte-i.firstByte;if(u._blocksInProgress.has(f))continue;const E={layerName:u.name,firstByte:g,lastByte:w,pixelFormat:u.pixelFormat,blockIndex:f,blockShape:[d.bands.length].concat(u.bandShape),buffer:u.buffer,codec:d.codec.codec,filters:d.filters.map(M=>M.filter)};u._blocksInProgress.add(f),o.push(E)}return new zI(o,()=>{o.forEach(f=>u._blocksInProgress.delete(f.blockIndex))},(f,d)=>{if(o.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),f)throw f;d.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class kI{constructor({version:i,name:o,units:u,tileSize:f,pixelFormat:d,buffer:g,dataIndex:w},E){if(this.version=i,this.version!==1)throw new Ko(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=o,this.units=u,this.tileSize=f,this.buffer=g,this.pixelFormat=XN[d],this.dataIndex=w,this.bandShape=[f+2*g,f+2*g,OI[this.pixelFormat]],this._decodedBlocks=new H0(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return OI[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const o=i.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,i.data)}getBlockForBand(i){let o=0;switch(typeof i){case"string":for(const[u,f]of this.dataIndex.entries()){for(const[d,g]of f.bands.entries())if(g===i)return{bandIndex:o+d,blockIndex:u,blockBandIndex:d};o+=f.bands.length}break;case"number":for(const[u,f]of this.dataIndex.entries()){if(i>=o&&i<o+f.bands.length)return{bandIndex:i,blockIndex:u,blockBandIndex:i-o};o+=f.bands.length}break;default:throw new Ko(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}throw new Ko(`Band not found: ${JSON.stringify(i)}`)}getDataRange(i){let o=1/0,u=-1/0;const f=[],d=new Set;for(const g of i){const{blockIndex:w}=this.getBlockForBand(g);if(w<0)throw new Ko(`Invalid band: ${JSON.stringify(g)}`);const E=this.dataIndex[w];f.includes(w)||f.push(w),d.add(w),o=Math.min(o,E.firstByte),u=Math.max(u,E.lastByte)}if(d.size>this.cacheSize)throw new Ko(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:f}}hasBand(i){const{blockIndex:o}=this.getBlockForBand(i);return o>=0}hasDataForBand(i){const{blockIndex:o}=this.getBlockForBand(i);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(i){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(i),f=this._decodedBlocks.get(o.toString());if(!f)throw new Ko(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[o],g=this.bandShape.reduce((M,x)=>M*x,1),w=u*g,E=f.subarray(w,w+g);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}q0.setPbf=function(c){Sw=c};class zI{constructor(i,o,u){this.tasks=i,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,o){this._finalized||(this._onComplete(i,o),this._finalized=!0)}}q0.performDecoding=function(c,i){const o=new Uint8Array(c);return Promise.all(i.tasks.map(u=>{const{layerName:f,firstByte:d,lastByte:g,pixelFormat:w,blockShape:E,blockIndex:M,filters:x,codec:S}=u,P=o.subarray(d,g+1),A=new Uint32Array(E[0]*E[1]*E[2]);let C;if(S!=="gzip_data")throw new Ko(`Unhandled codec: ${S}`);return C=function(R,B){if(!globalThis.DecompressionStream&&B==="gzip_data")return Promise.resolve((($=function(Q){Q[0]==31&&Q[1]==139&&Q[2]==8||Da(6,"invalid gzip data");var ue=Q[3],oe=10;4&ue&&(oe+=2+(Q[10]|Q[11]<<8));for(var ae=(ue>>3&1)+(ue>>4&1);ae>0;ae-=!Q[oe++]);return oe+(2&ue)}(H=R))+8>H.length&&Da(6,"invalid gzip data"),function(Q,ue,oe,ae){var Ee=Q.length;if(!Ee||ue.f&&!ue.l)return oe||new Io(0);var he=!oe,Se=he||ue.i!=2,Le=ue.i;he&&(oe=new Io(3*Ee));var De,Fe,ke=function(ru){var ou=oe.length;if(ru>ou){var zh=new Io(Math.max(2*ou,ru));zh.set(oe),oe=zh}},He=ue.f||0,Ve=ue.p||0,qe=ue.b||0,pt=ue.l,dt=ue.d,Ft=ue.m,_t=ue.n,Et=8*Ee;do{if(!pt){He=Pa(Q,Ve,1);var mt=Pa(Q,Ve+1,3);if(Ve+=3,!mt){var ei=Q[(ui=4+((Ve+7)/8|0))-4]|Q[ui-3]<<8,Lt=ui+ei;if(Lt>Ee){Le&&Da(0);break}Se&&ke(qe+ei),oe.set(Q.subarray(ui,Lt),qe),ue.b=qe+=ei,ue.p=Ve=8*Lt,ue.f=He;continue}if(mt==1)pt=$N,dt=HN,Ft=9,_t=5;else if(mt==2){var jt=Pa(Q,Ve,31)+257,ai=Pa(Q,Ve+10,15)+4,wi=jt+Pa(Q,Ve+5,31)+1;Ve+=14;for(var di=new Io(wi),Ii=new Io(19),bi=0;bi<ai;++bi)Ii[VN[bi]]=Pa(Q,Ve+3*bi,7);Ve+=3*ai;var Pi=Tw(Ii),Ui=(1<<Pi)-1,pn=Eg(Ii,Pi);for(bi=0;bi<wi;){var ui,Oi=pn[Pa(Q,Ve,Ui)];if(Ve+=15&Oi,(ui=Oi>>4)<16)di[bi++]=ui;else{var En=0,Rn=0;for(ui==16?(Rn=3+Pa(Q,Ve,3),Ve+=2,En=di[bi-1]):ui==17?(Rn=3+Pa(Q,Ve,7),Ve+=3):ui==18&&(Rn=11+Pa(Q,Ve,127),Ve+=7);Rn--;)di[bi++]=En}}var zn=di.subarray(0,jt),Vn=di.subarray(jt);Ft=Tw(zn),_t=Tw(Vn),pt=Eg(zn,Ft),dt=Eg(Vn,_t)}else Da(1);if(Ve>Et){Le&&Da(0);break}}Se&&ke(qe+131072);for(var dn=(1<<Ft)-1,ws=(1<<_t)-1,_r=Ve;;_r=Ve){var Qn=(En=pt[Ew(Q,Ve)&dn])>>4;if((Ve+=15&En)>Et){Le&&Da(0);break}if(En||Da(2),Qn<256)oe[qe++]=Qn;else{if(Qn==256){_r=Ve,pt=null;break}var rs=Qn-254;Qn>264&&(rs=Pa(Q,Ve,(1<<(Co=MI[bi=Qn-257]))-1)+DI[bi],Ve+=Co);var Qs=dt[Ew(Q,Ve)&ws],ks=Qs>>4;if(Qs||Da(3),Ve+=15&Qs,Vn=jN[ks],ks>3){var Co=II[ks];Vn+=Ew(Q,Ve)&(1<<Co)-1,Ve+=Co}if(Ve>Et){Le&&Da(0);break}Se&&ke(qe+131072);var su=qe+rs;if(qe<Vn){var Jo=0-Vn,La=Math.min(Vn,su);for(Jo+qe<0&&Da(3);qe<La;++qe)oe[qe]=(void 0)[Jo+qe]}for(;qe<su;++qe)oe[qe]=oe[qe-Vn]}}ue.l=pt,ue.p=_r,ue.b=qe,ue.f=He,pt&&(He=1,ue.m=Ft,ue.d=dt,ue.n=_t)}while(!He);return qe!=oe.length&&he?(De=oe,((Fe=qe)==null||Fe>De.length)&&(Fe=De.length),new Io(De.subarray(0,Fe))):oe.subarray(0,qe)}(H.subarray($,-8),{i:2},new Io(((N=H)[(G=N.length)-4]|N[G-3]<<8|N[G-2]<<16|N[G-1]<<24)>>>0))));var N,G,H,$;const W=ZN[B];if(!W)throw new Error(`Unhandled codec: ${B}`);const K=new globalThis.DecompressionStream(W);return new Response(new Blob([R]).stream().pipeThrough(K)).arrayBuffer().then(Q=>new Uint8Array(Q))}(P,S).then(R=>(function(B,N){B.readFields(ON,N)}(new Sw(R),A),new YN[w](A.buffer))),C.then(R=>{for(let B=x.length-1;B>=0;B--)switch(x[B]){case"delta_filter":zN(R,E);break;case"zigzag_filter":FN(R);break;case"bitshuffle_filter":BN(R,w);break;default:throw new Ko(`Unhandled filter "${x[B]}"`)}return{layerName:f,blockIndex:M,data:R}}).catch(R=>{throw R})}))},zt(zI,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),zt(q0,"MapboxRasterTile"),zt(kI,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Ag,Aw,Ra,Of,Mw,kf=null;function FI(){return fr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Aw||te.DRACO_URL}function BI(){if(fr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Of)return Of;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Of=WebAssembly.validate(c)?te.MESHOPT_SIMD_URL:te.MESHOPT_URL,Of}const W0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},KN={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Mg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function NI(c,i,o){const u=o.json.bufferViews.length,f=o.buffers.length;i.bufferView=u,o.json.bufferViews[u]={buffer:f,byteLength:c.byteLength},o.buffers[f]=c}const Iw="KHR_draco_mesh_compression";function JN(c,i){const o=c.extensions&&c.extensions[Iw];if(!o)return;const u=new Ra.Decoder,f=$I(i,o.bufferView),d=new Ra.Mesh;if(!u.DecodeArrayToMesh(f,f.byteLength,d))throw new Error("Failed to decode Draco mesh");const g=i.json.accessors[c.indices],w=W0[g.componentType],E=g.count*w.BYTES_PER_ELEMENT,M=Ra._malloc(E);w===Uint16Array?u.GetTrianglesUInt16Array(d,E,M):u.GetTrianglesUInt32Array(d,E,M),NI(Ra.memory.buffer.slice(M,M+E),g,i),Ra._free(M);for(const x of Object.keys(o.attributes)){const S=u.GetAttributeByUniqueId(d,o.attributes[x]),P=i.json.accessors[c.attributes[x]],A=KN[P.componentType],C=P.count*Mg[P.type]*W0[P.componentType].BYTES_PER_ELEMENT,R=Ra._malloc(C);u.GetAttributeDataArrayForAllPoints(d,S,Ra[A],C,R),NI(Ra.memory.buffer.slice(R,R+C),P,i),Ra._free(R)}u.destroy(),d.destroy(),delete c.extensions[Iw]}const Z0="EXT_meshopt_compression";function QN(c,i){if(!c.extensions||!c.extensions[Z0])return;const o=c.extensions[Z0],u=new Uint8Array(i.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),f=new Uint8Array(o.count*o.byteStride);Mw.decodeGltfBuffer(f,o.count,o.byteStride,u,o.mode,o.filter),c.buffer=i.buffers.length,c.byteOffset=0,i.buffers[c.buffer]=f.buffer,delete c.extensions[Z0]}const VI=1179937895,UI=new TextDecoder("utf8");function jI(c,i){return new URL(c,i).href}function e4(c,i,o,u){return fetch(jI(c.uri,u)).then(f=>f.arrayBuffer()).then(f=>{i.buffers[o]=f})}function $I(c,i){const o=c.json.bufferViews[i];return new Uint8Array(c.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function t4(c,i,o,u){if(c.uri){const f=jI(c.uri,u);return fetch(f).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{i.images[o]=d})}if(c.bufferView!==void 0){const f=$I(i,c.bufferView),d=new Blob([f],{type:c.mimeType});return createImageBitmap(d).then(g=>{i.images[o]=g})}}function HI(c,i=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(c,i,1)[0]===VI){const x=new Uint32Array(c,i);let S=2;const P=(x[S++]>>2)-3,A=x[S++]>>2;if(S++,u.json=JSON.parse(UI.decode(x.subarray(S,S+A))),S+=A,S<P){const C=x[S++];S++;const R=i+(S<<2);u.buffers[0]=c.slice(R,R+C)}}else u.json=JSON.parse(UI.decode(new Uint8Array(c,i)));const{buffers:f,images:d,meshes:g,extensionsUsed:w,bufferViews:E}=u.json;let M=Promise.resolve();if(f){const x=[];for(let S=0;S<f.length;S++){const P=f[S];P.uri?x.push(e4(P,u,S,o)):u.buffers[S]||(u.buffers[S]=null)}M=Promise.all(x)}return M.then(()=>{const x=[],S=w&&w.includes(Iw),P=w&&w.includes(Z0);if(S&&x.push(function(){if(!Ra)return Ag??(Ag=function(A){let C,R=null;function B(){C=new Uint8Array(R.buffer)}function N(){throw new Error("Unexpected Draco error.")}const G={a:{a:N,d:function(H,$,W){return C.copyWithin(H,$,$+W)},c:function(H){const $=C.length,W=Math.max(H>>>0,Math.ceil(1.2*$)),K=Math.ceil((W-$)/65536);try{return R.grow(K),B(),!0}catch{return!1}},b:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,G):A.then(H=>H.arrayBuffer()).then(H=>WebAssembly.instantiate(H,G))).then(H=>{const{Rb:$,Qb:W,P:K,T:Q,X:ue,Ja:oe,La:ae,Qa:Ee,Va:he,Wa:Se,eb:Le,jb:De,f:Fe,e:ke,yb:He,zb:Ve,Ab:qe,Bb:pt,Db:dt,Gb:Ft}=H.instance.exports;R=ke;const _t=(()=>{let Et=0,mt=0,ei=0,Lt=0;return jt=>{ei&&($(Lt),$(Et),mt+=ei,ei=Et=0),Et||(mt+=128,Et=W(mt));const ai=jt.length+7&-8;let wi=Et;ai>=mt&&(ei=ai,wi=Lt=W(ai));for(let di=0;di<jt.length;di++)C[wi+di]=jt[di];return wi}})();return B(),Fe(),{memory:ke,_free:$,_malloc:W,Mesh:class{constructor(){this.ptr=K()}destroy(){Q(this.ptr)}},Decoder:class{constructor(){this.ptr=oe()}destroy(){De(this.ptr)}DecodeArrayToMesh(Et,mt,ei){const Lt=_t(Et),jt=ae(this.ptr,Lt,mt,ei.ptr);return!!ue(jt)}GetAttributeByUniqueId(Et,mt){return{ptr:Ee(this.ptr,Et.ptr,mt)}}GetTrianglesUInt16Array(Et,mt,ei){he(this.ptr,Et.ptr,mt,ei)}GetTrianglesUInt32Array(Et,mt,ei){Se(this.ptr,Et.ptr,mt,ei)}GetAttributeDataArrayForAllPoints(Et,mt,ei,Lt,jt){Le(this.ptr,Et.ptr,mt.ptr,ei,Lt,jt)}},DT_INT8:He(),DT_UINT8:Ve(),DT_INT16:qe(),DT_UINT16:pt(),DT_UINT32:dt(),DT_FLOAT32:Ft()}})}(fetch(FI())),Ag.then(A=>{Ra=A,Ag=void 0}))}()),P&&x.push(function(){if(Mw)return;const A=function(C){let R;const B=WebAssembly.instantiateStreaming(C,{}).then(H=>{R=H.instance,R.exports.__wasm_call_ctors()}),N={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},G={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(H,$,W,K,Q,ue){(function(oe,ae,Ee,he,Se,Le,De){const Fe=oe.exports.sbrk,ke=he+3&-4,He=Fe(ke*Se),Ve=Fe(Le.length),qe=new Uint8Array(oe.exports.memory.buffer);qe.set(Le,Ve);const pt=ae(He,he,Se,Ve,Le.length);if(pt===0&&De&&De(He,ke,Se),Ee.set(qe.subarray(He,He+he*Se)),Fe(He-Fe(0)),pt!==0)throw new Error(`Malformed buffer data: ${pt}`)})(R,R.exports[G[Q]],H,$,W,K,R.exports[N[ue]])}}}(fetch(BI()));return A.ready.then(()=>{Mw=A})}()),d)for(let A=0;A<d.length;A++)x.push(t4(d[A],u,A,o));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(S&&g)for(const{primitives:A}of g)for(const C of A)JN(C,u);if(P&&g&&E)for(const A of E)QN(A,u);return u})})}function kh(c,i){const o=c.json.bufferViews[i.bufferView],u=W0[i.componentType];return new u(c.buffers[o.buffer],(i.byteOffset||0)+(o.byteOffset||0),i.count*(o.byteStride&&o.byteStride!==Mg[i.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:Mg[i.type]))}function Cw(c,i,o,u){const f=W0[i.componentType],d=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),g=c.json.bufferViews[i.bufferView],w=g.byteStride?g.byteStride/f.BYTES_PER_ELEMENT:Mg[i.type],E=o.float32,M=E.length/o.capacity;for(let x=0,S=0;x<i.count*w;x+=w,S+=M)for(let P=0;P<M;P++)E[S+P]=u[x+P]*d;o._trim()}function i4(c,i,o){const u=c.indices,f=c.attributes,d={};d.indexArray=new Rs;const g=i.json.accessors[u],w=g.count/3;d.indexArray.reserve(w);const E=kh(i,g);for(let P=0;P<w;P++)d.indexArray.emplaceBack(E[3*P],E[3*P+1],E[3*P+2]);d.indexArray._trim(),d.vertexArray=new Ao;const M=i.json.accessors[f.POSITION];d.vertexArray.reserve(M.count);const x=kh(i,M);for(let P=0;P<M.count;P++)d.vertexArray.emplaceBack(x[3*P],x[3*P+1],x[3*P+2]);if(d.vertexArray._trim(),d.aabb=new Ht(M.min,M.max),d.centroid=function(P,A){const C=[0,0,0],R=P.length;if(R>0){for(let B=0;B<R;B++){const N=3*P[B];C[0]+=A[N],C[1]+=A[N+1],C[2]+=A[N+2]}C[0]/=R,C[1]/=R,C[2]/=R}return C}(E,x),f.COLOR_0!==void 0){const P=i.json.accessors[f.COLOR_0],A=Mg[P.type],C=kh(i,P);d.colorArray=A===3?new Ao:new Pl,d.colorArray.resize(P.count),Cw(i,P,d.colorArray,C)}if(f.NORMAL!==void 0){d.normalArray=new Ao;const P=i.json.accessors[f.NORMAL];d.normalArray.resize(P.count);const A=kh(i,P);Cw(i,P,d.normalArray,A)}if(f.TEXCOORD_0!==void 0&&o.length>0){d.texcoordArray=new Hc;const P=i.json.accessors[f.TEXCOORD_0];d.texcoordArray.resize(P.count);const A=kh(i,P);Cw(i,P,d.texcoordArray,A)}if(f._FEATURE_ID_RGBA4444!==void 0){const P=i.json.accessors[f._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=kh(i,P))}f._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(kh(i,i.json.accessors[f._FEATURE_RGBA4444]).buffer));const S=c.material;return d.material=function(P,A){const{emissiveFactor:C=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:B=.5,normalTexture:N,occlusionTexture:G,emissiveTexture:H,doubleSided:$}=P,{baseColorFactor:W=[1,1,1,1],metallicFactor:K=1,roughnessFactor:Q=1,baseColorTexture:ue,metallicRoughnessTexture:oe}=P.pbrMetallicRoughness||{},ae=G?A[G.index]:void 0;if(G&&G.extensions&&G.extensions.KHR_texture_transform&&ae){const Ee=G.extensions.KHR_texture_transform;ae.offsetScale=[Ee.offset[0],Ee.offset[1],Ee.scale[0],Ee.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Qi(...W),metallicFactor:K,roughnessFactor:Q,baseColorTexture:ue?A[ue.index]:void 0,metallicRoughnessTexture:oe?A[oe.index]:void 0},doubleSided:$,emissiveFactor:C,alphaMode:R,alphaCutoff:B,normalTexture:N?A[N.index]:void 0,occlusionTexture:ae,emissionTexture:H?A[H.index]:void 0,defined:P.defined===void 0}}(S!==void 0?i.json.materials[S]:{defined:!1},o),d}function GI(c,i,o){const{matrix:u,rotation:f,translation:d,scale:g,mesh:w,extras:E,children:M}=c,x={};if(x.matrix=u||ce.mat4.fromRotationTranslationScale([],f||[0,0,0,1],d||[0,0,0],g||[1,1,1]),w!==void 0){x.meshes=o[w];const S=x.anchor=[0,0];for(const P of x.meshes){const{min:A,max:C}=P.aabb;S[0]+=A[0]+C[0],S[1]+=A[1]+C[1]}S[0]=Math.floor(S[0]/x.meshes.length/2),S[1]=Math.floor(S[1]/x.meshes.length/2)}if(E&&(E.id&&(x.id=E.id),E.lights&&(x.lights=function(S){if(!S.length)return[];const P=function(N){const G=atob(N),H=new Uint8Array(G.length);for(let $=0;$<G.length;$++)H[$]=G.codePointAt($);return H}(S),A=[],C=P.length/24,R=new Uint16Array(P.buffer),B=new Float32Array(P.buffer);for(let N=0;N<C;N++){const G=R[2*N*6]/30,H=R[2*N*6+1]/30,$=R[2*N*6+10]/100,W=B[6*N+1],K=B[6*N+2],Q=B[6*N+3],ue=B[6*N+4],oe=Q-W,ae=ue-K,Ee=Math.hypot(oe,ae);A.push({pos:[W+.5*oe,K+.5*ae,H],normal:[ae/Ee,-oe/Ee,0],width:Ee,height:G,depth:$,points:[W,K,Q,ue]})}return A}(E.lights))),M){const S=[];for(const P of M)S.push(GI(i.json.nodes[P],i,o));x.children=S}return x}function n4(c){if(c.vertices.length===0||c.indices.length===0)return null;const i=new zb(c.vertices,c.indices,8,256),[o,u]=[i.min.clone(),i.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:i,min:o,max:u}}function s4(c){if(!c.extras||!c.extras.ground)return null;const i=c.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const o=i[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const g of o){if(!Array.isArray(g)||g.length!==2)continue;const w=g[0],E=g[1];typeof w=="number"&&typeof E=="number"&&u.push(new Ie(w,E))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let f=0;for(let g=0;g<u.length;g++){const w=u[g],E=u[(g+1)%u.length],M=u[(g+2)%u.length];f+=(w.x-E.x)*(M.y-E.y)-(M.x-E.x)*(w.y-E.y)}f>0&&u.reverse();const d=Jm(u.flatMap(g=>[g.x,g.y]),[]);return d.length===0?null:{vertices:u,indices:d}}function r4(c,i){const o=[],u=[];let f=0;const d=[];for(const g of c){f=o.length;const w=g.vertexArray.float32,E=g.indexArray.uint16;for(let M=0;M<g.vertexArray.length;M++)d[0]=w[3*M+0],d[1]=w[3*M+1],d[2]=w[3*M+2],ce.vec3.transformMat4(d,d,i),o.push(new Ie(d[0],d[1]));for(let M=0;M<3*g.indexArray.length;M++)u.push(E[M]+f)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){const w=o[u[g+0]],E=o[u[g+1]],M=o[u[g+2]];(w.x-E.x)*(M.y-E.y)-(M.x-E.x)*(w.y-E.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:o,indices:u}}function qI(c){const i=function(E,M){const x=[],S=WebGL2RenderingContext;if(E.json.textures)for(const P of E.json.textures){const A={magFilter:S.LINEAR,minFilter:S.NEAREST,wrapS:S.REPEAT,wrapT:S.REPEAT};P.sampler!==void 0&&Object.assign(A,E.json.samplers[P.sampler]),x.push({image:M[P.source],sampler:A,uploaded:!1})}return x}(c,c.images),o=function(E,M){const x=[];for(const S of E.json.meshes){const P=[];for(const A of S.primitives)P.push(i4(A,E,M));x.push(P)}return x}(c,i),{scenes:u,scene:f,nodes:d}=c.json,g=u?u[f||0].nodes:d,w=[];for(const E of g)w.push(GI(d[E],c,o));return function(E,M,x){const S={},P=new Set;for(let A=0;A<E.length;A++){const C=x[M[A]];if(!C.extras)continue;const R=C.extras["mapbox:footprint:version"],B=C.extras["mapbox:footprint:id"];(R||B)&&P.add(A),R==="1.0.0"&&B&&(S[B]=A)}for(let A=0;A<E.length;A++){if(P.has(A))continue;const C=E[A],R=x[M[A]];if(!R.extras)continue;let B=null;C.id in S&&(B=r4(E[S[C.id]].meshes,C.matrix)),B||(B=s4(R)),B&&(C.footprint=n4(B))}if(P.size>0){const A=Array.from(P.values()).sort((C,R)=>C-R);for(let C=A.length-1;C>=0;C--)E.splice(A[C],1)}}(w,g,c.json.nodes),w}function o4(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const i=c.vertexArray.float32,o=c.aabb.min[0]-1,u=c.aabb.min[1]-1,f=Rh/(c.aabb.max[0]-o+2),d=Rh/(c.aabb.max[1]-u+2);for(let g=0;g<i.length;g+=3){const w=i[g+2],E=(i[g+0]-o)*f|0,M=(i[g+1]-u)*d|0;w>c.heightmap[M*Rh+E]&&(c.heightmap[M*Rh+E]=w)}}function a4(c,i){const o={};o.indexArray=new Rs,o.indexArray.reserve(4*c.length),o.vertexArray=new Ao,o.vertexArray.reserve(10*c.length),o.colorArray=new Pl,o.vertexArray.reserve(10*c.length);let u=0;for(const g of c){const w=Math.min(10,Math.max(4,1.3*g.height))*i,E=[-g.normal[1],g.normal[0],0],M=Math.min(.29,.1*g.width/g.depth),x=g.width-2*g.depth*i*(M+.01),S=ce.vec3.scaleAndAdd([],g.pos,E,x/2),P=ce.vec3.scaleAndAdd([],g.pos,E,-x/2),A=[S[0],S[1],S[2]+g.height],C=[P[0],P[1],P[2]+g.height],R=ce.vec3.scaleAndAdd([],g.normal,E,M);ce.vec3.scale(R,R,w);const B=ce.vec3.scaleAndAdd([],g.normal,E,-M);ce.vec3.scale(B,B,w),ce.vec3.add(R,S,R),ce.vec3.add(B,P,B),S[2]+=.1,P[2]+=.1,o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(B[0],B[1],B[2]),o.vertexArray.emplaceBack(S[0],S[1],S[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(A[0],A[1],A[2]),o.vertexArray.emplaceBack(C[0],C[1],C[2]),o.vertexArray.emplaceBack(S[0],S[1],S[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(B[0],B[1],B[2]);const N=x/w/2;o.colorArray.emplaceBack(-N-M,-1,N,.8),o.colorArray.emplaceBack(N+M,-1,N,.8),o.colorArray.emplaceBack(-N,0,N,1.3),o.colorArray.emplaceBack(N,0,N,1.3),o.colorArray.emplaceBack(N+M,-.8,N,.7),o.colorArray.emplaceBack(N+M,-.8,N,.7),o.colorArray.emplaceBack(0,0,N,1.3),o.colorArray.emplaceBack(0,0,N,1.3),o.colorArray.emplaceBack(N+M,-1.2,N,.8),o.colorArray.emplaceBack(N+M,-1.2,N,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const f={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=Qi.white,f.pbrMetallicRoughness=d,o.material=f,o.aabb=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}class WI{constructor(i){this._stringToNumber={},this._numberToString=[];for(let o=0;o<i.length;o++){const u=i[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const l4=["id","tile","layer","source","sourceLayer","state"];class zf{constructor(i,o,u,f,d){this.type="Feature",this._vectorTileFeature=i,this._z=o,this._x=u,this._y=f,this.properties=i.properties,this.id=d}clone(){const i=new zf(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of l4)this[o]!==void 0&&(i[o]=this[o]);return i}}class ZI{constructor(i,o){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Oc(St,16,0),this.featureIndexArray=new wr,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,o,u,f,d,g=0,w=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,d,g);const M=this.grid;for(let x=0;x<o.length;x++){const S=o[x],P=[1/0,1/0,-1/0,-1/0];for(let A=0;A<S.length;A++){const C=S[A];P[0]=Math.min(P[0],C.x),P[1]=Math.min(P[1],C.y),P[2]=Math.max(P[2],C.x),P[3]=Math.max(P[3],C.y)}w!==0&&(P[0]-=w,P[1]-=w,P[2]+=w,P[3]+=w),P[0]<St&&P[1]<St&&P[2]>=0&&P[3]>=0&&M.insert(E,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Kc.VectorTile(new g0(this.rawTileData)).layers,this.sourceLayerCoder=new WI(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,o){const{tilespaceGeometry:u,transform:f,tileTransform:d,pixelPosMatrix:g,availableImages:w}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const E=u.bufferedTilespaceBounds,M=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(A,C,R,B)=>be(u.bufferedTilespaceGeometry,A,C,R,B));M.sort(c4);let x=null;f.elevation&&M.length>0&&(x=Cf.create(f.elevation,this.tileID));const S={};let P;for(let A=0;A<M.length;A++){const C=M[A];if(C===P)continue;P=C;const R=this.featureIndexArray.get(C);let B=null;this.is3DTile?this.loadMatchingModelFeature(S,R,i,u,f):this.loadMatchingFeature(S,R,i,w,(N,G,H,$=0)=>(B||(B=z(N,this.tileID.canonical,d)),G.queryIntersectsFeature(u,N,H,B,this.z,f,g,x,$)))}return S}loadMatchingFeature(i,o,u,f,d){const{featureIndex:g,bucketIndex:w,sourceLayerIndex:E,layoutVertexArrayOffset:M}=o,x=this.bucketLayerIDs[w],S=u.layers,P=Object.keys(S);if(P.length&&!function(N,G){for(let H=0;H<N.length;H++)if(G.indexOf(N[H])>=0)return!0;return!1}(P,x))return;const A=u.sourceCache,C=this.sourceLayerCoder.decode(E),R=this.vtLayers[C].feature(g),B=this.getId(R,C);for(let N=0;N<x.length;N++){const G=x[N];if(!S[G])continue;const{styleLayer:H,targets:$}=S[G];let W={};B!==void 0&&(W=A.getFeatureState(H.sourceLayer,B));const K=!d||d(R,H,W,M);if(!K)continue;const Q=new zf(R,this.z,this.x,this.y,B);Q.tile=this.tileID.canonical,Q.state=W;let ue=this.serializedLayersCache.get(G);ue||(ue=H.serialize(),ue.id=G,this.serializedLayersCache.set(G,ue)),Q.source=ue.source,Q.sourceLayer=ue["source-layer"],Q.layer=ji({},ue),Q.layer.paint=XI(ue.paint,H.paint,R,W,f),Q.layer.layout=XI(ue.layout,H.layout,R,W,f);let oe=!1;for(const ae of $){this.updateFeatureProperties(Q,ae);const{filter:Ee}=ae;if(Ee){if(R.properties=Q.properties,Ee.needGeometry){const he=F(R,!0);if(!Ee.filter(new fn(this.tileID.overscaledZ),he,this.tileID.canonical))continue}else if(!Ee.filter(new fn(this.tileID.overscaledZ),R))continue}oe=!0,ae.targetId&&this.addFeatureVariant(Q,ae)}oe&&this.appendToResult(i,G,g,Q,K)}}loadMatchingModelFeature(i,o,u,f,d){const g=this.bucketLayerIDs[0][0],w=u.layers;if(!w[g])return;const{styleLayer:E,targets:M}=w[g];if(E.type!=="model")return;const x=f.tile,S=o.featureIndex,P=x.getBucket(E);if(!(P&&P instanceof F0))return;const A=function(ue,oe,ae,Ee){const he=ue.getNodesInfo()[oe];if(he.hiddenByReplacement||!he.node.meshes)return;let Se=Number.MAX_VALUE;const Le=he.node,De=ae.tile,Fe=Ee.calculatePosMatrix(De.tileID.toUnwrapped(),Ee.worldSize),ke=he.evaluatedScale;let He=0;Ee.elevation&&Le.elevation&&(He=Le.elevation*Ee.elevation.exaggeration()),ce.mat4.translate(Fe,Fe,[(Le.anchor?Le.anchor[0]:0)*(ke[0]-1),(Le.anchor?Le.anchor[1]:0)*(ke[1]-1),He]),ce.mat4.scale(Fe,Fe,ke);const Ve=ae.queryGeometry,qe=Ve.isPointQuery()?Ve.screenBounds:Ve.screenGeometry,pt=function(Ft){const _t=ce.mat4.multiply([],Fe,Ft.matrix);ce.mat4.multiply(_t,Ee.expandedFarZProjMatrix,_t);for(let Et=0;Et<Ft.meshes.length;++Et){const mt=Ft.meshes[Et];if(Et===Ft.lightMeshIndex)continue;const ei=qM(qe,Ee,_t,mt.aabb);ei!=null&&(Se=Math.min(ei,Se))}if(Ft.children)for(const Et of Ft.children)pt(Et)};if(pt(Le),Se===Number.MAX_VALUE)return;const dt=new qi(0,0);return sI(De.tileID.canonical,dt,he.node.anchor[0],he.node.anchor[1]),{intersectionZ:Se,position:dt,feature:he.feature}}(P,S,f,d);if(!A)return;const{z:C,x:R,y:B}=x.tileID.canonical,{feature:N,intersectionZ:G,position:H}=A;let $={};N.id!==void 0&&($=u.sourceCache.getFeatureState(E.sourceLayer,N.id));const W=new zf({},C,R,B,N.id);W.tile=this.tileID.canonical,W.state=$,W.properties=N.properties,W.geometry={type:"Point",coordinates:[H.lng,H.lat]};let K=this.serializedLayersCache.get(g);K||(K=E.serialize(),K.id=g,this.serializedLayersCache.set(g,K)),W.source=K.source,W.sourceLayer=K["source-layer"],W.layer=ji({},K);let Q=!1;for(const ue of M){this.updateFeatureProperties(W,ue);const{filter:oe}=ue;if(oe){if(N.properties=W.properties,oe.needGeometry){if(!oe.filter(new fn(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!oe.filter(new fn(this.tileID.overscaledZ),N))continue}Q=!0,ue.targetId&&this.addFeatureVariant(W,ue)}Q&&this.appendToResult(i,g,S,W,G)}updateFeatureProperties(i,o,u){if(o.properties){const f={};for(const d in o.properties){const g=o.properties[d].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,u);g!=null&&(f[d]=g)}i.properties=f}}addFeatureVariant(i,o,u){const f={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(f.properties=i.properties),i.variants=i.variants||{},i.variants[o.targetId]=i.variants[o.targetId]||[],i.variants[o.targetId].push(f)}appendToResult(i,o,u,f,d){let g=i[o];g===void 0&&(g=i[o]=[]),g.push({featureIndex:u,feature:f,intersectionZ:d})}lookupSymbolFeatures(i,o,u,f,d){const g={};this.loadVTLayers();for(const w of i)this.loadMatchingFeature(g,{bucketIndex:o,sourceLayerIndex:u,featureIndex:w,layoutVertexArrayOffset:0},f,d);return g}loadFeature(i){const{featureIndex:o,sourceLayerIndex:u}=i;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),d=this.vtFeatures[f];if(d[o])return d[o];const g=this.vtLayers[f].feature(o);return d[o]=g,g}hasLayer(i){for(const o of this.bucketLayerIDs)for(const u of o)if(i===u)return!0;return!1}getId(i,o){let u=i.id;if(this.promoteId){const f=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[o];if(f!=null)if(Array.isArray(f)){if(!this.promoteIdExpression){const d=Rc(f);if(d.result!=="success"){const g=d.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void on(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Cd),u=this.promoteIdExpression.evaluate({zoom:0},i)}else u=i.properties[f];typeof u=="boolean"&&(u=Number(u))}return u}}function XI(c,i,o,u,f){return vs(c,(d,g)=>{const w=i instanceof Nc?i.get(g):null;return w&&w.evaluate?w.evaluate(o,u,f):w})}function c4(c,i){return i-c}zt(ZI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const YI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Pw{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(i,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=u>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const d=YI[15&u];if(!d)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(i,2,1),[w]=new Uint32Array(i,4,1);return new Pw(w,g,d,i)}constructor(i,o=64,u=Float64Array,f){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const d=YI.indexOf(this.ArrayType),g=2*i*this.ArrayType.BYTES_PER_ELEMENT,w=i*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+E,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+g+w+E),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+E,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=i)}add(i,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=i,this.coords[this._pos++]=o,u}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Dw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,o,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:w}=this,E=[0,d.length-1,0],M=[];for(;E.length;){const x=E.pop()||0,S=E.pop()||0,P=E.pop()||0;if(S-P<=w){for(let B=P;B<=S;B++){const N=g[2*B],G=g[2*B+1];N>=i&&N<=u&&G>=o&&G<=f&&M.push(d[B])}continue}const A=P+S>>1,C=g[2*A],R=g[2*A+1];C>=i&&C<=u&&R>=o&&R<=f&&M.push(d[A]),(x===0?i<=C:o<=R)&&(E.push(P),E.push(A-1),E.push(1-x)),(x===0?u>=C:f>=R)&&(E.push(A+1),E.push(S),E.push(1-x))}return M}within(i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:d,nodeSize:g}=this,w=[0,f.length-1,0],E=[],M=u*u;for(;w.length;){const x=w.pop()||0,S=w.pop()||0,P=w.pop()||0;if(S-P<=g){for(let B=P;B<=S;B++)JI(d[2*B],d[2*B+1],i,o)<=M&&E.push(f[B]);continue}const A=P+S>>1,C=d[2*A],R=d[2*A+1];JI(C,R,i,o)<=M&&E.push(f[A]),(x===0?i-u<=C:o-u<=R)&&(w.push(P),w.push(A-1),w.push(1-x)),(x===0?i+u>=C:o+u>=R)&&(w.push(A+1),w.push(S),w.push(1-x))}return E}}function Dw(c,i,o,u,f,d){if(f-u<=o)return;const g=u+f>>1;KI(c,i,g,u,f,d),Dw(c,i,o,u,g-1,1-d),Dw(c,i,o,g+1,f,1-d)}function KI(c,i,o,u,f,d){for(;f>u;){if(f-u>600){const M=f-u+1,x=o-u+1,S=Math.log(M),P=.5*Math.exp(2*S/3),A=.5*Math.sqrt(S*P*(M-P)/M)*(x-M/2<0?-1:1);KI(c,i,o,Math.max(u,Math.floor(o-x*P/M+A)),Math.min(f,Math.floor(o+(M-x)*P/M+A)),d)}const g=i[2*o+d];let w=u,E=f;for(Ig(c,i,u,o),i[2*f+d]>g&&Ig(c,i,u,f);w<E;){for(Ig(c,i,w,E),w++,E--;i[2*w+d]<g;)w++;for(;i[2*E+d]>g;)E--}i[2*u+d]===g?Ig(c,i,u,E):(E++,Ig(c,i,E,f)),E<=o&&(u=E+1),o<=E&&(f=E-1)}}function Ig(c,i,o,u){Rw(c,o,u),Rw(i,2*o,2*u),Rw(i,2*o+1,2*u+1)}function Rw(c,i,o){const u=c[i];c[i]=c[o],c[o]=u}function JI(c,i,o,u){const f=c-o,d=i-u;return f*f+d*d}s.$=lr,s.A=xr,s.B=Ho,s.C=jc,s.D=Pf,s.E=wo,s.F=2,s.G=cg,s.H=rM,s.I=pr,s.J=class extends k0{},s.K=pa,s.L=$i,s.M=Ny,s.N=hm,s.O=Dc,s.P=Ie,s.Q=Cy,s.R=Ss,s.S=Zd,s.T=cw,s.U=sf,s.V=k0,s.W=mm,s.X=Rc,s.Y=sh,s.Z=va,s._=Ac,s.a=function(c){return te.API_CDN_URL_REGEX.test(c)},s.a$=F,s.a0=no,s.a1=Am,s.a2=qd,s.a3=Gd,s.a4=function(c){const i=c.value;let o=[];if(!i)return o;const u=pa(i);return u!=="string"?(o=o.concat([new k0(c.key,i,`string expected, "${u}" found`)]),o):(ZM(i,!0)||(o=o.concat([new k0(c.key,i,`invalid url "${i}"`)])),o)},s.a5=We,s.a6=Sm,s.a7=kn,s.a8=Tt,s.a9=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return cc(c.expression.evaluate(i))}interpolate(c,i,o){return{x:ni(c.x,i.x,o),y:ni(c.y,i.y,o),z:ni(c.z,i.z,o),azimuthal:ni(c.azimuthal,i.azimuthal,o),polar:ni(c.polar,i.polar,o)}}},s.aA=function(c,i){const o={};for(let u=0;u<i.length;u++){const f=i[u];f in c&&(o[f]=c[f])}return o},s.aB=nl,s.aC=Tr,s.aD=class{constructor(c){this.entries={},this.scheduler=c}request(c,i,o,u){const f=this.entries[c]=this.entries[c]||{callbacks:[]};if(f.result){const[d,g]=f.result;return this.scheduler?this.scheduler.add(()=>{u(d,g)},i):u(d,g),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=o((d,g)=>{f.result=[d,g];for(const w of f.callbacks)this.scheduler?this.scheduler.add(()=>{w(d,g)},i):w(d,g);setTimeout(()=>delete this.entries[c],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(d=>d!==u),f.callbacks.length||(f.cancel(),delete this.entries[c]))}}},s.aE=function(c,i,o){const u=JSON.stringify(c.request);return c.data&&(this.deduped.entries[u]={result:[null,c.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},f=>{const d=ua(c.request,(g,w,E,M)=>{g?f(g):w&&f(null,{vectorTile:o?void 0:new Kc.VectorTile(new g0(w)),rawData:w,cacheControl:E,expires:M})});return()=>{d.cancel(),f()}},i)},s.aF=function(c){Ki++,Ki>vi&&(c.getActor().send("enforceCacheSizeLimit",mi),Ki=0)},s.aG=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},s.aH=ft,s.aI=kM,s.aJ=UM,s.aK=OM,s.aL=function(c,i){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){i(null,o)};for(let u=0;u<c.length;u++){const f=document.createElement("source");Op(c[u])||(o.crossOrigin="Anonymous"),f.src=c[u],o.appendChild(f)}return{cancel:()=>{}}},s.aM=P0,s.aN=function(c){return fetch(c).then(i=>i.arrayBuffer()).then(i=>HI(i,0,c))},s.aO=qI,s.aP=class{constructor(c,i,o,u){this.id=c,this.position=i!=null?new qi(i[0],i[1]):new qi(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,i){if(ce.mat4.multiply(c.matrix,i,c.matrix),c.meshes)for(const o of c.meshes){const u=Ht.applyTransformFast(o.aabb,c.matrix);this.aabb.encapsulate(u)}if(c.children)for(const o of c.children)this._applyTransformations(o,c.matrix)}computeBoundsAndApplyParent(){const c=ce.mat4.identity([]);for(const i of this.nodes)this._applyTransformations(i,c)}computeModelMatrix(c,i,o,u,f,d,g=!1){QM(this.matrix,this,c.transform,this.position,i,o,u,f,d,g)}upload(c){if(!this.uploaded){for(const i of this.nodes)pw(i,c);for(const i of this.nodes)z0(i);this.uploaded=!0}}destroy(){for(const c of this.nodes)mw(c)}},s.aQ=Ws,s.aR=dg,s.aS=Er,s.aT=Ls,s.aU=Ta,s.aV=Rs,s.aW=Kn,s.aX=yh,s.aY=I0,s.aZ=function(){oo.isLoading()||oo.isLoaded()||tf()!=="deferred"||By()},s.a_=Mm,s.aa=fn,s.ab=Lc,s.ac=n,s.ad=ce,s.ae=ci,s.af=Nc,s.ag=gr,s.ah=ni,s.ai=St,s.aj=hy,s.ak=yt,s.al=Qi,s.am=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return function([o,u]){const f=cc([1,o,u]);return{x:f.x,y:f.y,z:f.z}}(c.expression.evaluate(i))}interpolate(c,i,o){return{x:ni(c.x,i.x,o),y:ni(c.y,i.y,o),z:ni(c.z,i.z,o)}}},s.an=function(c,i,o=0,u=!0){const f=new Ie(o,o),d=c.sub(f),g=i.add(f),w=[d,new Ie(g.x,d.y),g,new Ie(d.x,g.y)];return u&&w.push(d.clone()),w},s.ao=function(c,i){const o=[];for(let u=0;u<c.length;u++){const f=Ai(u-1,-1,c.length-1),d=Ai(u+1,-1,c.length-1),g=c[u],w=c[d],E=c[f].sub(g).unit(),M=w.sub(g).unit(),x=M.angleWithSep(E.x,E.y),S=E.add(M).unit().mult(-1*i/Math.sin(x/2));o.push(g.add(S))}return o},s.ap=xM,s.aq=be,s.ar=function(c,i,o=0){return ce.vec3.fromValues(((i.x-o)*c.scale-c.x)*St,(i.y*c.scale-c.y)*St,Zm(i.z,i.y))},s.as=oi,s.at=LA,s.au=function(c){let i=1/0,o=1/0,u=-1/0,f=-1/0;for(const d of c)i=Math.min(i,d.x),o=Math.min(o,d.y),u=Math.max(u,d.x),f=Math.max(f,d.y);return{min:new Ie(i,o),max:new Ie(u,f)}},s.av=Zo,s.aw=xe,s.ax=p,s.ay=At,s.az=cr,s.b=function(c){return te.API_FONTS_REGEX.test(c)},s.b$=L0,s.b0=zf,s.b1=xl,s.b2=jb,s.b3=kb,s.b4=z,s.b5=wa,s.b6=df,s.b7=ti,s.b8=Mn,s.b9=Jm,s.bA=hA,s.bB=Qb,s.bC=fM,s.bD=Yb,s.bE=Pw,s.bF=Ai,s.bG=uc,s.bH=js,s.bI=function(c,i,o){c[4*i+0]=o[0],c[4*i+1]=o[1],c[4*i+2]=o[2],c[4*i+3]=o[3]},s.bJ=Ah,s.bK=lo,s.bL=Gc,s.bM=Xn,s.bN=Eh,s.bO=qi,s.bP=SM,s.bQ=Qe,s.bR=_i,s.bS=$M,s.bT=ht,s.bU=Js,s.bV=function(c,i,o,u,f,d,g,w,E){if(E.name==="globe")return Js(c,i,new ht(o,u,f),!1);const M=dg({z:o,x:u,y:f},E);return new Ht([(d+M.x/M.scale)*i,i*(M.y/M.scale),g],[(d+M.x2/M.scale)*i,i*(M.y2/M.scale),w])},s.bW=function(c,i,o){let u=0;for(let f=0;f<2;++f)c[f]>0&&(u+=(c[f]-0)*(c[f]-0)),i[f]<0&&(u+=(0-i[f])*(0-i[f]));return u},s.bX=Wn,s.bY=i0,s.bZ=function(c){const i=ce.mat4.identity(new Float64Array(16));ce.mat4.multiply(i,c.pixelMatrix,c.globeMatrix);const o=[0,Hr,0],u=[0,Gr,0];return ce.vec3.transformMat4(o,o,i),ce.vec3.transformMat4(u,u,i),[o[0]>0&&o[0]<=c.width&&o[1]>0&&o[1]<=c.height&&!Ar(c,new qi(c.center.lat,90)),u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!Ar(c,new qi(c.center.lat,-90))]},s.b_=function(c,i){const{scale:o}=c.tileTransform,u=o*St/(c.tileSize*Math.pow(2,i.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return ce.mat2.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[u,u])},s.ba=ow,s.bb=function(c,i){const o=gr(i.zoom);if(o===0)return fs(c);const u=zi(c),f=Cn(u),d=Zo(u.getWest())*i.worldSize,g=Zo(u.getEast())*i.worldSize,w=Tr(u.getNorth())*i.worldSize,E=Tr(u.getSouth())*i.worldSize,M=[d,w,0],x=[g,w,0],S=[d,E,0],P=[g,E,0],A=ce.mat4.invert([],i.globeMatrix);return ce.vec3.transformMat4(M,M,A),ce.vec3.transformMat4(x,x,A),ce.vec3.transformMat4(S,S,A),ce.vec3.transformMat4(P,P,A),f[0]=xs(f[0],S,o),f[1]=xs(f[1],P,o),f[2]=xs(f[2],x,o),f[3]=xs(f[3],M,o),Ht.fromPoints(f)},s.bc=Tn,s.bd=Zi,s.be=xs,s.bf=$c,s.bg=pi,s.bh=q0,s.bi=g0,s.bj=ua,s.bk=function(c,i){const o=[];for(const u in c)u in i||o.push(u);return o},s.bl=Xi,s.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bn=wt,s.bo=function(c,i){const{x:o,y:u}=c.point,f=co(o,u,c.worldSize/c._pixelsPerMercatorPixel,0,0);return ce.mat4.multiply(f,f,ps(fs(i)))},s.bp=wf,s.bq=Wr,s.br=m0,s.bs=function(c,i,o,u,f){const d=5*i+2;c.float32[d+0]=o,c.float32[d+1]=u,c.float32[d+2]=f},s.bt=M0,s.bu=sM,s.bv=J,s.bw=Hs,s.bx=rA,s.by=WM,s.bz=uA,s.c=ye,s.c$=FA,s.c0=jM,s.c1=function(c){const i=jM(c,!0);return ce.mat2.invert([],[i[0],i[1],i[4],i[5]])},s.c2=Di,s.c3=function(c){const{x:i,y:o}=c.point,{lng:u,lat:f}=c._center;return co(i,o,c.worldSize,u,f)},s.c4=Xt,s.c5=Ct,s.c6=qc,s.c7=function(c){const i=Math.round((c+45+360)%360/90)%4;return Zt[i]},s.c8=45,s.c9=dy,s.cA=Qy,s.cB=class extends Wo{constructor(c){super(c),this.current=Hm}set(c,i,o){if(this.fetchUniformLocation(c,i)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},s.cC=Yt,s.cD=function(c,i,o){const u=gr(o.zoom),f=c.style.map._antialias,d=c.terrain&&c.terrain.exaggeration()>0;return u===0&&!f&&!d},s.cE=function(c){const i=c.pixelsPerMeter,o=i/js(1,c.center.lat),u=ce.mat4.identity(new Float64Array(16));return ce.mat4.translate(u,u,[c.point.x,c.point.y,0]),ce.mat4.scale(u,u,[o,o,i]),Float32Array.from(u)},s.cF=zi,s.cG=function(c){const i=Wn-5;c=At(c,-i,i)/i*90;const o=Math.pow(Math.abs(Math.sin(yt(c))),3);return Math.round(o*(yf.length-1))},s.cH=function(c,i,o,u){const f=i.getNorth(),d=i.getSouth(),g=i.getWest(),w=i.getEast(),E=1<<c.z,M=w-g,x=f-d,S=M/Wc,P=-x/yf[o],A=[0,S,0,P,0,0,f,g,0];if(c.z>0){const C=180/u;ce.mat3.multiply(A,A,[C/M+1,0,0,0,C/x+1,0,-.5*C/S,.5*C/P,1])}return A[2]=E,A[5]=c.x,A[8]=c.y,A},s.cI=fs,s.cJ=function(c,i,o){const u=ce.mat4.identity(new Float64Array(16)),f=(i/(1<<c)-.5)*Math.PI*2;return ce.mat4.rotateY(u,o.globeMatrix,f),Float32Array.from(u)},s.cK=class{isDataAvailableAtPoint(c){const i=this._source();if(this.isUsingMockSource()||!i||c.y<0||c.y>1)return!1;const o=i.getSource().maxzoom,u=1<<o,f=Math.floor(c.x),d=Math.floor((c.x-f)*u),g=Math.floor(c.y*u),w=this.findDEMTileFor(new ft(o,f,o,d,g));return!(!w||!w.dem)}getAtPointOrZero(c,i=0){return this.getAtPoint(c,i)||0}getAtPoint(c,i,o=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const u=this._source();if(!u||c.y<0||c.y>1)return i;const f=u.getSource().maxzoom,d=1<<f,g=Math.floor(c.x),w=c.x-g,E=new ft(f,g,f,Math.floor(w*d),Math.floor(c.y*d)),M=this.findDEMTileFor(E);if(!M||!M.dem)return i;const x=M.dem,S=1<<M.tileID.canonical.z,P=(w*S-M.tileID.canonical.x)*x.dim,A=(c.y*S-M.tileID.canonical.y)*x.dim,C=Math.floor(P),R=Math.floor(A);return(o?this.exaggeration():1)*ni(ni(x.get(C,R),x.get(C,R+1),A-R),ni(x.get(C+1,R),x.get(C+1,R+1),A-R),P-C)}getAtTileOffset(c,i,o){const u=1<<c.canonical.z;return this.getAtPointOrZero(new n(c.wrap+(c.canonical.x+i/St)/u,(c.canonical.y+o/St)/u))}getAtTileOffsetFunc(c,i,o,u){return f=>{const d=this.getAtTileOffset(c,f.x,f.y),g=u.upVector(c.canonical,f.x,f.y),w=u.upVectorScale(c.canonical,i,o).metersToTile;return ce.vec3.scale(g,g,d*w),g}}getForTilePoints(c,i,o,u){if(this.isUsingMockSource())return!1;const f=Cf.create(this,c,u);return!!f&&(i.forEach(d=>{d[2]=this.exaggeration()*f.getElevationAt(d[0],d[1],o)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(c);if(!i||!i.dem)return null;const o=i.dem.tree,u=i.tileID,f=1<<c.canonical.z-u.canonical.z;let d=c.canonical.x/f-u.canonical.x,g=c.canonical.y/f-u.canonical.y,w=0;for(let E=0;E<c.canonical.z-u.canonical.z&&!o.leaves[w];E++){d*=2,g*=2;const M=2*Math.floor(g)+Math.floor(d);w=o.childOffsets[w]+M,d%=1,g%=1}return{min:this.exaggeration()*o.minimums[w],max:this.exaggeration()*o.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,i,o){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let i=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const f of c){const d=this.getMinMaxForTile(f.tileID);d&&(o=Math.min(o,d.min),u=Math.max(u,d.max),i=!0)}return i?{min:o,max:u}:null}},s.cL=k2,s.cM=Li,s.cN=function(c,i){return[Math.pow(c[0],2.2)*i,Math.pow(c[1],2.2)*i,Math.pow(c[2],2.2)*i]},s.cO=Sr,s.cP=nt,s.cQ=qu,s.cR=256,s.cS=function(c,i){const o=[0,0,0],u=Tn(fs(i.canonical));return ce.vec3.transformMat4(o,o,u),ce.vec3.transformMat4(o,o,c),o},s.cT=c=>({u_camera_to_center_distance:new Xn(c),u_extrude_scale:new Gm(c),u_device_pixel_ratio:new Xn(c),u_matrix:new Ah(c),u_inv_rot_matrix:new Ah(c),u_merc_center:new lo(c),u_tile_id:new Gc(c),u_zoom_transition:new Xn(c),u_up_dir:new Gc(c),u_emissive_strength:new Xn(c)}),s.cU=c=>({u_matrix:new Ah(c),u_pixels_to_tile_units:new Gm(c),u_device_pixel_ratio:new Xn(c),u_width_scale:new Xn(c),u_floor_width_scale:new Xn(c),u_units_to_pixels:new lo(c),u_dash_image:new Eh(c),u_gradient_image:new Eh(c),u_image_height:new Xn(c),u_texsize:new lo(c),u_tile_units_to_pixels:new Xn(c),u_alpha_discard_threshold:new Xn(c),u_trim_offset:new lo(c),u_trim_fade_range:new lo(c),u_trim_color:new Sh(c),u_emissive_strength:new Xn(c),u_zbias_factor:new Xn(c),u_tile_to_meter:new Xn(c)}),s.cV=c=>({u_matrix:new Ah(c),u_texsize:new lo(c),u_pixels_to_tile_units:new Gm(c),u_device_pixel_ratio:new Xn(c),u_width_scale:new Xn(c),u_floor_width_scale:new Xn(c),u_image:new Eh(c),u_units_to_pixels:new lo(c),u_tile_units_to_pixels:new Xn(c),u_alpha_discard_threshold:new Xn(c),u_trim_offset:new lo(c),u_trim_fade_range:new lo(c),u_trim_color:new Sh(c),u_emissive_strength:new Xn(c),u_zbias_factor:new Xn(c),u_tile_to_meter:new Xn(c)}),s.cW=zm,s.cX=dB,s.cY=fB,s.cZ=Xc,s.c_=(c,i,o,u,f,d)=>{const g=c.transform,w=g.projection.name==="globe";let E;if(d.paint.get("circle-pitch-alignment")==="map")if(w){const x=Sr(g.zoom,i.canonical)*g._pixelsPerMercatorPixel;E=Float32Array.from([x,0,0,x])}else E=g.calculatePixelsToTileUnitsMatrix(o);else E=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(g.projection),u_matrix:c.translatePosMatrix(i.projMatrix,o,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:it.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Xm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(w){M.u_inv_rot_matrix=u,M.u_merc_center=f,M.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],M.u_zoom_transition=gr(g.zoom);const x=f[0]*St,S=f[1]*St;M.u_up_dir=g.projection.upVector(new ht(0,0,0),x,S)}return M},s.ca=vf,s.cb=Sh,s.cc=function(c,i,o){const u=Math.sqrt(c*c+i*i+o*o),f=u>0?Math.acos(o/u)*Bt:0;let d=c!==0||i!==0?Math.atan2(-i,-c)*Bt+90:0;return d<0&&(d+=360),[u,d,f]},s.cd=m,s.ce=Ht,s.cf=cc,s.cg=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},s.ch=function(c,i){return c.readFields(oN,{icons:[]},i)},s.ci=function(c){return c({pluginStatus:mr,pluginURL:Ka}),kc.on("pluginStateChange",c),c},s.cj=B0,s.ck=Sf,s.cl=Kb,s.cm=hc,s.cn=dh,s.co=Ot,s.cp=Vr,s.cq=or,s.cr=function(c){const i=c.indexOf(of);return i>=0?c.slice(0,i):c},s.cs=function(c){return c.indexOf(of)>=0},s.ct=function(c){const i=c.indexOf(of);return i>=0?c.slice(i+1):""},s.cu=function(c){const i=[],o=c.id;return o===void 0&&i.push({message:`layers.${o}: missing required property "id"`}),c.render===void 0&&i.push({message:`layers.${o}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&i.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),i},s.cv=function(c,i,o,u){return c.type==="custom"?new qB(c,i):new nN[c.type](c,i,o,u)},s.cw=Br,s.cx=class extends zf{constructor(c,i){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},s.cy=kc,s.cz=io,s.d=function(c){return te.API_TILEJSON_REGEX.test(c)},s.d$=WI,s.d0=Ks,s.d1=(c,i,o,u,f,d,g,w)=>{const E=c.transform,M=E.pitch<15?OA(.07,.7,At((14-E.zoom)/5,0,1)):.07,x=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:zA(c,i,o,u),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:f,u_width_scale:d,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:kA(i,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(x?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:m(i.tileID.canonical,0)}},s.d2=(c,i,o,u,f,d,g,w,E)=>{const M=c.transform,x=M.calculatePixelsToTileUnitsMatrix(i),S=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none",P=M.pitch<15?OA(.07,.7,At((14-M.zoom)/5,0,1)):.07;return{u_matrix:zA(c,i,o,u),u_pixels_to_tile_units:x,u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:w,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:BA(o)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:kA(i,c.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(S?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:m(i.tileID.canonical,0)}},s.d3=ds,s.d4=Km,s.d5=Zm,s.d6=EA,s.d7=Pt,s.d8=p0,s.d9=Jc,s.dA=h0,s.dB=Ut,s.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.dD=Ei,s.dE=Eb,s.dF=Ll,s.dG=function([c,i,o]){const u=Math.hypot(c,i,o),f=Math.atan2(c,o),d=.5*Math.PI-Math.acos(-i/u);return new qi(Xt(f),Xt(d))},s.dH=hw,s.dI=function(c){const i=c.navigator?c.navigator.userAgent:null;return!!function(o){if(Gu==null){const u=o.navigator?o.navigator.userAgent:null;Gu=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Gu}(c)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dJ=function(c,i){mi=c,vi=i},s.dK=Ar,s.dL=uo,s.dM=function(c){const i=[0,0,0],o=ce.mat4.identity(new Float64Array(16));return ce.mat4.multiply(o,c.pixelMatrix,c.globeMatrix),ce.vec3.transformMat4(i,i,o),new Ie(i[0],i[1])},s.dN=function(c,i,o=!1){if(mr===bm||mr===qo||mr===wm)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ka=it.resolveURL(c),mr=bm,Tm=i,ef(),o||By()},s.dO=tf,s.dP=function(){B0().acquire(_w)},s.dQ=function(){const c=xg;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(_w),xg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dR=Oh,s.dS=function(c){const i=On();if(!i)return;const o=i.delete(Nt);c&&o.catch(c).then(()=>c())},s.dT=vg,s.dU=FI,s.dV=function(c){Aw=it.resolveURL(c),kf||(kf=new Pf(B0(),new wo)),kf.broadcast("setDracoUrl",Aw)},s.dW=BI,s.dX=function(c){Of=it.resolveURL(c),kf||(kf=new Pf(B0(),new wo)),kf.broadcast("setMeshoptUrl",Of)},s.dY=zt,s.dZ=Yc,s.d_=Ca,s.da=450,s.db=7,s.dc=GB,s.dd=Gi,s.de=mf,s.df=256,s.dg=ps,s.dh=Ao,s.di=br,s.dj=hf,s.dk=function(c,i,o,u,f){return At((c-i)/(o-i)*(f-u)+u,u,f)},s.dl=am,s.dm=sl,s.dn=class{constructor(c,i,o,u){this.context=c,this.format=u,this.size=o,this.texture=c.gl.createTexture();const[f,d,g]=this.size,{gl:w}=c;w.bindTexture(w.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,f,d,g,0,aw(this.format),lw(this.format),i.data)}bind(c,i){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),c!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,c),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,c),this.minFilter=c),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},s.dp=dw,s.dq=[1,1,1],s.dr=Cf,s.ds=If,s.dt=el,s.du=Hc,s.dv=Ol,s.dw=Nm,s.dx=Bm,s.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ie(1/0,1/0),max:new Ie(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,i=!1){const o=aA(new Ie(0,0),new Ie(St,St),c),u=[];if(i&&!Fb(o,this._globalClipBounds))return u;for(const f of this._activeRegions){if(f.hiddenByOverlap||!Fb(o,f))continue;const d=NF(f.min,f.max,c);u.push({min:d.min,max:d.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return u}setSources(c){this._setSources(c.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const o=[];for(const u of i.cache.getVisibleCoordinates()){const f=i.cache.getTile(u).buckets[i.layer];f&&f.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(c){const i=c.getFootprints();if(i.length===0)return;const o=c.getOrder(),u=c.getClipMask(),f=c.getClipScope();for(const d of i){if(!d.footprint)continue;const g=aA(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:o,clipMask:u,clipScope:f})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,o)=>i.priority-o.priority||d0(i.min,o.min)||d0(i.max,o.max)||i.order-o.order||i.clipMask-o.clipMask||function(u,f){const d=(g,w)=>g+w;return u.length-f.length||u.reduce(d,"").localeCompare(f.reduce(d,""))}(i.clipScope,o.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let i=0;for(;!c&&i!==this._activeRegions.length;){const o=this._activeRegions[i],u=this._prevRegions[i];c=o.priority!==u.priority||!oA(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!wt(o.clipScope,u.clipScope),++i}}if(c){++this._updateTime;for(const o of this._activeRegions)o.order!==h0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const i=o=>{const u=this._activeRegions;if(o>=u.length)return o;const f=u[o].priority;for(;o<u.length&&u[o].priority===f;)++o;return o};if(this._sourceIds.length>1){let o=0,u=i(o);for(;o!==u;){let f=o;const d=o;for(;f!==u;){const g=this._activeRegions[f];g.hiddenByOverlap=!1;for(let w=0;w<d;w++){const E=this._activeRegions[w];if(!E.hiddenByOverlap&&g.order===h0&&Fb(g,E)&&(g.hiddenByOverlap=cA(g.footprint,g.tileId,E.footprint,E.tileId),g.hiddenByOverlap))break}++f}o=u,u=i(o)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=c.length-1;i>=0;i--)this._addSource(c[i]);this._computeReplacement()}},s.dz=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,i){const o=new wa,u=new Rs,f=[],d=c+1+2,g=i[0]+1,w=i[0]+1+(1+i.length),E=(M,x,S)=>{let P=M===d-1?M-2:M===0?M:M-1;return P+=S?24575:0,[P,x]};for(let M=0;M<d;++M)o.emplaceBack(...E(M,0,!0));for(let M=0;M<g;++M)for(let x=0;x<d;++x)o.emplaceBack(...E(x,M,(x===0||x===d-1)&&!0));for(let M=0;M<i.length;++M){const x=i[M];for(let S=0;S<d;++S)o.emplaceBack(...E(S,x,!0))}for(let M=0;M<i.length;++M){const x=u.length,S=i[M]+1+2,P=new Rs;for(let R=0;R<S-1;R++){const B=R===S-2,N=B?d*(w-i.length+M-R):d;for(let G=0;G<d-1;G++){const H=R*d+G;R===0||B||G===0||G===d-2?(P.emplaceBack(H+1,H,H+N),P.emplaceBack(H+N,H+N+1,H+1)):(u.emplaceBack(H+1,H,H+N),u.emplaceBack(H+N,H+N+1,H+1))}}const A=Mn.simpleSegment(0,x,o.length,u.length-x);for(let R=0;R<P.uint16.length;R+=3)u.emplaceBack(P.uint16[R],P.uint16[R+1],P.uint16[R+2]);const C=Mn.simpleSegment(0,x,o.length,u.length-x);f.push({withoutSkirts:A,withSkirts:C})}return{vertices:o,indices:u,segments:f}}_createGrid(c){const i=this._fillGridMeshWithLods(Wc,yf);this._gridSegments=i.segments,this._gridBuffer=c.createVertexBuffer(i.vertices,ti.members),this._gridIndexBuffer=c.createIndexBuffer(i.indices,!0)}_createPoles(c){const i=new Rs;for(let g=0;g<=Wc;g++)i.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=c.createIndexBuffer(i,!0);const o=new br,u=new br,f=new br,d=new br;this._poleSegments=[];for(let g=0,w=0;g<qc;g++){const E=360/(1<<g);o.emplaceBack(0,-cr,0,.5,0),u.emplaceBack(0,-cr,0,.5,1),f.emplaceBack(0,-cr,0,.5,.5),d.emplaceBack(0,-cr,0,.5,.5);for(let M=0;M<=Wc;M++){let x=M/Wc,S=0;const P=ni(0,E,x),[A,C,R]=Zc(Yo,Aa,P,cr);o.emplaceBack(A,C,R,x,S),u.emplaceBack(A,C,R,x,1-S);const B=yt(P);x=.5+.5*Math.sin(B),S=.5+.5*Math.cos(B),f.emplaceBack(A,C,R,x,S),d.emplaceBack(A,C,R,x,1-S)}this._poleSegments.push(Mn.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(o,$t,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(u,$t,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(f,$t,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(d,$t,!1)}getGridBuffers(c,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},s.e=te,s.e0=ZI,s.e1=PA,s.e2=Ch,s.e3="hd_road_elevation",s.e4=class{static parseFrom(c,i){const o=kl.parse(c);if(!o)return[];let{vertices:u,features:f}=o;const d=1/m(i);f.sort((M,x)=>M.id-x.id),u.sort((M,x)=>M.id-x.id||M.idx-x.idx),u=u.filter((M,x,S)=>x===S.findIndex(P=>P.id===M.id&&P.idx===M.idx));const g=new Array;let w=0;const E=u.length;for(const M of f){if(M.constantHeight){g.push(new Lb(M.id,M.bounds,M.constantHeight));continue}for(;w!==E&&u[w].id<M.id;)w++;if(w===E||u[w].id!==M.id)continue;const x=new Array,S=new Array,P=w;for(;w!==E&&u[w].id===M.id;){const A=u[w];if(x.push({position:A.position,height:A.height,extent:A.extent}),w!==P&&u[w-1].idx===A.idx-1){const C=w-P;S.push({a:C-1,b:C})}w++}g.push(new Lb(M.id,M.bounds,void 0,x,S,d))}return g}},s.e5=vs,s.e6=Ph,s.e7=oM,s.e8=Ef,s.e9=function(c,i,o,u,f,d,g,w=1,E){c.createArrays(),c.tilePixelRatio=St/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const M=c.layers[0].layout,x=c.layers[0]._unevaluatedLayout._values,S={};S.scaleFactor=w,S.textSizeScaleRange=M.get("text-size-scale-range"),S.iconSizeScaleRange=M.get("icon-size-scale-range");const[P,A]=S.textSizeScaleRange,[C,R]=S.iconSizeScaleRange;S.textScaleFactor=At(S.scaleFactor,P,A),S.iconScaleFactor=At(S.scaleFactor,C,R);const B=x["text-size"],N=x["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:Q,maxZoom:ue}=c.textSizeData;S.compositeTextSizes=[B.possiblyEvaluate(new fn(Q),d),B.possiblyEvaluate(new fn(ue),d)]}if(c.iconSizeData.kind==="composite"){const{minZoom:Q,maxZoom:ue}=c.iconSizeData;S.compositeIconSizes=[N.possiblyEvaluate(new fn(Q),d),N.possiblyEvaluate(new fn(ue),d)]}S.layoutTextSize=B.possiblyEvaluate(new fn(g+1),d),S.layoutIconSize=N.possiblyEvaluate(new fn(g+1),d),S.textMaxSize=B.possiblyEvaluate(new fn(18),d);const G=M.get("symbol-placement"),H=M.get("text-rotation-alignment")==="map"&&G!=="point",$=M.get("text-size");let W=!1;const K=[];for(const Q of c.features){const ue=M.get("text-font").evaluate(Q,{},d).join(","),oe=$.evaluate(Q,{},d)*S.textScaleFactor,ae=S.layoutTextSize.evaluate(Q,{},d)*S.textScaleFactor,Ee=S.layoutIconSize.evaluate(Q,{},d)*S.iconScaleFactor,he={horizontal:{},vertical:void 0},Se=Q.text;let Le,De=[0,0];if(Se){const mt=Se.toString(),ei=M.get("text-letter-spacing").evaluate(Q,{},d)*Hs,Lt=M.get("text-line-height").evaluate(Q,{},d)*Hs,jt=hb(mt)?ei:0,ai=M.get("text-anchor").evaluate(Q,{},d),wi=M.get("text-variable-anchor");if(!wi){const Ui=M.get("text-radial-offset").evaluate(Q,{},d);De=Ui?fM(ai,[Ui*Hs,Jb]):M.get("text-offset").evaluate(Q,{},d).map(pn=>pn*Hs)}let di=H?"center":M.get("text-justify").evaluate(Q,{},d);const Ii=G==="point",bi=Ii?M.get("text-max-width").evaluate(Q,{},d)*Hs:1/0,Pi=Ui=>{c.allowVerticalPlacement&&ym(mt)&&(he.vertical=Xb(Se,i,o,f,ue,bi,Lt,ai,Ui,jt,De,Wr.vertical,!0,ae,oe,E))};if(!H&&wi){const Ui=di==="auto"?wi.map(ui=>Qb(ui)):[di];let pn=!1;for(let ui=0;ui<Ui.length;ui++){const Oi=Ui[ui];if(!he.horizontal[Oi])if(pn)he.horizontal[Oi]=he.horizontal[0];else{const En=Xb(Se,i,o,f,ue,bi,Lt,"center",Oi,jt,De,Wr.horizontal,!1,ae,oe,E);En&&(he.horizontal[Oi]=En,pn=En.positionedLines.length===1)}}Pi("left")}else{if(di==="auto"&&(di=Qb(ai)),Ii||M.get("text-writing-mode").indexOf("horizontal")>=0||!ym(mt)){const Ui=Xb(Se,i,o,f,ue,bi,Lt,ai,di,jt,De,Wr.horizontal,!1,ae,oe,E);Ui&&(he.horizontal[di]=Ui)}Pi(Ii?"left":di)}}let Fe,ke,He,Ve,qe,pt=!1;if(Q.icon&&Q.icon.hasPrimary()){const mt=mM(Q.icon,c.iconSizeData,x["icon-size"],d,c.zoom,Q,E,S.iconScaleFactor);Fe=mt.iconPrimary,ke=mt.iconSecondary;const ei=Fe.toString(),Lt=u.get(ei);Lt&&(He=M.get("icon-offset").evaluate(Q,{},d),Ve=M.get("icon-anchor").evaluate(Q,{},d),qe=M.get("icon-text-fit").evaluate(Q,{},d),Le=TB(f.get(ei),ke?f.get(ke.toString()):void 0,He,Ve),pt=Lt.sdf,c.sdfIcons===void 0?c.sdfIcons=Lt.sdf:c.sdfIcons!==Lt.sdf&&on("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Lt.pixelRatio!==c.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}W=W||!(!Q.icon||!Q.icon.hasSecondary());const dt=ew(he.horizontal)||he.vertical;c.iconsInText||(c.iconsInText=!!dt&&dt.iconsInText);const Ft=ae*S.textScaleFactor/Hs,{defaultShapedIcon:_t,verticallyShapedIcon:Et}=DB(c,Le,M,Q,d,he,Ft,He,qe);Le=_t,K.push({feature:Q,shapedTextOrientations:he,shapedText:dt,shapedIcon:Le,iconPrimary:Fe,iconSecondary:ke,iconOffset:He,iconAnchor:Ve,verticallyShapedIcon:Et,layoutTextSize:ae,layoutIconSize:Ee,textOffset:De,isSDFIcon:pt,iconTextFit:qe})}return{featureData:K,sizes:S,hasAnySecondaryIcon:W,textAlongLine:H,symbolPlacement:G}},s.ea=aM,s.eb=function(c,i,o,u,f,d,g,w,E,M){const{featureData:x,hasAnySecondaryIcon:S,sizes:P,textAlongLine:A,symbolPlacement:C}=i;for(const R of x){const{shapedIcon:B,verticallyShapedIcon:N,feature:G,shapedTextOrientations:H,shapedText:$,layoutTextSize:W,textOffset:K,isSDFIcon:Q,iconPrimary:ue,iconSecondary:oe,iconTextFit:ae,iconOffset:Ee}=R;gM(B,M.iconPositions,ue,oe),gM(N,M.iconPositions,ue,oe),PB(H,M.iconPositions),($||B)&&RB(c,G,H,B,N,E,P,W,0,K,Q,u,f,g,w,S,ae,Ee,A,C)}o&&c.generateCollisionDebugBuffers(d,c.collisionBoxArray,P.textScaleFactor)},s.ec=Kc,s.ed=G0,s.ee=Ze,s.ef=W2,s.eg=GA,s.eh=I,s.ei=function(c){let i=0;if(new Uint32Array(c,0,1)[0]!==VI){const o=new Uint32Array(c,0,7),[,,u,f,d,g]=o;i=o.byteLength+f+d+g+d,(u!==c.byteLength||i>=c.byteLength)&&on("Invalid b3dm header information.")}return HI(c,i)},s.ej=function(c,i){const o=qI(c);for(const u of o){for(const f of u.meshes)o4(f);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(a4(u.lights,i)))}return o},s.ek=F0,s.el=rI,s.em=oo,s.en=function(c){Ci(),Ti!=null&&Ti.then(i=>{i.keys().then(o=>{for(let u=0;u<o.length-c;u++)i.delete(o[u])})})},s.f=function(c){return c.indexOf("mapbox:")===0},s.g=function(c,i){return io(ji(c,{method:"GET"}),i)},s.h=re,s.i=function(c){return te.API_STYLE_REGEX.test(c)&&!ye(c)},s.j=function(c){return decodeURIComponent(atob(c).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(i,o)=>String.fromCharCode(+("0x"+o))))},s.l=ji,s.m=Ji,s.n=function(c,i){return io(ji(c,{type:"json"}),i)},s.o=kp,s.p=function(c,i){return io(ji(c,{method:"POST"}),i)},s.q=it,s.r=$s,s.s=function(c){try{const i=self[c];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=rt,s.u=function(){return function c(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},s.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},s.w=on,s.x=function(){return yw||(yw=new Oh),yw},s.y=ww,s.z=pc}),_(["./shared"],function(s){function I(nt){const te=nt?nt.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function O(nt){if(typeof nt=="number"||typeof nt=="boolean"||typeof nt=="string"||nt==null)return JSON.stringify(nt);if(Array.isArray(nt)){let re="[";for(const ye of nt)re+=`${O(ye)},`;return`${re}]`}let te="{";for(const re of Object.keys(nt).sort())te+=`${re}:${O(nt[re])},`;return`${te}}`}function k(nt){let te="";for(const re of s.bm)(nt.type!=="model"||re!=="minzoom"&&re!=="maxzoom")&&(te+=`/${O(nt[re])}`);return te}class j{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,re){this._layerConfigs={},this._layers={},this.update(te,[],re)}update(te,re,ye){this._options=ye;for(const Me of te)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=s.cv(Me,this.scope,null,this._options)).compileFilter(ye),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(const Me of re)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const Pe=function(Me,Oe){const Ye={};for(let tt=0;tt<Me.length;tt++){const rt=Me[tt];let it=Oe&&Oe[rt.id];!it&&(it=k(rt),rt.type==="line"&&rt.paint)&&function Ot(Nt){return typeof Nt=="string"&&Nt==="line-progress"||(Array.isArray(Nt)?Nt.some(Ot):!(!Nt||typeof Nt!="object")&&Object.values(Nt).some(Ot))}(rt.paint["line-width"])&&(it+=`/${O(rt.paint["line-width"])}`),Oe&&(Oe[rt.id]=it);let xt=Ye[it];xt||(xt=Ye[it]=[]),xt.push(rt)}const Be=[];for(const tt in Ye)Be.push(Ye[tt]);return Be}(Object.values(this._layerConfigs),this.keyCache);for(const Me of Pe){const Oe=Me.map(xt=>this._layers[xt.id]),Ye=Oe[0];if(Ye.visibility==="none")continue;const Be=Ye.source||"";let tt=this.familiesBySource[Be];tt||(tt=this.familiesBySource[Be]={});const rt=Ye.sourceLayer||"_geojsonTileLayer";let it=tt[rt];it||(it=tt[rt]=[]),it.push(Oe)}}}const Z=1*s.d_;class Y{constructor(te){const re={},ye=[];for(const Ye in te){const Be=te[Ye],tt=re[Ye]={};for(const rt in Be.glyphs){const it=Be.glyphs[+rt];if(!it||it.bitmap.width===0||it.bitmap.height===0)continue;const xt=it.metrics.localGlyph?Z:1,Ot={x:0,y:0,w:it.bitmap.width+2*xt,h:it.bitmap.height+2*xt};ye.push(Ot),tt[rt]=Ot}}const{w:Pe,h:Me}=s.H(ye),Oe=new s.dZ({width:Pe||1,height:Me||1});for(const Ye in te){const Be=te[Ye];for(const tt in Be.glyphs){const rt=Be.glyphs[+tt];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const it=re[Ye][tt],xt=rt.metrics.localGlyph?Z:1;s.dZ.copy(rt.bitmap,Oe,{x:0,y:0},{x:it.x+xt,y:it.y+xt},rt.bitmap)}}this.image=Oe,this.positions=re}}s.dY(Y,"GlyphAtlas");class se{constructor(te){this.tileID=new s.aH(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.request&&te.request.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=s.aR(te.tileID.canonical,te.projection),this.projection=te.projection,this.worldview=te.worldview,this.localizableLayerIds=te.localizableLayerIds,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep,this.scaleFactor=te.scaleFactor}parse(te,re,ye,Pe,Me){this.status="parsing",this.data=te,this.collisionBoxArray=new s.aX;const Oe=new s.d$(Object.keys(te.layers).sort()),Ye=new s.e0(this.tileID,this.promoteId);Ye.bucketLayerIDs=[];const Be={},tt=new s.e1(256,256),rt={featureIndex:Ye,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:tt,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},it=re.familiesBySource[this.source];for(const Ci in it){const Ki=te.layers[Ci];if(!Ki)continue;let Ji=!1,nn=!1,Gn=!1;for(const ar of it[Ci])ar[0].type==="symbol"?Ji=!0:nn=!0,ar[0].is3D()&&ar[0].type!=="model"&&(Gn=!0);if(this.extraShadowCaster&&!Gn||this.isSymbolTile===!0&&!Ji||this.isSymbolTile===!1&&!nn)continue;Ki.version===1&&s.w(`Vector tile source "${this.source}" layer "${Ci}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Es=Oe.encode(Ci),Zs=[];let to=!1;for(let ar=0,Ss=0;ar<Ki.length;ar++){const Ds=Ki.feature(ar),hc=Ye.getId(Ds,Ci);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ci)){const io=Ds.properties?Ds.properties.worldview:null;if(this.worldview&&typeof io=="string")if(io==="all")Ds.properties.$localized=!0;else{if(!io.split(",").includes(this.worldview))continue;Ds.properties.$localized=!0,Ds.properties.worldview=this.worldview}}!to&&Ds.properties&&Ds.properties.hasOwnProperty(s.e2)&&(to=!0),Zs.push({feature:Ds,id:hc,index:Ss,sourceLayerIndex:Es}),Ss++}to&&!rt.elevationFeatures&&te.layers.hasOwnProperty(s.e3)&&(rt.elevationFeatures=s.e4.parseFrom(te.layers[s.e3],this.canonical));for(const ar of it[Ci]){const Ss=ar[0];(!this.extraShadowCaster||Ss.is3D()&&Ss.type!=="model")&&(this.isSymbolTile!==void 0&&Ss.type==="symbol"!==this.isSymbolTile||Ss.minzoom&&this.zoom<Math.floor(Ss.minzoom)||Ss.maxzoom&&this.zoom>=Ss.maxzoom||Ss.visibility!=="none"&&(ne(ar,this.zoom,rt.brightness,ye),(Be[Ss.id]=Ss.createBucket({index:Ye.bucketLayerIDs.length,layers:ar,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Es,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Zs,rt,this.tileID.canonical,this.tileTransform),Ye.bucketLayerIDs.push(ar.map(Ds=>s.C(Ds.id,Ds.scope)))))}}let xt,Ot,Nt,mi,vi,xi;tt.trim();const Ti={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_n=()=>{if(xt)return this.status="done",Me(xt);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:Object.values(Be).filter(Ci=>!Ci.isEmpty()),featureIndex:Ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:rt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ot&&Nt&&mi){const Ci=new Y(Ot),Ki=new Map;for(const[Gn,Es]of Nt.entries()){const{imagePosition:Zs}=s.e7(Gn,Es,s.e8);Ki.set(Gn,Zs)}const Ji={};for(const Gn in Be){const Es=Be[Gn];Es instanceof s.aY&&(ne(Es.layers,this.zoom,rt.brightness,ye),Ji[Gn]=s.e9(Es,Ot,Ci.positions,Nt,Ki,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const nn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Pe,Nt,vi,()=>{nn.iconsPending=!1,On(Ji,Ci,nn)}),this.rasterizeIfNeeded(Pe,mi,xi,()=>{nn.patternsPending=!1,On(Ji,Ci,nn)})}},On=(Ci,Ki,Ji,nn)=>{if(Ji.iconsPending||Ji.patternsPending)return;const Gn=new s.ea(Nt,mi,this.lut);for(const Es in Be){const Zs=Be[Es];if(Es in Ci)s.eb(Zs,Ci[Es],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Nt,Gn);else if(Zs.hasPattern&&(Zs instanceof s.b2||Zs instanceof s.b3||Zs instanceof s.d8)){ne(Zs.layers,this.zoom,rt.brightness,ye);const to=Object.fromEntries(Gn.patternPositions);Zs.addFeatures(rt,this.tileID.canonical,to,ye,this.tileTransform,this.brightness)}}this.status="done",Me(null,{buckets:Object.values(Be).filter(Es=>!Es.isEmpty()),featureIndex:Ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ki.image,lineAtlas:tt,imageAtlas:Gn,brightness:rt.brightness})};if(!this.extraShadowCaster){const Ci=s.e5(rt.glyphDependencies,nn=>Object.keys(nn).map(Number));Object.keys(Ci).length?Pe.send("getGlyphs",{uid:this.uid,stacks:Ci,scope:this.scope},(nn,Gn)=>{xt||(xt=nn,Ot=Gn,_n())},void 0,!1,Ti):Ot={};const Ki=Array.from(rt.iconDependencies.keys()).map(nn=>s.I.parse(nn));Ki.length?Pe.send("getImages",{images:Ki,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(nn,Gn)=>{xt||(xt=nn,Nt=new Map,vi=this.updateImageMapAndGetImageTaskQueue(Nt,Gn,rt.iconDependencies),_n())},void 0,!1,Ti):(Nt=new Map,vi=new Map);const Ji=Array.from(rt.patternDependencies.keys()).map(nn=>s.I.parse(nn));Ji.length?Pe.send("getImages",{images:Ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(nn,Gn)=>{xt||(xt=nn,mi=new Map,xi=this.updateImageMapAndGetImageTaskQueue(mi,Gn,rt.patternDependencies),_n())},void 0,!1,Ti):(mi=new Map,xi=new Map)}if(rt.elevationFeatures&&rt.elevationFeatures.length>0){const Ci=[];for(const Ji of Object.values(Be))if(Ji instanceof s.b3){const nn=Ji.getUnevaluatedPortalGraph();nn&&Ci.push(nn)}const Ki=s.e6.evaluate(Ci);for(const Ji of Object.values(Be))Ji instanceof s.b3&&Ji.setEvaluatedPortalGraph(Ki)}_n()}rasterizeIfNeeded(te,re,ye,Pe){Array.from(re.values()).some(Me=>Me.usvg)?this.rasterize(te,re,ye,Pe):Pe()}updateImageMapAndGetImageTaskQueue(te,re,ye){const Pe=new Map;for(const Me of re.keys()){const Oe=ye.get(Me)||[];for(const Ye of Oe){const Be=Ye.toString(),tt=re.get(Ye.id.toString());tt.usvg?Pe.has(Be)||(Pe.set(Be,Ye),te.set(Be,Object.assign({},tt))):te.set(Be,tt)}}return Pe}rasterize(te,re,ye,Pe){this.rasterizeTask=te.send("rasterizeImages",{scope:this.scope,tasks:ye},(Me,Oe)=>{if(!Me)for(const[Ye,Be]of Oe.entries()){const tt=Object.assign(re.get(Ye),{data:Be});re.set(Ye,tt)}Pe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ne(nt,te,re,ye){const Pe=new s.aa(te,{brightness:re});for(const Me of nt)Me.recalculate(Pe,ye)}class de extends s.E{constructor(te,re,ye,Pe,Me,Oe){super(),this.actor=te,this.layerIndex=re,this.availableImages=ye,this.loadVectorData=Me||s.aE,this.loading={},this.loaded={},this.deduped=new s.aD(te.scheduler),this.isSpriteLoaded=Pe,this.scheduler=te.scheduler,this.brightness=Oe}loadTile(te,re){const ye=te.uid,Pe=te&&te.request,Me=Pe&&Pe.collectResourceTiming,Oe=this.loading[ye]=new se(te);Oe.abort=this.loadVectorData(te,(Ye,Be)=>{const tt=!this.loading[ye];if(delete this.loading[ye],Oe.cancelRasterize(),tt||Ye||!Be)return Oe.status="done",tt||(this.loaded[ye]=Oe),re(Ye);const rt=Be.rawData,it={};Be.expires&&(it.expires=Be.expires),Be.cacheControl&&(it.cacheControl=Be.cacheControl),Oe.vectorTile=Be.vectorTile||new s.ec.VectorTile(new s.bi(rt));const xt=()=>{Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ot,Nt)=>{if(Ot||!Nt)return re(Ot);const mi={};if(Me){const vi=I(Pe);vi.length>0&&(mi.resourceTiming=JSON.parse(JSON.stringify(vi)))}re(null,s.l({rawTileData:rt.slice(0)},Nt,it,mi))})};this.isSpriteLoaded?xt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(xt,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):xt()}),this.loaded=this.loaded||{},this.loaded[ye]=Oe})}reloadTile(te,re){const ye=this.loaded,Pe=te.uid;if(ye&&ye[Pe]){const Me=ye[Pe];Me.scaleFactor=te.scaleFactor,Me.showCollisionBoxes=te.showCollisionBoxes,Me.projection=te.projection,Me.brightness=te.brightness,Me.tileTransform=s.aR(te.tileID.canonical,te.projection),Me.extraShadowCaster=te.extraShadowCaster,Me.lut=te.lut;const Oe=(Ye,Be)=>{const tt=Me.reloadCallback;tt&&(delete Me.reloadCallback,Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,tt)),re(Ye,Be)};Me.status==="parsing"?Me.reloadCallback=Oe:Me.status==="done"&&(Me.vectorTile?Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,Oe):Oe())}else re(null,void 0)}abortTile(te,re){const ye=te.uid,Pe=this.loading[ye];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[ye]),re()}removeTile(te,re){const ye=this.loaded,Pe=te.uid;ye&&ye[Pe]&&delete ye[Pe],re()}}class me{loadTile(te,re){const{uid:ye,encoding:Pe,rawImageData:Me,padding:Oe}=te,Ye=ImageBitmap&&Me instanceof ImageBitmap?this.getImageData(Me,Oe):Me;re(null,new s.ed(ye,Ye,Pe,Oe<1))}reloadTile(te,re){re(null,null)}abortTile(te,re){re()}removeTile(te,re){re()}getImageData(te,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const ye=this.offscreenCanvasContext.getImageData(-re,-re,te.width+2*re,te.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}s.bh.setPbf(s.bi);class Te{constructor(te){this._mrt=new s.bh(te.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=te.uid,this.tileID=te.tileID,this.source=te.source}parse(te,re){const ye=this._mrt;this.status="parsing",this._entireBuffer=te;try{ye.parseHeader(te),this._isHeaderLoaded=!0;const Pe=[];for(const Me in ye.layers){const Oe=ye.getLayer(Me),Ye=Oe.getDataRange(Oe.getBandList()),Be=ye.createDecodingTask(Ye),tt=te.slice(Ye.firstByte,Ye.lastByte+1),rt=s.bh.performDecoding(tt,Be).then(it=>Be.complete(null,it)).catch(it=>Be.complete(it,null));Pe.push(rt)}Promise.allSettled(Pe).then(()=>re(null,ye))}catch(Pe){re(Pe)}}}class ge{constructor(te){this.actor=te,this.loading={},this.loaded={}}loadTile(te,re){const ye=te.uid,Pe=te.request,Me=this.loading[ye]=new Te(te),{cancel:Oe}=s.bj(Pe,(Ye,Be,tt,rt)=>{const it=!this.loading[ye];if(delete this.loading[ye],it||Ye||!Be)return Me.status="done",it||(this.loaded[ye]=Me),re(Ye);Me.parse(Be,(xt,Ot)=>{if(xt||!Ot)return re(xt);re(null,Ot,tt,rt)}),this.loaded[ye]=Me});Me.abort=Oe}reloadTile(te,re){re(null,void 0)}abortTile(te,re){const ye=te.uid,Pe=this.loading[ye];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[ye]),re()}removeTile(te,re){const ye=te.uid;this.loaded[ye]&&delete this.loaded[ye],re()}decodeRasterArray({task:te,buffer:re},ye){s.bh.performDecoding(re,te).then(Pe=>ye(null,Pe)).catch(Pe=>ye(Pe))}}const fe=s.ec.VectorTileFeature.prototype.toGeoJSON;class Ae{constructor(te){this._feature=te,this.extent=s.ai,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const re of this._feature.geometry)te.push([new s.P(re[0],re[1])]);return te}{const te=[];for(const re of this._feature.geometry){const ye=[];for(const Pe of re)ye.push(new s.P(Pe[0],Pe[1]));te.push(ye)}return te}}toGeoJSON(te,re,ye){return fe.call(this,te,re,ye)}}class Ge{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ai,this.length=te.length,this._features=te}feature(te){return new Ae(this._features[te])}}const ze=64/4096,Ke=128;class Xe{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],re){for(const ye of te){const Pe=ye.id;if(Pe==null)continue;let Me=this.features.get(Pe);Me&&this.updateCache(Me,re),ye.geometry?(Me=et(ye),this.updateCache(Me,re),this.features.set(Pe,Me)):this.features.delete(Pe),this.updateCache(Me,re)}}updateCache(te,re){for(const{canonical:ye,uid:Pe}of Object.values(re)){const{z:Me,x:Oe,y:Ye}=ye;Ue(te,Math.pow(2,Me),Oe,Ye)&&delete re[Pe]}}getTile(te,re,ye){const Pe=Math.pow(2,te),Me=[];for(const Oe of this.features.values())Ue(Oe,Pe,re,ye)&&Me.push(bt(Oe,Pe,re,ye));return{features:Me}}getFeatures(){return[...this.features.values()]}}function Ue({minX:nt,minY:te,maxX:re,maxY:ye},Pe,Me,Oe){return nt<(Me+1+ze)/Pe&&te<(Oe+1+ze)/Pe&&re>(Me-ze)/Pe&&ye>(Oe-ze)/Pe}function et(nt){const{id:te,geometry:re,properties:ye}=nt;if(!re)return;if(re.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Pe,coordinates:Me}=re,Oe={id:te,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=Oe.geometry;if(Pe==="Point")lt(Me,Ye,Oe);else if(Pe==="MultiPoint")for(const Be of Me)lt(Be,Ye,Oe);else if(Pe==="LineString")Oe.type=2,Mt(Me,Ye,Oe);else if(Pe==="MultiLineString")Oe.type=2,si(Me,Ye,Oe);else if(Pe==="Polygon")Oe.type=3,si(Me,Ye,Oe,!0);else{if(Pe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Oe.type=3;for(const Be of Me)si(Be,Ye,Oe,!0)}return Oe}function lt([nt,te],re,ye){const Pe=s.av(nt);let Me=s.aC(te);Me=Me<0?0:Me>1?1:Me,re.push(Pe,Me),ye.minX=Math.min(ye.minX,Pe),ye.minY=Math.min(ye.minY,Me),ye.maxX=Math.max(ye.maxX,Pe),ye.maxY=Math.max(ye.maxY,Me)}function Mt(nt,te,re,ye=!1,Pe=!1){const Me=[];for(const Oe of nt)lt(Oe,Me,re);te.push(Me),ye&&function(Oe,Ye){let Be=0;for(let tt=0,rt=Oe.length,it=rt-2;tt<rt;it=tt,tt+=2)Be+=(Oe[tt]-Oe[it])*(Oe[tt+1]+Oe[it+1]);if(Be>0===Ye)for(let tt=0,rt=Oe.length;tt<rt/2;tt+=2){const it=Oe[tt],xt=Oe[tt+1];Oe[tt]=Oe[rt-2-tt],Oe[tt+1]=Oe[rt-1-tt],Oe[rt-2-tt]=it,Oe[rt-1-tt]=xt}}(Me,Pe)}function si(nt,te,re,ye=!1){for(let Pe=0;Pe<nt.length;Pe++)Mt(nt[Pe],te,re,ye,Pe===0)}function bt(nt,te,re,ye){const{id:Pe,type:Me,geometry:Oe,tags:Ye}=nt,Be=[];if(Me===1)(function(tt,rt,it,xt,Ot){for(let Nt=0;Nt<tt.length;Nt+=2){const mi=Math.round(s.ai*(tt[Nt+0]*rt-it)),vi=Math.round(s.ai*(tt[Nt+1]*rt-xt));Ot.push([mi,vi])}})(Oe,te,re,ye,Be);else for(const tt of Oe)Rt(tt,te,re,ye,Be);return{id:Pe,type:Me,geometry:Be,tags:Ye}}function Rt(nt,te,re,ye,Pe){const Me=-Ke,Oe=s.ai+Ke;let Ye;for(let Be=0;Be<nt.length-2;Be+=2){let tt=Math.round(s.ai*(nt[Be+0]*te-re)),rt=Math.round(s.ai*(nt[Be+1]*te-ye)),it=Math.round(s.ai*(nt[Be+2]*te-re)),xt=Math.round(s.ai*(nt[Be+3]*te-ye));const Ot=it-tt,Nt=xt-rt;tt<Me&&it<Me||(tt<Me?(rt+=Math.round(Nt*((Me-tt)/Ot)),tt=Me):it<Me&&(xt=rt+Math.round(Nt*((Me-tt)/Ot)),it=Me),rt<Me&&xt<Me||(rt<Me?(tt+=Math.round(Ot*((Me-rt)/Nt)),rt=Me):xt<Me&&(it=tt+Math.round(Ot*((Me-rt)/Nt)),xt=Me),tt>=Oe&&it>=Oe||(tt>=Oe?(rt+=Math.round(Nt*((Oe-tt)/Ot)),tt=Oe):it>=Oe&&(xt=rt+Math.round(Nt*((Oe-tt)/Ot)),it=Oe),rt>=Oe&&xt>=Oe||(rt>=Oe?(tt+=Math.round(Ot*((Oe-rt)/Nt)),rt=Oe):xt>=Oe&&(it=tt+Math.round(Ot*((Oe-rt)/Nt)),xt=Oe),Ye&&tt===Ye[Ye.length-1][0]&&rt===Ye[Ye.length-1][1]||(Ye=[[tt,rt]],Pe.push(Ye)),Ye.push([it,xt])))))}}var Kt,ii,qt,gn={exports:{}},Hn=function(){if(qt)return gn.exports;qt=1;var nt=s.eg(),te=function(){if(ii)return Kt;ii=1;var rt=s.ee(),it=s.ef().VectorTileFeature;function xt(Nt,mi){this.options=mi||{},this.features=Nt,this.length=Nt.length}function Ot(Nt,mi){this.id=typeof Nt.id=="number"?Nt.id:void 0,this.type=Nt.type,this.rawGeometry=Nt.type===1?[Nt.geometry]:Nt.geometry,this.properties=Nt.tags,this.extent=mi||4096}return Kt=xt,xt.prototype.feature=function(Nt){return new Ot(this.features[Nt],this.options.extent)},Ot.prototype.loadGeometry=function(){var Nt=this.rawGeometry;this.geometry=[];for(var mi=0;mi<Nt.length;mi++){for(var vi=Nt[mi],xi=[],Ti=0;Ti<vi.length;Ti++)xi.push(new rt(vi[Ti][0],vi[Ti][1]));this.geometry.push(xi)}return this.geometry},Ot.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Nt=this.geometry,mi=1/0,vi=-1/0,xi=1/0,Ti=-1/0,_n=0;_n<Nt.length;_n++)for(var On=Nt[_n],Ci=0;Ci<On.length;Ci++){var Ki=On[Ci];mi=Math.min(mi,Ki.x),vi=Math.max(vi,Ki.x),xi=Math.min(xi,Ki.y),Ti=Math.max(Ti,Ki.y)}return[mi,xi,vi,Ti]},Ot.prototype.toGeoJSON=it.prototype.toGeoJSON,Kt}();function re(rt){var it=new nt;return function(xt,Ot){for(var Nt in xt.layers)Ot.writeMessage(3,ye,xt.layers[Nt])}(rt,it),it.finish()}function ye(rt,it){var xt;it.writeVarintField(15,rt.version||1),it.writeStringField(1,rt.name||""),it.writeVarintField(5,rt.extent||4096);var Ot={keys:[],values:[],keycache:{},valuecache:{}};for(xt=0;xt<rt.length;xt++)Ot.feature=rt.feature(xt),it.writeMessage(2,Pe,Ot);var Nt=Ot.keys;for(xt=0;xt<Nt.length;xt++)it.writeStringField(3,Nt[xt]);var mi=Ot.values;for(xt=0;xt<mi.length;xt++)it.writeMessage(4,tt,mi[xt])}function Pe(rt,it){var xt=rt.feature;xt.id!==void 0&&it.writeVarintField(1,xt.id),it.writeMessage(2,Me,rt),it.writeVarintField(3,xt.type),it.writeMessage(4,Be,xt)}function Me(rt,it){var xt=rt.feature,Ot=rt.keys,Nt=rt.values,mi=rt.keycache,vi=rt.valuecache;for(var xi in xt.properties){var Ti=xt.properties[xi],_n=mi[xi];if(Ti!==null){_n===void 0&&(Ot.push(xi),mi[xi]=_n=Ot.length-1),it.writeVarint(_n);var On=typeof Ti;On!=="string"&&On!=="boolean"&&On!=="number"&&(Ti=JSON.stringify(Ti));var Ci=On+":"+Ti,Ki=vi[Ci];Ki===void 0&&(Nt.push(Ti),vi[Ci]=Ki=Nt.length-1),it.writeVarint(Ki)}}}function Oe(rt,it){return(it<<3)+(7&rt)}function Ye(rt){return rt<<1^rt>>31}function Be(rt,it){for(var xt=rt.loadGeometry(),Ot=rt.type,Nt=0,mi=0,vi=xt.length,xi=0;xi<vi;xi++){var Ti=xt[xi],_n=1;Ot===1&&(_n=Ti.length),it.writeVarint(Oe(1,_n));for(var On=Ot===3?Ti.length-1:Ti.length,Ci=0;Ci<On;Ci++){Ci===1&&Ot!==1&&it.writeVarint(Oe(2,On-1));var Ki=Ti[Ci].x-Nt,Ji=Ti[Ci].y-mi;it.writeVarint(Ye(Ki)),it.writeVarint(Ye(Ji)),Nt+=Ki,mi+=Ji}Ot===3&&it.writeVarint(Oe(7,1))}}function tt(rt,it){var xt=typeof rt;xt==="string"?it.writeStringField(1,rt):xt==="boolean"?it.writeBooleanField(7,rt):xt==="number"&&(rt%1!=0?it.writeDoubleField(3,rt):rt<0?it.writeSVarintField(6,rt):it.writeVarintField(5,rt))}return gn.exports=re,gn.exports.fromVectorTileJs=re,gn.exports.fromGeojsonVt=function(rt,it){it=it||{};var xt={};for(var Ot in rt)xt[Ot]=new te(rt[Ot].features,it),xt[Ot].name=Ot,xt[Ot].version=it.version,xt[Ot].extent=it.extent;return re({layers:xt})},gn.exports.GeoJSONWrapper=te,gn.exports}(),Ln=s.eh(Hn);const li={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:nt=>nt},ys=Math.fround||(is=new Float32Array(1),nt=>(is[0]=+nt,is[0]));var is;const Sn=3,hs=5,Ns=6;class Fr{constructor(te){this.options=Object.assign(Object.create(li),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:re,minZoom:ye,maxZoom:Pe}=this.options;re&&console.time("total time");const Me=`prepare ${te.length} points`;re&&console.time(Me),this.points=te;const Oe=[];for(let Be=0;Be<te.length;Be++){const tt=te[Be];if(!tt.geometry)continue;const[rt,it]=tt.geometry.coordinates,xt=ys(vr(rt)),Ot=ys(Ze(it));Oe.push(xt,Ot,1/0,Be,-1,1),this.options.reduce&&Oe.push(0)}let Ye=this.trees[Pe+1]=this._createTree(Oe);re&&console.timeEnd(Me);for(let Be=Pe;Be>=ye;Be--){const tt=+Date.now();Ye=this.trees[Be]=this._createTree(this._cluster(Ye,Be)),re&&console.log("z%d: %d clusters in %dms",Be,Ye.numItems,+Date.now()-tt)}return re&&console.timeEnd("total time"),this}getClusters(te,re){let ye=((te[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,te[1]));let Me=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)ye=-180,Me=180;else if(ye>Me){const it=this.getClusters([ye,Pe,180,Oe],re),xt=this.getClusters([-180,Pe,Me,Oe],re);return it.concat(xt)}const Ye=this.trees[this._limitZoom(re)],Be=Ye.range(vr(ye),Ze(Oe),vr(Me),Ze(Pe)),tt=Ye.data,rt=[];for(const it of Be){const xt=this.stride*it;rt.push(tt[xt+hs]>1?ce(tt,xt,this.clusterProps):this.points[tt[xt+Sn]])}return rt}getChildren(te){const re=this._getOriginId(te),ye=this._getOriginZoom(te),Pe="No cluster with the specified id.",Me=this.trees[ye];if(!Me)throw new Error(Pe);const Oe=Me.data;if(re*this.stride>=Oe.length)throw new Error(Pe);const Ye=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),Be=Me.within(Oe[re*this.stride],Oe[re*this.stride+1],Ye),tt=[];for(const rt of Be){const it=rt*this.stride;Oe[it+4]===te&&tt.push(Oe[it+hs]>1?ce(Oe,it,this.clusterProps):this.points[Oe[it+Sn]])}if(tt.length===0)throw new Error(Pe);return tt}getLeaves(te,re,ye){const Pe=[];return this._appendLeaves(Pe,te,re=re||10,ye=ye||0,0),Pe}getTile(te,re,ye){const Pe=this.trees[this._limitZoom(te)],Me=Math.pow(2,te),{extent:Oe,radius:Ye}=this.options,Be=Ye/Oe,tt=(ye-Be)/Me,rt=(ye+1+Be)/Me,it={features:[]};return this._addTileFeatures(Pe.range((re-Be)/Me,tt,(re+1+Be)/Me,rt),Pe.data,re,ye,Me,it),re===0&&this._addTileFeatures(Pe.range(1-Be/Me,tt,1,rt),Pe.data,Me,ye,Me,it),re===Me-1&&this._addTileFeatures(Pe.range(0,tt,Be/Me,rt),Pe.data,-1,ye,Me,it),it.features.length?it:null}getClusterExpansionZoom(te){let re=this._getOriginZoom(te)-1;for(;re<=this.options.maxZoom;){const ye=this.getChildren(te);if(re++,ye.length!==1)break;te=ye[0].properties.cluster_id}return re}_appendLeaves(te,re,ye,Pe,Me){const Oe=this.getChildren(re);for(const Ye of Oe){const Be=Ye.properties;if(Be&&Be.cluster?Me+Be.point_count<=Pe?Me+=Be.point_count:Me=this._appendLeaves(te,Be.cluster_id,ye,Pe,Me):Me<Pe?Me++:te.push(Ye),te.length===ye)break}return Me}_createTree(te){const re=new s.bE(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<te.length;ye+=this.stride)re.add(te[ye],te[ye+1]);return re.finish(),re.data=te,re}_addTileFeatures(te,re,ye,Pe,Me,Oe){for(const Ye of te){const Be=Ye*this.stride,tt=re[Be+hs]>1;let rt,it,xt;if(tt)rt=dr(re,Be,this.clusterProps),it=re[Be],xt=re[Be+1];else{const mi=this.points[re[Be+Sn]];rt=mi.properties;const[vi,xi]=mi.geometry.coordinates;it=vr(vi),xt=Ze(xi)}const Ot={type:1,geometry:[[Math.round(this.options.extent*(it*Me-ye)),Math.round(this.options.extent*(xt*Me-Pe))]],tags:rt};let Nt;Nt=tt||this.options.generateId?re[Be+Sn]:this.points[re[Be+Sn]].id,Nt!==void 0&&(Ot.id=Nt),Oe.features.push(Ot)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,re){const{radius:ye,extent:Pe,reduce:Me,minPoints:Oe}=this.options,Ye=ye/(Pe*Math.pow(2,re)),Be=te.data,tt=[],rt=this.stride;for(let it=0;it<Be.length;it+=rt){if(Be[it+2]<=re)continue;Be[it+2]=re;const xt=Be[it],Ot=Be[it+1],Nt=te.within(Be[it],Be[it+1],Ye),mi=Be[it+hs];let vi=mi;for(const xi of Nt){const Ti=xi*rt;Be[Ti+2]>re&&(vi+=Be[Ti+hs])}if(vi>mi&&vi>=Oe){let xi,Ti=xt*mi,_n=Ot*mi,On=-1;const Ci=(it/rt<<5)+(re+1)+this.points.length;for(const Ki of Nt){const Ji=Ki*rt;if(Be[Ji+2]<=re)continue;Be[Ji+2]=re;const nn=Be[Ji+hs];Ti+=Be[Ji]*nn,_n+=Be[Ji+1]*nn,Be[Ji+4]=Ci,Me&&(xi||(xi=this._map(Be,it,!0),On=this.clusterProps.length,this.clusterProps.push(xi)),Me(xi,this._map(Be,Ji)))}Be[it+4]=Ci,tt.push(Ti/vi,_n/vi,1/0,Ci,-1,vi),Me&&tt.push(On)}else{for(let xi=0;xi<rt;xi++)tt.push(Be[it+xi]);if(vi>1)for(const xi of Nt){const Ti=xi*rt;if(!(Be[Ti+2]<=re)){Be[Ti+2]=re;for(let _n=0;_n<rt;_n++)tt.push(Be[Ti+_n])}}}}return tt}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,re,ye){if(te[re+hs]>1){const Oe=this.clusterProps[te[re+Ns]];return ye?Object.assign({},Oe):Oe}const Pe=this.points[te[re+Sn]].properties,Me=this.options.map(Pe);return ye&&Me===Pe?Object.assign({},Me):Me}}function ce(nt,te,re){return{type:"Feature",id:nt[te+Sn],properties:dr(nt,te,re),geometry:{type:"Point",coordinates:[(ye=nt[te],360*(ye-.5)),Ie(nt[te+1])]}};var ye}function dr(nt,te,re){const ye=nt[te+hs],Pe=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,Me=nt[te+Ns],Oe=Me===-1?{}:Object.assign({},re[Me]);return Object.assign(Oe,{cluster:!0,cluster_id:nt[te+Sn],point_count:ye,point_count_abbreviated:Pe})}function vr(nt){return nt/360+.5}function Ze(nt){const te=Math.sin(nt*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function Ie(nt){const te=(180-360*nt)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function wt(nt,te,re,ye){let Pe=ye;const Me=te+(re-te>>1);let Oe,Ye=re-te;const Be=nt[te],tt=nt[te+1],rt=nt[re],it=nt[re+1];for(let xt=te+3;xt<re;xt+=3){const Ot=Vt(nt[xt],nt[xt+1],Be,tt,rt,it);if(Ot>Pe)Oe=xt,Pe=Ot;else if(Ot===Pe){const Nt=Math.abs(xt-Me);Nt<Ye&&(Oe=xt,Ye=Nt)}}Pe>ye&&(Oe-te>3&&wt(nt,te,Oe,ye),nt[Oe+2]=Pe,re-Oe>3&&wt(nt,Oe,re,ye))}function Vt(nt,te,re,ye,Pe,Me){let Oe=Pe-re,Ye=Me-ye;if(Oe!==0||Ye!==0){const Be=((nt-re)*Oe+(te-ye)*Ye)/(Oe*Oe+Ye*Ye);Be>1?(re=Pe,ye=Me):Be>0&&(re+=Oe*Be,ye+=Ye*Be)}return Oe=nt-re,Ye=te-ye,Oe*Oe+Ye*Ye}function Bt(nt,te,re,ye){const Pe={id:nt??null,type:te,geometry:re,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")yt(Pe,re);else if(te==="Polygon")yt(Pe,re[0]);else if(te==="MultiLineString")for(const Me of re)yt(Pe,Me);else if(te==="MultiPolygon")for(const Me of re)yt(Pe,Me[0]);return Pe}function yt(nt,te){for(let re=0;re<te.length;re+=3)nt.minX=Math.min(nt.minX,te[re]),nt.minY=Math.min(nt.minY,te[re+1]),nt.maxX=Math.max(nt.maxX,te[re]),nt.maxY=Math.max(nt.maxY,te[re+1])}function Xt(nt,te,re,ye){if(!te.geometry)return;const Pe=te.geometry.coordinates;if(Pe&&Pe.length===0)return;const Me=te.geometry.type,Oe=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let Ye=[],Be=te.id;if(re.promoteId?Be=te.properties[re.promoteId]:re.generateId&&(Be=ye||0),Me==="Point")Zt(Pe,Ye);else if(Me==="MultiPoint")for(const tt of Pe)Zt(tt,Ye);else if(Me==="LineString")Yt(Pe,Ye,Oe,!1);else if(Me==="MultiLineString"){if(re.lineMetrics){for(const tt of Pe)Ye=[],Yt(tt,Ye,Oe,!1),nt.push(Bt(Be,"LineString",Ye,te.properties));return}Ut(Pe,Ye,Oe,!1)}else if(Me==="Polygon")Ut(Pe,Ye,Oe,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const tt of te.geometry.geometries)Xt(nt,{id:Be,geometry:tt,properties:te.properties},re,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const tt of Pe){const rt=[];Ut(tt,rt,Oe,!0),Ye.push(rt)}}nt.push(Bt(Be,Me,Ye,te.properties))}function Zt(nt,te){te.push(Ei(nt[0]),At(nt[1]),0)}function Yt(nt,te,re,ye){let Pe,Me,Oe=0;for(let Be=0;Be<nt.length;Be++){const tt=Ei(nt[Be][0]),rt=At(nt[Be][1]);te.push(tt,rt,0),Be>0&&(Oe+=ye?(Pe*rt-tt*Me)/2:Math.sqrt(Math.pow(tt-Pe,2)+Math.pow(rt-Me,2))),Pe=tt,Me=rt}const Ye=te.length-3;te[2]=1,wt(te,0,Ye,re),te[Ye+2]=1,te.size=Math.abs(Oe),te.start=0,te.end=te.size}function Ut(nt,te,re,ye){for(let Pe=0;Pe<nt.length;Pe++){const Me=[];Yt(nt[Pe],Me,re,ye),te.push(Me)}}function Ei(nt){return nt/360+.5}function At(nt){const te=Math.sin(nt*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function ci(nt,te,re,ye,Pe,Me,Oe,Ye){if(ye/=te,Me>=(re/=te)&&Oe<ye)return nt;if(Oe<re||Me>=ye)return null;const Be=[];for(const tt of nt){const rt=tt.geometry;let it=tt.type;const xt=Pe===0?tt.minX:tt.minY,Ot=Pe===0?tt.maxX:tt.maxY;if(xt>=re&&Ot<ye){Be.push(tt);continue}if(Ot<re||xt>=ye)continue;let Nt=[];if(it==="Point"||it==="MultiPoint")Ai(rt,Nt,re,ye,Pe);else if(it==="LineString")Xi(rt,Nt,re,ye,Pe,!1,Ye.lineMetrics);else if(it==="MultiLineString")un(rt,Nt,re,ye,Pe,!1);else if(it==="Polygon")un(rt,Nt,re,ye,Pe,!0);else if(it==="MultiPolygon")for(const mi of rt){const vi=[];un(mi,vi,re,ye,Pe,!0),vi.length&&Nt.push(vi)}if(Nt.length){if(Ye.lineMetrics&&it==="LineString"){for(const mi of Nt)Be.push(Bt(tt.id,it,mi,tt.tags));continue}it!=="LineString"&&it!=="MultiLineString"||(Nt.length===1?(it="LineString",Nt=Nt[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=Nt.length===3?"Point":"MultiPoint"),Be.push(Bt(tt.id,it,Nt,tt.tags))}}return Be.length?Be:null}function Ai(nt,te,re,ye,Pe){for(let Me=0;Me<nt.length;Me+=3){const Oe=nt[Me+Pe];Oe>=re&&Oe<=ye&&Kn(te,nt[Me],nt[Me+1],nt[Me+2])}}function Xi(nt,te,re,ye,Pe,Me,Oe){let Ye=ji(nt);const Be=Pe===0?ds:Ws;let tt,rt,it=nt.start;for(let vi=0;vi<nt.length-3;vi+=3){const xi=nt[vi],Ti=nt[vi+1],_n=nt[vi+2],On=nt[vi+3],Ci=nt[vi+4],Ki=Pe===0?xi:Ti,Ji=Pe===0?On:Ci;let nn=!1;Oe&&(tt=Math.sqrt(Math.pow(xi-On,2)+Math.pow(Ti-Ci,2))),Ki<re?Ji>re&&(rt=Be(Ye,xi,Ti,On,Ci,re),Oe&&(Ye.start=it+tt*rt)):Ki>ye?Ji<ye&&(rt=Be(Ye,xi,Ti,On,Ci,ye),Oe&&(Ye.start=it+tt*rt)):Kn(Ye,xi,Ti,_n),Ji<re&&Ki>=re&&(rt=Be(Ye,xi,Ti,On,Ci,re),nn=!0),Ji>ye&&Ki<=ye&&(rt=Be(Ye,xi,Ti,On,Ci,ye),nn=!0),!Me&&nn&&(Oe&&(Ye.end=it+tt*rt),te.push(Ye),Ye=ji(nt)),Oe&&(it+=tt)}let xt=nt.length-3;const Ot=nt[xt],Nt=nt[xt+1],mi=Pe===0?Ot:Nt;mi>=re&&mi<=ye&&Kn(Ye,Ot,Nt,nt[xt+2]),xt=Ye.length-3,Me&&xt>=3&&(Ye[xt]!==Ye[0]||Ye[xt+1]!==Ye[1])&&Kn(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&te.push(Ye)}function ji(nt){const te=[];return te.size=nt.size,te.start=nt.start,te.end=nt.end,te}function un(nt,te,re,ye,Pe,Me){for(const Oe of nt)Xi(Oe,te,re,ye,Pe,Me,!1)}function Kn(nt,te,re,ye){nt.push(te,re,ye)}function ds(nt,te,re,ye,Pe,Me){const Oe=(Me-te)/(ye-te);return Kn(nt,Me,re+(Pe-re)*Oe,1),Oe}function Ws(nt,te,re,ye,Pe,Me){const Oe=(Me-re)/(Pe-re);return Kn(nt,te+(ye-te)*Oe,Me,1),Oe}function vs(nt,te){const re=[];for(let ye=0;ye<nt.length;ye++){const Pe=nt[ye],Me=Pe.type;let Oe;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")Oe=Br(Pe.geometry,te);else if(Me==="MultiLineString"||Me==="Polygon"){Oe=[];for(const Ye of Pe.geometry)Oe.push(Br(Ye,te))}else if(Me==="MultiPolygon"){Oe=[];for(const Ye of Pe.geometry){const Be=[];for(const tt of Ye)Be.push(Br(tt,te));Oe.push(Be)}}re.push(Bt(Pe.id,Me,Oe,Pe.tags))}return re}function Br(nt,te){const re=[];re.size=nt.size,nt.start!==void 0&&(re.start=nt.start,re.end=nt.end);for(let ye=0;ye<nt.length;ye+=3)re.push(nt[ye]+te,nt[ye+1],nt[ye+2]);return re}function or(nt,te){if(nt.transformed)return nt;const re=1<<nt.z,ye=nt.x,Pe=nt.y;for(const Me of nt.features){const Oe=Me.geometry,Ye=Me.type;if(Me.geometry=[],Ye===1)for(let Be=0;Be<Oe.length;Be+=2)Me.geometry.push(Ts(Oe[Be],Oe[Be+1],te,re,ye,Pe));else for(let Be=0;Be<Oe.length;Be++){const tt=[];for(let rt=0;rt<Oe[Be].length;rt+=2)tt.push(Ts(Oe[Be][rt],Oe[Be][rt+1],te,re,ye,Pe));Me.geometry.push(tt)}}return nt.transformed=!0,nt}function Ts(nt,te,re,ye,Pe,Me){return[Math.round(re*(nt*ye-Pe)),Math.round(re*(te*ye-Me))]}function on(nt,te,re,ye,Pe){const Me=te===Pe.maxZoom?0:Pe.tolerance/((1<<te)*Pe.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:nt.length,source:null,x:re,y:ye,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of nt)rn(Oe,Ye,Me,Pe);return Oe}function rn(nt,te,re,ye){const Pe=te.geometry,Me=te.type,Oe=[];if(nt.minX=Math.min(nt.minX,te.minX),nt.minY=Math.min(nt.minY,te.minY),nt.maxX=Math.max(nt.maxX,te.maxX),nt.maxY=Math.max(nt.maxY,te.maxY),Me==="Point"||Me==="MultiPoint")for(let Ye=0;Ye<Pe.length;Ye+=3)Oe.push(Pe[Ye],Pe[Ye+1]),nt.numPoints++,nt.numSimplified++;else if(Me==="LineString")Hu(Oe,Pe,nt,re,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let Ye=0;Ye<Pe.length;Ye++)Hu(Oe,Pe[Ye],nt,re,Me==="Polygon",Ye===0);else if(Me==="MultiPolygon")for(let Ye=0;Ye<Pe.length;Ye++){const Be=Pe[Ye];for(let tt=0;tt<Be.length;tt++)Hu(Oe,Be[tt],nt,re,!0,tt===0)}if(Oe.length){let Ye=te.tags||null;if(Me==="LineString"&&ye.lineMetrics){Ye={};for(const tt in te.tags)Ye[tt]=te.tags[tt];Ye.mapbox_clip_start=Pe.start/Pe.size,Ye.mapbox_clip_end=Pe.end/Pe.size}const Be={geometry:Oe,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Ye};te.id!==null&&(Be.id=te.id),nt.features.push(Be)}}function Hu(nt,te,re,ye,Pe,Me){const Oe=ye*ye;if(ye>0&&te.size<(Pe?Oe:ye))return void(re.numPoints+=te.length/3);const Ye=[];for(let Be=0;Be<te.length;Be+=3)(ye===0||te[Be+2]>Oe)&&(re.numSimplified++,Ye.push(te[Be],te[Be+1])),re.numPoints++;Pe&&function(Be,tt){let rt=0;for(let it=0,xt=Be.length,Ot=xt-2;it<xt;Ot=it,it+=2)rt+=(Be[it]-Be[Ot])*(Be[it+1]+Be[Ot+1]);if(rt>0===tt)for(let it=0,xt=Be.length;it<xt/2;it+=2){const Ot=Be[it],Nt=Be[it+1];Be[it]=Be[xt-2-it],Be[it+1]=Be[xt-1-it],Be[xt-2-it]=Ot,Be[xt-1-it]=Nt}}(Ye,Me),nt.push(Ye)}const cc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class fr{constructor(te,re){const ye=(re=this.options=function(Me,Oe){for(const Ye in Oe)Me[Ye]=Oe[Ye];return Me}(Object.create(cc),re)).debug;if(ye&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let Pe=function(Me,Oe){const Ye=[];if(Me.type==="FeatureCollection")for(let Be=0;Be<Me.features.length;Be++)Xt(Ye,Me.features[Be],Oe,Be);else Xt(Ye,Me.type==="Feature"?Me:{geometry:Me},Oe);return Ye}(te,re);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=function(Me,Oe){const Ye=Oe.buffer/Oe.extent;let Be=Me;const tt=ci(Me,1,-1-Ye,Ye,0,-1,2,Oe),rt=ci(Me,1,1-Ye,2+Ye,0,-1,2,Oe);return(tt||rt)&&(Be=ci(Me,1,-Ye,1+Ye,0,-1,2,Oe)||[],tt&&(Be=vs(tt,1).concat(Be)),rt&&(Be=Be.concat(vs(rt,-1)))),Be}(Pe,re),Pe.length&&this.splitTile(Pe,0,0,0),ye&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,re,ye,Pe,Me,Oe,Ye){const Be=[te,re,ye,Pe],tt=this.options,rt=tt.debug;for(;Be.length;){Pe=Be.pop(),ye=Be.pop(),re=Be.pop(),te=Be.pop();const it=1<<re,xt=xl(re,ye,Pe);let Ot=this.tiles[xt];if(!Ot&&(rt>1&&console.time("creation"),Ot=this.tiles[xt]=on(te,re,ye,Pe,tt),this.tileCoords.push({z:re,x:ye,y:Pe}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,ye,Pe,Ot.numFeatures,Ot.numPoints,Ot.numSimplified),console.timeEnd("creation"));const nn=`z${re}`;this.stats[nn]=(this.stats[nn]||0)+1,this.total++}if(Ot.source=te,Me==null){if(re===tt.indexMaxZoom||Ot.numPoints<=tt.indexMaxPoints)continue}else{if(re===tt.maxZoom||re===Me)continue;if(Me!=null){const nn=Me-re;if(ye!==Oe>>nn||Pe!==Ye>>nn)continue}}if(Ot.source=null,te.length===0)continue;rt>1&&console.time("clipping");const Nt=.5*tt.buffer/tt.extent,mi=.5-Nt,vi=.5+Nt,xi=1+Nt;let Ti=null,_n=null,On=null,Ci=null,Ki=ci(te,it,ye-Nt,ye+vi,0,Ot.minX,Ot.maxX,tt),Ji=ci(te,it,ye+mi,ye+xi,0,Ot.minX,Ot.maxX,tt);te=null,Ki&&(Ti=ci(Ki,it,Pe-Nt,Pe+vi,1,Ot.minY,Ot.maxY,tt),_n=ci(Ki,it,Pe+mi,Pe+xi,1,Ot.minY,Ot.maxY,tt),Ki=null),Ji&&(On=ci(Ji,it,Pe-Nt,Pe+vi,1,Ot.minY,Ot.maxY,tt),Ci=ci(Ji,it,Pe+mi,Pe+xi,1,Ot.minY,Ot.maxY,tt),Ji=null),rt>1&&console.timeEnd("clipping"),Be.push(Ti||[],re+1,2*ye,2*Pe),Be.push(_n||[],re+1,2*ye,2*Pe+1),Be.push(On||[],re+1,2*ye+1,2*Pe),Be.push(Ci||[],re+1,2*ye+1,2*Pe+1)}}getTile(te,re,ye){te=+te,re=+re,ye=+ye;const Pe=this.options,{extent:Me,debug:Oe}=Pe;if(te<0||te>24)return null;const Ye=1<<te,Be=xl(te,re=re+Ye&Ye-1,ye);if(this.tiles[Be])return or(this.tiles[Be],Me);Oe>1&&console.log("drilling down to z%d-%d-%d",te,re,ye);let tt,rt=te,it=re,xt=ye;for(;!tt&&rt>0;)rt--,it>>=1,xt>>=1,tt=this.tiles[xl(rt,it,xt)];return tt&&tt.source?(Oe>1&&(console.log("found parent tile z%d-%d-%d",rt,it,xt),console.time("drilling down")),this.splitTile(tt.source,rt,it,xt,te,re,ye),Oe>1&&console.timeEnd("drilling down"),this.tiles[Be]?or(this.tiles[Be],Me):null):null}}function xl(nt,te,re){return 32*((1<<nt)*re+te)+nt}function Gu(nt,te){const re=nt.tileID.canonical;if(!this._geoJSONIndex)return void te(null,null);const ye=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!ye)return void te(null,null);const Pe=new Ge(ye.features);let Me=Ln(Pe);Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),te(null,{vectorTile:Pe,rawData:Me.buffer})}class uc extends de{constructor(te,re,ye,Pe,Me,Oe){super(te,re,ye,Pe,Gu,Oe),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new Xe}loadData(te,re){const ye=te&&te.request,Pe=ye&&ye.collectResourceTiming;this.loadGeoJSON(te,(Me,Oe)=>{if(Me||!Oe)return re(Me);if(typeof Oe!="object")return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const Be=s.X(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));Oe.features=Oe.features.filter(tt=>Be.value.evaluate({zoom:0},tt))}te.dynamic?(Oe.type==="Feature"&&(Oe={type:"FeatureCollection",features:[Oe]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Oe.features,this.loaded),te.cluster&&(Oe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new Fr(function({superclusterOptions:Be,clusterProperties:tt}){if(!tt||!Be)return Be;const rt={},it={},xt={accumulated:null,zoom:0},Ot={properties:null},Nt=Object.keys(tt);for(const mi of Nt){const[vi,xi]=tt[mi],Ti=s.X(xi),_n=s.X(typeof vi=="string"?[vi,["accumulated"],["get",mi]]:vi);rt[mi]=Ti.value,it[mi]=_n.value}return Be.map=mi=>{Ot.properties=mi;const vi={};for(const xi of Nt)vi[xi]=rt[xi].evaluate(xt,Ot);return vi},Be.reduce=(mi,vi)=>{Ot.properties=vi;for(const xi of Nt)xt.accumulated=mi[xi],mi[xi]=it[xi].evaluate(xt,Ot)},Be}(te)).load(Oe.features):te.dynamic?this._dynamicIndex:function(Be,tt){return new fr(Be,tt)}(Oe,te.geojsonVtOptions)}catch(Be){return re(Be)}const Ye={};if(Pe){const Be=I(ye);Be&&(Ye.resourceTiming={},Ye.resourceTiming[te.source]=JSON.parse(JSON.stringify(Be)))}re(null,Ye)}})}reloadTile(te,re){const ye=this.loaded;return ye&&ye[te.uid]?te.partial?re(null,void 0):super.reloadTile(te,re):this.loadTile(te,re)}loadGeoJSON(te,re){if(te.request)s.n(te.request,re);else{if(typeof te.data!="string")return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(te.data))}catch{return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(ye){re(ye)}}getClusterChildren(te,re){try{re(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(ye){re(ye)}}getClusterLeaves(te,re){try{re(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(ye){re(ye)}}}class Td{constructor(te,re){this.tileID=new s.aH(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=re}parse(te,re,ye,Pe){this.status="parsing";const Me=new s.aH(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Oe=[],Ye=re.familiesBySource[ye.source],Be=new s.e0(Me,ye.promoteId);return Be.bucketLayerIDs=[],Be.is3DTile=!0,s.ei(te).then(tt=>{if(!tt)return Pe(new Error("Could not parse tile"));const rt=s.ej(tt,1/s.cd(ye.tileID.canonical)),it=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("MAPBOX_mesh_features")||tt.json.asset.extras&&tt.json.asset.extras.MAPBOX_mesh_features,xt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("EXT_meshopt_compression"),Ot=new s.aa(this.zoom,{brightness:this.brightness});for(const Nt in Ye)for(const mi of Ye[Nt]){const vi=mi[0];Be.bucketLayerIDs.push(mi.map(Ti=>s.C(Ti.id,Ti.scope))),vi.recalculate(Ot,[]);const xi=new s.ek(mi,rt,Me,it,xt,this.brightness,Be);it||(xi.needsUpload=!0),Oe.push(xi),xi.evaluate(vi)}this.status="done",Pe(null,{buckets:Oe,featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(tt=>Pe(new Error(tt.message)))}}class Ed{constructor(te,re,ye,Pe,Me,Oe){this.actor=te,this.layerIndex=re,this.availableImages=ye,this.brightness=Oe,this.loading={},this.loaded={}}loadTile(te,re){const ye=te.uid,Pe=this.loading[ye]=new Td(te,this.brightness);s.bj(te.request,(Me,Oe)=>{const Ye=!this.loading[ye];return delete this.loading[ye],Ye||Me?(Pe.status="done",Ye||(this.loaded[ye]=Pe),re(Me)):Oe&&Oe.byteLength!==0?void Pe.parse(Oe,this.layerIndex,te,(Be,tt)=>{Pe.status="done",this.loaded=this.loaded||{},this.loaded[ye]=Pe,Be||!tt?re(Be):re(null,tt)}):(Pe.status="done",this.loaded[ye]=Pe,re())})}reloadTile(te,re){const ye=this.loaded,Pe=te.uid;if(ye&&ye[Pe]){const Me=ye[Pe];Me.projection=te.projection,Me.brightness=te.brightness;const Oe=(Ye,Be)=>{Me.reloadCallback&&(delete Me.reloadCallback,this.loadTile(te,re)),re(Ye,Be)};Me.status==="parsing"?Me.reloadCallback=Oe:Me.status==="done"&&this.loadTile(te,re)}}abortTile(te,re){const ye=te.uid;this.loading[ye]&&delete this.loading[ye],re()}removeTile(te,re){const ye=this.loaded,Pe=te.uid;ye&&ye[Pe]&&delete ye[Pe],re()}}class qu{constructor(te){this.self=te,this.actor=new s.el(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.projections={},this.defaultProjection=s.bP({name:"mercator"}),this.workerSourceTypes={vector:de,geojson:uc,"raster-dem":me,"raster-array":ge,"batched-model":Ed},this.workerSources={},this.self.registerWorkerSource=(re,ye)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=ye},this.self.registerRTLTextPlugin=re=>{if(s.em.isParsed())throw new Error("RTL text plugin already registered.");s.em.applyArabicShaping=re.applyArabicShaping,s.em.processBidirectionalText=re.processBidirectionalText,s.em.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(te,re,ye){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],ye()}checkIfReady(te,re,ye){ye()}setReferrer(te,re){this.referrer=re}spriteLoaded(te,{scope:re,isLoaded:ye}){if(this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.isSpriteLoaded[te][re]=ye,this.workerSources[te]&&this.workerSources[te][re])for(const Pe in this.workerSources[te][re]){const Me=this.workerSources[te][re][Pe];for(const Oe in Me){const Ye=Me[Oe];Ye instanceof de&&(Ye.isSpriteLoaded=ye,Ye.fire(new s.A("isSpriteLoaded")))}}}setImages(te,{scope:re,images:ye},Pe){if(this.availableImages[te]||(this.availableImages[te]={}),this.availableImages[te][re]=ye,this.workerSources[te]&&this.workerSources[te][re]){for(const Me in this.workerSources[te][re]){const Oe=this.workerSources[te][re][Me];for(const Ye in Oe)Oe[Ye].availableImages=ye}Pe()}else Pe()}setProjection(te,re){this.projections[te]=s.bP(re)}setBrightness(te,re,ye){this.brightness=re,ye()}setLayers(te,re,ye){this.getLayerIndex(te,re.scope).replace(re.layers,re.options),ye()}updateLayers(te,re,ye){this.getLayerIndex(te,re.scope).update(re.layers,re.removedIds,re.options),ye()}loadTile(te,re,ye){re.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source,re.scope).loadTile(re,ye)}decodeRasterArray(te,re,ye){this.getWorkerSource(te,re.type,re.source,re.scope).decodeRasterArray(re,ye)}reloadTile(te,re,ye){re.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source,re.scope).reloadTile(re,ye)}abortTile(te,re,ye){this.getWorkerSource(te,re.type,re.source,re.scope).abortTile(re,ye)}removeTile(te,re,ye){this.getWorkerSource(te,re.type,re.source,re.scope).removeTile(re,ye)}removeSource(te,re,ye){if(!(this.workerSources[te]&&this.workerSources[te][re.scope]&&this.workerSources[te][re.scope][re.type]&&this.workerSources[te][re.scope][re.type][re.source]))return;const Pe=this.workerSources[te][re.scope][re.type][re.source];delete this.workerSources[te][re.scope][re.type][re.source],Pe.removeSource!==void 0?Pe.removeSource(re,ye):ye()}loadWorkerSource(te,re,ye){try{this.self.importScripts(re.url),ye()}catch(Pe){ye(Pe.toString())}}syncRTLPluginState(te,re,ye){try{s.em.setState(re);const Pe=s.em.getPluginURL();if(s.em.isLoaded()&&!s.em.isParsed()&&Pe!=null){this.self.importScripts(Pe);const Me=s.em.isParsed();ye(Me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Pe}`),Me)}}catch(Pe){ye(Pe.toString())}}setDracoUrl(te,re){this.dracoUrl=re}getAvailableImages(te,re){this.availableImages[te]||(this.availableImages[te]={});let ye=this.availableImages[te][re];return ye||(ye=[]),ye}getLayerIndex(te,re){this.layerIndexes[te]||(this.layerIndexes[te]={});let ye=this.layerIndexes[te][re];return ye||(ye=this.layerIndexes[te][re]=new j,ye.scope=re),ye}getWorkerSource(te,re,ye,Pe){const Me=this.workerSources;return Me[te]||(Me[te]={}),Me[te][Pe]||(Me[te][Pe]={}),Me[te][Pe][re]||(Me[te][Pe][re]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),Me[te][Pe][re][ye]||(Me[te][Pe][re][ye]=new this.workerSourceTypes[re]({send:(Oe,Ye,Be,tt,rt,it)=>{this.actor.send(Oe,Ye,Be,te,rt,it)},scheduler:this.actor.scheduler},this.getLayerIndex(te,Pe),this.getAvailableImages(te,Pe),this.isSpriteLoaded[te][Pe],void 0,this.brightness)),Me[te][Pe][re][ye]}rasterizeImages(te,re,ye){const Pe=new Map;for(const[Me,{image:Oe,imageVariant:Ye}]of re.tasks.entries()){const Be=this.imageRasterizer.rasterize(Ye,Oe,re.scope,te);Pe.set(Me,Be)}ye(void 0,Pe)}removeRasterizedImages(te,re,ye){this.imageRasterizer.removeImagesFromCacheByIds(re.imageIds,re.scope,te),ye()}enforceCacheSizeLimit(te,re){s.en(re)}getWorkerPerformanceMetrics(te,re,ye){ye(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new qu(self)),qu}),_(["./shared"],function(s){var I="3.11.0";const O={create:"create",load:"load",fullLoad:"fullLoad"},k={mark(m){performance.mark(m)},measure(m,n,a){performance.measure(m,n,a)}};function j(m){const n=m.name.split("?")[0];return s.a(n)&&n.includes("mapbox-gl.js")?"javascript":s.a(n)&&n.includes("mapbox-gl.css")?"css":s.b(n)?"fontRange":s.c(n)?"sprite":s.i(n)?"style":s.d(n)?"tilejson":"other"}var Z,Y={},se=function(){if(Z)return Y;function m(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,D=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(D);try{T=new Worker(L),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(L),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var D=T.getImageData(0,0,1,1);return D&&D.width===b.width}()?(a[v=p&&p.failIfMajorPerformanceCaveat]===void 0&&(a[v]=function(b){var T,D=function(L){var z=document.createElement("canvas"),F=Object.create(m.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=L,z.getContext("webgl2",F)}(b);if(!D)return!1;try{T=D.createShader(D.VERTEX_SHADER)}catch{return!1}return!(!T||D.isContextLost())&&(D.shaderSource(T,"void main() {}"),D.compileShader(T),D.getShaderParameter(T,D.COMPILE_STATUS)===!0)}(v)),a[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}Z=1,Y.supported=m,Y.notSupportedReason=n;var a={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Y}();function ne(m,n,a){const p=document.createElement(m);return n!=null&&(p.className=n),a&&a.appendChild(p),p}function de(m,n,a){const p=document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(n))p.setAttributeNS(null,v,String(n[v]));return a&&a.appendChild(p),p}const me=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Te=me&&me.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ge;function fe(){me&&Te&&(ge=me[Te],me[Te]="none")}function Ae(){me&&Te&&(me[Te]=ge)}function Ge(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Ge,!0)}function ze(){window.addEventListener("click",Ge,!0),window.setTimeout(()=>{window.removeEventListener("click",Ge,!0)},0)}function Ke(m,n){const a=m.getBoundingClientRect();return et(m,a,n)}function Xe(m,n){const a=m.getBoundingClientRect(),p=[];for(let v=0;v<n.length;v++)p.push(et(m,a,n[v]));return p}function Ue(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function et(m,n,a){const p=m.offsetWidth===n.width?1:m.offsetWidth/n.width;return new s.P((a.clientX-n.left)*p,(a.clientY-n.top)*p)}const lt="01",Mt="NO_ACCESS_TOKEN";class si{constructor(n,a,p){this._transformRequestFn=n,this._customAccessToken=a,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=function(){let a="";for(let p=0;p<10;p++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",lt,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,a){return this._transformRequestFn&&this._transformRequestFn(n,a)||{url:n}}normalizeStyleURL(n,a){if(!s.f(n))return n;const p=Rt(n);return p.params.push(`sdk=js-${I}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeGlyphsURL(n,a){if(!s.f(n))return n;const p=Rt(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeModelURL(n,a){if(!s.f(n))return n;const p=Rt(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeSourceURL(n,a,p,v){if(!s.f(n))return n;const b=Rt(n);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),v&&b.params.push(`worldview=${v}`),this._makeAPIURL(b,this._customAccessToken||a)}normalizeIconsetURL(n,a){const p=Rt(n);return s.f(n)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||a)):Kt(p)}normalizeSpriteURL(n,a,p,v){const b=Rt(n);return s.f(n)?(b.path=`/styles/v1${b.path}/sprite${a}${p}`,this._makeAPIURL(b,this._customAccessToken||v)):(b.path+=`${a}${p}`,Kt(b))}normalizeTileURL(n,a,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!s.f(n))return n;const v=Rt(n);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||p&&v.authority!=="raster"&&p===512?"@2x":""}${s.m.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${s.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${s.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${s.e.TILE_URL_VERSION}${v.path}`);const b=this._customAccessToken||function(T){for(const D of T){const L=D.match(/^access_token=(.*)$/);if(L)return L[1]}return null}(v.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,b)}canonicalizeTileURL(n,a){const p=Rt(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let v="mapbox://";p.path.match(/^\/raster\/v1\//)?v+=`raster/${p.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${p.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${p.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return a&&(b=b.filter(T=>!T.match(/^access_token=/))),b.length&&(v+=`?${b.join("&")}`),v}canonicalizeTileset(n,a){const p=!!a&&s.f(a),v=[];for(const b of n.tiles||[])s.h(b)?v.push(this.canonicalizeTileURL(b,p)):v.push(b);return v}_makeAPIURL(n,a){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=Rt(s.e.API_URL);if(n.protocol=v.protocol,n.authority=v.authority,n.protocol==="http"){const b=n.params.indexOf("secure");b>=0&&n.params.splice(b,1)}if(v.path!=="/"&&(n.path=`${v.path}${n.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Kt(n);if(a=a||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter(b=>b.indexOf("access_token")===-1),n.params.push(`access_token=${a||""}`),Kt(n)}}const bt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Rt(m){const n=m.match(bt);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Kt(m){const n=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${n}`}const ii="mapbox.eventData";function qt(m){if(!m)return null;const n=m.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(s.j(n[1]))}catch{return null}}class gn{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const a=qt(s.e.ACCESS_TOKEN);let p="";return p=a&&a.u?s.k(a.u):s.e.ACCESS_TOKEN||"",n?`${ii}.${n}:${p}`:`${ii}:${p}`}fetchEventData(){const n=s.s("localStorage"),a=this.getStorageKey(),p=this.getStorageKey("uuid");if(n)try{const v=localStorage.getItem(a);v&&(this.eventData=JSON.parse(v));const b=localStorage.getItem(p);b&&(this.anonId=b)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const n=s.s("localStorage"),a=this.getStorageKey(),p=this.getStorageKey("uuid"),v=this.anonId;if(n&&v)try{localStorage.setItem(p,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,a,p,v){if(!s.e.EVENTS_URL)return;const b=Rt(s.e.EVENTS_URL);b.params.push(`access_token=${v||s.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(n).toISOString()},D=a?s.l(T,a):T,L={url:Kt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};this.pendingRequest=s.p(L,z=>{this.pendingRequest=null,p(z),this.saveEventData(),this.processRequests(v)})}queueRequest(n,a){this.queue.push(n),this.processRequests(a)}}const Hn=new class extends gn{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,n){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(a=>s.f(a)||s.h(a))&&this.queueRequest(Date.now(),n)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=qt(s.e.ACCESS_TOKEN),a=n?n.u:s.e.ACCESS_TOKEN;let p=a!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),p=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(v),D=(v-this.eventData.lastSuccess)/864e5;p=p||D>=1||D<-1||b.getDate()!==T.getDate()}else p=!0;p?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:lt,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=v,this.eventData.tokenU=a)},m):this.processRequests()}},Ln=Hn.postTurnstileEvent.bind(Hn),li=new class extends gn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,n,a,p){this.skuToken=n,this.errorCb=p,s.e.EVENTS_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},a):this.errorCb(new Error(Mt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:lt,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},m))}remove(){this.errorCb=null}},ys=li.postMapLoadEvent.bind(li),is=new class extends gn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let n=this.mapInstanceIdMap.get(m);return n||(n=s.u(),this.mapInstanceIdMap.set(m,n)),n}getEventId(m){const n=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,n+1),n}postStyleLoadEvent(m,n){const{map:a,style:p,importedStyles:v}=n;if(!s.e.EVENTS_URL||!m&&!s.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(a),T={mapInstanceId:b,eventId:this.getEventId(b),style:p};v.length&&(T.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:T},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:a}=this.queue.shift();this.postEvent(n,a,()=>{},m)}},Sn=is.postStyleLoadEvent.bind(is),hs=new class extends gn{constructor(){super("gljs.performance")}postPerformanceEvent(m,n){s.e.EVENTS_URL&&(m||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:a}=this.queue.shift(),p=function(v){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),D=function(q){const J={};if(q){for(const X in q)if(X!=="other")for(const ee of q[X]){const ie=`${X}ResolveRangeMin`,le=`${X}ResolveRangeMax`,_e=`${X}RequestCount`,pe=`${X}RequestCachedCount`;J[ie]=Math.min(J[ie]||1/0,ee.startTime),J[le]=Math.max(J[le]||-1/0,ee.responseEnd);const we=ve=>{J[ve]===void 0&&(J[ve]=0),++J[ve]};ee.transferSize!==void 0&&ee.transferSize===0&&we(pe),we(_e)}}return J}(function(q,J){const X={};if(q)for(const ee of q){const ie=J(ee);X[ie]===void 0&&(X[ie]=[]),X[ie].push(ee)}return X}(b,j)),L=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=z?z.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},U=(q,J,X)=>{X!=null&&q.push({name:J,value:X.toString()})};for(const q in D)U(V.counters,q,D[q]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(U(V.counters,"interactionRangeMin",v.interactionRange[0]),U(V.counters,"interactionRangeMax",v.interactionRange[1])),T)for(const q of Object.keys(O)){const J=O[q],X=T.find(ee=>ee.name===J);X&&U(V.counters,J,X.startTime)}return U(V.counters,"visibilityHidden",v.visibilityHidden),U(V.attributes,"style",function(q){if(q)for(const J of q){const X=J.name.split("?")[0];if(s.i(X)){const ee=X.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(b)),U(V.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),U(V.attributes,"fogEnabled",v.fogEnabled?"true":"false"),U(V.attributes,"projection",v.projection),U(V.attributes,"zoom",v.zoom),U(V.metadata,"devicePixelRatio",L),U(V.metadata,"connectionEffectiveType",F),U(V.metadata,"navigatorUserAgent",navigator.userAgent),U(V.metadata,"screenWidth",window.screen.width),U(V.metadata,"screenHeight",window.screen.height),U(V.metadata,"windowWidth",window.innerWidth),U(V.metadata,"windowHeight",window.innerHeight),U(V.metadata,"mapWidth",v.width/L),U(V.metadata,"mapHeight",v.height/L),U(V.metadata,"webglRenderer",v.renderer),U(V.metadata,"webglVendor",v.vendor),U(V.metadata,"sdkVersion",I),U(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(a);for(const v of p.metadata);for(const v of p.counters);for(const v of p.attributes);this.postEvent(n,p,()=>{},m)}},Ns=hs.postPerformanceEvent.bind(hs),Fr=new class extends gn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,n,a,p){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const v=Rt(s.e.API_URL+s.e.SESSION_PATH);v.params.push(`sku=${n||""}`),v.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const b={url:Kt(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(b,T=>{this.pendingRequest=null,a(T),this.saveEventData(),this.processRequests(p)})}getSessionAPI(m,n,a,p){this.skuToken=n,this.errorCb=p,s.e.SESSION_PATH&&s.e.API_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},a):this.errorCb(new Error(Mt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||this.getSession(a,this.skuToken,p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},m)}remove(){this.errorCb=null}},ce=Fr.getSessionAPI.bind(Fr),dr=new Set;function vr(m,n){n?dr.add(m):dr.delete(m)}class Ze{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,a){this._updatedSourceCaches[n]=a,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const a=n.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(n.id),this.setDirty()}removeLayer(n){const a=n.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][n.id]=n,this._updatedLayers[a].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const a in this._updatedLayers)n[a]=n[a]||{},n[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)n[a]=n[a]||{},n[a].removedIds=Object.keys(this._removedLayers[a]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(s.I.toString(n)),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ie(m){const{userImage:n}=m;return!!(n&&n.render&&n.render())&&(m.data.replace(new Uint8Array(n.data.buffer)),!0)}class wt extends s.E{constructor(n){super(),this._images={},this._iconsets={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.patternsInFlight=new Set,this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=n,n!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}createScope(n){this._images[n]={},this._iconsets[n]={},this.loaded[n]=!1,this.updatedImages[n]=new Set,this.patterns[n]={},this.callbackDispatchedThisFrame[n]=new Set,this.atlasImage[n]=new s.r({width:1,height:1})}createIconset(n,a){this._iconsets[n][a]={}}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,a){if(this.loaded[a]!==n&&(this.loaded[a]=n,n)){for(const{ids:p,callback:v}of this.requestors)this._notify(p,a,v);this.requestors=[]}}hasImage(n,a){return!!this.getImage(n,a)}getImage(n,a){return(n.iconsetId?this._iconsets[a][n.iconsetId]:this._images[a])[n.name]}addImage(n,a,p){const v=n.iconsetId?this._iconsets[a][n.iconsetId]:this._images[a];this._validate(n,p)&&(v[n.name]=p)}_validate(n,a){let p=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.z(new Error(`Image "${n.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.z(new Error(`Image "${n.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(a.content,a)||(this.fire(new s.z(new Error(`Image "${n.name}" has invalid "content" value`))),p=!1),p}_validateStretch(n,a){if(!n)return!0;let p=0;for(const v of n){if(v[0]<p||v[1]<v[0]||a<v[1])return!1;p=v[1]}return!0}_validateContent(n,a){return n?n.length!==4||!a.usvg&&(n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,a,p){const v=n.iconsetId?this._iconsets[a][n.iconsetId]:this._images[a];p.version=v[n.name].version+1,v[n.name]=p,this.updatedImages[a].add(n),this.removeFromImageRasterizerCache(n,a)}clearUpdatedImages(n){this.updatedImages[n].clear()}removeFromImageRasterizerCache(n,a){if(this.spriteFormat!=="raster")if(s.t()){const p={imageIds:[n],scope:a};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",p)}else this.imageRasterizer.removeImagesFromCacheByIds([n],a)}removeImage(n,a){const p=n.iconsetId?this._iconsets[a][n.iconsetId]:this._images[a],v=p[n.name];delete p[n.name],delete this.patterns[a][n.name],this.removeFromImageRasterizerCache(n,a),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(n){const a=[];for(const p of Object.keys(this._images[n]))a.push(new s.I(p));for(const p in this._iconsets[n])for(const v of Object.keys(this._iconsets[n][p]))a.push(new s.I({name:v,iconsetId:p}));return a}getImages(n,a,p){let v=!0;const b=!!this.loaded[a];if(!b)for(const T of n)(T.iconsetId?this._iconsets[a][T.iconsetId]:this._images[a])[T.name]||(v=!1);b||v?this._notify(n,a,p):this.requestors.push({ids:n,scope:a,callback:p})}rasterizeImages({scope:n,tasks:a},p){const v=new Map;for(const[b,T]of a.entries()){const D=this.getImage(T.id,n);D&&v.set(b,{image:D,imageVariant:T})}this._rasterizeImages(n,v,p)}_rasterizeImages(n,a,p){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:a,scope:n},p);else{const v=new Map;for(const[b,{image:T,imageVariant:D}]of a.entries())v.set(b,this.imageRasterizer.rasterize(D,T,n,0));p(void 0,v)}}getUpdatedImages(n){return this.updatedImages[n]||new Set}_notify(n,a,p){const v=new Map;for(const b of n){b.iconsetId&&(this._iconsets[a][b.iconsetId]=this._iconsets[a][b.iconsetId]||{});const T=(b.iconsetId?this._iconsets[a][b.iconsetId]:this._images[a])[b.name];if(!T){if(b.iconsetId)continue;s.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new s.A("styleimagemissing",{id:b.name}));continue}const D={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)};T.usvg&&Object.assign(D,{width:T.icon.usvg_tree.width,height:T.icon.usvg_tree.height}),v.set(s.I.toString(b),D)}p(null,v)}getPixelSize(n){const{width:a,height:p}=this.atlasImage[n];return{width:a,height:p}}getPattern(n,a,p){const v=this.patterns[a][n.name],b=this.getImage(n,a);if(!b)return null;if(v){if(v.position.version===b.version)return v.position;v.position.version=b.version}else{if(b.usvg&&!b.data){const T=this.getPatternInFlightId(n.toString(),a);if(this.patternsInFlight.has(T))return null;this.patternsInFlight.add(T);const D=new s.B(n).scaleSelf(s.q.devicePixelRatio),L=new Map([[D.toString(),{image:b,imageVariant:D}]]);return this._rasterizeImages(a,L,(z,F)=>this.storePatternImage(D,a,b,p,F)),null}this.storePattern(n,a,b)}return this._updatePatternAtlas(a,p),this.patterns[a][n.name].position}getPatternInFlightId(n,a){return s.C(n,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,a,p,v,b){const T=n.toString(),D=b?b.get(T):void 0;D&&(p.data=D,this.storePattern(n.id,a,p),this._updatePatternAtlas(a,v),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),a)))}storePattern(n,a,p){const v={w:p.data.width+2*s.F,h:p.data.height+2*s.F,x:0,y:0},b=new s.G(v,p,s.F);this.patterns[a][n.name]={bin:v,position:b}}bind(n,a){const p=n.gl;let v=this.atlasTexture[a];v?this.dirty&&(v.update(this.atlasImage[a]),this.dirty=!1):(v=new s.T(n,this.atlasImage[a],p.RGBA8),this.atlasTexture[a]=v),v.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,a){const p=[];for(const D in this.patterns[n])p.push(this.patterns[n][D].bin);const{w:v,h:b}=s.H(p),T=this.atlasImage[n];T.resize({width:v||1,height:b||1});for(const D in this.patterns[n]){const{bin:L,position:z}=this.patterns[n][D];let F=z.padding;const V=L.x+F,U=L.y+F,q=this._images[n][D].data,J=q.width,X=q.height;F=F>1?F-1:F,s.r.copy(q,T,{x:0,y:0},{x:V,y:U},{width:J,height:X},a),s.r.copy(q,T,{x:0,y:X-F},{x:V,y:U-F},{width:J,height:F},a),s.r.copy(q,T,{x:0,y:0},{x:V,y:U+X},{width:J,height:F},a),s.r.copy(q,T,{x:J-F,y:0},{x:V-F,y:U},{width:F,height:X},a),s.r.copy(q,T,{x:0,y:0},{x:V+J,y:U},{width:F,height:X},a),s.r.copy(q,T,{x:J-F,y:X-F},{x:V-F,y:U-F},{width:F,height:F},a),s.r.copy(q,T,{x:0,y:X-F},{x:V+J,y:U-F},{width:F,height:F},a),s.r.copy(q,T,{x:0,y:0},{x:V+J,y:U+X},{width:F,height:F},a),s.r.copy(q,T,{x:J-F,y:0},{x:V-F,y:U+X},{width:F,height:F},a)}this.dirty=!0}beginFrame(){for(const n in this._images)this.callbackDispatchedThisFrame[n]=new Set}dispatchRenderCallbacks(n,a){for(const p of n){if(this.callbackDispatchedThisFrame[a].has(p.toString()))continue;this.callbackDispatchedThisFrame[a].add(p.toString());const v=(p.iconsetId?this._iconsets[a][p.iconsetId]:this._images[a])[p.name];Ie(v)&&this.updateImage(p,a,v)}}}function Vt(m){const n=m.key,a=m.value,p=m.valueSpec||{},v=m.objectElementValidators||{},b=m.style,T=m.styleSpec;let D=[];const L=s.K(a);if(L!=="object")return[new s.V(n,a,`object expected, ${L} found`)];for(const z in a){const F=z.split(".")[0];let V;v[F]?V=v[F]:p[F]?V=rn:v["*"]?V=v["*"]:p["*"]&&(V=rn),V?D=D.concat(V({key:(n&&`${n}.`)+z,value:a[z],valueSpec:p[F]||p["*"],style:b,styleSpec:T,object:a,objectKey:z},a)):D.push(new s.J(n,a[z],`unknown property "${z}"`))}for(const z in p)v[z]||p[z].required&&p[z].default===void 0&&a[z]===void 0&&D.push(new s.V(n,a,`missing required property "${z}"`));return D}function Bt(m){const n=m.value,a=m.valueSpec,p=m.style,v=m.styleSpec,b=m.key,T=m.arrayElementValidator||rn;if(s.K(n)!=="array")return[new s.V(b,n,`array expected, ${s.K(n)} found`)];if(a.length&&n.length!==a.length)return[new s.V(b,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new s.V(b,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let D={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};v.$version<7&&(D.function=a.function),s.K(a.value)==="object"&&(D=a.value);let L=[];for(let z=0;z<n.length;z++)L=L.concat(T({array:n,arrayIndex:z,value:n[z],valueSpec:D,style:p,styleSpec:v,key:`${b}[${z}]`},!0));return L}function yt(m){const n=m.key,a=m.value,p=m.valueSpec;let v=s.K(a);if(v==="number"&&a!=a&&(v="NaN"),v!=="number")return[new s.V(n,a,`number expected, ${v} found`)];if("minimum"in p){let b=p.minimum;if(s.K(p.minimum)==="array"&&(b=p.minimum[m.arrayIndex]),a<b)return[new s.V(n,a,`${a} is less than the minimum value ${b}`)]}if("maximum"in p){let b=p.maximum;if(s.K(p.maximum)==="array"&&(b=p.maximum[m.arrayIndex]),a>b)return[new s.V(n,a,`${a} is greater than the maximum value ${b}`)]}return[]}function Xt(m){const n=m.valueSpec,a=s.M(m.value.type);let p,v,b,T={};const D=a!=="categorical"&&m.value.property===void 0,L=!D,z=s.K(m.value.stops)==="array"&&s.K(m.value.stops[0])==="array"&&s.K(m.value.stops[0][0])==="object",F=Vt({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(q){if(a==="identity")return[new s.V(q.key,q.value,'identity function may not have a "stops" property')];let J=[];const X=q.value;return J=J.concat(Bt({key:q.key,value:X,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:V})),s.K(X)==="array"&&X.length===0&&J.push(new s.V(q.key,X,"array must have at least one stop")),J},default:function(q){return rn({key:q.key,value:q.value,valueSpec:n,style:q.style,styleSpec:q.styleSpec})}}});return a==="identity"&&D&&F.push(new s.V(m.key,m.value,'missing required property "property"')),a==="identity"||m.value.stops||F.push(new s.V(m.key,m.value,'missing required property "stops"')),a==="exponential"&&m.valueSpec.expression&&!s.N(m.valueSpec)&&F.push(new s.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(L&&!s.O(m.valueSpec)?F.push(new s.V(m.key,m.value,"property functions not supported")):D&&!s.Q(m.valueSpec)&&F.push(new s.V(m.key,m.value,"zoom functions not supported"))),a!=="categorical"&&!z||m.value.property!==void 0||F.push(new s.V(m.key,m.value,'"property" property is required')),F;function V(q){let J=[];const X=q.value,ee=q.key;if(s.K(X)!=="array")return[new s.V(ee,X,`array expected, ${s.K(X)} found`)];if(X.length!==2)return[new s.V(ee,X,`array length 2 expected, length ${X.length} found`)];if(z){if(s.K(X[0])!=="object")return[new s.V(ee,X,`object expected, ${s.K(X[0])} found`)];if(X[0].zoom===void 0)return[new s.V(ee,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new s.V(ee,X,"object stop key must have value")];const ie=s.M(X[0].zoom);if(typeof ie!="number")return[new s.V(ee,X[0].zoom,"stop zoom values must be numbers")];if(b&&b>ie)return[new s.V(ee,X[0].zoom,"stop zoom values must appear in ascending order")];ie!==b&&(b=ie,v=void 0,T={}),J=J.concat(Vt({key:`${ee}[0]`,value:X[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:yt,value:U}}))}else J=J.concat(U({key:`${ee}[0]`,value:X[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},X));return s.S(s.U(X[1]))?J.concat([new s.V(`${ee}[1]`,X[1],"expressions are not allowed in function stops.")]):J.concat(rn({key:`${ee}[1]`,value:X[1],valueSpec:n,style:q.style,styleSpec:q.styleSpec}))}function U(q,J){const X=s.K(q.value),ee=s.M(q.value),ie=q.value!==null?q.value:J;if(p){if(X!==p)return[new s.V(q.key,ie,`${X} stop domain type must match previous stop domain type ${p}`)]}else p=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new s.V(q.key,ie,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&a!=="categorical"){let le=`number expected, ${X} found`;return s.O(n)&&a===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(q.key,ie,le)]}return a!=="categorical"||X!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?a!=="categorical"&&X==="number"&&typeof ee=="number"&&typeof v=="number"&&v!==void 0&&ee<v?[new s.V(q.key,ie,"stop domain values must appear in ascending order")]:(v=ee,a==="categorical"&&ee in T?[new s.V(q.key,ie,"stop domain values must be unique")]:(T[ee]=!0,[])):[new s.V(q.key,ie,`integer expected, found ${String(ee)}`)]}}function Zt(m){const n=(m.expressionContext==="property"?s.W:s.X)(s.U(m.value),m.valueSpec);if(n.result==="error")return n.value.map(p=>new s.V(`${m.key}${p.key}`,m.value,p.message));const a=n.value.expression||n.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!a.outputDefined())return[new s.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!s.Y(a))return[new s.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return Yt(a,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!s.Z(a,["zoom","feature-state"]))return[new s.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!s._(a))return[new s.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yt(m,n){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const v of n.valueSpec.expression.parameters)a.delete(v);if(a.size===0)return[];const p=[];return m instanceof s.$&&a.has(m.name)?[new s.V(n.key,n.value,`["${m.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(m.eachChild(v=>{p.push(...Yt(v,n))}),p)}function Ut(m){const n=m.key,a=m.value,p=m.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(s.M(a))===-1&&v.push(new s.V(n,a,`expected one of [${p.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(p.values).indexOf(s.M(a))===-1&&v.push(new s.V(n,a,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(a)} found`)),v}function Ei(m){return s.a1(s.U(m.value))?Zt(s.L({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):At(m)}function At(m){const n=m.value,a=m.key;if(s.K(n)!=="array")return[new s.V(a,n,`array expected, ${s.K(n)} found`)];const p=m.styleSpec;let v,b=[];if(n.length<1)return[new s.V(a,n,"filter array must have at least 1 element")];switch(b=b.concat(Ut({key:`${a}[0]`,value:n[0],valueSpec:p.filter_operator,style:m.style,styleSpec:m.styleSpec})),s.M(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.M(n[1])==="$type"&&b.push(new s.V(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&b.push(new s.V(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(v=s.K(n[1]),v!=="string"&&b.push(new s.V(`${a}[1]`,n[1],`string expected, ${v} found`)));for(let T=2;T<n.length;T++)v=s.K(n[T]),s.M(n[1])==="$type"?b=b.concat(Ut({key:`${a}[${T}]`,value:n[T],valueSpec:p.geometry_type,style:m.style,styleSpec:m.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&b.push(new s.V(`${a}[${T}]`,n[T],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let T=1;T<n.length;T++)b=b.concat(At({key:`${a}[${T}]`,value:n[T],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=s.K(n[1]),n.length!==2?b.push(new s.V(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):v!=="string"&&b.push(new s.V(`${a}[1]`,n[1],`string expected, ${v} found`))}return b}function ci(m,n){const a=m.key,p=m.style,v=m.layer,b=m.styleSpec,T=m.value,D=m.objectKey,L=b[`${n}_${m.layerType}`];if(!L)return[];const z=D.match(/^(.*)-use-theme$/);if(n==="paint"&&z&&L[z[1]])return s.S(T)?[].concat(rn({key:m.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:D})):rn({key:a,value:T,valueSpec:{type:"string"},style:p,styleSpec:b});const F=D.match(/^(.*)-transition$/);if(n==="paint"&&F&&L[F[1]]&&L[F[1]].transition)return rn({key:a,value:T,valueSpec:b.transition,style:p,styleSpec:b});const V=m.valueSpec||L[D];if(!V)return[new s.J(a,T,`unknown property "${D}"`)];let U;if(s.K(T)==="string"&&s.O(V)&&!V.tokens&&(U=/^{([^}]+)}$/.exec(T))){const J=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new s.V(a,T,`"${D}" does not support interpolation syntax
Use an identity property function instead: ${J}.`)]}const q=[];if(m.layerType==="symbol")D!=="text-field"||!p||p.glyphs||p.imports||q.push(new s.V(a,T,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&s.a2(s.U(T))&&s.M(T.type)==="identity"&&q.push(new s.V(a,T,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&n==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&s.O(V)&&(s.a3(V)||s.Q(V))){const J=s.W(s.U(T),V),X=J.value.expression||J.value._styleExpression.expression;X&&!s.Z(X,["measure-light"])&&(D==="model-emissive-strength"&&s._(X)&&s.Y(X)||q.push(new s.V(a,T,`${D} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(rn({key:m.key,value:T,valueSpec:V,style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:D}))}function Ai(m){return ci(m,"paint")}function Xi(m){return ci(m,"layout")}function ji(m){let n=[];const a=m.value,p=m.key,v=m.style,b=m.styleSpec;a.type||a.ref||n.push(new s.V(p,a,'either "type" or "ref" is required'));let T=s.M(a.type);const D=s.M(a.ref);if(a.id){const L=s.M(a.id);for(let z=0;z<m.arrayIndex;z++){const F=v.layers[z];s.M(F.id)===L&&n.push(new s.V(p,a.id,`duplicate layer id "${a.id}", previously used at line ${F.id.__line__}`))}}if("ref"in a){let L;["type","source","source-layer","filter","layout"].forEach(z=>{z in a&&n.push(new s.V(p,a[z],`"${z}" is prohibited for ref layers`))}),v.layers.forEach(z=>{s.M(z.id)===D&&(L=z)}),L?L.ref?n.push(new s.V(p,a.ref,"ref cannot reference another ref layer")):T=s.M(L.type):typeof D=="string"&&n.push(new s.V(p,a.ref,`ref layer "${D}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(a.source){const L=v.sources&&v.sources[a.source],z=L&&s.M(L.type);L?z==="vector"&&T==="raster"?n.push(new s.V(p,a.source,`layer "${a.id}" requires a raster source`)):z==="raster"&&T!=="raster"?n.push(new s.V(p,a.source,`layer "${a.id}" requires a vector source`)):z!=="vector"||a["source-layer"]?z==="raster-dem"&&T!=="hillshade"?n.push(new s.V(p,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||z==="geojson"&&L.lineMetrics?T==="raster-particle"&&z!=="raster-array"&&n.push(new s.V(p,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):n.push(new s.V(p,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new s.V(p,a.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new s.V(p,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new s.V(p,a.source,`source "${a.source}" not found`))}else n.push(new s.V(p,a,'missing required property "source"'));return n=n.concat(Vt({key:p,value:a,valueSpec:b.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>rn({key:`${p}.type`,value:a.type,valueSpec:b.layer.type,style:m.style,styleSpec:m.styleSpec,object:a,objectKey:"type"}),filter:L=>Ei(s.L({layerType:T},L)),layout:L=>Vt({layer:a,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":z=>Xi(s.L({layerType:T},z))}}),paint:L=>Vt({layer:a,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":z=>Ai(s.L({layerType:T,layer:a},z))}})}})),n}function un(m){const n=m.value,a=m.key,p=s.K(n);return p!=="string"?[new s.V(a,n,`string expected, ${p} found`)]:[]}const Kn={promoteId:function m({key:n,value:a}){if(s.K(a)==="string")return un({key:n,value:a});if(Array.isArray(a)){const p=[],v=s.U(a),b=s.X(v);return b.result==="error"&&b.value.forEach(T=>{p.push(new s.V(`${n}${T.key}`,null,`${T.message}`))}),s.Z(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||p.push(new s.V(`${n}`,null,"promoteId expression should be only feature dependent")),p}{const p=[];for(const v in a)p.push(...m({key:`${n}.${v}`,value:a[v]}));return p}}};function ds(m){const n=m.value,a=m.key,p=m.styleSpec,v=m.style;if(!n.type)return[new s.V(a,n,'"type" is required')];const b=s.M(n.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(n.url||n.tiles||T.push(new s.J(a,n,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(Vt({key:a,value:n,valueSpec:p[`source_${b.replace("-","_")}`],style:m.style,styleSpec:p,objectElementValidators:Kn})),T;case"geojson":if(T=Vt({key:a,value:n,valueSpec:p.source_geojson,style:v,styleSpec:p,objectElementValidators:Kn}),n.cluster)for(const D in n.clusterProperties){const[L,z]=n.clusterProperties[D],F=typeof L=="string"?[L,["accumulated"],["get",D]]:L;T.push(...Zt({key:`${a}.${D}.map`,value:z,expressionContext:"cluster-map"})),T.push(...Zt({key:`${a}.${D}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return T;case"video":return Vt({key:a,value:n,valueSpec:p.source_video,style:v,styleSpec:p});case"image":return Vt({key:a,value:n,valueSpec:p.source_image,style:v,styleSpec:p});case"canvas":return[new s.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ut({key:`${a}.type`,value:n.type,valueSpec:{values:Ws(p)},style:v,styleSpec:p})}}function Ws(m){return m.source.reduce((n,a)=>{const p=m[a];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values))),n},[])}function vs(m){const n=m.value,a=m.styleSpec,p=a.light,v=m.style;let b=[];const T=s.K(n);if(n===void 0)return b;if(T!=="object")return b=b.concat([new s.V("light",n,`object expected, ${T} found`)]),b;for(const D in n){const L=D.match(/^(.*)-transition$/),z=D.match(/^(.*)-use-theme$/);b=b.concat(z&&p[z[1]]?rn({key:D,value:n[D],valueSpec:{type:"string"},style:v,styleSpec:a}):L&&p[L[1]]&&p[L[1]].transition?rn({key:D,value:n[D],valueSpec:a.transition,style:v,styleSpec:a}):p[D]?rn({key:D,value:n[D],valueSpec:p[D],style:v,styleSpec:a}):[new s.V(D,n[D],`unknown property "${D}"`)])}return b}function Br(m){const n=m.value;let a=[];if(!n)return a;const p=s.K(n);if(p!=="object")return a=a.concat([new s.V("light-3d",n,`object expected, ${p} found`)]),a;const v=m.styleSpec,b=v["light-3d"],T=m.key,D=m.style,L=m.style.lights;for(const V of["type","id"])if(!(V in n))return a=a.concat([new s.V("light-3d",n,`missing property ${V} on light`)]),a;if(n.type&&L)for(let V=0;V<m.arrayIndex;V++){const U=s.M(n.type),q=L[V];s.M(q.type)===U&&a.push(new s.V(T,n.id,`duplicate light type "${n.type}", previously defined at line ${q.id.__line__}`))}const z=`properties_light_${n.type}`;if(!(z in v))return a=a.concat([new s.V("light-3d",n,`Invalid light type ${n.type}`)]),a;const F=v[z];for(const V in n)if(V==="properties"){const U=n[V],q=s.K(U);if(q!=="object")return a=a.concat([new s.V("properties",U,`object expected, ${q} found`)]),a;for(const J in U)a=a.concat(F[J]?rn({key:J,value:U[J],valueSpec:F[J],style:D,styleSpec:v}):[new s.J(m.key,U[J],`unknown property "${J}"`)])}else{const U=V.match(/^(.*)-transition$/),q=V.match(/^(.*)-use-theme$/);a=a.concat(q&&b[q[1]]?rn({key:V,value:n[V],valueSpec:{type:"string"},style:D,styleSpec:v}):U&&b[U[1]]&&b[U[1]].transition?rn({key:V,value:n[V],valueSpec:v.transition,style:D,styleSpec:v}):b[V]?rn({key:V,value:n[V],valueSpec:b[V],style:D,styleSpec:v}):[new s.J(V,n[V],`unknown property "${V}"`)])}return a}function or(m){const n=m.value,a=m.key,p=m.style,v=m.styleSpec,b=v.terrain;let T=[];const D=s.K(n);if(n===void 0||D==="null")return T;if(D!=="object")return T=T.concat([new s.V("terrain",n,`object expected, ${D} found`)]),T;for(const L in n){const z=L.match(/^(.*)-transition$/),F=L.match(/^(.*)-use-theme$/);T=T.concat(F&&b[F[1]]?rn({key:L,value:n[L],valueSpec:{type:"string"},style:p,styleSpec:v}):z&&b[z[1]]&&b[z[1]].transition?rn({key:L,value:n[L],valueSpec:v.transition,style:p,styleSpec:v}):b[L]?rn({key:L,value:n[L],valueSpec:b[L],style:p,styleSpec:v}):[new s.J(L,n[L],`unknown property "${L}"`)])}if(n.source){const L=p.sources&&p.sources[n.source],z=L&&s.M(L.type);L?z!=="raster-dem"&&T.push(new s.V(a,n.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):T.push(new s.V(a,n.source,`source "${n.source}" not found`))}else T.push(new s.V(a,n,'terrain is missing required property "source"'));return T}function Ts(m){const n=m.value,a=m.style,p=m.styleSpec,v=p.fog;let b=[];const T=s.K(n);if(n===void 0)return b;if(T!=="object")return b=b.concat([new s.V("fog",n,`object expected, ${T} found`)]),b;for(const D in n){const L=D.match(/^(.*)-transition$/),z=D.match(/^(.*)-use-theme$/);b=b.concat(z&&v[z[1]]?rn({key:D,value:n[D],valueSpec:{type:"string"},style:a,styleSpec:p}):L&&v[L[1]]&&v[L[1]].transition?rn({key:D,value:n[D],valueSpec:p.transition,style:a,styleSpec:p}):v[D]?rn({key:D,value:n[D],valueSpec:v[D],style:a,styleSpec:p}):[new s.J(D,n[D],`unknown property "${D}"`)])}return b}const on={"*":()=>[],array:Bt,boolean:function(m){const n=m.value,a=m.key,p=s.K(n);return p!=="boolean"?[new s.V(a,n,`boolean expected, ${p} found`)]:[]},number:yt,color:function(m){const n=m.key,a=m.value,p=s.K(a);return p!=="string"?[new s.V(n,a,`color expected, ${p} found`)]:s.a0.parseCSSColor(a)===null?[new s.V(n,a,`color expected, "${a}" found`)]:[]},enum:Ut,filter:Ei,function:Xt,layer:ji,object:Vt,source:ds,model:s.a4,light:vs,"light-3d":Br,terrain:or,fog:Ts,string:un,formatted:function(m){return un(m).length===0?[]:Zt(m)},resolvedImage:function(m){return un(m).length===0?[]:Zt(m)},projection:function(m){const n=m.value,a=m.styleSpec,p=a.projection,v=m.style;let b=[];const T=s.K(n);if(T==="object")for(const D in n)b=b.concat(rn({key:D,value:n[D],valueSpec:p[D],style:v,styleSpec:a}));else T!=="string"&&(b=b.concat([new s.V("projection",n,`object or string expected, ${T} found`)]));return b},import:function(m){const{value:n,styleSpec:a}=m,{data:p,...v}=n;Object.defineProperty(v,"__line__",{value:n.__line__,enumerable:!1});let b=Vt(s.L({},m,{value:v,valueSpec:a.import}));return s.M(v.id)===""&&b.push(new s.V(`${m.key}.id`,v,"import id can't be an empty string")),p&&(b=b.concat(cc(p,a,{key:`${m.key}.data`}))),b},iconset:function(m){const n=m.value,a=m.key,p=m.styleSpec,v=m.style;if(!n.type)return[new s.V(a,n,'"type" is required')];const b=s.M(n.type);let T=[];if(T=T.concat(Vt({key:a,value:n,valueSpec:p[`iconset_${b}`],style:v,styleSpec:p})),b==="source"&&n.source){const D=v.sources&&v.sources[n.source],L=D&&s.M(D.type);D?L!=="raster-array"&&T.push(new s.V(a,n.source,`iconset cannot be used with a source of type ${String(L)}, it only be used with a "raster-array" source type`)):T.push(new s.V(a,n.source,`source "${n.source}" not found`))}return T}};function rn(m,n=!1){const a=m.value,p=m.valueSpec,v=m.styleSpec;if(p.expression&&s.a2(s.M(a)))return Xt(m);if(p.expression&&s.S(s.U(a)))return Zt(m);if(p.type&&on[p.type]){const b=on[p.type](m);return n===!0&&b.length>0&&s.K(m.value)==="array"?Zt(m):b}return Vt(s.L({},m,{valueSpec:p.type?v[p.type]:p}))}function Hu(m){const n=m.value,a=m.key,p=un(m);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new s.V(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new s.V(a,n,'"glyphs" url must include a "{range}" token'))),p}function cc(m,n=s.a5,a={}){return rn({key:a.key||"",value:m,valueSpec:n.$root,styleSpec:n,style:m,objectElementValidators:{glyphs:Hu,"*":()=>[]}})}function fr(m,n=s.a5){return Oe(cc(m,n))}const xl=m=>Oe(ds(m)),Gu=m=>Oe(vs(m)),uc=m=>Oe(Br(m)),Td=m=>Oe(or(m)),Ed=m=>Oe(Ts(m)),qu=m=>Oe(function(n){const a=n.value,p=n.style,v=n.styleSpec,b=v.snow;let T=[];const D=s.K(a);if(a===void 0)return T;if(D!=="object")return T=T.concat([new s.V("snow",a,`object expected, ${D} found`)]),T;for(const L in a){const z=L.match(/^(.*)-transition$/);T=T.concat(z&&b[z[1]]&&b[z[1]].transition?rn({key:L,value:a[L],valueSpec:v.transition,style:p,styleSpec:v}):b[L]?rn({key:L,value:a[L],valueSpec:b[L],style:p,styleSpec:v}):[new s.J(L,a[L],`unknown property "${L}"`)])}return T}(m)),nt=m=>Oe(function(n){const a=n.value,p=n.style,v=n.styleSpec,b=v.rain;let T=[];const D=s.K(a);if(a===void 0)return T;if(D!=="object")return T=T.concat([new s.V("rain",a,`object expected, ${D} found`)]),T;for(const L in a){const z=L.match(/^(.*)-transition$/);T=T.concat(z&&b[z[1]]&&b[z[1]].transition?rn({key:L,value:a[L],valueSpec:v.transition,style:p,styleSpec:v}):b[L]?rn({key:L,value:a[L],valueSpec:b[L],style:p,styleSpec:v}):[new s.J(L,a[L],`unknown property "${L}"`)])}return T}(m)),te=m=>Oe(ji(m)),re=m=>Oe(Ei(m)),ye=m=>Oe(Ai(m)),Pe=m=>Oe(Xi(m)),Me=m=>Oe(s.a4(m));function Oe(m){return m.slice().sort((n,a)=>n.line&&a.line?n.line-a.line:0)}function Ye(m,n){let a=!1;if(n&&n.length)for(const p of n)p instanceof s.J?s.w(p.message):(m.fire(new s.z(new Error(p.message))),a=!0);return a}let Be;class tt extends s.E{constructor(n,a="flat"){super(),this._transitionable=new s.a6(Be||(Be=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(n,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a,p={}){this._validate(Gu,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=a)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,p){return(!p||p.validate!==!1)&&Ye(this,n.call(fr,s.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let rt=class extends s.E{constructor(m,n,a,p){super(),this.scope=a,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),a,p),this._transitionable.setTransitionOrValue(m,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(m,n){this._transitionable.setTransitionOrValue(m,n)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new s.aa(m)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const n=m.value.expression;if(!n)return null;let a=-1,p=-1,v=1;for(const b of n.zoomStops)v=n.evaluate(new s.aa(b)),v>.01?(a=b,p=-1):p=b;return v<.01&&a>0&&p>a?[a,p]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof s.ab}};const it=45,xt=65,Ot=.05;function Nt(m,n,a,p){const v=s.ae(it,xt,a),[b,T]=mi(m,p);let D=1-Math.min(1,Math.exp((n-b)/(T-b)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*v*m.alpha}function mi(m,n){const a=.5/Math.tan(.5*n);return[m.range[0]+a,m.range[1]+a]}function vi(m,n,a,p,v){const b=s.ad.vec3.transformMat4([],[n,a,p],v.mercatorFogMatrix);return Nt(m,s.ad.vec3.length(b),v.pitch,v._fov)}function xi(m,n,a,p,v,b,T){const D=[[a,p,0],[v,p,0],[v,b,0],[a,b,0]];let L=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const F of D){const V=s.ad.vec3.transformMat4([],F,n),U=s.ad.vec3.length(V);L=Math.min(L,U),z=Math.max(z,U)}return[Nt(m,L,T.pitch,T._fov),Nt(m,z,T.pitch,T._fov)]}class Ti extends s.E{constructor(n,a,p,v){super();const b=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(b,p,new Map(v)),this.set(n,v),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new s.af(b),this.scope=p}get state(){const n=this._transform,a=n.projection.name==="globe",p=s.ag(n.zoom),v=this.properties.get("range"),b=[.5,3];return{range:a?[s.ah(b[0],v[0],p),s.ah(b[1],v[1],p)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a,p={}){if(this._validate(Ed,n,p))return;const v=s.l({},n);for(const b of Object.keys(s.a5.fog))v[b]===void 0&&(v[b]=s.a5.fog[b].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ae(it,xt,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(p,v,b){const T=s.ac.fromLngLat(v),D=b.elevation?b.elevation.getAtPointOrZero(T):0;return vi(p,T.x,T.y,D,b)}(this.state,n,a):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(n.toUnwrapped());return xi(this.state,a,0,0,s.ai,s.ai,this._transform)}getOpacityForBounds(n,a,p,v,b){return this._transform.projection.supportsFog?xi(this.state,n,a,p,v,b,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?mi(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const p of a){const v=n.points[p];let b;if(v[2]>=0)b=v;else{const T=n.points[p-4];b=s.aj(T,v,T[2]/(T[2]-v[2]))}if(vi(this.state,b[0],b[1],0,this._transform)>=Ot)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,p){return(!p||p.validate!==!1)&&Ye(this,n.call(fr,s.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let _n,On,Ci,Ki,Ji=class extends s.E{constructor(m,n,a,p){super();const v=_n||(_n=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(v,a,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.af(v),this.scope=a}get state(){const m=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),p=s.ak(a[0]),v=-Math.max(s.ak(a[1]),.01),b=[Math.cos(p)*Math.cos(v),Math.sin(p)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette"),D=this.properties.get("vignette-color");return D.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.al(n.r,n.g,n.b,n.a*m),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:D}}get(){return this._transitionable.serialize()}set(m,n,a={}){if(this._validate(qu,m,a))return;const p=s.l({},m);for(const v of Object.keys(s.a5.snow))p[v]===void 0&&(p[v]=s.a5.snow[v].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,n,a){return(!a||a.validate!==!1)&&Ye(this,m.call(fr,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},nn=class extends s.E{constructor(m,n,a,p){super();const v=On||(On=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(v,a,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.af(v),this.scope=a}get state(){const m=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),p=s.ak(a[0]),v=-Math.max(s.ak(a[1]),.01),b=[Math.cos(p)*Math.cos(v),Math.sin(p)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.al(n.r,n.g,n.b,n.a*m),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(m,n,a={}){if(this._validate(nt,m,a))return;const p=s.l({},m);for(const v of Object.keys(s.a5.rain))p[v]===void 0&&(p[v]=s.a5.rain[v].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,n,a){return(!a||a.validate!==!1)&&Ye(this,m.call(fr,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class Gn extends s.E{constructor(n,a,p,v){super(),this.scope=p,this._options=n,this.properties=new s.af(a),this._transitionable=new s.a6(a,p,new Map(v)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,a){this._options=n,this._transitionable.setTransitionOrValue(n.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Es{constructor(n,a,p,v){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(n,a){let p,v;if(n instanceof s.P||typeof n[0]=="number"){const b=s.P.convert(n);p=[b],v=a.isPointAboveHorizon(b)}else{const b=s.P.convert(n[0]),T=s.P.convert(n[1]);p=[b,T],v=s.an(b,T).every(D=>a.isPointAboveHorizon(D))}return new Es(p,a.getCameraPoint(),v,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],v=s.an(a,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<p.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?v[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(v[3]=this.cameraPoint)),s.ao(v,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],v=s.an(a,p,n),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>p.y))+((b.x>a.x)+(b.x>p.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(n,a,p,v=0){const b=n.queryPadding/a._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a);let D=n.tileID.wrap+(T.unwrapped?v:0);const L=T.polygon.map(ee=>s.ap(n.tileTransform,ee,D));if(!s.aq(L,0,0,s.ai,s.ai))return;D=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const z=this.screenGeometryMercator.polygon.map(ee=>s.ar(n.tileTransform,ee,D)),F=z.map(ee=>new s.P(ee[0],ee[1])),V=a.getFreeCameraOptions().position||new s.ac(0,0,0),U=s.ar(n.tileTransform,V,D),q=z.map(ee=>{const ie=s.ad.vec3.sub(ee,ee,U);return s.ad.vec3.normalize(ie,ie),new s.as(U,ie)}),J=s.at(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:q,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(X=s.au(L),X.min.x=s.ay(X.min.x,0,s.ai),X.min.y=s.ay(X.min.y,0,s.ai),X.max.x=s.ay(X.max.x,0,s.ai),X.max.y=s.ay(X.max.y,0,s.ai),X),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:J};var X}_bufferedScreenMercator(n,a){const p=ar(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let v;return v=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=v,v}}_bufferedCameraMercator(n,a){const p=ar(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let v;return v=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=v,v}}_projectAndResample(n,a){const p=function(b,T){const D=s.ad.mat4.multiply([],T.pixelMatrix,T.globeMatrix),L=[0,-s.az,0,1],z=[0,s.az,0,1],F=[0,0,0,1];s.ad.vec4.transformMat4(L,L,D),s.ad.vec4.transformMat4(z,z,D),s.ad.vec4.transformMat4(F,F,D);const V=new s.P(L[0]/L[3],L[1]/L[3]),U=new s.P(z[0]/z[3],z[1]/z[3]),q=s.aw(b,V)&&L[3]<F[3],J=s.aw(b,U)&&z[3]<F[3];if(!q&&!J)return null;const X=function(xe,be,Ce){for(let Re=1;Re<xe.length;Re++){const Je=to(be.pointCoordinate3D(xe[Re-1]).x),$e=to(be.pointCoordinate3D(xe[Re]).x);if(Ce<0){if(Je<$e)return{idx:Re,t:-Je/($e-1-Je)}}else if($e<Je)return{idx:Re,t:(1-Je)/($e+1-Je)}}return null}(b,T,q?-1:1);if(!X)return null;const{idx:ee,t:ie}=X;let le=ee>1?Zs(b.slice(0,ee),T):[],_e=ee<b.length?Zs(b.slice(ee),T):[];le=le.map(xe=>new s.P(to(xe.x),xe.y)),_e=_e.map(xe=>new s.P(to(xe.x),xe.y));const pe=[...le];pe.length===0&&pe.push(_e[_e.length-1]);const we=s.ah(pe[pe.length-1].y,(_e.length===0?le[0]:_e[0]).y,ie);let ve;return ve=q?[new s.P(0,we),new s.P(0,0),new s.P(1,0),new s.P(1,we)]:[new s.P(1,we),new s.P(1,1),new s.P(0,1),new s.P(0,we)],pe.push(...ve),_e.length===0?pe.push(le[0]):pe.push(..._e),{polygon:pe.map(xe=>new s.ac(xe.x,xe.y)),unwrapped:!1}}(n,a);if(p)return p;const v=function(b,T){let D=!1,L=-1/0,z=0;for(let V=0;V<b.length-1;V++)b[V].x>L&&(L=b[V].x,z=V);for(let V=0;V<b.length-1;V++){const U=(z+V)%(b.length-1),q=b[U],J=b[U+1];Math.abs(q.x-J.x)>.5&&(q.x<J.x?(q.x+=1,U===0&&(b[b.length-1].x+=1)):(J.x+=1,U+1===b.length-1&&(b[0].x+=1)),D=!0)}const F=s.av(T.center.lng);return D&&F<Math.abs(F-1)&&b.forEach(V=>{V.x-=1}),{polygon:b,unwrapped:D}}(Zs(n,a).map(b=>new s.P(to(b.x),b.y)),a);return{polygon:v.polygon.map(b=>new s.ac(b.x,b.y)),unwrapped:v.unwrapped}}}function Zs(m,n){return s.ax(m,a=>{const p=n.pointCoordinate3D(a);a.x=p.x,a.y=p.y},1/256)}function to(m){return m<0?1+m%1:m%1}function ar(m){return 100*m|0}function Ss(m,n,a,p,v){const b=function(D,L){if(D)return v(D);if(L){if(m.url&&L.tiles&&m.tiles&&delete m.tiles,L.variants){if(!Array.isArray(L.variants))return v(new Error("variants must be an array"));for(const F of L.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return v(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){L=s.l(L,F);break}}}const z=s.aA(s.l({},L,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=n.canonicalizeTileset(z,m.url),v(null,z)}},T=function(D,L,z){if(!D)return null;if(!L&&!z)return D;z=z||D.worldview_default;const F=Object.values(D.language||{});if(F.length===0)return null;const V=Object.values(D.worldview||{});if(V.length===0)return null;const U=F.every(J=>J===L),q=V.every(J=>J===z);return U&&q?D:L in(D.language_options||{})||z in(D.worldview_options||{})?null:D.language_options&&D.worldview_options?D:null}(m.data,a,p);return T?s.q.frame(()=>b(null,T)):m.url?s.n(n.transformRequest(n.normalizeSourceURL(m.url,null,a,p),s.R.Source),b):s.q.frame(()=>{const{data:D,...L}=m;b(null,L)})}class Ds{constructor(n,a,p){this.bounds=s.aB.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),p=Math.floor(s.av(this.bounds.getWest())*a),v=Math.floor(s.aC(this.bounds.getNorth())*a),b=Math.ceil(s.av(this.bounds.getEast())*a),T=Math.ceil(s.aC(this.bounds.getSouth())*a);return n.x>=p&&n.x<b&&n.y>=v&&n.y<T}}class hc extends s.E{constructor(n,a,p,v){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.aA(a,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new s.aD}load(n){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Ss(this._options,this.map._requestManager,a,p,(v,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.z(v));else if(b){if(s.l(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}b.bounds&&(this.tileBounds=new Ds(b.bounds,this.minzoom,this.maxzoom)),Ln(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}n&&n(v)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(n,a){const p=n.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(v,s.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,D=T?{image:T.image.clone()}:null,L={request:b,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:D,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&s.f(p)&&(L.worldview=this.map.getWorldview()||this.worldviewDefault,L.localizableLayerIds=this.localizableLayerIds),L.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",L,z.bind(this));else if(n.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",L,z.bind(this),void 0,!0);else{const F=s.aE.call({deduped:this._deduped},L,(V,U)=>{V||!U?z.call(this,V):(L.data={cacheControl:U.cacheControl,expires:U.expires,rawData:U.rawData.slice(0)},n.actor&&n.actor.send("loadTile",L,z.bind(this),void 0,!0))},!0);n.request={cancel:F}}function z(F,V){return delete n.request,n.aborted?a(null):F&&F.status!==404?a(F):(V&&V.resourceTiming&&(n.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&n.setExpiryData(V),n.loadVectorData(V,this.map.painter),s.aF(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class io extends s.E{constructor(n,a,p,v){super(),this.id=n,this.dispatcher=p,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},a),s.l(this,s.aA(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Ss(this._options,this.map._requestManager,null,null,(a,p)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new s.z(a)):p&&(s.l(this,p),p.raster_layers&&(this.rasterLayers=p.raster_layers,this.rasterLayerIds=this.rasterLayers.map(v=>v.id)),p.bounds&&(this.tileBounds=new Ds(p.bounds,this.minzoom,this.maxzoom)),Ln(p.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),n&&n(a)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const p=s.q.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=s.o(this.map._requestManager.transformRequest(v,s.R.Tile),(b,T,D,L)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):b?(n.state="errored",a(b)):T?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:D,expires:L}),n.setTexture(T,this.map.painter),n.state="loaded",s.aF(this.dispatcher),void a(null)):a(null)))}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a&&a()}unloadTile(n,a){n.texture&&n.texture instanceof s.T?(n.destroy(!0),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ua extends io{constructor(n,a,p,v){super(n,a,p,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this.iconsets={},this._options=s.l({type:"raster-array"},a)}triggerRepaint(n){const a=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);a&&a.enabled&&p&&a._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,a){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(p,s.R.Tile),b={request:v,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=v,n.actor||(n.actor=this.dispatcher.getActor());const T=(D,L,z,F)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(D)return D.name==="AbortError"?void 0:(n.state="errored",a(D));if(this.map._refreshExpiredTiles&&L&&n.setExpiryData({cacheControl:z,expires:F}),this.partial)n.state="empty";else{if(!L)return a(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=L;const V=new Map;for(const U in n._mrt.layers){const q=n.getLayer(U);if(q)for(const J of q.getBandList()){const{bytes:X,tileSize:ee,buffer:ie}=q.getBandView(J),le=ee+2*ie,_e={data:new s.r({width:le,height:le},X),pixelRatio:2,sdf:!1,usvg:!1,version:0};V.set(`${U}/${J}`,_e)}}for(const U in this.iconsets)this.iconsets[U].addIcons(V)}a(null)};n.request=this.partial?n.fetchHeader(void 0,T.bind(this)):n.actor.send("loadTile",b,T.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){const p=n.texture;p&&p instanceof s.T?(n.destroy(!0),this.map.painter.saveTileTexture(p)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,a,p){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(a,p,(v,b)=>{if(v)return n.state="errored",this.fire(new s.z(v)),void this.triggerRepaint(n);b&&(n._isHeaderLoaded=!0,n.setTexture(b,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:b})=>b===n),p=a&&a.fields,v=p&&p.bands&&p.bands;return v?v[0]:0}getTextureDescriptor(n,a,p){if(!n)return;const v=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let b=null;a instanceof s.aI?b=a.paint.get("raster-array-band"):a instanceof s.aJ&&(b=a.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(v);if(T!=null)if(n.textureDescriptor){if(!n.updateNeeded(v,T)||p)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,v,T)}addIconset(n,a){this.iconsets[n]=a,this.partial=!1}}const Op={vector:hc,raster:io,"raster-dem":class extends io{constructor(m,n,a,p){super(m,n,a,p),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(m,n){const a=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(v,b){v&&(m.state="errored",n(v)),b&&(m.dem=b,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",n(null))}m.request=s.o(this.map._requestManager.transformRequest(a,s.R.Tile),(function(v,b,T,D){if(delete m.request,m.aborted)m.state="unloaded",n(null);else if(v)m.state="errored",n(v);else if(b){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:T,expires:D});const L=ImageBitmap&&b instanceof ImageBitmap&&s.t(),z=1-(b.width-s.aG(b.width))/2;z<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const F=L?b:s.q.getImageData(b,z),V={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:z};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",V,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const n=m.canonical,a=Math.pow(2,n.z),p=(n.x-1+a)%a,v=n.x===0?m.wrap-1:m.wrap,b=(n.x+1+a)%a,T=n.x+1===a?m.wrap+1:m.wrap,D={};return D[new s.aH(m.overscaledZ,v,n.z,p,n.y).key]={backfilled:!1},D[new s.aH(m.overscaledZ,T,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(D[new s.aH(m.overscaledZ,v,n.z,p,n.y-1).key]={backfilled:!1},D[new s.aH(m.overscaledZ,m.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},D[new s.aH(m.overscaledZ,T,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<a&&(D[new s.aH(m.overscaledZ,v,n.z,p,n.y+1).key]={backfilled:!1},D[new s.aH(m.overscaledZ,m.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},D[new s.aH(m.overscaledZ,T,n.z,b,n.y+1).key]={backfilled:!1}),D}},"raster-array":ua,geojson:class extends s.E{constructor(m,n,a,p){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(p),this._data=n.data,this._options=s.l({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const v=s.ai/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*v,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*v,extent:s.ai,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.ai,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*v,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const a of this._data.features)n.set(a.id,a);for(const a of m.features)n.set(a.id,a);this._data.features=[...n.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},n),this}getClusterChildren(m,n){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},n),this}getClusterLeaves(m,n,a,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:n,offset:a},p),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const n=s.l({append:m},this.workerOptions);n.scope=this.scope;const a=this._data;typeof a=="string"?(n.request=this.map._requestManager.transformRequest(s.q.resolveURL(a),s.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(p,v)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.z(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(b.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new s.A("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=s.C(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,n){const a=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,v=p?{image:p.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:b};m.request=this.actor.send(a,T,(D,L)=>b&&!L?(m.state="loaded",n(null)):(delete m.request,m.destroy(),m.aborted?n(null):D?n(D):(m.loadVectorData(L,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,n){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aK{constructor(m,n,a,p){super(m,n,a,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const n of m.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aL(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new s.z(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const n=this.video.seekable;m<n.start(0)||m>n.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,n=m.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(m,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aK,model:class extends s.E{constructor(m,n,a,p){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const m=[];for(const n in this._options.models){const a=this._options.models[n],p=s.aN(this.map._requestManager.transformRequest(a.uri,s.R.Model).url).then(v=>{if(!v)return;const b=s.aO(v),T=new s.aP(n,a.position,a.orientation,b);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(v=>{this.fire(new s.z(new Error(`Could not load model ${n} from ${a.uri}: ${v.message}`)))});m.push(p)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new s.z(new Error(`Could not load models: ${n.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,n){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(m,n,a,p){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=Ss(this._options,this.map._requestManager,n,a,(p,v)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.z(p))):v&&(s.l(this,v),v.bounds&&(this.tileBounds=new Ds(v.bounds,this.minzoom,this.maxzoom)),Ln(v.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),m&&m(p)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,n){const a=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(a,s.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=n;else{if(m.buckets){const b=Object.values(m.buckets);for(const T of b)T.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",p,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",p,v.bind(this),void 0,!0);function v(b,T){return m.aborted?n(null):b&&b.status!==404?n(b):(this.map._refreshExpiredTiles&&T&&m.setExpiryData(T),m.loadModelData(T,this.map.painter),m.state="loaded",void n(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aK{constructor(m,n,a,p){super(m,n,a,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(b=>typeof b!="number"))||this.fire(new s.z(new s.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${m}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof s.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends s.E{constructor(m,n,a,p){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ds(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.aA(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:n,y:a,z:p}=m.canonical;return this._implementation.hasTile({x:n,y:a,z:p})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,n){const{x:a,y:p,z:v}=m.tileID.canonical,b=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:a,y:p,z:v},{signal:b.signal})).then((function(T){return delete m.request,m.aborted?(m.state="unloaded",n(null)):T===void 0?(m.state="errored",n(null)):T===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",n(null)):function(D){return D instanceof ImageData||D instanceof HTMLCanvasElement||D instanceof ImageBitmap||D instanceof HTMLImageElement}(T)?(this.loadTileData(m,T),m.state="loaded",void n(null)):(m.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.name!=="AbortError"&&(m.state="errored",n(T))}),m.request.cancel=()=>b.abort()}loadTileData(m,n){m.setTexture(n,this.map.painter)}unloadTile(m,n){if(m.texture&&m.texture instanceof s.T?(m.destroy(!0),m.texture&&m.texture instanceof s.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:a,y:p,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:a,y:p,z:v})}n&&n()}abortTile(m,n){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=s.C(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},Sd=function(m,n,a,p){const v=new Op[n.type](m,n,a,p);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return s.aQ(["load","abort","unload","serialize","prepare"],v),v};function Wu(m,n,a=""){return`${a}:${n.id||""}:${n.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:v,importId:b}=p;return`featureset:${v}${b?`:import:${b}`:""}`}}(m.target)}`}function dc(m,n,a,p=""){if(m.uniqueFeatureID){const v=Wu(m,n,p);if(a.has(v))return!0;a.add(v)}return!1}function kp(m,n,a,p,v=!1){const b=n.sourceCache.transform,T=n.sourceCache.tilesIn(m,n.has3DLayers,v);T.sort(zp);const D=[];for(const L of T){const z=L.tile.queryRenderedFeatures(n,L,a,p,b,v);Object.keys(z).length&&D.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:z})}return D.length===0?{}:function(L){const z={},F={};for(const V of L){const U=V.queryResults,q=V.wrappedTileID,J=F[q]=F[q]||{};for(const X in U){const ee=U[X],ie=J[X]=J[X]||{},le=z[X]=z[X]||[];for(const _e of ee)ie[_e.featureIndex]||(ie[_e.featureIndex]=!0,le.push(_e))}}return z}(D)}function ly(m,n,a,p,v){const b={},T=p.queryRenderedSymbols(m),D=[];for(const L of Object.keys(T).map(Number))D.push(v[L]);D.sort(zp);for(const L of D){const z=L.featureIndex.lookupSymbolFeatures(T[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,n,a);for(const F in z){const V=b[F]=b[F]||[],U=z[F];U.sort((q,J)=>{const X=L.featureSortOrder;if(X){const ee=X.indexOf(q.featureIndex);return X.indexOf(J.featureIndex)-ee}return J.featureIndex-q.featureIndex});for(const q of U)V.push(q)}}return b}function cy(m,n){const a=m.getRenderableIds().map(b=>m.getTileByID(b)),p=[],v={};for(let b=0;b<a.length;b++){const T=a[b],D=T.tileID.canonical.key;v[D]||(v[D]=!0,T.querySourceFeatures(p,n))}return p}function zp(m,n){const a=m.tileID,p=n.tileID;return a.overscaledZ-p.overscaledZ||a.canonical.y-p.canonical.y||a.wrap-p.wrap||a.canonical.x-p.canonical.x}function fc(m,n){const a={};if(!n)return a;for(const p of m){const v=p.layerIds.map(b=>n.getLayer(b)).filter(Boolean);if(v.length!==0){p.layers=v,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(b=>v.filter(T=>T.id===b)[0]));for(const b of v)a[b.fqid]=p}}return a}const Nr=32,bo=33,Ha=new Uint16Array(8184);for(let m=0;m<2046;m++){let n=m+2,a=0,p=0,v=0,b=0,T=0,D=0;for(1&n?v=b=T=Nr:a=p=D=Nr;(n>>=1)>1;){const z=a+v>>1,F=p+b>>1;1&n?(v=a,b=p,a=T,p=D):(a=v,p=b,v=T,b=D),T=z,D=F}const L=4*m;Ha[L+0]=a,Ha[L+1]=p,Ha[L+2]=v,Ha[L+3]=b}const Vr=new Uint16Array(2178),xr=new Uint8Array(1089),pc=new Uint16Array(1089);function Fp(m){return m===0?-.03125:m===32?.03125:0}const Ad=(()=>({type:2,extent:s.ai,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ai+1,0),new s.P(s.ai+1,s.ai+1),new s.P(0,s.ai+1),new s.P(0,0)]]}))();class wo{constructor(n,a,p,v,b){this.tileID=n,this.uid=s.aW(),this.uses=0,this.tileSize=a,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection)}registerFadeDuration(n){const a=n+this.timeAdded;a<s.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=fc(n.buckets,a.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const b=this.buckets[v];if(b instanceof s.aY){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const b=this.buckets[v];if(b instanceof s.aY&&b.hasRTLText){this.hasRTLText=!0,s.aZ();break}}this.queryPadding=0;for(const v in this.buckets){const b=this.buckets[v],T=a.style.getOwnLayer(v);if(!T)continue;const D=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,D)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.aX}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,a,p){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,fc(n.buckets,a.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const v in this.buckets){const b=this.buckets[v];b.uploadPending()&&b.upload(n)}const a=n.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new s.T(n,p.image,a.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(n,a,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=a.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}queryRenderedFeatures(n,a,p,v,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const D=function(L,z){const F=s.ad.mat4.fromScaling([],[.5*L.width,.5*-L.height,1]);return s.ad.mat4.translate(F,F,[1,-1,0]),s.ad.mat4.multiply(F,F,L.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(F)}(b,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:a,pixelPosMatrix:D,transform:v,availableImages:p,tileTransform:this.tileTransform})}querySourceFeatures(n,a){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const v=p.loadVTLayers(),b=a?a.sourceLayer:"",T=v._geojsonTileLayer||v[b];if(!T)return;const D=s.a_(a&&a.filter),{z:L,x:z,y:F}=this.tileID.canonical,V={z:L,x:z,y:F};for(let U=0;U<T.length;U++){const q=T.feature(U);if(D.needGeometry){const ee=s.a$(q,!0);if(!D.filter(new s.aa(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!D.filter(new s.aa(this.tileID.overscaledZ),q))continue;const J=p.getId(q,b),X=new s.b0(q,L,z,F,J);X.tile=V,n.push(X)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const a=this.expirationTime;if(n.cacheControl){const p=s.b1(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let v=!1;if(this.expirationTime>p)v=!1;else if(a)if(this.expirationTime<a)v=!0;else{const b=this.expirationTime-a;b?this.expirationTime=p+Math.max(b,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,a){if(!this.latestFeatureIndex||!n.style)return;const p=this.latestFeatureIndex.loadVTLayers(),v=n.style.listImages(),b=n.style.getBrightness();for(const T in this.buckets){if(!n.style.hasLayer(T))continue;const D=this.buckets[T],L=D.layers[0],z=L.sourceLayer||"_geojsonTileLayer",F=p[z],V=n.style.getLayerSourceCache(L);let U={};V&&(U=V._state.getState(z,void 0));const q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},J=Object.keys(U).length>0&&!a;J&&!D.stateDependentLayers.length&&!a||D.update(U,F,v,q,J?D.stateDependentLayers:D.layers,a,b),(D instanceof s.b2||D instanceof s.b3)&&n._terrain&&n._terrain.enabled&&V&&D.uploadPending()&&n._terrain._clearRenderCacheForTile(V.id,this.tileID);const X=n&&n.style&&n.style.getOwnLayer(T);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(D)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.q.now()+n}setTexture(n,a){const p=a.context,v=p.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n):(this.texture=new s.T(p,n,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(n,a){const p={};for(const v of a)p[v]=!0;this.dependencies[n]=p}hasDependency(n,a){for(const p of n){const v=this.dependencies[p];if(v){for(const b of a)if(v[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const p=s.b4(Ad,this.tileID.canonical,this.tileTransform)[0],v=new s.b5,b=new s.b6;for(let T=0;T<p.length;T++){const{x:D,y:L}=p[T];v.emplaceBack(D,L),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(v,s.b7.members),this._tileDebugSegments=s.b8.simpleSegment(0,0,v.length,b.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const p=s.b4(Ad,this.tileID.canonical,this.tileTransform)[0];let v,b;if(this.isRaster){const T=function(D,L){const z=s.aR(D,L),F=Math.pow(2,D.z);for(let ee=0;ee<bo;ee++)for(let ie=0;ie<bo;ie++){const le=s.aS((D.x+(ie+Fp(ie))/Nr)/F),_e=s.aT((D.y+(ee+Fp(ee))/Nr)/F),pe=L.project(le,_e),we=ee*bo+ie;Vr[2*we+0]=Math.round((pe.x*z.scale-z.x)*s.ai),Vr[2*we+1]=Math.round((pe.y*z.scale-z.y)*s.ai)}xr.fill(0),pc.fill(0);for(let ee=2045;ee>=0;ee--){const ie=4*ee,le=Ha[ie+0],_e=Ha[ie+1],pe=Ha[ie+2],we=Ha[ie+3],ve=le+pe>>1,xe=_e+we>>1,be=ve+xe-_e,Ce=xe+le-ve,Re=_e*bo+le,Je=we*bo+pe,$e=xe*bo+ve,ct=Math.hypot((Vr[2*Re+0]+Vr[2*Je+0])/2-Vr[2*$e+0],(Vr[2*Re+1]+Vr[2*Je+1])/2-Vr[2*$e+1])>=16;xr[$e]=xr[$e]||(ct?1:0),ee<1022&&(xr[$e]=xr[$e]||xr[(_e+Ce>>1)*bo+(le+be>>1)]||xr[(we+Ce>>1)*bo+(pe+be>>1)])}const V=new s.aU,U=new s.aV;let q=0;function J(ee,ie){const le=ie*bo+ee;return pc[le]===0&&(V.emplaceBack(Vr[2*le+0],Vr[2*le+1],ee*s.ai/Nr,ie*s.ai/Nr),pc[le]=++q),pc[le]-1}function X(ee,ie,le,_e,pe,we){const ve=ee+le>>1,xe=ie+_e>>1;if(Math.abs(ee-pe)+Math.abs(ie-we)>1&&xr[xe*bo+ve])X(pe,we,ee,ie,ve,xe),X(le,_e,pe,we,ve,xe);else{const be=J(ee,ie),Ce=J(le,_e),Re=J(pe,we);U.emplaceBack(be,Ce,Re)}}return X(0,0,Nr,Nr,Nr,0),X(Nr,Nr,0,0,0,Nr),{vertices:V,indices:U}}(this.tileID.canonical,a);v=T.vertices,b=T.indices}else{v=new s.aU,b=new s.aV;for(const{x:D,y:L}of p)v.emplaceBack(D,L,0,0);const T=s.b9(v.int16,void 0,4);for(let D=0;D<T.length;D+=3)b.emplaceBack(T[D],T[D+1],T[D+2])}this._tileBoundsBuffer=n.createVertexBuffer(v,s.ba.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(b),this._tileBoundsSegments=s.b8.simpleSegment(0,0,v.length,b.length)}_makeGlobeTileDebugBuffers(n,a){const p=a.projection;if(!p||p.name!=="globe"||a.freezeTileCoverage)return;const v=this.tileID.canonical,b=s.bb(v,a),T=s.bc(b),D=s.ag(a.zoom);let L;D>0&&(L=s.ad.mat4.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,v,a,T,L,D),this._makeGlobeTileDebugTextBuffer(n,v,a,T,L,D)}_globePoint(n,a,p,v,b,T,D){let L=s.bd(n,a,p);if(T){const z=1<<p.z,F=s.av(v.center.lng),V=s.aC(v.center.lat),U=(p.x+.5)/z-F;let q=0;U>.5?q=-1:U<-.5&&(q=1);let J=(n/s.ai+p.x)/z+q,X=(a/s.ai+p.y)/z;J=(J-F)*v._pixelsPerMercatorPixel+F,X=(X-V)*v._pixelsPerMercatorPixel+V;const ee=[J*v.worldSize,X*v.worldSize,0];s.ad.vec3.transformMat4(ee,ee,T),L=s.be(L,ee,D)}return s.ad.vec3.transformMat4(L,L,b)}_makeGlobeTileDebugBorderBuffer(n,a,p,v,b,T){const D=new s.b5,L=new s.b6,z=new s.bf,F=(U,q,J,X,ee)=>{const ie=(J-U)/(ee-1),le=(X-q)/(ee-1),_e=D.length;for(let pe=0;pe<ee;pe++){const we=U+pe*ie,ve=q+pe*le;D.emplaceBack(we,ve);const xe=this._globePoint(we,ve,a,p,v,b,T);z.emplaceBack(xe[0],xe[1],xe[2]),L.emplaceBack(_e+pe)}},V=s.ai;F(0,0,V,0,16),F(V,0,V,V,16),F(V,V,0,V,16),F(0,V,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(L),this._tileDebugBuffer=n.createVertexBuffer(D,s.b7.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(z,s.bg.members),this._tileDebugSegments=s.b8.simpleSegment(0,0,D.length,L.length)}_makeGlobeTileDebugTextBuffer(n,a,p,v,b,T){const D=s.ai/4,L=new s.b5,z=new s.aV,F=new s.bf,V=25;z.reserve(32),L.reserve(V),F.reserve(V);const U=(q,J)=>V*q+J;for(let q=0;q<V;q++){const J=q*D;for(let X=0;X<V;X++){const ee=X*D;L.emplaceBack(ee,J);const ie=this._globePoint(ee,J,a,p,v,b,T);F.emplaceBack(ie[0],ie[1],ie[2])}}for(let q=0;q<4;q++)for(let J=0;J<4;J++){const X=U(q,J),ee=U(q,J+1),ie=U(q+1,J),le=U(q+1,J+1);z.emplaceBack(X,ee,ie),z.emplaceBack(ie,ee,le)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(z),this._tileDebugTextBuffer=n.createVertexBuffer(L,s.b7.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(F,s.bg.members),this._tileDebugTextSegments=s.b8.simpleSegment(0,0,V,32)}destroy(n=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bh.setPbf(s.bi);class pr extends wo{constructor(n,a,p,v,b){super(n,a,p,v,b),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexture(n,a){const p=a.context,v=p.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n,{premultiply:!1}):this.texture=new s.T(p,n,v.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,a){const p=this._mrt=new s.bh(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.bj(v,(b,T,D,L)=>{if(b)a(b);else try{const z=p.getHeaderLength(T);if(z>n)return void(this.request=this.fetchHeader(z,a));p.parseHeader(T),this._isHeaderLoaded=!0;let F=0;for(const V of Object.values(p.layers))F=Math.max(F,V.dataIndex[V.dataIndex.length-1].lastByte);T.byteLength>=F&&(this.entireBuffer=T),a(null,this.entireBuffer||T,D,L)}catch(z){a(z)}}),this.request}fetchBand(n,a,p){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void p(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void p(new Error("Can't fetch tile band without an actor"));let T;const D=(V,U)=>{T.complete(V,U),V?p(V):(this.updateTextureDescriptor(n,a),p(null,this.textureDescriptor&&this.textureDescriptor.img))},L=(V,U)=>{if(V)return p(V);const q=b.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:U,task:T},D,void 0,!0);this._workQueue.push(()=>{q&&q.cancel(),T.cancel()})},z=v.getLayer(n);if(!z)return void p(new Error(`Unknown sourceLayer "${n}"`));if(z.hasDataForBand(a))return this.updateTextureDescriptor(n,a),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const F=z.getDataRange([a]);if(T=v.createDecodingTask(F),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)L(null,this.entireBuffer.slice(F.firstByte,F.lastByte+1));else{const V=Object.assign({},this.requestParams,{headers:{Range:`bytes=${F.firstByte}-${F.lastByte}`}}),U=s.bj(V,L);this._fetchQueue.push(()=>{U.cancel(),T.cancel()})}else p(null)}updateNeeded(n,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,a){if(!this._mrt)return;const p=this._mrt.getLayer(n);if(!p||!p.hasBand(a)||!p.hasDataForBand(a))return;const{bytes:v,tileSize:b,buffer:T,offset:D,scale:L}=p.getBandView(a),z=b+2*T,F=new s.r({width:z,height:z},v),V=this.texture;V&&V instanceof s.T&&V.update(F,{premultiply:!1}),this.textureDescriptor={layer:n,band:a,img:F,buffer:T,offset:D,tileSize:b,format:p.pixelFormat,mix:[L,256*L,65536*L,16777216*L]}}}class uy{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(const n in this.data)for(const a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,p){const v=n.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const b={value:a,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(n,b)},p)),this.data[v].push(b),this.order.push(v),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){const a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;const p=n.wrapped().key,v=a===void 0?0:this.data[p].indexOf(a),b=this.data[p][v];return this.data[p].splice(v,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){const a=[];for(const p in this.data)for(const v of this.data[p])n(v.value)||a.push(v);for(const p of a)this.remove(p.value.tileID,p)}}class Bp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,p){const v=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][v]=this.stateChanges[n][v]||{},s.l(this.stateChanges[n][v],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==v&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][v]===null){this.deletedStates[n][v]={};for(const b in this.state[n][v])p[b]||(this.deletedStates[n][v][b]=null)}else for(const b in p)this.deletedStates[n]&&this.deletedStates[n][v]&&this.deletedStates[n][v][b]===null&&delete this.deletedStates[n][v][b]}removeFeatureState(n,a,p){if(this.deletedStates[n]===null)return;const v=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&a!==void 0)this.deletedStates[n][v]!==null&&(this.deletedStates[n][v]=this.deletedStates[n][v]||{},this.deletedStates[n][v][p]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][v])for(p in this.deletedStates[n][v]={},this.stateChanges[n][v])this.deletedStates[n][v][p]=null;else this.deletedStates[n][v]=null;else this.deletedStates[n]=null}getState(n,a){const p=this.state[n]||{},v=this.stateChanges[n]||{},b=this.deletedStates[n];if(b===null)return{};if(a!==void 0){const D=String(a),L=s.l({},p[D],v[D]);if(b){const z=b[a];if(z===null)return{};for(const F in z)delete L[F]}return L}const T=s.l({},p,v);if(b)for(const D in b)delete T[D];return T}initializeTileState(n,a){n.refreshFeatureState(a)}coalesceChanges(n,a){const p={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const b={};for(const T in this.stateChanges[v])this.state[v][T]||(this.state[v][T]={}),s.l(this.state[v][T],this.stateChanges[v][T]),b[T]=this.state[v][T];p[v]=b}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const b={};if(this.deletedStates[v]===null)for(const T in this.state[v])b[T]={},this.state[v][T]={};else for(const T in this.deletedStates[v]){if(this.deletedStates[v][T]===null)this.state[v][T]={};else if(this.state[v][T])for(const D of Object.keys(this.deletedStates[v][T]))delete this.state[v][T][D];b[T]=this.state[v][T]}p[v]=p[v]||{},s.l(p[v],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const v in n)n[v].refreshFeatureState(a)}}class no extends s.E{constructor(n,a,p){super(),this.id=n,this._onlySymbols=p,a.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new uy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Bp,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const p=this._tiles[a];p.upload(n),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Qi).map(n=>n.key)}getRenderableIds(n,a){const p=[];for(const v in this._tiles)this._isIdRenderable(+v,n,a)&&p.push(this._tiles[v]);return n?p.sort((v,b)=>{const T=v.tileID,D=b.tileID,L=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),z=new s.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-D.overscaledZ||z.y-L.y||z.x-L.x}).map(v=>v.tileID.key):p.map(v=>v.tileID).sort(Qi).map(v=>v.key)}hasRenderableParent(n){const a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=a),this._loadTile(p,this._tileLoaded.bind(this,p,n,a)))}_tileLoaded(n,a,p,v){if(v)if(n.state="errored",v.status!==404)this._source.fire(new s.z(v,{tile:n}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=s.q.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const a=this.getRenderableIds();for(let v=0;v<a.length;v++){const b=a[v];if(n.neighboringTiles&&n.neighboringTiles[b]){const T=this.getTileByID(b);p(n,T),p(T,n)}}function p(v,b){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-v.tileID.canonical.x;const D=b.tileID.canonical.y-v.tileID.canonical.y,L=Math.pow(2,v.tileID.canonical.z),z=b.tileID.key;T===0&&D===0||Math.abs(D)>1||(Math.abs(T)>1&&(Math.abs(T+L)===1?T+=L:Math.abs(T-L)===1&&(T-=L)),b.dem&&v.dem&&(v.dem.backfillBorder(b.dem,T,D),v.neighboringTiles&&v.neighboringTiles[z]&&(v.neighboringTiles[z].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,p,v){for(const b in this._tiles){let T=this._tiles[b];if(v[b]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>p)continue;let D=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const z=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[z.key],T&&T.hasData()&&(D=z)}let L=D;for(;L.overscaledZ>a;)if(L=L.scaledTo(L.overscaledZ-1),n[L.key]){v[D.key]=D;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=a?p:null}for(let p=n.overscaledZ-1;p>=a;p--){const v=n.scaledTo(p),b=this._getLoadedTile(v);if(b)return b}}_getLoadedTile(n){const a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;const p=Math.ceil(n.width/a)+1,v=Math.ceil(n.height/a)+1,b=Math.floor(p*v*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(D)}handleWrapJump(n){const a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){const p={};for(const v in this._tiles){const b=this._tiles[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),p[b.tileID.key]=b}this._tiles=p;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(n,a,p,v){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let T,D=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const V=L.attenuationRange()[0],U=Math.floor(V)-Math.log2(L.getDemUpscale());D>U&&(D=U)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new s.aH(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y));else if(this.tileCoverLift!==0){const V=n.clone();V.tileCoverLift=this.tileCoverLift,T=V.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&n.projection.name==="globe"&&(T.push(new s.aH(1,0,1,0,0)),T.push(new s.aH(1,0,1,1,0)),T.push(new s.aH(1,0,1,0,1)),T.push(new s.aH(1,0,1,1,1)))}else if(T=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const V=this._source.hasTile.bind(this._source);T=T.filter(U=>V(U))}}else T=[];if(T.length>0&&this.castsShadows&&v&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Np(this._source.type)){const V=n.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),U=Math.min(V,this._source.maxzoom);if(b){const q=n.extendTileCover(T,U);for(const J of q)T.push(J)}else{const q=n.extendTileCover(T,U,v);for(const J of q)this._shadowCasterTiles[J.key]=!0,T.push(J)}}const z=this._updateRetainedTiles(T);if(Np(this._source.type)&&T.length!==0){const V={},U={},q=Object.keys(z);for(const X of q){const ee=z[X],ie=this._tiles[X];if(!ie||ie.fadeEndTime&&ie.fadeEndTime<=s.q.now())continue;const le=this.findLoadedParent(ee,Math.max(ee.overscaledZ-no.maxOverzooming,this._source.minzoom));le&&(this._addTile(le.tileID),V[le.tileID.key]=le.tileID),U[X]=ee}const J=T[T.length-1].overscaledZ;for(const X in this._tiles){const ee=this._tiles[X];if(z[X]||!ee.hasData())continue;let ie=ee.tileID;for(;ie.overscaledZ>J;){ie=ie.scaledTo(ie.overscaledZ-1);const le=this._tiles[ie.key];if(le&&le.hasData()&&U[ie.key]){z[X]=ee.tileID;break}}}for(const X in V)z[X]||(this._coveredTiles[X]=!0,z[X]=V[X])}for(const V in z)this._tiles[V].clearFadeHold();const F=s.bk(this._tiles,z);for(const V of F){const U=this._tiles[V];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(+V)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const a={};if(n.length===0)return a;const p={},v=n.reduce((z,F)=>Math.min(z,F.overscaledZ),1/0),b=n[0].overscaledZ,T=Math.max(b-no.maxOverzooming,this._source.minzoom),D=Math.max(b+no.maxUnderzooming,this._source.minzoom),L={};for(const z of n){const F=this._addTile(z);a[z.key]=z,F.hasData()||v<this._source.maxzoom&&(L[z.key]=z)}this._retainLoadedChildren(L,v,D,a);for(const z of n){let F=this._tiles[z.key];if(F.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const U=z.children(this._source.maxzoom)[0],q=this.getTile(U);if(q&&q.hasData()){a[U.key]=U;continue}}else{const U=z.children(this._source.maxzoom);if(a[U[0].key]&&a[U[1].key]&&a[U[2].key]&&a[U[3].key])continue}let V=F.wasRequested();for(let U=z.overscaledZ-1;U>=T;--U){const q=z.scaledTo(U);if(p[q.key]||(p[q.key]=!0,F=this.getTile(q),!F&&V&&(F=this._addTile(q)),F&&(a[q.key]=q,V=F.wasRequested(),F.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const a=[];let p,v=this._tiles[n].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){p=this._loadedParentTiles[v.key];break}a.push(v.key);const b=v.scaledTo(v.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;v=b}for(const b of a)this._loadedParentTiles[b]=p}}_addTile(n){let a=this._tiles[n.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));const p=!!a;if(!p){const v=this.map?this.map.painter:null,b=this._source.tileSize*n.overscaleFactor();a=this._source.type==="raster-array"?new pr(n,b,this.transform.tileZoom,v,this._isRaster):new wo(n,b,this.transform.tileZoom,v,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a?(a.uses++,this._tiles[n.key]=a,p||this._source.fire(new s.A("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=a.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,p){const v=[],b=this.transform;if(!b)return v;const T=b.projection.name==="globe",D=s.av(b.center.lng);for(const L in this._tiles){const z=this._tiles[L];if(p&&z.clearQueryDebugViz(),z.holdingForFade())continue;let F;if(T){const V=z.tileID.canonical;if(V.z===0){const U=[Math.abs(s.ay(D,...ni(V,-1))-D),Math.abs(s.ay(D,...ni(V,1))-D)];F=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(s.ay(D,...ni(V,-1))-D),Math.abs(s.ay(D,...ni(V,0))-D),Math.abs(s.ay(D,...ni(V,1))-D)];F=[U.indexOf(Math.min(...U))-1]}}else F=[0];for(const V of F){const U=n.containsTile(z,b,a,V);U&&v.push(U)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,a){const p=this.getRenderableIds(n,a).map(b=>this._tiles[b].tileID),v=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=v?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(n){const a=n.slice(),p=this.transform._camera.position,v=this.transform._camera.forward(),b={};for(const T of a){const D=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*D+T.wrap-p[0])*v[0]+((T.canonical.y+.5)*D-p[1])*v[1]-p[2]*v[2]}return a.sort((T,D)=>b[T.key]-b[D.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Np(this._source.type))for(const n in this._tiles){const a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(n,a,p){this._state.updateState(n=n||"_geojsonTileLayer",a,p)}removeFeatureState(n,a,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,p)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,p){const v=this._tiles[n];v&&v.setDependencies(a,p)}reloadTilesForDependencies(n,a){for(const p in this._tiles)this._tiles[p].hasDependency(n,a)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(n,a))}_preloadTiles(n,a){if(!this._sourceLoaded){const L=()=>{this._sourceLoaded&&(this._source.off("data",L),this._preloadTiles(n,a))};return void this._source.on("data",L)}const p=new Map,v=Array.isArray(n)?n:[n],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const L of v){const z=L.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of z)p.set(F.key,F);this.usedForTerrain&&L.updateElevation(!1)}const D=Array.from(p.values());s.bl(D,(L,z)=>{const F=new wo(L,this._source.tileSize*L.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(F,V=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),z(V,F)})},a)}}function Qi(m,n){const a=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return m.overscaledZ-n.overscaledZ||p-a||n.canonical.y-m.canonical.y||n.canonical.x-m.canonical.x}function Np(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function ni(m,n){const a=1<<m.z;return[m.x/a+n,(m.x+1)/a+n]}no.maxOverzooming=10,no.maxUnderzooming=3;class hy{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,a=!1;for(const p in this.style._mergedLayers){const v=this.style._mergedLayers[p];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:n,visibilityChanged:a});else if(v.type==="model"){const b=this.style.getLayerSource(v);b&&b.type==="batched-model"&&this.layers.push({layer:v,visible:n,visibilityChanged:a})}}}onNewFrame(n){this.layersGotHidden=!1;for(const a of this.layers){const p=a.layer;let v=!1;p.type==="fill-extrusion"?v=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(v=!p.isHidden(n)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&a.visible,a.visible=v}}updateZOffset(n,a){this.currentBuildingBuckets=[];for(const v of this.layers){const b=v.layer,T=this.style.getLayerSourceCache(b);let D=1;b.type==="fill-extrusion"&&(D=v.visible?b.paint.get("fill-extrusion-vertical-scale"):0);let L=T?T.getTile(a):null;if(!L&&T&&a.canonical.z>T.getSource().minzoom){let z=a.scaledTo(Math.min(T.getSource().maxzoom,a.overscaledZ-1));for(;z.overscaledZ>=T.getSource().minzoom&&(L=T.getTile(z),!L&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:L?L.getBucket(b):null,tileID:L?L.tileID:a,verticalScale:D})}n.hasAnyZOffset=!1;let p=!1;for(let v=0;v<n.symbolInstances.length;v++){const b=n.symbolInstances.get(v),T=b.zOffset,D=this._getHeightAtTileOffset(a,b.tileAnchorX,b.tileAnchorY);b.zOffset=D!==Number.NEGATIVE_INFINITY?D:T,p||T===b.zOffset||(p=!0),n.hasAnyZOffset||b.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,a,p,v){let b=a,T=p;if(n.canonical.z!==v.canonical.z){const D=v.canonical,L=1/(1<<n.canonical.z-D.z);b=(a+n.canonical.x*s.ai)*L-D.x*s.ai|0,T=(p+n.canonical.y*s.ai)*L-D.y*s.ai|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(n,a,p){let v,b;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:D,tileID:L,verticalScale:z}=this.currentBuildingBuckets[T];if(!D)continue;const{tileX:F,tileY:V}=this._mapCoordToOverlappingTile(n,a,p,L),U=D.getHeightAtTileCoord(F,V);U&&U.height!==void 0&&(U.hidden?v=U.height:b=Math.max(U.height*z,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const D=this.layers[T];if(D.layer.type!=="model"||!D.visible)continue;const{bucket:L,tileID:z}=this.currentBuildingBuckets[T];if(!L)continue;const{tileX:F,tileY:V}=this._mapCoordToOverlappingTile(n,a,p,z),U=L.getHeightAtTileCoord(F,V);if(U&&!U.hidden)return U.height===void 0&&v!==void 0?Math.min(U.maxHeight,v)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function dy(m,n){const a={};for(const p in m)p!=="ref"&&(a[p]=m[p]);return s.bm.forEach(p=>{p in n&&(a[p]=n[p])}),a}function Zu(m){m=m.slice();const n=Object.create(null);for(let a=0;a<m.length;a++)n[m[a].id]=m[a];for(let a=0;a<m.length;a++)"ref"in m[a]&&(m[a]=dy(m[a],n[m[a].ref]));return m}const $i={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function so(m,n,a){a.push({command:$i.addSource,args:[m,n[m]]})}function Md(m,n,a){n.push({command:$i.removeSource,args:[m]}),a[m]=!0}function mc(m,n,a,p){Md(m,a,p),so(m,n,a)}function Gt(m,n,a){let p;for(p in m[a])if(m[a].hasOwnProperty(p)&&p!=="data"&&!s.bn(m[a][p],n[a][p]))return!1;for(p in n[a])if(n[a].hasOwnProperty(p)&&p!=="data"&&!s.bn(m[a][p],n[a][p]))return!1;return!0}function Yi(m,n,a,p,v,b){let T;for(T in n=n||{},m=m||{})m.hasOwnProperty(T)&&(s.bn(m[T],n[T])||a.push({command:b,args:[p,T,n[T],v]}));for(T in n)n.hasOwnProperty(T)&&!m.hasOwnProperty(T)&&(s.bn(m[T],n[T])||a.push({command:b,args:[p,T,n[T],v]}))}function Ni(m){return m.id}function Xs(m,n){return m[n.id]=n,m}class gc{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.ay(n,0,1);let a=1,p=this._distances[a];const v=n*this.paddedLength+this.padding;for(;p<v&&a<this._distances.length;)p=this._distances[++a];const b=a-1,T=this._distances[b],D=p-T,L=D>0?(v-T)/D:0;return this.points[b].mult(1-L).add(this.points[a].mult(L))}}class Hi{constructor(n,a,p){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(a/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,p,v,b){this._forEachCell(a,p,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(n,a,p,v){this._forEachCell(a-v,p-v,a+v,p+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(p),this.circles.push(v)}_insertBoxCell(n,a,p,v,b,T){this.boxCells[b].push(T)}_insertCircleCell(n,a,p,v,b,T){this.circleCells[b].push(T)}_query(n,a,p,v,b,T){if(p<0||n>this.width||v<0||a>this.height)return!b&&[];const D=[];if(n<=0&&a<=0&&this.width<=p&&this.height<=v){if(b)return!0;for(let L=0;L<this.boxKeys.length;L++)D.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const z=this.circles[3*L],F=this.circles[3*L+1],V=this.circles[3*L+2];D.push({key:this.circleKeys[L],x1:z-V,y1:F-V,x2:z+V,y2:F+V})}return T?D.filter(T):D}return this._forEachCell(n,a,p,v,this._queryCell,D,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?D.length>0:D}_queryCircle(n,a,p,v,b){const T=n-p,D=n+p,L=a-p,z=a+p;if(D<0||T>this.width||z<0||L>this.height)return!v&&[];const F=[];return this._forEachCell(T,L,D,z,this._queryCellCircle,F,{hitTest:v,circle:{x:n,y:a,radius:p},seenUids:{box:{},circle:{}}},b),v?F.length>0:F}query(n,a,p,v,b){return this._query(n,a,p,v,!1,b)}hitTest(n,a,p,v,b){return this._query(n,a,p,v,!0,b)}hitTestCircle(n,a,p,v){return this._queryCircle(n,a,p,!0,v)}_queryCell(n,a,p,v,b,T,D,L){const z=D.seenUids,F=this.boxCells[b];if(F!==null){const U=this.bboxes;for(const q of F)if(!z.box[q]){z.box[q]=!0;const J=4*q;if(n<=U[J+2]&&a<=U[J+3]&&p>=U[J+0]&&v>=U[J+1]&&(!L||L(this.boxKeys[q]))){if(D.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[q],x1:U[J],y1:U[J+1],x2:U[J+2],y2:U[J+3]})}}}const V=this.circleCells[b];if(V!==null){const U=this.circles;for(const q of V)if(!z.circle[q]){z.circle[q]=!0;const J=3*q;if(this._circleAndRectCollide(U[J],U[J+1],U[J+2],n,a,p,v)&&(!L||L(this.circleKeys[q]))){if(D.hitTest)return T.push(!0),!0;{const X=U[J],ee=U[J+1],ie=U[J+2];T.push({key:this.circleKeys[q],x1:X-ie,y1:ee-ie,x2:X+ie,y2:ee+ie})}}}}}_queryCellCircle(n,a,p,v,b,T,D,L){const z=D.circle,F=D.seenUids,V=this.boxCells[b];if(V!==null){const q=this.bboxes;for(const J of V)if(!F.box[J]){F.box[J]=!0;const X=4*J;if(this._circleAndRectCollide(z.x,z.y,z.radius,q[X+0],q[X+1],q[X+2],q[X+3])&&(!L||L(this.boxKeys[J])))return T.push(!0),!0}}const U=this.circleCells[b];if(U!==null){const q=this.circles;for(const J of U)if(!F.circle[J]){F.circle[J]=!0;const X=3*J;if(this._circlesCollide(q[X],q[X+1],q[X+2],z.x,z.y,z.radius)&&(!L||L(this.circleKeys[J])))return T.push(!0),!0}}}_forEachCell(n,a,p,v,b,T,D,L){const z=this._convertToXCellCoord(n),F=this._convertToYCellCoord(a),V=this._convertToXCellCoord(p),U=this._convertToYCellCoord(v);for(let q=z;q<=V;q++)for(let J=F;J<=U;J++)if(b.call(this,n,a,p,v,this.xCellCount*J+q,T,D,L))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,p,v,b,T){const D=v-n,L=b-a,z=p+T;return z*z>D*D+L*L}_circleAndRectCollide(n,a,p,v,b,T,D){const L=(T-v)/2,z=Math.abs(n-(v+L));if(z>L+p)return!1;const F=(D-b)/2,V=Math.abs(a-(b+F));if(V>F+p)return!1;if(z<=L||V<=F)return!0;const U=z-L,q=V-F;return U*U+q*q<=p*p}}const ha={unknown:0,flipRequired:1,flipNotRequired:2},Xu=Math.tan(85*Math.PI/180);function da(m,n,a,p,v,b,T){const D=s.ad.mat4.create();if(a)if(b.name==="globe"){const L=s.bo(v,n);s.ad.mat4.multiply(D,D,L)}else{const L=s.ad.mat2.invert([],T);D[0]=L[0],D[1]=L[1],D[4]=L[2],D[5]=L[3],p||s.ad.mat4.rotateZ(D,D,v.angle)}else s.ad.mat4.multiply(D,v.labelPlaneMatrix,m);return D}function Vs(m,n,a,p,v,b,T){const D=da(m,n,a,p,v,b,T);return b.name==="globe"&&a||(D[2]=D[6]=D[10]=D[14]=0),D}function qn(m,n,a,p,v,b,T){if(a){if(b.name==="globe"){const D=da(m,n,a,p,v,b,T);return s.ad.mat4.invert(D,D),s.ad.mat4.multiply(D,m,D),D}{const D=s.ad.mat4.clone(m),L=s.ad.mat4.identity([]);return L[0]=T[0],L[1]=T[1],L[4]=T[2],L[5]=T[3],s.ad.mat4.multiply(D,D,L),p||s.ad.mat4.rotateZ(D,D,-v.angle),D}}return v.glCoordMatrix}function To(m,n,a,p){const v=[m,n,a,1];a?s.ad.vec4.transformMat4(v,v,p):ns(v,v,p);const b=v[3];return v[0]/=b,v[1]/=b,v[2]/=b,v}function _c(m,n){return Math.min(.5+m/n*.5,1.5)}function Vp(m,n){const a=m[0]/m[3],p=m[1]/m[3];return a>=-n[0]&&a<=n[0]&&p>=-n[1]&&p<=n[1]}function yc(m,n,a,p,v,b,T,D,L,z){const F=a.transform,V=p?m.textSizeData:m.iconSizeData,U=s.bp(V,a.transform.zoom),q=F.projection.name==="globe",J=[256/a.width*2+1,256/a.height*2+1],X=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;X.clear();let ee=null;q&&(ee=p?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const ie=m.lineVertexArray,le=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,_e=a.transform.width/a.transform.height;let pe,we=!1;for(let ve=0;ve<le.length;ve++){const xe=le.get(ve),{numGlyphs:be,writingMode:Ce}=xe;if(Ce!==s.bq.vertical||we||pe===s.bq.horizontal||(we=!0),pe=Ce,(xe.hidden||Ce===s.bq.vertical)&&!we){Eo(be,X);continue}we=!1;const Re=new s.P(xe.tileAnchorX,xe.tileAnchorY);let{x:Je,y:$e,z:ct}=F.projection.projectTilePoint(Re.x,Re.y,z.canonical);if(L){const[Pt,Dt,$t]=L(Re);Je+=Pt,$e+=Dt,ct+=$t}const ut=[Je,$e,ct,1];if(s.ad.vec4.transformMat4(ut,ut,n),!Vp(ut,J)){Eo(be,X);continue}const vt=ut[3],je=_c(a.transform.getCameraToCenterDistance(F.projection),vt),at=s.br(V,U,xe),Ne=T?at/je:at*je,ot=To(Je,$e,ct,v);if(ot[3]<=0){Eo(be,X);continue}let st={};const ht=s.ak(m.layers[0].layout.get("text-max-angle")),Qe=Math.cos(ht),ft=T?null:L,Ct=Ys(xe,Ne,!1,D,n,v,b,m.glyphOffsetArray,ie,X,ee,ot,Re,st,_e,ft,F.projection,z,T,Qe);we=Ct.useVertical,ft&&Ct.needsFlipping&&(st={}),(Ct.notEnoughRoom||we||Ct.needsFlipping&&Ys(xe,Ne,!0,D,n,v,b,m.glyphOffsetArray,ie,X,ee,ot,Re,st,_e,ft,F.projection,z,T,Qe).notEnoughRoom)&&Eo(be,X)}p?(m.text.dynamicLayoutVertexBuffer.updateData(X),ee&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ee)):(m.icon.dynamicLayoutVertexBuffer.updateData(X),ee&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ee))}function Id(m,n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee){const{lineStartIndex:ie,glyphStartIndex:le,segment:_e}=D,pe=le+D.numGlyphs,we=ie+D.lineLength,ve=n.getoffsetX(le),xe=n.getoffsetX(pe-1),be=Ku(m*ve,a,p,v,b,T,_e,ie,we,L,z,F,V,U,!0,q,J,X,ee);if(!be)return null;const Ce=Ku(m*xe,a,p,v,b,T,_e,ie,we,L,z,F,V,U,!0,q,J,X,ee);return Ce?{first:be,last:Ce}:null}function Yu(m,n,a,p){return m===s.bq.horizontal&&Math.abs(p)>Math.abs(a)?{useVertical:!0}:m===s.bq.vertical?p>0?{needsFlipping:!0}:null:n!==ha.unknown&&function(v,b){return v===0||Math.abs(b/v)>Xu}(a,p)?n===ha.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Ys(m,n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee,ie,le,_e){const pe=n/24,we=m.lineOffsetX*pe,ve=m.lineOffsetY*pe,{lineStartIndex:xe,glyphStartIndex:be,numGlyphs:Ce,segment:Re,writingMode:Je,flipState:$e}=m,ct=xe+m.lineLength,ut=vt=>{if(F){const[ot,st,ht]=vt.up,Qe=z.length;s.bs(F,Qe+0,ot,st,ht),s.bs(F,Qe+1,ot,st,ht),s.bs(F,Qe+2,ot,st,ht),s.bs(F,Qe+3,ot,st,ht)}const[je,at,Ne]=vt.point;s.bt(z,je,at,Ne,vt.angle)};if(Ce>1){const vt=Id(pe,D,we,ve,a,V,U,m,L,b,q,X,!1,ee,ie,le,_e);if(!vt)return{notEnoughRoom:!0};if(p&&!a){let[je,at,Ne]=vt.first.point,[ot,st,ht]=vt.last.point;[je,at]=To(je,at,Ne,T),[ot,st]=To(ot,st,ht,T);const Qe=Yu(Je,$e,(ot-je)*J,st-at);if(m.flipState=Qe&&Qe.needsFlipping?ha.flipRequired:ha.flipNotRequired,Qe)return Qe}ut(vt.first);for(let je=be+1;je<be+Ce-1;je++){const at=Ku(pe*D.getoffsetX(je),we,ve,a,V,U,Re,xe,ct,L,b,q,X,!1,!1,ee,ie,le,_e);if(!at)return z.length-=4*(je-be),{notEnoughRoom:!0};ut(at)}ut(vt.last)}else{if(p&&!a){const je=To(U.x,U.y,0,v),at=xe+Re+1,Ne=new s.P(L.getx(at),L.gety(at)),ot=To(Ne.x,Ne.y,0,v),st=ot[3]>0?ot:Ks(U,Ne,je,1,v,void 0,ee,ie.canonical),ht=Yu(Je,$e,(st[0]-je[0])*J,st[1]-je[1]);if(m.flipState=ht&&ht.needsFlipping?ha.flipRequired:ha.flipNotRequired,ht)return ht}const vt=Ku(pe*D.getoffsetX(be),we,ve,a,V,U,Re,xe,ct,L,b,q,X,!1,!1,ee,ie,le,_e);if(!vt)return{notEnoughRoom:!0};ut(vt)}return{}}function Ho(m,n,a,p,v){const{x:b,y:T,z:D}=p.projectTilePoint(m.x,m.y,n);if(!v)return To(b,T,D,a);const[L,z,F]=v(m);return To(b+L,T+z,D+F,a)}function Ks(m,n,a,p,v,b,T,D){const L=Ho(m.sub(n)._unit()._add(m),D,v,T,b);return s.ad.vec3.sub(L,a,L),s.ad.vec3.normalize(L,L),s.ad.vec3.scaleAndAdd(L,a,L,p)}function Ku(m,n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee,ie,le){const _e=p?m-n:m+n;let pe=_e>0?1:-1,we=0;p&&(pe*=-1,we=Math.PI),pe<0&&(we+=Math.PI);let ve=D+T+(pe>0?0:1)|0,xe=v,be=v,Ce=0,Re=0;const Je=Math.abs(_e),$e=[],ct=[];let ut=b,vt=ut,je=s.ad.vec3.zero([]);const at=()=>Ks(vt,ut,be,Je-Ce+1,F,U,X,ee.canonical);for(;Ce+Re<=Je;){if(ve+=pe,ve<D||ve>=L)return null;if(be=xe,vt=ut,$e.push(be),q&&ct.push(vt),ut=new s.P(z.getx(ve),z.gety(ve)),xe=V[ve],!xe){const $t=Ho(ut,ee.canonical,F,X,U);xe=$t[3]>0?V[ve]=$t:at()}Ce+=Re;const Pt=s.ad.vec3.sub([],xe,be),Dt=s.ad.vec3.distance(be,xe);if(a&&Dt>0&&Re>0&&s.ad.vec3.dot(je,Pt)/(Re*Dt)<le)return null;Re=Dt,je=Pt}J&&U&&(V[ve]&&(xe=at(),Re=s.ad.vec3.distance(be,xe),je=s.ad.vec3.sub([],xe,be)),V[ve]=xe);const Ne=(Je-Ce)/Re,ot=ut.sub(vt)._mult(Ne)._add(vt),st=s.ad.vec3.scaleAndAdd([],be,je,Ne);let ht=[0,0,1],Qe=je[0],ft=je[1];if(ie&&(ht=X.upVector(ee.canonical,ot.x,ot.y),ht[0]!==0||ht[1]!==0||ht[2]!==1)){const Pt=[ht[2],0,-ht[0]],Dt=s.ad.vec3.cross([],ht,Pt);s.ad.vec3.normalize(Pt,Pt),s.ad.vec3.normalize(Dt,Dt),Qe=s.ad.vec3.dot(je,Pt),ft=s.ad.vec3.dot(je,Dt)}if(a){const Pt=s.ad.vec3.cross([],ht,je);s.ad.vec3.normalize(Pt,Pt),s.ad.vec3.scaleAndAdd(st,st,Pt,a*pe)}const Ct=we+Math.atan2(ft,Qe);return $e.push(st),q&&ct.push(ot),{point:st,angle:Ct,path:$e,tilePath:ct,up:ht}}function Eo(m,n){const a=n.length,p=a+4*m;n.resize(p),n.float32.fill(-1/0,4*a,4*p)}function ns(m,n,a){const p=n[0],v=n[1];return m[0]=a[0]*p+a[4]*v+a[12],m[1]=a[1]*p+a[5]*v+a[13],m[3]=a[3]*p+a[7]*v+a[15],m}const As=100;class fa{constructor(n,a,p=new Hi(n.width+200,n.height+200,25),v=new Hi(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=v,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+As,this.screenBottomBoundary=n.height+As,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,p,v,b,T,D,L){let z=p.projectedAnchorX,F=p.projectedAnchorY,V=p.projectedAnchorZ;const U=p.elevation,q=p.tileID,J=n.getProjection();if(U&&q){const[ve,xe,be]=J.upVector(q.canonical,p.tileAnchorX,p.tileAnchorY),Ce=J.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=ve*U*Ce,F+=xe*U*Ce,V+=be*U*Ce}const X=this.projectAndGetPerspectiveRatio(D,z,F,V,p.tileID,J.name==="globe"||!!U||this.transform.pitch>0,J),ee=T*X.perspectiveRatio,ie=(p.x1*a+v.x-p.padding)*ee+X.point.x,le=(p.y1*a+v.y-p.padding)*ee+X.point.y,_e=(p.x2*a+v.x+p.padding)*ee+X.point.x,pe=(p.y2*a+v.y+p.padding)*ee+X.point.y,we=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(ie,le,_e,pe)||!b&&this.grid.hitTest(ie,le,_e,pe,L)||we?{box:[],offscreen:!1,occluded:X.occluded}:{box:[ie,le,_e,pe],offscreen:this.isOffscreen(ie,le,_e,pe),occluded:!1}}placeCollisionCircles(n,a,p,v,b,T,D,L,z,F,V,U,q,J,X){const ee=[],ie=this.transform.elevation,le=n.getProjection(),_e=ie?ie.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,le):null,pe=new s.P(p.tileAnchorX,p.tileAnchorY);let{x:we,y:ve,z:xe}=le.projectTilePoint(pe.x,pe.y,X.canonical);if(_e){const[ht,Qe,ft]=_e(pe);we+=ht,ve+=Qe,xe+=ft}const be=le.name==="globe",Ce=this.projectAndGetPerspectiveRatio(D,we,ve,xe,X,be||!!ie||this.transform.pitch>0,le),{perspectiveRatio:Re}=Ce,Je=(V?T/Re:T*Re)/s.bw,$e=To(we,ve,xe,L),ct=p.lineOffsetX*Je,ut=p.lineOffsetY*Je,vt=s.ak(n.layers[0].layout.get("text-max-angle")),je=Math.cos(vt),at=Ce.signedDistanceFromCamera>0?Id(Je,b,ct,ut,!1,$e,pe,p,v,L,{},ie&&!V?_e:null,V&&!!ie,le,X,V,je):null;let Ne=!1,ot=!1,st=!0;if(at&&!Ce.occluded){const ht=.5*q*Re+J,Qe=new s.P(-100,-100),ft=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Ct=new gc,{first:Pt,last:Dt}=at,$t=Pt.path.length;let pi=[];for(let oi=$t-1;oi>=1;oi--)pi.push(Pt.path[oi]);for(let oi=1;oi<Dt.path.length;oi++)pi.push(Dt.path[oi]);const ti=2.5*ht;z&&(pi=pi.map(([oi,Di,Wi],mn)=>(_e&&!be&&(Wi=_e(mn<$t-1?Pt.tilePath[$t-1-mn]:Dt.tilePath[mn-$t+2])[2]),To(oi,Di,Wi,z))),pi.some(oi=>oi[3]<=0)&&(pi=[]));let hi=[];if(pi.length>0){let oi=1/0,Di=-1/0,Wi=1/0,mn=-1/0;for(const Si of pi)oi=Math.min(oi,Si[0]),Wi=Math.min(Wi,Si[1]),Di=Math.max(Di,Si[0]),mn=Math.max(mn,Si[1]);Di>=Qe.x&&oi<=ft.x&&mn>=Qe.y&&Wi<=ft.y&&(hi=[pi.map(Si=>new s.P(Si[0],Si[1]))],(oi<Qe.x||Di>ft.x||Wi<Qe.y||mn>ft.y)&&(hi=s.bu(hi,Qe.x,Qe.y,ft.x,ft.y)))}for(const oi of hi){Ct.reset(oi,.25*ht);let Di=0;Di=Ct.length<=.5*ht?1:Math.ceil(Ct.paddedLength/ti)+1;for(let Wi=0;Wi<Di;Wi++){const mn=Wi/Math.max(Di-1,1),Si=Ct.lerp(mn),In=Si.x+As,_i=Si.y+As;ee.push(In,_i,ht,0);const Ht=In-ht,Li=_i-ht,en=In+ht,Vi=_i+ht;if(st=st&&this.isOffscreen(Ht,Li,en,Vi),ot=ot||this.isInsideGrid(Ht,Li,en,Vi),!a&&this.grid.hitTestCircle(In,_i,ht,U)&&(Ne=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Ne,occluded:!1}}}}return{circles:!F&&Ne||!ot?[]:ee,offscreen:st,collisionDetected:Ne,occluded:Ce.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let p=1/0,v=1/0,b=-1/0,T=-1/0;for(const F of n){const V=new s.P(F.x+As,F.y+As);p=Math.min(p,V.x),v=Math.min(v,V.y),b=Math.max(b,V.x),T=Math.max(T,V.y),a.push(V)}const D=this.grid.query(p,v,b,T).concat(this.ignoredGrid.query(p,v,b,T)),L={},z={};for(const F of D){const V=F.key;if(L[V.bucketInstanceId]===void 0&&(L[V.bucketInstanceId]={}),L[V.bucketInstanceId][V.featureIndex])continue;const U=[new s.P(F.x1,F.y1),new s.P(F.x2,F.y1),new s.P(F.x2,F.y2),new s.P(F.x1,F.y2)];s.bv(a,U)&&(L[V.bucketInstanceId][V.featureIndex]=!0,z[V.bucketInstanceId]===void 0&&(z[V.bucketInstanceId]=[]),z[V.bucketInstanceId].push(V.featureIndex))}return z}insertCollisionBox(n,a,p,v,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:v,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,p,v,b){const T=a?this.ignoredGrid:this.grid,D={bucketInstanceId:p,featureIndex:v,collisionGroupID:b};for(let L=0;L<n.length;L+=4)T.insertCircle(D,n[L],n[L+1],n[L+2])}projectAndGetPerspectiveRatio(n,a,p,v,b,T,D){const L=[a,p,v,1];let z=!1;v||this.transform.pitch>0?(s.ad.vec4.transformMat4(L,L,n),this.fogState&&b&&D.name!=="globe"&&(z=function(U,q,J,X,ee,ie){const le=ie.calculateFogTileMatrix(ee),_e=[q,J,X];return s.ad.vec3.transformMat4(_e,_e,le),Nt(U,s.ad.vec3.length(_e),ie.pitch,ie._fov)}(this.fogState,a,p,v,b.toUnwrapped(),this.transform)>.9)):ns(L,L,n);const F=L[3];return{point:new s.P((L[0]/F+1)/2*this.transform.width+As,(-L[1]/F+1)/2*this.transform.height+As),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/F*.5,1.5),signedDistanceFromCamera:F,occluded:T&&L[2]>F||z}}isOffscreen(n,a,p,v){return p<As||n>=this.screenRightBoundary||v<As||a>this.screenBottomBoundary}isInsideGrid(n,a,p,v){return p>=0&&n<this.gridRightBoundary&&v>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=s.ad.mat4.identity([]);return s.ad.mat4.translate(n,n,[-100,-100,0]),n}}function Zn(m,n,a){const p=n.createTileMatrix(m,m.worldSize,a.toUnwrapped());return s.ad.mat4.multiply(new Float32Array(16),m.projMatrix,p)}function Up(m,n,a){if(n.projection.name===a.projection.name)return m.projMatrix;const p=a.clone();return p.setProjection(n.projection),Zn(p,n.getProjection(),m)}function Ur(m,n,a){return n.name===a.projection.name?m.projMatrix:Zn(a,n,m)}class vc{constructor(n,a,p,v){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):v&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Ga{constructor(n,a,p,v,b,T=!1){this.text=new vc(n?n.text:null,a,p,b),this.icon=new vc(n?n.icon:null,a,v,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class pa{constructor(n,a,p,v=!1){this.text=n,this.icon=a,this.skipFade=p,this.clipped=v}}class U1{constructor(){this.invProjMatrix=s.ad.mat4.create(),this.viewportMatrix=s.ad.mat4.create(),this.circles=[]}}class ma{constructor(n,a,p,v,b){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=p,this.bucketIndex=v,this.tileID=b}}class j1{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:p=>p.collisionGroupID===a}}return this.collisionGroups[n]}}function Cd(m,n,a,p,v){const{horizontalAlign:b,verticalAlign:T}=s.bD(m),D=-(b-.5)*n,L=-(T-.5)*a,z=s.bC(m,p);return new s.P(D+z[0]*v,L+z[1]*v)}function lr(m,n,a,p,v){const b=new s.P(m,n);return a&&b._rotate(p?v:-v),b}class $1{constructor(n,a,p,v,b,T){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new fa(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new j1(p),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,p,v,b=1){const T=p.getBucket(a),D=p.latestFeatureIndex;if(!T||!D||a.fqid!==T.layerIds[0])return;const L=T.layers[0].layout,z=T.layers[0].paint,F=p.collisionBoxArray,V=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),U=p.tileSize/s.ai,q=p.tileID.toUnwrapped();this.transform.setProjection(T.projection);const J=(X=p.tileID,ee=T.getProjection(),ie=this.transform,ee.name===this.projection?ie.calculateProjMatrix(X.toUnwrapped()):Zn(ie,ee,X));var X,ee,ie;const le=L.get("text-pitch-alignment")==="map",_e=L.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const pe=a.dynamicFilter(),we=a.dynamicFilterNeedsFeature(),ve=this.transform.calculatePixelsToTileUnitsMatrix(p),xe=Vs(J,p.tileID.canonical,le,_e,this.transform,T.getProjection(),ve);let be=null;if(le){const at=qn(J,p.tileID.canonical,le,_e,this.transform,T.getProjection(),ve);be=s.ad.mat4.multiply([],this.transform.labelPlaneMatrix,at)}let Ce=null;pe&&p.latestFeatureIndex&&(Ce={unwrappedTileID:q,dynamicFilter:pe,dynamicFilterNeedsFeature:we}),this.retainedQueryData[T.bucketInstanceId]=new ma(T.bucketInstanceId,D,T.sourceLayerIndex,T.index,p.tileID);const[Re,Je]=T.layers[0].layout.get("text-size-scale-range"),$e=s.ay(b,Re,Je),[ct,ut]=L.get("icon-size-scale-range"),vt=s.ay(b,ct,ut),je={bucket:T,layout:L,paint:z,posMatrix:J,textLabelPlaneMatrix:xe,labelToScreenMatrix:be,clippingData:Ce,scale:V,textPixelRatio:U,holdingForFade:p.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:s.bp(T.textSizeData,this.transform.zoom,$e),partiallyEvaluatedIconSize:s.bp(T.iconSizeData,this.transform.zoom,vt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(v)for(const at of T.sortKeyRanges){const{sortKey:Ne,symbolInstanceStart:ot,symbolInstanceEnd:st}=at;n.push({sortKey:Ne,symbolInstanceStart:ot,symbolInstanceEnd:st,parameters:je})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:je})}attemptAnchorPlacement(n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee,ie,le){const{textOffset0:_e,textOffset1:pe,crossTileID:we}=U,ve=[_e,pe],xe=Cd(n,p,v,ve,b),be=this.collisionIndex.placeCollisionBox(J,b,a,lr(xe.x,xe.y,T,D,this.transform.angle),V,L,z,F.predicate);if(ee){const Ce=J.getSymbolInstanceIconSize(le,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,Ce,ee,lr(xe.x,xe.y,T,D,this.transform.angle),V,L,z,F.predicate).box.length===0)return}if(be.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(Ce=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:ve,width:p,height:v,anchor:n,textScale:b,prevAnchor:Ce},this.markUsedJustification(J,n,U,X),J.allowVerticalPlacement&&(this.markUsedOrientation(J,X,U),this.placedOrientations[we]=X),{shift:xe,placedGlyphBoxes:be}}}placeLayerBucketPart(n,a,p,v,b=1){const{bucket:T,layout:D,paint:L,posMatrix:z,textLabelPlaneMatrix:F,labelToScreenMatrix:V,clippingData:U,textPixelRatio:q,holdingForFade:J,collisionBoxArray:X,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:ie,collisionGroup:le,latestFeatureIndex:_e}=n.parameters,pe=D.get("text-optional"),we=D.get("icon-optional"),ve=D.get("text-allow-overlap"),xe=D.get("icon-allow-overlap"),be=D.get("text-rotation-alignment")==="map",Ce=D.get("text-pitch-alignment")==="map",Re=L.get("symbol-z-offset"),Je=D.get("symbol-elevation-reference")==="sea",[$e,ct]=D.get("text-size-scale-range"),[ut,vt]=D.get("icon-size-scale-range"),je=s.ay(b,$e,ct),at=s.ay(b,ut,vt);this.transform.setProjection(T.projection);let Ne=ve&&(xe||!T.hasIconData()||we),ot=xe&&(ve||!T.hasTextData()||pe);const st=!Re.isConstant();!T.collisionArrays&&X&&T.deserializeCollisionBoxes(X),p&&v&&T.updateCollisionDebugBuffers(this.transform.zoom,X,je,at);const ht=(Qe,ft,Ct)=>{const{crossTileID:Pt,numVerticalGlyphVertices:Dt}=Qe;let $t=null;if(U&&U.dynamicFilterNeedsFeature||st){const zi=this.retainedQueryData[T.bucketInstanceId];$t=_e.loadFeature({featureIndex:Qe.featureIndex,bucketIndex:zi.bucketIndex,sourceLayerIndex:zi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(U&&!(0,U.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},$t,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new s.P(Qe.tileAnchorX,Qe.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[Pt]=new pa(!1,!1,!1,!0),void a.add(Pt);const pi=Re.evaluate($t,{});if(a.has(Pt))return;if(J)return void(this.placements[Pt]=new pa(!1,!1,!1));let ti=!1,hi=!1,oi=!0,Di=!1,Wi=!1,mn=null,Si={box:null,offscreen:null,occluded:null},In={box:null,offscreen:null,occluded:null},_i=null,Ht=null,Li=null,en=0,Vi=0,Nn=0;Ct.textFeatureIndex?en=Ct.textFeatureIndex:Qe.useRuntimeCollisionCircles&&(en=Qe.featureIndex),Ct.verticalTextFeatureIndex&&(Vi=Ct.verticalTextFeatureIndex);const Jn=zi=>{zi.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Cn=this.transform.elevation;zi.elevation=Je?pi:pi+(Cn?Cn.getAtTileOffset(zi.tileID,zi.tileAnchorX,zi.tileAnchorY):0),zi.elevation+=Qe.zOffset},fs=Ct.textBox;if(fs){Jn(fs);const zi=Zi=>{let hn=s.bq.horizontal;if(T.allowVerticalPlacement&&!Zi&&this.prevPlacement){const Os=this.prevPlacement.placedOrientations[Pt];Os&&(this.placedOrientations[Pt]=Os,hn=Os,this.markUsedOrientation(T,hn,Qe))}return hn},Cn=(Zi,hn)=>{if(T.allowVerticalPlacement&&Dt>0&&Ct.verticalTextBox){for(const Os of T.writingModes)if(Os===s.bq.vertical?(Si=hn(),In=Si):Si=Zi(),Si&&Si.box&&Si.box.length)break}else Si=Zi()};if(D.get("text-variable-anchor")){let Zi=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pt]){const Tn=this.prevPlacement.variableOffsets[Pt];Zi.indexOf(Tn.anchor)>0&&(Zi=Zi.filter(ps=>ps!==Tn.anchor),Zi.unshift(Tn.anchor))}const hn=(Tn,ps,Xo)=>{const Sr=T.getSymbolInstanceTextSize(ee,Qe,this.transform.zoom,ft),co=(Tn.x2-Tn.x1)*Sr+2*Tn.padding,gr=(Tn.y2-Tn.y1)*Sr+2*Tn.padding,uo=Qe.hasIconTextFit&&!xe?ps:null;uo&&Jn(uo);let Ar={box:[],offscreen:!1,occluded:!1};const Sa=ve?2*Zi.length:Zi.length;for(let Yo=0;Yo<Sa;++Yo){const Aa=this.attemptAnchorPlacement(Zi[Yo%Zi.length],Tn,co,gr,Sr,be,Ce,q,z,le,Yo>=Zi.length,Qe,ft,T,Xo,uo,ee,ie);if(Aa&&(Ar=Aa.placedGlyphBoxes,Ar&&Ar.box&&Ar.box.length)){ti=!0,mn=Aa.shift;break}}return Ar};Cn(()=>hn(fs,Ct.iconBox,s.bq.horizontal),()=>{const Tn=Ct.verticalTextBox;return Tn&&Jn(Tn),T.allowVerticalPlacement&&!(Si&&Si.box&&Si.box.length)&&Dt>0&&Tn?hn(Tn,Ct.verticalIconBox,s.bq.vertical):{box:null,offscreen:null,occluded:null}}),Si&&(ti=Si.box,oi=Si.offscreen,Di=Si.occluded);const Os=zi(!(!Si||!Si.box));if(!ti&&this.prevPlacement){const Tn=this.prevPlacement.variableOffsets[Pt];Tn&&(this.variableOffsets[Pt]=Tn,this.markUsedJustification(T,Tn.anchor,Qe,Os))}}else{const Zi=(hn,Os)=>{const Tn=T.getSymbolInstanceTextSize(ee,Qe,this.transform.zoom,ft,b),ps=this.collisionIndex.placeCollisionBox(T,Tn,hn,new s.P(0,0),ve,q,z,le.predicate);return ps&&ps.box&&ps.box.length&&(this.markUsedOrientation(T,Os,Qe),this.placedOrientations[Pt]=Os),ps};Cn(()=>Zi(fs,s.bq.horizontal),()=>{const hn=Ct.verticalTextBox;return T.allowVerticalPlacement&&Dt>0&&hn?(Jn(hn),Zi(hn,s.bq.vertical)):{box:null,offscreen:null,occluded:null}}),zi(!!(Si&&Si.box&&Si.box.length))}}if(_i=Si,ti=_i&&_i.box&&_i.box.length>0,oi=_i&&_i.offscreen,Di=_i&&_i.occluded,Qe.useRuntimeCollisionCircles){const zi=T.text.placedSymbolArray.get(Qe.centerJustifiedTextSymbolIndex>=0?Qe.centerJustifiedTextSymbolIndex:Qe.verticalPlacedTextSymbolIndex),Cn=s.br(T.textSizeData,ee,zi),Zi=D.get("text-padding");Ht=this.collisionIndex.placeCollisionCircles(T,ve,zi,T.lineVertexArray,T.glyphOffsetArray,Cn,z,F,V,p,Ce,le.predicate,Qe.collisionCircleDiameter*Cn/s.bw,Zi,this.retainedQueryData[T.bucketInstanceId].tileID),ti=ve||Ht.circles.length>0&&!Ht.collisionDetected,oi=oi&&Ht.offscreen,Di=Ht.occluded}if(Ct.iconFeatureIndex&&(Nn=Ct.iconFeatureIndex),Ct.iconBox){const zi=Cn=>{Jn(Cn);const Zi=Qe.hasIconTextFit&&mn?lr(mn.x,mn.y,be,Ce,this.transform.angle):new s.P(0,0),hn=T.getSymbolInstanceIconSize(ie,this.transform.zoom,Qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,hn,Cn,Zi,xe,q,z,le.predicate)};In&&In.box&&In.box.length&&Ct.verticalIconBox?(Li=zi(Ct.verticalIconBox),hi=Li.box.length>0):(Li=zi(Ct.iconBox),hi=Li.box.length>0),oi=oi&&Li.offscreen,Wi=Li.occluded}const xs=pe||Qe.numHorizontalGlyphVertices===0&&Dt===0,qr=we||Qe.numIconVertices===0;if(xs||qr?qr?xs||(hi=hi&&ti):ti=hi&&ti:hi=ti=hi&&ti,ti&&_i&&_i.box&&this.collisionIndex.insertCollisionBox(_i.box,D.get("text-ignore-placement"),T.bucketInstanceId,In&&In.box&&Vi?Vi:en,le.ID),hi&&Li&&this.collisionIndex.insertCollisionBox(Li.box,D.get("icon-ignore-placement"),T.bucketInstanceId,Nn,le.ID),Ht&&(ti&&this.collisionIndex.insertCollisionCircles(Ht.circles,D.get("text-ignore-placement"),T.bucketInstanceId,en,le.ID),p)){const zi=T.bucketInstanceId;let Cn=this.collisionCircleArrays[zi];Cn===void 0&&(Cn=this.collisionCircleArrays[zi]=new U1);for(let Zi=0;Zi<Ht.circles.length;Zi+=4)Cn.circles.push(Ht.circles[Zi+0]),Cn.circles.push(Ht.circles[Zi+1]),Cn.circles.push(Ht.circles[Zi+2]),Cn.circles.push(Ht.collisionDetected?1:0)}const Js=T.projection.name!=="globe";Ne=Ne&&(Js||!Di),ot=ot&&(Js||!Wi),this.placements[Pt]=new pa(ti||Ne,hi||ot,oi||T.justReloaded),a.add(Pt)};if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.elevationType==="road"&&T.updateRoadElevation(),T.updateZOffset(),T.sortFeaturesByY){const Qe=T.getSortedSymbolIndexes(this.transform.angle);for(let ft=Qe.length-1;ft>=0;--ft){const Ct=Qe[ft];ht(T.symbolInstances.get(Ct),Ct,T.collisionArrays[Ct])}T.hasAnyZOffset&&s.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Qe=T.getSortedIndexesByZOffset();for(let ft=0;ft<Qe.length;++ft){const Ct=Qe[ft];ht(T.symbolInstances.get(Ct),Ct,T.collisionArrays[Ct])}}else for(let Qe=n.symbolInstanceStart;Qe<n.symbolInstanceEnd;Qe++)ht(T.symbolInstances.get(Qe),Qe,T.collisionArrays[Qe]);if(p&&T.bucketInstanceId in this.collisionCircleArrays){const Qe=this.collisionCircleArrays[T.bucketInstanceId];s.ad.mat4.invert(Qe.invProjMatrix,z),Qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(n,a,p,v){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:L,crossTileID:z}=p,F=s.bB(a),V=v===s.bq.vertical?L:F==="left"?b:F==="center"?T:F==="right"?D:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=V>=0&&b!==V?0:z),T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=V>=0&&T!==V?0:z),D>=0&&(n.text.placedSymbolArray.get(D).crossTileID=V>=0&&D!==V?0:z),L>=0&&(n.text.placedSymbolArray.get(L).crossTileID=V>=0&&L!==V?0:z)}markUsedOrientation(n,a,p){const v=a===s.bq.horizontal||a===s.bq.horizontalOnly?a:0,b=a===s.bq.vertical?a:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:z}=p,F=n.text.placedSymbolArray;T>=0&&(F.get(T).placedOrientation=v),D>=0&&(F.get(D).placedOrientation=v),L>=0&&(F.get(L).placedOrientation=v),z>=0&&(F.get(z).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let p=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const v=a?a.symbolFadeChange(n):1,b=a?a.opacities:{},T=a?a.variableOffsets:{},D=a?a.placedOrientations:{};for(const L in this.placements){const z=this.placements[L],F=b[L];F?(this.opacities[L]=new Ga(F,v,z.text,z.icon,null,z.clipped),p=p||z.text!==F.text.placed||z.icon!==F.icon.placed):(this.opacities[L]=new Ga(null,v,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const L in b){const z=b[L];if(!this.opacities[L]){const F=new Ga(z,v,!1,!1);F.isHidden()||(this.opacities[L]=F,p=p||z.text.placed||z.icon.placed)}}for(const L in T)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=T[L]);for(const L in D)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=D[L]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a,p,v){const b=new Set;for(const T of a){const D=T.getBucket(n);D&&T.latestFeatureIndex&&n.fqid===D.layerIds[0]&&(this.updateBucketOpacities(D,b,T,T.collisionBoxArray,p,v,T.tileID,n.scope),D.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(D,T.tileID),D.elevationType==="road"&&D.updateRoadElevation(),D.updateZOffset())}}updateBucketOpacities(n,a,p,v,b,T,D,L){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const z=n.layers[0].layout,F=n.layers[0].paint,V=!!n.layers[0].dynamicFilter(),U=new Ga(null,0,!1,!1,!0),q=z.get("text-allow-overlap"),J=z.get("icon-allow-overlap"),X=z.get("text-variable-anchor"),ee=z.get("text-rotation-alignment")==="map",ie=z.get("text-pitch-alignment")==="map",le=F.get("symbol-z-offset"),_e=z.get("symbol-elevation-reference")==="sea",pe=!le.isConstant(),we=new Ga(null,0,q&&(J||!n.hasIconData()||z.get("icon-optional")),J&&(q||!n.hasTextData()||z.get("text-optional")),!0);!n.collisionArrays&&v&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(v);const ve=(be,Ce,Re)=>{for(let Je=0;Je<Ce/4;Je++)be.opacityVertexArray.emplaceBack(Re)};let xe=0;T&&n.updateReplacement(D,T);for(let be=0;be<n.symbolInstances.length;be++){const Ce=n.symbolInstances.get(be),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:Je,crossTileID:$e,numIconVertices:ct,tileAnchorX:ut,tileAnchorY:vt}=Ce;let je=null;const at=this.retainedQueryData[n.bucketInstanceId];pe&&Ce&&at&&(je=p.latestFeatureIndex.loadFeature({featureIndex:Ce.featureIndex,bucketIndex:at.bucketIndex,sourceLayerIndex:at.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ne=le.evaluate(je,{}),ot=a.has($e);let st=this.opacities[$e];ot?st=U:st||(st=we,this.opacities[$e]=st),a.add($e);const ht=Re>0||Je>0,Qe=ct>0,ft=this.placedOrientations[$e],Ct=ft===s.bq.vertical,Pt=ft===s.bq.horizontal||ft===s.bq.horizontalOnly;!ht&&!Qe||st.isHidden()||xe++;let Dt=!1;if((ht||Qe)&&T)for(const $t of n.activeReplacements){if(s.bx($t,b,s.by.Symbol,L)||$t.min.x>ut||ut>$t.max.x||$t.min.y>vt||vt>$t.max.y)continue;const pi=s.bz(ut,vt,D.canonical,$t.footprintTileId.canonical);if(Dt=s.bA(pi,$t.footprint),Dt)break}if(ht){const $t=Dt?Tl:wl(st.text);ve(n.text,Re,Ct?Tl:$t),ve(n.text,Je,Pt?Tl:$t);const pi=st.text.isHidden(),{leftJustifiedTextSymbolIndex:ti,centerJustifiedTextSymbolIndex:hi,rightJustifiedTextSymbolIndex:oi,verticalPlacedTextSymbolIndex:Di}=Ce,Wi=n.text.placedSymbolArray,mn=pi||Ct?1:0;ti>=0&&(Wi.get(ti).hidden=mn),hi>=0&&(Wi.get(hi).hidden=mn),oi>=0&&(Wi.get(oi).hidden=mn),Di>=0&&(Wi.get(Di).hidden=pi||Pt?1:0);const Si=this.variableOffsets[$e];Si&&this.markUsedJustification(n,Si.anchor,Ce,ft);const In=this.placedOrientations[$e];In&&(this.markUsedJustification(n,"left",Ce,In),this.markUsedOrientation(n,In,Ce))}if(Qe){const $t=Dt?Tl:wl(st.icon),{placedIconSymbolIndex:pi,verticalPlacedIconSymbolIndex:ti}=Ce,hi=n.icon.placedSymbolArray,oi=st.icon.isHidden()?1:0;pi>=0&&(ve(n.icon,ct,Ct?Tl:$t),hi.get(pi).hidden=oi),ti>=0&&(ve(n.icon,Ce.numVerticalIconVertices,Pt?Tl:$t),hi.get(ti).hidden=oi)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const $t=n.collisionArrays[be];if($t){let pi=new s.P(0,0),ti=!0;if($t.textBox||$t.verticalTextBox){if(X){const oi=this.variableOffsets[$e];oi?(pi=Cd(oi.anchor,oi.width,oi.height,oi.textOffset,oi.textScale),ee&&pi._rotate(ie?this.transform.angle:-this.transform.angle)):ti=!1}V&&(ti=!st.clipped),$t.textBox&&bl(n.textCollisionBox.collisionVertexArray,st.text.placed,!ti||Ct,Ne,_e,pi.x,pi.y),$t.verticalTextBox&&bl(n.textCollisionBox.collisionVertexArray,st.text.placed,!ti||Pt,Ne,_e,pi.x,pi.y)}const hi=ti&&!!(!Pt&&$t.verticalIconBox);$t.iconBox&&bl(n.iconCollisionBox.collisionVertexArray,st.icon.placed,hi,Ne,_e,Ce.hasIconTextFit?pi.x:0,Ce.hasIconTextFit?pi.y:0),$t.verticalIconBox&&bl(n.iconCollisionBox.collisionVertexArray,st.icon.placed,!hi,Ne,_e,Ce.hasIconTextFit?pi.x:0,Ce.hasIconTextFit?pi.y:0)}}}if(n.fullyClipped=xe===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=be.invProjMatrix,n.placementViewportMatrix=be.viewportMatrix,n.collisionCircleArray=be.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const p=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function bl(m,n,a,p,v,b,T){m.emplaceBack(n?1:0,a?1:0,b||0,T||0,p,v?1:0),m.emplaceBack(n?1:0,a?1:0,b||0,T||0,p,v?1:0),m.emplaceBack(n?1:0,a?1:0,b||0,T||0,p,v?1:0),m.emplaceBack(n?1:0,a?1:0,b||0,T||0,p,v?1:0)}const fy=Math.pow(2,25),Ju=Math.pow(2,24),H1=Math.pow(2,17),G1=Math.pow(2,16),Qu=Math.pow(2,9),eh=Math.pow(2,8),q1=Math.pow(2,1);function wl(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const n=m.placed?1:0,a=Math.floor(127*m.opacity);return a*fy+n*Ju+a*H1+n*G1+a*Qu+n*eh+a*q1+n}const Tl=0;class Pd{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,p,v,b,T){const D=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(D,v,n[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((L,z)=>L.sortKey-z.sortKey));this._currentPartIndex<D.length;){const L=D[this._currentPartIndex];if(a.placeLayerBucketPart(L,this._seenCrossTileIDs,p,L.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class qa{constructor(n,a,p,v,b,T,D,L,z){this.placement=new $1(n,b,T,D,L,z),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(n,a,p,v,b){const T=s.q.now(),D=()=>{const L=s.q.now()-T;return!this._forceFullPlacement&&L>2};for(;this._currentPlacementIndex>=0;){const L=a[n[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(L.type==="symbol"&&(!L.minzoom||L.minzoom<=z)&&(!L.maxzoom||L.maxzoom>z)){const F=L,V=F.layout.get("symbol-z-elevate"),U=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=F.layout.get("symbol-z-order"),J=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&U),X=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),ee=J&&X,ie=this._inProgressLayer=this._inProgressLayer||new Pd(F),le=s.C(L.source,L.scope);if(ie.continuePlacement(V||ee?v[le]:p[le],this.placement,this._showCollisionBoxes,L,D,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const jp=512/s.ai/2;class W1{constructor(n,a,p){this.tileID=n,this.bucketInstanceId=p,this.index=new s.bE(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=n.canonical.x*s.ai,b=n.canonical.y*s.ai;for(let T=0;T<a.length;T++){const{key:D,crossTileID:L,tileAnchorX:z,tileAnchorY:F}=a.get(T),V=Math.floor((v+z)*jp),U=Math.floor((b+F)*jp);this.index.add(V,U),this.keys.push(D),this.crossTileIDs.push(L)}this.index.finish()}findMatches(n,a,p){const v=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),b=jp/Math.pow(2,a.canonical.z-this.tileID.canonical.z),T=a.canonical.x*s.ai,D=a.canonical.y*s.ai;for(let L=0;L<n.length;L++){const z=n.get(L);if(z.crossTileID)continue;const{key:F,tileAnchorX:V,tileAnchorY:U}=z,q=Math.floor((T+V)*b),J=Math.floor((D+U)*b),X=this.index.range(q-v,J-v,q+v,J+v);for(const ee of X){const ie=this.crossTileIDs[ee];if(this.keys[ee]===F&&!p.has(ie)){p.add(ie),z.crossTileID=ie;break}}}}}class Z1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class py{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const p in this.indexes){const v=this.indexes[p],b={};for(const T in v){const D=v[T];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+a),b[D.tileID.key]=D}this.indexes[p]=b}this.lng=n}addBucket(n,a,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const v=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>n.overscaledZ)for(const D in T){const L=T[D];L.tileID.isChildOf(n)&&L.findMatches(a.symbolInstances,n,v)}else{const D=T[n.scaledTo(Number(b)).key];D&&D.findMatches(a.symbolInstances,n,v)}}for(let b=0;b<a.symbolInstances.length;b++){const T=a.symbolInstances.get(b);T.crossTileID||(T.crossTileID=p.generate(),v.add(T.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new W1(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const p of a.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let a=!1;for(const p in this.indexes){const v=this.indexes[p];for(const b in v)n[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,v[b]),delete v[b],a=!0)}return a}}class X1{constructor(){this.layerIndexes={},this.crossTileIDs=new Z1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,p,v){let b=this.layerIndexes[n.fqid];b===void 0&&(b=this.layerIndexes[n.fqid]=new py);let T=!1;const D={};v.name!=="globe"&&b.handleWrapJump(p);for(const L of a){const z=L.getBucket(n);z&&n.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(L.tileID,z,this.crossTileIDs)&&(T=!0),D[z.bucketInstanceId]=!0)}return b.removeStaleBuckets(D)&&(T=!0),T}pruneUnusedLayers(n){const a={};n.forEach(p=>{a[p]=!0});for(const p in this.layerIndexes)a[p]||delete this.layerIndexes[p]}}const Wa=771;class Mi{constructor(n,a,p,v){this.blendFunction=n,this.blendColor=a,this.mask=p,this.blendEquation=v}}Mi.Replace=[1,0,1,0],Mi.disabled=new Mi(Mi.Replace,s.al.transparent,[!1,!1,!1,!1]),Mi.unblended=new Mi(Mi.Replace,s.al.transparent,[!0,!0,!0,!0]),Mi.alphaBlended=new Mi([1,Wa,1,Wa],s.al.transparent,[!0,!0,!0,!0]),Mi.alphaBlendedNonPremultiplied=new Mi([770,Wa,770,Wa],s.al.transparent,[!0,!0,!0,!0]),Mi.multiply=new Mi([774,0,774,0],s.al.transparent,[!0,!0,!0,!0]);class Jt{constructor(n,a,p){this.func=n,this.mask=a,this.range=p}}Jt.ReadOnly=!1,Jt.ReadWrite=!0,Jt.disabled=new Jt(519,Jt.ReadOnly,[0,1]);const Dd=7680;class gi{constructor(n,a,p,v,b,T){this.test=n,this.ref=a,this.mask=p,this.fail=v,this.depthFail=b,this.pass=T}}gi.disabled=new gi({func:519,mask:0},0,0,Dd,Dd,Dd);const ga=1029,xc=2305;class fi{constructor(n,a,p){this.enable=n,this.mode=a,this.frontFace=p}}function $p(m,n){const a=s.bG(m,3);s.ad.mat4.fromQuat(m,n),s.bI(m,3,a)}function El(m,n){const a=s.ad.quat.identity([]);return s.ad.quat.rotateZ(a,a,-n),s.ad.quat.rotateX(a,a,-m),a}function bc(m,n){const a=[m[0],m[1],0],p=[n[0],n[1],0];if(s.ad.vec3.length(a)>=1e-15){const T=s.ad.vec3.normalize([],a);s.ad.vec3.scale(p,T,s.ad.vec3.dot(p,T)),n[0]=p[0],n[1]=p[1]}const v=s.ad.vec3.cross([],n,m);if(s.ad.vec3.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return El(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),b)}fi.disabled=new fi(!1,ga,xc),fi.backCCW=new fi(!0,ga,xc),fi.backCW=new fi(!0,ga,2304),fi.frontCW=new fi(!0,1028,2304),fi.frontCCW=new fi(!0,1028,xc);class Hp{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof s.ac?n:new s.ac(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=s.bF(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const p=this.position,v=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(n)):0,b=s.ac.fromLngLat(n,v),T=[b.x-p.x,b.y-p.y,b.z-p.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=bc(T,a)}setPitchBearing(n,a){this.orientation=El(s.ak(n),s.ak(-a))}}class wc{constructor(n,a){this._transform=s.ad.mat4.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new s.ac(n[0],n[1],n[2])}get position(){const n=s.bG(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&s.bI(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.ad.quat.identity([]),n&&$p(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=El(n,a),$p(this._transform,this._orientation)}forward(){const n=s.bG(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.bG(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.bG(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const p=new Float64Array(16);return s.ad.mat4.invert(p,this.getWorldToCamera(n,a)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,a,p){const v=this.position;s.ad.vec3.scale(v,v,-n);const b=new Float64Array(16);return s.ad.mat4.fromScaling(b,[p,p,p]),s.ad.mat4.translate(b,b,v),b[10]*=a,b}getWorldToCamera(n,a){const p=new Float64Array(16),v=new Float64Array(4),b=this.position;return s.ad.quat.conjugate(v,this._orientation),s.ad.vec3.scale(b,b,-n),s.ad.mat4.fromQuat(p,v),s.ad.mat4.translate(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=a,p[9]*=a,p[10]*=a,p[11]*=a,p}getCameraToClipPerspective(n,a,p,v){const b=new Float64Array(16);return s.ad.mat4.perspective(b,n,a,p,v),b}getCameraToClipOrthographic(n,a,p,v,b,T){const D=new Float64Array(16);return s.ad.mat4.ortho(D,n,a,p,v,b,T),D}getDistanceToElevation(n,a=!1){const p=n===0?0:s.bH(n,a?s.aT(this.position[1]):this.position[1]),v=this.forward();return(p-this.position[2])/v[2]}clone(){return new wc([...this.position],[...this.orientation])}}const Un={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class th{constructor(n=0,a=0,p=0,v=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(p)||p<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=p,this.right=v}interpolate(n,a,p){return a.top!=null&&n.top!=null&&(this.top=s.ah(n.top,a.top,p)),a.bottom!=null&&n.bottom!=null&&(this.bottom=s.ah(n.bottom,a.bottom,p)),a.left!=null&&n.left!=null&&(this.left=s.ah(n.left,a.left,p)),a.right!=null&&n.right!=null&&(this.right=s.ah(n.right,a.right,p)),this}getCenter(n,a){const p=s.ay((this.left+n-this.right)/2,0,n),v=s.ay((this.top+a-this.bottom)/2,0,a);return new s.P(p,v)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new th(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const St=15;class Rd{constructor(n,a,p,v,b,T,D){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=p??0,this._maxPitch=v??60,this.setProjection(T),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new s.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new th,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new wc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new Rd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<St}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,a=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return s.aA(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.bP(this.projectionOptions);const p=this.getProjection(),v=!s.bn(a,p);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bP({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bF(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=s.ad.mat2.create(),s.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=s.ay(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.ak(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let v=0,b=0;for(let T=0;T<a.length;T++){const D=new s.P(a[T][0]*this.width,p+a[T][1]*(this.height-p)),L=n.pointCoordinate(D);if(!L)continue;const z=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);v+=L[3]*z,b+=z}return b===0?NaN:v/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*a,v=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-p,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const v=s.ad.vec3.length(s.ad.vec3.sub([],this._camera.position,p));return s.ay(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!s.ad.quat.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];s.ad.vec3.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Hp;return a.position=new s.ac(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!s.ad.quat.length(n))return!1;s.ad.quat.normalize(n,n);const a=s.ad.vec3.transformQuat([],[0,0,-1],n),p=s.ad.vec3.transformQuat([],[0,-1,0],n);if(p[2]<0)return!1;const v=bc(a,p);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;n[2]=s.ay(n[2],v/p,v/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,p){this._unmodified=!1,this._edgeInsets.interpolate(n,a,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new s.bQ(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),v=this.pointCoordinate(new s.P(this.width,0)),b=this.pointCoordinate(new s.P(this.width,this.height)),T=this.pointCoordinate(new s.P(0,this.height)),D=Math.floor(Math.min(p.x,v.x,b.x,T.x)),L=Math.floor(Math.max(p.x,v.x,b.x,T.x)),z=1;for(let F=D-z;F<=L+z;F++)F!==0&&a.push(new s.bQ(F,n))}return a}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,a,p){let v=[];const b=p!==void 0,T=!b;if(T&&this.zoom<a||b&&p[0]===0&&p[1]===0)return v;const D=new Set,L=(F,V,U,q,J)=>{const X=s.c5(V,F,U,q,J);D.has(X)||(v.push(new s.aH(F,V,U,q,J)),D.add(X))};for(let F=0;F<n.length;F++){const V=n[F];if(T&&V.canonical.z!==a)continue;const U=V.canonical,q=V.overscaledZ,J=V.wrap,X=1<<U.z,ee=U.x+1<X,ie=U.x>0,le=U.y+1<X,_e=U.y>0,pe=V.wrap-(ie?0:1),we=V.wrap+(ee?0:1),ve=ie?U.x-1:X-1,xe=ee?U.x+1:0;if(b)p[0]<0?(L(q,we,U.z,xe,U.y),p[1]<0&&le&&(L(q,J,U.z,U.x,U.y+1),L(q,we,U.z,xe,U.y+1)),p[1]>0&&_e&&(L(q,J,U.z,U.x,U.y-1),L(q,we,U.z,xe,U.y-1))):p[0]>0?(L(q,pe,U.z,ve,U.y),p[1]<0&&le&&(L(q,J,U.z,U.x,U.y+1),L(q,pe,U.z,ve,U.y+1)),p[1]>0&&_e&&(L(q,J,U.z,U.x,U.y-1),L(q,pe,U.z,ve,U.y-1))):p[1]<0&&le?L(q,J,U.z,U.x,U.y+1):_e&&L(q,J,U.z,U.x,U.y-1);else{const be=V.visibleQuadrants;1&be&&(L(q,pe,U.z,ve,U.y),_e&&(L(q,J,U.z,U.x,U.y-1),L(q,pe,U.z,ve,U.y-1))),2&be&&(L(q,we,U.z,xe,U.y),_e&&(L(q,J,U.z,U.x,U.y-1),L(q,we,U.z,xe,U.y-1))),4&be&&(L(q,pe,U.z,ve,U.y),le&&(L(q,J,U.z,U.x,U.y+1),L(q,pe,U.z,ve,U.y+1))),8&be&&(L(q,we,U.z,xe,U.y),le&&(L(q,J,U.z,U.x,U.y+1),L(q,we,U.z,xe,U.y+1)))}}const z=[];for(const F of v)v.some(V=>F.isChildOf(V))||z.push(F);if(v=z.filter(F=>!n.some(V=>!!(F.overscaledZ<a&&V.isChildOf(F))||F.equals(V)||F.isChildOf(V))),T){const F=1<<a,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[F*V.x,F*V.y],q=4,J=q*q;v=v.filter(X=>{const ee=X.canonical.x+.5-U[0],ie=X.canonical.y+.5-U[1];return ee*ee+ie*ie<J})}return v}coveringTiles(n){let a=this.coveringZoomLevel(n);const p=a,v=this.elevation&&this.elevation.exaggeration(),b=v&&!n.isTerrainDEM,T=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const D=this.locationCoordinate(this.center),L=this.center.lat,z=1<<a,F=[z*D.x,z*D.y,0],V=this.projection.name==="globe",U=!V,q=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,U),J=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=z*s.bH(1,this.center.lat),ee=this._camera.position[2]/s.bH(1,this.center.lat),ie=[z*J.x,z*J.y,ee*(U?1:X)],le=V||v,_e=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),pe=this.isLODDisabled(!0)?a:0;let we;if(this._elevation&&n.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Ne=this._elevation.getMinMaxForVisibleTiles();we=Ne?Ne.max:this._centerAltitude}else we=this._centerAltitude;const ve=n.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,xe=this.projection.isReprojectedInTileSpace?s.bS(this):1,be=Ne=>{const st=new s.ac(Ne.x+25e-6,Ne.y,Ne.z),ht=new s.ac(Ne.x,Ne.y+25e-6,Ne.z),Qe=Ne.toLngLat(),ft=st.toLngLat(),Ct=ht.toLngLat(),Pt=this.locationCoordinate(Qe),Dt=this.locationCoordinate(ft),$t=this.locationCoordinate(Ct),pi=Math.hypot(Dt.x-Pt.x,Dt.y-Pt.y),ti=Math.hypot($t.x-Pt.x,$t.y-Pt.y);return Math.sqrt(pi*ti)*xe/25e-6},Ce=Ne=>{const ot=we,st=ve;return{aabb:s.bV(this,z,0,0,0,Ne,st,ot,this.projection),zoom:0,x:0,y:0,minZ:st,maxZ:ot,wrap:Ne,fullyVisible:!1}},Re=[];let Je=[];const $e=a,ct=n.reparseOverscaled?p:a,ut=(ee-this._centerAltitude)*X,vt=Ne=>{if(!this._elevation||!Ne.tileID||!T)return;const ot=this._elevation.getMinMaxForTile(Ne.tileID),st=Ne.aabb;ot?(st.min[2]=ot.min,st.max[2]=ot.max,st.center[2]=(st.min[2]+st.max[2])/2):(Ne.shouldSplit=at(Ne),Ne.shouldSplit||(st.min[2]=st.max[2]=st.center[2]=this._centerAltitude))},je=(Ne,ot)=>{if(.707*ot<Ne)return 1;const st=ot/Ne;return st/(1.4144271570014144+(Math.pow(1.1,st-1.4144271570014144+1)-1)/(1.1-1)-1)},at=Ne=>{if(Ne.zoom<pe)return!0;if(Ne.zoom===$e)return!1;if(Ne.shouldSplit!=null)return Ne.shouldSplit;const ot=Ne.aabb.distanceX(ie),st=Ne.aabb.distanceY(ie);let ht=ut,Qe=1;if(V){ht=Ne.aabb.distanceZ(ie);const ti=Math.pow(2,Ne.zoom),hi=s.aT((Ne.y+1)/ti),oi=s.aT(Ne.y/ti),Di=Math.min(Math.max(L,hi),oi),Wi=s.ca(Di)/s.ca(L);if(Qe=Di===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Wi/this._mercatorScaleRatio),this.zoom<=s.c6&&Ne.zoom===$e-1&&Wi>=.9)return!0}else if(b&&(ht=Ne.aabb.distanceZ(ie)*X),this.projection.isReprojectedInTileSpace&&p<=5){const ti=Math.pow(2,Ne.zoom),hi=be(new s.ac((Ne.x+.5)/ti,(Ne.y+.5)/ti));Qe=hi>.85?1:hi}if(!T){const ti=Math.sqrt(ot*ot+st*st+ht*ht);let hi=(1<<$e-Ne.zoom)*_e*Qe;return hi*=je(Math.max(ht,ut),ti),ti<hi}let ft=Number.MAX_VALUE,Ct=0;const Pt=Ne.aabb.getCorners(),Dt=[];for(const ti of Pt){s.ad.vec3.sub(Dt,ti,ie),V||(b?Dt[2]*=X:Dt[2]=ut);const hi=s.ad.vec3.dot(Dt,this._camera.forward());hi<ft&&(ft=hi,Ct=Math.abs(Dt[2]))}let $t=(1<<$e-Ne.zoom)*_e*Qe;if($t*=je(Math.max(Ct,ut),ft),ft<$t)return!0;const pi=Ne.aabb.closestPoint(F);return pi[0]===F[0]&&pi[1]===F[1]};if(this.renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)Re.push(Ce(-Ne)),Re.push(Ce(Ne));for(Re.push(Ce(0));Re.length>0;){const Ne=Re.pop(),ot=Ne.x,st=Ne.y;let ht=Ne.fullyVisible;const Qe=()=>this.projection.name==="globe"&&(Ne.y===0||Ne.y===(1<<Ne.zoom)-1);if(!ht){let ft=le?Ne.aabb.intersects(q):Ne.aabb.intersectsFlat(q);if(ft===0&&Qe()){const Ct=new s.bT(Ne.zoom,ot,st);ft=s.bU(this,z,Ct,!0).intersects(q)}if(ft===0)continue;ht=ft===2}if(Ne.zoom!==$e&&at(Ne))for(let ft=0;ft<4;ft++){const Ct=(ot<<1)+ft%2,Pt=(st<<1)+(ft>>1),Dt={aabb:T?Ne.aabb.quadrant(ft):s.bV(this,z,Ne.zoom+1,Ct,Pt,Ne.wrap,Ne.minZ,Ne.maxZ,this.projection),zoom:Ne.zoom+1,x:Ct,y:Pt,wrap:Ne.wrap,fullyVisible:ht,tileID:void 0,shouldSplit:void 0,minZ:Ne.minZ,maxZ:Ne.maxZ};b&&!V&&(Dt.tileID=new s.aH(Ne.zoom+1===$e?ct:Ne.zoom+1,Ne.wrap,Ne.zoom+1,Ct,Pt),vt(Dt)),Re.push(Dt)}else{const ft=Ne.zoom===$e?ct:Ne.zoom;if(n.minzoom&&n.minzoom>ft)continue;let Ct=0;if(!ht){let pi=le?Ne.aabb.intersectsPrecise(q):Ne.aabb.intersectsPreciseFlat(q);if(pi===0&&Qe()){const ti=new s.bT(Ne.zoom,ot,st);pi=s.bU(this,z,ti,!0).intersectsPrecise(q)}if(pi===0)continue;if(n.calculateQuadrantVisibility)if(q.containsPoint(Ne.aabb.center))Ct=15;else for(let ti=0;ti<4;ti++)Ne.aabb.quadrant(ti).intersects(q)!==0&&(Ct|=1<<ti)}const Pt=F[0]-(.5+ot+(Ne.wrap<<Ne.zoom))*(1<<a-Ne.zoom),Dt=F[1]-.5-st,$t=Ne.tileID?Ne.tileID:new s.aH(ft,Ne.wrap,Ne.zoom,ot,st);n.calculateQuadrantVisibility&&($t.visibleQuadrants=Ct),Je.push({tileID:$t,distanceSq:Pt*Pt+Dt*Dt})}}if(this.fogCullDistSq){const Ne=this.fogCullDistSq,ot=this.horizonLineFromTop();Je=Je.filter(st=>{const ht=[0,0,0,1],Qe=[s.ai,s.ai,0,1],ft=this.calculateFogTileMatrix(st.tileID.toUnwrapped());s.ad.vec4.transformMat4(ht,ht,ft),s.ad.vec4.transformMat4(Qe,Qe,ft);const Ct=s.ad.vec4.min([],ht,Qe),Pt=s.ad.vec4.max([],ht,Qe),Dt=s.bW(Ct,Pt);if(Dt===0)return!0;let $t=!1;const pi=this._elevation;if(pi&&Dt>Ne&&ot!==0){const ti=this.calculateProjMatrix(st.tileID.toUnwrapped());let hi;n.isTerrainDEM||(hi=pi.getMinMaxForTile(st.tileID)),hi||(hi={min:ve,max:we});const oi=s.c7(this.rotation),Di=[oi[0]*s.ai,oi[1]*s.ai,hi.max];s.ad.vec3.transformMat4(Di,Di,ti),$t=(1-Di[1])*this.height*.5<ot}return Dt<Ne||$t})}return Je.sort((Ne,ot)=>Ne.distanceSq-ot.distanceSq).map(Ne=>Ne.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=s.ay(n.lat,-s.bX,s.bX),p=this.projection.project(n.lng,a);return new s.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let p,v;const b=this.centerPoint;if(this.projection.name==="globe"){const D=this.worldSize;p=(a.x-b.x)/D,v=(a.y-b.y)/D}else{const D=this.pointCoordinate(a),L=this.pointCoordinate(b);p=D.x-L.x,v=D.y-L.y}const T=this.locationCoordinate(n);this.setLocation(new s.ac(T.x-p,T.y-v))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,a){return this.projection.locationPoint(this,n,a)}locationPoint3D(n,a){return this.projection.locationPoint(this,n,a,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,a){return this.coordinateLocation(this.pointCoordinate3D(n,a))}locationCoordinate(n,a){const p=a?s.bH(a,n.lat):void 0,v=this.projection.project(n.lng,n.lat);return new s.ac(v.x,v.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const p=a??this._centerAltitude,v=[n.x,n.y,0,1],b=[n.x,n.y,1,1];s.ad.vec4.transformMat4(v,v,this.pixelMatrixInverse),s.ad.vec4.transformMat4(b,b,this.pixelMatrixInverse);const T=b[3];s.ad.vec4.scale(v,v,1/v[3]),s.ad.vec4.scale(b,b,1/T);const D=v[2],L=b[2];return{p0:v,p1:b,t:D===L?0:(p-D)/(L-D)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return s.ad.vec4.transformMat4(a,a,this.pixelMatrixInverse),s.ad.vec4.transformMat4(p,p,this.pixelMatrixInverse),s.ad.vec4.scale(a,a,1/a[3]),s.ad.vec4.scale(p,p,1/p[3]),a[2]=s.bH(a[2],this._center.lat)*this.worldSize,p[2]=s.bH(p[2],this._center.lat)*this.worldSize,s.ad.vec4.scale(a,a,1/this.worldSize),s.ad.vec4.scale(p,p,1/this.worldSize),new s.as([a[0],a[1],a[2]],s.ad.vec3.normalize([],s.ad.vec3.sub([],p,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:p,t:v}=n,b=s.bH(a[2],this._center.lat),T=s.bH(p[2],this._center.lat);return new s.ac(s.ah(a[0],p[0],v)/this.worldSize,s.ah(a[1],p[1],v)/this.worldSize,s.ah(b,T,v))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n,a){if(!this.elevation)return this.pointCoordinate(n,a);let p=this.projection.pointCoordinate3D(this,n.x,n.y);if(p)return new s.ac(p[0],p[1],p[2]);let v=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n,a);const T=.02*b,D=n.clone();for(let L=0;L<10&&b-v>T;L++){D.y=s.ah(v,b,.66);const z=this.projection.pointCoordinate3D(this,D.x,D.y);z?(b=D.y,p=z):v=D.y}return p?new s.ac(p[0],p[1],p[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.bY)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const p=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,v=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return s.ad.vec4.transformMat4(v,v,this.pixelMatrix),v[3]>0?new s.P(v[0]/v[3],v[1]/v[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.P(a,n)),T=this.pointLocation3D(new s.P(v,n)),D=this.pointLocation3D(new s.P(v,p)),L=this.pointLocation3D(new s.P(a,p));let z=Math.min(b.lng,T.lng,D.lng,L.lng),F=Math.max(b.lng,T.lng,D.lng,L.lng),V=Math.min(b.lat,T.lat,D.lat,L.lat),U=Math.max(b.lat,T.lat,D.lat,L.lat);const q=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,X=(ee,ie,le,_e,pe)=>{const we=(ee+le)/2,ve=(ie+_e)/2,xe=new s.P(we,ve),{lng:be,lat:Ce}=this.pointLocation3D(xe),Re=Math.max(0,z-be,V-Ce,be-F,Ce-U);z=Math.min(z,be),F=Math.max(F,be),V=Math.min(V,Ce),U=Math.max(U,Ce),(pe<J||Re>q)&&(X(ee,ie,we,ve,pe+1),X(we,ve,le,_e,pe+1))};if(X(a,n,v,n,1),X(v,n,v,p,1),X(v,p,a,p,1),X(a,p,a,n,1),this.projection.name==="globe"){const[ee,ie]=s.bZ(this);ee?(U=90,F=180,z=-180):ie&&(V=-90,F=180,z=-180)}return new s.aB(new s.bO(z,V),new s.bO(F,U))}_getBoundsRectangular(n,a){const{top:p,left:v}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,D=new s.P(v,p),L=new s.P(T,p),z=new s.P(T,b),F=new s.P(v,b);let V=this.pointCoordinate(D,n),U=this.pointCoordinate(L,n);const q=this.pointCoordinate(z,a),J=this.pointCoordinate(F,a),X=(ee,ie)=>(ie.y-ee.y)/(ie.x-ee.x);return V.y>1&&U.y>=0?V=new s.ac((1-J.y)/X(J,V)+J.x,1):V.y<0&&U.y<=1&&(V=new s.ac(-J.y/X(J,V)+J.x,0)),U.y>1&&V.y>=0?U=new s.ac((1-q.y)/X(q,U)+q.x,1):U.y<0&&V.y<=1&&(U=new s.ac(-q.y/X(q,U)+q.x,0)),new s.aB().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce((p,v)=>{if(v.dem){const b=v.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.bX,this.maxLat=s.bX,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.av(this.minLng)*this.tileSize,this.worldMaxX=s.av(this.maxLng)*this.tileSize,this.worldMinY=s.aC(this.maxLat)*this.tileSize,this.worldMaxY=s.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,p=this._distanceTileDataCache;if(p[a])return p[a];const v=n.canonical,b=1/this.height,T=this.cameraWorldSize,D=T/this.zoomScale(v.z),L=(v.x+Math.pow(2,v.z)*n.wrap)*D,z=v.y*D,F=this.point;F.x*=T/this.worldSize,F.y*=T/this.worldSize;const V=this.angle,U=Math.sin(-V),q=-Math.cos(-V);return p[a]={bearing:[U,q],center:[(F.x-L)*b,(F.y-z)*b],scale:D/s.ai*b},p[a]}calculateFogTileMatrix(n){const a=n.key,p=this._fogTileMatrixCache;if(p[a])return p[a];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.ad.mat4.multiply(v,this.worldToFogMatrix,v),p[a]=new Float32Array(v),p[a]}calculateProjMatrix(n,a=!1,p=!1){const v=n.key;let b;if(b=p?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,b[v])return b[v];const T=this.calculatePosMatrix(n,this.worldSize);let D;return D=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,s.ad.mat4.multiply(T,D,T),b[v]=new Float32Array(T),b[v]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[a])return p[a];const v=s.b_(n,this);return p[a]=v,p[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,a=s.ad.mat4.fromScaling([],[n,n,n]);return s.ad.mat4.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=s.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(a),v=this._camera.forward(),b=s.bH(1,this._center.lat);p[2]/=b,v[2]/=b,s.ad.vec3.normalize(v,v);const T=n.raycast(p,v,n.exaggeration());if(T){const D=s.ad.vec3.scaleAndAdd([],p,v,T),L=new s.ac(D[0],D[1],s.bH(D[2],s.aT(D[1]))),z=(L.z+s.ad.vec3.length([L.x-p[0],L.y-p[1],L.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,p=s.bH(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(p),b=a.getAtPointOrZero(new s.ac(...v)),T=this.pixelsPerMeter/this.worldSize*b,D=this._minimumHeightOverTerrain(),L=v[2]-T;if(L<=D)if(L<0||n){const z=this.locationCoordinate(this._center,this._centerAltitude),F=[v[0],v[1],z.z-v[2]],V=s.ad.vec3.length(F);F[2]-=(D-L)/this._pixelsPerMercatorPixel;const U=s.ad.vec3.length(F);if(U===0)return;s.ad.vec3.scale(F,F,V/U*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],z.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const U=this.center;return U.lat=s.ay(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(U.lng=s.ay(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const a=this._unmodified,{x:p,y:v}=this.point;let b=0,T=p,D=v;const L=this.width/2,z=this.height/2,F=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(v-z<F&&(D=F+z),v+z>V&&(D=V-z),V-F<this.height&&(b=Math.max(b,this.height/(V-F)),D=(V+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,J=this.worldSize/2-(U+q)/2;T=(p+J+this.worldSize)%this.worldSize-J,T-L<U&&(T=U+L),T+L>q&&(T=q-L),q-U<this.width&&(b=Math.max(b,this.width/(q-U)),T=(q+U)/2)}T===p&&D===v||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(T,D))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bH(1,this.center.lat)/s.bH(1,s.c8));const v=s.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,T=this._camera.getWorldToCamera(this.worldSize,b);let D;const L=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(L[8]=2*-n.x/this.width,L[9]=2*n.y/this.height,this.isOrthographic){let Ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Re=Ce*this.aspect,Je=-Re,$e=-Ce;Re-=n.x,Je-=n.x,Ce+=n.y,$e+=n.y,D=this._camera.getCameraToClipOrthographic(Je,Re,$e,Ce,this._nearZ,this._farZ),((ct,ut,vt,je)=>{for(let at=0;at<16;at++)ct[at]=s.ah(ut[at],vt[at],je)})(D,D,L,s.c9(this.pitch>=St?1:this.pitch/St))}else D=L;const z=s.ad.mat4.mul([],L,T);let F=s.ad.mat4.mul([],D,T);if(this.projection.isReprojectedInTileSpace){const Ce=this.locationCoordinate(this.center),Re=s.ad.mat4.identity([]);s.ad.mat4.translate(Re,Re,[Ce.x*this.worldSize,Ce.y*this.worldSize,0]),s.ad.mat4.multiply(Re,Re,s.c0(this)),s.ad.mat4.translate(Re,Re,[-Ce.x*this.worldSize,-Ce.y*this.worldSize,0]),s.ad.mat4.multiply(F,F,Re),s.ad.mat4.multiply(z,z,Re),this.inverseAdjustmentMatrix=s.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.ad.mat4.scale([],F,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=F,this.invProjMatrix=s.ad.mat4.invert(new Float64Array(16),this.projMatrix),a){const Ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ce[8]=2*-n.x/this.width,Ce[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.ad.mat4.mul([],Ce,T)}else this.expandedFarZProjMatrix=this.projMatrix;const V=s.ad.mat4.invert([],D);this.frustumCorners=s.c2.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const U=new Float32Array(16);s.ad.mat4.identity(U),s.ad.mat4.scale(U,U,[1,-1,1]),s.ad.mat4.rotateX(U,U,this._pitch),s.ad.mat4.rotateZ(U,U,this.angle);const q=s.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.ad.mat4.clone(q);const J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-n.x/this.width,q[9]=2*(n.y+J)/this.height,this.skyboxMatrix=s.ad.mat4.multiply(U,q,U);const X=this.point,ee=X.x,ie=X.y,le=this.width%2/2,_e=this.height%2/2,pe=Math.cos(this.angle),we=Math.sin(this.angle),ve=ee-Math.round(ee)+pe*le+we*_e,xe=ie-Math.round(ie)+pe*_e+we*le,be=new Float64Array(F);if(s.ad.mat4.translate(be,be,[ve>.5?ve-1:ve,xe>.5?xe-1:xe,0]),this.alignedProjMatrix=be,F=s.ad.mat4.create(),s.ad.mat4.scale(F,F,[this.width/2,-this.height/2,1]),s.ad.mat4.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=s.ad.mat4.create(),s.ad.mat4.scale(F,F,[1,-1,1]),s.ad.mat4.translate(F,F,[-1,-1,0]),s.ad.mat4.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=s.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},F=s.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.c3(this);const Ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad.vec3.transformMat4(Ce,Ce,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,p=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,a];s.ad.vec3.scale(b,b,v),s.ad.vec3.scale(p,p,-1),s.ad.vec3.multiply(p,p,b);const T=s.ad.mat4.create();s.ad.mat4.translate(T,T,p),s.ad.mat4.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,v)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-p[0]*b,v.y/this.worldSize-p[1]*b,n/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],v=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(b=Math.min((a-p)/v,1)),this._camera.position=s.ad.vec3.scaleAndAdd([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:p,bearing:v}=this._camera.getPitchBearing(),b=s.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.ak(this._maxPitch)),D=Math.max((n[2]-b)/Math.cos(p),T),L=this._zoomFromMercatorZ(D);s.ad.vec3.scaleAndAdd(n,n,a,D),this._pitch=s.ay(p,s.ak(this.minPitch),s.ak(this.maxPitch)),this.angle=s.bF(v,-Math.PI,Math.PI),this._setZoom(s.ay(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,p=s.bY,v=0,b=1/0;for(;p-a>1e-6&&p>a;){const T=a+.5*(p-a),D=this.tileSize*Math.pow(2,T),L=this.getCameraToCenterDistance(this.projection,T,D),z=this.scaleZoom(L/(n*this.tileSize)),F=Math.abs(T-z);F<b&&(b=F,v=T),T<z?a=T:p=T}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const p=Math.min(n.x,a.x),v=Math.max(n.x,a.x),b=Math.min(n.y,a.y),T=Math.max(n.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new s.P(p,b),new s.P(v,T),new s.P(p,T),new s.P(v,b)],L=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const F of D){const V=this.pointRayIntersection(F);if(V.t<0)return!0;const U=this.rayIntersectionCoordinate(V);if(U.x<L||U.y<0||U.x>z||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,a){const p=s.ad.vec3.length(s.ad.vec3.sub([],this._camera.position,n)),v=this._zoomFromMercatorZ(p)+a;return p-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([a,p,v],b){const T=[a,p,v,1];s.ad.vec4.transformMat4(T,T,b);const D=T[3]=Math.max(T[3],1e-6);return T[0]/=D,T[1]/=D,T[2]/=D,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,a=this.zoom,p=this.worldSize){const v=s.b$(n,a,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,p,v);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=s.ah(1,T,s.c9(this.pitch>=St?1:this.pitch/St))),T}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.ad.mat4.multiply(n,n,this.globeMatrix),n}getFrustum(n){return s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const _a=(m,n)=>{if(n>0&&m.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=m.transform,p=Math.max(Math.abs(a._zoom-(m.minCutoffZoom-1)),1),v=a.isLODDisabled(!1)?s.ae(60,45,a.pitch):s.ae(30,15,a.pitch),b=a._farZ-a._nearZ,T=n*a.height,D=((1-(L=v))*a.cameraToCenterDistance+L*(a._farZ+T))*p;var L;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(D-a._nearZ)/b,(D-T-a._nearZ)/b]}}},Us={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class my{constructor(n,a){this.aabb=n,this.lastCascade=a}}class Ld{add(n,a){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],a.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],a.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],a.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],a.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],a.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],a.max[2])):this.receivers[n.key]=new my(a,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,a,p){const v=s.ce.fromPoints(n.points);let b=0;for(const T in this.receivers){const D=this.receivers[T];if(!D||!v.intersectsAabb(D.aabb))continue;D.aabb.min=v.closestPoint(D.aabb.min),D.aabb.max=v.closestPoint(D.aabb.max);const L=D.aabb.getCorners();for(let z=0;z<p.length;z++){let F=!0;for(const V of L){const U=[V[0]*a,V[1]*a,V[2]];if(s.ad.vec3.transformMat4(U,U,p[z].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){F=!1;break}}if(D.lastCascade=z,b=Math.max(b,z),F)break}}return b+1}}class ya{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ld,this._depthMode=new Jt(n.context.gl.LEQUAL,Jt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(Us,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Us,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(Us,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,a){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const v=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||v<=0||(this._shadowLayerCount=p.style.order.reduce((J,X)=>{const ee=p.style._mergedLayers[X];return J+(ee.hasShadowPass()&&!ee.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=p.context,T=Us.shadowMapResolution,D=Us.shadowMapResolution;if(this._cascades.length===0||Us.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let J=0;J<Us.cascadeCount;++J){const X=p._shadowMapDebug,ee=b.gl,ie=b.createFramebuffer(T,D,X,"texture"),le=new s.T(b,{width:T,height:D,data:null},ee.DEPTH_COMPONENT16);if(ie.depthAttachment.set(le.texture),X){const _e=new s.T(b,{width:T,height:D,data:null},ee.RGBA8);ie.colorAttachment.set(_e.texture)}this._cascades.push({framebuffer:ie,texture:le,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bR,scale:0})}}this.shadowDirection=Za(a);let L=0;if(n.elevation){const J=n.elevation,X=[1e4,-1e4];J.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{const ie=ee.dem.tree;X[0]=Math.min(X[0],ie.minimums[0]),X[1]=Math.max(X[1],ie.maximums[0])}),X[0]!==1e4&&(L=(X[1]-X[0])*J.exaggeration())}const z=1.5*n.cameraToCenterDistance,F=3*z,V=new Float64Array(16);for(let J=0;J<this._cascades.length;++J){const X=this._cascades[J];let ee=n.height/50,ie=1;Us.cascadeCount===1?ie=F:J===0?ie=z:(ee=z,ie=F);const[le,_e]=Sc(n,this.shadowDirection,ee,ie,Us.shadowMapResolution,L);X.scale=n.scale,X.matrix=le,X.boundingSphereRadius=_e,s.ad.mat4.invert(V,X.matrix),X.frustum=s.bR.fromInvProjectionMatrix(V,1,0,!0),X.far=ie}const U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Us.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Us.shadowMapResolution,this._uniformValues.u_shadowmap_0=Un.ShadowMap0,this._uniformValues.u_shadowmap_1=Un.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=p.transform.elevation;for(const J of this._groundShadowTiles){let X={min:0,max:0};if(q){const ee=q.getMinMaxForTile(J);ee&&(X=ee)}this.addShadowReceiver(J.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,a){if(!this.enabled)return;const p=this.painter,v=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),v.viewport.set([0,0,Us.shadowMapResolution,Us.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,v.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),v.clear({color:s.al.white,depth:1});for(const T of n.order){const D=n._mergedLayers[T];if(!D.hasShadowPass()||D.isHidden(p.transform.zoom))continue;const L=n.getLayerSourceCache(D),z=L?a[L.id]:void 0;(D.type==="model"||z&&z.length)&&p.renderLayer(p,L,D,z)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,a=n.style,p=n.context,v=a.directionalLight,b=a.ambientLight;if(!v||!b)return;const T=[],D=_a(n,n.longestCutoffRange);D.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const L=Ec(a,v,b),z=new Jt(p.gl.LEQUAL,Jt.ReadOnly,n.depthRangeFor3D);for(const F of this._groundShadowTiles){const V=F.toUnwrapped(),U=n.isTileAffectedByFog(F),q=n.getOrCreateProgram("groundShadow",{defines:T,overrideFog:U});this.setupShadows(V,q),n.uploadCommonUniforms(p,q,V,null,D);const J={u_matrix:n.transform.calculateProjMatrix(V),u_ground_shadow_factor:L};q.draw(n,p.gl.TRIANGLES,z,gi.disabled,Mi.multiply,fi.disabled,J,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Mi.unblended:Mi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const a=this.painter.transform,p=a.calculatePosMatrix(n,a.worldSize);return s.ad.mat4.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){return s.ad.mat4.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,a,p,v=0){if(!this.enabled)return;const b=this.painter.transform,T=this.painter.context,D=T.gl,L=this._uniformValues,z=new Float64Array(16),F=b.calculatePosMatrix(n,b.worldSize);for(let V=0;V<this._cascades.length;V++)s.ad.mat4.multiply(z,this._cascades[V].matrix,F),L[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),T.activeTexture.set(D.TEXTURE0+Un.ShadowMap0+V),this._cascades[V].texture.bind(D.NEAREST,D.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){const V=s.cd(n.canonical),U=2/b.tileSize*s.ai/Us.shadowMapResolution,q=U*this._cascades[0].boundingSphereRadius,J=U*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(p==="vector-tile"?1:3)/Math.pow(2,v-n.canonical.z-(1-b.zoom+Math.floor(b.zoom)));L.u_shadow_normal_offset=[V,q*X,J*X],L.u_shadow_bias=[6e-5,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(T,L)}setupShadowsFromMatrix(n,a,p=!1){if(!this.enabled)return;const v=this.painter.context,b=v.gl,T=this._uniformValues,D=new Float64Array(16);for(let L=0;L<Us.cascadeCount;L++)s.ad.mat4.multiply(D,this._cascades[L].matrix,n),T[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),v.activeTexture.set(b.TEXTURE0+Un.ShadowMap0+L),this._cascades[L].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=p,p){const L=Us.normalOffset;T.u_shadow_normal_offset=[1,L,L],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(v,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,a,p,v){if(v[2]>=0)return{};const b=function(L,z,F){const V=F/(1<<L.canonical.z);return new s.ce([L.canonical.x*V+L.wrap*F,L.canonical.y*V+L.wrap*F,0],[(L.canonical.x+1)*V+L.wrap*F,(L.canonical.y+1)*V+L.wrap*F,z])}(n,a,p).getCorners(),T=a/-v[2];v[0]<0?(s.ad.vec3.add(b[0],b[0],[v[0]*T,0,0]),s.ad.vec3.add(b[3],b[3],[v[0]*T,0,0])):v[0]>0&&(s.ad.vec3.add(b[1],b[1],[v[0]*T,0,0]),s.ad.vec3.add(b[2],b[2],[v[0]*T,0,0])),v[1]<0?(s.ad.vec3.add(b[0],b[0],[0,v[1]*T,0]),s.ad.vec3.add(b[1],b[1],[0,v[1]*T,0])):v[1]>0&&(s.ad.vec3.add(b[2],b[2],[0,v[1]*T,0]),s.ad.vec3.add(b[3],b[3],[0,v[1]*T,0]));const D={};return D.vertices=b,D.planes=[Tc(b[1],b[0],b[4]),Tc(b[2],b[1],b[5]),Tc(b[3],b[2],b[6]),Tc(b[0],b[3],b[7])],D}addShadowReceiver(n,a,p){this._receivers.add(n,s.ce.fromTileIdAndHeight(n,a,p))}getMaxCascadeForTile(n){const a=this._receivers.get(n);return a&&a.lastCascade?a.lastCascade:0}}function Tc(m,n,a){const p=s.ad.vec3.sub([],a,n),v=s.ad.vec3.sub([],m,n),b=s.ad.vec3.cross([],p,v),T=s.ad.vec3.length(b);return T===0?[0,0,1,0]:(s.ad.vec3.scale(b,b,1/T),[b[0],b[1],b[2],-s.ad.vec3.dot(b,n)])}function Za(m){const n=m.properties.get("direction"),a=s.cc(n.x,n.y,n.z);a[2]=s.ay(a[2],0,75);const p=s.cf([a[0],a[1],a[2]]);return s.ad.vec3.fromValues(p.x,p.y,p.z)}function Ec(m,n,a){const p=n.properties.get("color-use-theme")==="none",v=n.properties.get("color"),b=n.properties.get("intensity"),T=n.properties.get("direction"),D=[T.x,T.y,T.z],L=a.properties.get("color-use-theme")==="none",z=a.properties.get("color"),F=a.properties.get("intensity"),V=Math.max(s.ad.vec3.dot([0,0,1],D),0),U=[0,0,0];s.ad.vec3.scale(U,z.toRenderColor(L?null:m.getLut(n.scope)).toArray01Linear().slice(0,3),F);const q=[0,0,0];return s.ad.vec3.scale(q,v.toRenderColor(p?null:m.getLut(a.scope)).toArray01Linear().slice(0,3),V*b),s.cg([U[0]>0?U[0]/(U[0]+q[0]):0,U[1]>0?U[1]/(U[1]+q[1]):0,U[2]>0?U[2]/(U[2]+q[2]):0])}function Sc(m,n,a,p,v,b){const T=m.zoom,D=m.scale,L=m.worldSize,z=1/L,F=m.aspect,V=Math.sqrt(1+F*F)*Math.tan(.5*m.fovX),U=V*V,q=p-a,J=p+a;let X,ee;U>q/J?(X=p,ee=p*V):(X=.5*J*(1+U),ee=.5*Math.sqrt(q*q+2*(p*p+a*a)*U+J*J*U*U));const ie=m.projection.pixelsPerMeter(m.center.lat,L),le=m._camera.getCameraToWorldMercator(),_e=[0,0,-X*z];s.ad.vec3.transformMat4(_e,_e,le);let pe=ee*z;const we=m._edgeInsets;if(!(we.left===0&&we.top===0&&we.right===0&&we.bottom===0||we.left===we.right&&we.top===we.bottom)){const ht=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ie:1),Qe=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,a,p);Qe[8]=2*-m.centerOffset.x/m.width,Qe[9]=2*m.centerOffset.y/m.height;const ft=new Float64Array(16);s.ad.mat4.mul(ft,Qe,ht);const Ct=new Float64Array(16);s.ad.mat4.invert(Ct,ft);const Pt=s.bR.fromInvProjectionMatrix(Ct,L,T,!0);for(const Dt of Pt.points){const $t=((ve=Dt)[0]/=D,ve[1]/=D,ve[2]=s.bH(ve[2],m._center.lat),ve);pe=Math.max(pe,s.ad.vec3.len(s.ad.vec3.subtract([],_e,$t)))}}var ve;pe*=v/(v-1);const xe=Math.acos(n[2]),be=Math.atan2(-n[0],-n[1]),Ce=new wc;Ce.position=_e,Ce.setPitchBearing(xe,be);const Re=Ce.getWorldToCamera(L,ie),Je=pe*L,$e=Math.min(m._mercatorZfromZoom(17)*L*-2,-2*Je),ct=Ce.getCameraToClipOrthographic(-Je,Je,-Je,Je,$e,(Je+b*ie)/n[2]),ut=new Float64Array(16);s.ad.mat4.multiply(ut,ct,Re);const vt=s.ad.vec3.fromValues(Math.floor(1e6*_e[0])/1e6*L,Math.floor(1e6*_e[1])/1e6*L,0),je=.5*v,at=[0,0,0];s.ad.vec3.transformMat4(at,vt,ut),s.ad.vec3.scale(at,at,je);const Ne=[Math.floor(at[0]),Math.floor(at[1]),Math.floor(at[2])],ot=[0,0,0];s.ad.vec3.sub(ot,at,Ne),s.ad.vec3.scale(ot,ot,-1/je);const st=new Float64Array(16);return s.ad.mat4.identity(st),s.ad.mat4.translate(st,st,ot),s.ad.mat4.multiply(ut,st,ut),[ut,Je]}class Y1 extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(n,a){return s.aN(this.requestManager.transformRequest(a,s.R.Model).url).then(p=>{if(!p)return;const v=s.aO(p),b=new s.aP(n,void 0,void 0,v);return b.computeBoundsAndApplyParent(),b}).catch(p=>{if(p&&p.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${n} from ${a}: ${p.message}`)))})}load(n,a,p={keepNumReferences:!1}){this.models[a]||(this.models[a]={});const v=Object.keys(n);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+v.length;const b=[];for(const T of v)b.push(this.loadModel(T,n[T]));Promise.allSettled(b).then(T=>{for(let D=0;D<T.length;D++){const{status:L,value:z}=T[D];if(L==="fulfilled"&&z){const F=this.models[a][v[D]];this.models[a][v[D]]={model:z,numReferences:p.keepNumReferences&&F?F.numReferences:1}}}this.numModelsLoading[a]-=v.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(T=>{this.fire(new s.z(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,a){return!!this.getModel(n,a)}getModel(n,a){return this.models[a]||(this.models[a]={}),this.models[a][n]?this.models[a][n].model:void 0}addModel(n,a,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={}),this.hasModel(n,p)&&this.models[p][n].numReferences++,this.modelUris[p][n]=this.requestManager.normalizeModelURL(a),this.load({[n]:this.modelUris[p][n]},p)}addModels(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const p=this.modelUris[a];for(const v in n)this.models[a][v]={},p[v]=this.requestManager.normalizeModelURL(n[v]);this.load(p,a,{keepNumReferences:!0})}reloadModels(n){this.load(this.modelUris[n],n)}addModelsFromBucket(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const p={};for(const v of n)this.hasModel(v,a)?this.models[a][v].numReferences++:(this.modelUris[a][v]=this.requestManager.normalizeModelURL(v),p[v]=this.modelUris[a][v]);this.load(p,a)}removeModel(n,a){if(this.models[a]&&this.models[a][n]&&(this.models[a][n].numReferences--,this.models[a][n].numReferences===0)){const p=this.models[a][n].model;delete this.models[a][n],delete this.modelUris[a][n],p.destroy()}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,a){this.models[a]||(this.models[a]={});for(const p in this.models[a])this.models[a][p].model&&this.models[a][p].model.upload(n.context)}}const K1=new s.a7({data:new s.a8(s.a5.colorTheme.data)}),Gp={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function gy(m){return m=m||{},Object.assign(m,Gp)}class _y extends s.E{constructor(n){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},s.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=n,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(n=>{n.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=n.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=n.stylesheet.indoor.buildingFeaturesetId,this._scope=n.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:n=>(n.feature&&n.feature.properties.floorplan&&this.selectFloorplan(n.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(n){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(T,D){const[L,z]=T,{center:F,radius:V}=D,[U,q]=F,J=Math.abs(L-U);return Math.sqrt((J>180?360-J:J)**2+(z-q)**2)<=V}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.A("floorplangone")));const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=new s.P(this._map.transform.width/2,this._map.transform.height/2),v=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],b=this._map.queryRenderedFeatures(n?v:p,a);b.length>0&&(this._selectedFloorplan&&b[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=b[0],this._floorplanSelected(!1)))}_floorplanSelected(n){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(b){const[[T,D],[L,z]]=b,F=(L-T+360)%360,V=F>180?360-F:F;return{center:[(T+V/2+360)%360,(D+z)/2],radius:Math.sqrt(V**2+(z-D)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const a=this._floorplanStates[this._indoorData.id].selectedBuilding,p=this._floorplanStates[this._indoorData.id].selectedLevel;let v;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const b of this._indoorData.levels)b.id===this._selectedLevel.id&&(v=b.id);if(this.fire(new s.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:v})),a){const b=this._indoorData.buildings.find(T=>T.id===a);this._buildingSelected(b,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(p){const b=this._indoorData.levels.find(T=>T.id===p);this._updateLevels(b,n)}else n&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(n,a){a&&n&&n.extent&&this._map.fitBounds(n.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=n?n.id:void 0;const p=this._indoorData.levels.filter(v=>n.levels.includes(v.id));this.fire(new s.A("buildingselected",{buildingId:n.id,levels:p}))}_levelSelected(n){if(n==="overview")this._updateLevels(void 0,!0);else{const a=this._indoorData.levels.find(p=>p.id===n);this._updateLevels(a,!0)}this.fire(new s.A("levelselected",{levelId:n==="overview"?void 0:n}))}_updateLevels(n,a){if(!n)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(a&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function p(z){const F=z.indexOf("/floor/");if(F===-1)return z;const V=F+7,U=z.indexOf("/",V);return U===-1?z.slice(V):z.slice(V,U)}this._selectedLevel=n,this._floorplanStates[this._indoorData.id].selectedLevel=n?n.id:void 0;const v=[],b={},T={},D={},L={};for(const z of this._indoorData.levels)if(v.push(z.id),b[z.id]=z.height,T[z.id]=z.base,n){if(this.mergeFloors){const F=p(n.id),V=p(z.id);D[z.id]=V===F?"true":"false"}else D[z.id]=z.id===n.id?"true":"false";L[z.id]=z.base<n.base?"true":"false"}else L[z.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",D]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",L]),n&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!n.isUnderground),a&&n.extent)){const z=this._map.cameraForBounds(n.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),F=this._map.getZoom(),V=z.zoom?Math.abs(F-z.zoom):0;this._map.fitBounds(n.extent,V>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:F})}}selectFloorplan(n){const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(p,a);if(v.length>0){for(const b of v)if(JSON.parse(b.properties["indoor-data"]).floorplanIDs.includes(n)){this._selectedFloorplan=b,this._floorplanSelected(!0);break}}}selectBuilding(n){const a=this._indoorData.buildings.find(p=>p.id===n);this._buildingSelected(a,!0)}selectLevel(n){this._levelSelected(n)}}function yy(m){if(!m.metadata||!m.metadata.content_area)return;const n=s.q.devicePixelRatio,{left:a,top:p,width:v,height:b}=m.metadata.content_area,T=a*n,D=p*n;return[T,D,T+v*n,D+b*n]}function Od(m){if(m)return m.map(([n,a])=>[n*s.q.devicePixelRatio,a*s.q.devicePixelRatio])}class J1{constructor(n,a){this.id=n,this.style=a}addIcons(n){const a=new Map;for(const[p,v]of n.entries()){const b=s.I.from({name:p,iconsetId:this.id});a.set(b,v)}this.style.addImages(a)}}const Sl=(m,n)=>Ye(m,n&&n.filter(a=>a.identifier!=="source.canvas")),Q1=s.aA($i,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),eb=s.aA($i,["setCenter","setZoom","setBearing","setPitch"]),kd=new Set(["background","sky","slot","custom"]),vy={version:8,layers:[],sources:{}},ih={duration:300,delay:0};class So extends s.E{constructor(n,a={}){super(),this.map=n,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=s.l({},ih),this._buildingIndex=new hy(this),this.crossTileSymbolIndex=new X1,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Ze,this.dispatcher=a.dispatcher?a.dispatcher:new s.D(s.cj(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new wt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new s.ck(n._requestManager,a.localFontFamily?s.cl.all:a.localIdeographFontFamily?s.cl.ideographs:s.cl.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Y1(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",s.cm());const p=this;this._rtlTextPluginCallback=So.registerForPluginStateChange(v=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,T)=>{if(s.cn(b),T&&T.every(D=>D))for(const D in p._sourceCaches){const L=p._sourceCaches[D],z=L.getSource().type;z!=="vector"&&z!=="geojson"||L.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.getOwnSource(v.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const D=this._layers[T];D.source===b.id&&this._validateLayer(D)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(s.f(n))return n;const a=s.co(n);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${s.cp(JSON.stringify(n))}`}_diffStyle(n,a,p){this.globalId=this._getGlobalId(n);const v=(b,T)=>{try{T(null,this.setState(b,p))}catch(D){T(D,!1)}};if(typeof n=="string"){const b=this.map._requestManager.normalizeStyleURL(n),T=this.map._requestManager.transformRequest(b,s.R.Style);s.n(T,(D,L)=>{D?this.fire(new s.z(D)):L&&v(L,a)})}else typeof n=="object"&&v(n,a)}loadURL(n,a={}){this.fire(new s.A("dataloading",{dataType:"style"}));const p=typeof a.validate=="boolean"?a.validate:!s.f(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,a.accessToken),this.resolvedImports.add(n);const v=this.importsCache.get(n);if(v)return this._load(v,p);const b=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.n(b,(T,D)=>{if(this._request=null,T)this.fire(new s.z(T));else if(D)return this.importsCache.set(n,D),this._load(D,p)})}loadJSON(n,a={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=s.q.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(vy,!1)}_loadImports(n,a,p){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const b of n){const T=this._createFragmentStyle(b),D=new Promise(F=>{T.once("style.import.load",F),T.once("error",F)}).then(()=>this.mergeAll());if(v.push(D),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const L=b.data||this.importsCache.get(b.url);L?(T.loadJSON(L,{validate:a}),this._isInternalStyle(L)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:a}):T.loadEmpty();const z={style:T,id:b.id,config:b.config};if(p){const F=this.fragments.findIndex(({id:V})=>V===p);this.fragments=this.fragments.slice(0,F).concat(z).concat(this.fragments.slice(F))}else this.fragments.push(z)}return Promise.allSettled(v)}getImportGlobalIds(n=this,a=new Set){for(const p of n.fragments)p.style.globalId&&a.add(p.style.globalId),this.getImportGlobalIds(p.style,a);return[...a.values()]}_createFragmentStyle(n){const a=this.scope?s.C(n.id,this.scope):n.id;let p;const v=this._initialConfig&&this._initialConfig[a];(n.config||v)&&(p=s.l({},n.config,v));const b=new So(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,a){const p=n.indoor?gy(n.schema):n.schema;if(this._isInternalStyle(n)){const T=s.l({},vy,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(T,a)}if(this.updateConfig(this._config,p),a&&Sl(this,fr(n)))return;this._loaded=!0,this.stylesheet=s.cq(n);const v=()=>{for(const z in n.sources)this.addSource(z,n.sources[z],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const z in n.iconsets)this.addIconset(z,n.iconsets[z]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(n.glyphs);const T=Zu(this.stylesheet.layers);if(this._order=T.map(z=>z.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new tt(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new tt(this.stylesheet.light)),this._layers={};for(const z of T){const F=s.cv(z,this.scope,this._styleColorTheme.lut,this.options);F.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const V=this.getOwnLayerSourceCache(F),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&F.canCastShadows()&&U&&(V.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const D=this.stylesheet.terrain;D&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(D,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const L=this.isRootStyle();n.imports?this._loadImports(n.imports,a).then(()=>{this._reloadImports(),this.fire(new s.A(L?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(L?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const T=this._evaluateColorThemeData(b);this._loadColorTheme(T).then(()=>{v()}).catch(D=>{s.w(`Couldn't load color theme from the stylesheet: ${D}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,a,p,v,b,T,D,L,z,F;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(U=>{if(U.stylesheet){if(U.light!=null&&(n=U.light),U.stylesheet.lights)for(const q of U.stylesheet.lights)q.type==="ambient"&&U.ambientLight!=null&&(a=U.ambientLight),q.type==="directional"&&U.directionalLight!=null&&(p=U.directionalLight);v=this._prioritizeTerrain(v,U.terrain,U.stylesheet.terrain),U.stylesheet.fog&&U.fog!=null&&(b=U.fog),U.stylesheet.snow&&U.snow!=null&&(T=U.snow),U.stylesheet.rain&&U.rain!=null&&(D=U.rain),U.stylesheet.camera!=null&&(F=U.stylesheet.camera),U.stylesheet.projection!=null&&(L=U.stylesheet.projection),U.stylesheet.transition!=null&&(z=U.stylesheet.transition),V[U.scope]=U._styleColorTheme}}),this.light=n,this.ambientLight=a,this.directionalLight=p,this.fog=b,this.snow=T,this.rain=D,this._styleColorThemeForScope=V,v===null?delete this.terrain:this.terrain=v,this.camera=F||{"camera-projection":"perspective"},this.projection=L||{name:"mercator"},this.transition=s.l({},ih,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const a=p=>{for(const v of p.fragments)a(v.style);n(p)};a(this)}_prioritizeTerrain(n,a,p){const v=n&&n.drapeRenderMode===0;return p===null?a&&a.drapeRenderMode===0?a:v?n:null:a!=null&&(!n||v||a&&a.drapeRenderMode===1)?a:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{n=this._prioritizeTerrain(n,a.terrain,a.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(n=a.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},a={},p={};this.forEachFragmentStyle(v=>{for(const b in v._sourceCaches){const T=s.C(b,v.scope);n[T]=v._sourceCaches[b]}for(const b in v._otherSourceCaches){const T=s.C(b,v.scope);a[T]=v._otherSourceCaches[b]}for(const b in v._symbolSourceCaches){const T=s.C(b,v.scope);p[T]=v._symbolSourceCaches[b]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=p}mergeLayers(){const n={},a=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const T of b._order){const D=b._layers[T];if(D.type==="slot"){const L=s.cr(T);if(n[L])continue;n[L]=[]}D.slot&&n[D.slot]?n[D.slot].push(D):a.push(D)}}),this._mergedOrder=[];const v=(b=[])=>{for(const T of b)if(T.type==="slot"){const D=s.cr(T.id);n[D]&&v(n[D]),this._mergedSlots.push(D)}else{const D=s.C(T.id,T.scope);this._mergedOrder.push(D),p[D]=T,T.is3D(!!this.terrain)&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};v(a),this._mergedOrder.sort((b,T)=>{const D=p[b],L=p[T];return D.hasInitialOcclusionOpacityProperties?L.is3D(!!this.terrain)?1:0:D.is3D(!!this.terrain)&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=s.l({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(a,p,v){const b=s.l({},p);for(const D of Object.keys(s.a5.colorTheme))b[D]===void 0&&(b[D]=s.a5.colorTheme[D].default);const T=new s.a6(K1,a,new Map(v));return T.setTransitionOrValue(b,v),T.untransitioned().possiblyEvaluate(new s.aa(0))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,v)=>{const b="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let T=n;T.startsWith(b)||(T=b+T);const D=s.I.from("mapbox-reserved-lut"),L=new Image;L.src=T,L.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},L.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void p();this._styleColorTheme.lutLoading=!1;const{width:z,height:F,data:V}=s.q.getImageData(L);if(F>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==F*F)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(D)&&this.removeImage(D),this.addImage(D,{data:new s.r({width:z,height:F},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const U=this.imageManager.getImage(D,this.scope);U?(this._styleColorTheme.lut={image:U.data,data:n},p()):v(new Error("Missing LUT image."))}})}getLut(n){const a=this._styleColorThemeForScope[n];return a?a.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(a,p,v){let b,T,D;const L=s.q.devicePixelRatio>1?"@2x":"";let z=s.n(p.transformRequest(p.normalizeSpriteURL(a,L,".json"),s.R.SpriteJSON),(U,q)=>{z=null,D||(D=U,b=q,V())}),F=s.o(p.transformRequest(p.normalizeSpriteURL(a,L,".png"),s.R.SpriteImage),(U,q)=>{F=null,D||(D=U,T=q,V())});function V(){if(D)v(D);else if(b&&T){const U=s.q.getImageData(T),q={};for(const J in b){const{width:X,height:ee,x:ie,y:le,sdf:_e,pixelRatio:pe,stretchX:we,stretchY:ve,content:xe}=b[J],be=new s.r({width:X,height:ee});s.r.copy(U,be,{x:ie,y:le},{x:0,y:0},{width:X,height:ee},null),q[J]={data:be,pixelRatio:pe,sdf:_e,stretchX:we,stretchY:ve,content:xe,usvg:!1}}v(null,q)}}return{cancel(){z&&(z.cancel(),z=null),F&&(F.cancel(),F=null)}}}(n,this.map._requestManager,(a,p)=>{if(this._spriteRequest=null,a)this.fire(new s.z(a));else if(p){const v=new Map;for(const b in p)v.set(s.I.from(b),p[b]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(n,a){if(a.type==="sprite")return void this._loadSprite(a.url);const p=this.getOwnSource(a.source);if(!p)return void this.fire(new s.z(new Error(`Source "${a.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));if(p.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${a.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));this.imageManager.createIconset(this.scope,n);const v=new J1(n,this);p.addIconset(n,v)}_loadIconset(n){if(!s.f(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const a=this.map._spriteFormat==="auto";var p,v;this._spriteRequest=(v=(b,T)=>{if(this._spriteRequest=null,b)a?this._loadSprite(n):this.fire(new s.z(b));else if(T){const D=new Map;for(const L in T)D.set(s.I.from(L),T[L]);this.addImages(D)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.bj((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(n),s.R.Iconset),(b,T)=>{if(b)return void v(b);const D={},L=s.ch(new s.bi(T));for(const z of L.icons){const F={version:1,pixelRatio:s.q.devicePixelRatio,content:yy(z),stretchX:z.metadata?Od(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?Od(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};D[z.name]=F}v(null,D)}))}_validateLayer(n){const a=this.getOwnSource(n.source);if(!a)return;const p=n.sourceLayer;p&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.z(new Error(`Source layer "${p}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,a)=>{const p=this.fragments[a];return p&&p.style&&(n.data=p.style.serialize()),n})}_serializeSources(){const n={};for(const a in this._sourceCaches){const p=this._sourceCaches[a].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const a=[];for(const p of n){const v=this._layers[p];v&&v.type!=="custom"&&a.push(v.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const a=this.getOwnLayer(n);if(a)return a;this.fire(new s.z(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const a=this.getOwnSource(n);if(a)return a;this.fire(new s.z(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,a){const p=this.map.painter;if(p)for(let v=n.minzoom||0;v<(n.maxzoom||25.5);v++){const b=n.getProgramIds();if(b)for(const T of b){const D=n.getDefaultProgramParams(T,a.zoom,this._styleColorTheme.lut);D&&(p.style=this,this.fog&&(p._fogVisible=!0,D.overrideFog=!0,p.getOrCreateProgram(T,D)),p._fogVisible=!1,D.overrideFog=!1,p.getOrCreateProgram(T,D),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(D.overrideRtt=!0,p.getOrCreateProgram(T,D)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const a=this.calculateLightsBrightness();n.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));const p=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const D in T){const{updatedIds:L,removedIds:z}=T[D];(L||z)&&(this._updateWorkerLayers(D,L,z),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const b={};for(const T in this._mergedSourceCaches){const D=this._mergedSourceCaches[T];b[T]=D.used,D.used=!1,D.tileCoverLift=0}for(const T of this._mergedOrder){const D=this._mergedLayers[T];if(D.recalculate(n,this._availableImages),!D.isHidden(n.zoom)){const L=this.getLayerSourceCache(D);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,D.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(D,n)}):this.precompilePrograms(D,n))}for(const T in this._mergedSourceCaches){const D=this._mergedSourceCaches[T];if(!D)continue;const L=D._source;L.type==="raster-array"&&L.iconsets&&(D.used=!0)}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(const T in b){const D=this._mergedSourceCaches[T];b[T]!==D.used&&D.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new s.A("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,a,p){const v=this.getFragmentStyle(n);v&&this.dispatcher.broadcast("updateLayers",{layers:a?v._serializeLayers(a):[],scope:n,removedIds:p||[],options:v.options})}setState(n,a){if(this._checkLoaded(),Sl(this,fr(n)))return!1;(n=s.cq(n)).layers=Zu(n.layers);const p=function(T,D){if(!T)return[{command:$i.setStyle,args:[D]}];let L=[];try{if(!s.bn(T.version,D.version))return[{command:$i.setStyle,args:[D]}];if(s.bn(T.center,D.center)||L.push({command:$i.setCenter,args:[D.center]}),s.bn(T.zoom,D.zoom)||L.push({command:$i.setZoom,args:[D.zoom]}),s.bn(T.bearing,D.bearing)||L.push({command:$i.setBearing,args:[D.bearing]}),s.bn(T.pitch,D.pitch)||L.push({command:$i.setPitch,args:[D.pitch]}),s.bn(T.sprite,D.sprite)||L.push({command:$i.setSprite,args:[D.sprite]}),s.bn(T.glyphs,D.glyphs)||L.push({command:$i.setGlyphs,args:[D.glyphs]}),s.bn(T.imports,D.imports)||function(q=[],J=[],X){J=J||[];const ee=(q=q||[]).map(Ni),ie=J.map(Ni),le=q.reduce(Xs,{}),_e=J.reduce(Xs,{}),pe=ee.slice();let we,ve,xe,be;for(we=0,ve=0;we<ee.length;we++)xe=ee[we],_e.hasOwnProperty(xe)?ve++:(X.push({command:$i.removeImport,args:[xe]}),pe.splice(pe.indexOf(xe,ve),1));for(we=0,ve=0;we<ie.length;we++)xe=ie[ie.length-1-we],pe[pe.length-1-we]!==xe&&(le.hasOwnProperty(xe)?(X.push({command:$i.removeImport,args:[xe]}),pe.splice(pe.lastIndexOf(xe,pe.length-ve),1)):ve++,be=pe[pe.length-we],X.push({command:$i.addImport,args:[_e[xe],be]}),pe.splice(pe.length-we,0,xe));for(const Ce of J){const Re=le[Ce.id];Re&&!s.bn(Re,Ce)&&X.push({command:$i.updateImport,args:[Ce.id,Ce]})}}(T.imports,D.imports,L),s.bn(T.transition,D.transition)||L.push({command:$i.setTransition,args:[D.transition]}),s.bn(T.light,D.light)||L.push({command:$i.setLight,args:[D.light]}),s.bn(T.fog,D.fog)||L.push({command:$i.setFog,args:[D.fog]}),s.bn(T.snow,D.snow)||L.push({command:$i.setSnow,args:[D.snow]}),s.bn(T.rain,D.rain)||L.push({command:$i.setRain,args:[D.rain]}),s.bn(T.projection,D.projection)||L.push({command:$i.setProjection,args:[D.projection]}),s.bn(T.lights,D.lights)||L.push({command:$i.setLights,args:[D.lights]}),s.bn(T.camera,D.camera)||L.push({command:$i.setCamera,args:[D.camera]}),!s.bn(T["color-theme"],D["color-theme"]))return[{command:$i.setStyle,args:[D]}];const z={},F=[];(function(q,J,X,ee){let ie;for(ie in J=J||{},q=q||{})q.hasOwnProperty(ie)&&(J.hasOwnProperty(ie)||Md(ie,X,ee));for(ie in J){if(!J.hasOwnProperty(ie))continue;const le=J[ie];q.hasOwnProperty(ie)?s.bn(q[ie],le)||(q[ie].type==="geojson"&&le.type==="geojson"&&Gt(q,J,ie)?X.push({command:$i.setGeoJSONSourceData,args:[ie,le.data]}):mc(ie,J,X,ee)):so(ie,J,X)}})(T.sources,D.sources,F,z);const V=[];T.layers&&T.layers.forEach(q=>{q.source&&z[q.source]?L.push({command:$i.removeLayer,args:[q.id]}):V.push(q)});let U=T.terrain;U&&z[U.source]&&(L.push({command:$i.setTerrain,args:[void 0]}),U=void 0),L=L.concat(F),s.bn(U,D.terrain)||L.push({command:$i.setTerrain,args:[D.terrain]}),function(q,J,X){J=J||[];const ee=(q=q||[]).map(Ni),ie=J.map(Ni),le=q.reduce(Xs,{}),_e=J.reduce(Xs,{}),pe=ee.slice(),we=Object.create(null);let ve,xe,be,Ce,Re,Je,$e;for(ve=0,xe=0;ve<ee.length;ve++)be=ee[ve],_e.hasOwnProperty(be)?xe++:(X.push({command:$i.removeLayer,args:[be]}),pe.splice(pe.indexOf(be,xe),1));for(ve=0,xe=0;ve<ie.length;ve++)be=ie[ie.length-1-ve],pe[pe.length-1-ve]!==be&&(le.hasOwnProperty(be)?(X.push({command:$i.removeLayer,args:[be]}),pe.splice(pe.lastIndexOf(be,pe.length-xe),1)):xe++,Je=pe[pe.length-ve],X.push({command:$i.addLayer,args:[_e[be],Je]}),pe.splice(pe.length-ve,0,be),we[be]=!0);for(ve=0;ve<ie.length;ve++)if(be=ie[ve],Ce=le[be],Re=_e[be],!we[be]&&!s.bn(Ce,Re))if(s.bn(Ce.source,Re.source)&&s.bn(Ce["source-layer"],Re["source-layer"])&&s.bn(Ce.type,Re.type)){for($e in Yi(Ce.layout,Re.layout,X,be,null,$i.setLayoutProperty),Yi(Ce.paint,Re.paint,X,be,null,$i.setPaintProperty),s.bn(Ce.slot,Re.slot)||X.push({command:$i.setSlot,args:[be,Re.slot]}),s.bn(Ce.filter,Re.filter)||X.push({command:$i.setFilter,args:[be,Re.filter]}),s.bn(Ce.minzoom,Re.minzoom)&&s.bn(Ce.maxzoom,Re.maxzoom)||X.push({command:$i.setLayerZoomRange,args:[be,Re.minzoom,Re.maxzoom]}),Ce)Ce.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?Yi(Ce[$e],Re[$e],X,be,$e.slice(6),$i.setPaintProperty):s.bn(Ce[$e],Re[$e])||X.push({command:$i.setLayerProperty,args:[be,$e,Re[$e]]}));for($e in Re)Re.hasOwnProperty($e)&&!Ce.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?Yi(Ce[$e],Re[$e],X,be,$e.slice(6),$i.setPaintProperty):s.bn(Ce[$e],Re[$e])||X.push({command:$i.setLayerProperty,args:[be,$e,Re[$e]]}))}else X.push({command:$i.removeLayer,args:[be]}),Je=pe[pe.lastIndexOf(be)+1],X.push({command:$i.addLayer,args:[Re,Je]})}(V,D.layers,L)}catch(z){console.warn("Unable to compute style diff:",z),L=[{command:$i.setStyle,args:[D]}]}return L}(this.serialize(),n).filter(T=>!(T.command in eb));if(p.length===0)return!1;const v=p.filter(T=>!(T.command in Q1));if(v.length>0)throw new Error(`Unimplemented: ${v.map(T=>T.command).join(", ")}.`);const b=[];return p.forEach(T=>{b.push(this[T.command].apply(this,T.args))}),a&&Promise.all(b).then(a),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}addImages(n){for(const[a,p]of n.entries()){if(this.getImage(a)&&!a.iconsetId)return this.fire(new s.z(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,p),this._changes.updateImage(a)}return this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this}addImage(n,a){return this.getImage(n)&&!n.iconsetId?this.fire(new s.z(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,a),this._changes.updateImage(n),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(n,a,p=!1){this.imageManager.updateImage(n,this.scope,a),p&&(this._changes.updateImage(n),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,a,p={}){return this._checkLoaded(),this._validate(Me,`models.${n}`,a,null,p)||(this.modelManager.addModel(n,a,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,a,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(xl,`sources.${n}`,a,null,p))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const v=Sd(n,a,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const b=T=>{const D=(T?"symbol:":"other:")+v.id,L=s.C(D,this.scope),z=this._sourceCaches[D]=new no(L,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=z,z.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),v.onAdd&&v.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const a=this.getOwnSource(n);if(!a)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===n)return this.fire(new s.z(new Error(`Source "${n}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.z(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const p=this.getOwnSourceCaches(n);for(const v of p){const b=s.cr(v.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(v.id),v.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getOwnSource(n).setData(a),this._changes.setDirty()}getOwnSource(n){const a=this.getOwnSourceCache(n);return a&&a.getSource()}getOwnSources(){const n=[];for(const a in this._otherSourceCaches){const p=this.getOwnSourceCache(a);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const a in n){const p=n[a]._tiles;for(const v in p){const b=p[v];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const v of n){if(this._validate(uc,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(v),b.updateTransitions(a)}else this.ambientLight=new Gn(v,Ci||(Ci=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(v),b.updateTransitions(a)}else this.directionalLight=new Gn(v,Ki||(Ki=new s.a7({direction:new s.am(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=new s.aa(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,a=this.ambientLight;if(!n||!a)return;const p=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),v=n.properties.get("color").toRenderColor(null).toArray01(),b=n.properties.get("intensity"),T=n.properties.get("direction"),D=1-s.cc(T.x,T.y,T.z)[2]/90,L=p(v)*b*D,z=a.properties.get("color").toRenderColor(null).toArray01(),F=a.properties.get("intensity"),V=p(z)*F;return Number(((L+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(s.cs(n)){const a=s.ct(n),p=this.fragments.find(({id:b})=>b===a);if(!p)throw new Error(`Style import '${n}' not found`);const v=s.cr(n);return p.style.getFragmentStyle(v)}{const a=this.fragments.find(({id:p})=>p===n);return a?a.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const a={},p=(v,b="")=>`${v}::${b}`;this._featuresetSelectors={};for(const v in n){const b=this._featuresetSelectors[v]=[];for(const T of n[v].selectors){if(T.featureNamespace){const L=this.getOwnLayer(T.layer);if(!L){s.w(`Layer is undefined for selector: ${T.layer}`);continue}const z=p(L.source,L.sourceLayer);if(z in a&&a[z]!==T.featureNamespace){s.w(`"featureNamespace ${T.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}a[z]=T.featureNamespace}let D;if(T.properties)for(const L in T.properties){const z=s.X(T.properties[L]);z.result==="success"&&(D=D||{},D[L]=z.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:D,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const a=this.getFragmentStyle(n);if(!a||!a.stylesheet.featuresets)return[];const p=[];for(const v in a.stylesheet.featuresets)p.push({featuresetId:v,importId:a.scope?a.scope:void 0});return p}getFeaturesetLayers(n,a){const p=this.getFragmentStyle(a),v=p.stylesheet.featuresets;if(!v||!v[n])return this.fire(new s.z(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of v[n].selectors){const D=p.getOwnLayer(T.layer);D&&b.push(D)}return b}getConfigProperty(n,a){const p=this.getFragmentStyle(n);if(!p)return null;const v=s.C(a,p.scope),b=p.options.get(v),T=b?b.value||b.default:null;return T?T.serialize():null}setConfigProperty(n,a,p){const v=this.getFragmentStyle(n);if(!v)return;const b=v.stylesheet.indoor?gy(v.stylesheet.schema):v.stylesheet.schema;if(!b||!b[a])return;const T=s.X(p);if(T.result!=="success")return void Sl(this,T.value);const D=T.value.expression,L=s.C(a,v.scope),z=v.options.get(L);if(!z)return;let F;const{minValue:V,maxValue:U,stepValue:q,type:J,values:X}=b[a],ee=s.X(b[a].default);ee.result==="success"&&(F=ee.value.expression),F?(this.options.set(L,Object.assign({},z,{value:D,default:F,minValue:V,maxValue:U,stepValue:q,type:J,values:X})),this.updateConfigDependencies(a)):this.fire(new s.z(new Error(`No schema defined for the config option "${a}" in the "${n}" fragment.`)))}getConfig(n){const a=this.getFragmentStyle(n);if(!a)return null;const p=a.stylesheet.schema;if(!p)return null;const v={};for(const b in p){const T=s.C(b,a.scope),D=a.options.get(T),L=D?D.value||D.default:null;v[b]=L?L.serialize():null}return v}setConfig(n,a){const p=this.getFragmentStyle(n);p&&(p.updateConfig(a,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const a=this.getFragmentStyle(n);return a?a.stylesheet.schema:null}setSchema(n,a){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=a,p.updateConfig(p._config,a),this.updateConfigDependencies())}updateConfig(n,a){if(this._config=n,n||a)if(a)for(const p in a){let v,b;const T=s.X(a[p].default);if(T.result==="success"&&(v=T.value.expression),n&&n[p]!==void 0){const U=s.X(n[p]);U.result==="success"&&(b=U.value.expression)}const{minValue:D,maxValue:L,stepValue:z,type:F,values:V}=a[p];if(v){const U=s.C(p,this.scope);this.options.set(U,{default:v,value:b,minValue:D,maxValue:L,stepValue:z,type:F,values:V})}else this.fire(new s.z(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const a of this._configDependentLayers){const p=this.getLayer(a);if(p){if(n&&!p.configDependencies.has(n))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const p=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(p){const v=a._evaluateColorThemeData(p);(!a._styleColorTheme.lut&&v!==""||a._styleColorTheme.lut&&v!==a._styleColorTheme.lut.data)&&a.setColorTheme(p)}}),this._changes.setDirty()}addLayer(n,a,p={}){this._checkLoaded();const v=n.id;if(this._layers[v])return void this.fire(new s.z(new Error(`Layer with id "${v}" already exists on this map`)));let b;if(n.type==="custom"){if(Sl(this,s.cu(n)))return;b=s.cv(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(v,n.source),n=s.cq(n),n=s.l(n,{source:v})),this._validate(te,`layers.${v}`,n,{arrayIndex:-1},p))return;b=s.cv(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let T=this._order.length;if(a){const F=this._order.indexOf(a);if(F===-1)return void this.fire(new s.z(new Error(`Layer with id "${a}" does not exist on this map.`)));b.slot===this._layers[a].slot?T=F:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const D=this.getOwnLayerSourceCache(b),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&b.canCastShadows()&&L&&(D.castsShadows=!0);const z=this._changes.getRemovedLayer(b);if(z&&b.source&&D&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const F=s.C(b.source,b.scope);z.type!==b.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),D.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(n,a){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===a)return;const v=this._order.indexOf(n);this._order.splice(v,1);let b=this._order.length;if(a){const T=this._order.indexOf(a);if(T===-1)return void this.fire(new s.z(new Error(`Layer with id "${a}" does not exist on this map.`)));p.slot===this._layers[a].slot?b=T:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const a=this._checkLayer(n);if(!a)return;a.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const v=this.getOwnLayerSourceCache(a);if(v&&v.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===a.source&&this._layers[T].canCastShadows()){b=!0;break}v.castsShadows=b}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,p){this._checkLoaded();const v=this._checkLayer(n);v&&(v.minzoom===a&&v.maxzoom===p||(a!=null&&(v.minzoom=a),p!=null&&(v.maxzoom=p),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,a){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==a&&(p.slot=a,this._updateLayer(p))}setFilter(n,a,p={}){this._checkLoaded();const v=this._checkLayer(n);if(v&&!s.bn(v.filter,a))return a==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(re,`layers.${v.id}.filter`,a,{layerType:v.type},p)||(v.filter=s.cq(a),this._updateLayer(v)))}getFilter(n){const a=this._checkLayer(n);if(a)return s.cq(a.filter)}setLayoutProperty(n,a,p,v={}){this._checkLoaded();const b=this._checkLayer(n);if(b&&!s.bn(b.getLayoutProperty(a),p)){if(p!=null&&(!v||v.validate!==!1)&&Sl(b,Pe.call(fr,{key:`layers.${n}.layout.${a}`,layerType:b.type,objectKey:a,value:p,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(a,p),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(n,a){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(a)}setPaintProperty(n,a,p,v={}){this._checkLoaded();const b=this._checkLayer(n);if(!b||s.bn(b.getPaintProperty(a),p)||p!=null&&(!v||v.validate!==!1)&&Sl(b,ye.call(fr,{key:`layers.${n}.paint.${a}`,layerType:b.type,objectKey:a,value:p,styleSpec:s.a5})))return;const T=b.setPaintProperty(a,p);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(n,a){const p=this._checkLayer(n);if(p)return p.getPaintProperty(a)}setFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:L,importId:z}=n.target,F=this.getFragmentStyle(z),V=F.getFeaturesetLayers(L);for(const{source:U,sourceLayer:q}of V)F.setFeatureState({id:n.id,source:U,sourceLayer:q},a)}else if("layerId"in n.target){const{layerId:L}=n.target,z=this.getLayer(L);this.setFeatureState({id:n.id,source:z.source,sourceLayer:z.sourceLayer},a)}return}const p=n.source,v=n.sourceLayer,b=this._checkSource(p);if(!b)return;const T=b.type;if(T==="geojson"&&v)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!v)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const D=this.getOwnSourceCaches(p);for(const L of D)L.setFeatureState(v,n.id,a)}removeFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:L,importId:z}=n.target,F=this.getFragmentStyle(z),V=F.getFeaturesetLayers(L);for(const{source:U,sourceLayer:q}of V)F.removeFeatureState({id:n.id,source:U,sourceLayer:q},a)}else if("layerId"in n.target){const{layerId:L}=n.target,z=this.getLayer(L);this.removeFeatureState({id:n.id,source:z.source,sourceLayer:z.sourceLayer},a)}return}const p=n.source,v=this._checkSource(p);if(!v)return;const b=v.type,T=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const D=this.getOwnSourceCaches(p);for(const L of D)L.removeFeatureState(T,n.id,a)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let b;if("featuresetId"in n.target){const{featuresetId:T,importId:D}=n.target,L=this.getFragmentStyle(D),z=L.getFeaturesetLayers(T);for(const{source:F,sourceLayer:V}of z){const U=L.getFeatureState({id:n.id,source:F,sourceLayer:V});if(U&&!b)b=U;else if(!s.bn(b,U))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:T}=n.target,D=this.getLayer(T);b=this.getFeatureState({id:n.id,source:D.source,sourceLayer:D.sourceLayer})}return b}const a=n.source,p=n.sourceLayer,v=this._checkSource(a);if(v){if(v.type!=="vector"||p)return n.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(p,n.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=s.l({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),a=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(n){for(const a of Object.values(this._mergedLayers))n(a)&&this._updateLayer(a)}_updateLayer(n){this._changes.updateLayer(n);const a=this.getLayerSourceCache(n),p=s.C(n.source,n.scope),v=this._changes.getUpdatedSourceCaches();n.source&&!v[p]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),a.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=D=>this._mergedLayers[D].is3D(!!this.terrain),p=this.order,v={},b=[];for(let D=p.length-1;D>=0;D--){const L=p[D];if(a(L)){v[L]=D;for(const z of n){const F=z[L];if(F)for(const V of F)b.push(V)}}}b.sort((D,L)=>L.intersectionZ-D.intersectionZ);const T=[];for(let D=p.length-1;D>=0;D--){const L=p[D];if(a(L))for(let z=b.length-1;z>=0;z--){const F=b[z].feature;if(F.layer&&v[F.layer.id]<D)break;T.push(F),b.pop()}else for(const z of n){const F=z[L];if(F)for(const V of F)T.push(V.feature)}}return T}queryRenderedFeatures(n,a,p){let v;a&&!Array.isArray(a)&&a.filter&&(this._validate(re,"queryRenderedFeatures.filter",a.filter,null,a),v=s.a_(a.filter));const b={},T=F=>{if(kd.has(F.type))return;const V=this.getOwnLayerSourceCache(F),U=b[V.id]=b[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(U.has3DLayers=!0),U.layers[F.fqid]=U.layers[F.fqid]||{styleLayer:F,targets:[]},U.layers[F.fqid].targets.push({filter:v})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const F of a.layers){const V=this._layers[F];if(!V)return this.fire(new s.z(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];T(V)}}else for(const F in this._layers)T(this._layers[F]);const D=this._queryRenderedFeatures(n,b,p),L=this._flattenAndSortRenderedFeatures(D),z=[];for(const F of L)s.ct(F.layer.id)===this.scope&&z.push(F);return z}queryRenderedFeatureset(n,a,p){let v;a&&!Array.isArray(a)&&a.filter&&(this._validate(re,"queryRenderedFeatures.filter",a.filter,null,a),v=s.a_(a.filter));const b="mock",T=[];if(a&&a.target)T.push(Object.assign({},a,{targetId:b,filter:v}));else{const F=this.getFeaturesetDescriptors();for(const V of F)T.push({targetId:b,filter:v,target:V});for(const{style:V}of this.fragments){const U=V.getFeaturesetDescriptors();for(const q of U)T.push({targetId:b,filter:v,target:q})}}const D=this.queryRenderedTargets(n,T,p),L=[],z=new Set;for(const F of D)for(const V of F.variants[b])dc(V,F,z)||L.push(new s.cx(F,V));return L}queryRenderedTargets(n,a,p){const v={},b=(D,L,z,F)=>{const V=v[L.id]=v[L.id]||{sourceCache:L,layers:{},has3DLayers:!1};if(V.layers[D.fqid]=V.layers[D.fqid]||{styleLayer:D,targets:[]},D.is3D(!!this.terrain)&&(V.has3DLayers=!0),!F)return z.uniqueFeatureID=!1,void V.layers[D.fqid].targets.push(z);V.layers[D.fqid].targets.push(Object.assign({},z,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const D of a)if("featuresetId"in D.target){const{featuresetId:L,importId:z}=D.target,F=this.getFragmentStyle(z);if(!F||!F._featuresetSelectors)continue;const V=F._featuresetSelectors[L];if(!V){this.fire(new s.z(new Error(`The featureset '${L}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const U of V){const q=F.getOwnLayer(U.layerId);q&&!kd.has(q.type)&&b(q,F.getOwnLayerSourceCache(q),D,U)}}else if("layerId"in D.target){const{layerId:L}=D.target,z=this.getLayer(L);if(!z||kd.has(z.type))continue;b(z,this.getLayerSourceCache(z),D)}const T=this._queryRenderedFeatures(n,v,p);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(n,a,p){const v=[],b=!!this.map._showQueryGeometry,T=Es.createFromScreenPoints(n,p);for(const D in a){const L=kp(T,a[D],this._availableImages,p,b);Object.keys(L).length&&v.push(L)}if(this.placement)for(const D in a){if(!a[D].sourceCache._onlySymbols)continue;const L=ly(T.screenGeometry,a[D],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(L).length&&v.push(L)}return v}querySourceFeatures(n,a){const p=a&&a.filter;p&&this._validate(re,"querySourceFeatures.filter",p,null,a);let v=[];const b=this.getOwnSourceCaches(n);for(const T of b)v=v.concat(cy(T,a));return v}addSourceType(n,a,p){return So.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(So.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,a,p={}){this._checkLoaded();const v=this.light.getLight();let b=!1;for(const D in n)if(!s.bn(n[D],v[D])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(n,a,p),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,a=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const v=n.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const D="terrain-dem-src";this.addSource(D,p.source),p=s.cq(p),p=s.l(p,{source:D})}const b=s.l({},p),T={};if(this.terrain&&v){b.source=this.terrain.get().source;const D=this.terrain?this.getFragmentStyle(this.terrain.scope):null;D&&(T.style=D.serialize())}if(this._validate(Td,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&a!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,a),this.fire(new s.A("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const D of Object.keys(s.a5.terrain))!p.hasOwnProperty(D)&&s.a5.terrain[D].default&&(p[D]=s.a5.terrain[D].default);for(const D in n)if(!s.bn(n[D],T[D])){b.set(n,this.options),this.stylesheet.terrain=n;const L=this._getTransitionParameters({duration:0});b.updateTransitions(L),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new Ti(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_createSnow(n){const a=this.snow=new Ji(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_createRain(n){const a=this.rain=new nn(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!s.bn(a.get(),n)){a.set(n,this.options),this.stylesheet.fog=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!s.bn(a.get(),n)){a.set(n,this.options),this.stylesheet.snow=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!s.bn(a.get(),n)){a.set(n,this.options),this.stylesheet.rain=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void n();const p=this._evaluateColorThemeData(a);this._loadColorTheme(p).then(()=>{this.fire(new s.A("colorthemeset")),n()}).catch(v=>{s.w(`Couldn't set color theme: ${v}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,a){const p=this.getFragmentStyle(n);p&&(p._styleColorTheme.colorThemeOverride=a,p._reloadColorTheme())}_getTransitionParameters(n){return{now:s.q.now(),transition:s.l(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],a=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):a.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const p=this.terrain=new rt(n,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});p.updateTransitions(v)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,p,v,b={}){if(b&&b.validate===!1)return!1;const T=s.l({},this.serialize());return Sl(this,n.call(fr,s.l({key:a,style:T,value:p,styleSpec:s.a5},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const a=this.getSourceCaches(n);for(const p of a)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const a=this.getSourceCaches(n);for(const p of a)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let a;this.directionalLight&&(a=Za(this.directionalLight));for(const p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(n,void 0,void 0,a)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,p,v,b,T,D=!1){let L=!1,z=!1;const F={},V={};for(const U of this._mergedOrder){const q=this._mergedLayers[U];if(q.type!=="symbol")continue;const J=s.C(q.source,q.scope);let X=F[J];if(!X){const ie=this.getLayerSourceCache(q);if(!ie)continue;const le=ie.getRenderableIds(!0).map(_e=>ie.getTileByID(_e));V[J]=le.slice(),X=F[J]=le.sort((_e,pe)=>pe.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(pe.tileID)?-1:1))}const ee=this.crossTileSymbolIndex.addLayer(q,X,a.center.lng,a.projection);L=L||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),D=D||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),a.zoom))&&(this.pauseablePlacement=new qa(a,this._mergedOrder,D,p,v,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,V,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),z=!0),L&&this.pauseablePlacement.placement.setStale()),z||L){this._buildingIndex.onNewFrame(a.zoom);for(let U=0;U<this._mergedOrder.length;U++){const q=this._mergedLayers[this._mergedOrder[U]];if(q.type!=="symbol")continue;const J=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,F[s.C(q.source,q.scope)],U,J?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,a){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:b})=>b===n.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!a)return p.push(n),this._loadImports([n],!0);const v=p.findIndex(({id:b})=>b===a);return v===-1&&this.fire(new s.z(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,v).concat(n).concat(p.slice(v)),this._loadImports([n],!0,a)}updateImport(n,a){this._checkLoaded();const p=this.stylesheet.imports||[],v=this.getImportIndex(n);return v===-1?this:typeof a=="string"?(this.setImportUrl(n,a),this):(a.url&&a.url!==p[v].url&&this.setImportUrl(n,a.url),s.bn(a.config,p[v].config)||this.setImportConfig(n,a.config,a.data.schema),s.bn(a.data,p[v].data)||this.setImportData(n,a.data),this)}moveImport(n,a){this._checkLoaded();let p=this.stylesheet.imports||[];const v=this.getImportIndex(n);if(v===-1)return this;const b=this.getImportIndex(a);if(b===-1)return this;const T=p[v],D=this.fragments[v];return p=p.filter(({id:L})=>L!==n),this.fragments=this.fragments.filter(({id:L})=>L!==n),this.stylesheet.imports=p.slice(0,b).concat(T).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(D).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(n,a){this._checkLoaded();const p=this.stylesheet.imports||[],v=this.getImportIndex(n);if(v===-1)return this;p[v].url=a;const b=this.fragments[v];return b.style=this._createFragmentStyle(p[v]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(a),this}setImportData(n,a){this._checkLoaded();const p=this.getImportIndex(n),v=this.stylesheet.imports||[];return p===-1?this:a?(this.fragments[p].style.setState(a),this._reloadImports(),this):(delete v[p].data,this.setImportUrl(n,v[p].url))}setImportConfig(n,a,p){this._checkLoaded();const v=this.getImportIndex(n),b=this.stylesheet.imports||[];if(v===-1)return this;a?b[v].config=a:delete b[v].config;const T=this.fragments[v];p&&T.style.stylesheet&&(T.style.stylesheet.schema=p);const D=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=a,T.style.updateConfig(a,D),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const a=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(a.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const a=(this.stylesheet.imports||[]).findIndex(p=>p.id===n);return a===-1&&this.fire(new s.z(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),a}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const a in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[a];p&&n.push(p.getSource())}return n}getSource(n,a){const p=this.getSourceCache(n,a);return p&&p.getSource()}getLayerSource(n){const a=this.getLayerSourceCache(n);return a&&a.getSource()}getSourceCache(n,a){const p=s.C(n,a);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const a=s.C(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[n]&&a.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&a.push(this._mergedSymbolSourceCaches[n]),a}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const a in n){const p=n[a];p==="reload"?this.reloadSource(a):p==="clear"&&this.clearSource(a)}}updateLayers(n){const a=this._changes.getUpdatedPaintProperties();for(const p of a){const v=this.getLayer(p);v&&v.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n,this.scope)}getImages(n,a,p){this.imageManager.getImages(a.images,a.scope,p),this._updateTilesForChangedImages();const v=T=>{if(T){const D=a.images.map(L=>s.I.toString(L));T.setDependencies(a.tileID.key,a.type,D)}},b=s.C(a.source,a.scope);v(this._mergedOtherSourceCaches[b]),v(this._mergedSymbolSourceCaches[b])}rasterizeImages(n,a,p){this.imageManager.rasterizeImages(a,p)}getGlyphs(n,a,p){this.glyphManager.getGlyphs(a.stacks,a.scope,p)}getResource(n,a,p){return s.cz(a,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this.getOwnSourceCaches(n);return a.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${n}'`))),!1):a.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,a){if(!this._clipLayerPresent&&n.type!=="fill-extrusion")return!1;const p=n.type==="fill-extrusion"&&n.sourceLayer==="building";if(n.is3D(!!this.terrain)){if(p||a&&a.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}So.getSourceType=function(m){return Op[m]},So.setSourceType=function(m,n){Op[m]=n},So.registerForPluginStateChange=s.ci;var qp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,zd=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,nh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Fd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Xa=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Bd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Wp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Al=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ac=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,sh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,rh=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const va=[];Go(qp,va),Go(nh,va),Go(zd,va);const Ml={"_prelude_fog.vertex.glsl":Bd,"_prelude_terrain.vertex.glsl":Xa,"_prelude_shadow.vertex.glsl":sh,"_prelude_fog.fragment.glsl":Wp,"_prelude_shadow.fragment.glsl":rh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Al,"_prelude_raster_particle.glsl":Ac},Mc={};Ri("",Xa),Ri(Wp,Bd),Ri(rh,sh),Ri(Al,""),Ri(Ac,"");const Zp=Ri(zd,nh),Nd=qp;var oh={background:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ri("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ri(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ri("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ri("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ri(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ri(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ri(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ri(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ri(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ri("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ri("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ri(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ri(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ri("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ri(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fd),skyboxGradient:Ri(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fd),skyboxCapture:Ri(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ri(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ri(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ri("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ri("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ri("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ri("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Go(m,n){const a=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of a)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=p.split(" ");for(const b of v)n.includes(b)||n.push(b)}}function Ri(m,n){const a=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(z=>{const F=z.split(" ");return F[F.length-1]}),v=[...new Set(v)]);const b={},T=[],D=[];if(m=m.replace(a,(z,F)=>(D.push(F),"")),(n=n.replace(a,(z,F)=>(T.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...va];Go(m,L),Go(n,L);for(const z of[...T,...D])Ml[z]||console.error(`Undefined include: ${z}`),Mc[z]||(Mc[z]=[],Go(Ml[z],Mc[z])),L=[...L,...Mc[z]];return{fragmentSource:m=m.replace(p,(z,F,V,U,q)=>(b[q]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${V} ${U} ${q};
#else
uniform ${V} ${U} u_${q};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${V} ${U} ${q} = u_${q};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${V} ${U} ${q};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(p,(z,F,V,U,q)=>{const J=U==="float"?"vec2":U,X=q.match(/color/)?"color":J;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${V} ${U} a_${q};
#endif
`:b[q]?F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${V} ${J} a_${q};
out ${V} ${U} ${q};
#else
uniform ${V} ${U} u_${q};
#endif
`:F==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${V} ${U} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${X}(a_${q}, u_${q}_t);
#else
    ${V} ${U} ${q} = u_${q};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${V} ${U} a_${q};
    out ${V} ${U} ${q};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${V} ${J} a_${q};
#else
uniform ${V} ${U} u_${q};
#endif
`:F==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${V} ${U} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${V} ${J} a_${q};
#else
uniform ${V} ${U} u_${q};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${V} ${U} ${q} = a_${q};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${V} ${U} ${q} = a_${q};
#else
    ${V} ${U} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${V} ${U} ${q} = unpack_mix_${X}(a_${q}, u_${q}_t);
#else
    ${V} ${U} ${q} = u_${q};
#endif
`}),staticAttributes:v,usedDefines:L,vertexIncludes:T,fragmentIncludes:D}}class xy{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,p,v,b,T,D,L){this.context=n;let z=this.boundPaintVertexBuffers.length!==v.length;for(let V=0;!z&&V<v.length;V++)this.boundPaintVertexBuffers[V]!==v[V]&&(z=!0);let F=this.boundDynamicVertexBuffers.length!==D.length;for(let V=0;!F&&V<D.length;V++)this.boundDynamicVertexBuffers[V]!==D[V]&&(F=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==p||z||F||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(a,p,v,b,T,D,L);else{n.bindVertexArrayOES.set(this.vao);for(const V of D)V&&(V.bind(),L&&V.instanceCount&&V.setVertexAttribDivisor(n.gl,a,L));b&&b.dynamicDraw&&b.bind()}}freshBind(n,a,p,v,b,T,D){const L=n.numAttributes,z=this.context,F=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,a.enableAttributes(F,n),a.bind(),a.setVertexAttribPointers(F,n,b);for(const V of p)V.enableAttributes(F,n),V.bind(),V.setVertexAttribPointers(F,n,b);for(const V of T)V&&(V.enableAttributes(F,n),V.bind(),V.setVertexAttribPointers(F,n,b),D&&V.instanceCount&&V.setVertexAttribDivisor(F,n,D));v&&v.bind(),z.currentNumAttributes=L}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function by(m,n){const a=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new s.ac(0,p/a).toLngLat().lat,new s.ac(0,(p+1)/a).toLngLat().lat]}function Ic(m,n,a,p,v,b,T){const D=m.context,L=D.gl,z=a.hillshadeFBO;if(!z)return;m.prepareDrawTile();const F=m.isTileAffectedByFog(n),V=m.getOrCreateProgram("hillshade",{overrideFog:F});D.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,z.colorAttachment.get());const U=((ee,ie,le,_e)=>{const pe=le.paint.get("hillshade-shadow-color"),we=le.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ve=le.paint.get("hillshade-highlight-color"),xe=le.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",be=le.paint.get("hillshade-accent-color"),Ce=le.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Re=le.paint.get("hillshade-emissive-strength");let Je=s.ak(le.paint.get("hillshade-illumination-direction"));if(le.paint.get("hillshade-illumination-anchor")==="viewport")Je-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){const ct=ee.style.directionalLight.properties.get("direction"),ut=s.cc(ct.x,ct.y,ct.z);Je=s.ak(ut[1])}const $e=!ee.options.moving;return{u_matrix:_e||ee.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),$e),u_image:0,u_latrange:by(0,ie.tileID),u_light:[le.paint.get("hillshade-exaggeration"),Je],u_shadow:pe.toRenderColor(we?null:le.lut),u_highlight:ve.toRenderColor(xe?null:le.lut),u_emissive_strength:Re,u_accent:be.toRenderColor(Ce?null:le.lut)}})(m,a,p,m.terrain?n.projMatrix:null);m.uploadCommonUniforms(D,V,n.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:J,tileBoundsSegments:X}=m.getTileBoundsBuffers(a);V.draw(m,L.TRIANGLES,v,b,T,fi.disabled,U,p.id,q,J,X)}function Xp(m,n,a){if(!n.needsDEMTextureUpload)return;const p=m.context,v=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||m.getTileTexture(a.stride);const b=a.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new s.T(p,b,v.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function tb(m,n,a){const p=m.context,v=p.gl;if(!n.dem)return;const b=n.dem;if(p.activeTexture.set(v.TEXTURE1),Xp(m,n,b),!n.demTexture)return;n.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const T=b.dim;p.activeTexture.set(v.TEXTURE0);let D=n.hillshadeFBO;if(!D){const U=new s.T(p,{width:T,height:T,data:null},v.RGBA8);U.bind(v.LINEAR,v.CLAMP_TO_EDGE),D=n.hillshadeFBO=p.createFramebuffer(T,T,!0,"renderbuffer"),D.colorAttachment.set(U.texture)}p.bindFramebuffer.set(D.framebuffer),p.viewport.set([0,0,T,T]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:z,tileBoundsSegments:F}=m.getMercatorTileBoundsBuffers(),V=[];m.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(m,v.TRIANGLES,Jt.disabled,gi.disabled,Mi.unblended,fi.disabled,((U,q)=>{const J=q.stride,X=s.ad.mat4.create();return s.ad.mat4.ortho(X,0,s.ai,-s.ai,0,0,1),s.ad.mat4.translate(X,X,[0,-s.ai,0]),{u_matrix:X,u_image:1,u_dimension:[J,J],u_zoom:U.overscaledZ}})(n.tileID,b),a.id,L,z,F),n.needsHillshadePrepare=!1}class An{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ib extends An{getDefault(){return s.al.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Yp extends An{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Kp extends An{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Jp extends An{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Qp extends An{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class wy extends An{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Ty extends An{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class nb extends An{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class ah extends An{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class lh extends An{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ey extends An{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class jr extends An{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class em extends An{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class Vd extends An{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ud extends An{getDefault(){return s.al.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class tm extends An{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class im extends An{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class nm extends An{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class jd extends An{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let sm=class extends An{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class rm extends An{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class $d extends An{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Sy extends An{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Ay extends An{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Cc extends An{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class sb extends An{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class rb extends An{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ob extends An{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class ab extends An{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class lb extends An{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class cb extends An{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class ch extends An{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class om extends ch{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class am extends ch{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Pc extends ch{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class My extends am{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Iy=(m,n,a)=>({u_matrix:m,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:a}),lm=(m,n,a,p,v,b,T,D,L,z,F,V,U,q,J,X)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:a,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:D,u_frustum_br:L,u_frustum_bl:z,u_globe_pos:F,u_globe_radius:V,u_viewport:U,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:J});function Hd(m,n){return m!=null&&n!=null&&!(!m.hasData()||!n.hasData())&&m.demTexture!=null&&n.demTexture!=null&&m.tileID.key!==n.tileID.key}const ro=new class{constructor(){this.operations={}}newMorphing(m,n,a,p,v){if(m in this.operations){const b=this.operations[m];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[m]={startTime:p,phase:0,duration:v,from:n,to:a,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const n=this.operations[m];return{from:n.from,to:n.to,phase:n.phase}}update(m){for(const n in this.operations){const a=this.operations[n];for(a.phase=(m-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,m)){delete this.operations[n];break}}}_nextOp(m,n){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=n,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},cm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function xa(m,n,a){if(n===0)return 0;const p=n<1&&a===514?.25/n:1;return 6*Math.pow(1.5,22-m)*Math.max(n,1)*p}function um(m,n){const a=1<<m.z;return!n&&(m.x===0||m.x===a-1)||m.y===0||m.y===a-1}const Dc=m=>({u_matrix:m});function Gd(m,n,a,p,v){if(v>0){const b=s.q.now(),T=(b-m.timeAdded)/v,D=n?(b-n.timeAdded)/v:-1,L=a.getSource(),z=p.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),F=!n||Math.abs(n.tileID.overscaledZ-z)>Math.abs(m.tileID.overscaledZ-z),V=F&&m.refreshedUponExpiration?1:s.ay(F?T:1-D,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),n?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class Cy extends no{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},p=new s.D(s.cj(),null),v=Sd("mock-dem",a,p,n.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class hm extends no{constructor(n){const a=Sd("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new s.D(s.cj(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,p){if(n.freezeTileCoverage)return;this.transform=n;const v=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const D=new wo(T,this._source.tileSize*T.overscaleFactor(),n.tileZoom);D.state="loaded",this._tiles[T.key]=D}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const p=Object.values(a);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class qd extends s.aH{constructor(n,a,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=p}}class Py extends s.cK{constructor(n,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,v,b]=function(L){const z=new s.b5,F=new s.aV,V=131;z.reserve(17161),F.reserve(33800);const U=s.ai/128,q=s.ai+U/2,J=q+U;for(let ee=-U;ee<J;ee+=U)for(let ie=-U;ie<J;ie+=U){const le=ie<0||ie>q||ee<0||ee>q?24575:0,_e=s.ay(Math.round(ie),0,s.ai),pe=s.ay(Math.round(ee),0,s.ai);z.emplaceBack(_e+le,pe)}const X=(ee,ie)=>{const le=ie*V+ee;F.emplaceBack(le+1,le,le+V),F.emplaceBack(le+V,le+V+1,le+1)};for(let ee=1;ee<129;ee++)for(let ie=1;ie<129;ie++)X(ie,ee);return[0,129].forEach(ee=>{for(let ie=0;ie<130;ie++)X(ie,ee),X(ee,ie)}),[z,F,32768]}(),T=n.context;this.gridBuffer=T.createVertexBuffer(p,s.b7.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=s.b8.simpleSegment(0,0,p.length,v.length),this.gridNoSkirtSegments=s.b8.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new hm(a.map),this.orthoMatrix=s.ad.mat4.create(),s.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ai,0,s.ai,0,1);const D=T.gl;this._overlapStencilMode=new gi({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Cy(a.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,a,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const v=n.terrain.properties,b=n.terrain.drapeRenderMode===0,T=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const D=n.terrain&&n.terrain.scope,L=v.get("source"),z=b?this._mockSourceCache:n.getSourceCache(L,D);if(!z)return void s.w(`Couldn't find terrain source "${L}".`);if(this.sourceCache=z,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(a):v.get("exaggeration"),!a.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(a,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),a.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const a=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const v=a!=null?p-a:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const b=n.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let D=b-this._previousZoom;const L=this._previousUpdateTimestamp;let z=b;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(b-z)>.5&&(D=.5*(b-z+D)),D*v<0&&(z+=D)),this._evaluationZoom=z;const F=T.getExaggeration(z),V=F===T.getExaggeration(Math.max(0,z-.1));if(V&&Math.abs(F-this._exaggeration)<.01)return F;let U=Math.min(.1,.00375*(this._updateTimestamp-L));return(V||F<.1||Math.abs(D)<1e-4)&&(U=Math.min(.2,4*U)),s.ah(this._exaggeration,F,U)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=a.getIds().map(L=>{const z=a.getTileByID(L).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(L,z){const F=z.transform.pointCoordinate(z.transform.getCameraPoint()),V=new s.P(F.x,F.y);L.sort((U,q)=>{if(q.overscaledZ-U.overscaledZ)return q.overscaledZ-U.overscaledZ;const J=new s.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),X=new s.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ee=V.mult(1<<U.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(J)-ee.distSqr(X)})})(v,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const L in T){const z=T[L];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,n[L],b),z.usedForTerrain))continue;const F=n[L];z.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[a.id]=v.map(L=>new qd(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const D={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const z=this.terrainTileForTile[L.key];if(!z)continue;const F=z.tileID.key;F in D||(this._visibleDemTiles.push(z),D[F]=F)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const p=this._findTileCoveringTileID(a,this.sourceCache);p&&(this.terrainTileForTile[a.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const p in this.terrainTileForTile){const v=this.terrainTileForTile[p],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Xp(this.painter,v,b))}}_prepareDemTileUniforms(n,a,p,v){if(!a||a.demTexture==null)return!1;const b=n.tileID.canonical,T=Math.pow(2,a.tileID.canonical.z-b.z),D=v||"";return p[`u_dem_tl${D}`]=[b.x*T%1,b.y*T%1],p[`u_dem_scale${D}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const a=this._visibleDemTiles.reduce((p,v)=>{if(!v.dem)return p;const b=v.dem.tree.minimums[0];return b>0&&n++,p+b},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const p=this._getLoadedAreaMinimum(),v=new s.cL({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new s.T(n,v,a.R32F,{premultiply:!1}),b}setupElevationDraw(n,a,p){const v=this.painter.context,b=v.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let D=null,L=null,z=1;if(p&&p.morphing&&this._useVertexMorphing){const q=p.morphing.srcDemTile,J=p.morphing.dstDemTile;z=p.morphing.phase,q&&J&&(this._prepareDemTileUniforms(n,q,T,"_prev")&&(L=q),this._prepareDemTileUniforms(n,J,T)&&(D=J))}const F=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let V=null;var U;if(this.enabled?L&&D?(V=D.demTexture,v.activeTexture.set(b.TEXTURE4),L.demTexture.bind(F(L),b.CLAMP_TO_EDGE),T.u_dem_lerp=z):(D=this.terrainTileForTile[n.tileID.key],V=this._prepareDemTileUniforms(n,D,T)?D.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,v.activeTexture.set(b.TEXTURE2),V&&(T.u_dem_size=(U=V).size[0]===1?1:U.size[0]-2,V.bind(F(D),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,a,T),p&&p.useMeterToDem&&D){const q=(1<<D.tileID.canonical.z)*s.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=q}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),a.setTerrainUniformValues(v,T),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);a.setGlobeUniformValues(v,q)}}globeUniformValues(n,a,p){const v=n.projection;return{u_tile_tl_up:v.upVector(a,0,0),u_tile_tr_up:v.upVector(a,s.ai,0),u_tile_br_up:v.upVector(a,s.ai,s.ai),u_tile_bl_up:v.upVector(a,0,s.ai),u_tile_up_scale:p?s.cM(1):v.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,T,D,L){if(v.transform.projection.name==="globe")(function(z,F,V,U,q){const J=z.context,X=J.gl;let ee,ie;const le=z.transform,_e=s.cD(z,J,le),pe=(ct,ut)=>{if(ie===ut)return;const vt=[cm[ut],"PROJECTION_GLOBE_VIEW"];_e&&vt.push("CUSTOM_ANTIALIASING");const je=z.isTileAffectedByFog(ct);ee=z.getOrCreateProgram("globeRaster",{defines:vt,overrideFog:je}),ie=ut},we=z.colorModeForRenderPass(),ve=new Jt(X.LEQUAL,Jt.ReadWrite,z.depthRangeFor3D);ro.update(q);const xe=s.cE(le),be=[s.av(le.center.lng),s.aC(le.center.lat)],Ce=z.globeSharedBuffers,Re=[le.width*s.q.devicePixelRatio,le.height*s.q.devicePixelRatio],Je=Float32Array.from(le.globeMatrix),$e={useDenormalizedUpVectorScale:!0};{const ct=z.transform,ut=xa(ct.zoom,F.exaggeration(),F.sourceCache._source.tileSize);ie=-1;const vt=X.TRIANGLES;for(const je of U){const at=V.getTile(je),Ne=gi.disabled,ot=F.prevTerrainTileForTile[je.key],st=F.terrainTileForTile[je.key];Hd(ot,st)&&ro.newMorphing(je.key,ot,st,q,250),J.activeTexture.set(X.TEXTURE0),at.texture&&at.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const ht=ro.getMorphValuesForProxy(je.key),Qe=ht?1:0;ht&&s.L($e,{morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:s.cC(ht.phase)}});const ft=s.cF(je.canonical),Ct=s.cG(ft.getCenter().lat),Pt=s.cH(je.canonical,ft,Ct,ct.worldSize/ct._pixelsPerMercatorPixel),Dt=s.bc(s.cI(je.canonical)),$t=lm(ct.expandedFarZProjMatrix,Je,xe,Dt,s.ag(ct.zoom),be,ct.frustumCorners.TL,ct.frustumCorners.TR,ct.frustumCorners.BR,ct.frustumCorners.BL,ct.globeCenterInViewSpace,ct.globeRadius,Re,ut,ct._farZ,Pt);if(pe(je,Qe),ee&&(F.setupElevationDraw(at,ee,$e),z.uploadCommonUniforms(J,ee,je.toUnwrapped()),Ce)){const[pi,ti,hi]=Ce.getGridBuffers(Ct,ut!==0);ee.draw(z,vt,ve,Ne,we,fi.backCCW,$t,"globe_raster",pi,ti,hi)}}}if(Ce&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&ct.push("CUSTOM_ANTIALIASING"),ee=z.getOrCreateProgram("globeRaster",{defines:ct});for(const ut of U){const{x:vt,y:je,z:at}=ut.canonical,Ne=je===0,ot=je===(1<<at)-1,[st,ht,Qe,ft]=Ce.getPoleBuffers(at,!1);if(ft&&(Ne||ot)){const Ct=V.getTile(ut);J.activeTexture.set(X.TEXTURE0),Ct.texture&&Ct.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let Pt=s.cJ(at,vt,le);const Dt=s.bc(s.cI(ut.canonical)),$t=(pi,ti)=>pi.draw(z,X.TRIANGLES,ve,gi.disabled,we,fi.disabled,lm(le.expandedFarZProjMatrix,Pt,Pt,Dt,0,be,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Re,0,le._farZ),"globe_pole_raster",ti,Qe,ft);F.setupElevationDraw(Ct,ee,$e),z.uploadCommonUniforms(J,ee,ut.toUnwrapped()),Ne&&z.renderDefaultNorthPole&&$t(ee,st),ot&&z.renderDefaultSouthPole&&(Pt=s.ad.mat4.scale(s.ad.mat4.create(),Pt,[1,-1,1]),$t(ee,ht))}}}})(v,b,T,D,L);else{const z=v.context,F=z.gl;let V,U;const q=v.shadowRenderer,J=_a(v,v.longestCutoffRange),X=we=>{if(U===we)return;const ve=[];ve.push(cm[we]),J.shouldRenderCutoff&&ve.push("RENDER_CUTOFF"),q&&(ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&ve.push("NORMAL_OFFSET")),V=v.getOrCreateProgram("terrainRaster",{defines:ve}),U=we},ee=v.colorModeForRenderPass(),ie=new Jt(F.LEQUAL,Jt.ReadWrite,v.depthRangeFor3D);ro.update(L);const le=v.transform,_e=xa(le.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let pe=[0,0,0];if(q){const we=v.style.directionalLight,ve=v.style.ambientLight;we&&ve&&(pe=Ec(v.style,we,ve))}{U=-1;const we=F.TRIANGLES,[ve,xe]=[b.gridIndexBuffer,b.gridSegments];for(const be of D){const Ce=T.getTile(be),Re=gi.disabled,Je=b.prevTerrainTileForTile[be.key],$e=b.terrainTileForTile[be.key];Hd(Je,$e)&&ro.newMorphing(be.key,Je,$e,L,250),z.activeTexture.set(F.TEXTURE0),Ce.texture&&Ce.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ct=ro.getMorphValuesForProxy(be.key),ut=ct?1:0;let vt;ct&&(vt={morphing:{srcDemTile:ct.from,dstDemTile:ct.to,phase:s.cC(ct.phase)}});const je=Iy(be.projMatrix,um(be.canonical,le.renderWorldCopies)?_e/10:_e,pe);if(X(ut),!V)continue;b.setupElevationDraw(Ce,V,vt);const at=be.toUnwrapped();q&&q.setupShadows(at,V),v.uploadCommonUniforms(z,V,at,null,J),V.draw(v,we,ie,Re,ee,fi.backCCW,je,"terrain_raster",b.gridBuffer,ve,xe)}}}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,p=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),D=a.style.order,L=[];let z=0;for(const F of b){const V=v.getTileByID(F.proxyTileKey),U=v.proxyCachedFBO[F.key]?v.proxyCachedFBO[F.key][n]:void 0,q=U!==void 0?v.renderCache[U]:this.pool[z++],J=U!==void 0;if(V.texture=q.tex,J&&!q.dirty){L.push(V.tileID);continue}let X;p.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(p.clear({color:s.al.transparent,stencil:0}),q.dirty=!1);for(let ee=T.start;ee<=T.end;++ee){const ie=a.style._mergedLayers[D[ee]];if(ie.isHidden(a.transform.zoom))continue;const le=a.style.getLayerSourceCache(ie),_e=le?this.proxyToSource[F.key][le.id]:[F];if(!_e)continue;const pe=_e;p.viewport.set([0,0,q.fb.width,q.fb.height]),X!==(le?le.id:null)&&(this._setupStencil(q,_e,ie,le),X=le?le.id:null),a.renderLayer(a,le,ie,pe)}if(this._drapedRenderBatches.length===0)for(const ee of this._pendingGroundEffectLayers){const ie=a.style._mergedLayers[D[ee]];if(ie.isHidden(a.transform.zoom))continue;const le=a.style.getLayerSourceCache(ie),_e=le?this.proxyToSource[F.key][le.id]:[F];if(!_e)continue;const pe=_e;p.viewport.set([0,0,q.fb.width,q.fb.height]),X!==(le?le.id:null)&&(this._setupStencil(q,_e,ie,le),X=le?le.id:null),a.renderLayer(a,le,ie,pe)}this.renderedToTile?(q.dirty=!0,L.push(V.tileID)):J||--z,z===5&&(z=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),T.end+1}postRender(){}isLayerOrderingCorrect(n){const a=n.order.length;let p=-1,v=a;for(let b=0;b<a;++b)this._style.isLayerDraped(n._mergedLayers[n.order[b]])?p=Math.max(p,b):v=Math.min(v,b);return v>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,p){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,D=1<<T.overscaledZ,{x:L,y:z}=T.canonical,F=L/D,V=(L+1)/D,U=z/D,q=(z+1)/D;return{minx:F,miny:U,maxx:V,maxy:q,t:b.dem.tree.raycastRoot(F,U,V,q,n,a,p),tile:b}});v.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of v){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,a,p);if(T!=null)return T}return null}_createFBO(){const n=this.painter.context,a=n.gl,p=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const v=new s.T(n,{width:p[0],height:p[1],data:null},a.RGBA8);v.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=n.createFramebuffer(p[0],p[1],!0,null);return b.colorAttachment.set(v.texture),b.depthAttachment=new My(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._mergedLayers[n],p=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!p&&a.shouldRedrape():!p&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof hc){n=!0;break}if(!n)return;const a={};for(let p=0;p<this._style.order.length;++p){const v=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(v);if(b&&!a[b.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof s.ab){a[b.id]=!0;for(const T of this.proxyCoords){const D=this.proxyToSource[T.key][b.id];if(D)for(const L of D)this._clearRenderCacheForTile(b.id,L)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof io){n=!0;break}if(!n)return;const a={};for(let p=0;p<this._style.order.length;++p){const v=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(v);if(!b||a[b.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const T=v.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const L=this.proxyToSource[D.key][b.id];if(L)for(const z of L){const F=Gd(b.getTile(z),b.findLoadedParent(z,0),b,this.painter.transform,T);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(b.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,a=n.length;if(a===0)return;const p=[];this._pendingGroundEffectLayers=[];let v,b=0,T=this._style._mergedLayers[n[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<a;)T=this._style._mergedLayers[n[b]];for(;b<a;++b){const D=this._style._mergedLayers[n[b]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?v===void 0&&(v=b):(D.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),v!==void 0&&(p.push({start:v,end:b-1}),v=void 0)))}if(v!==void 0&&p.push({start:v,end:b-1}),p.length!==0){const D=p[p.length-1];this._pendingGroundEffectLayers.every(L=>L>D.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const T=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let D=0;D<T.length;++D){const L=Object.values(T[D]);a.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,v=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const D=p[T];if(a.getTileByID(D.key),a.proxyCachedFBO[D.key]!==void 0){const L=n[D.key],z=this.proxyToSource[D.key];let F=0;for(const V in z){const U=z[V],q=L[V];if(!q||q.length!==U.length||U.some((J,X)=>J!==q[X]||v[V]&&v[V].hasOwnProperty(J.key))){F=-1;break}++F}for(const V in a.proxyCachedFBO[D.key])a.renderCache[a.proxyCachedFBO[D.key][V]].dirty=F<0||F!==Object.values(L).length}}const b=[...this._drapedRenderBatches];b.sort((T,D)=>D.end-D.start-(T.end-T.start));for(const T of b)for(const D of p){if(a.proxyCachedFBO[D.key])continue;let L=a.renderCachePool.pop();L===void 0&&a.renderCache.length<50&&(L=a.renderCache.length,a.renderCache.push(this._createFBO())),L!==void 0&&(a.proxyCachedFBO[D.key]={},a.proxyCachedFBO[D.key][T.start]=L,a.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,p,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let D;if(p.isTileClipped())D=a.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):gi.disabled}_renderTileClippingMasks(n,a){const p=this.painter,v=this.painter.context,b=v.gl;p._tileClippingMaskIDs={},v.setColorMode(Mi.disabled),v.setDepthMode(Jt.disabled);const T=p.getOrCreateProgram("clippingMask");for(const D of n){const L=p._tileClippingMaskIDs[D.key]=--a;T.draw(p,b.TRIANGLES,Jt.disabled,new gi({func:b.ALWAYS,mask:0},L,255,b.KEEP,b.KEEP,b.REPLACE),Mi.disabled,fi.disabled,Dc(D.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const p=[n.x,n.y,1,1];s.ad.vec4.transformMat4(p,p,a.pixelMatrixInverse),s.ad.vec4.scale(p,p,1/p[3]),p[0]/=a.worldSize,p[1]/=a.worldSize;const v=a._camera.position,b=s.bH(1,a.center.lat),T=[v[0],v[1],v[2]/b,0],D=s.ad.vec3.subtract([],p.slice(0,3),T);s.ad.vec3.normalize(D,D);const L=this.raycast(T,D,this._exaggeration);return L!==null&&L?(s.ad.vec3.scaleAndAdd(T,T,D,L),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(n,a,p){if(n.getSource()instanceof s.aK)return this._setupProxiedCoordsForImageSource(n,a,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const v=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let L=0;L<b.length;L++){const z=b[L],F=this._findTileCoveringTileID(z,n);if(F){const V=this._createProxiedId(z,F,p[z.key]&&p[z.key][n.id]);v.push(V),this.proxyToSource[z.key][n.id]=[V]}}let T=!1;const D=new Set;for(let L=0;L<a.length;L++){const z=n.getTile(a[L]);if(!z||!z.hasData())continue;const F=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==z.tileID.canonical.z){const V=this.proxyToSource[F.tileID.key][n.id],U=this._createProxiedId(F.tileID,z,p[F.tileID.key]&&p[F.tileID.key][n.id]);V?V.splice(V.length-1,0,U):this.proxyToSource[F.tileID.key][n.id]=[U];const q=this.proxyToSource[F.tileID.key][n.id];D.has(q)||D.add(q),v.push(U),T=!0}}if(this._sourceTilesOverlap[n.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const L of D)L.sort((z,F)=>F.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(n,a,p){if(!n.getSource().loaded())return;const v=this.proxiedCoords[n.id]=[],b=this.proxyCoords,T=n.getSource(),D=T.tileID;if(!D)return;const L=new s.P(D.x,D.y)._div(1<<D.z),z=T.coordinates.map(s.ac.fromLngLat).reduce((V,U)=>(V.min.x=Math.min(V.min.x,U.x-L.x),V.min.y=Math.min(V.min.y,U.y-L.y),V.max.x=Math.max(V.max.x,U.x-L.x),V.max.y=Math.max(V.max.y,U.y-L.y),V),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(V,U)=>{const q=V.wrap+V.canonical.x/(1<<V.canonical.z),J=V.canonical.y/(1<<V.canonical.z),X=s.ai/(1<<V.canonical.z),ee=U.wrap+U.canonical.x/(1<<U.canonical.z),ie=U.canonical.y/(1<<U.canonical.z);return q+X<ee+z.min.x||q>ee+z.max.x||J+X<ie+z.min.y||J>ie+z.max.y};for(let V=0;V<b.length;V++){const U=b[V];for(let q=0;q<a.length;q++){const J=n.getTile(a[q]);if(!J||!J.hasData()||F(U,J.tileID))continue;const X=this._createProxiedId(U,J,p[U.key]&&p[U.key][n.id]),ee=this.proxyToSource[U.key][n.id];ee?ee.push(X):this.proxyToSource[U.key][n.id]=[X],v.push(X)}}}_createProxiedId(n,a,p){let v=this.orthoMatrix;if(p){const b=p.find(T=>T.key===a.tileID.key);if(b)return b}if(a.tileID.key!==n.key){const b=n.canonical.z-a.tileID.canonical.z;let T,D,L;v=s.ad.mat4.create();const z=a.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(T=s.ai>>b,D=T*((a.tileID.canonical.x<<b)-n.canonical.x+z),L=T*((a.tileID.canonical.y<<b)-n.canonical.y)):(T=s.ai<<-b,D=s.ai*(a.tileID.canonical.x-(n.canonical.x+z<<-b)),L=s.ai*(a.tileID.canonical.y-(n.canonical.y<<-b))),s.ad.mat4.ortho(v,0,T,0,T,0,1),s.ad.mat4.translate(v,v,[D,L,0])}return new qd(a.tileID,n.key,v)}_findTileCoveringTileID(n,a){let p=a.getTile(n);if(p&&p.hasData())return p;const v=this._findCoveringTileCache[a.id],b=v[n.key];if(p=b?a.getTileByID(b):null,p&&p.hasData()||b===null)return p;let T=p?p.tileID:n,D=T.overscaledZ;const L=a.getSource().minzoom,z=[];if(!b){const V=a.getSource().maxzoom;if(n.canonical.z>=V){const U=n.canonical.z-V;a.getSource().reparseOverscaled?(D=Math.max(n.canonical.z+2,a.transform.tileZoom),T=new s.aH(D,n.wrap,V,n.canonical.x>>U,n.canonical.y>>U)):U!==0&&(D=V,T=new s.aH(D,n.wrap,V,n.canonical.x>>U,n.canonical.y>>U))}T.key!==n.key&&(z.push(T.key),p=a.getTile(T))}const F=V=>{z.forEach(U=>{v[U]=V}),z.length=0};for(D-=1;D>=L&&(!p||!p.hasData());D--){p&&F(p.tileID.key);const V=T.calculateScaledKey(D);if(p=a.getTileByID(V),p&&p.hasData())break;const U=v[V];if(U===null)break;U===void 0?z.push(V):p=a.getTileByID(U)}return F(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[a.key]=!0}}function Dy(m,n,a){const p=function(D,L,z){const F=s.ad.vec3.dot(L,D),V=s.ad.vec3.dot(z,[.2126,.7152,.0722]),U=(J,X,ee)=>(1-ee)*J+ee*X,q=U(1-.3*Math.min(V,1),1,Math.min(F+1,1));return U(.92,1,Math.asin(s.ay(L[2],-1,1))/Math.PI+.5)*q}(m,[0,0,1],n),v=[0,0,0];s.ad.vec3.scale(v,a.slice(0,3),p);const b=[0,0,0];s.ad.vec3.scale(b,n.slice(0,3),m[2]);const T=[0,0,0];return s.ad.vec3.add(T,v,b),s.cg(T)}const uh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ub=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Ry{static cacheKey(n,a,p,v){let b=`${a}${v?v.cacheKey:""}`;for(const T of p)n.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(n,a,p,v,b,T){const D=n.gl;this.program=D.createProgram(),this.configuration=v,this.name=a,this.fixedDefines=[...T];const L=v?v.getBinderAttributes():[],z=(p.staticAttributes||[]).concat(L);let F=v?v.defines():[];F=F.concat(T.map(ee=>`#define ${ee}`));const V=`#version 300 es
`;let U=V+F.concat("precision mediump float;",Nd,Zp.fragmentSource).join(`
`);for(const ee of p.fragmentIncludes)U+=`
${Ml[ee]}`;U+=`
${p.fragmentSource}`;let q=V+F.concat("precision highp float;",Nd,Zp.vertexSource).join(`
`);for(const ee of p.vertexIncludes)q+=`
${Ml[ee]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(q+=`
uniform int u_instanceID;
`),q+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(q=q.replaceAll("gl_InstanceID","u_instanceID"));const J=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(J,U),D.compileShader(J),D.attachShader(this.program,J);const X=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())this.failedToCreate=!0;else{D.shaderSource(X,q),D.compileShader(X),D.attachShader(this.program,X),this.attributes={},this.numAttributes=z.length;for(let ee=0;ee<this.numAttributes;ee++)if(z[ee]){const ie=z[ee].startsWith("a_")?z[ee]:`a_${z[ee]}`;D.bindAttribLocation(this.program,ee,ie),this.attributes[ie]=ee}D.linkProgram(this.program),D.deleteShader(X),D.deleteShader(J),this.fixedUniforms=b(n),this.binderUniforms=v?v.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ee=>({u_instanceID:new s.bN(ee)}))(n)),(T.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(ee=>({u_dem:new s.bN(ee),u_dem_prev:new s.bN(ee),u_dem_tl:new s.bK(ee),u_dem_scale:new s.bM(ee),u_dem_tl_prev:new s.bK(ee),u_dem_scale_prev:new s.bM(ee),u_dem_size:new s.bM(ee),u_dem_lerp:new s.bM(ee),u_exaggeration:new s.bM(ee),u_depth:new s.bN(ee),u_depth_size_inv:new s.bK(ee),u_depth_range_unpack:new s.bK(ee),u_occluder_half_size:new s.bM(ee),u_occlusion_depth_offset:new s.bM(ee),u_meter_to_dem:new s.bM(ee),u_label_plane_matrix_inv:new s.bJ(ee)}))(n)),T.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new s.bL(ee),u_tile_tr_up:new s.bL(ee),u_tile_br_up:new s.bL(ee),u_tile_bl_up:new s.bL(ee),u_tile_up_scale:new s.bM(ee)}))(n)),T.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new s.bJ(ee),u_fog_range:new s.bK(ee),u_fog_color:new s.cb(ee),u_fog_horizon_blend:new s.bM(ee),u_fog_vertical_limit:new s.bK(ee),u_fog_temporal_offset:new s.bM(ee),u_frustum_tl:new s.bL(ee),u_frustum_tr:new s.bL(ee),u_frustum_br:new s.bL(ee),u_frustum_bl:new s.bL(ee),u_globe_pos:new s.bL(ee),u_globe_radius:new s.bM(ee),u_globe_transition:new s.bM(ee),u_is_globe:new s.bN(ee),u_viewport:new s.bK(ee)}))(n)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ee=>({u_cutoff_params:new s.cb(ee)}))(n)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ee=>({u_lighting_ambient_color:new s.bL(ee),u_lighting_directional_dir:new s.bL(ee),u_lighting_directional_color:new s.bL(ee),u_ground_radiance:new s.bL(ee)}))(n)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ee=>({u_light_matrix_0:new s.bJ(ee),u_light_matrix_1:new s.bJ(ee),u_fade_range:new s.bK(ee),u_shadow_normal_offset:new s.bL(ee),u_shadow_intensity:new s.bM(ee),u_shadow_texel_size:new s.bM(ee),u_shadow_map_resolution:new s.bM(ee),u_shadow_direction:new s.bL(ee),u_shadow_bias:new s.bL(ee),u_shadowmap_0:new s.bN(ee),u_shadowmap_1:new s.bN(ee)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in a)p[v]&&p[v].set(this.program,v,a[v])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in a)p[v]&&p[v].set(this.program,v,a[v])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in a)p[v].set(this.program,v,a[v])}}setCutoffUniformValues(n,a){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in a)p[v].set(this.program,v,a[v])}}setLightsUniformValues(n,a){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in a)p[v].set(this.program,v,a[v])}}setShadowUniformValues(n,a){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const v in a)p[v].set(this.program,v,a[v])}_drawDebugWireframe(n,a,p,v,b,T,D,L,z,F){const V=n.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const U=n.context;if(!(()=>!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||n._terrain&&n._terrain.renderingToTexture||!uh.includes(this.name))||!(!V.layers3D||!ub.includes(this.name)))())return;const q=U.gl,J=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,b,U);if(!J)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const ee=n.getOrCreateProgram(this.name,{config:this.configuration,defines:X});U.program.set(ee.program);const ie=(pe,we,ve)=>{if(we[pe]&&ve[pe])for(const xe in we[pe])ve[pe][xe]&&ve[pe][xe].set(ve.program,xe,we[pe][xe].current)};z&&z.setUniforms(ee.program,U,ee.binderUniforms,D,{zoom:L}),ie("fixedUniforms",this,ee),ie("terrainUniforms",this,ee),ie("globeUniforms",this,ee),ie("fogUniforms",this,ee),ie("lightsUniforms",this,ee),ie("shadowUniforms",this,ee),J.bind(),U.setColorMode(new Mi([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],s.al.transparent,[!0,!0,!0,!1])),U.setDepthMode(new Jt(a.func===q.LESS?q.LEQUAL:a.func,Jt.ReadOnly,a.range)),U.setStencilMode(gi.disabled);const le=3*T.primitiveLength*2,_e=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const pe=F||1;for(let we=0;we<pe;++we)ee.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),q.drawElements(q.LINES,le,q.UNSIGNED_SHORT,_e)}else F&&F>1?q.drawElementsInstanced(q.LINES,le,q.UNSIGNED_SHORT,_e,F):q.drawElements(q.LINES,le,q.UNSIGNED_SHORT,_e);b.bind(),U.program.set(this.program),U.setDepthMode(a),U.setStencilMode(p),U.setColorMode(v)}checkUniforms(n,a,p){if(this.fixedDefines.includes(a)){for(const v of Object.keys(p))if(!p[v].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${v} not set but required by ${a} being defined`)}}draw(n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee){const ie=n.context,le=ie.gl;if(this.failedToCreate)return;ie.program.set(this.program),ie.setDepthMode(p),ie.setStencilMode(v),ie.setColorMode(b),ie.setCullFace(T);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,D[we]);J&&J.setUniforms(this.program,ie,this.binderUniforms,U,{zoom:q});const _e={[le.POINTS]:1,[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[a];this.checkUniforms(L,"RENDER_SHADOWS",this.shadowUniforms);const pe=ee&&ee>0?1:void 0;for(const we of V.get()){const ve=we.vaos||(we.vaos={});if((ve[L]||(ve[L]=new xy)).bind(ie,this,z,J?J.getPaintVertexBuffers():[],F,we.vertexOffset,X||[],pe),this.forceManualRenderingForInstanceIDShaders){const xe=ee||1;for(let be=0;be<xe;++be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),F?le.drawElements(a,we.primitiveLength*_e,le.UNSIGNED_SHORT,we.primitiveOffset*_e*2):le.drawArrays(a,we.vertexOffset,we.vertexLength)}else ee&&ee>1?le.drawElementsInstanced(a,we.primitiveLength*_e,le.UNSIGNED_SHORT,we.primitiveOffset*_e*2,ee):F?le.drawElements(a,we.primitiveLength*_e,le.UNSIGNED_SHORT,we.primitiveOffset*_e*2):le.drawArrays(a,we.vertexOffset,we.vertexLength);a===le.TRIANGLES&&F&&this._drawDebugWireframe(n,p,v,b,F,we,U,q,J,ee)}}}function dm(m,n){const a=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,m.transform.tileZoom)/a,v=p*(n.tileID.canonical.x+n.tileID.wrap*a),b=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.at(n,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const Wd={terrain:0,flat:1},fm=s.ad.mat4.create(),Zd=(m,n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee,ie)=>{const le=n.style.light,_e=le.properties.get("position"),pe=[_e.x,_e.y,_e.z],we=s.ad.mat3.create();le.properties.get("anchor")==="viewport"&&(s.ad.mat3.fromRotation(we,-n.transform.angle),s.ad.vec3.transformMat3(pe,pe,we));const ve=le.properties.get("color"),xe=n.transform,be={u_matrix:m,u_lightpos:pe,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_vertical_gradient:+a,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Wd[z],u_base_type:Wd[F],u_ao:v,u_edge_radius:b,u_width_scale:T,u_flood_light_color:J,u_vertical_scale:X,u_flood_light_intensity:ee,u_ground_shadow_factor:ie};return xe.projection.name==="globe"&&(be.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],be.u_zoom_transition=V,be.u_inv_rot_matrix=q,be.u_merc_center=U,be.u_up_dir=xe.projection.upVector(new s.bT(0,0,0),U[0]*s.ai,U[1]*s.ai),be.u_height_lift=L),be},Rc=(m,n,a,p,v,b)=>({u_matrix:m,u_edge_radius:n,u_width_scale:a,u_vertical_scale:p,u_height_type:Wd[v],u_base_type:Wd[b]}),pm=(m,n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee)=>{const ie=Zd(m,n,a,p,v,b,T,D,z,F,V,U,q,J,X,ee,1,[0,0,0]),le={u_height_factor:-Math.pow(2,D.overscaledZ)/L.tileSize/8};return s.l(ie,dm(n,L),le)},Lc=(m,n)=>({u_matrix:m,u_emissive_strength:n}),mm=(m,n,a,p)=>s.l(Lc(m,n),dm(a,p)),Xd=(m,n,a)=>({u_matrix:m,u_world:a,u_emissive_strength:n}),Yd=(m,n,a,p,v)=>s.l(mm(m,n,a,p),{u_world:v}),hh=(m,n,a,p,v)=>({u_matrix:m,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:a,u_height_scale:p,u_reset_depth:v}),Ly=(m,n,a,p)=>{const v=s.ai/a.tileSize;return{u_matrix:m,u_camera_to_center_distance:n.getCameraToCenterDistance(p),u_extrude_scale:[n.pixelsToGLUnits[0]/v,n.pixelsToGLUnits[1]/v]}},Oy=(m,n,a=1)=>({u_matrix:m,u_color:n.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),Oc=s.ad.mat4.create(),Kd=(m,n,a,p,v,b,T)=>{const D=m.transform,L=D.projection.name==="globe",z=L?s.cO(D.zoom,n.canonical)*D._pixelsPerMercatorPixel:s.at(a,1,b),F={u_matrix:n.projMatrix,u_extrude_scale:z,u_intensity:T,u_inv_rot_matrix:Oc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){F.u_inv_rot_matrix=p,F.u_merc_center=v,F.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],F.u_zoom_transition=s.ag(D.zoom);const V=v[0]*s.ai,U=v[1]*s.ai;F.u_up_dir=D.projection.upVector(new s.bT(0,0,0),V,U)}return F};function zt(m,[n,a,p,v],[b,T]){if(b===T)return[0,0,0,0];const D=255*(m-1)/(m*(T-b));return[n*D,a*D,p*D,v*D]}function gm(m,n,[a,p]){return a===p?0:.5/m+(n-a)*(m-1)/(m*(p-a))}const _m=(m,n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee,ie,le,_e,pe)=>({u_matrix:m,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:p,u_grid_matrix:v,u_tl_parent:b,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:s.cP(V.paint.get("raster-saturation")),u_contrast_factor:s.cQ(V.paint.get("raster-contrast")),u_spin_weights:Ya(V.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:q,u_zoom_transition:T,u_merc_center:D,u_cutoff_params:L,u_colorization_mix:zt(s.cR,X,ie),u_colorization_offset:gm(s.cR,ee,ie),u_color_ramp:J,u_texture_offset:[_e/(le+2*_e),le/(le+2*_e)],u_texture_res:[le+2*_e,le+2*_e],u_emissive_strength:pe});function Ya(m){m*=Math.PI/180;const n=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const $r=.05,Qt=(m,n,a,p,v,b,T,D,L,z,F,V)=>({u_matrix:m,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:p,u_grid_matrix:v,u_tl_parent:b,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:T,u_merc_center:D,u_cutoff_params:L}),ym=(m,n,a,p,v,b,T,D,L,z)=>({u_particle_texture:m,u_particle_texture_side_len:n,u_tile_offset:a,u_velocity:p,u_color_ramp:b,u_velocity_res:v,u_max_speed:T,u_uv_offset:D,u_data_scale:[255*L[0],255*L[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[$r,$r]}),hb=(m,n,a,p,v,b,T,D,L,z)=>({u_particle_texture:m,u_particle_texture_side_len:n,u_velocity:a,u_velocity_res:p,u_max_speed:v,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:D,u_data_scale:[255*L[0],255*L[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[$r,$r]}),ky=s.ad.mat4.create(),Jd=(m,n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee,ie,le,_e,pe,we)=>{const ve=v.transform,xe={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:ve.getCameraToCenterDistance(le),u_rotate_symbol:+a,u_aspect_ratio:ve.width/ve.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:D,u_is_text:+z,u_elevation_from_sea:L?1:0,u_pitch_with_map:+p,u_texsize:F,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ky,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ky,u_up_vector:[0,-1,0],u_color_adj_mat:_e,u_icon_transition:pe||0,u_gamma_scale:p?v.transform.getCameraToCenterDistance(le)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:+U,u_scale_factor:we||1};return le.name==="globe"&&(xe.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],xe.u_zoom_transition=J,xe.u_inv_rot_matrix=ee,xe.u_merc_center=X,xe.u_camera_forward=ve._camera.forward(),xe.u_ecef_origin=s.cS(ve.globeMatrix,q.toUnwrapped()),xe.u_tile_matrix=Float32Array.from(ve.globeMatrix),xe.u_up_vector=ie),xe},vm=(m,n,a,p)=>({u_matrix:m,u_emissive_strength:n,u_opacity:a,u_color:p}),zy=(m,n,a,p,v,b,T,D,L)=>s.l(function(z,F,V,U,q,J){const{width:X,height:ee}=U.imageManager.getPixelSize(F),ie=Math.pow(2,J.tileID.overscaledZ),le=J.tileSize*Math.pow(2,U.transform.tileZoom)/ie,_e=le*(J.tileID.canonical.x+J.tileID.wrap*ie),pe=le*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[X,ee],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:q?[U.transform.width,-1*U.transform.height]:[1/s.at(J,1,U.transform.tileZoom),1/s.at(J,1,U.transform.tileZoom)],u_pixel_coord_upper:[_e>>16,pe>>16],u_pixel_coord_lower:[65535&_e,65535&pe]}}(0,b,T,p,D,L),{u_matrix:m,u_emissive_strength:n,u_opacity:a}),Qd=new Float32Array(s.ad.mat4.identity([])),xm=(m,n,a,p,v,b,T,D,L,z,F,V,U,q=[0,0,0],J)=>{const X=v.style.light,ee=X.properties.get("position"),ie=[-ee.x,-ee.y,ee.z],le=s.ad.mat3.create();X.properties.get("anchor")==="viewport"&&(s.ad.mat3.fromRotation(le,-v.transform.angle),s.ad.vec3.transformMat3(ie,ie,le));const _e=F.alphaMode==="MASK",pe=X.properties.get("color").toRenderColor(null),we=U.paint.get("model-ambient-occlusion-intensity"),ve=U.paint.get("model-color").constantOr(s.al.white).toRenderColor(null),xe=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:n,u_normal_matrix:a,u_node_matrix:p||Qd,u_lightpos:ie,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_camera_pos:q,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+_e,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[D[0],D[1],D[2],1],u_metallicFactor:L,u_roughnessFactor:z,u_baseColorTexture:Un.BaseColor,u_metallicRoughnessTexture:Un.MetallicRoughness,u_normalTexture:Un.Normal,u_occlusionTexture:Un.Occlusion,u_emissionTexture:Un.Emission,u_lutTexture:Un.LUT,u_color_mix:[ve.r,ve.g,ve.b,xe],u_aoIntensity:we,u_emissive_strength:V,u_occlusionTextureTransform:J||[0,0,0,0]}},Fy=(m,n=Qd,a=Qd)=>({u_matrix:m,u_instance:n,u_node_matrix:a}),bm={fillExtrusion:m=>({u_matrix:new s.bJ(m),u_lightpos:new s.bL(m),u_lightintensity:new s.bM(m),u_lightcolor:new s.bL(m),u_vertical_gradient:new s.bM(m),u_opacity:new s.bM(m),u_edge_radius:new s.bM(m),u_width_scale:new s.bM(m),u_ao:new s.bK(m),u_height_type:new s.bN(m),u_base_type:new s.bN(m),u_tile_id:new s.bL(m),u_zoom_transition:new s.bM(m),u_inv_rot_matrix:new s.bJ(m),u_merc_center:new s.bK(m),u_up_dir:new s.bL(m),u_height_lift:new s.bM(m),u_flood_light_color:new s.bL(m),u_vertical_scale:new s.bM(m),u_flood_light_intensity:new s.bM(m),u_ground_shadow_factor:new s.bL(m)}),fillExtrusionDepth:m=>({u_matrix:new s.bJ(m),u_edge_radius:new s.bM(m),u_width_scale:new s.bM(m),u_vertical_scale:new s.bM(m),u_height_type:new s.bN(m),u_base_type:new s.bN(m)}),fillExtrusionPattern:m=>({u_matrix:new s.bJ(m),u_lightpos:new s.bL(m),u_lightintensity:new s.bM(m),u_lightcolor:new s.bL(m),u_vertical_gradient:new s.bM(m),u_height_factor:new s.bM(m),u_edge_radius:new s.bM(m),u_width_scale:new s.bM(m),u_ao:new s.bK(m),u_height_type:new s.bN(m),u_base_type:new s.bN(m),u_tile_id:new s.bL(m),u_zoom_transition:new s.bM(m),u_inv_rot_matrix:new s.bJ(m),u_merc_center:new s.bK(m),u_up_dir:new s.bL(m),u_height_lift:new s.bM(m),u_image:new s.bN(m),u_texsize:new s.bK(m),u_pixel_coord_upper:new s.bK(m),u_pixel_coord_lower:new s.bK(m),u_tile_units_to_pixels:new s.bM(m),u_opacity:new s.bM(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new s.bJ(m),u_opacity:new s.bM(m),u_ao_pass:new s.bM(m),u_meter_to_tile:new s.bM(m),u_ao:new s.bK(m),u_flood_light_intensity:new s.bM(m),u_flood_light_color:new s.bL(m),u_attenuation:new s.bM(m),u_edge_radius:new s.bM(m),u_fb:new s.bN(m),u_fb_size:new s.bM(m),u_dynamic_offset:new s.bM(m)}),fill:m=>({u_matrix:new s.bJ(m),u_emissive_strength:new s.bM(m)}),fillPattern:m=>({u_matrix:new s.bJ(m),u_emissive_strength:new s.bM(m),u_image:new s.bN(m),u_texsize:new s.bK(m),u_pixel_coord_upper:new s.bK(m),u_pixel_coord_lower:new s.bK(m),u_tile_units_to_pixels:new s.bM(m)}),fillOutline:m=>({u_matrix:new s.bJ(m),u_emissive_strength:new s.bM(m),u_world:new s.bK(m)}),fillOutlinePattern:m=>({u_matrix:new s.bJ(m),u_emissive_strength:new s.bM(m),u_world:new s.bK(m),u_image:new s.bN(m),u_texsize:new s.bK(m),u_pixel_coord_upper:new s.bK(m),u_pixel_coord_lower:new s.bK(m),u_tile_units_to_pixels:new s.bM(m)}),elevatedStructures:m=>({u_matrix:new s.bJ(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new s.bJ(m),u_camera_pos:new s.bL(m),u_depth_bias:new s.bM(m),u_height_scale:new s.bM(m),u_reset_depth:new s.bM(m)}),circle:s.cT,collisionBox:m=>({u_matrix:new s.bJ(m),u_camera_to_center_distance:new s.bM(m),u_extrude_scale:new s.bK(m)}),collisionCircle:m=>({u_matrix:new s.bJ(m),u_inv_matrix:new s.bJ(m),u_camera_to_center_distance:new s.bM(m),u_viewport_size:new s.bK(m)}),debug:m=>({u_color:new s.cA(m),u_matrix:new s.bJ(m),u_overlay:new s.bN(m),u_overlay_scale:new s.bM(m)}),clippingMask:m=>({u_matrix:new s.bJ(m)}),heatmap:m=>({u_extrude_scale:new s.bM(m),u_intensity:new s.bM(m),u_matrix:new s.bJ(m),u_inv_rot_matrix:new s.bJ(m),u_merc_center:new s.bK(m),u_tile_id:new s.bL(m),u_zoom_transition:new s.bM(m),u_up_dir:new s.bL(m)}),heatmapTexture:m=>({u_image:new s.bN(m),u_color_ramp:new s.bN(m),u_opacity:new s.bM(m)}),hillshade:m=>({u_matrix:new s.bJ(m),u_image:new s.bN(m),u_latrange:new s.bK(m),u_light:new s.bK(m),u_shadow:new s.cA(m),u_highlight:new s.cA(m),u_emissive_strength:new s.bM(m),u_accent:new s.cA(m)}),hillshadePrepare:m=>({u_matrix:new s.bJ(m),u_image:new s.bN(m),u_dimension:new s.bK(m),u_zoom:new s.bM(m)}),line:s.cU,linePattern:s.cV,raster:m=>({u_matrix:new s.bJ(m),u_normalize_matrix:new s.bJ(m),u_globe_matrix:new s.bJ(m),u_merc_matrix:new s.bJ(m),u_grid_matrix:new s.cB(m),u_tl_parent:new s.bK(m),u_scale_parent:new s.bM(m),u_fade_t:new s.bM(m),u_opacity:new s.bM(m),u_image0:new s.bN(m),u_image1:new s.bN(m),u_brightness_low:new s.bM(m),u_brightness_high:new s.bM(m),u_saturation_factor:new s.bM(m),u_contrast_factor:new s.bM(m),u_spin_weights:new s.bL(m),u_perspective_transform:new s.bK(m),u_raster_elevation:new s.bM(m),u_zoom_transition:new s.bM(m),u_merc_center:new s.bK(m),u_cutoff_params:new s.cb(m),u_colorization_mix:new s.cb(m),u_colorization_offset:new s.bM(m),u_color_ramp:new s.bN(m),u_texture_offset:new s.bK(m),u_texture_res:new s.bK(m),u_emissive_strength:new s.bM(m)}),rasterParticle:m=>({u_matrix:new s.bJ(m),u_normalize_matrix:new s.bJ(m),u_globe_matrix:new s.bJ(m),u_merc_matrix:new s.bJ(m),u_grid_matrix:new s.cB(m),u_tl_parent:new s.bK(m),u_scale_parent:new s.bM(m),u_fade_t:new s.bM(m),u_opacity:new s.bM(m),u_image0:new s.bN(m),u_image1:new s.bN(m),u_raster_elevation:new s.bM(m),u_zoom_transition:new s.bM(m),u_merc_center:new s.bK(m),u_cutoff_params:new s.cb(m)}),rasterParticleTexture:m=>({u_texture:new s.bN(m),u_opacity:new s.bM(m)}),rasterParticleDraw:m=>({u_particle_texture:new s.bN(m),u_particle_texture_side_len:new s.bM(m),u_tile_offset:new s.bK(m),u_velocity:new s.bN(m),u_color_ramp:new s.bN(m),u_velocity_res:new s.bK(m),u_max_speed:new s.bM(m),u_uv_offset:new s.bK(m),u_data_scale:new s.bK(m),u_data_offset:new s.bM(m),u_particle_pos_scale:new s.bM(m),u_particle_pos_offset:new s.bK(m)}),rasterParticleUpdate:m=>({u_particle_texture:new s.bN(m),u_particle_texture_side_len:new s.bM(m),u_velocity:new s.bN(m),u_velocity_res:new s.bK(m),u_max_speed:new s.bM(m),u_speed_factor:new s.bM(m),u_reset_rate:new s.bM(m),u_rand_seed:new s.bM(m),u_uv_offset:new s.bK(m),u_data_scale:new s.bK(m),u_data_offset:new s.bM(m),u_particle_pos_scale:new s.bM(m),u_particle_pos_offset:new s.bK(m)}),symbol:m=>({u_is_size_zoom_constant:new s.bN(m),u_is_size_feature_constant:new s.bN(m),u_size_t:new s.bM(m),u_size:new s.bM(m),u_camera_to_center_distance:new s.bM(m),u_rotate_symbol:new s.bN(m),u_aspect_ratio:new s.bM(m),u_fade_change:new s.bM(m),u_matrix:new s.bJ(m),u_label_plane_matrix:new s.bJ(m),u_coord_matrix:new s.bJ(m),u_is_text:new s.bN(m),u_elevation_from_sea:new s.bN(m),u_pitch_with_map:new s.bN(m),u_texsize:new s.bK(m),u_texsize_icon:new s.bK(m),u_texture:new s.bN(m),u_texture_icon:new s.bN(m),u_gamma_scale:new s.bM(m),u_device_pixel_ratio:new s.bM(m),u_tile_id:new s.bL(m),u_zoom_transition:new s.bM(m),u_inv_rot_matrix:new s.bJ(m),u_merc_center:new s.bK(m),u_camera_forward:new s.bL(m),u_tile_matrix:new s.bJ(m),u_up_vector:new s.bL(m),u_ecef_origin:new s.bL(m),u_is_halo:new s.bN(m),u_icon_transition:new s.bM(m),u_color_adj_mat:new s.bJ(m),u_scale_factor:new s.bM(m)}),background:m=>({u_matrix:new s.bJ(m),u_emissive_strength:new s.bM(m),u_opacity:new s.bM(m),u_color:new s.cA(m)}),backgroundPattern:m=>({u_matrix:new s.bJ(m),u_emissive_strength:new s.bM(m),u_opacity:new s.bM(m),u_image:new s.bN(m),u_pattern_tl:new s.bK(m),u_pattern_br:new s.bK(m),u_texsize:new s.bK(m),u_pattern_size:new s.bK(m),u_pixel_coord_upper:new s.bK(m),u_pixel_coord_lower:new s.bK(m),u_pattern_units_to_pixels:new s.bK(m)}),terrainRaster:m=>({u_matrix:new s.bJ(m),u_image0:new s.bN(m),u_skirt_height:new s.bM(m),u_ground_shadow_factor:new s.bL(m)}),skybox:m=>({u_matrix:new s.bJ(m),u_sun_direction:new s.bL(m),u_cubemap:new s.bN(m),u_opacity:new s.bM(m),u_temporal_offset:new s.bM(m)}),skyboxGradient:m=>({u_matrix:new s.bJ(m),u_color_ramp:new s.bN(m),u_center_direction:new s.bL(m),u_radius:new s.bM(m),u_opacity:new s.bM(m),u_temporal_offset:new s.bM(m)}),skyboxCapture:m=>({u_matrix_3f:new s.cB(m),u_sun_direction:new s.bL(m),u_sun_intensity:new s.bM(m),u_color_tint_r:new s.cb(m),u_color_tint_m:new s.cb(m),u_luminance:new s.bM(m)}),globeRaster:m=>({u_proj_matrix:new s.bJ(m),u_globe_matrix:new s.bJ(m),u_normalize_matrix:new s.bJ(m),u_merc_matrix:new s.bJ(m),u_zoom_transition:new s.bM(m),u_merc_center:new s.bK(m),u_image0:new s.bN(m),u_grid_matrix:new s.cB(m),u_skirt_height:new s.bM(m),u_far_z_cutoff:new s.bM(m),u_frustum_tl:new s.bL(m),u_frustum_tr:new s.bL(m),u_frustum_br:new s.bL(m),u_frustum_bl:new s.bL(m),u_globe_pos:new s.bL(m),u_globe_radius:new s.bM(m),u_viewport:new s.bK(m)}),globeAtmosphere:m=>({u_frustum_tl:new s.bL(m),u_frustum_tr:new s.bL(m),u_frustum_br:new s.bL(m),u_frustum_bl:new s.bL(m),u_horizon:new s.bM(m),u_transition:new s.bM(m),u_fadeout_range:new s.bM(m),u_color:new s.cb(m),u_high_color:new s.cb(m),u_space_color:new s.cb(m),u_temporal_offset:new s.bM(m),u_horizon_angle:new s.bM(m)}),model:m=>({u_matrix:new s.bJ(m),u_lighting_matrix:new s.bJ(m),u_normal_matrix:new s.bJ(m),u_node_matrix:new s.bJ(m),u_lightpos:new s.bL(m),u_lightintensity:new s.bM(m),u_lightcolor:new s.bL(m),u_camera_pos:new s.bL(m),u_opacity:new s.bM(m),u_baseColorFactor:new s.cb(m),u_emissiveFactor:new s.cb(m),u_metallicFactor:new s.bM(m),u_roughnessFactor:new s.bM(m),u_baseTextureIsAlpha:new s.bN(m),u_alphaMask:new s.bN(m),u_alphaCutoff:new s.bM(m),u_baseColorTexture:new s.bN(m),u_metallicRoughnessTexture:new s.bN(m),u_normalTexture:new s.bN(m),u_occlusionTexture:new s.bN(m),u_emissionTexture:new s.bN(m),u_lutTexture:new s.bN(m),u_color_mix:new s.cb(m),u_aoIntensity:new s.bM(m),u_emissive_strength:new s.bM(m),u_occlusionTextureTransform:new s.cb(m)}),modelDepth:m=>({u_matrix:new s.bJ(m),u_instance:new s.bJ(m),u_node_matrix:new s.bJ(m)}),groundShadow:m=>({u_matrix:new s.bJ(m),u_ground_shadow_factor:new s.bL(m)}),stars:m=>({u_matrix:new s.bJ(m),u_up:new s.bL(m),u_right:new s.bL(m),u_intensity_multiplier:new s.bM(m)}),snowParticle:m=>({u_modelview:new s.bJ(m),u_projection:new s.bJ(m),u_time:new s.bM(m),u_cam_pos:new s.bL(m),u_velocityConeAperture:new s.bM(m),u_velocity:new s.bM(m),u_horizontalOscillationRadius:new s.bM(m),u_horizontalOscillationRate:new s.bM(m),u_boxSize:new s.bM(m),u_billboardSize:new s.bM(m),u_simpleShapeParameters:new s.bK(m),u_screenSize:new s.bK(m),u_thinningCenterPos:new s.bK(m),u_thinningShape:new s.bL(m),u_thinningAffectedRatio:new s.bM(m),u_thinningParticleOffset:new s.bM(m),u_particleColor:new s.cb(m),u_direction:new s.bL(m)}),rainParticle:m=>({u_modelview:new s.bJ(m),u_projection:new s.bJ(m),u_time:new s.bM(m),u_cam_pos:new s.bL(m),u_texScreen:new s.bN(m),u_velocityConeAperture:new s.bM(m),u_velocity:new s.bM(m),u_boxSize:new s.bM(m),u_rainDropletSize:new s.bK(m),u_distortionStrength:new s.bM(m),u_rainDirection:new s.bL(m),u_color:new s.cb(m),u_screenSize:new s.bK(m),u_thinningCenterPos:new s.bK(m),u_thinningShape:new s.bL(m),u_thinningAffectedRatio:new s.bM(m),u_thinningParticleOffset:new s.bM(m),u_shapeDirectionalPower:new s.bM(m),u_shapeNormalPower:new s.bM(m),u_mode:new s.bM(m)}),vignette:m=>({u_vignetteShape:new s.bL(m),u_vignetteColor:new s.cb(m)}),occlusion:m=>({u_matrix:new s.bJ(m),u_anchorPos:new s.bL(m),u_screenSizePx:new s.bK(m),u_occluderSizePx:new s.bK(m),u_color:new s.cb(m)})};class qo{constructor(n,a,p,v){this.id=qo.uniqueIdxCounter,qo.uniqueIdxCounter++,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||v||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=qo.uniqueIdxCounter,qo.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}qo.uniqueIdxCounter=0;const wm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Tm{constructor(n,a,p,v,b,T){this.length=a.length,this.attributes=p,this.itemSize=a.bytesPerElement,this.dynamicDraw=v,this.instanceCount=T,this.context=n;const D=n.gl;this.buffer=D.createBuffer(),n.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||b||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let p=0;p<this.attributes.length;p++){const v=a.attributes[this.attributes[p].name];v!==void 0&&n.enableVertexAttribArray(v)}}setVertexAttribPointers(n,a,p){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],T=a.attributes[b.name];T!==void 0&&n.vertexAttribPointer(T,b.components,n[wm[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,a,p){for(let v=0;v<this.attributes.length;v++){const b=a.attributes[this.attributes[v].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class mr{constructor(n,a,p,v,b){this.context=n,this.width=a,this.height=p;const T=this.framebuffer=n.gl.createFramebuffer();v&&(this.colorAttachment=new om(n,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new am(n,T):new Pc(n,T))}destroy(){const n=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&n.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&n.deleteTexture(a)}n.deleteFramebuffer(this.framebuffer)}}class Ka{constructor(n,a){this.gl=n,this.clearColor=new ib(this),this.clearDepth=new Yp(this),this.clearStencil=new Kp(this),this.colorMask=new Jp(this),this.depthMask=new Qp(this),this.stencilMask=new wy(this),this.stencilFunc=new Ty(this),this.stencilOp=new nb(this),this.stencilTest=new ah(this),this.depthRange=new lh(this),this.depthTest=new Ey(this),this.depthFunc=new jr(this),this.blend=new em(this),this.blendFunc=new Vd(this),this.blendColor=new Ud(this),this.blendEquation=new tm(this),this.cullFace=new im(this),this.cullFaceSide=new nm(this),this.frontFace=new jd(this),this.program=new sm(this),this.activeTexture=new rm(this),this.viewport=new $d(this),this.bindFramebuffer=new Sy(this),this.bindRenderbuffer=new Ay(this),this.bindTexture=new Cc(this),this.bindVertexBuffer=new sb(this),this.bindElementBuffer=new rb(this),this.bindVertexArrayOES=new ob(this),this.pixelStoreUnpack=new ab(this),this.pixelStoreUnpackPremultiplyAlpha=new lb(this),this.pixelStoreUnpackFlipY=new cb(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a,p){return new qo(this,n,a,p)}createVertexBuffer(n,a,p,v,b){return new Tm(this,n,a,p,v,b)}createRenderbuffer(n,a,p){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,n,a,p),this.bindRenderbuffer.set(null),b}createFramebuffer(n,a,p,v){return new mr(this,n,a,p,v)}clear({color:n,depth:a,stencil:p,colorMask:v}){const b=this.gl;let T=0;n&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(v||[!0,!0,!0,!0])),a!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),p!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(T)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){s.bn(n.blendFunction,Mi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let dh;function ef(m,n,a,p,v,b,T){const D=m.context,L=D.gl,z=m.transform,F=m.getOrCreateProgram("collisionBox"),V=[];let U=0,q=0;for(let pe=0;pe<p.length;pe++){const we=p[pe],ve=n.getTile(we),xe=ve.getBucket(a);if(!xe)continue;const be=Up(we,xe,z);let Ce=be;v[0]===0&&v[1]===0||(Ce=m.translatePosMatrix(be,ve,v,b));const Re=T?xe.textCollisionBox:xe.iconCollisionBox,Je=xe.collisionCircleArray;if(Je.length>0){const $e=s.ad.mat4.create(),ct=Ce;s.ad.mat4.mul($e,xe.placementInvProjMatrix,z.glCoordMatrix),s.ad.mat4.mul($e,$e,xe.placementViewportMatrix),V.push({circleArray:Je,circleOffset:q,transform:ct,invTransform:$e,projection:xe.getProjection()}),U+=Je.length/4,q=U}Re&&(m.terrain&&m.terrain.setupElevationDraw(ve,F),F.draw(m,L.LINES,Jt.disabled,gi.disabled,m.colorModeForRenderPass(),fi.disabled,Ly(Ce,z,ve,xe.getProjection()),a.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,z.zoom,null,[Re.collisionVertexBuffer,Re.collisionVertexBufferExt]))}if(!T||!V.length)return;const J=m.getOrCreateProgram("collisionCircle"),X=new s.cW;X.resize(4*U),X._trim();let ee=0;for(const pe of V)for(let we=0;we<pe.circleArray.length/4;we++){const ve=4*we,xe=pe.circleArray[ve+0],be=pe.circleArray[ve+1],Ce=pe.circleArray[ve+2],Re=pe.circleArray[ve+3];X.emplace(ee++,xe,be,Ce,Re,0),X.emplace(ee++,xe,be,Ce,Re,1),X.emplace(ee++,xe,be,Ce,Re,2),X.emplace(ee++,xe,be,Ce,Re,3)}(!dh||dh.length<2*U)&&(dh=function(pe){const we=2*pe,ve=new s.aV;ve.resize(we),ve._trim();for(let xe=0;xe<we;xe++){const be=6*xe;ve.uint16[be+0]=4*xe+0,ve.uint16[be+1]=4*xe+1,ve.uint16[be+2]=4*xe+2,ve.uint16[be+3]=4*xe+2,ve.uint16[be+4]=4*xe+3,ve.uint16[be+5]=4*xe+0}return ve}(U));const ie=D.createIndexBuffer(dh,!0),le=D.createVertexBuffer(X,s.cX.members,!0);for(const pe of V){const we={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(_e=z).getCameraToCenterDistance(pe.projection),u_viewport_size:[_e.width,_e.height]};J.draw(m,L.TRIANGLES,Jt.disabled,gi.disabled,m.colorModeForRenderPass(),fi.disabled,we,a.id,le,ie,s.b8.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,z.zoom)}var _e;le.destroy(),ie.destroy()}const kc=s.ad.mat4.create();function tf(m){const n=m._camera.getWorldToCamera(m.worldSize,1),a=s.ad.mat4.multiply([],n,m.globeMatrix);s.ad.mat4.invert(a,a);const p=[0,0,0],v=[0,1,0,0];return s.ad.vec4.transformMat4(v,v,a),p[0]=v[0],p[1]=v[1],p[2]=v[2],s.ad.vec3.normalize(p,p),p}function By({width:m,height:n,anchor:a,textOffset:p,textScale:v},b){const{horizontalAlign:T,verticalAlign:D}=s.bD(a),L=-(T-.5)*m,z=-(D-.5)*n,F=s.bC(a,p);return new s.P((L/v+F[0])*b,(z/v+F[1])*b)}function oo(m,n,a,p,v,b,T,D,L,z,F){const V=m.text.placedSymbolArray,U=m.text.dynamicLayoutVertexArray,q=m.icon.dynamicLayoutVertexArray,J={},X=m.getProjection(),ee=Ur(D,X,b),ie=b.elevation,le=X.upVectorScale(D.canonical,b.center.lat,b.worldSize).metersToTile;U.clear();for(let _e=0;_e<V.length;_e++){const pe=V.get(_e),{tileAnchorX:we,tileAnchorY:ve,numGlyphs:xe}=pe,be=pe.hidden||!pe.crossTileID||m.allowVerticalPlacement&&!pe.placedOrientation?null:p[pe.crossTileID];if(be){let Ce=0,Re=0,Je=0;if(ie){const st=ie?ie.getAtTileOffset(D,we,ve):0,[ht,Qe,ft]=X.upVector(D.canonical,we,ve);Ce=st*ht*le,Re=st*Qe*le,Je=st*ft*le}let[$e,ct,ut,vt]=To(pe.projectedAnchorX+Ce,pe.projectedAnchorY+Re,pe.projectedAnchorZ+Je,a?ee:T);const je=_c(b.getCameraToCenterDistance(X),vt);let at=v.evaluateSizeForFeature(m.textSizeData,z,pe)*je/s.bw;a&&(at*=m.tilePixelRatio/L);const Ne=By(be,at);a?({x:$e,y:ct,z:ut}=X.projectTilePoint(we+Ne.x,ve+Ne.y,D.canonical),[$e,ct,ut]=To($e+Ce,ct+Re,ut+Je,T)):(n&&Ne._rotate(-b.angle),$e+=Ne.x,ct+=Ne.y,ut=0);const ot=m.allowVerticalPlacement&&pe.placedOrientation===s.bq.vertical?Math.PI/2:0;for(let st=0;st<xe;st++)s.bt(U,$e,ct,ut,ot);F&&pe.associatedIconIndex>=0&&(J[pe.associatedIconIndex]={x:$e,y:ct,z:ut,angle:ot})}else Eo(xe,U)}if(F){q.clear();const _e=m.icon.placedSymbolArray;for(let pe=0;pe<_e.length;pe++){const we=_e.get(pe),{numGlyphs:ve}=we,xe=J[pe];if(we.hidden||!xe)Eo(ve,q);else{const{x:be,y:Ce,z:Re,angle:Je}=xe;for(let $e=0;$e<ve;$e++)s.bt(q,be,Ce,Re,Je)}}m.icon.dynamicLayoutVertexBuffer.updateData(q)}m.text.dynamicLayoutVertexBuffer.updateData(U)}function fn(m,n,a,p,v,b,T={}){const D=a.paint.get("icon-translate"),L=a.paint.get("text-translate"),z=a.paint.get("icon-translate-anchor"),F=a.paint.get("text-translate-anchor"),V=a.layout.get("icon-rotation-alignment"),U=a.layout.get("text-rotation-alignment"),q=a.layout.get("icon-pitch-alignment"),J=a.layout.get("text-pitch-alignment"),X=a.layout.get("icon-keep-upright"),ee=a.layout.get("text-keep-upright"),ie=a.paint.get("icon-color-saturation"),le=a.paint.get("icon-color-contrast"),_e=a.paint.get("icon-color-brightness-min"),pe=a.paint.get("icon-color-brightness-max"),we=a.layout.get("symbol-elevation-reference")==="sea",ve=m.context,xe=ve.gl,be=m.transform,Ce=V==="map",Re=U==="map",Je=q==="map",$e=J==="map",ct=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ut=!1;const vt=m.depthModeForSublayer(0,Jt.ReadOnly),je=[s.av(be.center.lng),s.aC(be.center.lat)],at=a.layout.get("text-variable-anchor"),Ne=be.projection.name==="globe",ot=[],st=[0,-1,0];for(const ht of p){const Qe=n.getTile(ht),ft=Qe.getBucket(a);if(!ft||ft.projection.name==="mercator"&&Ne||ft.fullyClipped)continue;const Ct=ft.projection.name==="globe",Pt=Ct?s.ag(be.zoom):0,Dt=Ur(ht,ft.getProjection(),be),$t=be.calculatePixelsToTileUnitsMatrix(Qe),pi=at&&ft.hasTextData(),ti=ft.hasIconTextFit()&&pi&&ft.hasIconData(),hi=ft.getProjection().createInversionMatrix(be,ht.canonical),oi=en=>{be.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||m.terrain)&&(en.push("DEPTH_D24"),en.push("DEPTH_OCCLUSION"))},Di=()=>{const en=Ce&&a.layout.get("symbol-placement")!=="point",Vi=[];oi(Vi);const Nn=en||ti,Jn=a.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&Je&&Vi.push("PITCH_WITH_MAP_TERRAIN"),Ct&&(Vi.push("PROJECTION_GLOBE_VIEW"),Nn&&Vi.push("PROJECTED_POS_ON_VIEWPORT")),Jn>0&&Vi.push("ICON_TRANSITION"),ft.icon.zOffsetVertexBuffer&&Vi.push("Z_OFFSET"),ie===0&&le===0&&_e===0&&pe===1||Vi.push("COLOR_ADJUSTMENT"),ft.sdfIcons&&Vi.push("RENDER_SDF");const fs=ft.icon.programConfigurations.get(a.id),xs=m.getOrCreateProgram("symbol",{config:fs,defines:Vi}),qr=Qe.imageAtlasTexture?Qe.imageAtlasTexture.size:[0,0],Js=ft.iconSizeData,zi=s.bp(Js,be.zoom),Cn=Je||be.pitch!==0,Zi=da(Dt,Qe.tileID.canonical,Je,Ce,be,ft.getProjection(),$t),hn=qn(Dt,Qe.tileID.canonical,Je,Ce,be,ft.getProjection(),$t),Os=m.translatePosMatrix(hn,Qe,D,z,!0),Tn=m.translatePosMatrix(Dt,Qe,D,z),ps=Nn?kc:Zi,Xo=Ce&&!Je&&!en;let Sr=st;!Ne&&!be.mercatorFromTransition||Ce||(Sr=tf(be));const co=Ct?Sr:st,gr=a.getColorAdjustmentMatrix(ie,le,_e,pe),uo=Jd(Js.kind,zi,Xo,Je,m,Tn,ps,Os,we,!1,qr,[0,0],!0,ht,Pt,je,hi,co,ft.getProjection(),gr,Jn),Ar=Qe.imageAtlasTexture?Qe.imageAtlasTexture:null,Sa=a.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear,Yo=ft.sdfIcons||m.options.rotating||m.options.zooming||Sa||Cn?xe.LINEAR:xe.NEAREST,Aa=ft.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Xm=m.terrain&&Je&&en?s.ad.mat4.invert(s.ad.mat4.create(),Zi):kc;if(en&&ft.icon){const Xc=be.elevation,xf=Xc?Xc.getAtTileOffsetFunc(ht,be.center.lat,be.worldSize,ft.getProjection()):null,Ym=Vs(Dt,Qe.tileID.canonical,Je,Ce,be,ft.getProjection(),$t);yc(ft,Dt,m,!1,Ym,hn,Je,X,xf,ht)}return{program:xs,buffers:ft.icon,uniformValues:uo,atlasTexture:Ar,atlasTextureIcon:null,atlasInterpolation:Yo,atlasInterpolationIcon:null,isSDF:ft.sdfIcons,hasHalo:Aa,tile:Qe,labelPlaneMatrixInv:Xm}},Wi=()=>{const en=Re&&a.layout.get("symbol-placement")!=="point",Vi=[],Nn=en||at||ti;m.terrainRenderModeElevated()&&$e&&Vi.push("PITCH_WITH_MAP_TERRAIN"),Ct&&(Vi.push("PROJECTION_GLOBE_VIEW"),Nn&&Vi.push("PROJECTED_POS_ON_VIEWPORT")),ft.text.zOffsetVertexBuffer&&Vi.push("Z_OFFSET"),ft.iconsInText&&Vi.push("RENDER_TEXT_AND_SYMBOL"),Vi.push("RENDER_SDF"),oi(Vi);const Jn=ft.text.programConfigurations.get(a.id),fs=m.getOrCreateProgram("symbol",{config:Jn,defines:Vi});let xs,qr=[0,0],Js=null;const zi=ft.textSizeData;ft.iconsInText&&(qr=Qe.imageAtlasTexture?Qe.imageAtlasTexture.size:[0,0],Js=Qe.imageAtlasTexture?Qe.imageAtlasTexture:null,xs=$e||be.pitch!==0||m.options.rotating||m.options.zooming||zi.kind==="composite"||zi.kind==="camera"?xe.LINEAR:xe.NEAREST);const Cn=Qe.glyphAtlasTexture?Qe.glyphAtlasTexture.size:[0,0],Zi=a.layout.get("text-size-scale-range"),hn=s.ay(m.scaleFactor,Zi[0],Zi[1]),Os=s.bp(zi,be.zoom,hn),Tn=da(Dt,Qe.tileID.canonical,$e,Re,be,ft.getProjection(),$t),ps=qn(Dt,Qe.tileID.canonical,$e,Re,be,ft.getProjection(),$t),Xo=m.translatePosMatrix(ps,Qe,L,F,!0),Sr=m.translatePosMatrix(Dt,Qe,L,F),co=Nn?kc:Tn,gr=Re&&!$e&&!en;let uo=st;!Ne&&!be.mercatorFromTransition||Re||(uo=tf(be));const Ar=Jd(zi.kind,Os,gr,$e,m,Sr,co,Xo,we,!0,Cn,qr,!0,ht,Pt,je,hi,Ct?uo:st,ft.getProjection(),null,null,hn),Sa=Qe.glyphAtlasTexture?Qe.glyphAtlasTexture:null,Yo=xe.LINEAR,Aa=a.paint.get("text-halo-width").constantOr(1)!==0,Xm=m.terrain&&$e&&en?s.ad.mat4.invert(s.ad.mat4.create(),Tn):kc;if(en&&ft.text){const Xc=be.elevation,xf=Xc?Xc.getAtTileOffsetFunc(ht,be.center.lat,be.worldSize,ft.getProjection()):null,Ym=Vs(Dt,Qe.tileID.canonical,$e,Re,be,ft.getProjection(),$t);yc(ft,Dt,m,!0,Ym,ps,$e,ee,xf,ht)}return{program:fs,buffers:ft.text,uniformValues:Ar,atlasTexture:Sa,atlasTextureIcon:Js,atlasInterpolation:Yo,atlasInterpolationIcon:xs,isSDF:!0,hasHalo:Aa,tile:Qe,labelPlaneMatrixInv:Xm}},mn=ft.icon.segments.get().length,Si=ft.text.segments.get().length,In=mn&&!T.onlyText?Di():null,_i=Si&&!T.onlyIcons?Wi():null,Ht=a.paint.get("icon-opacity").constantOr(1),Li=a.paint.get("text-opacity").constantOr(1);if(ct&&ft.canOverlap){ut=!0;const en=Ht&&!T.onlyText?ft.icon.segments.get():[],Vi=Li&&!T.onlyIcons?ft.text.segments.get():[];for(const Nn of en)ot.push({segments:new s.b8([Nn]),sortKey:Nn.sortKey,state:In});for(const Nn of Vi)ot.push({segments:new s.b8([Nn]),sortKey:Nn.sortKey,state:_i})}else T.onlyText||ot.push({segments:Ht?ft.icon.segments:new s.b8([]),sortKey:0,state:In}),T.onlyIcons||ot.push({segments:Li?ft.text.segments:new s.b8([]),sortKey:0,state:_i})}ut&&ot.sort((ht,Qe)=>ht.sortKey-Qe.sortKey);for(const ht of ot){const Qe=ht.state;if(Qe)if(m.terrain?m.terrain.setupElevationDraw(Qe.tile,Qe.program,{useDepthForOcclusion:be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Qe.labelPlaneMatrixInv}):m.setupDepthForOcclusion(be.depthOcclusionForSymbolsAndCircles,Qe.program),ve.activeTexture.set(xe.TEXTURE0),Qe.atlasTexture&&Qe.atlasTexture.bind(Qe.atlasInterpolation,xe.CLAMP_TO_EDGE,!0),Qe.atlasTextureIcon&&(ve.activeTexture.set(xe.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,xe.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,Qe.program),Qe.hasHalo){const ft=Qe.uniformValues;ft.u_is_halo=1,zc(Qe.buffers,ht.segments,a,m,Qe.program,vt,v,b,ft,2),ft.u_is_halo=0}else{if(Qe.isSDF){const ft=Qe.uniformValues;Qe.hasHalo&&(ft.u_is_halo=1,zc(Qe.buffers,ht.segments,a,m,Qe.program,vt,v,b,ft,1)),ft.u_is_halo=0}zc(Qe.buffers,ht.segments,a,m,Qe.program,vt,v,b,Qe.uniformValues,1)}}}function zc(m,n,a,p,v,b,T,D,L,z){const F=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];v.draw(p,p.context.gl.TRIANGLES,b,T,D,fi.disabled,L,a.id,m.layoutVertexBuffer,m.indexBuffer,n,a.paint,p.transform.zoom,m.programConfigurations.get(a.id),F,z)}function Em(m,n){const a=1<<m.canonical.z,p=(n.x*a-m.canonical.x-m.wrap*a)*s.ai,v=(n.y*a-m.canonical.y)*s.ai,b=s.d5(n.z,n.y);return s.ad.vec3.fromValues(p,v,b)}function Sm(m,n,a,p,v){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const b=m.context.gl,T=new Jt(m.context.gl.LEQUAL,Jt.ReadWrite,m.depthRangeFor3D),D=new Jt(m.context.gl.GREATER,Jt.ReadWrite,m.depthRangeFor3D),L=function(q){const J=s.c4(q.pitch);let X=.01;return q.isOrthographic&&(X=s.ah(1e-4,X,s.c9(J>=St?1:J/St))),2*X}(m.transform),z=m.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",V=m.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),U=m.getOrCreateProgram(F);for(const q of p){const J=n.getTile(q),X=J.getBucket(a);if(!X)continue;const ee=X.elevatedStructures;if(!ee)continue;const ie=X.elevationBufferData.heightRange,le=Em(q.toUnwrapped(),z),_e=m.translatePosMatrix(q.projMatrix,J,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let pe,we,ve,xe;if(v==="initialize"){if(!ie||ie.min>=1||ee.depthSegments.segments[0].primitiveLength===0)continue;pe=hh(_e,le,L,1,0),we=T,ve=ee.depthSegments,xe=V}else if(v==="reset"){if(!ie||ie.min>=0||ee.maskSegments.segments[0].primitiveLength===0)continue;pe=hh(_e,le,0,0,1),we=D,ve=ee.maskSegments,xe=V}else if(v==="geometry"){if(ee.depthSegments.segments[0].primitiveLength===0)continue;pe=hh(_e,le,L,1,0),we=T,ve=ee.depthSegments,xe=U}xe.draw(m,b.TRIANGLES,we,gi.disabled,Mi.disabled,fi.disabled,pe,a.id,ee.vertexBuffer,ee.indexBuffer,ve,a.paint,m.transform.zoom)}}function nf(m,n,a){const{painter:p,sourceCache:v,layer:b,coords:T,colorMode:D,elevationType:L,terrainEnabled:z,pass:F}=m,V=p.context.gl,U=b.paint.get("fill-pattern");let q=L;L!=="road"||n&&!z||(q="none");const J=q==="road",X=new Jt(p.context.gl.LEQUAL,Jt.ReadWrite,p.depthRangeFor3D),ee=U&&U.constantOr(1),ie=(le,_e)=>{let pe,we,ve,xe,be;_e?(we=ee&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",pe=V.LINES):(we=ee?"fillPattern":"fill",pe=V.TRIANGLES);for(const Ce of T){const Re=v.getTile(Ce);if(ee&&!Re.patternsLoaded())continue;const Je=Re.getBucket(b);if(!Je)continue;const $e=n?Je.elevationBufferData:Je.bufferData;if($e.isEmpty())continue;p.prepareDrawTile();const ct=$e.programConfigurations.get(b.id),ut=p.isTileAffectedByFog(Ce),vt=[],je=[];J&&(vt.push("ELEVATED_ROADS"),je.push($e.elevatedLayoutVertexBuffer));const at=p.getOrCreateProgram(we,{config:ct,overrideFog:ut,defines:vt});ee&&(p.context.activeTexture.set(V.TEXTURE0),Re.imageAtlasTexture&&Re.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ct.updatePaintBuffers());const Ne=U.constantOr(null);if(Ne&&Re.imageAtlas){const ht=Re.imageAtlas,Qe=s.d0.from(Ne).getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),ft=ht.patternPositions.get(Qe);ft&&ct.setConstantPatternPositions(ft)}const ot=p.translatePosMatrix(Ce.projMatrix,Re,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor")),st=b.paint.get("fill-emissive-strength");if(_e){xe=$e.lineIndexBuffer,be=$e.lineSegments;const ht=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[V.drawingBufferWidth,V.drawingBufferHeight];ve=we==="fillOutlinePattern"&&ee?Yd(ot,st,p,Re,ht):Xd(ot,st,ht)}else xe=$e.indexBuffer,be=$e.triangleSegments,ve=ee?mm(ot,st,p,Re):Lc(ot,st);p.uploadCommonUniforms(p.context,at,Ce.toUnwrapped()),at.draw(p,pe,q!=="none"?X:le,a||p.stencilModeForClipping(Ce),D,fi.disabled,ve,b.id,$e.layoutVertexBuffer,xe,be,b.paint,p.transform.zoom,ct,je)}};p.renderPass===F&&ie(p.depthModeForSublayer(1,p.renderPass==="opaque"?Jt.ReadWrite:Jt.ReadOnly),!1),q==="none"&&p.renderPass==="translucent"&&b.paint.get("fill-antialias")&&ie(p.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Jt.ReadOnly),!0)}function fh(m,n,a,p,v,b,T,D){a.resetLayerRenderingStats(m);const L=m.context,z=L.gl,F=m.transform,V=a.paint.get("fill-extrusion-pattern"),U=V.constantOr(1),q=a.paint.get("fill-extrusion-opacity"),J=m.style.enable3dLights(),X=a.paint.get(J&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],ie=a.layout.get("fill-extrusion-edge-radius"),le=ie>0&&!a.paint.get("fill-extrusion-rounded-roof"),_e=le?0:ie,pe=F.projection.name==="globe"?s.d6():0,we=F.projection.name==="globe",ve=we?s.ag(F.zoom):0,xe=[s.av(F.center.lng),s.aC(F.center.lat)],be=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ce=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(be?null:a.lut).toArray01().slice(0,3),Re=a.paint.get("fill-extrusion-flood-light-intensity"),Je=a.paint.get("fill-extrusion-vertical-scale"),$e=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ct=a.paint.get("fill-extrusion-height-alignment"),ut=a.paint.get("fill-extrusion-base-alignment"),vt=_a(m,a.paint.get("fill-extrusion-cutoff-fade-range")),je=[];let at;we&&je.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&je.push("FAUX_AO"),le&&je.push("ZERO_ROOF_RADIUS"),D&&je.push("HAS_CENTROID"),Re>0&&je.push("FLOOD_LIGHT"),vt.shouldRenderCutoff&&je.push("RENDER_CUTOFF"),$e&&je.push("RENDER_WALL_MODE");const Ne=m.renderPass==="shadow",ot=m.shadowRenderer,st=Ne&&!!ot;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let ht=[0,0,0];if(ot){const Ct=m.style.directionalLight,Pt=m.style.ambientLight;Ct&&Pt&&(ht=Ec(m.style,Ct,Pt)),Ne||(je.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ot.useNormalOffset&&je.push("NORMAL_OFFSET")),at=je.concat(["SHADOWS_SINGLE_CASCADE"])}const Qe=st?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",ft=a.getLayerRenderingStats();for(const Ct of p){const Pt=n.getTile(Ct),Dt=Pt.getBucket(a);if(!Dt||Dt.projection.name!==F.projection.name)continue;let $t=!1;ot&&($t=ot.getMaxCascadeForTile(Ct.toUnwrapped())===0);const pi=m.isTileAffectedByFog(Ct),ti=Dt.programConfigurations.get(a.id),hi=m.getOrCreateProgram(Qe,{config:ti,defines:$t?at:je,overrideFog:pi});if(m.terrain&&m.terrain.setupElevationDraw(Pt,hi,{useMeterToDem:!0}),!Dt.centroidVertexBuffer){const _i=hi.attributes.a_centroid_pos;_i!==void 0&&z.vertexAttrib2f(_i,0,0)}!Ne&&ot&&ot.setupShadows(Pt.tileID.toUnwrapped(),hi,"vector-tile",Pt.tileID.overscaledZ),U&&(m.context.activeTexture.set(z.TEXTURE0),Pt.imageAtlasTexture&&Pt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ti.updatePaintBuffers());const oi=V.constantOr(null);if(oi&&Pt.imageAtlas){const _i=Pt.imageAtlas,Ht=s.d0.from(oi).getPrimary().scaleSelf(s.q.devicePixelRatio),Li=_i.patternPositions.get(Ht.toString());Li&&ti.setConstantPatternPositions(Li)}const Di=a.paint.get("fill-extrusion-vertical-gradient"),Wi=1/Dt.tileToMeter;let mn;if(Ne&&ot){if(Vc(Pt.tileID,Dt,m))continue;const _i=ot.calculateShadowPassMatrixFromTile(Pt.tileID.toUnwrapped());mn=Rc(_i,_e,Wi,Je,ct,ut)}else{const _i=m.translatePosMatrix(Ct.expandedProjMatrix,Pt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ht=F.projection.createInversionMatrix(F,Ct.canonical);mn=U?pm(_i,m,Di,q,ee,_e,Wi,Ct,Pt,pe,ct,ut,ve,xe,Ht,Ce,Je):Zd(_i,m,Di,q,ee,_e,Wi,Ct,pe,ct,ut,ve,xe,Ht,Ce,Je,Re,ht)}m.uploadCommonUniforms(L,hi,Ct.toUnwrapped(),null,vt);let Si=Dt.segments;if(F.projection.name==="mercator"&&!Ne&&(Si=Dt.getVisibleSegments(Pt.tileID,m.terrain,m.transform.getFrustum(0)),!Si.get().length))continue;if(ft)if(Ne)for(const _i of Si.get())ft.numRenderedVerticesInShadowPass+=_i.primitiveLength;else for(const _i of Si.get())ft.numRenderedVerticesInTransparentPass+=_i.primitiveLength;const In=[];(m.terrain||D)&&In.push(Dt.centroidVertexBuffer),we&&In.push(Dt.layoutVertexExtBuffer),$e&&In.push(Dt.wallVertexBuffer),hi.draw(m,L.gl.TRIANGLES,v,b,T,fi.backCCW,mn,a.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Si,a.paint,m.transform.zoom,ti,In)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function Fc(m,n,a,p,v,b,T,D,L,z,F,V,U,q,J,X,ee,ie,le){const _e=m.context,pe=_e.gl,we=m.transform,ve=m.transform.zoom,xe=[],be=_a(m,a.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(xe.push("CLEAR_SUBPASS"),le&&(xe.push("CLEAR_FROM_TEXTURE"),_e.activeTexture.set(pe.TEXTURE0),le.bind(pe.LINEAR,pe.CLAMP_TO_EDGE))):z==="sdf"&&xe.push("SDF_SUBPASS"),ee&&xe.push("HAS_CENTROID"),be.shouldRenderCutoff&&xe.push("RENDER_CUTOFF");const Ce=a.layout.get("fill-extrusion-edge-radius"),Re=(Je,$e,ct,ut,vt)=>{const je=$e.programConfigurations.get(a.id),at=m.isTileAffectedByFog(Je),Ne=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:je,defines:xe,overrideFog:at}),ot=((ht,Qe,ft,Ct,Pt,Dt,$t,pi,ti,hi,oi)=>({u_matrix:Qe,u_opacity:ft,u_ao_pass:Ct?1:0,u_meter_to_tile:Pt,u_ao:Dt,u_flood_light_intensity:$t,u_flood_light_color:pi,u_attenuation:ti,u_edge_radius:hi,u_fb:0,u_fb_size:oi,u_dynamic_offset:1}))(0,ut,F,L,vt,[V,U*vt],q,J,X,ve>=17?0:Ce*vt,le?le.size[0]:0),st=[];ee&&st.push($e.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(_e,Ne,Je.toUnwrapped(),null,be),Ne.draw(m,_e.gl.TRIANGLES,v,b,T,D,ot,a.id,$e.vertexBuffer,$e.indexBuffer,ct,a.paint,ve,je,st)};for(const Je of p){const $e=n.getTile(Je),ct=$e.getBucket(a);if(!ct||ct.projection.name!==we.projection.name||!ct.groundEffect||ct.groundEffect&&!ct.groundEffect.hasData())continue;const ut=ct.groundEffect,vt=1/ct.tileToMeter;{const je=m.translatePosMatrix(Je.projMatrix,$e,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),at=ut.getDefaultSegment();Re(Je,ut,at,je,vt)}if(ie)for(let je=0;je<4;je++){const at=s.d7[je](Je),Ne=n.getTile(at);if(!Ne)continue;const ot=Ne.getBucket(a);if(!ot||ot.projection.name!==we.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;const st=ot.groundEffect;let ht,Qe;je===0?(ht=[-s.ai,0,0],Qe=1):je===1?(ht=[s.ai,0,0],Qe=0):je===2?(ht=[0,-s.ai,0],Qe=3):(ht=[0,s.ai,0],Qe=2);const ft=st.regionSegments[Qe];if(!ft)continue;const Ct=new Float32Array(16);s.ad.mat4.translate(Ct,Je.projMatrix,ht),Re(Je,st,ft,m.translatePosMatrix(Ct,$e,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),vt)}}}function Bc(m,n,a,p,v,b,T){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const D=b?b.findDEMTileFor(a):null;if(!(D&&D.dem||T))return;b&&D&&D.dem&&p.selfDEMTileTimestamp!==D.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=D.dem._timestamp);const L=ie=>new s.P(Math.ceil((ie+s.da)*s.db),0),z=ie=>{const le=n.getSource().minzoom,_e=we=>{const ve=n.getTileByID(we);if(ve&&ve.hasData())return ve.getBucket(v)},pe=[0,-1,1];for(const we of pe){if(ie.overscaledZ+we<le)continue;const ve=_e(ie.calculateScaledKey(ie.overscaledZ+we));if(ve)return ve}},F=[0,0,0],V=(ie,le)=>(F[0]=Math.min(ie.min.y,le.min.y),F[1]=Math.max(ie.max.y,le.max.y),F[2]=s.ai-le.min.x>ie.max.x?le.min.x-s.ai:ie.max.x,F),U=(ie,le)=>(F[0]=Math.min(ie.min.x,le.min.x),F[1]=Math.max(ie.max.x,le.max.x),F[2]=s.ai-le.min.y>ie.max.y?le.min.y-s.ai:ie.max.y,F),q=[(ie,le)=>V(ie,le),(ie,le)=>V(le,ie),(ie,le)=>U(ie,le),(ie,le)=>U(le,ie)],J=(ie,le,_e,pe,we,ve,xe)=>{if(!b)return 0;const be=[[ve?_e:ie,ve?ie:_e,0],[ve?_e:le,ve?le:_e,0]],Ce=xe<0?s.ai+xe:xe,Re=[ve?Ce:(ie+le)/2,ve?(ie+le)/2:Ce,0];return _e===0&&xe<0||_e!==0&&xe>0?b.getForTilePoints(we,[Re],!0,pe):be.push(Re),b.getForTilePoints(a,be,!0,D),Math.max(be[0][2],be[1][2],Re[2])/b.exaggeration()};for(let ie=0;ie<4;ie++){const le=p.borderFeatureIndices[ie];if(le.length===0)continue;const _e=s.d7[ie](a),pe=z(_e);if(!(pe&&pe instanceof s.d8))continue;const we=b?b.findDEMTileFor(_e):null;if(!(we&&we.dem||T)||(b&&we&&we.dem&&p.borderDEMTileTimestamp[ie]!==we.dem._timestamp&&(p.borderDoneWithNeighborZ[ie]=-1,p.borderDEMTileTimestamp[ie]=we.dem._timestamp),p.borderDoneWithNeighborZ[ie]===pe.canonical.z))continue;pe.centroidVertexArray.length===0&&pe.createCentroidsBuffer();const ve=(ie<2?1:5)-ie,xe=pe.borderDoneWithNeighborZ[ve]!==p.canonical.z,be=pe.borderFeatureIndices[ve];let Ce=0;if(p.canonical.z!==pe.canonical.z){for(const Re of le)p.showCentroid(p.featuresOnBorder[Re]);if(xe)for(const Re of be)pe.showCentroid(pe.featuresOnBorder[Re]);p.borderDoneWithNeighborZ[ie]=pe.canonical.z,pe.borderDoneWithNeighborZ[ve]=p.canonical.z}for(const Re of le){const Je=p.featuresOnBorder[Re],$e=p.centroidData[Je.centroidDataIndex],ct=Je.borders[ie];let ut;for(;Ce<be.length;){ut=pe.featuresOnBorder[be[Ce]];const vt=ut.borders[ve];if(vt[1]>ct[0]+3||vt[0]>ct[0]-3)break;pe.showCentroid(ut),Ce++}if(ut&&Ce<be.length){const vt=Ce;let je=0;for(;!(ut.borders[ve][0]>ct[1]-3)&&(je++,++Ce!==be.length);)ut=pe.featuresOnBorder[be[Ce]];ut=pe.featuresOnBorder[be[vt]];let at=!1;if(je>=1){const st=ut.borders[ve];Math.abs(ct[0]-st[0])<3&&Math.abs(ct[1]-st[1])<3&&(je=1,at=!0,Ce=vt+1)}else if(je===0){p.showCentroid(Je);continue}const Ne=pe.centroidData[ut.centroidDataIndex];T&&at&&(((X=$e).flags|(ee=Ne).flags)&s.d9?(X.flags|=s.d9,ee.flags|=s.d9):(X.flags&=~s.d9,ee.flags&=~s.d9));const ot=Je.intersectsCount()>1||ut.intersectsCount()>1;if(je>1)Ce=vt,$e.centroidXY=Ne.centroidXY=new s.P(0,0);else if(we&&we.dem&&!ot){const st=q[ie]($e,Ne),ht=ie%2?s.ai-1:0,Qe=J(st[0],Math.min(s.ai-1,st[1]),ht,we,_e,ie<2,st[2]);$e.centroidXY=Ne.centroidXY=L(Qe)}else ot?$e.centroidXY=Ne.centroidXY=new s.P(0,0):($e.centroidXY=p.encodeBorderCentroid(Je),Ne.centroidXY=pe.encodeBorderCentroid(ut));p.writeCentroidToBuffer($e),pe.writeCentroidToBuffer(Ne)}else p.showCentroid(Je)}p.borderDoneWithNeighborZ[ie]=pe.canonical.z,pe.borderDoneWithNeighborZ[ve]=p.canonical.z}var X,ee;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(m)}const Nc=[1,0,0],Tt=[0,1,0],kt=[0,0,1];function Vc(m,n,a){const p=a.transform,v=a.shadowRenderer;if(!v)return!0;const b=m.toUnwrapped(),T=p.tileSize*v._cascades[a.currentShadowCascade].scale;let D=n.maxHeight;if(p.elevation){const X=p.elevation.getMinMaxForTile(m);X&&(D+=X.max)}const L=[...v.shadowDirection];L[2]=-L[2];const z=v.computeSimplifiedTileShadowVolume(b,D,T,L);if(!z)return!1;const F=[Nc,Tt,kt,L,[L[0],0,L[2]],[0,L[1],L[2]]],V=p.projection.name==="globe",U=p.scaleZoom(T),q=s.bR.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,U,!V),J=v.getCurrentCascadeFrustum();return q.intersectsPrecise(z.vertices,z.planes,F)===0||J.intersectsPrecise(z.vertices,z.planes,F)===0}function kn(m){return[m[0]*s.dc,m[1]*s.dc,m[2]*s.dc,0]}function We(m,n,a,p,v,b,T,D,L){const z=p.getSource(),F=a.globeSharedBuffers;if(!F)return;let V,U,q;if(n&&(V=p.getTile(n)),z instanceof s.aK?(U=z.texture,q=s.cJ(0,0,a.transform)):V&&n&&(U=V.texture,q=s.cJ(n.canonical.z,n.canonical.x,a.transform)),!U||!q)return;m||(q=s.ad.mat4.scale(s.ad.mat4.create(),q,[1,-1,1]));const J=a.context,X=J.gl,ee=v.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR,ie=a.colorModeForDrapableLayerRenderPass(b),le=T.defines;le.push("GLOBE_POLES");const _e=new Jt(X.LEQUAL,Jt.ReadWrite,a.depthRangeFor3D),pe=Float32Array.from(a.transform.expandedFarZProjMatrix),we=Float32Array.from(s.bc(s.cI(new s.bT(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),J.activeTexture.set(X.TEXTURE0),U.bind(ee,X.CLAMP_TO_EDGE),J.activeTexture.set(X.TEXTURE1),U.bind(ee,X.CLAMP_TO_EDGE),"useMipmap"in U&&J.extTextureFilterAnisotropic&&a.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const[ve,xe,be,Ce]=n?F.getPoleBuffers(n.canonical.z,!1):F.getPoleBuffers(0,!0),Re=v.paint.get("raster-elevation");let Je;m?(Je=ve,a.renderDefaultNorthPole=Re!==0):(Je=xe,a.renderDefaultSouthPole=Re!==0);const $e=kn(T.mix),ct=((vt,je,at,Ne,ot,st,ht,Qe,ft,Ct,Pt,Dt,$t)=>_m(vt,je,at,new Float32Array(16),new Float32Array(9),[0,0],Ne,[0,0],[0,0,0,0],1,{opacity:1,mix:0},st,[0,0],Qe,2,Ct,Pt,Dt,1,0,$t))(pe,we,q,s.ag(a.transform.zoom),0,v,0,Re,0,$e,T.offset,T.range,b),ut=a.getOrCreateProgram("raster",{defines:le});a.uploadCommonUniforms(J,ut,null),ut.draw(a,X.TRIANGLES,_e,L,ie,D,ct,v.id,Je,be,Ce)}function Ny(m){const n=m._nearZ,a=m.projection.farthestPixelDistance(m),p=a-n,v=.2*m.height,b=n+v;return[n,a,(b-v-n)/p,(b-n)/p]}function sf(m,n,a,p){if(m)return n instanceof ua&&m instanceof pr?n.getTextureDescriptor(m,a,!0):{texture:m.texture,mix:kn(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Am=s.dd([{name:"a_index",type:"Int16",components:1}]);class Mm{constructor(n,a,p,v){const b={width:p[0],height:p[1],data:null},T=n.gl;this.targetColorTexture=new s.T(n,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,b,T.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(a,v),this.lastInvalidatedAt=0}updateParticleTexture(n,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,v=a.width*a.height;this.particleTexture0=new s.T(this.context,a,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,a,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new s.de;b.reserve(v);for(let T=0;T<v;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,Am.members,!0),this.particleSegment=s.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Vy(m,n,a){if(!m)return null;const p=n.getTextureDescriptor(m,a,!0);if(!p)return null;let{texture:v,mix:b,offset:T,tileSize:D,buffer:L,format:z}=p;if(!v||!z)return null;let F=!1;return z==="uint32"&&(F=!0,b[3]=0,b=zt(s.df,b,[0,a.paint.get("raster-particle-max-speed")]),T=gm(s.df,T,[0,a.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[L/(D+2*L),D/(D+2*L)],tileSize:D,scalarData:F,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Uy(m){const n=m._nearZ,a=m.projection.farthestPixelDistance(m),p=a-n,v=.2*m.height,b=n+v;return[n,a,(b-v-n)/p,(b-n)/p]}const Uc=new s.al(1,0,0,1),db=new s.al(0,1,0,1),fb=new s.al(0,0,1,1),jy=new s.al(1,0,1,1),rf=new s.al(0,1,1,1);function Ja(m,n,a,p,v,b,T){const D=m.context,L=m.transform,z=D.gl,F=L.projection.name==="globe",V=F?["PROJECTION_GLOBE_VIEW"]:[];let U=s.ad.mat4.clone(a.projMatrix);if(F&&s.ag(L.zoom)>0){const $e=s.bb(a.canonical,L),ct=s.dg($e);U=s.ad.mat4.multiply(new Float32Array(16),L.globeMatrix,ct),s.ad.mat4.multiply(U,L.projMatrix,U)}const q=s.ad.mat4.create();q[12]+=2*v/(s.q.devicePixelRatio*L.width),q[13]+=2*b/(s.q.devicePixelRatio*L.height),s.ad.mat4.multiply(U,q,U);const J=m.getOrCreateProgram("debug",{defines:V}),X=n.getTileByID(a.key);m.terrain&&m.terrain.setupElevationDraw(X,J);const ee=Jt.disabled,ie=gi.disabled,le=m.colorModeForRenderPass(),_e="$debug";D.activeTexture.set(z.TEXTURE0),m.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),F?X._makeGlobeTileDebugBuffers(m.context,L):X._makeDebugTileBoundsBuffers(m.context,L.projection);const pe=X._tileDebugBuffer||m.debugBuffer,we=X._tileDebugIndexBuffer||m.debugIndexBuffer,ve=X._tileDebugSegments||m.debugSegments;if(J.draw(m,z.LINE_STRIP,ee,ie,le,fi.disabled,Oy(U,p),_e,pe,we,ve,null,null,null,[X._globeTileDebugBorderBuffer]),T){const $e=X.latestRawTileData,ct=Math.floor(($e&&$e.byteLength||0)/1024);let ut=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ut+=` => ${a.overscaledZ}`),ut+=` ${X.state}`,ut+=` ${ct}kb`,function(vt,je){vt.initDebugOverlayCanvas();const at=vt.debugOverlayCanvas,Ne=vt.context.gl,ot=vt.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,at.width,at.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(je,5,5),ot.strokeText(je,5,5),vt.debugOverlayTexture.update(at),vt.debugOverlayTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}(m,ut)}const xe=n.getTile(a).tileSize,be=512/Math.min(xe,512)*(a.overscaledZ/L.zoom)*.5,Ce=X._tileDebugTextBuffer||m.debugBuffer,Re=X._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Je=X._tileDebugTextSegments||m.debugSegments;J.draw(m,z.TRIANGLES,ee,ie,Mi.alphaBlended,fi.disabled,Oy(U,s.al.transparent,be),_e,Ce,Re,Je,null,null,null,[X._globeTileDebugTextBuffer])}function Im(m,n,a,p){Il(m,0,n+a/2,m.transform.width,a,p)}function Cm(m,n,a,p){Il(m,n-a/2,0,a,m.transform.height,p)}function Il(m,n,a,p,v,b){const T=m.context,D=T.gl;D.enable(D.SCISSOR_TEST),D.scissor(n*s.q.devicePixelRatio,a*s.q.devicePixelRatio,p*s.q.devicePixelRatio,v*s.q.devicePixelRatio),T.clear({color:b}),D.disable(D.SCISSOR_TEST)}const of=s.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:jc}=of;function ba(m,n,a,p){m.emplaceBack(n,a,p)}class $y{constructor(n){this.vertexArray=new s.dh,this.indices=new s.aV,ba(this.vertexArray,-1,-1,1),ba(this.vertexArray,1,-1,1),ba(this.vertexArray,-1,1,1),ba(this.vertexArray,1,1,1),ba(this.vertexArray,-1,-1,-1),ba(this.vertexArray,1,-1,-1),ba(this.vertexArray,-1,1,-1),ba(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,jc),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.b8.simpleSegment(0,0,36,12)}}function Ms(m,n,a,p,v,b){const T=m.context.gl,D=n.paint.get("sky-atmosphere-color"),L=n.paint.get("sky-atmosphere-halo-color"),z=n.paint.get("sky-atmosphere-sun-intensity"),F=((V,U,q,J,X)=>({u_matrix_3f:V,u_sun_direction:U,u_sun_intensity:q,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(s.ad.mat3.fromMat4(s.ad.mat3.create(),p),v,z,D,L);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),a.draw(m,T.TRIANGLES,Jt.disabled,gi.disabled,Mi.unblended,fi.frontCW,F,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const pb=s.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ph{constructor(n){const a=new s.di;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const p=new s.aV;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,pb.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=s.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const yn=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Gi{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Hy{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Mi([1,Wa,1,Wa],s.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Mi([1,0,1,0],s.al.transparent,[!1,!1,!1,!0]),this.params=new Gi,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const a=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ph(a);const p=this.params.sizeRange,v=this.params.intensityRange,b=function(F){const V=s.dl(30),U=[];for(let q=0;q<F;++q){const J=2*Math.PI*V(),X=Math.acos(1-2*V())-.5*Math.PI;U.push(s.ad.vec3.fromValues(Math.cos(X)*Math.cos(J),Math.cos(X)*Math.sin(J),Math.sin(X)))}return U}(this.params.starsCount),T=s.dl(300),D=new s.dj,L=new s.aV;let z=0;for(let F=0;F<b.length;++F){const V=s.ad.vec3.scale([],b[F],200),U=Math.max(0,1+.01*p*(1*T()-.5)),q=Math.max(0,1+.01*v*(1*T()-.5));D.emplaceBack(V[0],V[1],V[2],-1,-1,U,q),D.emplaceBack(V[0],V[1],V[2],1,-1,U,q),D.emplaceBack(V[0],V[1],V[2],1,1,U,q),D.emplaceBack(V[0],V[1],V[2],-1,1,U,q),L.emplaceBack(z+0,z+1,z+2),L.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=a.createVertexBuffer(D,yn.members),this.starsIdx=a.createIndexBuffer(L),this.starsSegments=s.b8.simpleSegment(0,0,D.length,L.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,a){const p=n.context,v=p.gl,b=n.transform,T=new Jt(v.LEQUAL,Jt.ReadOnly,[0,1]),D=s.ag(b.zoom),L=n.style.getLut(a.scope),z=a.properties.get("color-use-theme")==="none",F=a.properties.get("color").toRenderColor(z?null:L).toArray01(),V=a.properties.get("high-color-use-theme")==="none",U=a.properties.get("high-color").toRenderColor(V?null:L).toArray01(),q=a.properties.get("space-color-use-theme")==="none",J=a.properties.get("space-color").toRenderColor(q?null:L).toArray01PremultipliedAlpha(),X=5e-4,ee=s.dk(a.properties.get("horizon-blend"),0,1,X,.25),ie=s.cD(n,p,b)&&ee===X?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,le=n.frameCounter/1e3%1,_e=s.ad.vec3.length(b.globeCenterInViewSpace),pe=Math.sqrt(Math.pow(_e,2)-Math.pow(ie,2)),we=Math.acos(pe/_e),ve=xe=>{const be=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];xe&&be.push("ALPHA_PASS");const Ce=n.getOrCreateProgram("globeAtmosphere",{defines:be}),Re=(($e,ct,ut,vt,je,at,Ne,ot,st,ht,Qe,ft)=>({u_frustum_tl:$e,u_frustum_tr:ct,u_frustum_br:ut,u_frustum_bl:vt,u_horizon:je,u_transition:at,u_fadeout_range:Ne,u_color:ot,u_high_color:st,u_space_color:ht,u_temporal_offset:Qe,u_horizon_angle:ft}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,D,ee,F,U,J,le,we);n.uploadCommonUniforms(p,Ce);const Je=this.atmosphereBuffer;Je&&Ce.draw(n,v.TRIANGLES,T,gi.disabled,xe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,fi.backCW,Re,xe?"atmosphere_glow_alpha":"atmosphere_glow",Je.vertexBuffer,Je.indexBuffer,Je.segments)};ve(!1),ve(!0)}drawStars(n,a){const p=s.ay(a.properties.get("star-intensity"),0,1);if(p===0)return;const v=n.context,b=v.gl,T=n.transform,D=n.getOrCreateProgram("stars"),L=s.ad.quat.identity([]);s.ad.quat.rotateX(L,L,-T._pitch),s.ad.quat.rotateZ(L,L,-T.angle),s.ad.quat.rotateX(L,L,s.ak(T._center.lat)),s.ad.quat.rotateY(L,L,-s.ak(T._center.lng));const z=s.ad.mat4.fromQuat(new Float32Array(16),L),F=s.ad.mat4.multiply([],T.starsProjMatrix,z),V=s.ad.mat3.fromMat4([],z),U=s.ad.mat3.invert([],V),q=[0,1,0];s.ad.vec3.transformMat3(q,q,U),s.ad.vec3.scale(q,q,this.params.sizeMultiplier);const J=[1,0,0];s.ad.vec3.transformMat3(J,J,U),s.ad.vec3.scale(J,J,this.params.sizeMultiplier);const X=(ee=q,ie=J,le=p,{u_matrix:Float32Array.from(F),u_up:ee,u_right:ie,u_intensity_multiplier:le});var ee,ie,le;n.uploadCommonUniforms(v,D),this.starsVx&&this.starsIdx&&D.draw(n,b.TRIANGLES,Jt.disabled,gi.disabled,this.colorModeAlphaBlendedWriteRGB,fi.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function wa(m,n){const a=[...m],p=n.cameraWorldSizeForFog/n.worldSize,v=s.ad.mat4.identity([]);return s.ad.mat4.scale(v,v,[p,p,1]),s.ad.mat4.multiply(a,v,a),s.ad.mat4.multiply(a,n.worldToFogMatrix,a),a}function $c(m,n,a,p,v){const b=a.material,T=p.context,{baseColorTexture:D,metallicRoughnessTexture:L}=b.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:F,emissionTexture:V}=b;function U(J,X,ee){if(J&&(m.push(X),T.activeTexture.set(T.gl.TEXTURE0+ee),J.gfxTexture)){const{minFilter:ie,magFilter:le,wrapS:_e,wrapT:pe}=J.sampler;J.gfxTexture.bindExtraParam(ie,le,_e,pe)}}U(D,"HAS_TEXTURE_u_baseColorTexture",Un.BaseColor),U(L,"HAS_TEXTURE_u_metallicRoughnessTexture",Un.MetallicRoughness),U(z,"HAS_TEXTURE_u_normalTexture",Un.Normal),U(F,"HAS_TEXTURE_u_occlusionTexture",Un.Occlusion),U(V,"HAS_TEXTURE_u_emissionTexture",Un.Emission),v&&(v.texture||(v.texture=new s.dn(p.context,v.image,[v.image.height,v.image.height,v.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+Un.LUT),v.texture&&v.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(a.texcoordBuffer)),a.colorBuffer&&(m.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(a.colorBuffer)),a.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(a.normalBuffer)),a.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(a.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||m.push("DIFFUSE_SHADED");const q=p.shadowRenderer;q&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Ta(m,n,a,p,v,b){const T=a.paint.get("model-opacity").constantOr(1),D=n.context,L=new Jt(n.context.gl.LEQUAL,Jt.ReadWrite,n.depthRangeFor3D),z=n.transform,F=m.mesh,V=F.material,U=V.pbrMetallicRoughness,q=n.style.fog;let J;J=n.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:s.ad.mat4.multiply([],p.zScaleMatrix,m.nodeModelMatrix),s.ad.mat4.multiply(J,p.negCameraPosMatrix,J);const X=s.ad.mat4.invert([],J);s.ad.mat4.transpose(X,X);const ee=a.paint.get("model-color-use-theme").constantOr("default")==="none",ie=a.paint.get("model-emissive-strength").constantOr(0),le=xm(new Float32Array(m.worldViewProjection),new Float32Array(J),new Float32Array(X),null,n,T,U.baseColorFactor.toRenderColor(null),V.emissiveFactor,U.metallicFactor,U.roughnessFactor,V,ie,a),_e={defines:[]},pe=[],we=n.shadowRenderer;we&&(we.useNormalOffset=!1),$c(_e.defines,pe,F,n,ee?null:a.lut);let ve=null;if(q){const Ce=wa(m.nodeModelMatrix,n.transform);if(ve=new Float32Array(Ce),z.projection.name!=="globe"){const Re=F.aabb.min,Je=F.aabb.max,[$e,ct]=q.getOpacityForBounds(Ce,Re[0],Re[1],Je[0],Je[1]);_e.overrideFog=$e>=Ot||ct>=Ot}}const xe=_a(n,a.paint.get("model-cutoff-fade-range"));xe.shouldRenderCutoff&&_e.defines.push("RENDER_CUTOFF");const be=n.getOrCreateProgram("model",_e);n.uploadCommonUniforms(D,be,null,ve,xe),n.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(m.nodeModelMatrix,be),be.draw(n,D.gl.TRIANGLES,L,v,b,F.material.doubleSided?fi.disabled:fi.backCCW,le,a.id,F.vertexBuffer,F.indexBuffer,F.segments,a.paint,n.transform.zoom,void 0,pe)}function Cl(m,n,a,p,v,b,T){let D;D=m.projection.name==="globe"?s.dp(a,m):[...a],s.ad.mat4.multiply(D,D,n.matrix);const L=s.ad.mat4.multiply([],p,D);if(n.meshes)for(const z of n.meshes){if(z.material.alphaMode!=="BLEND"){T.push({mesh:z,depth:0,modelIndex:v,worldViewProjection:L,nodeModelMatrix:D});continue}const F=s.ad.vec3.transformMat4([],z.centroid,L);!m.isOrthographic&&F[2]<=0||b.push({mesh:z,depth:F[2],modelIndex:v,worldViewProjection:L,nodeModelMatrix:D})}if(n.children)for(const z of n.children)Cl(m,z,a,p,v,b,T)}function mh(m,n,a,p){const v=a.shadowRenderer;if(!v)return;const b=v.getShadowPassDepthMode(),T=v.getShadowPassColorMode(),D=v.calculateShadowPassMatrixFromMatrix(n),L=Fy(D);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,b,gi.disabled,T,fi.backCCW,L,p.id,m.vertexBuffer,m.indexBuffer,m.segments,p.paint,a.transform.zoom,void 0,void 0)}function Pm(m,n,a){const p=n.updateZoomBasedPaintProperties(),v=function(b,T,D){let L,z,F,V=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&V>0){const U=b.terrain,q=U.findDEMTileFor(D);q&&q.dem?L=s.dr.create(U,D,q):V=0}if(V===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),V===T.validForExaggeration&&(V===0||L&&L._demTile&&L._demTile.tileID===T.validForDEMTile.id&&L._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const U in T.instancesPerModel){const q=T.instancesPerModel[U];for(let J=0;J<q.instancedDataArray.length;++J){const X=(L?V*L.getElevationAt(0|q.instancedDataArray.float32[16*J],0|q.instancedDataArray.float32[16*J+1],!0,!0):0)+q.instancesEvaluatedElevation[J];q.instancedDataArray.float32[16*J+6]=X,z=z?Math.min(T.terrainElevationMin,X):X,F=F?Math.max(T.terrainElevationMax,X):X}}return T.terrainElevationMin=z||0,T.terrainElevationMax=F||0,T.validForExaggeration=V,T.validForDEMTile=L&&L._demTile?{id:L._demTile.tileID,timestamp:L._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,n,a);(p||v)&&(n.uploaded=!1,n.upload(m.context))}const ao={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.ce([0,0,0],[s.ai,s.ai,0])};function Dm(m,n){const a=1<<m.canonical.z,p=n.getFreeCameraOptions().position,v=n.elevation,b=m.canonical.x/a,T=(m.canonical.x+1)/a,D=m.canonical.y/a,L=(m.canonical.y+1)/a;let z=n._centerAltitude;if(v){const q=v.getMinMaxForTile(m);q&&q.max>z&&(z=q.max)}const F=s.ay(p.x,b,T)-p.x,V=s.ay(p.y,D,L)-p.y,U=s.bH(z,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(F*F+V*V+U*U))}function Ao(m,n,a,p,v,b,T){const D=m.context,L=m.renderPass==="shadow",z=m.shadowRenderer,F=L&&z?z.getShadowPassDepthMode():new Jt(D.gl.LEQUAL,Jt.ReadWrite,m.depthRangeFor3D),V=m.isTileAffectedByFog(b);if(a.meshes)for(const U of a.meshes){const q=["MODEL_POSITION_ON_GPU"],J=[];let X,ee,ie;p.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const le=_a(m,n.paint.get("model-cutoff-fade-range"));if(le.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),L&&z)X=m.getOrCreateProgram("modelDepth",{defines:q}),ee=Fy(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(a.matrix)),ie=z.getShadowPassColorMode();else{$c(q,J,U,m,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),X=m.getOrCreateProgram("model",{defines:q,overrideFog:V});const pe=U.material,we=pe.pbrMetallicRoughness,ve=n.paint.get("model-opacity").constantOr(1),xe=n.paint.get("model-emissive-strength").constantOr(0);ee=xm(b.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,m,ve,we.baseColorFactor.toRenderColor(null),pe.emissiveFactor,we.metallicFactor,we.roughnessFactor,pe,xe,n,v),z&&(T.shadowUniformsInitialized?X.setShadowUniformValues(D,z.getShadowUniformValues()):(z.setupShadows(b.toUnwrapped(),X,"model-tile",b.overscaledZ),T.shadowUniformsInitialized=!0)),ie=le.shouldRenderCutoff||ve<1||pe.alphaMode!=="OPAQUE"?Mi.alphaBlended:Mi.unblended}m.uploadCommonUniforms(D,X,b.toUnwrapped(),null,le);const _e=U.material.doubleSided?fi.disabled:fi.backCCW;if(p.instancedDataArray.length>20)J.push(p.instancedDataBuffer),X.draw(m,D.gl.TRIANGLES,F,gi.disabled,ie,_e,ee,n.id,U.vertexBuffer,U.indexBuffer,U.segments,n.paint,m.transform.zoom,void 0,J,p.instancedDataArray.length);else{const pe=L?"u_instance":"u_normal_matrix";for(let we=0;we<p.instancedDataArray.length;++we)ee[pe]=new Float32Array(p.instancedDataArray.arrayBuffer,64*we,16),X.draw(m,D.gl.TRIANGLES,F,gi.disabled,ie,_e,ee,n.id,U.vertexBuffer,U.indexBuffer,U.segments,n.paint,m.transform.zoom,void 0,J)}}if(a.children)for(const U of a.children)Ao(m,n,U,p,v,b,T)}const Qa=[1,-1,1];function af(m,n,a,p){if(!a.modelManager)return!0;const v=a.modelManager;if(!a.shadowRenderer)return!0;const b=a.shadowRenderer,T=n.aabb;let D=!0,L=m.maxHeight;if(L===0){let F=0;for(const V in m.instancesPerModel){const U=v.getModel(V,p);U?F=Math.max(F,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):D=!1}L=m.maxScale*F*1.41+m.maxVerticalOffset,D&&(m.maxHeight=L)}T.max[2]=L,T.min[2]+=m.terrainElevationMin,T.max[2]+=m.terrainElevationMax,s.ad.vec3.transformMat4(T.min,T.min,n.tileMatrix),s.ad.vec3.transformMat4(T.max,T.max,n.tileMatrix);const z=T.intersects(b.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=z===2),z===0}function lf(m,n){const a=m.uniformValues.u_cutoff_params[0],p=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],b=m.uniformValues.u_cutoff_params[3];return p===a||b===v?1:s.ay(((n-a)/(p-a)-v)/(b-v),0,1)}function Rm(m,n,a,p){if(n.pitch<20)return 1;const v=n.getWorldToCameraMatrix();s.ad.mat4.multiply(v,v,m);const b=s.ad.vec4.fromValues(a.min[0],a.min[1],a.min[2],1);let T=s.ad.vec4.transformMat4(s.ad.vec4.create(),b,v),D=T,L=T;b[1]=a.max[1],T=s.ad.vec4.transformMat4(s.ad.vec4.create(),b,v),D=T[1]<D[1]?T:D,L=T[1]>L[1]?T:L,b[0]=a.max[0],T=s.ad.vec4.transformMat4(s.ad.vec4.create(),b,v),D=T[1]<D[1]?T:D,L=T[1]>L[1]?T:L,b[1]=a.min[1],T=s.ad.vec4.transformMat4(s.ad.vec4.create(),b,v),D=T[1]<D[1]?T:D,L=T[1]>L[1]?T:L;const z=s.ay(p[0],0,1),F=100*n.pixelsPerMeter*s.ay(p[1],0,1),V=s.ay(p[2],0,1),U=s.ad.vec4.lerp(s.ad.vec4.create(),D,L,z),q=Math.tan(.5*n.fovX),J=-U[2]*q;if(F===0)return U[1]<-Math.abs(J)?V:1;const X=(-Math.abs(J)-U[1])/F,ee=(le,_e,pe)=>(1-pe)*le+pe*_e,ie=s.ay(ee(1,V,X),V,1);return ee(1,ie,s.ay((n.pitch-20)/20,0,1))}class Lm{}class Pl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,a,p){{const V=this._storage.get(a.id);if(V)return V.lastUsedFrameIdx=n,V.buf}const v=p.gl,b=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),T=new ArrayBuffer(b),D=new Int16Array(T);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const L=new s.dt;for(let V=0;V<b/2;V+=3){const U=D[V],q=D[V+1],J=D[V+2];L.emplaceBack(U,q),L.emplaceBack(q,J),L.emplaceBack(J,U)}const z=p.bindVertexArrayOES.current,F=new Lm;return F.buf=new qo(p,L),F.lastUsedFrameIdx=n,this._storage.set(a.id,F),p.bindVertexArrayOES.set(z),F.buf}update(n){for(const[a,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(a))}destroy(){for(const[n,a]of this._storage)a.buf.destroy(),this._storage.delete(n)}}class Om{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const el=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class km{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class gh{constructor(n,a){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const zm=s.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class Fm{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,a){const p=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new s.du,D=new s.aV;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),D.emplaceBack(0,1,2),D.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(T,zm.members),this.vignetteIdx=n.context.createIndexBuffer(D)}const v=s.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,p);const T={u_vignetteShape:(b={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(n,n.context.gl.TRIANGLES,Jt.disabled,gi.disabled,Mi.alphaBlended,fi.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,v)}var b}}class Rs{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,a){const p=n.getFreeCameraOptions().position,v=p.toAltitude(),b=p.toLngLat(),T=s.ak(b.lng),D=s.ak(b.lat),L=n.pixelsPerMeter/a,z=T*s.dv,F=s.dv*Math.log(Math.tan(Math.PI/4+D/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+F,U=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*L,this._accumulatedOffsetY+=V*L,this._accumulatedElevation+=U*L,this._offsetXPrev=z,this._offsetYPrev=F,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function cf(m,n){return[-(m[0]-Math.floor(m[0]/n)*n),-(m[1]-Math.floor(m[1]/n)*n),-(m[2]-Math.floor(m[2]/n)*n)]}function uf(m){const n=s.dl(1323123451230),a=[];for(let p=0;p<m;++p){const v=2*n()-1,b=2*n()-1,T=2*n()-1;a.push(s.ad.vec3.fromValues(v,b,T))}return a}function br(m,n,a,p,v){const b=s.ay((v-a)/(p-a),0,1);return(1-b)*m+b*n}class hf{constructor(n){this._movement=new Rs,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Fm,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,a){const p=n.transform;this._movement.update(p,this._ppmScaleFactor);const v=p.starsProjMatrix,b=s.ad.quat.identity([]);s.ad.quat.rotateX(b,b,s.ak(90)-p._pitch),s.ad.quat.rotateZ(b,b,-p.angle);const T=s.ad.mat4.fromQuat(new Float32Array(16),b),D=s.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),L=s.ad.mat4.transpose([],D),z=s.ad.mat4.multiply([],L,T),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*a,this._prevTime=F,{projectionMatrix:v,modelviewMatrix:z}}}class Bm extends hf{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new gh(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const p=uf(this.particlesCount),v=new s.dw,b=new s.aV;let T=0;const D=s.dl(1323123451230);for(let L=0;L<p.length;++L){const z=p[L],F=[2*D()-1,D(),D(),D()];v.emplaceBack(z[0],z[1],z[2],-1,-1,...F),v.emplaceBack(z[0],z[1],z[2],1,-1,...F),v.emplaceBack(z[0],z[1],z[2],1,1,...F),v.emplaceBack(z[0],z[1],z[2],-1,1,...F),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(v,el.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=n.transform.zoom;if(a.revealStart>p)return;const v=br(0,1,a.revealStart,a.revealStart+a.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];s.ad.vec3.normalize(T,T);const D=structuredClone(this._vignetteParams);D.strength*=v,b.overrideStyleParameters||(b.intensity=n.style.rain.state.density,b.timeFactor=n.style.rain.state.intensity,b.color=structuredClone(n.style.rain.state.color),T=structuredClone(n.style.rain.state.direction),b.screenThinning.intensity=n.style.rain.state.centerThinning,b.dropletSizeX=n.style.rain.state.dropletSize[0],b.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],b.distortionStrength=100*n.style.rain.state.distortionStrength,D.strength=1,D.color=structuredClone(n.style.rain.state.vignetteColor));const L=this.updateOnRender(n,b.timeFactor),z=n.context,F=z.gl,V=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new s.T(z,{width:n.width,height:n.height,data:null},F.RGBA8)),b.distortionStrength>0&&(z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const U=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(z,U),z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const q=[b.color.r,b.color.g,b.color.b,b.color.a],J=(X,ee)=>{const ie=cf(this._movement.getPosition(),X),le=b.dropletSizeX,_e=b.dropletSizeX*b.dropletSizeYScale,pe=n.width/2,we=n.height/2,ve=br(0,b.screenThinning.start,0,1,b.screenThinning.intensity),xe=br(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),be=br(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Ce=(Re={modelview:L.modelviewMatrix,projection:L.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:X,rainDropletSize:[le,_e],distortionStrength:b.distortionStrength,rainDirection:T,color:q,screenSize:[V.width,V.height],thinningCenterPos:[pe,we],thinningShape:[ve,xe,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:ee?0:1},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_texScreen:0,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_boxSize:Re.boxSize,u_rainDropletSize:Re.rainDropletSize,u_distortionStrength:Re.distortionStrength,u_rainDirection:Re.rainDirection,u_color:Re.color,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_shapeDirectionalPower:Re.shapeDirectionalPower,u_shapeNormalPower:Re.shapeNormalPower,u_mode:Re.mode});var Re;const Je=Math.round(b.intensity*this.particlesCount),$e=s.b8.simpleSegment(0,0,4*Je,2*Je);U.draw(n,F.TRIANGLES,Jt.disabled,gi.disabled,Mi.alphaBlended,fi.disabled,Ce,"rain_particles",this.particlesVx,this.particlesIdx,$e)};b.distortionStrength>0&&J(b.boxSize,!0),J(b.boxSize,!1),this._vignette.draw(n,D)}}const Nm=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Hc extends hf{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new gh(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const p=uf(this.particlesCount),v=new s.dx,b=new s.aV;let T=0;const D=s.dl(1323123451230);for(let L=0;L<p.length;++L){const z=p[L],F=D(),V=D(),U=D(),q=[L/p.length,F,V,U],J=[D(),D()];v.emplaceBack(z[0],z[1],z[2],-1,-1,...q,...J),v.emplaceBack(z[0],z[1],z[2],1,-1,...q,...J),v.emplaceBack(z[0],z[1],z[2],1,1,...q,...J),v.emplaceBack(z[0],z[1],z[2],-1,1,...q,...J),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(v,Nm.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const a=structuredClone(this._params);let p=[-a.direction.x,a.direction.y,-100];s.ad.vec3.normalize(p,p);const v=structuredClone(this._vignetteParams),b=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=n.transform.zoom;if(b.revealStart>T)return;const D=br(0,1,b.revealStart,b.revealStart+b.revealRange,T);v.strength*=D,a.overrideStyleParameters||(a.intensity=n.style.snow.state.density,a.timeFactor=n.style.snow.state.intensity,a.color=structuredClone(n.style.snow.state.color),p=structuredClone(n.style.snow.state.direction),a.screenThinning.intensity=n.style.snow.state.centerThinning,a.billboardSize=2.79*n.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(n.style.snow.state.vignetteColor));const L=this.updateOnRender(n,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=n.context,F=z.gl,V=n.transform,U=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(z,U),((q,J,X)=>{const ee=cf(this._movement.getPosition(),q),ie=V.width/2,le=V.height/2,_e=br(0,X.screenThinning.start,0,1,X.screenThinning.intensity),pe=br(.001,X.screenThinning.range,0,1,X.screenThinning.intensity),we=br(0,X.screenThinning.particleOffset,0,1,X.screenThinning.intensity),ve=(xe={modelview:L.modelviewMatrix,projection:L.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:X.velocityConeAperture,velocity:X.velocity,horizontalOscillationRadius:X.horizontalOscillationRadius,horizontalOscillationRate:X.horizontalOscillationRate,boxSize:q,billboardSize:1*X.billboardSize,simpleShapeParameters:[X.shapeFadeStart,X.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[ie,le],thinningShape:[_e,pe,Math.pow(10,X.screenThinning.fadePower)],thinningAffectedRatio:X.screenThinning.affectedRatio,thinningParticleOffset:we,color:[X.color.r,X.color.g,X.color.b,X.color.a],direction:p},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_horizontalOscillationRadius:xe.horizontalOscillationRadius,u_horizontalOscillationRate:xe.horizontalOscillationRate,u_boxSize:xe.boxSize,u_billboardSize:xe.billboardSize,u_simpleShapeParameters:xe.simpleShapeParameters,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_particleColor:xe.color,u_direction:xe.direction});var xe;const be=Math.round(X.intensity*this.particlesCount),Ce=s.b8.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&U.draw(n,F.TRIANGLES,Jt.disabled,gi.disabled,Mi.alphaBlended,fi.disabled,ve,"snow_particles",this.particlesVx,this.particlesIdx,Ce)})(a.boxSize,0,a),this._vignette.draw(n,v)}}const _h={symbol:function(m,n,a,p,v){if(m.renderPass!=="translucent")return;const b=gi.disabled,T=m.colorModeForRenderPass(),D=a.layout.get("text-variable-anchor"),L=a.layout.get("text-size-scale-range"),z=s.ay(m.scaleFactor,L[0],L[1]);D&&function(U,q,J,X,ee,ie,le,_e){const pe=q.transform,we=ee==="map",ve=ie==="map";for(const xe of U){const be=X.getTile(xe),Ce=be.getBucket(J);if(!Ce||!Ce.text||!Ce.text.segments.get().length)continue;const Re=s.bp(Ce.textSizeData,pe.zoom,_e),Je=Ur(xe,Ce.getProjection(),pe),$e=pe.calculatePixelsToTileUnitsMatrix(be),ct=da(Je,be.tileID.canonical,ve,we,pe,Ce.getProjection(),$e),ut=Ce.hasIconTextFit()&&Ce.hasIconData();if(Re){const vt=Math.pow(2,pe.zoom-be.tileID.overscaledZ);oo(Ce,we,ve,le,s.cY,pe,ct,xe,vt,Re,ut)}}}(p,m,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),v,z);const F=a.paint.get("icon-opacity").constantOr(1)!==0,V=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||V)?fn(m,n,a,p,b,T):(F&&fn(m,n,a,p,b,T,{onlyIcons:!0}),V&&fn(m,n,a,p,b,T,{onlyText:!0})),n.map.showCollisionBoxes&&(ef(m,n,a,p,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),ef(m,n,a,p,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(m,n,a,p){if(m.renderPass!=="translucent")return;const v=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),D=a.layout.get("circle-sort-key").constantOr(1)!==void 0,L=a.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const z=m.context,F=z.gl,V=m.transform,U=m.depthModeForSublayer(0,Jt.ReadOnly),q=gi.disabled,J=m.colorModeForDrapableLayerRenderPass(L),X=V.projection.name==="globe",ee=[s.av(V.center.lng),s.aC(V.center.lat)],ie=[];for(let _e=0;_e<p.length;_e++){const pe=p[_e],we=n.getTile(pe),ve=we.getBucket(a);if(!ve||ve.projection.name!==V.projection.name)continue;const xe=ve.programConfigurations.get(a.id),be=s.cZ(a),Ce=m.isTileAffectedByFog(pe);X&&be.push("PROJECTION_GLOBE_VIEW"),be.push("DEPTH_D24"),m.terrain&&V.depthOcclusionForSymbolsAndCircles&&be.push("DEPTH_OCCLUSION");const Re=m.getOrCreateProgram("circle",{config:xe,defines:be,overrideFog:Ce}),Je=ve.layoutVertexBuffer,$e=ve.globeExtVertexBuffer,ct=ve.indexBuffer,ut=V.projection.createInversionMatrix(V,pe.canonical),vt={programConfiguration:xe,program:Re,layoutVertexBuffer:Je,globeExtVertexBuffer:$e,indexBuffer:ct,uniformValues:s.c_(m,pe,we,ut,ee,a),tile:we};if(D){const je=ve.segments.get();for(const at of je)ie.push({segments:new s.b8([at]),sortKey:at.sortKey,state:vt})}else ie.push({segments:ve.segments,sortKey:0,state:vt})}D&&ie.sort((_e,pe)=>_e.sortKey-pe.sortKey);const le={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const _e of ie){const{programConfiguration:pe,program:we,layoutVertexBuffer:ve,globeExtVertexBuffer:xe,indexBuffer:be,uniformValues:Ce,tile:Re}=_e.state,Je=_e.segments;m.terrain&&m.terrain.setupElevationDraw(Re,we,le),m.uploadCommonUniforms(z,we,Re.tileID.toUnwrapped()),we.draw(m,F.TRIANGLES,U,q,J,fi.disabled,Ce,a.id,ve,be,Je,a.paint,V.zoom,pe,[xe])}},heatmap:function(m,n,a,p){if(a.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const v=m.context,b=v.gl,T=gi.disabled,D=new Mi([b.ONE,b.ONE,b.ONE,b.ONE],s.al.transparent,[!0,!0,!0,!0]);(function(q,J,X,ee){const ie=q.gl,le=J.width*ee,_e=J.height*ee;q.activeTexture.set(ie.TEXTURE1),q.viewport.set([0,0,le,_e]);let pe=X.heatmapFbo;if(!pe||pe&&(pe.width!==le||pe.height!==_e)){pe&&pe.destroy();const we=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,we),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),pe=X.heatmapFbo=q.createFramebuffer(le,_e,!0,null),function(ve,xe,be,Ce,Re,Je){const $e=ve.gl;$e.texImage2D($e.TEXTURE_2D,0,ve.extRenderToTextureHalfFloat?$e.RGBA16F:$e.RGBA,Re,Je,0,$e.RGBA,ve.extRenderToTextureHalfFloat?$e.HALF_FLOAT:$e.UNSIGNED_BYTE,null),Ce.colorAttachment.set(be)}(q,0,we,pe,le,_e)}else ie.bindTexture(ie.TEXTURE_2D,pe.colorAttachment.get()),q.bindFramebuffer.set(pe.framebuffer)})(v,m,a,m.transform.projection.name==="globe"?.5:.25),v.clear({color:s.al.transparent});const L=m.transform,z=L.projection.name==="globe",F=z?["PROJECTION_GLOBE_VIEW"]:[],V=z?fi.frontCCW:fi.disabled,U=[s.av(L.center.lng),s.aC(L.center.lat)];for(let q=0;q<p.length;q++){const J=p[q];if(n.hasRenderableParent(J))continue;const X=n.getTile(J),ee=X.getBucket(a);if(!ee||ee.projection.name!==L.projection.name)continue;const ie=m.isTileAffectedByFog(J),le=ee.programConfigurations.get(a.id),_e=m.getOrCreateProgram("heatmap",{config:le,defines:F,overrideFog:ie}),{zoom:pe}=m.transform;m.terrain&&m.terrain.setupElevationDraw(X,_e),m.uploadCommonUniforms(v,_e,J.toUnwrapped());const we=L.projection.createInversionMatrix(L,J.canonical);_e.draw(m,b.TRIANGLES,Jt.disabled,T,D,V,Kd(m,J,X,we,U,pe,a.paint.get("heatmap-intensity")),a.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,a.paint,m.transform.zoom,le,z?[ee.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,b){const T=v.context,D=T.gl,L=b.heatmapFbo;if(!L)return;T.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,L.colorAttachment.get()),T.activeTexture.set(D.TEXTURE1);let z=b.colorRampTexture;z||(z=b.colorRampTexture=new s.T(T,b.colorRamp,D.RGBA8)),z.bind(D.LINEAR,D.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,D.TRIANGLES,Jt.disabled,gi.disabled,v.colorModeForRenderPass(),fi.disabled,((F,V,U,q)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,b),b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(m,a))},line:function(m,n,a,p){if(m.renderPass!=="translucent")return;const v=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(v.constantOr(1)===0||b.constantOr(1)===0)return;const T=a.paint.get("line-emissive-strength"),D=a.paint.get("line-occlusion-opacity"),L=a.layout.get("line-elevation-reference"),z=a.layout.get("line-width-unit")==="meters",F=L==="sea",V=m.context,U=V.gl;if(a.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const q=a.layout.get("line-cross-slope"),J=q!==void 0,X=q<1,ee=m.colorModeForDrapableLayerRenderPass(T),ie=m.terrain&&m.terrain.renderingToTexture,le=ie?1:s.q.devicePixelRatio,_e=a.paint.get("line-dasharray"),pe=_e.constantOr(1),we=a.layout.get("line-cap"),ve=_e.constantOr(null),xe=we.constantOr(null),be=a.paint.get("line-pattern"),Ce=be.constantOr(1),Re=be.constantOr(null),Je=a.paint.get("line-opacity").constantOr(1);let $e=!Ce&&Je!==1||m.depthOcclusion&&D>0&&D<1;const ct=a.paint.get("line-gradient"),ut=Ce?"linePattern":"line",vt=s.c$(a);let je;if(ie&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&($e=!1),D!==0&&m.depthOcclusion){const Ne=a.paint._values["line-opacity"];Ne&&Ne.value&&Ne.value.kind==="constant"?je=Ne.value:s.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&vt.push("VARIABLE_LINE_WIDTH");const at=(Ne,ot,st,ht,Qe,ft)=>{for(const Ct of Ne){const Pt=n.getTile(Ct);if(Ce&&!Pt.patternsLoaded())continue;const Dt=Pt.getBucket(a);if(!Dt||Dt.hasZOffset&&!Qe||!Dt.hasZOffset&&Qe)continue;m.prepareDrawTile();const $t=Dt.programConfigurations.get(a.id),pi=m.isTileAffectedByFog(Ct),ti=m.getOrCreateProgram(ut,{config:$t,defines:ot,overrideFog:pi,overrideRtt:!Qe&&void 0});if(Re&&Pt.imageAtlas){const _i=s.d0.from(Re).getPrimary().scaleSelf(le).toString(),Ht=Pt.imageAtlas.patternPositions.get(_i);Ht&&$t.setConstantPatternPositions(Ht)}if(!Ce&&ve&&xe&&Pt.lineAtlas){const _i=Pt.lineAtlas.getDash(ve,xe);_i&&$t.setConstantPatternPositions(_i)}let[hi,oi]=a.paint.get("line-trim-offset");(xe==="round"||xe==="square")&&hi!==oi&&(hi===0&&(hi-=1),oi===1&&(oi+=1));const Di=ie?Ct.projMatrix:null,Wi=z?1/Dt.tileToMeter/s.at(Pt,1,m.transform.zoom):1,mn=z?1/Dt.tileToMeter/s.at(Pt,1,Math.floor(m.transform.zoom)):1,Si=Ce?s.d1(m,Pt,a,Di,le,Wi,mn,[hi,oi]):s.d2(m,Pt,a,Di,Dt.lineClipsArray.length,le,Wi,mn,[hi,oi]);if(ct){const _i=Dt.gradients[a.id];let Ht=_i.texture;if(a.gradientVersion!==_i.version){let Li=256;if(a.stepInterpolant){const en=n.getSource().maxzoom,Vi=Ct.canonical.z===en?Math.ceil(1<<m.transform.maxZoom-Ct.canonical.z):1;Li=s.ay(s.d3(Dt.maxLineLength/s.ai*1024*Vi),256,V.maxTextureSize)}_i.gradient=s.d4({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Li,image:_i.gradient||void 0,clips:Dt.lineClipsArray}),_i.texture?_i.texture.update(_i.gradient):_i.texture=new s.T(V,_i.gradient,U.RGBA8),_i.version=a.gradientVersion,Ht=_i.texture}V.activeTexture.set(U.TEXTURE1),Ht.bind(a.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}pe&&(V.activeTexture.set(U.TEXTURE0),Pt.lineAtlasTexture&&Pt.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),$t.updatePaintBuffers()),Ce&&(V.activeTexture.set(U.TEXTURE0),Pt.imageAtlasTexture&&Pt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),$t.updatePaintBuffers()),Qe&&!F&&m.terrain.setupElevationDraw(Pt,ti),m.uploadCommonUniforms(V,ti,Ct.toUnwrapped());const In=_i=>{je!=null&&(je.value=Je*D),ti.draw(m,U.TRIANGLES,st,_i,ee,fi.disabled,Si,a.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,a.paint,m.transform.zoom,$t,[Dt.layoutVertexBuffer2,Dt.patternVertexBuffer,Dt.zOffsetVertexBuffer]),je!=null&&(je.value=Je)};if($e&&!Qe){const _i=m.stencilModeForClipping(Ct).ref;_i===0&&ie&&V.clear({stencil:0});const Ht={func:U.EQUAL,mask:255};Si.u_alpha_discard_threshold=.8,In(new gi(Ht,_i,255,U.KEEP,U.KEEP,U.INVERT)),Si.u_alpha_discard_threshold=0,In(new gi(Ht,_i,255,U.KEEP,U.KEEP,U.KEEP))}else Si.u_alpha_discard_threshold=$e&&Qe&&ft?.8:0,In(Qe?ht:m.stencilModeForClipping(Ct))}};if(a.hasNonElevatedBuckets){const Ne=!ie&&m.terrain;D!==0&&Ne?s.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ne?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):at(p,vt,m.depthModeForSublayer(0,Jt.ReadOnly),gi.disabled,!1,!0)}if(a.hasElevatedBuckets){vt.push("ELEVATED"),J&&vt.push(X?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&vt.push("ELEVATION_REFERENCE_SEA");const Ne=$e?m.stencilModeFor3D():gi.disabled,ot=new Jt(m.depthOcclusion?U.GREATER:U.LEQUAL,Jt.ReadOnly,m.depthRangeFor3D);m.forceTerrainMode=!0,at(p,vt,ot,Ne,!0,!0),$e&&at(p,vt,ot,Ne,!0,!1),m.forceTerrainMode=!1}$e&&(m.resetStencilClippingMasks(),ie&&V.clear({stencil:0})),D===0||m.depthOcclusion||ie||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,n,a,p){const v=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const T=a.paint.get("fill-emissive-strength"),D=m.colorModeForDrapableLayerRenderPass(T),L=a.paint.get("fill-pattern"),z=m.opaquePassEnabledForLayer()&&!L.constantOr(1)&&v.constantOr(s.al.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let F="none";a.layout.get("fill-elevation-reference")!=="none"?F="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const V=!(!m.terrain||!m.terrain.enabled),U={painter:m,sourceCache:n,layer:a,coords:p,colorMode:D,elevationType:F,terrainEnabled:V,pass:z};if(F!=="offset"){if(nf(U,!1),F==="road"){const q=!V&&m.renderPass==="translucent";q&&Sm(m,n,a,p,"geometry"),nf(U,!0,gi.disabled),q&&function(J){const{painter:X,sourceCache:ee,layer:ie,coords:le,colorMode:_e}=J,pe=X.context.gl,we=new Jt(X.context.gl.LEQUAL,Jt.ReadOnly,X.depthRangeFor3D);for(const ve of le){const xe=ee.getTile(ve),be=xe.getBucket(ie);if(!be)continue;const Ce=be.elevatedStructures;if(!Ce||!Ce.renderableSegments||Ce.renderableSegments.segments[0].primitiveLength===0)continue;X.prepareDrawTile();const Re=be.bufferData.programConfigurations.get(ie.id),Je=X.isTileAffectedByFog(ve),$e=X.getOrCreateProgram("elevatedStructures",{config:Re,overrideFog:Je,defines:["NORMAL_OFFSET"]}),ct={u_matrix:X.translatePosMatrix(ve.projMatrix,xe,ie.paint.get("fill-translate"),ie.paint.get("fill-translate-anchor"))};X.uploadCommonUniforms(X.context,$e,ve.toUnwrapped()),$e.draw(X,pe.TRIANGLES,we,gi.disabled,_e,fi.backCCW,ct,ie.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.renderableSegments,ie.paint,X.transform.zoom,Re,[Ce.vertexBufferNormal])}}(U)}}else nf(U,!1,m.stencilModeFor3D())},"fill-extrusion":function(m,n,a,p){const v=a.paint.get("fill-extrusion-opacity"),b=m.context,T=b.gl,D=m.terrain,L=D&&D.renderingToTexture;if(v===0)return;const z=m.conflationActive&&m.style.isLayerClipped(a,n.getSource()),F=m.style.order.indexOf(a.fqid);if(z&&function(V,U,q,J,X){for(const ee of J){const ie=U.getTile(ee).getBucket(q);ie&&(ie.updateReplacement(ee,V.replacementSource,X),ie.uploadCentroid(V.context))}}(m,n,a,p,F),D||z)for(const V of p){const U=n.getTile(V).getBucket(a);U&&Bc(m.context,n,V,U,a,D,z)}if(m.renderPass==="shadow"&&m.shadowRenderer){const V=m.shadowRenderer;if(D&&v<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const U=V.getShadowPassDepthMode(),q=V.getShadowPassColorMode();fh(m,n,a,p,U,gi.disabled,q,z)}else if(m.renderPass==="translucent"){const V=!a.paint.get("fill-extrusion-pattern").constantOr(1),U=a.paint.get("fill-extrusion-color").constantOr(s.al.white);if(!L&&U.a!==0){const q=new Jt(m.context.gl.LEQUAL,Jt.ReadWrite,m.depthRangeFor3D);v===1&&V?fh(m,n,a,p,q,gi.disabled,Mi.unblended,z):(fh(m,n,a,p,q,gi.disabled,Mi.disabled,z),fh(m,n,a,p,q,m.stencilModeFor3D(),m.colorModeForRenderPass(),z),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&V&&(!D&&m.transform.projection.name!=="globe"||L)){const q=a.paint.get("fill-extrusion-opacity"),J=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ee=a.paint.get("fill-extrusion-flood-light-intensity"),ie=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",le=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(ie?null:a.lut).toArray01().slice(0,3),_e=J>0&&X>0,pe=ee>0,we=(xe,be,Ce)=>(1-Ce)*xe+Ce*be,ve=xe=>{const be=m.depthModeForSublayer(1,Jt.ReadOnly,T.LEQUAL,!0),Ce=a.paint.get(xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=we(.1,3,Ce),Je=m._showOverdrawInspector;if(!Je){const $e=new gi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ct=new Mi([T.ONE,T.ONE,T.ONE,T.ONE],s.al.transparent,[!1,!1,!1,!0],T.MIN);Fc(m,n,a,p,be,$e,ct,fi.disabled,xe,"sdf",q,J,X,ee,le,Re,z,!1)}{const $e=Je?gi.disabled:new gi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ct=Je?m.colorModeForRenderPass():new Mi([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],s.al.transparent,[!0,!0,!0,!0]);Fc(m,n,a,p,be,$e,ct,fi.disabled,xe,"color",q,J,X,ee,le,Re,z,!1)}};if(L){const xe=(be,Ce,Re)=>{const Je=m.depthModeForSublayer(1,Jt.ReadOnly,T.LEQUAL,!1),$e=a.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ct=we(.1,3,$e);{const ut=new Mi([T.ONE,T.ONE,T.ONE,T.ONE],s.al.transparent,[!1,!1,!1,!0]);Fc(m,n,a,p,Je,gi.disabled,ut,fi.disabled,be,"clear",q,J,X,ee,le,ct,z,Ce)}{const ut=new gi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),vt=new Mi([T.ONE,T.ONE,T.ONE,T.ONE],s.al.transparent,[!1,!1,!1,!0],T.MIN);Fc(m,n,a,p,Je,ut,vt,fi.disabled,be,"sdf",q,J,X,ee,le,ct,z,Ce)}{const ut=be?T.ZERO:T.ONE_MINUS_DST_ALPHA,vt=new gi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),je=new Mi([ut,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],s.al.transparent,[!0,!0,!0,!0]);Fc(m,n,a,p,Je,vt,je,fi.disabled,be,"color",q,J,X,ee,le,ct,z,Ce)}{const ut=new Mi([T.ONE,T.ONE,T.ONE,be?T.ZERO:T.ONE],s.al.transparent,[!1,!1,!1,!0],be?T.FUNC_ADD:T.MAX);Fc(m,n,a,p,Je,gi.disabled,ut,fi.disabled,be,"clear",q,J,X,ee,le,ct,z,Ce,Re)}};if(_e||pe){let be;if(m.prepareDrawTile(),D){const Ce=D.drapeBufferSize[0],Re=D.drapeBufferSize[1];be=D.framebufferCopyTexture,be&&(!be||be.size[0]===Ce&&be.size[1]===Re)||(be&&be.destroy(),be=D.framebufferCopyTexture=new s.T(b,new s.r({width:Ce,height:Re}),T.RGBA8)),be.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Ce,Re)}_e&&xe(!0,!1,be),pe&&xe(!1,!0,be)}}else _e&&ve(!0),pe&&ve(!1),(_e||pe)&&m.resetStencilClippingMasks()}}},hillshade:function(m,n,a,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const v=m.context,b=m.terrain&&m.terrain.renderingToTexture,[T,D]=m.renderPass!=="translucent"||b?[{},p]:m.stencilConfigForOverlap(p);for(const L of D){const z=n.getTile(L);if(z.needsHillshadePrepare&&m.renderPass==="offscreen")tb(m,z,a);else if(m.renderPass==="translucent"){const F=m.depthModeForSublayer(0,Jt.ReadOnly),V=a.paint.get("hillshade-emissive-strength"),U=m.colorModeForDrapableLayerRenderPass(V),q=b&&m.terrain?m.terrain.stencilModeForRTTOverlap(L):T[L.overscaledZ];Ic(m,L,z,a,F,q,U)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,n,a,p,v,b){if(m.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const T=m.transform.projection.name==="globe",D=a.paint.get("raster-elevation")!==0,L=D&&T;if(m.renderElevatedRasterBackface&&!L)return;const z=m.context,F=z.gl,V=n.getSource(),U=function(ve,xe,be,Ce){const Re=xe.paint.get("raster-color"),Je=ve.type==="raster-array",$e=[],ct=xe.paint.get("raster-resampling"),ut=xe.paint.get("raster-color-mix");let vt=xe.paint.get("raster-color-range");const je=[ut[0],ut[1],ut[2],0],at=ut[3];let Ne=ct==="nearest"?Ce.NEAREST:Ce.LINEAR;if(Je&&($e.push("RASTER_ARRAY"),Re||$e.push("RASTER_COLOR"),ct==="linear"&&$e.push("RASTER_ARRAY_LINEAR"),Ne=Ce.NEAREST,!vt&&ve.rasterLayers)){const ot=ve.rasterLayers.find(({id:st})=>st===xe.sourceLayer);ot&&ot.fields&&ot.fields.range&&(vt=ot.fields.range)}if(vt=vt||[0,1],Re){$e.push("RASTER_COLOR"),be.activeTexture.set(Ce.TEXTURE2),xe.updateColorRamp(vt);let ot=xe.colorRampTexture;ot||(ot=xe.colorRampTexture=new s.T(be,xe.colorRamp,Ce.RGBA8)),ot.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}return{mix:je,range:vt,offset:at,defines:$e,resampling:Ne}}(V,a,z,F);if(V instanceof s.aK&&!p.length&&!T)return;const q=a.paint.get("raster-emissive-strength"),J=m.colorModeForDrapableLayerRenderPass(q),X=m.terrain&&m.terrain.renderingToTexture,ee=!m.options.moving,ie=a.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(V instanceof s.aK&&!p.length&&(V.onNorthPole||V.onSouthPole)){const ve=D?m.stencilModeFor3D():gi.disabled;return void We(!!V.onNorthPole,null,m,n,a,q,U,fi.disabled,ve)}if(!p.length)return;const[le,_e]=V instanceof s.aK||X?[{},p]:m.stencilConfigForOverlap(p),pe=_e[_e.length-1].overscaledZ;L&&U.defines.push("PROJECTION_GLOBE_VIEW"),D&&U.defines.push("RENDER_CUTOFF");const we=(ve,xe,be)=>{for(const Ce of ve){const Re=Ce.toUnwrapped(),Je=n.getTile(Ce);if(X&&(!Je||!Je.hasData()))continue;z.activeTexture.set(F.TEXTURE0);const $e=sf(Je,V,a,U);if(!$e||!$e.texture)continue;const{texture:ct,mix:ut,offset:vt,tileSize:je,buffer:at}=$e;let Ne,ot;X?(Ne=Jt.disabled,ot=Ce.projMatrix):D?(Ne=new Jt(F.LEQUAL,Jt.ReadWrite,m.depthRangeFor3D),ot=T?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Re,ee)):(Ne=m.depthModeForSublayer(Ce.overscaledZ-pe,a.paint.get("raster-opacity")===1?Jt.ReadWrite:Jt.ReadOnly,F.LESS),ot=m.transform.calculateProjMatrix(Re,ee));const st=m.terrain&&X?m.terrain.stencilModeForRTTOverlap(Ce):le[Ce.overscaledZ],ht=b?0:a.paint.get("raster-fade-duration");Je.registerFadeDuration(ht);const Qe=n.findLoadedParent(Ce,0),ft=Gd(Je,Qe,n,m.transform,ht);let Ct,Pt;m.terrain&&m.terrain.prepareDrawTile(),z.activeTexture.set(F.TEXTURE0),ct.bind(ie,F.CLAMP_TO_EDGE),z.activeTexture.set(F.TEXTURE1),Qe?(Qe.texture&&Qe.texture.bind(ie,F.CLAMP_TO_EDGE),Ct=Math.pow(2,Qe.tileID.overscaledZ-Je.tileID.overscaledZ),Pt=[Je.tileID.canonical.x*Ct%1,Je.tileID.canonical.y*Ct%1]):ct.bind(ie,F.CLAMP_TO_EDGE),"useMipmap"in ct&&z.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Dt=m.transform;let $t;const pi=D?Ny(Dt):[0,0,0,0];let ti,hi,oi,Di,Wi,mn=0;if(L&&V instanceof s.aK&&V.coordinates.length>3)ti=Float32Array.from(s.bc(s.cI(new s.bT(0,0,0)))),hi=Float32Array.from(Dt.globeMatrix),oi=Float32Array.from(s.cE(Dt)),Di=[s.av(Dt.center.lng),s.aC(Dt.center.lat)],$t=V.elevatedGlobePerspectiveTransform,Wi=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(L){const Ht=s.cF(Ce.canonical);mn=s.cG(Ht.getCenter().lat),ti=Float32Array.from(s.bc(s.cI(Ce.canonical))),hi=Float32Array.from(Dt.globeMatrix),oi=Float32Array.from(s.cE(Dt)),Di=[s.av(Dt.center.lng),s.aC(Dt.center.lat)],$t=[0,0],Wi=Float32Array.from(s.cH(Ce.canonical,Ht,mn,Dt.worldSize/Dt._pixelsPerMercatorPixel))}else $t=V instanceof s.aK?V.perspectiveTransform:[0,0],ti=new Float32Array(16),hi=new Float32Array(9),oi=new Float32Array(16),Di=[0,0],Wi=new Float32Array(9);const Si=_m(ot,ti,hi,oi,Wi,Pt||[0,0],s.ag(m.transform.zoom),Di,pi,Ct||1,ft,a,$t,D?a.paint.get("raster-elevation"):0,2,ut,vt,U.range,je,at,q),In=m.isTileAffectedByFog(Ce),_i=m.getOrCreateProgram("raster",{defines:U.defines,overrideFog:In});if(m.uploadCommonUniforms(z,_i,Re),V instanceof s.aK){const Ht=V.elevatedGlobeVertexBuffer,Li=V.elevatedGlobeIndexBuffer;if(X||!T)V.boundsBuffer&&V.boundsSegments&&_i.draw(m,F.TRIANGLES,Ne,gi.disabled,J,fi.disabled,Si,a.id,V.boundsBuffer,m.quadTriangleIndexBuffer,V.boundsSegments);else if(Ht&&Li){const en=Dt.zoom<=s.c6?V.elevatedGlobeSegments:V.getSegmentsForLongitude(Dt.center.lng);en&&_i.draw(m,F.TRIANGLES,Ne,gi.disabled,J,xe,Si,a.id,Ht,Li,en)}}else if(L){Ne=new Jt(F.LEQUAL,Jt.ReadOnly,m.depthRangeFor3D);const Ht=m.globeSharedBuffers;if(Ht){const[Li,en,Vi]=Ht.getGridBuffers(mn,!1);_i.draw(m,F.TRIANGLES,Ne,be||st,m.colorModeForRenderPass(),xe,Si,a.id,Li,en,Vi)}}else{const{tileBoundsBuffer:Ht,tileBoundsIndexBuffer:Li,tileBoundsSegments:en}=m.getTileBoundsBuffers(Je);_i.draw(m,F.TRIANGLES,Ne,st,J,fi.disabled,Si,a.id,Ht,Li,en)}}if(!(V instanceof s.aK)&&L)for(const Ce of ve){const Re=Ce.canonical.y===(1<<Ce.canonical.z)-1;Ce.canonical.y===0&&We(!0,Ce,m,n,a,q,U,xe,be||gi.disabled),Re&&We(!1,Ce,m,n,a,q,U,xe===fi.frontCW?fi.backCW:fi.frontCW,be||gi.disabled)}};L?we(_e,m.renderElevatedRasterBackface?fi.backCW:fi.frontCW,m.stencilModeFor3D()):we(_e,fi.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,n,a,p,v,b){m.renderPass==="offscreen"&&function(T,D,L,z){if(!z.length)return;const F=T.context,V=F.gl,U=D.getSource();if(!(U instanceof ua))return;const q=Math.ceil(Math.sqrt(L.paint.get("raster-particle-count")));let J=L.particlePositionRGBAImage;if(!J||J.width!==q){const _e=function(pe){const we=pe*pe,ve=new Uint8Array(4*we),xe=function(Ce){return Ce|=0,Ce=Math.imul(2747636419^Ce,2654435769),Ce=Math.imul(Ce^Ce>>>16,2654435769),((Ce=Math.imul(Ce^Ce>>>16,2654435769))>>>0)/4294967296},be=1/1.1;for(let Ce=0;Ce<we;Ce++){const Re=be*(xe(2*Ce+0)+$r),Je=be*(xe(2*Ce+1)+$r),$e=255*Re%1,ct=255*Je%1,ut=$e,vt=Je-ct/255,je=ct;ve[4*Ce+0]=255*(Re-$e/255),ve[4*Ce+1]=255*ut,ve[4*Ce+2]=255*vt,ve[4*Ce+3]=255*je}return ve}(q);J=L.particlePositionRGBAImage=new s.r({width:q,height:q},_e)}let X=L.particleFramebuffer;X?X.width!==q&&(X.destroy(),X=L.particleFramebuffer=F.createFramebuffer(q,q,!0,null)):X=L.particleFramebuffer=F.createFramebuffer(q,q,!0,null);const ee=[];for(const _e of z){const pe=D.getTile(_e);if(!(pe instanceof pr))continue;const we=Vy(pe,U,L);if(!we)continue;const ve=[pe.tileSize,pe.tileSize];let xe=L.tileFramebuffer;xe||(xe=L.tileFramebuffer=F.createFramebuffer(ve[0],ve[1],!0,null));let be=pe.rasterParticleState;be||(be=pe.rasterParticleState=new Mm(F,_e,ve,J));const Ce=be.update(L.lastInvalidatedAt);be.particleTextureDimension!==q&&be.updateParticleTexture(_e,J);const Re=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=Re;const Je=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=Je,ee.push([_e,we,be,Ce])}if(ee.length===0)return;const ie=s.q.now(),le=L.previousDrawTimestamp?.001*(ie-L.previousDrawTimestamp):.0167;if(L.previousDrawTimestamp=ie,L.hasColorMap()){F.activeTexture.set(V.TEXTURE0+2);let _e=L.colorRampTexture;_e||(_e=L.colorRampTexture=new s.T(F,L.colorRamp,V.RGBA8)),_e.bind(V.LINEAR,V.CLAMP_TO_EDGE)}F.bindFramebuffer.set(L.tileFramebuffer.framebuffer),function(_e,pe,we){const ve=_e.context,xe=ve.gl,be=pe.tileFramebuffer;ve.activeTexture.set(xe.TEXTURE0);const Ce={u_texture:0,u_opacity:1.05*(Je=pe.paint.get("raster-particle-fade-opacity-factor"))/(Je+.05)},Re=_e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Je;for(const $e of we){const[,,ct,ut]=$e;be.colorAttachment.set(ct.targetColorTexture.texture),ve.viewport.set([0,0,be.width,be.height]),ve.clear({color:s.al.transparent}),ut&&(ct.backgroundColorTexture.bind(xe.NEAREST,xe.CLAMP_TO_EDGE),Re.draw(_e,xe.TRIANGLES,Jt.disabled,gi.disabled,Mi.alphaBlended,fi.disabled,Ce,pe.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments))}}(T,L,ee),function(_e,pe,we,ve){const xe=_e.context,be=xe.gl,Ce=we.tileFramebuffer,Re=_e.transform.projection.name==="globe",Je=we.paint.get("raster-particle-max-speed");for(const $e of ve){const[ct,ut,vt]=$e;xe.activeTexture.set(be.TEXTURE0+0),ut.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Ce.colorAttachment.set(vt.targetColorTexture.texture);const je=_e.getOrCreateProgram("rasterParticleDraw",{defines:ut.defines,overrideFog:!1});xe.activeTexture.set(be.TEXTURE0+1);const at=ut.scalarData?[]:[0,1,2,3].map(st=>s.d7[st](ct));at.push(ct);const Ne=ct.canonical.x,ot=ct.canonical.y;for(const st of at){const ht=pe.getTile(Re?st.wrapped():st);if(!ht)continue;const Qe=ht.rasterParticleState;if(!Qe)continue;const ft=st.canonical.x+(1<<st.canonical.z)*(st.wrap-ct.wrap),Ct=st.canonical.y;Qe.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Pt=ym(1,Qe.particleTexture0.size[0],[ft-Ne,Ct-ot],0,ut.texture.size,2,Je,ut.textureOffset,ut.scale,ut.offset);je.draw(_e,be.POINTS,Jt.disabled,gi.disabled,Mi.alphaBlended,fi.disabled,Pt,we.id,Qe.particleIndexBuffer,void 0,Qe.particleSegment)}}}(T,D,L,ee),F.bindFramebuffer.set(L.particleFramebuffer.framebuffer),function(_e,pe,we,ve){const xe=_e.context,be=xe.gl,Ce=pe.paint.get("raster-particle-max-speed"),Re=ve*pe.paint.get("raster-particle-speed-factor")*.15,Je=function(ct){return Math.pow(ct,6)}(.01+1*pe.paint.get("raster-particle-reset-rate-factor")),$e=pe.particleFramebuffer;xe.viewport.set([0,0,$e.width,$e.height]);for(const ct of we){const[,ut,vt]=ct;xe.activeTexture.set(be.TEXTURE0+0),ut.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),xe.activeTexture.set(be.TEXTURE0+1);const je=vt.particleTexture0;je.bind(be.NEAREST,be.CLAMP_TO_EDGE);const at=hb(1,je.size[0],0,ut.texture.size,Ce,Re,Je,ut.textureOffset,ut.scale,ut.offset);$e.colorAttachment.set(vt.particleTexture1.texture),xe.clear({color:s.al.transparent}),_e.getOrCreateProgram("rasterParticleUpdate",{defines:ut.defines}).draw(_e,be.TRIANGLES,Jt.disabled,gi.disabled,Mi.unblended,fi.disabled,at,pe.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments)}}(T,L,ee,le)}(m,n,a,p),m.renderPass==="translucent"&&(function(T,D,L,z,F){const V=T.context,U=V.gl,q=D.getSource().tileSize,J=5*(1-s.ae(s.bY,s.bY+1,T.transform.zoom))*q+L.paint.get("raster-particle-elevation"),X=!T.options.moving,ee=T.transform.projection.name==="globe";if(!z.length)return;const[ie,le]=T.stencilConfigForOverlap(z),_e=[];ee&&_e.push("PROJECTION_GLOBE_VIEW");const pe=T.stencilModeFor3D();for(const we of le){const ve=we.toUnwrapped(),xe=D.getTile(we);if(!xe.rasterParticleState)continue;const be=xe.rasterParticleState,Ce=100;xe.registerFadeDuration(Ce);const Re=D.findLoadedParent(we,0),Je=Gd(xe,Re,D,T.transform,Ce);let $e,ct;T.terrain&&T.terrain.prepareDrawTile(),V.activeTexture.set(U.TEXTURE0),be.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),V.activeTexture.set(U.TEXTURE1),Re&&Re.rasterParticleState?(Re.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),$e=Math.pow(2,Re.tileID.overscaledZ-xe.tileID.overscaledZ),ct=[xe.tileID.canonical.x*$e%1,xe.tileID.canonical.y*$e%1]):be.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ut=ee?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(ve,X),vt=T.transform,je=Uy(vt),at=s.cF(we.canonical),Ne=s.cG(at.getCenter().lat);let ot,st,ht,Qe,ft;ee?(ot=Float32Array.from(s.bc(s.cI(we.canonical))),st=Float32Array.from(vt.globeMatrix),ht=Float32Array.from(s.cE(vt)),Qe=[s.av(vt.center.lng),s.aC(vt.center.lat)],ft=Float32Array.from(s.cH(we.canonical,at,Ne,vt.worldSize/vt._pixelsPerMercatorPixel))):(ot=new Float32Array(16),st=new Float32Array(9),ht=new Float32Array(16),Qe=[0,0],ft=new Float32Array(9));const Ct=Qt(ut,ot,st,ht,ft,ct||[0,0],s.ag(T.transform.zoom),Qe,je,$e||1,Je,J),Pt=T.isTileAffectedByFog(we),Dt=T.getOrCreateProgram("rasterParticle",{defines:_e,overrideFog:Pt});if(T.uploadCommonUniforms(V,Dt,ve),ee){const $t=new Jt(U.LEQUAL,Jt.ReadOnly,T.depthRangeFor3D),pi=0,ti=T.globeSharedBuffers;if(ti){const[hi,oi,Di]=ti.getGridBuffers(Ne,pi!==0);Dt.draw(T,U.TRIANGLES,$t,pe,Mi.alphaBlended,T.renderElevatedRasterBackface?fi.frontCCW:fi.backCCW,Ct,L.id,hi,oi,Di)}}else{const $t=T.depthModeForSublayer(0,Jt.ReadOnly),pi=ie[we.overscaledZ],{tileBoundsBuffer:ti,tileBoundsIndexBuffer:hi,tileBoundsSegments:oi}=T.getTileBoundsBuffers(xe);Dt.draw(T,U.TRIANGLES,$t,pi,Mi.alphaBlended,fi.disabled,Ct,L.id,ti,hi,oi)}}T.resetStencilClippingMasks()}(m,n,a,p),m.style.map.triggerRepaint())},background:function(m,n,a,p){const v=a.paint.get("background-color"),b=a.paint.get("background-color-use-theme").constantOr("default")==="none",T=a.paint.get("background-opacity"),D=a.paint.get("background-emissive-strength"),L=a.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const z=m.context,F=z.gl,V=m.transform,U=V.tileSize,q=a.paint.get("background-pattern");let J;if(q!==void 0&&(q===null||(J=m.imageManager.getPattern(s.I.from(q.toString()),a.scope,m.style.getLut(a.scope)),!J)))return;const X=!q&&v.a===1&&T===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==X)return;const ee=gi.disabled,ie=m.depthModeForSublayer(0,X==="opaque"?Jt.ReadWrite:Jt.ReadOnly),le=m.colorModeForDrapableLayerRenderPass(D),_e=q?"backgroundPattern":"background";let pe,we=p;if(we||(pe=m.getBackgroundTiles(),we=Object.values(pe).map(ve=>ve.tileID)),q&&(z.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context,a.scope)),L){const ve=m.getOrCreateProgram(_e,{overrideFog:!1,overrideRtt:!0}),xe=new Float32Array(s.ad.mat4.identity([])),be=new s.aH(0,0,0,0,0),Ce=q?zy(xe,D,T,m,0,a.scope,J,L,{tileID:be,tileSize:U}):vm(xe,D,T,v.toRenderColor(b?null:a.lut));ve.draw(m,F.TRIANGLES,ie,ee,le,fi.disabled,Ce,a.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const ve of we){const xe=m.isTileAffectedByFog(ve),be=m.getOrCreateProgram(_e,{overrideFog:xe}),Ce=ve.toUnwrapped(),Re=p?ve.projMatrix:m.transform.calculateProjMatrix(Ce);m.prepareDrawTile();const Je=n?n.getTile(ve):pe?pe[ve.key]:new wo(ve,U,V.zoom,m),$e=q?zy(Re,D,T,m,0,a.scope,J,L,{tileID:ve,tileSize:U}):vm(Re,D,T,v.toRenderColor(b?null:a.lut));m.uploadCommonUniforms(z,be,Ce);const{tileBoundsBuffer:ct,tileBoundsIndexBuffer:ut,tileBoundsSegments:vt}=m.getTileBoundsBuffers(Je);be.draw(m,F.TRIANGLES,ie,ee,le,fi.disabled,$e,a.id,ct,ut,vt)}},sky:function(m,n,a){const p=m._atmosphere?s.ag(m.transform.zoom):1,v=a.paint.get("sky-opacity")*p;if(v===0)return;const b=m.context,T=a.paint.get("sky-type"),D=new Jt(b.gl.LEQUAL,Jt.ReadOnly,[0,1]),L=m.frameCounter/1e3%1;T==="atmosphere"?m.renderPass==="offscreen"?a.needsSkyboxCapture(m)&&(function(z,F,V,U){const q=z.context,J=q.gl;let X=F.skyboxFbo;if(!X){X=F.skyboxFbo=q.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new $y(q),F.skyboxTexture=q.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,F.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let _e=0;_e<6;++_e)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(X.framebuffer),q.viewport.set([0,0,32,32]);const ee=F.getCenter(z,!0),ie=z.getOrCreateProgram("skyboxCapture"),le=new Float64Array(16);s.ad.mat4.identity(le),s.ad.mat4.rotateY(le,le,.5*-Math.PI),Ms(z,F,ie,le,ee,0),s.ad.mat4.identity(le),s.ad.mat4.rotateY(le,le,.5*Math.PI),Ms(z,F,ie,le,ee,1),s.ad.mat4.identity(le),s.ad.mat4.rotateX(le,le,.5*-Math.PI),Ms(z,F,ie,le,ee,2),s.ad.mat4.identity(le),s.ad.mat4.rotateX(le,le,.5*Math.PI),Ms(z,F,ie,le,ee,3),s.ad.mat4.identity(le),Ms(z,F,ie,le,ee,4),s.ad.mat4.identity(le),s.ad.mat4.rotateY(le,le,Math.PI),Ms(z,F,ie,le,ee,5),q.viewport.set([0,0,z.width,z.height])}(m,a),a.markSkyboxValid(m)):m.renderPass==="sky"&&function(z,F,V,U,q){const J=z.context,X=J.gl,ee=z.transform,ie=z.getOrCreateProgram("skybox");J.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,F.skyboxTexture);const le=((_e,pe,we,ve,xe)=>({u_matrix:_e,u_sun_direction:pe,u_cubemap:0,u_opacity:ve,u_temporal_offset:xe}))(ee.skyboxMatrix,F.getCenter(z,!1),0,U,q);z.uploadCommonUniforms(J,ie),ie.draw(z,X.TRIANGLES,V,gi.disabled,z.colorModeForRenderPass(),fi.backCW,le,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,a,D,v,L):T==="gradient"&&m.renderPass==="sky"&&function(z,F,V,U,q){const J=z.context,X=J.gl,ee=z.transform,ie=z.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new $y(J)),J.activeTexture.set(X.TEXTURE0);let le=F.colorRampTexture;le||(le=F.colorRampTexture=new s.T(J,F.colorRamp,X.RGBA8)),le.bind(X.LINEAR,X.CLAMP_TO_EDGE);const _e=((pe,we,ve,xe,be)=>({u_matrix:pe,u_color_ramp:0,u_center_direction:we,u_radius:s.ak(ve),u_opacity:xe,u_temporal_offset:be}))(ee.skyboxMatrix,F.getCenter(z,!1),F.paint.get("sky-gradient-radius"),U,q);z.uploadCommonUniforms(J,ie),ie.draw(z,X.TRIANGLES,V,gi.disabled,z.colorModeForRenderPass(),fi.backCW,_e,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,a,D,v,L)},debug:function(m,n,a,p,v,b){for(let T=0;T<a.length;T++)if(v){const z=new s.al(p.r*.8,p.g*.8,p.b*.8,1);Ja(m,n,a[T],p,-1,-1,b),Ja(m,n,a[T],p,-1,1,b),Ja(m,n,a[T],p,1,1,b),Ja(m,n,a[T],p,1,-1,b),Ja(m,n,a[T],z,0,0,b)}else Ja(m,n,a[T],p,0,0,b)},custom:function(m,n,a,p){const v=m.context,b=a.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&a.isDraped(n)){if(m.renderPass==="offscreen"){const T=b.prerender;if(T){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const D=m.transform.pointMerc;T.call(b,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.ag(m.transform.zoom),[D.x,D.y],m.transform.pixelsPerMeterRatio)}else T.call(b,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const D=b.renderToTile;if(D){const L=p[0].canonical,z=new s.ac(L.x+p[0].wrap*(1<<L.z),L.y,L.z);v.setDepthMode(Jt.disabled),v.setStencilMode(gi.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),D.call(b,v.gl,z),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(gi.disabled);const T=b.renderingMode==="3d"?new Jt(m.context.gl.LEQUAL,Jt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Jt.ReadOnly);if(v.setDepthMode(T),m.transform.projection.name==="globe"){const D=m.transform.pointMerc;b.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.ag(m.transform.zoom),[D.x,D.y],m.transform.pixelsPerMeterRatio)}else b.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,n,a,p){if(m.renderPass==="opaque")return;const v=a.paint.get("model-opacity").constantOr(1);if(v===0)return;const b=a.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!b||m.terrain&&v<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const T=m.shadowRenderer,D=a.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,D||(T.enabled=!1));const L=()=>{T&&(T.useNormalOffset=!0,D||(T.enabled=!0))},z=n.getSource();if(m.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(ie,le,_e,pe,we){const ve=ie.transform;if(ve.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${ve.projection.name} projection is not yet implemented`);const xe=ve.getFreeCameraOptions().position;if(!ie.modelManager)return;const be=ie.modelManager;_e.modelManager=be;const Ce=ie.shadowRenderer;if(!_e._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Re=_e._unevaluatedLayout._values["model-id"],Je=Object.assign({},_e.layout.get("model-id").parameters),$e=ie.style.order.indexOf(_e.fqid);for(const ct of pe){const ut=le.getTile(ct).getBucket(_e);if(!ut||ut.projection.name!==ve.projection.name)continue;const vt=ut.getModelUris();vt&&!ut.modelsRequested&&(be.addModelsFromBucket(vt,we),ut.modelsRequested=!0);const je=Dm(ct,ve);Je.zoom=je;const at=Re.possiblyEvaluate(Je);if(Pm(ie,ut,ct),ao.shadowUniformsInitialized=!1,ao.useSingleShadowCascade=!!Ce&&Ce.getMaxCascadeForTile(ct.toUnwrapped())===0,ie.renderPass==="shadow"&&Ce){if(ie.currentShadowCascade===1&&ut.isInsideFirstShadowMapFrustum)continue;const st=ve.calculatePosMatrix(ct.toUnwrapped(),ve.worldSize);if(ao.tileMatrix.set(st),ao.shadowTileMatrix=Float32Array.from(Ce.calculateShadowPassMatrixFromMatrix(st)),ao.aabb.min.fill(0),ao.aabb.max[0]=ao.aabb.max[1]=s.ai,ao.aabb.max[2]=0,af(ut,ao,ie,_e.scope))continue}const Ne=1<<ct.canonical.z,ot=[((xe.x-ct.wrap)*Ne-ct.canonical.x)*s.ai,(xe.y*Ne-ct.canonical.y)*s.ai,xe.z*Ne*s.ai];ie.conflationActive&&Object.keys(ut.instancesPerModel).length>0&&ie.style.isLayerClipped(_e,le.getSource())&&ut.updateReplacement(ct,ie.replacementSource,$e,we)&&(ut.uploaded=!1,ut.upload(ie.context));for(let st in ut.instancesPerModel){const ht=ut.instancesPerModel[st];ht.features.length>0&&(st=at.evaluate(ht.features[0].feature,{}));const Qe=be.getModel(st,we);if(Qe&&Qe.uploaded)for(const ft of Qe.nodes)Ao(ie,_e,ft,ht,ot,ct,ao)}}}(m,n,a,p,z.type==="vector"?a.scope:""),void L();if(!z.loaded())return;if(z.type==="batched-model")return function(ie,le,_e,pe){_e.resetLayerRenderingStats(ie);const we=ie.context,ve=ie.transform,xe=ie.style.fog,be=ie.shadowRenderer;if(ve.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${ve.projection.name} projection is not yet implemented`);const Ce=ie.transform.getFreeCameraOptions().position,Re=s.ad.vec3.scale([],[Ce.x,Ce.y,Ce.z],ie.transform.worldSize),Je=s.ad.vec3.negate([],Re),$e=s.ad.mat4.identity([]),ct=s.dm(ve.center.lat,ve.zoom),ut=s.ad.mat4.fromScaling([],[1,1,1/ct]);s.ad.mat4.translate($e,$e,Je);const vt=_e.paint.get("model-opacity").constantOr(1),je=new Jt(we.gl.LEQUAL,Jt.ReadWrite,ie.depthRangeFor3D),at=new Jt(we.gl.LEQUAL,Jt.ReadOnly,ie.depthRangeFor3D),Ne=new s.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=ie.renderPass==="shadow",st=ot&&be?be.getCurrentCascadeFrustum():ve.getFrustum(ve.scaleZoom(ve.worldSize)),ht=_e.paint.get("model-front-cutoff"),Qe=ht[2]<1,ft=_a(ie,_e.paint.get("model-cutoff-fade-range")),Ct=_e.getLayerRenderingStats();(function(Pt,Dt,$t,pi){const ti=Pt.terrain?Pt.terrain.exaggeration():0,hi=Pt.transform.zoom;for(const oi of pi){const Di=Dt.getTile(oi).getBucket($t);Di&&(Di.setFilter($t.filter),Pt.conflationActive&&Di.updateReplacement(oi,Pt.replacementSource),Di.evaluateScale(Pt,$t),Pt.terrain&&ti>0&&Di.elevationUpdate(Pt.terrain,ti,oi,$t.source),Di.needsReEvaluation(Pt,hi,$t)&&Di.evaluate($t))}})(ie,le,_e,pe),function(){let Pt,Dt,$t;Qe?(Pt=pe.length-1,Dt=-1,$t=-1):(Pt=0,Dt=pe.length,$t=1);const pi=new Float64Array(16),ti=s.ad.vec3.create(),hi=new s.P(0,0);for(let oi=Pt;oi!==Dt;oi+=$t){const Di=pe[oi],Wi=le.getTile(Di).getBucket(_e);if(!Wi||!Wi.uploaded)continue;let mn=!1;be&&(mn=be.getMaxCascadeForTile(Di.toUnwrapped())===0);const Si=ve.calculatePosMatrix(Di.toUnwrapped(),ve.worldSize),In=Wi.modelTraits;!ot&&Qe&&(s.ad.mat4.invert(pi,Si),s.ad.vec3.transformMat4(ti,Re,pi),hi.x=ti[0],hi.y=ti[1]);const _i=[];Wi.setFilter(_e.filter);for(const Ht of Wi.getNodesInfo()){if(Ht.hiddenByReplacement||!Ht.node.meshes)continue;const Li=Ht.node;let en=0;ie.terrain&&Li.elevation&&(en=Li.elevation*ie.terrain.exaggeration());const Vi=(()=>{const hn=Ht.aabb;return Ne.min=[...hn.min],Ne.max=[...hn.max],Ne.min[2]+=en,Ne.max[2]+=en,s.ad.vec3.transformMat4(Ne.min,Ne.min,Si),s.ad.vec3.transformMat4(Ne.max,Ne.max,Si),Ne})(),Nn=Ht.evaluatedScale;if(Nn[0]<=1&&Nn[1]<=1&&Nn[2]<=1&&Vi.intersects(st)===0)continue;if(!ot&&Qe){const hn=.16666666666666666;Ht.cameraCollisionOpacity=Re[0]>Vi.min[0]&&Re[0]<Vi.max[0]&&Re[1]>Vi.min[1]&&Re[1]<Vi.max[1]&&Re[2]*ct<Vi.max[2]&&Li.footprint&&s.bA(hi,Li.footprint)?Math.max(Ht.cameraCollisionOpacity-hn,0):Math.min(1,Ht.cameraCollisionOpacity+hn)}const Jn=[...Si],fs=Li.anchor?Li.anchor[0]:0,xs=Li.anchor?Li.anchor[1]:0;s.ad.mat4.translate(Jn,Jn,[fs*(Nn[0]-1),xs*(Nn[1]-1),en]),s.ad.vec3.exactEquals(Nn,s.dq)||s.ad.mat4.scale(Jn,Jn,Nn);const qr=s.ad.mat4.multiply([],Jn,Li.matrix),Js=s.ad.mat4.multiply([],ve.expandedFarZProjMatrix,qr),zi=s.ad.mat4.multiply([],ve.expandedFarZProjMatrix,Jn),Cn=s.ad.vec4.transformMat4([],[fs,xs,en,1],Js)[2];Li.hidden=!1;let Zi=vt;ot||(Qe&&(Zi*=Ht.cameraCollisionOpacity,Zi*=Rm(Jn,ve,Ht.aabb,ht)),Zi*=lf(ft,Cn)),Zi!==0?_i.push({nodeInfo:Ht,depth:Cn,opacity:Zi,wvpForNode:Js,wvpForTile:zi,nodeModelMatrix:qr,tileModelMatrix:Jn}):Li.hidden=!0}ot||_i.sort((Ht,Li)=>!Qe||Ht.opacity===1&&Li.opacity===1?Ht.depth<Li.depth?-1:1:Ht.opacity===1?-1:Li.opacity===1?1:Ht.depth>Li.depth?-1:1);for(const Ht of _i){const Li=Ht.nodeInfo,en=Li.node;let Vi=s.ad.mat4.multiply([],ut,Ht.tileModelMatrix);s.ad.mat4.multiply(Vi,$e,Vi);const Nn=s.ad.mat4.invert([],Vi);s.ad.mat4.transpose(Nn,Nn),s.ad.mat4.scale(Nn,Nn,Qa),Vi=s.ad.mat4.multiply(Vi,Vi,en.matrix);const Jn=ie.renderPass==="light-beam",fs=_e.paint.get("model-color-use-theme").constantOr("default")==="none",xs=In&s.ds.HasMapboxMeshFeatures,qr=xs?0:Li.evaluatedRMEA[0][2];for(let Js=0;Js<en.meshes.length;++Js){const zi=en.meshes[Js],Cn=Js===en.lightMeshIndex;let Zi=Ht.wvpForNode;if(Cn){if(!Jn&&!ie.terrain&&ie.shadowRenderer){ie.currentLayer<ie.firstLightBeamLayer&&(ie.firstLightBeamLayer=ie.currentLayer);continue}Zi=Ht.wvpForTile}else if(Jn)continue;const hn={defines:[]},Os=[];if(!ot&&be&&(be.useNormalOffset=!!zi.normalBuffer),$c(hn.defines,Os,zi,ie,fs?null:_e.lut),xs||hn.defines.push("DIFFUSE_SHADED"),mn&&hn.defines.push("SHADOWS_SINGLE_CASCADE"),Ct&&(ot?Ct.numRenderedVerticesInShadowPass+=zi.vertexArray.length:Ct.numRenderedVerticesInTransparentPass+=zi.vertexArray.length),ot){mh(zi,Ht.nodeModelMatrix,ie,_e);continue}let Tn=null;if(xe){const uo=wa(Ht.nodeModelMatrix,ie.transform);if(Tn=new Float32Array(uo),ve.projection.name!=="globe"){const Ar=zi.aabb.min,Sa=zi.aabb.max,[Yo,Aa]=xe.getOpacityForBounds(uo,Ar[0],Ar[1],Sa[0],Sa[1]);hn.overrideFog=Yo>=Ot||Aa>=Ot}}const ps=zi.material;let Xo;ps.occlusionTexture&&ps.occlusionTexture.offsetScale&&(Xo=ps.occlusionTexture.offsetScale,hn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Sr=ie.getOrCreateProgram("model",hn);!ot&&be&&be.setupShadowsFromMatrix(Ht.tileModelMatrix,Sr,be.useNormalOffset),ie.uploadCommonUniforms(we,Sr,null,Tn);const co=ps.pbrMetallicRoughness;co.metallicFactor=.9,co.roughnessFactor=.5;const gr=xm(new Float32Array(Zi),new Float32Array(Vi),new Float32Array(Nn),new Float32Array(en.matrix),ie,Ht.opacity,co.baseColorFactor.toRenderColor(null),ps.emissiveFactor,co.metallicFactor,co.roughnessFactor,ps,qr,_e,[0,0,0],Xo);!Cn&&(Li.hasTranslucentParts||Ht.opacity<1)&&Sr.draw(ie,we.gl.TRIANGLES,je,gi.disabled,Mi.disabled,fi.backCCW,gr,_e.id,zi.vertexBuffer,zi.indexBuffer,zi.segments,_e.paint,ie.transform.zoom,void 0,Os),Sr.draw(ie,we.gl.TRIANGLES,Cn?at:je,gi.disabled,Cn||Ht.opacity<1||Li.hasTranslucentParts?Mi.alphaBlended:Mi.unblended,fi.backCCW,gr,_e.id,zi.vertexBuffer,zi.indexBuffer,zi.segments,_e.paint,ie.transform.zoom,void 0,Os)}}}}()}(m,n,a,p),void L();if(z.type!=="model")return;const F=z.getModels(),V=[],U=m.transform.getFreeCameraOptions().position,q=s.ad.vec3.scale([],[U.x,U.y,U.z],m.transform.worldSize);s.ad.vec3.negate(q,q);const J=[],X=[];let ee=0;for(const ie of F){const le=a.paint.get("model-rotation").constantOr(null),_e=a.paint.get("model-scale").constantOr(null),pe=a.paint.get("model-translation").constantOr(null);ie.computeModelMatrix(m,le,_e,pe,!0,!0,!1);const we=s.ad.mat4.identity([]),ve=s.dm(ie.position.lat,m.transform.zoom),xe=s.ad.mat4.fromScaling([],[1,1,1/ve]);s.ad.mat4.translate(we,we,q),V.push({zScaleMatrix:xe,negCameraPosMatrix:we});for(const be of ie.nodes)Cl(m.transform,be,ie.matrix,m.transform.expandedFarZProjMatrix,ee,J,X);ee++}if(J.sort((ie,le)=>le.depth-ie.depth),m.renderPass!=="shadow"){if(v===1)for(const ie of X)Ta(ie,m,a,V[ie.modelIndex],gi.disabled,m.colorModeForRenderPass());else{for(const ie of X)Ta(ie,m,a,V[ie.modelIndex],gi.disabled,Mi.disabled);for(const ie of X)Ta(ie,m,a,V[ie.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const ie of J)Ta(ie,m,a,V[ie.modelIndex],gi.disabled,m.colorModeForRenderPass());L()}else{for(const ie of X)mh(ie.mesh,ie.nodeModelMatrix,m,a);for(const ie of J)mh(ie.mesh,ie.nodeModelMatrix,m,a);L()}}},df={line:function(m,n,a){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const p=n.getVisibleCoordinates();for(const v of p){const b=n.getTile(v).getBucket(m);if(b&&(b.hasZOffset?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,n,a){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,p.type==="vector"?m.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const v=p.getModels();for(const b of v)b.upload(a.context)},raster:function(m,n,a){const p=n.getSource();if(!(p instanceof ua&&p.loaded()))return;const v=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!v)return;const b=m.paint.get("raster-array-band")||p.getInitialBand(v);if(b==null)return;const T=n.getIds().map(D=>n.getTileByID(D));for(const D of T)D.updateNeeded(v,b)&&p.prepareTile(D,v,b)},"raster-particle":function(m,n,a){const p=n.getSource();if(!(p instanceof ua&&p.loaded()))return;const v=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!v)return;const b=m.paint.get("raster-particle-array-band")||p.getInitialBand(v);if(b==null)return;const T=n.getIds().map(D=>n.getTileByID(D));for(const D of T)D.updateNeeded(v,b)&&p.prepareTile(D,v,b)}},ff={fill:Sm};class pf{constructor(n,a,p,v,b){this.context=new Ka(n,a),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const L of T)this._debugParams.enabledLayers[L]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new Om(b),this.setup(),this.numSublayers=no.maxUnderzooming+no.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ya(this),this._wireframeDebugCache=new Pl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const D=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,D,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v}updateTerrain(n,a){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Py(this,n));const v=this._terrain;this.transform.elevation=p?v:null,v.update(n,this.transform,a),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,v]=a.getFovAdjustedRange(this.transform._fov);if(p>v)return void(this.transform.fogCullDistSq=null);const b=p+.78*(v-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new Py(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,a){if(this.width=n*s.q.devicePixelRatio,this.height=a*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,a=new s.b5;a.emplaceBack(0,0),a.emplaceBack(s.ai,0),a.emplaceBack(0,s.ai),a.emplaceBack(s.ai,s.ai),this.tileExtentBuffer=n.createVertexBuffer(a,s.b7.members),this.tileExtentSegments=s.b8.simpleSegment(0,0,4,2);const p=new s.b5;p.emplaceBack(0,0),p.emplaceBack(s.ai,0),p.emplaceBack(0,s.ai),p.emplaceBack(s.ai,s.ai),this.debugBuffer=n.createVertexBuffer(p,s.b7.members),this.debugSegments=s.b8.simpleSegment(0,0,4,5);const v=new s.b5;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(v,s.b7.members),this.viewportSegments=s.b8.simpleSegment(0,0,4,2);const b=new s.aU;b.emplaceBack(0,0,0,0),b.emplaceBack(s.ai,0,s.ai,0),b.emplaceBack(0,s.ai,0,s.ai),b.emplaceBack(s.ai,s.ai,s.ai,s.ai),this.mercatorBoundsBuffer=n.createVertexBuffer(b,s.ba.members),this.mercatorBoundsSegments=s.b8.simpleSegment(0,0,4,2);const T=new s.aV;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T);const D=new s.b6;for(const z of[0,1,3,2,0])D.emplaceBack(z);this.debugIndexBuffer=n.createIndexBuffer(D),this.emptyTexture=new s.T(n,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=s.ad.mat4.create();const L=this.context.gl;this.stencilClearMode=new gi({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Jt.disabled,this.stencilClearMode,Mi.disabled,fi.disabled,Dc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,p){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const L of p)if(this._tileClippingMaskIDs[L.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=a.id;const v=this.context,b=v.gl;this.nextStencilID+p.length>256&&this.clearStencil(),v.setColorMode(Mi.disabled),v.setDepthMode(Jt.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of p){const L=a.getTile(D),z=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:U}=this.getTileBoundsBuffers(L);T.draw(this,b.TRIANGLES,Jt.disabled,new gi({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),Mi.disabled,fi.disabled,Dc(D.projMatrix),"$clipping",F,V,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new gi({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new gi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,p=n.sort((T,D)=>D.overscaledZ-T.overscaledZ),v=p[p.length-1].overscaledZ,b=p[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let D=0;D<b;D++)T[D+v]=new gi({func:a.GEQUAL,mask:255},D+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[T,p]}return[{[v]:gi.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Mi([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mi.unblended:Mi.alphaBlended}colorModeForDrapableLayerRenderPass(n){const a=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new Mi([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new s.al(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,a,p,v=!1){if(this.depthOcclusion)return new Jt(this.context.gl.GREATER,Jt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return Jt.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Jt(p||this.context.gl.LEQUAL,a,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,a=Math.ceil(this.width),p=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),b=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&p!==0&&(this.depthFBO=new mr(this.context,a,p,!1,"texture"),this.depthTexture=new s.T(this.context,{width:a,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),n.bindTexture(n.TEXTURE_2D,b),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,a,p,0,0,a,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,a)=>n+a/this._fpsHistory.length,0))}render(n,a){const p=s.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=a;const v=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter(je=>{const at=v[je];return!(at.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[at.type]});let D=T(),L=!1,z=!1;for(const je of D){const at=v[je];at.type==="circle"&&(L=!0),at.type==="symbol"&&(at.hasInitialOcclusionOpacityProperties?z=!0:L=!0)}let F=D.map(je=>v[je]);const V=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let U=0,q=!1;for(const je in V){const at=V[je];at.used&&(at.prepare(this.context),at.getSource().usedInConflation&&++U)}let J=!1;for(const je of F)je.isHidden(this.transform.zoom)||(je.type==="clip"&&(J=!0),this.prepareLayer(je));const X={},ee={},ie={},le={},_e={};for(const je in V){const at=V[je];X[je]=at.getVisibleCoordinates(),ee[je]=X[je].slice().reverse(),ie[je]=at.getVisibleCoordinates(!0).reverse(),le[je]=at.getShadowCasterCoordinates(),_e[je]=at.sortCoordinatesByDistance(X[je])}const pe=je=>{const at=this.style.getLayerSourceCache(je);return at&&at.used?at.getSource():null};if(U||J||this._clippingActiveLastFrame){const je=[],at=[];let Ne=0;for(const ot of F)this.isSourceForClippingOrConflation(ot,pe(ot))&&(je.push(ot),at.push(Ne)),Ne++;if(je&&(J||je.length>1)||this._clippingActiveLastFrame){J=!1;const ot=[];for(let st=0;st<je.length;st++){const ht=je[st],Qe=at[st],ft=this.style.getLayerSourceCache(ht);if(!ft||!ft.used||!ft.getSource().usedInConflation&&ht.type!=="clip")continue;let Ct=s.dA,Pt=s.by.None;const Dt=[];let $t=!0;if(ht.type==="clip"){Ct=Qe;for(const pi of ht.layout.get("clip-layer-types"))Pt|=pi==="model"?s.by.Model:pi==="symbol"?s.by.Symbol:s.by.FillExtrusion;for(const pi of ht.layout.get("clip-layer-scope"))Dt.push(pi);ht.isHidden(this.transform.zoom)?$t=!1:J=!0}$t&&ot.push({layer:ht.fqid,cache:ft,order:Ct,clipMask:Pt,clipScope:Dt})}this.replacementSource.setSources(ot),q=!0}}this._clippingActiveLastFrame=J,q||this.replacementSource.clear(),this.conflationActive=q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let je=0;je<F.length;je++){const at=F[je],Ne=at.cutoffRange();if(this.longestCutoffRange=Math.max(Ne,this.longestCutoffRange),Ne>0){const ot=pe(at);ot&&(this.minCutoffZoom=Math.max(ot.minzoom,this.minCutoffZoom)),at.minzoom&&(this.minCutoffZoom=Math.max(at.minzoom,this.minCutoffZoom))}at.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=je),this._lastOcclusionLayer=je)}const we=this.style&&this.style.fog;we?(this._fogVisible=we.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ie),this.opaquePassCutoff=0,D=T(),F=D.map(je=>v[je]));const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const je in V)for(const at of X[je]){let Ne={min:0,max:0};this.terrain&&(Ne=this.terrain.getMinMaxForTile(at)||Ne),ve.addShadowReceiver(at.toUnwrapped(),Ne.min,Ne.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Hy(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(xe&&!this._snow&&(this._snow=new Hc(this)),!xe&&this._snow&&(this._snow.destroy(),delete this._snow),be&&!this._rain&&(this._rain=new Bm(this)),!be&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!dr.has(this.context.gl))return;this.renderPass="offscreen";for(const je of F){const at=n.getLayerSourceCache(je);if(!je.hasOffscreenPass()||je.isHidden(this.transform.zoom))continue;const Ne=at?ee[at.id]:void 0;(je.type==="custom"||je.type==="raster"||je.type==="raster-particle"||je.isSky()||Ne&&Ne.length)&&this.renderLayer(this,at,je,Ne)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,le)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Re=(()=>{if(a.showOverdrawInspector)return s.al.black;const je=this.style.fog;if(je&&this.transform.projection.supportsFog){const at=this.style.getLut(je.scope);if(!Ce){const Ne=je.properties.get("color-use-theme")==="none",ot=je.properties.get("color").toRenderColor(Ne?null:at).toArray01();return new s.al(...ot)}if(Ce){const Ne=je.properties.get("space-color-use-theme")==="none",ot=je.properties.get("space-color").toRenderColor(Ne?null:at).toArray01();return new s.al(...ot)}}return s.al.transparent})();if(this.context.clear({color:Re,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=D.length-1;this.currentLayer>=0;this.currentLayer--){const je=F[this.currentLayer],at=n.getLayerSourceCache(je);if(je.isSky())continue;const Ne=at?(je.is3D(b)?_e:ee)[at.id]:void 0;this._renderTileClippingMasks(je,at,Ne),this.renderLayer(this,at,je,Ne)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const je=F[this.currentLayer],at=n.getLayerSourceCache(je);je.isSky()&&this.renderLayer(this,at,je,at?ee[at.id]:void 0)}function Je(je,at){let Ne;return at&&(Ne=(je.type==="symbol"?ie:je.is3D(b)?_e:ee)[at.id]),Ne}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<D.length;){const je=F[this.currentLayer];if(je.type==="raster"||je.type==="raster-particle"){const at=n.getLayerSourceCache(je);this.renderLayer(this,at,je,Je(je,at))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let $e=0;ve&&($e=ve.getShadowCastingLayerCount());let ct=!1,ut=-1;for(let je=0;je<D.length;++je){const at=F[je];at.isHidden(this.transform.zoom)||at.is3D(b)&&(ut=je)}z&&ut===-1&&(L=!0);let vt=!1;for(;this.currentLayer<D.length;){const je=F[this.currentLayer],at=n.getLayerSourceCache(je);if(je.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(je)){if(je.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!vt&&je.is3D(b)&&!b){const Ne=this.currentLayer,ot=st=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const ht=F[this.currentLayer];if(ff[ht.type]){const Qe=this.style.getLayerSourceCache(ht);ff[ht.type](this,Qe,ht,Je(ht,Qe),st)}}};ot("initialize"),ot("reset"),this.currentLayer=Ne,vt=!0}if(L&&!ct&&this.terrain&&!this.transform.isOrthographic&&(ct=!0,this.blitDepth()),z&&ut!==-1&&this.currentLayer===ut+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(je,at,at?X[at.id]:void 0),this.renderLayer(this,at,je,Je(je,at)),!this.terrain&&ve&&$e>0&&je.hasShadowPass()&&--$e==0&&(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ne=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ne;this.currentLayer++){const ot=F[this.currentLayer];if(!ot.hasLightBeamPass())continue;const st=n.getLayerSourceCache(ot);this.renderLayer(this,st,ot,st?ee[st.id]:void 0)}this.currentLayer=Ne,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ne=this.currentLayer;this.depthOcclusion=!0;for(const ot of this.layersWithOcclusionOpacity){this.currentLayer=ot;const st=F[this.currentLayer],ht=n.getLayerSourceCache(st),Qe=ht?ee[ht.id]:void 0;this.terrain||this._renderTileClippingMasks(st,ht,ht?X[ht.id]:void 0),this.renderLayer(this,ht,st,Qe)}this.depthOcclusion=!1,this.currentLayer=Ne,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let je=null;F.forEach(at=>{const Ne=n.getLayerSourceCache(at);Ne&&!at.isHidden(this.transform.zoom)&&Ne.getVisibleCoordinates().length&&(!je||je.getSource().maxzoom<Ne.getSource().maxzoom)&&(je=Ne)}),je&&this.options.showTileBoundaries&&_h.debug(this,je,je.getVisibleCoordinates(),s.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&_h.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(je){const at=je.transform.padding;Im(je,je.transform.height-(at.top||0),3,Uc),Im(je,at.bottom||0,3,db),Cm(je,at.left||0,3,fb),Cm(je,je.transform.width-(at.right||0),3,jy);const Ne=je.transform.centerPoint;(function(ot,st,ht,Qe){Il(ot,st-1,ht-10,2,20,Qe),Il(ot,st-10,ht-1,20,2,Qe)})(je,Ne.x,je.transform.height-Ne.y,rf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),q||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:a}=this.transform.projection,p=!a||!a.includes(n.type);if(df[n.type]&&(p||this.terrain&&n.type==="custom")){const v=this.style.getLayerSourceCache(n);df[n.type](n,v,this)}this.gpuTimingEnd()}renderLayer(n,a,p,v){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||v&&v.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||_h[p.type](n,a,p,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,p=this.context.gl;let v=this.gpuTimers[n.id];v||(v=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),v.calls++,p.beginQuery(a.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=this.context.gl,p=a.createQuery();this.deferredRenderGpuTimeQueries.push(p),a.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const p in n){const v=n[p],b=this.context.extTimerQuery,T=b.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(v.query),a[p]=T}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let p=0;for(const v of n)p+=a.getQueryParameter(v,a.QUERY_RESULT)/1e6,a.deleteQuery(v);return p}translatePosMatrix(n,a,p,v,b){if(!p[0]&&!p[1])return n;const T=b?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){const z=Math.sin(T),F=Math.cos(T);p=[p[0]*F-p[1]*z,p[0]*z+p[1]*F]}const D=[b?p[0]:s.at(a,p[0],this.transform.zoom),b?p[1]:s.at(a,p[1],this.transform.zoom),0],L=new Float32Array(16);return s.ad.mat4.translate(L,n,D),L}saveTileTexture(n){const a=n.size[0],p=this._tileTextures[a];p?p.push(n):this._tileTextures[a]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,a,p){const v=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||v||a!==void 0&&!a||b.push("FOG","FOG_DITHERING"),v&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,a){this.cache=this.cache||{};const p=a&&a.defines||[],v=a&&a.config,b=this.currentGlobalDefines(n,a&&a.overrideFog,a&&a.overrideRtt).concat(p),T=Ry.cacheKey(oh[n],n,b,v);return this.cache[T]||(this.cache[T]=new Ry(this.context,n,oh[n],v,bm[n],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,a){if(this.style.enable3dLights()){const p=this.style.directionalLight,v=this.style.ambientLight;if(p&&v){const b=((T,D,L)=>{const z=T.properties.get("direction"),F=T.properties.get("color-use-theme")==="none",V=T.properties.get("color").toRenderColor(F?null:L.getLut(T.scope)).toArray01(),U=T.properties.get("intensity"),q=D.properties.get("color-use-theme")==="none",J=D.properties.get("color").toRenderColor(q?null:L.getLut(D.scope)).toArray01(),X=D.properties.get("intensity"),ee=[z.x,z.y,z.z],ie=s.cN(J,X),le=s.cN(V,U);return{u_lighting_ambient_color:ie,u_lighting_directional_dir:ee,u_lighting_directional_color:le,u_ground_radiance:Dy(ee,le,ie)}})(p,v,this.style);a.setLightsUniformValues(n,b)}}}uploadCommonUniforms(n,a,p,v,b){if(this.uploadCommonLightUniforms(n,a),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const D=T.getOpacity(this.transform.pitch),L=((z,F,V,U,q,J,X,ee,ie,le,_e,pe)=>{const we=z.transform,ve=F.properties.get("color-use-theme")==="none",xe=F.properties.get("color").toRenderColor(ve?null:z.style.getLut(F.scope)).toArray01();xe[3]=U;const be=z.frameCounter/1e3%1,[Ce,Re]=F.properties.get("vertical-range");return{u_fog_matrix:V?we.calculateFogTileMatrix(V):pe||z.identityMat,u_fog_range:F.getFovAdjustedRange(we._fov),u_fog_color:xe,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ce,Re),Re],u_fog_temporal_offset:be,u_frustum_tl:q,u_frustum_tr:J,u_frustum_br:X,u_frustum_bl:ee,u_globe_pos:ie,u_globe_radius:le,u_viewport:_e,u_globe_transition:s.ag(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,T,p,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],v);a.setFogUniformValues(n,L)}b&&a.setCutoffUniformValues(n,b.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const v of p)a[v.key]=n[v.key]||new wo(v,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,a){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[n.key];return a||(this._cachedTileFogOpacities[n.key]=a=this.style.fog.getOpacityForTile(n)),a[0]>=Ot||a[1]>=Ot}setupDepthForOcclusion(n,a,p){const v=this.context,b=v.gl,T=!!p;var D;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(b.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((D=this.depthRangeFor3D)[1]-D[0]),-1-2*D[0]/(D[1]-D[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),v.activeTexture.set(b.TEXTURE0),T||a.setTerrainUniformValues(v,p)}}function mf(m,n){let a=!1,p=null;const v=()=>{p=null,a&&(m(),p=setTimeout(v,n),a=!1)};return()=>(a=!0,p||v(),p)}class Vm{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=mf(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=Um(n);if(this._hashName){const p=this._hashName;let v=!1;const b=location.hash.slice(1).split("&").map(T=>{const D=T.split("=")[0];return D===p?(v=!0,`${D}=${a}`):T}).filter(T=>T);return v||b.push(`${p}=${a}`),`#${b.join("&")}`}return`#${a}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(a=p)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(p=>isNaN(p))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:p,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Um(m,n){const a=m.getCenter(),p=Math.round(100*m.getZoom())/100,v=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),T=Math.round(a.lng*b)/b,D=Math.round(a.lat*b)/b,L=m.getBearing(),z=m.getPitch();let F=n?`/${T}/${D}/${p}`:`${p}/${D}/${T}`;return(L||z)&&(F+="/"+Math.round(10*L)/10),z&&(F+=`/${Math.round(z)}`),F}const yh={linearity:.3,easing:s.dB(0,0,.3,1)},Gy=s.l({deceleration:2500,maxSpeed:1400},yh),qy=s.l({deceleration:20,maxSpeed:1400},yh),Wy=s.l({deceleration:1e3,maxSpeed:360},yh),Zy=s.l({deceleration:1e3,maxSpeed:90},yh);class Xy{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=s.q.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(a.pan.mag()){const b=xh(a.pan.mag(),p,s.l({},Gy,n||{}));v.offset=a.pan.mult(b.amount/a.pan.mag()),v.center=this._map.transform.center,vh(v,b)}if(a.zoom){const b=xh(a.zoom,p,qy);v.zoom=this._map.transform.zoom+b.amount,vh(v,b)}if(a.bearing){const b=xh(a.bearing,p,Wy);v.bearing=this._map.transform.bearing+s.ay(b.amount,-179,179),vh(v,b)}if(a.pitch){const b=xh(a.pitch,p,Zy);v.pitch=this._map.transform.pitch+b.amount,vh(v,b)}if(v.zoom||v.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function vh(m,n){(!m.duration||m.duration<n.duration)&&(m.duration=n.duration,m.easing=n.easing)}function xh(m,n,a){const{maxSpeed:p,linearity:v,deceleration:b}=a,T=s.ay(m*v/(n/1e3),-p,p),D=Math.abs(T)/(b*v);return{easing:a.easing,duration:1e3*D,amount:T*(D/2)}}class wr extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,p,v={}){const b=Ke(a.getCanvasContainer(),p),T=a.unproject(b);super(n,s.l({point:b,lngLat:T,originalEvent:p},v)),this._defaultPrevented=!1,this.target=a}}class bh extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,p){const v=n==="touchend"?p.changedTouches:p.touches,b=Xe(a.getCanvasContainer(),v),T=b.map(L=>a.unproject(L)),D=b.reduce((L,z,F,V)=>L.add(z.div(V.length)),new s.P(0,0));super(n,{points:b,point:D,lngLats:T,lngLat:a.unproject(D),originalEvent:p}),this._defaultPrevented=!1}}class Yy extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class Ky{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Yy(this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new wr(n.type,this._map,n))}mouseup(n){this._map.fire(new wr(n.type,this._map,n))}preclick(n){const a=s.l({},n);a.type="preclick",this._map.fire(new wr(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new wr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new wr(n.type,this._map,n))}mouseover(n){this._map.fire(new wr(n.type,this._map,n))}mouseout(n){this._map.fire(new wr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new bh(n.type,this._map,n))}touchmove(n){this._map.fire(new bh(n.type,this._map,n))}touchend(n){this._map.fire(new bh(n.type,this._map,n))}touchcancel(n){this._map.fire(new bh(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mb{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new wr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new wr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gb{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(fe(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const p=a,v=this._startPos,b=this._lastPos;if(!v||!b||b.equals(p)||!this._box&&p.dist(v)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=ne("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const T=Math.min(v.x,p.x),D=Math.max(v.x,p.x),L=Math.min(v.y,p.y),z=Math.max(v.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${L}px)`,this._box.style.width=D-T+"px",this._box.style.height=z-L+"px")})}mouseupWindow(n,a){if(!this._active)return;const p=this._startPos,v=a;if(p&&n.button===0){if(this.reset(),ze(),p.x!==v.x||p.y!==v.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(p,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new s.A(n,{originalEvent:a}))}}function Mn(m,n){const a={};for(let p=0;p<m.length;p++)a[m[p].identifier]=n[p];return a}class Jy{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(v){const b=new s.P(0,0);for(const T of v)b._add(T);return b.div(v.length)}(a),this.touches=Mn(p,a)))}touchmove(n,a,p){if(this.aborted||!this.centroid)return;const v=Mn(p,a);for(const b in this.touches){const T=v[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,a,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class jm{constructor(n){this.singleTap=new Jy(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,p){this.singleTap.touchstart(n,a,p)}touchmove(n,a,p){this.singleTap.touchmove(n,a,p)}touchend(n,a,p){const v=this.singleTap.touchend(n,a,p);if(v){const b=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(b&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class _b{constructor(){this._zoomIn=new jm({numTouches:1,numTaps:2}),this._zoomOut=new jm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,p){this._zoomIn.touchstart(n,a,p),this._zoomOut.touchstart(n,a,p)}touchmove(n,a,p){this._zoomIn.touchmove(n,a,p),this._zoomOut.touchmove(n,a,p)}touchend(n,a,p){const v=this._zoomIn.touchend(n,a,p),b=this._zoomOut.touchend(n,a,p);return v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const wh={0:1,2:2},$m={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Th{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const p=Ue(n);this._correctButton(n,p)&&(this._lastPoint=a,this._eventButton=p)}mousemoveWindow(n,a){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&function(v,b){const T=wh[b];return v.buttons===void 0||(v.buttons&T)!==T}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(p,a)}}mouseupWindow(n){this._lastPoint&&Ue(n)===this._eventButton&&(this._moved&&ze(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gf extends Th{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class Wo extends Th{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?$m[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const p=.8*(a.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Eh extends Th{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?$m[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const p=-.5*(a.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Xn{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,a,p){return this._calculateTransform(n,a,p)}touchmove(n,a,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,p)}}touchend(n,a,p){this._calculateTransform(n,a,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,p){p.length>0&&(this._active=!0);const v=Mn(p,a),b=new s.P(0,0),T=new s.P(0,0);let D=0;for(const z in v){const F=v[z],V=this._touches[z];V&&(b._add(F),T._add(F.sub(V)),D++,v[z]=F)}if(this._touches=v,D<this._minTouches||!T.mag())return;const L=T.div(D);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(D),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class lo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,p){return{}}touchstart(n,a,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,p){const v=this._firstTwoTouches;if(!v)return;n.preventDefault();const[b,T]=v,D=Gc(p,a,b),L=Gc(p,a,T);if(!D||!L)return;const z=this._aroundCenter?null:D.add(L).div(2);return this._move([D,L],z,n)}touchend(n,a,p){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,T=Gc(p,a,v),D=Gc(p,a,b);T&&D||(this._active&&ze(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gc(m,n,a){for(let p=0;p<m.length;p++)if(m[p].identifier===a)return n[p]}function Sh(m,n){return Math.log(m/n)/Math.LN2}class Qy extends lo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Sh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sh(this._distance,p),pinchAround:a}}}function e0(m,n){return 180*m.angleWith(n)/Math.PI}class Ah extends lo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:e0(this._vector,p),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const v=e0(n,p);return Math.abs(v)<a}}function Hm(m){return Math.abs(m.y)>Math.abs(m.x)}class yb extends lo{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Hm(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,p){const v=this._lastPoints;if(!v)return;const b=n[0].sub(v[0]),T=n[1].sub(v[1]);return this._map._cooperativeGestures&&!s.dC()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(n,a,p){if(this._valid!==void 0)return this._valid;const v=n.mag()>=2,b=a.mag()>=2;if(!v&&!b)return;if(!v||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=n.y>0==a.y>0;return Hm(n)&&Hm(a)&&T}}const Gm={panStep:100,bearingStep:15,pitchStep:10};class qm{constructor(){const n=Gm;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,p=0,v=0,b=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?v=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?v=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,v=0),{cameraAnimation:D=>{const L=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:Mh,zoom:a?Math.round(L)+a*(n.shiftKey?2:1):L,bearing:D.getBearing()+p*this._bearingStep,pitch:D.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:D.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mh(m){return m*(2-m)}const Dl=4.000244140625,Ea=1/450;class Mo{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ea,s.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=s.q.now(),v=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,a!==0&&a%Dl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(v*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Ke(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Dl?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&F!==0&&(F=1/F);const V=a(),U=Math.pow(2,V),q=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(q*F))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:a(),v=this._startZoom,b=this._easing;let T,D=!1;if(this._type==="wheel"&&v&&b){const z=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),F=b(z);T=s.ah(v,p,F),z<1?this._frameId||(this._frameId=!0):D=!0}else T=p,D=!0;this._active=!0,D&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let L=T-a();return L*this._lastDelta<0&&(L=0),{noInertia:!0,needsRenderFrame:!D,zoomDelta:L,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=s.dD;if(this._prevEase){const p=this._prevEase,v=(s.q.now()-p.start)/p.duration,b=p.easing(v+.01)-p.easing(v),T=.27/Math.sqrt(b*b+1e-4)*.01,D=Math.sqrt(.0729-T*T);a=s.dB(T,D,.25,1)}return this._prevEase={start:s.q.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class tl{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class il{constructor(){this._tap=new jm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=a[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,a,p))}touchmove(n,a,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const v=a[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,a,p)}touchend(n,a,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,a,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vb{constructor(n,a,p){this._el=n,this._mousePan=a,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xb{constructor(n,a,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bb{constructor(n,a,p,v){this._el=n,this._touchZoom=a,this._touchRotate=p,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _f=m=>m.zoom||m.drag||m.pitch||m.rotate;class t0 extends s.A{}class cr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const p=s.ad.vec3.sub([],a,n);this.radius=s.ad.vec3.length(p[2]<0?s.ad.vec3.div([],p,this.constants):[p[0],p[1],0])}projectRay(n){s.ad.vec3.div(n,n,this.constants),s.ad.vec3.normalize(n,n),s.ad.vec3.mul(n,n,this.constants);const a=s.ad.vec3.scale([],n,this.radius);if(a[2]>0){const p=s.ad.vec3.scale([],[0,0,1],s.ad.vec3.dot(a,[0,0,1])),v=s.ad.vec3.scale([],s.ad.vec3.normalize([],[a[0],a[1],0]),this.radius),b=s.ad.vec3.add([],a,s.ad.vec3.scale([],s.ad.vec3.sub([],s.ad.vec3.add([],v,p),a),2));a[0]=b[0],a[1]=b[1]}return a}}function qc(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class i0{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xy(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.aQ(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,b,T]of this._listeners){const D=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(b,D,T)}}destroy(){for(const[n,a,p]of this._listeners){const v=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(a,v,p)}}_addDefaultHandlers(n){const a=this._map,p=a.getCanvasContainer();this._add("mapEvent",new Ky(a,n));const v=a.boxZoom=new gb(a,n);this._add("boxZoom",v);const b=new _b,T=new Rl;a.doubleClickZoom=new tl(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const D=new il;this._add("tapDragZoom",D);const L=a.touchPitch=new yb(a);this._add("touchPitch",L);const z=new Wo(n),F=new Eh(n);a.dragRotate=new xb(n,z,F),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const V=new gf(n),U=new Xn(a,n);a.dragPan=new vb(p,V,U),this._add("mousePan",V),this._add("touchPan",U,["touchZoom","touchRotate"]);const q=new Ah,J=new Qy;a.touchZoomRotate=new bb(p,J,q,D),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new mb(a));const X=a.scrollZoom=new Mo(a,this);this._add("scrollZoom",X,["mousePan"]);const ee=a.keyboard=new qm;this._add("keyboard",ee);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ie]&&a[ie].enable(n[ie])}_add(n,a,p){this._handlers.push({handlerName:n,handler:a,allowed:p}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_f(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,p){for(const v in n)if(v!==p&&(!a||a.indexOf(v)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const p of n)this._el.contains(p.target)&&a.push(p);return a}handleEvent(n,a){this._updatingCamera=!0;const p=n.type==="renderFrame",v=p?void 0:n,b={needsRenderFrame:!1},T={},D={},L=n.touches?this._getMapTouches(n.touches):void 0,z=L?Xe(this._el,L):p?void 0:Ke(this._el,n);for(const{handlerName:U,handler:q,allowed:J}of this._handlers){if(!q.isEnabled())continue;let X;this._blockedByActive(D,J,U)?q.reset():q[a||n.type]&&(X=q[a||n.type](n,z,L),this.mergeHandlerResult(b,T,X,U,v),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||q.isActive())&&(D[U]=q)}const F={};for(const U in this._previousActiveHandlers)D[U]||(F[U]=v);this._previousActiveHandlers=D,(Object.keys(F).length||qc(b))&&(this._changes.push([b,T,F]),this._triggerRenderFrame()),(Object.keys(D).length||qc(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=b;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(n,a,p,v,b){if(!p)return;s.l(n,p);const T={handlerName:v,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(a.zoom=T),p.panDelta!==void 0&&(a.drag=T),p.pitchDelta!==void 0&&(a.pitch=T),p.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const n={},a={},p={};for(const[v,b,T]of this._changes)v.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(n.around=v.around),v.aroundCoord!==void 0&&(n.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(n.pinchAround=v.pinchAround),v.noInertia&&(n.noInertia=v.noInertia),s.l(a,b),s.l(p,T);this._updateMapTransform(n,a,p),this._changes=[]}_updateMapTransform(n,a,p){const v=this._map,b=v.transform,T=le=>[le.x,le.y,le.z];if((le=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!qc(n)){const le=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),le!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&v._stop(!0),!qc(n))return void this._fireEvents(a,p,!0);let{panDelta:D,zoomDelta:L,bearingDelta:z,pitchDelta:F,around:V,aroundCoord:U,pinchAround:q}=n;b._isCameraConstrained&&(L>0&&(L=0),b._isCameraConstrained=!1),q!==void 0&&(V=q),(L||(le=>a[le]&&!this._eventsInProgress[le])("drag"))&&V&&(this._dragOrigin=T(b.pointCoordinate3D(V)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),V=V||v.transform.centerPoint,z&&(b.bearing+=z),F&&(b.pitch+=F),b._updateCameraState();const J=[0,0,0];if(D)if(b.projection.name==="mercator"){const le=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(V).dir),_e=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(V.sub(D)).dir);J[0]=_e[0]-le[0],J[1]=_e[1]-le[1]}else{const le=b.pointCoordinate(V);if(b.projection.name==="globe"){D=D.rotate(-b.angle);const _e=b._pixelsPerMercatorPixel/b.worldSize;J[0]=-D.x*s.dE(s.aT(le.y))*_e,J[1]=-D.y*s.dE(b.center.lat)*_e}else{const _e=b.pointCoordinate(V.sub(D));le&&_e&&(J[0]=_e.x-le.x,J[1]=_e.y-le.y)}}const X=b.zoom,ee=[0,0,0];if(L){const le=T(U||b.pointCoordinate3D(V)),_e={dir:s.ad.vec3.normalize([],s.ad.vec3.sub([],le,b._camera.position))};if(_e.dir[2]<0){const pe=b.zoomDeltaToMovement(le,L);s.ad.vec3.scale(ee,_e.dir,pe)}}const ie=s.ad.vec3.add(J,J,ee);b._translateCameraConstrained(ie),L&&Math.abs(b.zoom-X)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,p,!0)}_fireEvents(n,a,p){const v=_f(this._eventsInProgress),b=_f(n),T={};for(const F in n){const{originalEvent:V}=n[F];this._eventsInProgress[F]||(T[`${F}start`]=V),this._eventsInProgress[F]=n[F]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const F in T)this._fireEvent(F,T[F]);b&&this._fireEvent("move",b.originalEvent);for(const F in n){const{originalEvent:V}=n[F];this._fireEvent(F,V)}const D={};let L;for(const F in this._eventsInProgress){const{handlerName:V,originalEvent:U}=this._eventsInProgress[F];this._handlersById[V].isActive()||(delete this._eventsInProgress[F],L=a[V]||U,D[`${F}end`]=L)}for(const F in D)this._fireEvent(F,D[F]);const z=_f(this._eventsInProgress);if(p&&(v||b)&&!z){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;F?(V(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:L})):(this._map.fire(new s.A("moveend",{originalEvent:L})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new s.A(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new t0("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const n0="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Wc extends s.E{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,s.aQ(["_renderFrameCallback"],this)}getCenter(){return new s.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,p){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,s.l({offset:n},a),p)}panTo(n,a,p){return this.easeTo(s.l({center:n},a),p)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,p){return this.easeTo(s.l({zoom:n},a),p)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,p){return this.easeTo(s.l({bearing:n},a),p)}resetNorth(n,a){return this.rotateTo(0,s.l({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=s.aB.convert(n);const p=a&&a.bearing||0,v=a&&a.pitch||0,b=n.getNorthWest(),T=n.getSouthEast();return this._cameraForBounds(this.transform,b,T,p,v,a)}_extendPadding(n){const a={top:0,right:0,bottom:0,left:0};return n==null?s.l({},a,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:s.l({},a,n)}_extendCameraOptions(n){return(n=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,a){const p=a.max[0]-a.min[0],v=a.max[1]-a.min[1];return p/v>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):v/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,p,v,b,T){const D=n.clone(),L=this._extendCameraOptions(T);D.bearing=v,D.pitch=b;const z=s.bO.convert(a),F=s.bO.convert(p),V=.5*(z.lat+F.lat),U=.5*(z.lng+F.lng),q=s.dF(V,U),J=s.ad.vec3.normalize([],q),X=s.ad.vec3.normalize([],s.ad.vec3.cross([],J,[0,1,0])),ee=s.ad.vec3.cross([],X,J),ie=[X[0],X[1],X[2],0,ee[0],ee[1],ee[2],0,J[0],J[1],J[2],0,0,0,0,1],le=[q,s.dF(z.lat,z.lng),s.dF(F.lat,z.lng),s.dF(F.lat,F.lng),s.dF(z.lat,F.lng),s.dF(V,z.lng),s.dF(V,F.lng),s.dF(z.lat,U),s.dF(F.lat,U)];let _e=s.ce.fromPoints(le.map(st=>[s.ad.vec3.dot(X,st),s.ad.vec3.dot(ee,st),s.ad.vec3.dot(J,st)]));const pe=s.ad.vec3.transformMat4([],_e.center,ie);s.ad.vec3.squaredLength(pe)===0&&s.ad.vec3.set(pe,0,0,1),s.ad.vec3.normalize(pe,pe),s.ad.vec3.scale(pe,pe,s.az),D.center=s.dG(pe);const we=D.getWorldToCameraMatrix(),ve=s.ad.mat4.invert(new Float64Array(16),we);_e=s.ce.applyTransform(_e,s.ad.mat4.multiply([],we,ie));const xe=this._extendAABB(_e,D,L,v);if(!xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_e=xe,s.ad.vec3.transformMat4(pe,pe,we);const be=.5*(_e.max[2]-_e.min[2]),Ce=this._minimumAABBFrustumDistance(D,_e),Re=s.ad.vec3.scale([],[0,0,1],be),Je=s.ad.vec3.add(Re,pe,Re),$e=Ce+(D.pitch===0?0:s.ad.vec3.distance(pe,Je)),ct=D.globeCenterInViewSpace,ut=s.ad.vec3.sub([],pe,[ct[0],ct[1],ct[2]]);s.ad.vec3.normalize(ut,ut),s.ad.vec3.scale(ut,ut,$e);const vt=s.ad.vec3.add([],pe,ut);s.ad.vec3.transformMat4(vt,vt,ve);const je=s.dv/s.az,at=s.ad.vec3.length(vt),Ne=s.bH(Math.max(at*je-s.dv,Number.EPSILON),0),ot=Math.min(D.zoomFromMercatorZAdjusted(Ne),L.maxZoom);return ot>.5*(s.c6+s.bY)?(D.setProjection({name:"mercator"}),D.zoom=ot,this._cameraForBounds(D,a,p,v,b,T)):{center:D.center,zoom:ot,bearing:v,pitch:b}}_extendAABB(n,a,p,v){const b=.5*((p.padding.left||0)+(p.padding.right||0)),T=.5*((p.padding.top||0)+(p.padding.bottom||0)),D=T,L=b,z=b,F=T,V=a.width-(L+z),U=a.height-(D+F),q=s.ad.vec3.sub([],n.max,n.min),J=Math.min(V/q[0],U/q[1]),X=Math.min(a.scaleZoom(a.scale*J),p.maxZoom);if(isNaN(X))return null;const ee=a.scale/a.zoomScale(X),ie=new s.ce([n.min[0]-L*ee,n.min[1]-F*ee,n.min[2]],[n.max[0]+z*ee,n.max[1]+D*ee,n.max[2]]),le=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new s.P(p.offset.x,p.offset.y):s.P.convert(p.offset)).rotate(-s.ak(v));return ie.center[0]-=le.x*ee,ie.center[1]+=le.y*ee,ie}queryTerrainElevation(n,a){const p=this.transform.elevation;return p?(a=s.l({},{exaggerated:!0},a),p.getAtPoint(s.ac.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,p,v,b,T){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,p,v,b,T);const D=n.clone(),L=this._extendCameraOptions(T);D.bearing=v,D.pitch=b;const z=s.bO.convert(a),F=s.bO.convert(p),V=new s.bO(z.lng,F.lat),U=new s.bO(F.lng,z.lat),q=D.project(z),J=D.project(F),X=this.queryTerrainElevation(z),ee=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(V),le=this.queryTerrainElevation(U),_e=[[q.x,q.y,Math.min(X||0,ee||0,ie||0,le||0)],[J.x,J.y,Math.max(X||0,ee||0,ie||0,le||0)]];let pe=s.ce.fromPoints(_e);const we=D.getWorldToCameraMatrix(),ve=s.ad.mat4.invert(new Float64Array(16),we);pe=s.ce.applyTransform(pe,we);const xe=this._extendAABB(pe,D,L,v);if(!xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=xe;const be=.5*s.ad.vec3.sub([],pe.max,pe.min)[2],Ce=this._minimumAABBFrustumDistance(D,pe),Re=[0,0,1,0];s.ad.vec4.transformMat4(Re,Re,we),s.ad.vec4.normalize(Re,Re);const Je=s.ad.vec3.scale([],Re,Ce+be),$e=s.ad.vec3.add([],pe.center,Je);s.ad.vec3.transformMat4(pe.center,pe.center,ve),s.ad.vec3.transformMat4($e,$e,ve);const ct=D.unproject(new s.P(pe.center[0],pe.center[1])),ut=s.dH(D.projection,ct),vt=Math.pow(2,ut),je=Math.min(D._zoomFromMercatorZ($e[2]*D.pixelsPerMeter*vt/D.worldSize),L.maxZoom);return D.mercatorFromTransition&&je<.5*(s.c6+s.bY)?(D.setProjection({name:"globe"}),D.zoom=je,this._cameraForBounds(D,a,p,v,b,T)):{center:ct,zoom:je,bearing:v,pitch:b}}fitBounds(n,a,p){const v=this.cameraForBounds(n,a);return this._fitInternal(v,a,p)}fitScreenCoordinates(n,a,p,v,b){const T=s.P.convert(n),D=s.P.convert(a),L=new s.P(Math.min(T.x,D.x),Math.min(T.y,D.y)),z=new s.P(Math.max(T.x,D.x),Math.max(T.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,D))return this;const F=this.transform.pointLocation3D(L),V=this.transform.pointLocation3D(z),U=this.transform.pointLocation3D(new s.P(L.x,z.y)),q=this.transform.pointLocation3D(new s.P(z.x,L.y)),J=[Math.min(F.lng,V.lng,U.lng,q.lng),Math.min(F.lat,V.lat,U.lat,q.lat)],X=[Math.max(F.lng,V.lng,U.lng,q.lng),Math.max(F.lat,V.lat,U.lat,q.lat)],ee=v&&v.pitch?v.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,J,X,p,ee,v);return this._fitInternal(ie,v,b)}_fitInternal(n,a,p){return n?(a=s.l(n,a)).linear?this.easeTo(a,p):this.flyTo(a,p):this}jumpTo(n,a){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,T=!1;"zoom"in n&&p.zoom!==+n.zoom&&(v=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=s.bO.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(b=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(T=!0,p.pitch=+n.pitch);const D=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(D))if(n.retainPadding===!1){const L=p.clone();L.padding=D,p.setLocationAtPoint(p.center,L.centerPoint)}else p.padding=D;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.A("movestart",a)).fire(new s.A("move",a)),v&&this.fire(new s.A("zoomstart",a)).fire(new s.A("zoom",a)).fire(new s.A("zoomend",a)),b&&this.fire(new s.A("rotatestart",a)).fire(new s.A("rotate",a)).fire(new s.A("rotateend",a)),T&&this.fire(new s.A("pitchstart",a)).fire(new s.A("pitch",a)).fire(new s.A("pitchend",a)),this.fire(new s.A("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(n0),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.w(n0),this;this.stop();const v=p.zoom,b=p.pitch,T=p.bearing;p.setFreeCameraOptions(n);const D=v!==p.zoom,L=b!==p.pitch,z=T!==p.bearing;return this.fire(new s.A("movestart",a)).fire(new s.A("move",a)),D&&this.fire(new s.A("zoomstart",a)).fire(new s.A("zoom",a)).fire(new s.A("zoomend",a)),z&&this.fire(new s.A("rotatestart",a)).fire(new s.A("rotate",a)).fire(new s.A("rotateend",a)),L&&this.fire(new s.A("pitchstart",a)).fire(new s.A("pitch",a)).fire(new s.A("pitchend",a)),this.fire(new s.A("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=s.l({offset:[0,0],duration:500,easing:s.dD},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),D=this.getPadding(),L="zoom"in n?+n.zoom:v,z="bearing"in n?this._normalizeBearing(n.bearing,b):b,F="pitch"in n?+n.pitch:T,V=this._extendPadding(n.padding),U=s.P.convert(n.offset);let q,J,X;if(p.projection.name==="globe"){const Re=s.ac.fromLngLat(p.center),Je=U.rotate(-p.angle);Re.x+=Je.x/p.worldSize,Re.y+=Je.y/p.worldSize;const $e=Re.toLngLat(),ct=s.bO.convert(n.center||$e);this._normalizeCenter(ct),q=p.centerPoint.add(Je),J=new s.P(Re.x,Re.y).mult(p.worldSize),X=new s.P(s.av(ct.lng),s.aC(ct.lat)).mult(p.worldSize).sub(J)}else{q=p.centerPoint.add(U);const Re=p.pointLocation(q),Je=s.bO.convert(n.center||Re);this._normalizeCenter(Je),J=p.project(Re),X=p.project(Je).sub(J)}const ee=p.zoomScale(L-v);let ie,le;n.around&&(ie=s.bO.convert(n.around),le=p.locationPoint(ie));const _e=this._zooming||L!==v,pe=this._rotating||b!==z,we=this._pitching||F!==T,ve=!p.isPaddingEqual(V),xe=n.retainPadding===!1?p.clone():p,be=Re=>Je=>{if(_e&&(Re.zoom=s.ah(v,L,Je)),pe&&(Re.bearing=s.ah(b,z,Je)),we&&(Re.pitch=s.ah(T,F,Je)),ve&&(xe.interpolatePadding(D,V,Je),q=xe.centerPoint.add(U)),ie)Re.setLocationAtPoint(ie,le);else{const $e=Re.zoomScale(Re.zoom-v),ct=L>v?Math.min(2,ee):Math.max(.5,ee),ut=Math.pow(ct,1-Je),vt=Re.unproject(J.add(X.mult(Je*ut)).mult($e));Re.setLocationAtPoint(Re.renderWorldCopies?vt.wrap():vt,q)}return n.preloadOnly||this._fireMoveEvents(a),Re};if(n.preloadOnly){const Re=this._emulate(be,n.duration,p);return this._preloadTiles(Re),this}const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_e,this._rotating=pe,this._pitching=we,this._padding=ve,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,Ce),this._ease(be(p),Re=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(a,Re)},n),this}_prepareEase(n,a,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||p.moving||this.fire(new s.A("movestart",n)),this._zooming&&!p.zooming&&this.fire(new s.A("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new s.A("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new s.A("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.A("move",n)),this._zooming&&this.fire(new s.A("zoom",n)),this._rotating&&this.fire(new s.A("rotate",n)),this._pitching&&this.fire(new s.A("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.A("zoomend",n)),v&&this.fire(new s.A("rotateend",n)),b&&this.fire(new s.A("pitchend",n)),this.fire(new s.A("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const st=s.aA(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(st,a)}this.stop(),n=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dD},n);const p=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),D=this.getPadding(),L="zoom"in n?s.ay(+n.zoom,p.minZoom,p.maxZoom):v,z="bearing"in n?this._normalizeBearing(n.bearing,b):b,F="pitch"in n?+n.pitch:T,V=this._extendPadding(n.padding),U=p.zoomScale(L-v),q=s.P.convert(n.offset);let J=p.centerPoint.add(q);const X=p.pointLocation(J),ee=s.bO.convert(n.center||X);this._normalizeCenter(ee);const ie=p.project(X),le=p.project(ee).sub(ie);let _e=n.curve;const pe=Math.max(p.width,p.height),we=pe/U,ve=le.mag();if("minZoom"in n){const st=s.ay(Math.min(n.minZoom,v,L),p.minZoom,p.maxZoom),ht=pe/p.zoomScale(st-v);_e=Math.sqrt(ht/ve*2)}const xe=_e*_e;function be(st){const ht=(we*we-pe*pe+(st?-1:1)*xe*xe*ve*ve)/(2*(st?we:pe)*xe*ve);return Math.log(Math.sqrt(ht*ht+1)-ht)}function Ce(st){return(Math.exp(st)-Math.exp(-st))/2}function Re(st){return(Math.exp(st)+Math.exp(-st))/2}const Je=be(0);let $e=function(st){return Re(Je)/Re(Je+_e*st)},ct=function(st){return pe*((Re(Je)*(Ce(ht=Je+_e*st)/Re(ht))-Ce(Je))/xe)/ve;var ht},ut=(be(1)-Je)/_e;if(Math.abs(ve)<1e-6||!isFinite(ut)){if(Math.abs(pe-we)<1e-6)return this.easeTo(n,a);const st=we<pe?-1:1;ut=Math.abs(Math.log(we/pe))/_e,ct=function(){return 0},$e=function(ht){return Math.exp(st*_e*ht)}}n.duration="duration"in n?+n.duration:1e3*ut/("screenSpeed"in n?+n.screenSpeed/_e:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const vt=b!==z,je=F!==T,at=!p.isPaddingEqual(V),Ne=n.retainPadding===!1?p.clone():p,ot=st=>ht=>{const Qe=ht*ut,ft=1/$e(Qe);st.zoom=ht===1?L:v+st.scaleZoom(ft),vt&&(st.bearing=s.ah(b,z,ht)),je&&(st.pitch=s.ah(T,F,ht)),at&&(Ne.interpolatePadding(D,V,ht),J=Ne.centerPoint.add(q));const Ct=ht===1?ee:st.unproject(ie.add(le.mult(ct(Qe))).mult(ft));return st.setLocationAtPoint(st.renderWorldCopies?Ct.wrap():Ct,J),st._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),st};if(n.preloadOnly){const st=this._emulate(ot,n.duration,p);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=vt,this._pitching=je,this._padding=at,this._prepareEase(a,!1),this._ease(ot(p),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,a)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,a,p){p.animate===!1||p.duration===0?(n(1),a()):(this._easeStart=s.q.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=s.bF(n,-180,180);const p=Math.abs(n-a);return Math.abs(n-360-a)<p&&(n-=360),Math.abs(n+360-a)<p&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const p=n.lng-a.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,p){const v=Math.ceil(15*a/1e3),b=[],T=n(p.clone());for(let D=0;D<=v;D++){const L=T(D/v);b.push(L.clone())}return b}_preloadTiles(n,a){}}class yf{constructor(n={}){this.options=n,s.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ne("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const v=ne("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",p),this._innerContainer=ne("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(n){const p=a.reduce((v,b,T)=>(b.value&&(v+=`${b.key}=${b.value}${T<a.length-1?"&":""}`),v),"?");n.href=`${s.e.FEEDBACK_URL}/${p}#${Um(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const a=this._map.style._mergedSourceCaches;for(const v in a){const b=a[v];if(b.used){const T=b.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n.sort((v,b)=>v.length-b.length),n=n.filter((v,b)=>{for(let T=b+1;T<n.length;T++)if(n[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Hr{constructor(){s.aQ(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=ne("div","mapboxgl-ctrl");const a=ne("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const p=n[a].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Gr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,p=a?this._queue.concat(a):this._queue;for(const v of p)if(v.id===n)return void(v.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const p of a)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Zc{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=s.cC((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,p){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+p}}const Ll={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ol extends s.A{constructor(n,a,p,v){const{point:b,lngLat:T,originalEvent:D,target:L}=n;super(n.type,{point:b,lngLat:T,originalEvent:D,target:L}),this.preventDefault=()=>{n.preventDefault()},this.id=a,this.interaction=p,this.feature=v}}class Wm{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,a){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const p=a.filter;let v=a.type;p&&this.filters.set(n,s.a_(p)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const b=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,a)):b.size===0&&this.map.on(v,this.handleType),b.size===0&&this.interactionsByType.set(v,b),b.set(n,a),this.typeById.set(n,v)}get(n){const a=this.typeById.get(n);if(!a)return;const p=this.interactionsByType.get(a);return p?p.get(n):void 0}remove(n){const a=this.typeById.get(n);if(!a)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(a);p&&(p.delete(n),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(a,this.handleType))}queryTargets(n,a){const p=[];for(const[v,b]of a)b.target&&p.push({targetId:v,target:b.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(n,p,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());a.length&&(n.type="mouseenter",this.handleType(n,a));const p=new Map;for(const[v,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||p.set(b.id,b);p.size&&(n.type="mouseleave",this.handleType(n,Array.from(p.values())))}handleOut(n){const a=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);a.length&&(n.type="mouseleave",this.handleType(n,a)),this.hoveredFeatures.clear()}handleType(n,a){const p=Array.from(this.interactionsByType.get(n.type)).reverse(),v=!!a;a=a||this.queryTargets(n.point,p);const b=n.type==="mouseenter";let T=!1;const D=new Set;for(const L of a){for(const[z,F]of p){if(!F.target)continue;const V=L.variants?L.variants[z]:null;if(V){for(const U of V){if(dc(U,L,D,z))continue;const q=new s.cx(L,U),J=Wu(U,L,z);v&&(q.state=this.map.getFeatureState(q));const X=b?this.prevHoveredFeatures.get(J):null,ee=new Ol(n,z,F,q),ie=X?X.stop:F.handler(ee);if(b&&this.hoveredFeatures.set(J,{feature:L,stop:ie}),ie!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[L,z]of p){const{handler:F,target:V}=z;if(!V&&F(new Ol(n,L,z,null))!==!1)break}}}function qi(m,n){if(Array.isArray(m)&&Array.isArray(n)){const a=new Set(m),p=new Set(n);return a.size===p.size&&m.every(v=>p.has(v))}return s.bn(m,n)}const nl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},wb={showCompass:!0,showZoom:!0,visualizePitch:!1};class Tb{constructor(n,a,p=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Wo({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new Eh({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),fe()}move(n,a){const p=this.map,v=this.mouseRotate.mousemoveWindow(n,a),b=v&&v.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(n,a),D=T&&T.pitchDelta;D&&p.setPitch(p.getPitch()+D)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.l({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ke(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ke(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Xe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Xe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function vf(m,n,a){if(m=new s.bO(m.lng,m.lat),n){const p=new s.bO(m.lng-360,m.lat),v=new s.bO(m.lng+360,m.lat),b=360*Math.ceil(Math.abs(m.lng-a.center.lng)/360),T=a.locationPoint3D(m).distSqr(n),D=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint3D(p).distSqr(n)<T&&(D||Math.abs(p.lng-a.center.lng)<b)?m=p:a.locationPoint3D(v).distSqr(n)<T&&(D||Math.abs(v.lng-a.center.lng)<b)&&(m=v)}for(;Math.abs(m.lng-a.center.lng)>180;){const p=a.locationPoint3D(m);if(p.x>=0&&p.y>=0&&p.x<=a.width&&p.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m}const Zo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Tr={anchor:"center",color:"#3FB1CE",scale:1,draggable:!1,clickTolerance:0,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class js extends s.E{constructor(n,a){super(),(n instanceof HTMLElement||a)&&(n=s.l({element:n},a)),s.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),n=s.l({},Tr,n),this._anchor=n.anchor,this._color=n.color,this._scale=n.scale,this._draggable=n.draggable,this._clickTolerance=n.clickTolerance,this._rotation=n.rotation,this._rotationAlignment=n.rotationAlignment,this._pitchAlignment=n.pitchAlignment,this._occludedOpacity=n.occludedOpacity,this._altitude=n.altitude,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const p=this._element.classList;for(const b in Zo)p.remove(`mapboxgl-marker-anchor-${b}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const v=n&&n.className?n.className.trim().split(/\s+/):[];p.add(...v),this._popup=null}_createDefaultMarker(){const n=ne("div"),a=de("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const p=de("radialGradient",{id:"shadowGradient"},de("defs",{},a));de("stop",{offset:"10%","stop-opacity":.4},p),de("stop",{offset:"100%","stop-opacity":.05},p),de("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return de("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),de("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),de("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.bO.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||Tr.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,p=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,p=this._element;this._popup&&(a===p||p.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const p=n.unproject(a,this._altitude),v=n.getFreeCameraOptions();if(!v.position)return!1;const b=v.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(a,this._altitude);let v;n._showingGlobe()&&s.dK(n.transform,this._lngLat)?v=0:(v=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Zo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,p=this.getPitchAlignment();if(!a||!n||p!=="map")return"";if(!a._showingGlobe()){const L=a.getPitch();return L?`rotateX(${L}deg)`:""}const v=s.c4(s.dL(a.transform,this._lngLat)),b=n.sub(s.dM(a.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const D=v/T;return`rotateX(${-b.y*D}deg) rotateY(${b.x*D}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let p=0;const v=this.getRotationAlignment();if(v==="map")if(a._showingGlobe()){const b=a.project(new s.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=a.project(new s.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);p=s.c4(Math.atan2(T.y,T.x))-90}else p=-a.getBearing();else if(v==="horizon"){const b=s.ae(4,6,a.getZoom()),T=s.dM(a.transform);T.y+=b*a.transform.height;const D=n.sub(T),L=s.c4(Math.atan2(D.y,D.x));p=(L>90?L-270:L+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=vf(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const a=this._map;if(!a)return;const p=this._pointerdownPos,v=this._positionDelta;if(p&&v){if(!this._isDragging){const b=this._clickTolerance||a._clickTolerance;if(n.point.dist(p)<b)return;this._isDragging=!0}this._pos=n.point.sub(v),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,p=this._pos;a&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||Tr.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||Tr.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||Tr.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||Tr.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Er={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ls={maxWidth:100,unit:"metric"},Zm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Wn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},s0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sl(m=new s.P(0,0),n="bottom"){if(typeof m=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(n){case"top":return new s.P(0,m);case"top-left":return new s.P(a,a);case"top-right":return new s.P(-a,a);case"bottom":return new s.P(0,-m);case"bottom-left":return new s.P(a,-a);case"bottom-right":return new s.P(-a,-a);case"left":return new s.P(m,0);case"right":return new s.P(-m,0)}return new s.P(0,0)}return m instanceof s.P||Array.isArray(m)?s.P.convert(m):s.P.convert(m[n]||[0,0])}return{version:I,supported:se.supported,setRTLTextPlugin:s.dN,getRTLTextPluginStatus:s.dO,Map:class extends Wc{constructor(m){k.mark(O.create);const n=m;if((m=s.l({},nl,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&s.dI(window)&&(m.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Rd(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Gr,this._domRenderTaskQueue=new Gr,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aW(),this._locale=s.l({},Ll,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Zc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new si(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const a=document.getElementById(m.container);if(!a)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=a}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,s.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new km),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new i0(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||s.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new _y(this),m.hash&&(this._hash=new Vm(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const a=m.bounds;a&&(this.resize(),this.fitBounds(a,s.l({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new yf({customAttribution:m.customAttribution})),this._logoControl=new Hr,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.A(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.A(`${a.dataType}dataloading`,a))}),this._interactions=new Wm(this)}_getMapId(){return this._mapId}addControl(m,n){if(n===void 0&&(n=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(a,p.firstChild):p.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(m);return n>-1&&this._controls.splice(n,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.A("movestart",m)).fire(new s.A("move",m)),this.fire(new s.A("resize",m)),n&&this.fire(new s.A("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(s.aB.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(n=>n==="auto"?navigator.language:n):m}setLanguage(m){const n=this._parseLanguage(m);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,n=m.projection.name;let a;n==="globe"&&m.zoom>=s.bY?(m.setMercatorFromTransition(),a=!0):n==="mercator"&&m.zoom<s.bY&&(m.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,n){return this._updateProjection(m||n||{name:"mercator"})}_updateProjection(m){let n;return n=m.name==="globe"&&this.transform.zoom>=s.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,n){return this.transform.locationPoint3D(s.bO.convert(m),n)}unproject(m,n){return this.transform.pointLocation3D(s.P.convert(m),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,n,a){const p=v=>{let b=[];if(Array.isArray(n)){const T=n.filter(D=>this.getLayer(D));b=T.length?this.queryRenderedFeatures(v,{layers:T}):[]}else b=this.queryRenderedFeatures(v,{target:n});return b};if(m==="mouseenter"||m==="mouseover"){let v=!1;return{listener:a,targets:n,delegates:{mousemove:T=>{const D=p(T.point);D.length?v||(v=!0,a.call(this,new wr(m,this,T.originalEvent,{features:D}))):v=!1},mouseout:()=>{v=!1}}}}if(m==="mouseleave"||m==="mouseout"){let v=!1;return{listener:a,targets:n,delegates:{mousemove:D=>{p(D.point).length?v=!0:v&&(v=!1,a.call(this,new wr(m,this,D.originalEvent)))},mouseout:D=>{v&&(v=!1,a.call(this,new wr(m,this,D.originalEvent)))}}}}{const v=b=>{const T=p(b.point);T.length&&(b.features=T,a.call(this,b),delete b.features)};return{listener:a,targets:n,delegates:{[m]:v}}}}on(m,n,a){if(typeof n=="function"||a===void 0)return super.on(m,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(m,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const v in p.delegates)this.on(v,p.delegates[v]);return this}once(m,n,a){if(typeof n=="function"||a===void 0)return super.once(m,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(m,n,a);for(const v in p.delegates)this.once(v,p.delegates[v]);return this}off(m,n,a){if(typeof n=="function"||a===void 0)return super.off(m,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._delegatedListeners?this._delegatedListeners[m]:void 0;return p&&(v=>{for(let b=0;b<v.length;b++){const T=v[b];if(T.listener===a&&qi(T.targets,n)){for(const D in T.delegates)this.off(D,T.delegates[D]);return v.splice(b,1),this}}})(p),this}queryRenderedFeatures(m,n){if(!this.style)return[];if(m===void 0||m instanceof s.P||Array.isArray(m)||n!==void 0||(n=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!n){const b=this.style.queryRenderedFeatures(m,void 0,this.transform),T=this.style.queryRenderedFeatureset(m,void 0,this.transform);return b.concat(T)}let a=!0;if(n.target&&(a=this._isTargetValid(n.target),a&&!n.layers))return this.style.queryRenderedFeatureset(m,n,this.transform);let p=!0;if(n.layers&&Array.isArray(n.layers)){for(const b of n.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!n.target)return this.style.queryRenderedFeatures(m,n,this.transform)}let v=[];return p&&(v=v.concat(this.style.queryRenderedFeatures(m,n,this.transform))),a&&(v=v.concat(this.style.queryRenderedFeatureset(m,n,this.transform))),v}querySourceFeatures(m,n){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,n)}isPointOnSurface(m){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(m))}addInteraction(m,n){return this._interactions.add(m,n),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,n){return n=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&m&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(m,(a,p)=>{a?(s.w(`Unable to perform style diff: ${String(a.message||a.error||a)}. Rebuilding the style from scratch.`),this._updateStyle(m,n)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(m,n))}_getUIString(m){const n=this._locale[m];if(n==null)throw new Error(`Missing UI string '${m}'`);return n}_updateStyle(m,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const a=s.l({},n);n&&n.config&&(a.initialConfig=n.config,delete a.config),this.style=new So(this,a).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new So(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.cs(m)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const n of m)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(m)}addSource(m,n){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,n),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(m,n,a)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,n,{pixelRatio:a=1,sdf:p=!1,stretchX:v,stretchY:b,content:T}={}){this._lazyInitEmptyStyle();const D=s.I.from(m);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:L,height:z,data:F}=s.q.getImageData(n);this.style.addImage(D,{data:new s.r({width:L,height:z},F),pixelRatio:a,stretchX:v,stretchY:b,content:T,sdf:p,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:L,height:z}=n,F=n;this.style.addImage(D,{data:new s.r({width:L,height:z},new Uint8Array(F.data)),pixelRatio:a,stretchX:v,stretchY:b,content:T,sdf:p,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}updateImage(m,n){this._lazyInitEmptyStyle();const a=s.I.from(m),p=this.style.getImage(a);if(!p)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.q.getImageData(n):n,{width:b,height:T,data:D}=v;if(b===void 0||T===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||T!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const L=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let z=!1;p.usvg?(p.data=new s.r({width:b,height:T},new Uint8Array(D)),p.usvg=!1,p.icon=void 0,z=!0):p.data.replace(D,L),this.style.updateImage(a,p,z)}hasImage(m){return m?!!this.style&&!!this.style.getImage(s.I.from(m)):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(s.I.from(m))}loadImage(m,n){s.o(this._requestManager.transformRequest(m,s.R.Image),(a,p)=>{n(a,p instanceof HTMLImageElement?s.q.getImageData(p):p)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,n){this._lazyInitEmptyStyle(),this.style.addModel(m,n)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,n){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,n),this._update(!0)):this}getSlot(m){const n=this.getLayer(m);return n&&n.slot||null}setSlot(m,n){return this.style.setSlot(m,n),this.style.mergeLayers(),this._update(!0)}addImport(m,n){return this.style.addImport(m,n),this}updateImport(m,n){return typeof n!="string"&&n.id!==m?(this.removeImport(m),this.addImport(n)):(this.style.updateImport(m,n),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,n){return this.style.moveImport(m,n),this._update(!0)}moveLayer(m,n){return this._isValidId(m)?(this.style.moveLayer(m,n),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const n=this.style.getOwnLayer(m);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,n,a){return this._isValidId(m)?(this.style.setLayerZoomRange(m,n,a),this._update(!0)):this}setFilter(m,n,a={}){return this._isValidId(m)?(this.style.setFilter(m,n,a),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,n,a,p={}){return this._isValidId(m)?(this.style.setPaintProperty(m,n,a,p),this._update(!0)):this}getPaintProperty(m,n){return this._isValidId(m)?this.style.getPaintProperty(m,n):null}setLayoutProperty(m,n,a,p={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,n,a,p),this._update(!0)):this}getLayoutProperty(m,n){return this._isValidId(m)?this.style.getLayoutProperty(m,n):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,n){return this.style.setSchema(m,n),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,n){return this.style.setConfig(m,n),this._update(!0)}getConfigProperty(m,n){return this.style.getConfigProperty(m,n)}setConfigProperty(m,n,a){return this.style.setConfigProperty(m,n,a),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const n=m[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,n),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bO.convert(m),this.transform):0}setFeatureState(m,n){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,n),this._update())}removeFeatureState(m,n){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,n),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,p,v,b=this._container;for(;b&&(!p||!v);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(a=T.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(p=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(v=a[3])),b=b.parentElement}this._containerWidth=p?Math.abs(m/p):m,this._containerHeight=v?Math.abs(n/v):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=ne("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=ne("div","mapboxgl-canvas-container",m);this._canvas=ne("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=ne("div","mapboxgl-control-container",m),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{p[v]=ne("div",`mapboxgl-ctrl-${v}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,n){const a=s.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(m),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${n}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const n=this._markers.indexOf(m);n!==-1&&this._markers.splice(n,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const n=this._popups.indexOf(m);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const m=s.l({},se.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",m);n?(vr(n,!0),this.painter=new pf(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(n)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let n;this.fire(new s.A("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,p=s.q.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=v.createQuery(),v.beginQuery(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,F=this.transform.pitch,V=s.q.now(),U=new s.aa(z,{now:V,fadeDuration:b,pitch:F,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(p);const D=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),D&&(this._placementDirty=D.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,k.mark(O.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const z=s.q.now()-p;v.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const F=v.getQueryParameter(n,v.QUERY_RESULT)/1e6;v.deleteQuery(n),this.fire(new s.A("gpu-timing-frame",{cpuTime:z,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(z);this.fire(new s.A("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(z);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:F}))},50)}const L=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(L||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(T=this._updateAverageElevation(p,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,k.mark(O.fullLoad),this._performanceMetricsCollection&&Ns(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const n of this._markers)m&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!m||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(m,n=!1){const a=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const v=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const T=Math.abs(v-b);if(T>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),a(b);this._averageElevation.easeTo(b,m,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),a(b)}return!!this._averageElevation.isEasing(m)&&a(this._averageElevation.getValue(m))}_authenticate(){ce(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===Mt||m.status===401)){const n=this.painter.context.gl;vr(n,!1),this._logoControl instanceof Hr&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ys(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Sn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,p=a.createFramebuffer();function v(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);const T=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,T),T}return a.bindFramebuffer(a.FRAMEBUFFER,p),this._canvasPixelComparison(v(m),n.canvasCopies.map(v),n.timeStamps)}_canvasPixelComparison(m,n,a){let p=a[1]-a[0];const v=m.length/4;for(let b=0;b<n.length;b++){const T=n[b];let D=0;for(let L=0;L<T.length;L+=4)T[L]===m[L]&&T[L+1]===m[L+1]&&T[L+2]===m[L+2]&&T[L+3]===m[L+3]&&(D+=1);p+=(a[b+2]-a[b+1])*(1-D/v)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),dr.delete(this.painter.context.gl),Fr.remove(),li.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=s.q.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(m){const n=this.style?this.style.getSourceCaches():[];return s.bl(n,(a,p)=>a._preloadTiles(m,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,n){s.dJ(m,n)}get version(){return I}},NavigationControl:class{constructor(m={}){this.options=s.l({},wb,m),this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),ne("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),ne("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=ne("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const n=m.getZoom(),a=n===m.getMaxZoom(),p=n===m.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tb(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,n){const a=ne("button",m,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(m,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);m.setAttribute("aria-label",a),m.firstElementChild&&m.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.E{constructor(m={}){super();const n=navigator.geolocation;this.options=s.l({geolocation:n},Er,m),s.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=mf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,m(a)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>n(a.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(m){const n=this._map.getMaxBounds(),a=m.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",m)),this._finish()}}_updateCamera(m){const n=new s.bO(m.coords.longitude,m.coords.latitude),a=m.coords.accuracy,p=this._map.getBearing(),v=s.l({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),v,{geolocateSource:!0})}_updateMarker(m){if(m){const n=new s.bO(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,n=s.bH(1,m._center.lat)*m.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=ne("button","mapboxgl-ctrl-geolocate",this._container),ne("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ne("div","mapboxgl-user-location"),this._dotElement.appendChild(ne("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ne("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new js({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ne("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new js({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:yf,ScaleControl:class{constructor(m={}){this.options=s.l({},Ls,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,p=n._containerWidth/2-m/2,v=n.unproject([p,a]),b=n.unproject([p+m,a]),T=v.distanceTo(b);if(this.options.unit==="imperial"){const D=3.2808*T;D>5280?this._setScale(m,D/5280,"mile"):this._setScale(m,D,"foot")}else this.options.unit==="nautical"?this._setScale(m,T/1852,"nautical-mile"):T>=1e3?this._setScale(m,T/1e3,"kilometer"):this._setScale(m,T,"meter")}_setScale(m,n,a){this._map._requestDomTask(()=>{const p=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let D=b/T;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(L){const z=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*z)/z}(D),T*D}(n),v=p/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(p):`${p}&nbsp;${Zm[a]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),s.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=ne("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ne("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(m){super(),this.options=s.l(Object.create(Wn),m),this._altitude=this.options.altitude,s.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=s.bO.convert(m),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const n=document.createDocumentFragment(),a=document.createElement("body");let p;for(a.innerHTML=m;p=a.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=ne("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(m),this.options.closeButton){const a=this._closeButton=ne("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let n;return this._classList.delete(m)?n=!1:(this._classList.add(m),n=!0),this._updateClassList(),n}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,p=this._pos;if(!n||!a||!p)return"bottom";const v=a.offsetWidth,b=a.offsetHeight,T=p.x<v/2,D=p.x>n.transform.width-v/2;if(p.y+m<b)return T?"top-left":D?"top-right":"top";if(p.y>n.transform.height-b){if(T)return"bottom-left";if(D)return"bottom-right"}return T?"left":D?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),m.className=n.join(" ")}_update(m){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let p=this._container;if(p||(p=this._container=ne("div","mapboxgl-popup",n.getContainer()),this._tip=ne("div","mapboxgl-popup-tip",p),p.appendChild(a)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vf(this._lngLat,this._pos,n.transform)),!this._trackPointer||m){const v=this._pos=this._trackPointer&&m instanceof s.P?m:n.project(this._lngLat,this._altitude),b=sl(this.options.offset),T=this._anchor=this._getAnchor(b.y),D=sl(this.options.offset,T),L=v.add(D).round();n._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Zo[T]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&n._showingGlobe()){const v=s.dK(n.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(s0);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:js,Style:So,LngLat:s.bO,LngLatBounds:s.aB,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:Hp,Evented:s.E,config:s.e,prewarm:s.dP,clearPrewarmedResources:s.dQ,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(m){s.e.ACCESS_TOKEN=m},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(m){s.e.API_URL=m},get workerCount(){return s.dR.workerCount},set workerCount(m){s.dR.workerCount=m},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){s.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){s.dS(m)},get workerUrl(){return s.dT.workerUrl},set workerUrl(m){s.dT.workerUrl=m},get workerClass(){return s.dT.workerClass},set workerClass(m){s.dT.workerClass=m},get workerParams(){return s.dT.workerParams},set workerParams(m){s.dT.workerParams=m},get dracoUrl(){return s.dU()},set dracoUrl(m){s.dV(m)},get meshoptUrl(){return s.dW()},set meshoptUrl(m){s.dX(m)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var y=h;return y})})(Wz);var OQ=Wz.exports;const Cv=LQ(OQ);const kQ={name:"Mapa",mounted(){Cv.accessToken="pk.eyJ1IjoiY2FybGFjYXllcm8iLCJhIjoiY204eDZ3aWh1MDBnazJxcXgxeHl1dWg2aSJ9.EHGR1JHYwBI4fi9dwJCrJA";const t=new Cv.Map({container:"map",style:"mapbox://styles/carlacayero/cm8yl237n003q01qz6p8t3hmp",center:[2.1731,41.38877],zoom:18,bearing:-50,hash:!1,interactive:!0,attributionControl:!1});new Cv.Marker().setLngLat([2.1731,41.38877]).addTo(t),t.addControl(new Cv.NavigationControl)}},zQ={id:"map"};function FQ(t,e,r,l,h,_){return Fi(),tn("div",zQ)}const BQ=yl(kQ,[["render",FQ],["__scopeId","data-v-e9ec964c"]]);var oy={},NQ=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},Xz={},$o={};let w2;const VQ=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];$o.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};$o.getSymbolTotalCodewords=function(e){return VQ[e]};$o.getBCHDigit=function(t){let e=0;for(;t!==0;)e++,t>>>=1;return e};$o.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');w2=e};$o.isKanjiModeEnabled=function(){return typeof w2<"u"};$o.toSJIS=function(e){return w2(e)};var F1={};(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+r)}}t.isValid=function(l){return l&&typeof l.bit<"u"&&l.bit>=0&&l.bit<4},t.from=function(l,h){if(t.isValid(l))return l;try{return e(l)}catch{return h}}})(F1);function Yz(){this.buffer=[],this.length=0}Yz.prototype={get:function(t){const e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let r=0;r<e;r++)this.putBit((t>>>e-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var UQ=Yz;function ay(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}ay.prototype.set=function(t,e,r,l){const h=t*this.size+e;this.data[h]=r,l&&(this.reservedBit[h]=!0)};ay.prototype.get=function(t,e){return this.data[t*this.size+e]};ay.prototype.xor=function(t,e,r){this.data[t*this.size+e]^=r};ay.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};var jQ=ay,Kz={};(function(t){const e=$o.getSymbolSize;t.getRowColCoords=function(l){if(l===1)return[];const h=Math.floor(l/7)+2,_=e(l),y=_===145?26:Math.ceil((_-13)/(2*h-2))*2,s=[_-7];for(let I=1;I<h-1;I++)s[I]=s[I-1]-y;return s.push(6),s.reverse()},t.getPositions=function(l){const h=[],_=t.getRowColCoords(l),y=_.length;for(let s=0;s<y;s++)for(let I=0;I<y;I++)s===0&&I===0||s===0&&I===y-1||s===y-1&&I===0||h.push([_[s],_[I]]);return h}})(Kz);var Jz={};const $Q=$o.getSymbolSize,CR=7;Jz.getPositions=function(e){const r=$Q(e);return[[0,0],[r-CR,0],[0,r-CR]]};var Qz={};(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(h){return h!=null&&h!==""&&!isNaN(h)&&h>=0&&h<=7},t.from=function(h){return t.isValid(h)?parseInt(h,10):void 0},t.getPenaltyN1=function(h){const _=h.size;let y=0,s=0,I=0,O=null,k=null;for(let j=0;j<_;j++){s=I=0,O=k=null;for(let Z=0;Z<_;Z++){let Y=h.get(j,Z);Y===O?s++:(s>=5&&(y+=e.N1+(s-5)),O=Y,s=1),Y=h.get(Z,j),Y===k?I++:(I>=5&&(y+=e.N1+(I-5)),k=Y,I=1)}s>=5&&(y+=e.N1+(s-5)),I>=5&&(y+=e.N1+(I-5))}return y},t.getPenaltyN2=function(h){const _=h.size;let y=0;for(let s=0;s<_-1;s++)for(let I=0;I<_-1;I++){const O=h.get(s,I)+h.get(s,I+1)+h.get(s+1,I)+h.get(s+1,I+1);(O===4||O===0)&&y++}return y*e.N2},t.getPenaltyN3=function(h){const _=h.size;let y=0,s=0,I=0;for(let O=0;O<_;O++){s=I=0;for(let k=0;k<_;k++)s=s<<1&2047|h.get(O,k),k>=10&&(s===1488||s===93)&&y++,I=I<<1&2047|h.get(k,O),k>=10&&(I===1488||I===93)&&y++}return y*e.N3},t.getPenaltyN4=function(h){let _=0;const y=h.data.length;for(let I=0;I<y;I++)_+=h.data[I];return Math.abs(Math.ceil(_*100/y/5)-10)*e.N4};function r(l,h,_){switch(l){case t.Patterns.PATTERN000:return(h+_)%2===0;case t.Patterns.PATTERN001:return h%2===0;case t.Patterns.PATTERN010:return _%3===0;case t.Patterns.PATTERN011:return(h+_)%3===0;case t.Patterns.PATTERN100:return(Math.floor(h/2)+Math.floor(_/3))%2===0;case t.Patterns.PATTERN101:return h*_%2+h*_%3===0;case t.Patterns.PATTERN110:return(h*_%2+h*_%3)%2===0;case t.Patterns.PATTERN111:return(h*_%3+(h+_)%2)%2===0;default:throw new Error("bad maskPattern:"+l)}}t.applyMask=function(h,_){const y=_.size;for(let s=0;s<y;s++)for(let I=0;I<y;I++)_.isReserved(I,s)||_.xor(I,s,r(h,I,s))},t.getBestMask=function(h,_){const y=Object.keys(t.Patterns).length;let s=0,I=1/0;for(let O=0;O<y;O++){_(O),t.applyMask(O,h);const k=t.getPenaltyN1(h)+t.getPenaltyN2(h)+t.getPenaltyN3(h)+t.getPenaltyN4(h);t.applyMask(O,h),k<I&&(I=k,s=O)}return s}})(Qz);var B1={};const bu=F1,Pv=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],Dv=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];B1.getBlocksCount=function(e,r){switch(r){case bu.L:return Pv[(e-1)*4+0];case bu.M:return Pv[(e-1)*4+1];case bu.Q:return Pv[(e-1)*4+2];case bu.H:return Pv[(e-1)*4+3];default:return}};B1.getTotalCodewordsCount=function(e,r){switch(r){case bu.L:return Dv[(e-1)*4+0];case bu.M:return Dv[(e-1)*4+1];case bu.Q:return Dv[(e-1)*4+2];case bu.H:return Dv[(e-1)*4+3];default:return}};var eF={},N1={};const p_=new Uint8Array(512),jx=new Uint8Array(256);(function(){let e=1;for(let r=0;r<255;r++)p_[r]=e,jx[e]=r,e<<=1,e&256&&(e^=285);for(let r=255;r<512;r++)p_[r]=p_[r-255]})();N1.log=function(e){if(e<1)throw new Error("log("+e+")");return jx[e]};N1.exp=function(e){return p_[e]};N1.mul=function(e,r){return e===0||r===0?0:p_[jx[e]+jx[r]]};(function(t){const e=N1;t.mul=function(l,h){const _=new Uint8Array(l.length+h.length-1);for(let y=0;y<l.length;y++)for(let s=0;s<h.length;s++)_[y+s]^=e.mul(l[y],h[s]);return _},t.mod=function(l,h){let _=new Uint8Array(l);for(;_.length-h.length>=0;){const y=_[0];for(let I=0;I<h.length;I++)_[I]^=e.mul(h[I],y);let s=0;for(;s<_.length&&_[s]===0;)s++;_=_.slice(s)}return _},t.generateECPolynomial=function(l){let h=new Uint8Array([1]);for(let _=0;_<l;_++)h=t.mul(h,new Uint8Array([1,e.exp(_)]));return h}})(eF);const tF=eF;function T2(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}T2.prototype.initialize=function(e){this.degree=e,this.genPoly=tF.generateECPolynomial(this.degree)};T2.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const r=new Uint8Array(e.length+this.degree);r.set(e);const l=tF.mod(r,this.genPoly),h=this.degree-l.length;if(h>0){const _=new Uint8Array(this.degree);return _.set(l,h),_}return l};var HQ=T2,iF={},ju={},E2={};E2.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var vl={};const nF="[0-9]+",GQ="[A-Z $%*+\\-./:]+";let U_="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";U_=U_.replace(/u/g,"\\u");const qQ="(?:(?![A-Z0-9 $%*+\\-./:]|"+U_+`)(?:.|[\r
]))+`;vl.KANJI=new RegExp(U_,"g");vl.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");vl.BYTE=new RegExp(qQ,"g");vl.NUMERIC=new RegExp(nF,"g");vl.ALPHANUMERIC=new RegExp(GQ,"g");const WQ=new RegExp("^"+U_+"$"),ZQ=new RegExp("^"+nF+"$"),XQ=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");vl.testKanji=function(e){return WQ.test(e)};vl.testNumeric=function(e){return ZQ.test(e)};vl.testAlphanumeric=function(e){return XQ.test(e)};(function(t){const e=E2,r=vl;t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(_,y){if(!_.ccBits)throw new Error("Invalid mode: "+_);if(!e.isValid(y))throw new Error("Invalid version: "+y);return y>=1&&y<10?_.ccBits[0]:y<27?_.ccBits[1]:_.ccBits[2]},t.getBestModeForData=function(_){return r.testNumeric(_)?t.NUMERIC:r.testAlphanumeric(_)?t.ALPHANUMERIC:r.testKanji(_)?t.KANJI:t.BYTE},t.toString=function(_){if(_&&_.id)return _.id;throw new Error("Invalid mode")},t.isValid=function(_){return _&&_.bit&&_.ccBits};function l(h){if(typeof h!="string")throw new Error("Param is not a string");switch(h.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+h)}}t.from=function(_,y){if(t.isValid(_))return _;try{return l(_)}catch{return y}}})(ju);(function(t){const e=$o,r=B1,l=F1,h=ju,_=E2,y=7973,s=e.getBCHDigit(y);function I(Z,Y,se){for(let ne=1;ne<=40;ne++)if(Y<=t.getCapacity(ne,se,Z))return ne}function O(Z,Y){return h.getCharCountIndicator(Z,Y)+4}function k(Z,Y){let se=0;return Z.forEach(function(ne){const de=O(ne.mode,Y);se+=de+ne.getBitsLength()}),se}function j(Z,Y){for(let se=1;se<=40;se++)if(k(Z,se)<=t.getCapacity(se,Y,h.MIXED))return se}t.from=function(Y,se){return _.isValid(Y)?parseInt(Y,10):se},t.getCapacity=function(Y,se,ne){if(!_.isValid(Y))throw new Error("Invalid QR Code version");typeof ne>"u"&&(ne=h.BYTE);const de=e.getSymbolTotalCodewords(Y),me=r.getTotalCodewordsCount(Y,se),Te=(de-me)*8;if(ne===h.MIXED)return Te;const ge=Te-O(ne,Y);switch(ne){case h.NUMERIC:return Math.floor(ge/10*3);case h.ALPHANUMERIC:return Math.floor(ge/11*2);case h.KANJI:return Math.floor(ge/13);case h.BYTE:default:return Math.floor(ge/8)}},t.getBestVersionForData=function(Y,se){let ne;const de=l.from(se,l.M);if(Array.isArray(Y)){if(Y.length>1)return j(Y,de);if(Y.length===0)return 1;ne=Y[0]}else ne=Y;return I(ne.mode,ne.getLength(),de)},t.getEncodedBits=function(Y){if(!_.isValid(Y)||Y<7)throw new Error("Invalid QR Code version");let se=Y<<12;for(;e.getBCHDigit(se)-s>=0;)se^=y<<e.getBCHDigit(se)-s;return Y<<12|se}})(iF);var sF={};const NE=$o,rF=1335,YQ=21522,PR=NE.getBCHDigit(rF);sF.getEncodedBits=function(e,r){const l=e.bit<<3|r;let h=l<<10;for(;NE.getBCHDigit(h)-PR>=0;)h^=rF<<NE.getBCHDigit(h)-PR;return(l<<10|h)^YQ};var oF={};const KQ=ju;function Tp(t){this.mode=KQ.NUMERIC,this.data=t.toString()}Tp.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};Tp.prototype.getLength=function(){return this.data.length};Tp.prototype.getBitsLength=function(){return Tp.getBitsLength(this.data.length)};Tp.prototype.write=function(e){let r,l,h;for(r=0;r+3<=this.data.length;r+=3)l=this.data.substr(r,3),h=parseInt(l,10),e.put(h,10);const _=this.data.length-r;_>0&&(l=this.data.substr(r),h=parseInt(l,10),e.put(h,_*3+1))};var JQ=Tp;const QQ=ju,DT=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Ep(t){this.mode=QQ.ALPHANUMERIC,this.data=t}Ep.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};Ep.prototype.getLength=function(){return this.data.length};Ep.prototype.getBitsLength=function(){return Ep.getBitsLength(this.data.length)};Ep.prototype.write=function(e){let r;for(r=0;r+2<=this.data.length;r+=2){let l=DT.indexOf(this.data[r])*45;l+=DT.indexOf(this.data[r+1]),e.put(l,11)}this.data.length%2&&e.put(DT.indexOf(this.data[r]),6)};var eee=Ep;const tee=ju;function Sp(t){this.mode=tee.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}Sp.getBitsLength=function(e){return e*8};Sp.prototype.getLength=function(){return this.data.length};Sp.prototype.getBitsLength=function(){return Sp.getBitsLength(this.data.length)};Sp.prototype.write=function(t){for(let e=0,r=this.data.length;e<r;e++)t.put(this.data[e],8)};var iee=Sp;const nee=ju,see=$o;function Ap(t){this.mode=nee.KANJI,this.data=t}Ap.getBitsLength=function(e){return e*13};Ap.prototype.getLength=function(){return this.data.length};Ap.prototype.getBitsLength=function(){return Ap.getBitsLength(this.data.length)};Ap.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let r=see.toSJIS(this.data[e]);if(r>=33088&&r<=40956)r-=33088;else if(r>=57408&&r<=60351)r-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);r=(r>>>8&255)*192+(r&255),t.put(r,13)}};var ree=Ap,aF={exports:{}};(function(t){var e={single_source_shortest_paths:function(r,l,h){var _={},y={};y[l]=0;var s=e.PriorityQueue.make();s.push(l,0);for(var I,O,k,j,Z,Y,se,ne,de;!s.empty();){I=s.pop(),O=I.value,j=I.cost,Z=r[O]||{};for(k in Z)Z.hasOwnProperty(k)&&(Y=Z[k],se=j+Y,ne=y[k],de=typeof y[k]>"u",(de||ne>se)&&(y[k]=se,s.push(k,se),_[k]=O))}if(typeof h<"u"&&typeof y[h]>"u"){var me=["Could not find a path from ",l," to ",h,"."].join("");throw new Error(me)}return _},extract_shortest_path_from_predecessor_list:function(r,l){for(var h=[],_=l;_;)h.push(_),r[_],_=r[_];return h.reverse(),h},find_path:function(r,l,h){var _=e.single_source_shortest_paths(r,l,h);return e.extract_shortest_path_from_predecessor_list(_,h)},PriorityQueue:{make:function(r){var l=e.PriorityQueue,h={},_;r=r||{};for(_ in l)l.hasOwnProperty(_)&&(h[_]=l[_]);return h.queue=[],h.sorter=r.sorter||l.default_sorter,h},default_sorter:function(r,l){return r.cost-l.cost},push:function(r,l){var h={value:r,cost:l};this.queue.push(h),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(aF);var oee=aF.exports;(function(t){const e=ju,r=JQ,l=eee,h=iee,_=ree,y=vl,s=$o,I=oee;function O(me){return unescape(encodeURIComponent(me)).length}function k(me,Te,ge){const fe=[];let Ae;for(;(Ae=me.exec(ge))!==null;)fe.push({data:Ae[0],index:Ae.index,mode:Te,length:Ae[0].length});return fe}function j(me){const Te=k(y.NUMERIC,e.NUMERIC,me),ge=k(y.ALPHANUMERIC,e.ALPHANUMERIC,me);let fe,Ae;return s.isKanjiModeEnabled()?(fe=k(y.BYTE,e.BYTE,me),Ae=k(y.KANJI,e.KANJI,me)):(fe=k(y.BYTE_KANJI,e.BYTE,me),Ae=[]),Te.concat(ge,fe,Ae).sort(function(ze,Ke){return ze.index-Ke.index}).map(function(ze){return{data:ze.data,mode:ze.mode,length:ze.length}})}function Z(me,Te){switch(Te){case e.NUMERIC:return r.getBitsLength(me);case e.ALPHANUMERIC:return l.getBitsLength(me);case e.KANJI:return _.getBitsLength(me);case e.BYTE:return h.getBitsLength(me)}}function Y(me){return me.reduce(function(Te,ge){const fe=Te.length-1>=0?Te[Te.length-1]:null;return fe&&fe.mode===ge.mode?(Te[Te.length-1].data+=ge.data,Te):(Te.push(ge),Te)},[])}function se(me){const Te=[];for(let ge=0;ge<me.length;ge++){const fe=me[ge];switch(fe.mode){case e.NUMERIC:Te.push([fe,{data:fe.data,mode:e.ALPHANUMERIC,length:fe.length},{data:fe.data,mode:e.BYTE,length:fe.length}]);break;case e.ALPHANUMERIC:Te.push([fe,{data:fe.data,mode:e.BYTE,length:fe.length}]);break;case e.KANJI:Te.push([fe,{data:fe.data,mode:e.BYTE,length:O(fe.data)}]);break;case e.BYTE:Te.push([{data:fe.data,mode:e.BYTE,length:O(fe.data)}])}}return Te}function ne(me,Te){const ge={},fe={start:{}};let Ae=["start"];for(let Ge=0;Ge<me.length;Ge++){const ze=me[Ge],Ke=[];for(let Xe=0;Xe<ze.length;Xe++){const Ue=ze[Xe],et=""+Ge+Xe;Ke.push(et),ge[et]={node:Ue,lastCount:0},fe[et]={};for(let lt=0;lt<Ae.length;lt++){const Mt=Ae[lt];ge[Mt]&&ge[Mt].node.mode===Ue.mode?(fe[Mt][et]=Z(ge[Mt].lastCount+Ue.length,Ue.mode)-Z(ge[Mt].lastCount,Ue.mode),ge[Mt].lastCount+=Ue.length):(ge[Mt]&&(ge[Mt].lastCount=Ue.length),fe[Mt][et]=Z(Ue.length,Ue.mode)+4+e.getCharCountIndicator(Ue.mode,Te))}}Ae=Ke}for(let Ge=0;Ge<Ae.length;Ge++)fe[Ae[Ge]].end=0;return{map:fe,table:ge}}function de(me,Te){let ge;const fe=e.getBestModeForData(me);if(ge=e.from(Te,fe),ge!==e.BYTE&&ge.bit<fe.bit)throw new Error('"'+me+'" cannot be encoded with mode '+e.toString(ge)+`.
 Suggested mode is: `+e.toString(fe));switch(ge===e.KANJI&&!s.isKanjiModeEnabled()&&(ge=e.BYTE),ge){case e.NUMERIC:return new r(me);case e.ALPHANUMERIC:return new l(me);case e.KANJI:return new _(me);case e.BYTE:return new h(me)}}t.fromArray=function(Te){return Te.reduce(function(ge,fe){return typeof fe=="string"?ge.push(de(fe,null)):fe.data&&ge.push(de(fe.data,fe.mode)),ge},[])},t.fromString=function(Te,ge){const fe=j(Te,s.isKanjiModeEnabled()),Ae=se(fe),Ge=ne(Ae,ge),ze=I.find_path(Ge.map,"start","end"),Ke=[];for(let Xe=1;Xe<ze.length-1;Xe++)Ke.push(Ge.table[ze[Xe]].node);return t.fromArray(Y(Ke))},t.rawSplit=function(Te){return t.fromArray(j(Te,s.isKanjiModeEnabled()))}})(oF);const V1=$o,RT=F1,aee=UQ,lee=jQ,cee=Kz,uee=Jz,VE=Qz,UE=B1,hee=HQ,$x=iF,dee=sF,fee=ju,LT=oF;function pee(t,e){const r=t.size,l=uee.getPositions(e);for(let h=0;h<l.length;h++){const _=l[h][0],y=l[h][1];for(let s=-1;s<=7;s++)if(!(_+s<=-1||r<=_+s))for(let I=-1;I<=7;I++)y+I<=-1||r<=y+I||(s>=0&&s<=6&&(I===0||I===6)||I>=0&&I<=6&&(s===0||s===6)||s>=2&&s<=4&&I>=2&&I<=4?t.set(_+s,y+I,!0,!0):t.set(_+s,y+I,!1,!0))}}function mee(t){const e=t.size;for(let r=8;r<e-8;r++){const l=r%2===0;t.set(r,6,l,!0),t.set(6,r,l,!0)}}function gee(t,e){const r=cee.getPositions(e);for(let l=0;l<r.length;l++){const h=r[l][0],_=r[l][1];for(let y=-2;y<=2;y++)for(let s=-2;s<=2;s++)y===-2||y===2||s===-2||s===2||y===0&&s===0?t.set(h+y,_+s,!0,!0):t.set(h+y,_+s,!1,!0)}}function _ee(t,e){const r=t.size,l=$x.getEncodedBits(e);let h,_,y;for(let s=0;s<18;s++)h=Math.floor(s/3),_=s%3+r-8-3,y=(l>>s&1)===1,t.set(h,_,y,!0),t.set(_,h,y,!0)}function OT(t,e,r){const l=t.size,h=dee.getEncodedBits(e,r);let _,y;for(_=0;_<15;_++)y=(h>>_&1)===1,_<6?t.set(_,8,y,!0):_<8?t.set(_+1,8,y,!0):t.set(l-15+_,8,y,!0),_<8?t.set(8,l-_-1,y,!0):_<9?t.set(8,15-_-1+1,y,!0):t.set(8,15-_-1,y,!0);t.set(l-8,8,1,!0)}function yee(t,e){const r=t.size;let l=-1,h=r-1,_=7,y=0;for(let s=r-1;s>0;s-=2)for(s===6&&s--;;){for(let I=0;I<2;I++)if(!t.isReserved(h,s-I)){let O=!1;y<e.length&&(O=(e[y]>>>_&1)===1),t.set(h,s-I,O),_--,_===-1&&(y++,_=7)}if(h+=l,h<0||r<=h){h-=l,l=-l;break}}}function vee(t,e,r){const l=new aee;r.forEach(function(I){l.put(I.mode.bit,4),l.put(I.getLength(),fee.getCharCountIndicator(I.mode,t)),I.write(l)});const h=V1.getSymbolTotalCodewords(t),_=UE.getTotalCodewordsCount(t,e),y=(h-_)*8;for(l.getLengthInBits()+4<=y&&l.put(0,4);l.getLengthInBits()%8!==0;)l.putBit(0);const s=(y-l.getLengthInBits())/8;for(let I=0;I<s;I++)l.put(I%2?17:236,8);return xee(l,t,e)}function xee(t,e,r){const l=V1.getSymbolTotalCodewords(e),h=UE.getTotalCodewordsCount(e,r),_=l-h,y=UE.getBlocksCount(e,r),s=l%y,I=y-s,O=Math.floor(l/y),k=Math.floor(_/y),j=k+1,Z=O-k,Y=new hee(Z);let se=0;const ne=new Array(y),de=new Array(y);let me=0;const Te=new Uint8Array(t.buffer);for(let ze=0;ze<y;ze++){const Ke=ze<I?k:j;ne[ze]=Te.slice(se,se+Ke),de[ze]=Y.encode(ne[ze]),se+=Ke,me=Math.max(me,Ke)}const ge=new Uint8Array(l);let fe=0,Ae,Ge;for(Ae=0;Ae<me;Ae++)for(Ge=0;Ge<y;Ge++)Ae<ne[Ge].length&&(ge[fe++]=ne[Ge][Ae]);for(Ae=0;Ae<Z;Ae++)for(Ge=0;Ge<y;Ge++)ge[fe++]=de[Ge][Ae];return ge}function bee(t,e,r,l){let h;if(Array.isArray(t))h=LT.fromArray(t);else if(typeof t=="string"){let O=e;if(!O){const k=LT.rawSplit(t);O=$x.getBestVersionForData(k,r)}h=LT.fromString(t,O||40)}else throw new Error("Invalid data");const _=$x.getBestVersionForData(h,r);if(!_)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=_;else if(e<_)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+_+`.
`);const y=vee(e,r,h),s=V1.getSymbolSize(e),I=new lee(s);return pee(I,e),mee(I),gee(I,e),OT(I,r,0),e>=7&&_ee(I,e),yee(I,y),isNaN(l)&&(l=VE.getBestMask(I,OT.bind(null,I,r))),VE.applyMask(l,I),OT(I,r,l),{modules:I,version:e,errorCorrectionLevel:r,maskPattern:l,segments:h}}Xz.create=function(e,r){if(typeof e>"u"||e==="")throw new Error("No input text");let l=RT.M,h,_;return typeof r<"u"&&(l=RT.from(r.errorCorrectionLevel,RT.M),h=$x.from(r.version),_=VE.from(r.maskPattern),r.toSJISFunc&&V1.setToSJISFunction(r.toSJISFunc)),bee(e,h,l,_)};var lF={},S2={};(function(t){function e(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let l=r.slice().replace("#","").split("");if(l.length<3||l.length===5||l.length>8)throw new Error("Invalid hex color: "+r);(l.length===3||l.length===4)&&(l=Array.prototype.concat.apply([],l.map(function(_){return[_,_]}))),l.length===6&&l.push("F","F");const h=parseInt(l.join(""),16);return{r:h>>24&255,g:h>>16&255,b:h>>8&255,a:h&255,hex:"#"+l.slice(0,6).join("")}}t.getOptions=function(l){l||(l={}),l.color||(l.color={});const h=typeof l.margin>"u"||l.margin===null||l.margin<0?4:l.margin,_=l.width&&l.width>=21?l.width:void 0,y=l.scale||4;return{width:_,scale:_?4:y,margin:h,color:{dark:e(l.color.dark||"#000000ff"),light:e(l.color.light||"#ffffffff")},type:l.type,rendererOpts:l.rendererOpts||{}}},t.getScale=function(l,h){return h.width&&h.width>=l+h.margin*2?h.width/(l+h.margin*2):h.scale},t.getImageWidth=function(l,h){const _=t.getScale(l,h);return Math.floor((l+h.margin*2)*_)},t.qrToImageData=function(l,h,_){const y=h.modules.size,s=h.modules.data,I=t.getScale(y,_),O=Math.floor((y+_.margin*2)*I),k=_.margin*I,j=[_.color.light,_.color.dark];for(let Z=0;Z<O;Z++)for(let Y=0;Y<O;Y++){let se=(Z*O+Y)*4,ne=_.color.light;if(Z>=k&&Y>=k&&Z<O-k&&Y<O-k){const de=Math.floor((Z-k)/I),me=Math.floor((Y-k)/I);ne=j[s[de*y+me]?1:0]}l[se++]=ne.r,l[se++]=ne.g,l[se++]=ne.b,l[se]=ne.a}}})(S2);(function(t){const e=S2;function r(h,_,y){h.clearRect(0,0,_.width,_.height),_.style||(_.style={}),_.height=y,_.width=y,_.style.height=y+"px",_.style.width=y+"px"}function l(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(_,y,s){let I=s,O=y;typeof I>"u"&&(!y||!y.getContext)&&(I=y,y=void 0),y||(O=l()),I=e.getOptions(I);const k=e.getImageWidth(_.modules.size,I),j=O.getContext("2d"),Z=j.createImageData(k,k);return e.qrToImageData(Z.data,_,I),r(j,O,k),j.putImageData(Z,0,0),O},t.renderToDataURL=function(_,y,s){let I=s;typeof I>"u"&&(!y||!y.getContext)&&(I=y,y=void 0),I||(I={});const O=t.render(_,y,I),k=I.type||"image/png",j=I.rendererOpts||{};return O.toDataURL(k,j.quality)}})(lF);var cF={};const wee=S2;function DR(t,e){const r=t.a/255,l=e+'="'+t.hex+'"';return r<1?l+" "+e+'-opacity="'+r.toFixed(2).slice(1)+'"':l}function kT(t,e,r){let l=t+e;return typeof r<"u"&&(l+=" "+r),l}function Tee(t,e,r){let l="",h=0,_=!1,y=0;for(let s=0;s<t.length;s++){const I=Math.floor(s%e),O=Math.floor(s/e);!I&&!_&&(_=!0),t[s]?(y++,s>0&&I>0&&t[s-1]||(l+=_?kT("M",I+r,.5+O+r):kT("m",h,0),h=0,_=!1),I+1<e&&t[s+1]||(l+=kT("h",y),y=0)):h++}return l}cF.render=function(e,r,l){const h=wee.getOptions(r),_=e.modules.size,y=e.modules.data,s=_+h.margin*2,I=h.color.light.a?"<path "+DR(h.color.light,"fill")+' d="M0 0h'+s+"v"+s+'H0z"/>':"",O="<path "+DR(h.color.dark,"stroke")+' d="'+Tee(y,_,h.margin)+'"/>',k='viewBox="0 0 '+s+" "+s+'"',Z='<svg xmlns="http://www.w3.org/2000/svg" '+(h.width?'width="'+h.width+'" height="'+h.width+'" ':"")+k+' shape-rendering="crispEdges">'+I+O+`</svg>
`;return typeof l=="function"&&l(null,Z),Z};const Eee=NQ,jE=Xz,uF=lF,See=cF;function A2(t,e,r,l,h){const _=[].slice.call(arguments,1),y=_.length,s=typeof _[y-1]=="function";if(!s&&!Eee())throw new Error("Callback required as last argument");if(s){if(y<2)throw new Error("Too few arguments provided");y===2?(h=r,r=e,e=l=void 0):y===3&&(e.getContext&&typeof h>"u"?(h=l,l=void 0):(h=l,l=r,r=e,e=void 0))}else{if(y<1)throw new Error("Too few arguments provided");return y===1?(r=e,e=l=void 0):y===2&&!e.getContext&&(l=r,r=e,e=void 0),new Promise(function(I,O){try{const k=jE.create(r,l);I(t(k,e,l))}catch(k){O(k)}})}try{const I=jE.create(r,l);h(null,t(I,e,l))}catch(I){h(I)}}oy.create=jE.create;oy.toCanvas=A2.bind(null,uF.render);oy.toDataURL=A2.bind(null,uF.renderToDataURL);oy.toString=A2.bind(null,function(t,e,r){return See.render(t,r)});const Aee={props:{juegoID:Number,eventos:Array},data(){return{espacios:[],qrCode:"",qrEventoId:null,mostrarModal:!1,correoUsuario:"",eventoSeleccionado:null,mostrarConfirmacion:!1}},methods:{FetchEspacios(){axios.get("espacios").then(t=>{this.espacios=t.data}).catch(t=>{console.error("Error al cargar los datos:",t)})},getEspacioNombre(t){const e=this.espacios.find(r=>r.id_espacio===t);return e?e.nombre:"Desconocido"},abrirModal(t){console.log("Abriendo modal para evento:",t),this.eventoSeleccionado=t,this.mostrarModal=!0},cerrarModal(){this.mostrarModal=!1,this.correoUsuario=""},cerrarConfirmacion(){this.mostrarConfirmacion=!1},enviarQR(){if(!this.correoUsuario){alert("Por favor, introduce un correo electrónico válido.");return}const t=this.eventoSeleccionado,e=`
                Nombre del Evento: ${t.nombre}
                Fecha: ${t.fecha_inicio} - ${t.fecha_fin}
                Descripción: ${t.descripcion}
                Espacio: ${this.getEspacioNombre(t.espacios_id_espacio)}
            `;oy.toDataURL(e).then(r=>{console.log("QR Code generado:",r),this.qrCode=r,this.qrEventoId=t.id_evento,axios.post("/enviar-qr",{qrCode:r,evento:{nombre:t.nombre,descripcion:t.descripcion,fecha_inicio:t.fecha_inicio,fecha_fin:t.fecha_fin},email:this.correoUsuario}).then(l=>{this.cerrarModal(),this.mostrarConfirmacion=!0}).catch(l=>{console.error("Error al enviar el correo:",l.response?l.response.data:l)}),console.log("Datos enviados al backend:",{qrCode:r,evento:{nombre:t.nombre,fecha_inicio:t.fecha_inicio,fecha_fin:t.fecha_fin,descripcion:t.descripcion},email:this.correoUsuario})}).catch(r=>{console.error("Error al generar el código QR:",r)})}},created(){this.FetchEspacios()}},Mee={class:"centro"},Iee={key:0,class:"container d-flex flex-wrap justify-content-center align-items-center min-vh-100"},Cee={class:"card-header text-center"},Pee={class:"card-body"},Dee={class:"card-title text-cente"},Ree={class:"card-text"},Lee={class:"card-text"},Oee=["onClick"],kee={key:1,class:"text-center"},zee={key:2,class:"modal"},Fee={class:"modal-dialog"},Bee={class:"modal-content"},Nee={class:"modal-body"},Vee={class:"modal-footer"},Uee={key:3,class:"modal"},jee={class:"modal-dialog"},$ee={class:"modal-content"},Hee={class:"modal-footer"};function Gee(t,e,r,l,h,_){return Fi(),tn("div",Mee,[r.eventos.length?(Fi(),tn("div",Iee,[(Fi(!0),tn(os,null,dp(r.eventos,y=>(Fi(),tn("div",{key:y.id_evento,class:"card"},[gt("h5",Cee,Is(y.nombre),1),gt("div",Pee,[gt("h5",Dee,Is(y.fecha_inicio)+" / "+Is(y.fecha_fin),1),gt("p",Ree,Is(y.descripcion),1),gt("p",Lee,Is(_.getEspacioNombre(y.espacios_id_espacio)),1),gt("button",{onClick:s=>_.abrirModal(y),class:"btn btn-primary w-100"},"Participar",8,Oee)])]))),128))])):(Fi(),tn("div",kee,e[4]||(e[4]=[gt("p",{class:"alert alert-warning text-center"},"No hay eventos disponibles para este juego.",-1)]))),h.mostrarModal?(Fi(),tn("div",zee,[gt("div",Fee,[gt("div",Bee,[e[5]||(e[5]=gt("div",{class:"modal-header"},[gt("h3",{class:"modal-title"},"Introduce tu correo electrónico")],-1)),gt("div",Nee,[ka(gt("input",{type:"email","onUpdate:modelValue":e[0]||(e[0]=y=>h.correoUsuario=y),placeholder:"Correo electrónico",class:"form-control"},null,512),[[Na,h.correoUsuario]])]),gt("div",Vee,[gt("button",{onClick:e[1]||(e[1]=(...y)=>_.enviarQR&&_.enviarQR(...y)),class:"btn btn btn-secondary"},"Enviar"),gt("button",{onClick:e[2]||(e[2]=(...y)=>_.cerrarModal&&_.cerrarModal(...y)),class:"btn btn-danger"},"Cancelar")])])])])):Zl("",!0),h.mostrarConfirmacion?(Fi(),tn("div",Uee,[gt("div",jee,[gt("div",$ee,[e[6]||(e[6]=gt("div",{class:"modal-header"},[gt("h3",{class:"modal-title"},"¡Gracias por participar!")],-1)),e[7]||(e[7]=gt("div",{class:"modal-body"},[gt("p",null,"Te hemos enviado un correo con tu código QR.")],-1)),gt("div",Hee,[gt("button",{onClick:e[3]||(e[3]=(...y)=>_.cerrarConfirmacion&&_.cerrarConfirmacion(...y)),class:"btn btn btn-secondary"},"Aceptar")])])])])):Zl("",!0)])}const qee=yl(Aee,[["render",Gee],["__scopeId","data-v-e4fb2b15"]]),Wee={props:{userId:{type:Number,required:!0}}};function Zee(t,e,r,l,h,_){return Fi(),tn("h1",null,"Hola")}const Xee=yl(Wee,[["render",Zee]]),$u=Sx({});$u.component("Carouselmagenes",D7);$u.component("tabla-juegos",sQ);$u.component("pagina-torneos",DQ);$u.component("mapa",BQ);$u.component("perfil",OJ);$u.component("evento",qee);$u.component("myhud",Xee);$u.mount("#app");
